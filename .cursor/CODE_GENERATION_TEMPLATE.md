# Code Generation Template (ogen)

**Standard:** ogen для всех новых сервисов  
**Reference:** `services/combat-combos-service-ogen-go/`

---

## Makefile Template

```makefile
SERVICE := your-service
OPENAPI_SPEC := ../../proto/openapi/$(SERVICE).yaml

.PHONY: generate-api
generate-api:
	npx --yes @redocly/cli bundle $(OPENAPI_SPEC) -o openapi-bundled.yaml
	ogen --target pkg/api --package api --clean openapi-bundled.yaml

.PHONY: build
build: generate-api
	go build -o $(SERVICE) .

.PHONY: test
test:
	go test ./... -v

.PHONY: bench
bench:
	go test -run=^$$ -bench=. -benchmem ./server -benchtime=3s

.PHONY: run
run: build
	./$(SERVICE)
```

---

## Project Structure

```
services/{service}-go/
├── pkg/api/
│   ├── oas_*.go          # Generated by ogen (~20 files)
│   └── openapi-bundled.yaml
├── server/
│   ├── handlers.go       # Typed handlers (<500 lines)
│   ├── service.go        # Business logic (<500 lines)
│   ├── repository.go     # DB layer (<500 lines)
│   ├── security.go       # Auth handler (<200 lines)
│   ├── middleware.go     # Custom middleware (<300 lines)
│   └── *_test.go         # Tests & benchmarks
├── main.go               # Entry point
├── Makefile
└── go.mod
```

---

## Full Migration Guide

**See:** `.cursor/OGEN_MIGRATION_GUIDE.md`

**Reference service:** `services/combat-combos-service-ogen-go/`

**Performance gains:** 90% latency, 95% memory, 80% allocations
