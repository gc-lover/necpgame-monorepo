# Troubleshooting: Зависание терминала и команд в Cursor

## Проблема

Терминал в Cursor зависает при выполнении команд - команды выполняются, но вывод не появляется или появляется с большой задержкой. Также могут зависать агентские команды типа `cd services/economy-service-go && go mod tidy`.

## WARNING КРИТИЧНО: Индексация слишком большого количества файлов

**Основная причина зависаний (29.11.2025):** Cursor индексирует десятки тысяч файлов, включая:
- 8000+ `.uasset` файлов из UE5
- Большие JSON/YAML файлы из `knowledge/`
- Build артефакты и сгенерированные файлы

**Решение:**
1. OK Обновите `.cursorignore` - добавлены исключения для:
   - Всех UE5 бинарных файлов (`.uasset`, `.umap`, `.uexp` и т.д.)
   - Build артефактов (`*.exe`, `*.test`)
   - Больших JSON файлов из `knowledge/`
   - Сгенерированных файлов

2. Перезапустите Cursor для применения изменений

3. Очистите кеш индексации Cursor (если проблема сохраняется):
   - Закройте Cursor
   - Удалите папку `.cursor/` кеша (если есть)
   - Откройте Cursor заново

## Возможные причины

### 1. Git Hooks блокируют выполнение

**Проблема:** Git hooks (`.githooks/pre-commit`, `.githooks/post-checkout`) могут вызываться даже при выполнении обычных команд, если они используют git команды внутри.

**Решение:**
```cmd
# Временно отключить git hooks для тестирования
git config --unset core.hooksPath

# Или использовать --no-verify для git команд
git commit --no-verify
```

### 2. Проблемы с интеграцией терминала Cursor

**Проблема:** Cursor может иметь проблемы с выводом в терминале, особенно при длительных операциях.

**Решение:**
- Проверьте настройки Cursor: `Settings` > `Terminal` > `Terminal Integrated Shell Integration`
- Попробуйте отключить/включить `terminal.integrated.shellIntegration.enabled`

### 3. Bash скрипты в git hooks на Windows

**Проблема:** Git hooks используют bash скрипты, которые могут зависать на Windows при отсутствии Git Bash.

**Решение:**
```cmd
# Проверьте, установлен ли Git Bash
where bash.exe

# Должен показать: C:\Program Files\Git\bin\bash.exe
# Если нет - установите Git for Windows
```

### 4. Долгие операции без вывода

**Проблема:** Команды типа `go build` могут выполняться долго без вывода, что создает впечатление зависания.

**Решение:**
- Используйте команды с явным выводом: `go build -v`
- Добавляйте `echo` перед долгими операциями
- Используйте таймауты для команд

## Рекомендации для агентов

1. **Используйте короткие команды** - разбивайте длинные команды на части
2. **Добавляйте явный вывод** - используйте `echo` перед важными операциями
3. **Избегайте git команд в терминале** - используйте MCP GitHub вместо git команд
4. **Проверяйте файлы напрямую** - используйте `read_file` вместо `cat` в терминале
5. **Используйте фоновые процессы** - для долгих операций используйте `is_background: true`

## Решения для оптимизации производительности

### Немедленные действия

1. **Обновите `.cursorignore`** - файл уже обновлен с исключениями для:
   - UE5 бинарных файлов
   - Build артефактов
   - Больших файлов знаний

2. **Перезапустите Cursor** - это необходимо для применения новых правил `.cursorignore`

3. **Проверьте размер проекта:**
   ```cmd
   # Проверьте, сколько файлов индексируется
   git ls-files | wc -l
   ```

### Дополнительные оптимизации

1. **Используйте прямые инструменты вместо терминала:**
   - `read_file` вместо `cat`
   - `grep` вместо `grep` в терминале
   - `read_lints` для проверки ошибок

2. **Для git операций:**
   - Используйте MCP GitHub вместо команд терминала
   - Избегайте git hooks при работе через агентов

3. **Для компиляции:**
   - Используйте отдельный терминал вне Cursor
   - Используйте фоновые процессы (`is_background: true`)

## Временное решение

Если терминал зависает, можно:
1. Проверять код через `read_file` и `grep` вместо терминала
2. Использовать MCP GitHub для git операций
3. Компилировать вручную в отдельном терминале
4. Использовать `read_lints` для проверки ошибок
5. Разбивать команды на части с явным выводом:
   ```cmd
   echo "Starting..."
   cd services/economy-service-go
   echo "Running go mod tidy..."
   go mod tidy
   echo "Done!"
   ```

## Проверка проблемы

```cmd
# Проверка 1: Простая команда
echo Test

# Проверка 2: Git hooks
git config --get core.hooksPath

# Проверка 3: Bash доступность
where bash.exe

# Проверка 4: Go компиляция (долгая операция)
cd services\character-engram-security-service-go
go build -v .
```

## Проверка эффективности

После обновления `.cursorignore` проверьте:

```cmd
# Проверка 1: Количество файлов, которые НЕ игнорируются
git ls-files | findstr /V ".uasset .umap .exe" | find /C /V ""

# Проверка 2: Размер исключенных файлов
git ls-files | findstr ".uasset" | find /C ""

# Проверка 3: Простая команда (должна работать быстро)
echo "Test"
```

## Ссылки

- [Cursor Terminal Troubleshooting](https://docs.cursor.com/ru/troubleshooting/troubleshooting-guide)
- [Git Hooks Setup](./.github/GIT_HOOKS_SETUP.md)
- [Cursor Performance Optimization](https://docs.cursor.com/ru/performance)

