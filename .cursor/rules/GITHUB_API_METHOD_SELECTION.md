# Выбор метода работы с GitHub Issues API

## Быстрый выбор метода

**Для агентов (поиск задач по меткам):** → `list_issues` с `labels`
**Для поиска по тексту/датам:** → `search_issues` (редко используется)

---

## Два способа работы с Issues

### Способ 1: `list_issues` с `labels` (РЕКОМЕНДУЕТСЯ)

**Используй когда:**
- ✅ Фильтрация по меткам (`agent:*`, `stage:*`, `priority:*`)
- ✅ Фильтрация по статусу (`OPEN`, `CLOSED`)
- ✅ Комбинация меток + статус
- ✅ Работа с одним конкретным репозиторием
- ✅ Нужно получить все issues с определенными метками

**Лимиты:**
- GraphQL API: 5000 очков/час (простые запросы = 1 очко = 5000/час)
- Нет secondary rate limit (не блокирует другие запросы)

**Задержки:**
- 200-300ms между запросами

**Пример:**
```javascript
// Поиск задач агента по меткам
const result = await mcp_github_list_issues({
  owner: 'gc-lover',
  repo: 'necpgame-monorepo',
  labels: ['agent:idea-writer', 'stage:idea'],
  state: 'OPEN',
  perPage: 100
});

// Фильтрация готовых задач через метки
const readyTasks = result.issues.filter(issue => 
  issue.labels.some(label => label.name.startsWith('ready:'))
);
```

---

### Способ 2: `search_issues` (ТОЛЬКО при необходимости)

**Используй ТОЛЬКО когда пользователь ЯВНО просит:**
- ✅ Поиск по тексту в title или body (пользователь указал ключевые слова)
- ✅ Поиск по датам (created, updated) - пользователь указал диапазон дат
- ✅ Поиск по assignee - пользователь указал имя пользователя
- ✅ Поиск по комбинации сложных условий, которые нельзя выразить через метки
- ✅ Поиск по нескольким репозиториям одновременно

**НЕ используй для обычного поиска задач агента** - для этого всегда `list_issues` с `labels`.

**Лимиты:**
- 30 запросов/мин = 1800 запросов/час
- При превышении блокирует ВСЕ типы запросов на 1 час (secondary rate limit)
- Максимум 1000 результатов на запрос

**Задержки:**
- 2000-3000ms между запросами (ОБЯЗАТЕЛЬНО)

**Пример:**
```javascript
// Поиск по тексту в названии (НЕ МОЖЕТ быть через list_issues)
const result = await mcp_github_search_issues({
  query: 'is:issue is:open repo:gc-lover/necpgame-monorepo "система транспорта" in:title',
  perPage: 100
});
await delay(2000); // ОБЯЗАТЕЛЬНО 2-3 сек задержка
```

---

## Правила выбора метода

### ✅ ВСЕГДА используй `list_issues` если:

| Сценарий | Метод | Пример |
|----------|-------|--------|
| Поиск по метке агента | `list_issues` | `labels: ['agent:idea-writer']` |
| Поиск по метке этапа | `list_issues` | `labels: ['stage:idea']` |
| Комбинация меток | `list_issues` | `labels: ['agent:idea-writer', 'stage:idea']` |
| Фильтрация по статусу | `list_issues` | `state: 'OPEN'` |
| Метки + статус | `list_issues` | `labels: [...], state: 'OPEN'` |
| Работа с одним репозиторием | `list_issues` | Указывается `owner` и `repo` |

### ⚠️ Используй `search_issues` ТОЛЬКО если пользователь ЯВНО просит:

| Сценарий | Метод | Когда использовать |
|----------|-------|-------------------|
| Поиск по тексту в title | `search_issues` | Пользователь: "Найди задачи со словом 'транспорт' в названии" |
| Поиск по тексту в body | `search_issues` | Пользователь: "Найди задачи, где упоминается 'система'" |
| Поиск по дате создания | `search_issues` | Пользователь: "Найди задачи, созданные после 1 ноября" |
| Поиск по дате обновления | `search_issues` | Пользователь: "Найди задачи, обновленные на этой неделе" |
| Поиск по assignee | `search_issues` | Пользователь: "Найди задачи, назначенные на пользователя X" |
| Поиск по нескольким репозиториям | `search_issues` | Пользователь: "Найди задачи в репозиториях X и Y" |

**Для обычного поиска задач агента (по меткам) → ВСЕГДА `list_issues`**

---

## Сравнение методов

| Характеристика | `list_issues` | `search_issues` |
|----------------|---------------|----------------|
| **Лимит запросов** | 5000/час (1 очко/запрос) | 1800/час (30/мин) |
| **Secondary rate limit** | Нет | Да (блокирует все запросы) |
| **Фильтрация по меткам** | ✅ Да | ✅ Да |
| **Фильтрация по статусу** | ✅ Да | ✅ Да |
| **Поиск по тексту** | ❌ Нет | ✅ Да |
| **Поиск по датам** | ❌ Нет | ✅ Да |
| **Поиск по assignee** | ❌ Нет | ✅ Да |
| **Максимум результатов** | Нет ограничения | 1000 на запрос |
| **Задержка между запросами** | 200-300ms | 2000-3000ms |
| **Рекомендуется для агентов** | ✅ Да | ❌ Только при необходимости |

---

## Примеры для агентов

### Idea Writer: поиск задач

```javascript
// ✅ ПРАВИЛЬНО: list_issues (фильтрация по меткам)
const issues = await mcp_github_list_issues({
  owner: 'gc-lover',
  repo: 'necpgame-monorepo',
  labels: ['agent:idea-writer', 'stage:idea'],
  state: 'OPEN',
  perPage: 100
});

// Фильтрация готовых задач
const readyTasks = issues.issues.filter(issue => 
  issue.labels.some(label => label.name.startsWith('ready:'))
);
```

### Поиск по тексту (редкий случай)

```javascript
// ⚠️ ТОЛЬКО если нужен поиск по тексту
const issues = await mcp_github_search_issues({
  query: 'is:issue is:open repo:gc-lover/necpgame-monorepo "транспорт" in:title label:agent:idea-writer',
  perPage: 100
});
await delay(2000); // ОБЯЗАТЕЛЬНО
```

---

## Рекомендации

1. **Для агентов:** ВСЕГДА используй `list_issues` с `labels` - это основной способ поиска задач по меткам агента и этапа
2. **Для поиска по тексту:** Используй `search_issues` ТОЛЬКО если пользователь ЯВНО просит найти что-то по тексту/датам/assignee
3. **Критерии выбора БЕЗ знания содержимого:** Основаны на метаданных (метки, статус, тип запроса), НЕ на содержимом Issues
4. **Кэширование:** Кэшируй результаты `list_issues` на 1-2 минуты для повторных запросов
5. **Задержки:** Соблюдай задержки (200-300ms для `list_issues`, 2000-3000ms для `search_issues`)

---

## Чеклист выбора метода (БЕЗ знания содержимого Issues)

**Критерии основаны на метаданных (метки, статус, тип поиска), НЕ на содержимом:**

- [ ] Фильтрация по меткам (`agent:*`, `stage:*`)? → `list_issues`
- [ ] Фильтрация по статусу (`OPEN`, `CLOSED`)? → `list_issues`
- [ ] Комбинация меток + статус? → `list_issues`
- [ ] Работа с одним репозиторием? → `list_issues`
- [ ] Поиск по тексту в title (пользователь явно просит)? → `search_issues`
- [ ] Поиск по тексту в body (пользователь явно просит)? → `search_issues`
- [ ] Поиск по датам (пользователь явно просит)? → `search_issues`
- [ ] Поиск по assignee (пользователь явно просит)? → `search_issues`
- [ ] Поиск по нескольким репозиториям? → `search_issues`

**Для агентов:** В 99% случаев используй `list_issues` с `labels` - это поиск задач по меткам агента и этапа.

