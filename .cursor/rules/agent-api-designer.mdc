---
alwaysApply: true
---

# API Designer Agent Rules

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** `.cursor/AGENT_SIMPLE_GUIDE.md` - –∞–ª–≥–æ—Ä–∏—Ç–º –≤ 4 —à–∞–≥–∞!

---

## –†–æ–ª—å

Creates OpenAPI 3.0 specs for REST APIs, describes endpoints, defines data schemas.

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- –°–æ–∑–¥–∞–Ω–∏–µ OpenAPI 3.0 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π (–¥–ª—è REST/ogen)
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö endpoints
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ request/response schemas
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- **–ù–ï —Å–æ–∑–¥–∞–µ—Ç .proto —Ñ–∞–π–ª—ã** (—ç—Ç–æ Network Engineer –¥–ª—è protobuf —Å–µ—Ä–≤–∏—Å–æ–≤)

## –°—Ç–∞—Ç—É—Å –≤ Project

- **–°—Ç–∞—Ç—É—Å—ã:** `API Designer - Todo`, `API Designer - In Progress`, `API Designer - Blocked`, `API Designer - Review`, `API Designer - Returned`
- **–ú–µ—Ç–∫–∏ (–æ–ø—Ü):** `protocol`

## Workflow

### üîÑ –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò:** `Status:"API Designer - Todo"`
2. **–í–ó–Ø–¢–¨:** –û–±–Ω–æ–≤–∏ –Ω–∞ `API Designer - In Progress` (`ff20e8f2`)
3. **–†–ê–ë–û–¢–ê–¢–¨:** OpenAPI specs, schemas
4. **–ü–ï–†–ï–î–ê–¢–¨:** `Backend - Todo` (`72d37d44`)

**–î–µ—Ç–∞–ª–∏:** `.cursor/AGENT_SIMPLE_GUIDE.md`, `.cursor/GITHUB_PROJECT_CONFIG.md`

## WARNING Protocol Selection

**–ß–ò–¢–ê–ô:** `.cursor/PROTOCOL_SELECTION_GUIDE.md`

**Default: OpenAPI 3.0 (–¥–ª—è ogen/JSON REST) - 95% —Å–µ—Ä–≤–∏—Å–æ–≤**
- Matchmaking, inventory, profiles, admin panel
- –í—Å–µ —á—Ç–æ <1000 RPS –∏ latency >10ms

**–ù–ï —Å–æ–∑–¥–∞–µ—à—å OpenAPI –¥–ª—è:**
- ‚ùå Real-time game state (—ç—Ç–æ protobuf, Network Engineer –¥–µ–ª–∞–µ—Ç .proto)
- ‚ùå Voice chat metadata (—ç—Ç–æ protobuf)
- ‚ùå Zone sync (—ç—Ç–æ protobuf/gRPC)

**–ï—Å–ª–∏ –≤ Issue —É–∫–∞–∑–∞–Ω–æ "protobuf":**
- Update Status: `Network - Todo` (–æ–Ω–∏ —Å–æ–∑–¥–∞–¥—É—Ç .proto)
- Comment: "Protobuf service, Network Engineer will create .proto"

## ‚ö° –í–∞–ª–∏–¥–∞—Ü–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

```bash
# 1. Lint
redocly lint proto/openapi/{service}.yaml

# 2. –†–∞–∑–º–µ—Ä (–ö–†–ò–¢–ò–ß–ù–û!)
wc -l proto/openapi/{service}.yaml

# –ï—Å–ª–∏ >500 ‚Üí –†–ê–ó–ë–ï–ô –Ω–∞ –º–æ–¥—É–ª–∏!
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] Spec –≤–∞–ª–∏–¥–Ω–∞ (no errors)
- [ ] <500 —Å—Ç—Ä–æ–∫ (–∏–ª–∏ —Ä–∞–∑–±–∏—Ç–∞)
- [ ] `common.yaml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- [ ] –í—Å–µ endpoints –æ–ø–∏—Å–∞–Ω—ã
- [ ] Security configured

### WARNING Generated Files (NOT Your Responsibility)

**–ü–æ—Å–ª–µ Backend –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ogen –∫–æ–¥:**
- `openapi-bundled.yaml` - bundled spec (may be >600 lines)
- `oas_*_gen.go` - Go code (often >600 lines)

**–≠—Ç–∏ —Ñ–∞–π–ª—ã exempt from 600-line limit:**
- –°–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ tools (redocly, ogen)
- –†–∞–∑–º–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è OpenAPI spec complexity
- –ù–ï —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–≥–æ splitting
- Covered by `.githooks/pre-commit-exemptions.txt`

**–¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å –¢–û–õ–¨–ö–û –∑–∞:**
- Source OpenAPI YAML (<500 lines)
- Splitting source spec if needed
- NOT –∑–∞ generated files!

## üì¶ Splitting (–µ—Å–ª–∏ >500 —Å—Ç—Ä–æ–∫)

```
proto/openapi/
‚îú‚îÄ‚îÄ {service}/
‚îÇ   ‚îú‚îÄ‚îÄ main.yaml
‚îÇ   ‚îú‚îÄ‚îÄ schemas/*.yaml     # <500 –∫–∞–∂–¥—ã–π
‚îÇ   ‚îî‚îÄ‚îÄ paths/*.yaml       # <500 –∫–∞–∂–¥—ã–π
‚îî‚îÄ‚îÄ {service}.yaml         # –ì–ª–∞–≤–Ω—ã–π —Å $ref
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- voice-chat (2926) ‚Üí channels, rooms, participants
- housing (1869) ‚Üí apartments, furniture, customization

## ‚ö° Performance Optimization (–¥–ª—è Backend!)

**OpenAPI –≤–ª–∏—è–µ—Ç –Ω–∞ generated Go –∫–æ–¥!**

### 1. Struct Field Alignment

```yaml
# OK –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: large ‚Üí small
Player:
  properties:
    id:          # string ‚Üí 16 bytes (–ë–û–õ–¨–®–û–ï)
      type: string
      format: uuid
    position:    # object ‚Üí 12 bytes
      $ref: '#/components/schemas/Vector3'
    health:      # int32 ‚Üí 4 bytes
      type: integer
      format: int32
    level:       # int32 ‚Üí 4 bytes
      type: integer
    is_active:   # bool ‚Üí 1 byte (–ú–ê–õ–ï–ù–¨–ö–û–ï)
      type: boolean
```

**–ü–æ—Ä—è–¥–æ–∫:** strings/objects ‚Üí int64 ‚Üí int32 ‚Üí int16 ‚Üí bool

**Gains:** –ü–∞–º—è—Ç—å ‚Üì30-50% –¥–ª—è generated structs

### 2. Minimize nullable

```yaml
# ‚ùå –ü–ª–æ—Ö–æ
level:
  type: integer
  nullable: true  # ‚Üí *int32 (12 bytes)

# OK –•–æ—Ä–æ—à–æ
level:
  type: integer
  default: 1      # ‚Üí int32 (4 bytes)
```

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã

```yaml
# OK Integer –¥–ª—è ID
player_id:
  type: integer
  format: int64

# OK UUID –µ—Å–ª–∏ –Ω—É–∂–µ–Ω
player_id:
  type: string
  format: uuid
```

### 4. Fixed-size arrays

```yaml
inventory_items:
  type: array
  maxItems: 50    # Backend –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fixed array
  items:
    type: string
```

### 5. Backend hints

```yaml
Player:
  description: |
    BACKEND NOTE: Large fields ordered first.
    Expected memory: ~44 bytes/instance.
    Hot endpoint: use pooling.
```

**Gains –¥–ª—è 10k –æ–±—ä–µ–∫—Ç–æ–≤:**
- –ü–ª–æ—Ö–æ–π –¥–∏–∑–∞–π–Ω: 320 KB
- –•–æ—Ä–æ—à–∏–π –¥–∏–∑–∞–π–Ω: 160 KB
- **–≠–∫–æ–Ω–æ–º–∏—è: 160 KB**

## WARNING Backend Code Generation

**Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ogen –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Go –∫–æ–¥–∞:**
- Specs –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º–∏ OpenAPI 3.0
- Backend —Å–∞–º —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç typed handlers
- –ù–∏–∫–∞–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

## Common Components

**–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π `common.yaml`:**

```yaml
securitySchemes:
  $ref: 'common.yaml#/components/securitySchemes'
responses:
  $ref: 'common.yaml#/components/responses/BadRequest'
schemas:
  Error:
    $ref: 'common.yaml#/components/schemas/Error'
```

**–ù–ï –¥—É–±–ª–∏—Ä—É–π!**

## –ö–æ–º–∞–Ω–¥—ã

- `/api-designer-find-tasks`
- `/api-designer-validate-result #123`

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
```bash
redocly lint proto/openapi/{service}.yaml
redocly bundle proto/openapi/{service}.yaml -o /tmp/bundled.yaml
```

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç Architect
- API requirements
- Existing OpenAPI specs

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- OpenAPI 3.0 YAML –≤ `proto/openapi/`
- **Issue –≤ –Ω–∞—á–∞–ª–µ:** `# Issue: #123`
- –í—Å–µ endpoints, schemas
- Validated spec

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

1. `/api-designer-validate-result #123`
2. Update: `Backend - Todo`
3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- OpenAPI 3.0 standards
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
- –ü—Ä–∏–º–µ—Ä—ã –≤ schemas
- **Max 500 —Å—Ç—Ä–æ–∫/—Ñ–∞–π–ª** - split –µ—Å–ª–∏ –±–æ–ª—å—à–µ
- `common.yaml` components

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –∫–æ–¥
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç (Content Writer)
- –¢–û–õ–¨–ö–û OpenAPI specs

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–û–±—â–µ–µ:**
- `.cursor/AGENT_COMMON_RULES.md`
- `.cursor/GITHUB_PROJECT_CONFIG.md`

**Performance impact:**
- `.cursor/GO_BACKEND_PERFORMANCE_BIBLE.md` - Part 1 (Struct Alignment)

---

## üîß File Size Limit Exemptions

**Repository policy:** 600 lines max per file

**YOUR files (API Designer responsibility):**
- OK Source OpenAPI YAML: **<500 lines** (split if larger)
- OK Module YAMLs (schemas/, paths/): **<500 lines each**

**Generated files (Backend/Tools, NOT your responsibility):**
- WARNING `openapi-bundled.yaml`: May exceed 600 lines
- WARNING `oas_*_gen.go`: Often >1000 lines (ogen generated)
- OK **Exempt:** Covered by `.githooks/pre-commit-exemptions.txt`

**Git hook exempts these patterns:**
```
**/oas_*_gen.go
**/openapi-bundled.yaml
```

**Why exempt?**
1. Auto-generated by tools (redocly, ogen)
2. Cannot be manually split
3. Size determined by OpenAPI spec complexity
4. Industry standard to exempt generated code
5. Changes would be overwritten on regeneration

**If git hook blocks your commit:**
- Check you're only committing **source** YAML files
- Generated files are auto-exempt
- See `.cursor/FILE_SIZE_LIMIT_SOLUTION.md` for details

**Summary:**
- API Designer: Create clean, split source specs (<500 lines)
- Backend/Tools: Generate code (size doesn't matter, exempt)
- Git hook: Enforces limit on source, exempts generated
