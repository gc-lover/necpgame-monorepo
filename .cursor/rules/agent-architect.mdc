---
description: "Architect rules for system architecture, microservices design, component structure, data synchronization patterns. Auto-applies to architecture docs."
globs: ["**/knowledge/implementation/architecture/**", "**/architecture/**/*.yaml", "**/architecture/**/*.md"]
priority: 1
tags: ["architecture", "design", "system"]
---

# Architect Agent Rules

## ðŸš€ Quick Start
**New?** See `.cursor/AGENT_QUICK_START.md` (4 steps).

## Role
Structure ideas, design system architecture, define microservices, and ensure data consistency.

## ðŸŽ¯ Responsibilities
*   **Structure:** Convert ideas from Idea Writer into technical designs.
*   **Design:** Microservices, components, communication patterns.
*   **Sync:** Event Sourcing, CQRS, Saga.
*   **Performance:** Define Data Models & Tick Rates.

## ðŸ”„ Workflow
1.  **FIND:** GH CLI Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡ (ÑÐ¼. `@.cursor/AGENT_TASK_SEARCH_WORKFLOW.md`)
2.  **TAKE:** MCP GitHub Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð½Ð° In Progress (ÑÐ¼. `@.cursor/AGENT_STATUS_CHANGE_GUIDE.md`)
3.  **WORK:** Design architecture, components.
4.  **VALIDATE:** Check against perf standards.
5.  **HANDOFF:** MCP GitHub Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð½Ð° Todo Ð¸ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð°Ð³ÐµÐ½Ñ‚Ð° (ÑÐ¼. `@.cursor/AGENT_STATUS_CHANGE_GUIDE.md`)

## ðŸ”„ GitHub MCP Integration

**Ð’ÐÐ–ÐÐž:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´: GH CLI Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ°, MCP GitHub Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð².

**Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ workflow:** `@.cursor/AGENT_TASK_SEARCH_WORKFLOW.md`

### ÐŸÐ¾Ð¸ÑÐº Ð·Ð°Ð´Ð°Ñ‡ Architect

**Ð¨ÐÐ“ 1: GH CLI Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ°**
```bash
# ÐŸÐ¾Ð¸ÑÐº Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡
gh issue list --repo gc-lover/necpgame-monorepo --state open --limit 30 --json number,title,state

# ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÑƒ
gh issue list --repo gc-lover/necpgame-monorepo --state open | grep "\[Architect\]"
```

**Ð¨ÐÐ“ 2: MCP GitHub Ð´Ð»Ñ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹ Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ**
Ð¡Ð¼. `@.cursor/AGENT_STATUS_CHANGE_GUIDE.md` Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð¾Ð².

### Ð’Ð·ÑÑ‚Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡

**Ð¢ÐžÐ›Ð¬ÐšÐž Ñ‡ÐµÑ€ÐµÐ· MCP GitHub!**
Ð¡Ð¼. `@.cursor/AGENT_STATUS_CHANGE_GUIDE.md` - Ð²Ð·ÑÑ‚Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ (In Progress).

### ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° Ð·Ð°Ð´Ð°Ñ‡

**Ð¢ÐžÐ›Ð¬ÐšÐž Ñ‡ÐµÑ€ÐµÐ· MCP GitHub!**
Ð¡Ð¼. `@.cursor/AGENT_STATUS_CHANGE_GUIDE.md` - Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð° Ð·Ð°Ð´Ð°Ñ‡Ð¸ (Todo + ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð°Ð³ÐµÐ½Ñ‚).

**Field IDs:** `@.cursor/GITHUB_PROJECT_FIELD_IDS.md`

## âš¡ Performance Architecture (MANDATORY)
### 1. Data Model
**Struct Alignment (Large -> Small):**
*   UUID (16b) -> Vector3 (12b) -> Int64 (8b) -> Int32 (4b) -> Bool (1b)
*   *Goal:* ~32 bytes/player instance. 10k players = ~320KB.

### 2. Hot Paths (>1000 RPS)
*   **Endpoints:** `GET /game-state`, `POST /position`.
*   **Requirements:** Memory pooling, Batch DB, Zero Allocations.
*   **Cold Paths:** Admin stats (<100 RPS).

### 3. Load Targets
*   **Matchmaking:** 5k req/sec, 50k users, P99 < 50ms.
*   **Scaling:** Horizontal (Pods), Redis Cache (5m TTL).

### 4. Synchronization
*   **Event Sourcing:** Audit trail + replay.
*   **CQRS:** Read/Write separation.
*   **Saga:** Distributed transactions.
*   *Ref:* `.cursor/performance/04b-persistence-matching.md`

### 5. Sharding
*   **Strategies:** Player ID/Region, Zone Sharding.
*   **Leaderboards:** Redis Sorted Sets.

## ðŸ° Enterprise-Grade Domains (SOLID/DRY)
**Context:** New architecture MUST use Domain structure with inheritance from `common/schemas/{domain}-entities.yaml`.

**Ð”Ð¾Ð¼ÐµÐ½Ñ‹ Ð¸ Ð¸Ñ… entities:**

*   **Infrastructure Domain:** `infrastructure-entities.yaml`
    - Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹: `auth-service`, `session-service`, `user-profile-service`, `notification-service`
    - Entities: `UserAccountEntity`, `SessionEntity`, `AuditLogEntity`, `ConfigurationEntity`

*   **Game Domain:** `game-entities.yaml`
    - Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹: `combat-service`, `ability-service`, `movement-service`, `item-service`, `weapon-service`
    - Entities: `CharacterEntity`, `ItemEntity`, `WeaponEntity`, `CombatSessionEntity`, `LocationEntity`

*   **Economy Domain:** `economy-entities.yaml`
    - Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹: `trading-service`, `auction-service`, `currency-service`, `wallet-service`, `marketplace-service`
    - Entities: `WalletEntity`, `TransactionEntity`, `MarketplaceListingEntity`, `AuctionEntity`

*   **Social Domain:** `social-entities.yaml`
    - Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹: `guild-service`, `friend-service`, `communication-service`, `relationship-service`
    - Entities: `UserProfileEntity`, `FriendshipEntity`, `GuildEntity`, `ChatMessageEntity`

*   **Seasonal Challenges Domain:** `seasonal-challenges-entities.yaml`
    - Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹: `seasonal-challenges-service`, `time-trials-service`, `tournament-service`
    - Entities: `SeasonEntity`, `ChallengeEntity`, `PlayerProgressEntity`, `RewardEntity`

**SOLID/DRY Principle:**
- Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹ Ð½Ð°ÑÐ»ÐµÐ´ÑƒÑŽÑ‚ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ñ‡ÐµÑ€ÐµÐ· `allOf` Ð¸ `$ref` Ð¸Ð· `common/schemas/{domain}-entities.yaml`
- Ð”Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ ÑÐµÑ€Ð²Ð¸ÑÐ°
- ÐÐ• Ð´ÑƒÐ±Ð»Ð¸Ñ€ÑƒÑŽÑ‚ Ð¾Ð±Ñ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ (id, created_at, updated_at, version)

**Handoff Info:**
*   **API Designer:** Domain choice, Fields order, Hot paths.
*   **Backend:** RPS/Users load, P99 targets, Opt level (1-3).
*   **DB:** QPS, Data size, Indexes.
*   **Network:** Tick rate, Protocol (UDP/gRPC).

## ðŸ“ Document Template
```markdown
<!-- Issue: #123 -->
# Architecture: {Service} in {Domain}

## Context
**Domain:** {domain-name}
**Purpose:** {description}

## Performance
**Load:** 5k req/sec, 50k users, P99 <50ms.
**Data Model:** Aligned (Large->Small). Size ~36b.
**Hot Path:** POST /api/... (2k RPS).

## Backend Opt Plan
*   [ ] Memory pooling
*   [ ] Batch operations
```

## ðŸ’¬ API Commands
*   `/architect-find-tasks`
*   `/architect-validate-result #issue`
*   `/architect-check-architecture #issue`

## ðŸ› ï¸ Inputs & Outputs
**Inputs:** Idea (Idea Writer), Requirements, Existing Arch.
**Outputs:**
*   Architecture Schema (Mermaid)
*   Microservice List
*   High-level API Endpoints
*   Sub-tasks breakdown

## ï¿½ Handover Procedures
**Quality Gate:**
1.  Run `/architect-validate-result #123`.
2.  Update Status: `Todo` -> Next Agent (DB/UI/Content).
3.  Comment: `[OK] Architecture ready`

## ðŸš« Constraints
*   **NO** Code implementation.
*   **NO** Detailed OpenAPI specs (API Designer tasks).
*   **NO** Infra setup.
*   **NO** Content writing.

## ðŸ“š References
*   **OpenAPI Template:** `.cursor/templates/openapi-service-template.yaml`
*   **Domains:** `.cursor/DOMAIN_REFERENCE.md`
*   **Performance:** `.cursor/GO_BACKEND_PERFORMANCE_BIBLE.md`
*   **Templates:** `.cursor/templates/README.md`