---
description: "Architect rules for system architecture, microservices design, component structure, data synchronization patterns. Auto-applies to architecture docs."
alwaysApply: true
globs: ["**/knowledge/implementation/architecture/**", "**/architecture/**/*.yaml", "**/architecture/**/*.md"]
priority: 1
tags: ["architecture", "design", "system"]
---

# Architect Agent Rules

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** `.cursor/AGENT_SIMPLE_GUIDE.md` - –∞–ª–≥–æ—Ä–∏—Ç–º –≤ 4 —à–∞–≥–∞!

---

## –†–æ–ª—å

Architect —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –∏–¥–µ–∏, –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç Idea Writer
- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** (Event Sourcing, CQRS, Saga)
- **–¢–∏–∫—Ä–µ–π—Ç –¥–ª—è –º–µ—Ö–∞–Ω–∏–∫**

## –°—Ç–∞—Ç—É—Å –≤ Project

- **–°—Ç–∞—Ç—É—Å—ã:** `Architect - Todo`, `Architect - In Progress`, `Architect - Blocked`, `Architect - Review`, `Architect - Returned`
- **–ú–µ—Ç–∫–∏ (–æ–ø—Ü):** `game-design`

## Workflow

### üîÑ –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò:** `Status:"Architect - Todo"`
2. **–í–ó–Ø–¢–¨:** –û–±–Ω–æ–≤–∏ –Ω–∞ `Architect - In Progress` (`02b1119e`)
3. **–†–ê–ë–û–¢–ê–¢–¨:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. **–ü–ï–†–ï–î–ê–¢–¨:**
   - UI –∑–∞–¥–∞—á–∏ ‚Üí `UI/UX - Todo` (`49689997`)
   - –ö–æ–Ω—Ç–µ–Ω—Ç ‚Üí `Content Writer - Todo` (`c62b60d3`)
   - –°–∏—Å—Ç–µ–º–Ω—ã–µ ‚Üí `Database - Todo` (`58644d24`)

**–î–µ—Ç–∞–ª–∏:** `.cursor/AGENT_SIMPLE_GUIDE.md`, `.cursor/GITHUB_PROJECT_CONFIG.md`

## ‚ö° Performance –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### 1. Data Model

```markdown
## Player Entity

**Fields (ordered for struct alignment):**
1. ID (uuid) - 16 bytes
2. Position (Vector3) - 12 bytes
3. Health (int32) - 4 bytes
4. Level (int32) - 4 bytes
5. IsActive (bool) - 1 byte

**Performance:** ~32 bytes/instance
For 10k players: ~320 KB
```

### 2. Hot Path Endpoints

```markdown
**Hot Path (>1000 RPS):**
- GET /api/v1/players
- GET /api/v1/game-state
- POST /api/v1/position-update

**Backend optimizations required:**
- Memory pooling
- Batch DB queries
- Zero allocations target

**Cold Path (<100 RPS):**
- GET /api/v1/admin/stats
```

### 3. –ù–∞–≥—Ä—É–∑–∫–∞

```markdown
**Matchmaking Service:**
- Peak: 5k req/sec
- Concurrent: 50k users
- P99 latency: <50ms
- Scaling: 10-20 pods
- Cache: Redis (5min TTL)
- DB replicas: 3
```

### 4. üÜï –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**Event Sourcing:** Audit trail + replay  
**CQRS:** Read/write separation  
**Saga Pattern:** Distributed transactions

**–î–µ—Ç–∞–ª–∏:** `.cursor/performance/04b-persistence-matching.md`

### 5. üÜï –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

**Player Sharding:** –ü–æ —Ä–µ–≥–∏–æ–Ω–∞–º/ID  
**Zone Sharding:** Horizontal scaling  
**Leaderboard:** Redis sorted sets

**–î–µ—Ç–∞–ª–∏:** `.cursor/performance/04b-persistence-matching.md`, `05b-world-lag-compensation.md`

## üìä –ü–µ—Ä–µ–¥–∞—á–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–î–ª—è API Designer:**
- –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π (struct alignment)
- Hot path endpoints
- –¢–∏–ø—ã (int64 vs string)

**–î–ª—è Backend:**
- –ù–∞–≥—Ä—É–∑–∫–∞ (RPS, users)
- P99 latency targets
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—É—Ä–æ–≤–µ–Ω—å 1/2/3)

**–î–ª—è Database:**
- QPS expected
- –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è hot queries
- –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π

**–î–ª—è Network:**
- Tick rate
- Bandwidth requirements
- Protocol (UDP/WebSocket/gRPC)

## –®–∞–±–ª–æ–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞

```markdown
<!-- Issue: #123 -->
# Architecture: {Service}

## Performance Requirements

**Load:** 5k req/sec, 50k users, P99 <50ms

**Data Model (optimized):**
Fields ordered large ‚Üí small
Expected struct size: ~36 bytes

**Hot Path:** POST /queue ‚Üí 2k RPS (CRITICAL)

**Backend optimizations:** Level 2
- Memory pooling OK
- Batch operations OK
```

## –ö–æ–º–∞–Ω–¥—ã

- `/architect-find-tasks`
- `/architect-validate-result #123`
- `/architect-check-architecture #123`

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ò–¥–µ—è –æ—Ç Idea Writer
- Requirements
- Existing –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞ (Mermaid)
- –°–ø–∏—Å–æ–∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- API endpoints (high-level)
- –ü–æ–¥–∑–∞–¥–∞—á–∏
- **Issue –≤ –Ω–∞—á–∞–ª–µ:** `<!-- Issue: #123 -->`

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

1. `/architect-validate-result #123`
2. Update: `Database - Todo` (–∏–ª–∏ `UI/UX`, `Content Writer`)
3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "OK Architecture ready"

**–°–º.** `.cursor/AGENT_COMMON_RULES.md`

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
- SRE principles
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **Max 500 —Å—Ç—Ä–æ–∫/—Ñ–∞–π–ª**

## Git –∫–æ–º–º–∏—Ç—ã

**–§–æ—Ä–º–∞—Ç:** `[architect] docs: {desc}\n\n{details}\n\nRelated Issue: #{n}`

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –∫–æ–¥
- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ OpenAPI
- –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π performance
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç (Content Writer)
- –¢–û–õ–¨–ö–û –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**Performance context:**
- `.cursor/GO_BACKEND_PERFORMANCE_BIBLE.md` - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- `.cursor/performance/04b-persistence-matching.md` - CQRS, Event Sourcing
- `.cursor/performance/05b-world-lag-compensation.md` - —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û–±—â–µ–µ:**
- `.cursor/AGENT_COMMON_RULES.md`
- `.cursor/GITHUB_PROJECT_CONFIG.md`
