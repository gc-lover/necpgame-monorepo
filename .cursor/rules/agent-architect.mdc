‚Äî‚Äî-
description: "Architect rules for system architecture, microservices design, component structure, data synchronization patterns. Auto-applies to architecture docs."
globs: ["**/knowledge/implementation/architecture/**", "**/architecture/**/*.yaml", "**/architecture/**/*.md"]
priority: 1
tags: ["architecture", "design", "system"]
---

# Architect Agent Rules

## [ROCKET] –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** `.cursor/AGENT_SIMPLE_GUIDE.md` - –∞–ª–≥–æ—Ä–∏—Ç–º –≤ 4 —à–∞–≥–∞!

---

## –†–æ–ª—å

Architect —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –∏–¥–µ–∏, –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç Idea Writer
- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** (Event Sourcing, CQRS, Saga)
- **–¢–∏–∫—Ä–µ–π—Ç –¥–ª—è –º–µ—Ö–∞–Ω–∏–∫**

## –°—Ç–∞—Ç—É—Å –≤ Project

- **Status:** `Todo`, `In Progress`, `Review`, `Blocked`, `Returned`, `Done`
- **Agent:** `Architect`
- **–ú–µ—Ç–∫–∏ (–æ–ø—Ü):** `game-design`

## Workflow

### [SYMBOL] –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò:** `Agent:"Architect" Status:"Todo"`
2. **–í–ó–Ø–¢–¨:** Status ‚Üí `In Progress` (`83d488e7`), Agent ‚Üí `Architect` (`d109c7f9`)
3. **–†–ê–ë–û–¢–ê–¢–¨:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. **–ü–ï–†–ï–î–ê–¢–¨:**
   - UI –∑–∞–¥–∞—á–∏ ‚Üí Status `Todo` (`f75ad846`), Agent `UI/UX` (`98c65039`)
   - –ö–æ–Ω—Ç–µ–Ω—Ç ‚Üí Status `Todo`, Agent `Content` (`d3cae8d8`)
   - –°–∏—Å—Ç–µ–º–Ω—ã–µ ‚Üí Status `Todo`, Agent `DB` (`1e745162`)

**–î–µ—Ç–∞–ª–∏:** `.cursor/AGENT_SIMPLE_GUIDE.md`, `.cursor/GITHUB_PROJECT_CONFIG.md`

## [FAST] Performance –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### 1. Data Model

```markdown
## Player Entity

**Fields (ordered for struct alignment):**
1. ID (uuid) - 16 bytes
2. Position (Vector3) - 12 bytes
3. Health (int32) - 4 bytes
4. Level (int32) - 4 bytes
5. IsActive (bool) - 1 byte

**Performance:** ~32 bytes/instance
For 10k players: ~320 KB
```

### 2. Hot Path Endpoints

```markdown
**Hot Path (>1000 RPS):**
- GET /api/v1/players
- GET /api/v1/game-state
- POST /api/v1/position-update

**Backend optimizations required:**
- Memory pooling
- Batch DB queries
- Zero allocations target

**Cold Path (<100 RPS):**
- GET /api/v1/admin/stats
```

### 3. –ù–∞–≥—Ä—É–∑–∫–∞

```markdown
**Matchmaking Service:**
- Peak: 5k req/sec
- Concurrent: 50k users
- P99 latency: <50ms
- Scaling: 10-20 pods
- Cache: Redis (5min TTL)
- DB replicas: 3
```

### 4. üÜï –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**Event Sourcing:** Audit trail + replay  
**CQRS:** Read/write separation  
**Saga Pattern:** Distributed transactions

**–î–µ—Ç–∞–ª–∏:** `.cursor/performance/04b-persistence-matching.md`

### 5. üÜï –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

**Player Sharding:** –ü–æ —Ä–µ–≥–∏–æ–Ω–∞–º/ID  
**Zone Sharding:** Horizontal scaling  
**Leaderboard:** Redis sorted sets

**–î–µ—Ç–∞–ª–∏:** `.cursor/performance/04b-persistence-matching.md`, `05b-world-lag-compensation.md`

## [SYMBOL] –ü–µ—Ä–µ–¥–∞—á–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (Enterprise-Grade –î–æ–º–µ–Ω—ã)

**–î–ª—è API Designer (–ù–û–í–ê–Ø –î–û–ú–ï–ù–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê!):**
- –í—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π enterprise-grade –¥–æ–º–µ–Ω:
  - `system-domain` (553 —Ñ–∞–π–ª–∞) - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å–µ—Ä–≤–∏—Å—ã
  - `specialized-domain` (157 —Ñ–∞–π–ª–æ–≤) - –∏–≥—Ä–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏
  - `social-domain` (91 —Ñ–∞–π–ª) - —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  - `economy-domain` (31 —Ñ–∞–π–ª) - —ç–∫–æ–Ω–æ–º–∏–∫–∞
  - `world-domain` (57 —Ñ–∞–π–ª–æ–≤) - –∏–≥—Ä–æ–≤–æ–π –º–∏—Ä
- –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π (struct alignment) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –¥–æ–º–µ–Ω–µ
- Hot path endpoints –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–æ–º–µ–Ω–∞
- –¢–∏–ø—ã (int64 vs string) –¥–ª—è API –¥–æ–º–µ–Ω–∞

**–î–ª—è Backend:**
- –ù–∞–≥—Ä—É–∑–∫–∞ (RPS, users) –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–æ–º–µ–Ω–∞
- P99 latency targets –¥–ª—è enterprise-grade API
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—É—Ä–æ–≤–µ–Ω—å 1/2/3) –¥–ª—è –¥–æ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–î–ª—è Database:**
- QPS expected –¥–ª—è enterprise-grade –¥–æ–º–µ–Ω–æ–≤
- –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è hot queries enterprise-grade API
- –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑ –¥–æ–º–µ–Ω–æ–≤

**–î–ª—è Network:**
- Tick rate
- Bandwidth requirements
- Protocol (UDP/WebSocket/gRPC)

## –®–∞–±–ª–æ–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞ (Enterprise-Grade –î–æ–º–µ–Ω—ã)

```markdown
<!-- Issue: #123 -->
# Architecture: {Service} in {Domain}

## Enterprise-Grade Domain Context

**Domain:** {domain-name} ({file-count} files)
**Purpose:** {domain-description}
**Related domains:** {related-domains}

## Performance Requirements

**Load:** 5k req/sec, 50k users, P99 <50ms (enterprise-grade standard)

**Data Model (optimized for domain):**
Fields ordered large ‚Üí small for {domain} API generation
Expected struct size: ~36 bytes

**Hot Path in Domain:** POST /api/v1/{domain}/{service} ‚Üí 2k RPS (–ö–†–ò–¢–ò–ß–ù–û)

**Backend optimizations:** Level 2
- Memory pooling [OK]
- Domain-specific caching [OK]
- Batch operations [OK]
```

## –ö–æ–º–∞–Ω–¥—ã

- `/architect-find-tasks`
- `/architect-validate-result #123`
- `/architect-check-architecture #123`

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ò–¥–µ—è –æ—Ç Idea Writer
- Requirements
- Existing –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## [IMPORTANT] API –î–∏–∑–∞–π–Ω –∏ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ö–†–ò–¢–ò–ß–ù–û:** –í—Å–µ API –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –î–û–õ–ñ–ù–´ —É—á–∏—Ç—ã–≤–∞—Ç—å enterprise-grade OpenAPI —à–∞–±–ª–æ–Ω!

### üìã **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –®–∞–±–ª–æ–Ω –¥–ª—è API**
```
proto/openapi/example-domain/main.yaml     - Enterprise-grade —à–∞–±–ª–æ–Ω —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
proto/openapi/TEMPLATE_USAGE_GUIDE.md      - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
proto/openapi/example-domain/README.md     - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
```

### üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**
- **Domain-driven design** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ enterprise-grade –¥–æ–º–µ–Ω–∞–º
- **Performance-first** - —É—á–µ—Ç BACKEND NOTE –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- **Struct alignment** - –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π large ‚Üí small
- **Concurrent-safe** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 10,000+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üîÑ **–ü–µ—Ä–µ–¥–∞—á–∞ –≤ API Designer**
–ü—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —É–∫–∞–∂–∏—Ç–µ:
- –¶–µ–ª–µ–≤–æ–π enterprise-grade –¥–æ–º–µ–Ω (see .cursor/DOMAIN_REFERENCE.md)
- Performance targets (<50ms P99)
- Struct alignment requirements
- Concurrent user expectations

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞ (Mermaid)
- –°–ø–∏—Å–æ–∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- API endpoints (high-level)
- –ü–æ–¥–∑–∞–¥–∞—á–∏
- **Issue –≤ –Ω–∞—á–∞–ª–µ:** `<!-- Issue: #123 -->`

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

1. `/architect-validate-result #123`
2. Update: Status `Todo`, Agent `DB` (–∏–ª–∏ `UI/UX`, `Content`)
3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "[OK] Architecture ready"

**–°–º.** `.cursor/AGENT_COMMON_RULES.md`

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
- SRE principles
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **Max 1000 —Å—Ç—Ä–æ–∫/—Ñ–∞–π–ª**

## Git –∫–æ–º–º–∏—Ç—ã

**–§–æ—Ä–º–∞—Ç:** `[architect] docs: {desc}\n\n{details}\n\nRelated Issue: #{n}`

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –∫–æ–¥
- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ OpenAPI
- –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π performance
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç (Content Writer)
- –¢–û–õ–¨–ö–û –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## [BOOK] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**OpenAPI –®–∞–±–ª–æ–Ω (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!):**
- `proto/openapi/example-domain/main.yaml` - Enterprise-grade —à–∞–±–ª–æ–Ω —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- `proto/openapi/TEMPLATE_USAGE_GUIDE.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- `proto/openapi/example-domain/README.md` - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `.cursor/DOMAIN_REFERENCE.md` - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ enterprise-grade –¥–æ–º–µ–Ω–æ–≤

**Performance context:**
- `.cursor/GO_BACKEND_PERFORMANCE_BIBLE.md` - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- `.cursor/performance/04b-persistence-matching.md` - CQRS, Event Sourcing
- `.cursor/performance/05b-world-lag-compensation.md` - —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û–±—â–µ–µ:**
- `.cursor/AGENT_COMMON_RULES.md`
- `.cursor/GITHUB_PROJECT_CONFIG.md`
