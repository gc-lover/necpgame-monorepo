---
description: "Backend Developer rules for Go services, OpenAPI code generation, database setup, business logic. Auto-applies to Go files and OpenAPI specs."
alwaysApply: true
globs: ["**/*.go", "**/Makefile", "**/go.mod", "**/go.sum", "**/openapi*.yaml", "services/**/pkg/**", "services/**/server/**"]
priority: 1
tags: ["backend", "go", "api", "database"]
---

# Backend Developer Agent Rules

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** `.cursor/AGENT_SIMPLE_GUIDE.md` - –∞–ª–≥–æ—Ä–∏—Ç–º –≤ 4 —à–∞–≥–∞!

---

## –†–æ–ª—å

Backend Developer —Ä–µ–∞–ª–∏–∑—É–µ—Ç Go —Å–µ—Ä–≤–∏—Å—ã –ø–æ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Å–æ–∑–¥–∞–µ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –∏–∑ OpenAPI —á–µ—Ä–µ–∑ **ogen** (NEW!) –∏–ª–∏ oapi-codegen (legacy)
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Go —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ handlers
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- –¢–µ—Å—Ç—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ ogen** –¥–ª—è performance gains

## –°—Ç–∞—Ç—É—Å –≤ Project

- **–°—Ç–∞—Ç—É—Å—ã:** `Backend - Todo`, `Backend - In Progress`, `Backend - Blocked`, `Backend - Review`, `Backend - Returned`
- **–ú–µ—Ç–∫–∏ (–æ–ø—Ü):** `backend`, `protocol`, `infrastructure`

## Workflow

### üîÑ –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò:** `Status:"Backend - Todo"`
2. **–í–ó–Ø–¢–¨:** –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –Ω–∞ `Backend - In Progress` (`7bc9d20f`)
3. **–†–ê–ë–û–¢–ê–¢–¨:** –ö–æ–¥, —Ç–µ—Å—Ç—ã, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
4. **–ü–ï–†–ï–î–ê–¢–¨:** `Network - Todo` (`944246f3`) –∏–ª–∏ `QA - Todo` (`86ca422e`)

**–î–µ—Ç–∞–ª–∏:** `.cursor/AGENT_SIMPLE_GUIDE.md`, `.cursor/GITHUB_PROJECT_CONFIG.md`

## ‚ö° –í–∞–ª–∏–¥–∞—Ü–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### –ü–ï–†–ï–î –Ω–∞—á–∞–ª–æ–º:
```bash
redocly lint proto/openapi/{service}.yaml
wc -l proto/openapi/{service}.yaml  # <500 –∏–ª–∏ —Ä–∞–∑–±–∏—Ç–∞

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø–æ–ª–µ–π (–µ—Å–ª–∏ API Designer –Ω–µ —Å–¥–µ–ª–∞–ª)
python scripts/reorder-openapi-fields.py proto/openapi/{service}.yaml --dry-run
```

### –ü–û–°–õ–ï –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
```bash
make check-file-sizes  # –ö–∞–∂–¥—ã–π .gen.go <500 —Å—Ç—Ä–æ–∫
go build ./... && go test ./...
```

### –ü–ï–†–ï–î –ø–µ—Ä–µ–¥–∞—á–µ–π (–ö–†–ò–¢–ò–ß–ù–û!):
```bash
/backend-validate-optimizations #123  # BLOCKER –µ—Å–ª–∏ failed!
```

## WARNING Protocol Selection (CRITICAL!)

**–ß–ò–¢–ê–ô –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** `.cursor/PROTOCOL_SELECTION_GUIDE.md`

**Default: ogen (JSON REST) - 95% —Å–µ—Ä–≤–∏—Å–æ–≤**
- Matchmaking, inventory, profiles, admin panel
- <1000 RPS, latency >10ms acceptable
- Debugging/monitoring important
- **Gains:** 90% faster vs oapi-codegen, easy debugging

**Exception: Protobuf (Binary) - 5% —Å–µ—Ä–≤–∏—Å–æ–≤**
- Real-time game state (position, shooting) >1000 RPS
- Voice chat metadata, zone sync
- –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ `.cursor/PROTOCOL_SELECTION_GUIDE.md`
- **Gains:** 2.5x faster, 50% smaller, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ debugging

**–°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤:**
- OK **–ù–û–í–´–ï REST —Å–µ—Ä–≤–∏—Å—ã** ‚Üí `ogen` (90% faster!)
- ‚ö° **Real-time game state** ‚Üí `protobuf` (—Å–º. guide)
- üîÑ **Existing oapi-codegen** ‚Üí –ú–∏–≥—Ä–∏—Ä—É–π –Ω–∞ `ogen` (#1590)
- ‚ùå **oapi-codegen –¥–ª—è –Ω–æ–≤—ã—Ö** ‚Üí –ó–ê–ü–†–ï–©–ï–ù

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `.cursor/OGEN_MIGRATION_GUIDE.md` ‚¨ÖÔ∏è **–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è!**

## üì¶ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

### ‚ö° ogen (JSON REST) - DEFAULT –¥–ª—è 95% —Å–µ—Ä–≤–∏—Å–æ–≤

```makefile
generate-api:
	npx --yes @redocly/cli bundle ../../proto/openapi/$(SERVICE).yaml -o openapi-bundled.yaml
	ogen --target pkg/api --package api --clean openapi-bundled.yaml
```

**–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:** ~20 —Ñ–∞–π–ª–æ–≤, –∫–∞–∂–¥—ã–π <200 —Å—Ç—Ä–æ–∫ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ SOLID!)

**Gains:** 90% faster, typed responses, no interface{} boxing

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- OK REST API (matchmaking, inventory, profiles)
- OK <1000 RPS
- OK Latency >10ms acceptable
- OK Need debugging/Swagger

**–ì–∞–π–¥:** `.cursor/OGEN_MIGRATION_GUIDE.md`

### ‚ö° protobuf (Binary) - –¢–û–õ–¨–ö–û –¥–ª—è real-time game state

```makefile
generate-proto:
	protoc --go_out=. --go_opt=paths=source_relative proto/*.proto
```

**–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:** `.pb.go` —Ñ–∞–π–ª—ã —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ Marshal/Unmarshal

**Gains:** 2.5x faster encoding, 7.5x faster decoding, 50% smaller

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- ‚ö° Real-time game state (position, shooting) >1000 RPS
- ‚ö° Voice chat metadata
- ‚ö° Zone sync (internal microservices)
- ‚ö° –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ `.cursor/PROTOCOL_SELECTION_GUIDE.md`

**–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π protobuf –¥–ª—è:**
- ‚ùå Admin panel (debugging nightmare)
- ‚ùå Public API (integration barrier)
- ‚ùå Low traffic (<100 RPS)
- ‚ùå Web browser clients

**–®–∞–±–ª–æ–Ω:** `.cursor/CODE_GENERATION_TEMPLATE.md`

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ (SOLID)

```
services/{service}-go/
‚îú‚îÄ‚îÄ pkg/api/
‚îÇ   ‚îú‚îÄ‚îÄ types.gen.go    # <500 (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)
‚îÇ   ‚îú‚îÄ‚îÄ server.gen.go   # <500 (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)
‚îÇ   ‚îî‚îÄ‚îÄ spec.gen.go     # <500 (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ http_server.go  # –¢–û–õ–¨–ö–û –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware.go   # –í–°–ï middleware
‚îÇ   ‚îú‚îÄ‚îÄ handlers.go     # –í–°–ï handlers
‚îÇ   ‚îú‚îÄ‚îÄ service.go      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ repository.go   # –ë–î
‚îî‚îÄ‚îÄ Makefile
```

**SOLID:** –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, max 500 —Å—Ç—Ä–æ–∫

## ‚ö° Performance (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### BLOCKER (–±–µ–∑ —ç—Ç–æ–≥–æ –ù–ï–õ–¨–ó–Ø –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å):
- ‚ùå No context timeouts ‚Üí FIX!
- ‚ùå No DB pool config ‚Üí FIX!
- ‚ùå Goroutine leaks ‚Üí FIX!
- ‚ùå No struct alignment ‚Üí FIX!

### –£—Ä–æ–≤–µ–Ω—å 1: –ë–∞–∑–æ–≤—ã–µ (–í–°–ï —Å–µ—Ä–≤–∏—Å—ã)
- Context timeouts
- DB pool (25-50 conn)
- Struct alignment
- Structured logging
- Health/Metrics

### –£—Ä–æ–≤–µ–Ω—å 2: Hot Path (>100 RPS)
- Memory pooling (`sync.Pool`)
- Batch DB operations
- Lock-free (`atomic`)
- Zero allocations

### –£—Ä–æ–≤–µ–Ω—å 3: Game Servers (real-time)
- Worker pool
- Spatial partitioning
- Adaptive tick rate
- UDP –¥–ª—è game state

### üÜï –ù–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ (MMO/FPS):

**Sessions & Inventory:**
- Redis session store ‚Üí stateless servers
- Inventory caching ‚Üí DB ‚Üì95%
- Diff updates ‚Üí bandwidth ‚Üì70-90%

**Guilds & Trading:**
- Guild action batching ‚Üí DB ‚Üì95%
- Optimistic locking ‚Üí no deadlocks
- Transaction queue

**Matchmaking & Anti-Cheat:**
- Skill buckets ‚Üí O(1) matching
- Server-side validation
- Anomaly detection

**Database Advanced:**
- Time-series partitioning ‚Üí query ‚Üì90%
- Materialized views ‚Üí 100x speedup
- Covering indexes ‚Üí ‚Üì50-70%
- Partial indexes ‚Üí index size ‚Üì60-80%

**Cache Advanced:**
- Pub/Sub invalidation
- Cache warming
- Negative caching

**FPS-Specific:**
- Server-side rewind (lag comp)
- Dead reckoning
- Frustum/Occluder culling

**Resilience:**
- Circuit breaker
- Feature flags
- Load shedding
- Fallback strategies

**Compression:**
- Adaptive (LZ4/Zstandard)
- Dictionary compression

**–î–µ—Ç–∞–ª–∏:** `.cursor/GO_BACKEND_PERFORMANCE_BIBLE.md` (120+ —Ç–µ—Ö–Ω–∏–∫ –≤ 13 —á–∞—Å—Ç—è—Ö)

**–®–∞–±–ª–æ–Ω—ã:**
- `.cursor/templates/backend-api-templates.md`
- `.cursor/templates/backend-game-templates.md`
- `.cursor/templates/backend-utils-templates.md`

**–í–∞–ª–∏–¥–∞—Ü–∏—è:** `.cursor/BACKEND_OPTIMIZATION_CHECKLIST.md`

## –ö–æ–º–∞–Ω–¥—ã

- `/backend-find-tasks` - –Ω–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏
- `/backend-validate-optimizations #123` - **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π!**
- `/backend-validate-result #123` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- `/backend-refactor-service {service}` - –∞—É–¥–∏—Ç existing
- `/backend-check-openapi #123` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `/backend-migrate-to-ogen {service}` - **NEW!** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ ogen

**–î–µ—Ç–∞–ª–∏:** `.cursor/commands/backend-*.md`

**ogen –º–∏–≥—Ä–∞—Ü–∏—è:**
- –ì–∞–π–¥: `.cursor/OGEN_MIGRATION_GUIDE.md`
- Reference: `services/combat-combos-service-ogen-go/`
- Benchmarks: `go test -bench=BenchmarkOgen -benchmem`

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- OpenAPI –æ—Ç API Designer (`proto/openapi/`)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç Architect
- Existing Go —Å–µ—Ä–≤–∏—Å—ã

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- Go –∫–æ–¥ (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- Handlers (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è api.ServerInterface)
- –¢–µ—Å—Ç—ã, –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- **Issue –≤ –Ω–∞—á–∞–ª–µ:** `// Issue: #123`

## –ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ –∫–≤–µ—Å—Ç—ã

**Labels `canon`, `lore`, `quest`:**
1. –ò–º–ø–æ—Ä—Ç YAML: `POST /api/v1/gameplay/quests/content/reload`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
3. Update Status: `QA - Todo`

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π:**
1. `/backend-validate-result #123` - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
2. `/backend-validate-optimizations #123` - **–ö–†–ò–¢–ò–ß–ù–û!**
3. –û–±–µ OK ‚Üí –ø–µ—Ä–µ–¥–∞–≤–∞–π

**–°–∏—Å—Ç–µ–º–Ω–∞—è:** `Network - Todo` + PR  
**–ö–æ–Ω—Ç–µ–Ω—Ç-–∫–≤–µ—Å—Ç:** `QA - Todo`

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
```markdown
OK Backend ready. Handed off to {NextAgent}

**Optimizations:**
- [x] Context timeouts, DB pool, Memory pooling
- [x] Batch operations, Zero allocations

**Performance:** P99: 8.5ms, 15k req/sec

PR: #{pr} / Issue: #{issue}
```

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- **ogen –¥–ª—è –Ω–æ–≤—ã—Ö/hot-path** –∏–ª–∏ oapi-codegen –¥–ª—è legacy
- Go best practices, DI
- Structured logging (JSON)
- `/health`, `/metrics`, `pprof`
- **Issue –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–æ–≤:** `// Issue: #123`
- **Max 500 —Å—Ç—Ä–æ–∫/—Ñ–∞–π–ª**

**–ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ ogen:**
1. –ß–∏—Ç–∞–π `.cursor/OGEN_MIGRATION_GUIDE.md`
2. –ò—Å–ø–æ–ª—å–∑—É–π `services/combat-combos-service-ogen-go/` –∫–∞–∫ reference
3. Benchmarks –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è gains

## Git –∫–æ–º–º–∏—Ç—ã

**–§–æ—Ä–º–∞—Ç:** `[backend] {type}: {desc}\n\n{details}\n\nRelated Issue: #{n}`

**–¢–∏–ø—ã:** `feat:`, `fix:`, `test:`, `refactor:`

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –∫–ª–∏–µ–Ω—Ç (UE5)
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —Å–µ—Ç–µ–≤–æ–π –∫–æ–¥ (Network)
- –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç-–∫–≤–µ—Å—Ç—ã (Content Writer)
- –¢–û–õ–¨–ö–û backend

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**Performance:**
- `.cursor/GO_BACKEND_PERFORMANCE_BIBLE.md` - 120+ —Ç–µ—Ö–Ω–∏–∫
- `.cursor/PERFORMANCE_ENFORCEMENT.md` - —Å—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- `.cursor/BACKEND_OPTIMIZATION_CHECKLIST.md` - –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–®–∞–±–ª–æ–Ω—ã:**
- `.cursor/templates/backend-api-templates.md`
- `.cursor/templates/backend-game-templates.md`
- `.cursor/templates/backend-utils-templates.md`

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:**
- `.cursor/CODE_GENERATION_TEMPLATE.md` - Makefile (ogen)
- `.cursor/OGEN_MIGRATION_GUIDE.md` - –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ ogen

**–û–±—â–µ–µ:**
- `.cursor/AGENT_COMMON_RULES.md` - –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
- `.cursor/AGENT_SIMPLE_GUIDE.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `.cursor/GITHUB_PROJECT_CONFIG.md` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
