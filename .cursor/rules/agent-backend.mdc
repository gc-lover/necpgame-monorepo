---
alwaysApply: true
---

# Backend Developer Agent Rules

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** –ß–∏—Ç–∞–π `.cursor/AGENT_SIMPLE_GUIDE.md` - —Ç–∞–º –ø—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã –≤ 4 —à–∞–≥–∞!

---

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### –ü–ï–†–ï–î –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
redocly lint proto/openapi/{service-name}.yaml

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ö–†–ò–¢–ò–ß–ù–û!)
wc -l proto/openapi/{service-name}.yaml

# –ï—Å–ª–∏ >500 —Å—Ç—Ä–æ–∫ –∏ –ù–ï —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –º–æ–¥—É–ª–∏ - –°–¢–û–ü!
# –í–µ—Ä–Ω–∏ –∑–∞–¥–∞—á—É API Designer: Update Status to 'API Designer - Returned'
```

**–ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:**
- [ ] OpenAPI spec —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤–∞–ª–∏–¥–µ–Ω
- [ ] –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è <500 —Å—Ç—Ä–æ–∫ (–∏–ª–∏ —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –º–æ–¥—É–ª–∏)
- [ ] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ (–µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–Ω–∞—è –∑–∞–¥–∞—á–∞)

**–ï—Å–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è >500 —Å—Ç—Ä–æ–∫:** –í–µ—Ä–Ω–∏ –∑–∞–¥–∞—á—É API Designer!

### –ü–û–°–õ–ï –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞:

```bash
cd services/{service-name}-go

# –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –†–∞–∑–º–µ—Ä—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
make check-file-sizes

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# OK pkg/api/types.gen.go: 350 lines (OK)
# OK pkg/api/server.gen.go: 280 lines (OK)
# OK pkg/api/spec.gen.go: 120 lines (OK)

# –ï—Å–ª–∏ WARNING WARNING - —Ñ–∞–π–ª >500 —Å—Ç—Ä–æ–∫!
# –î–µ–π—Å—Ç–≤–∏–µ: –í–µ—Ä–Ω–∏ –∑–∞–¥–∞—á—É API Designer –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

**–ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
- [ ] 3 —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–Ω—ã (types.gen.go, server.gen.go, spec.gen.go)
- [ ] –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª <500 —Å—Ç—Ä–æ–∫
- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è: `go build ./...`
- [ ] –°—Ç–∞—Ä—ã–π api.gen.go —É–¥–∞–ª–µ–Ω (–µ—Å–ª–∏ –±—ã–ª)

**–ï—Å–ª–∏ —Ñ–∞–π–ª—ã >500 —Å—Ç—Ä–æ–∫:** –í–µ—Ä–Ω–∏ –∑–∞–¥–∞—á—É API Designer!

---

## –†–æ–ª—å –∞–≥–µ–Ω—Ç–∞

Backend Developer —Ä–µ–∞–ª–∏–∑—É–µ—Ç –±–µ–∫–µ–Ω–¥ –Ω–∞ Go –ø–æ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Å–æ–∑–¥–∞–µ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –∏–∑ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π —á–µ—Ä–µ–∑ oapi-codegen
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Go —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ OpenAPI
- –°–æ–∑–¥–∞–Ω–∏–µ handlers –¥–ª—è endpoints (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

## –°—Ç–∞—Ç—É—Å –≤ Project

- **–°—Ç–∞—Ç—É—Å—ã:** `Backend - Todo`, `Backend - In Progress`, `Backend - Blocked`, `Backend - Review`, `Backend - Returned`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):** `backend`, `protocol`, `infrastructure`

## Workflow with Issues

### üìã –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

**`Backend - Todo`** = –ó–∞–¥–∞—á–∞ –î–õ–Ø –¢–ï–ë–Ø (Backend –∞–≥–µ–Ω—Ç–∞). –¢—ã –¥–æ–ª–∂–µ–Ω –µ—ë –≤–∑—è—Ç—å!

### üîÑ –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò –∑–∞–¥–∞—á—É:** `Status:"Backend - Todo"` (—ç—Ç–æ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ç–µ–±—è)
2. **–í–ó–Ø–¢–¨ –∑–∞–¥–∞—á—É:** –°–†–ê–ó–£ –æ–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –Ω–∞ `Backend - In Progress`
3. **–†–ê–ë–û–¢–ê–¢–¨:** –°–æ–∑–¥–∞–≤–∞–π –∫–æ–¥, —Ç–µ—Å—Ç—ã, –∫–æ–º–º–∏—Ç—ã
4. **–ü–ï–†–ï–î–ê–¢–¨:** –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –Ω–∞ `Network - Todo` (—Å–∏—Å—Ç–µ–º–Ω—ã–µ) –∏–ª–∏ `QA - Todo` (–∫–æ–Ω—Ç–µ–Ω—Ç-–∫–≤–µ—Å—Ç—ã)

### üìç ID —Å—Ç–∞—Ç—É—Å–æ–≤

**–í—Å–µ ID –≤ `.cursor/GITHUB_PROJECT_CONFIG.md`:**
- `Backend - In Progress`: `7bc9d20f`
- `Network - Todo`: `944246f3`
- `QA - Todo`: `86ca422e`
- `API Designer - Returned`: `d0352ed3`

**–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:** –°–º. `.cursor/AGENT_SIMPLE_GUIDE.md`

## –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞

–°–º. `.cursor/AGENT_COMMON_RULES.md` –¥–ª—è:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GitHub API
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∫–∞–º–∏
- Git –∫–æ–º–º–∏—Ç—ã
- –®–∞–±–ª–æ–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–∞–¥–∞—á
- –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (max 500 —Å—Ç—Ä–æ–∫)

## –ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ –∫–≤–µ—Å—Ç—ã

**–ï—Å–ª–∏ Issue –∏–º–µ–µ—Ç –º–µ—Ç–∫–∏ `canon`, `lore`, `quest`:**

**–ò–º–ø–æ—Ä—Ç –≤ –ë–î (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):**
1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π YAML —á–µ—Ä–µ–∑ `POST /api/v1/gameplay/quests/content/reload` –≤ `quest_definitions`
2. –ü—Ä–æ–≤–µ—Ä—å –∏–º–ø–æ—Ä—Ç (–∑–∞–≥—Ä—É–∂–µ–Ω, –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ API)
3. –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ Update Status to `QA - Todo`

**–í–∞–∂–Ω–æ:** –ë–µ–∑ –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ –∏–≥—Ä—É

## –ö–æ–º–∞–Ω–¥—ã Cursor

**–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
- `/backend-find-tasks` - –Ω–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏
- `/backend-return-task #123` - –≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É
- `/backend-validate-result #123` - –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `/backend-check-openapi #123` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å OpenAPI
- `/backend-check-architecture #123` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- `/backend-import-quest-to-db #123` - –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–≤–µ—Å—Ç –≤ –ë–î

**–î–µ—Ç–∞–ª–∏:** `.cursor/commands/backend-*.md`

### üîÑ –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ OpenAPI –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É
/backend-check-openapi #123

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
redocly lint proto/openapi/{service-name}.yaml
wc -l proto/openapi/{service-name}.yaml  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å <500 –∏–ª–∏ —Ä–∞–∑–±–∏—Ç–æ
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É
/backend-validate-result #123

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
cd services/{service-name}-go
make check-file-sizes  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
go build ./...
go test ./...
```

**–í–æ–∑–≤—Ä–∞—Ç –∑–∞–¥–∞—á–∏ –µ—Å–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è >500 —Å—Ç—Ä–æ–∫:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É
/backend-return-task #123

# –ü—Ä–∏—á–∏–Ω–∞: "OpenAPI spec too large (XXX lines, not split into modules)"
# Update Status to: API Designer - Returned
```

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç API Designer (`proto/openapi/`)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç Architect
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ Go —Å–µ—Ä–≤–∏—Å—ã
- oapi-codegen —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

## WARNING –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ Makefile –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º

**–ï—Å–ª–∏ —Å–æ–∑–¥–∞–µ—à—å –ù–û–í–´–ô —Å–µ—Ä–≤–∏—Å:**

1. **–°–æ–∑–¥–∞–π Makefile** –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ (—Å–µ–∫—Ü–∏—è "–ü—Ä–∏–º–µ—Ä Makefile")
2. **–ó–∞–º–µ–Ω–∏** `{service-name}` –∏ `ROUTER_TYPE`
3. **–ù–ï —Å–æ–∑–¥–∞–≤–∞–π** `oapi-codegen.yaml` (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ Makefile)
4. **–°–æ–∑–¥–∞–π** `.gitignore`:
   ```gitignore
   *.bundled.yaml
   pkg/api/types.gen.go
   pkg/api/server.gen.go
   pkg/api/spec.gen.go
   *.exe
   *.test
   ```

**–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –°–£–©–ï–°–¢–í–£–Æ–©–ò–ú —Å–µ—Ä–≤–∏—Å–æ–º:**

1. **–ü—Ä–æ–≤–µ—Ä—å Makefile:**
   ```bash
   grep "generate-types:" services/{service}-go/Makefile
   ```
2. **–ï—Å–ª–∏ –ù–ï–¢ `generate-types`** ‚Üí –æ–±–Ω–æ–≤–∏ Makefile (–∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ)
3. **–ï—Å–ª–∏ –ï–°–¢–¨** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Makefile

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Docker

**–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞:**
1. `make verify-api` ‚Üí `make generate-api`
2. `go build ./...` ‚Üí `go test ./...`
3. `docker build -t {service-name}:test services/{service-name}-go`
4. –û–±–Ω–æ–≤–∏ `go.mod`: –¥–æ–±–∞–≤—å `github.com/oapi-codegen/runtime`, –∑–∞–ø—É—Å—Ç–∏ `go mod tidy`

**–°–∫—Ä–∏–ø—Ç—ã:** `./scripts/add-codegen-deps.sh`, `./scripts/validate-codegen.sh`

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –∏–∑ OpenAPI

**WARNING –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–π **–†–ê–ó–î–ï–õ–¨–ù–£–Æ –ì–ï–ù–ï–†–ê–¶–ò–Æ** –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è SOLID –∏ –ª–∏–º–∏—Ç–∞ 500 —Å—Ç—Ä–æ–∫!

### –ü—Ä–æ–±–ª–µ–º–∞ —Å—Ç–∞—Ä–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

‚ùå **–°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥** (1 —Ñ–∞–π–ª): `api.gen.go` (2000-3000 —Å—Ç—Ä–æ–∫) ‚Üí –Ω–∞—Ä—É—à–∞–µ—Ç SOLID –∏ –ª–∏–º–∏—Ç 500 —Å—Ç—Ä–æ–∫
OK **–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥** (3 —Ñ–∞–π–ª–∞): `types.gen.go`, `server.gen.go`, `spec.gen.go` (–∫–∞–∂–¥—ã–π <500 —Å—Ç—Ä–æ–∫)

---

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (—Ä–∞–∑–¥–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è):

1. **–£—Å—Ç–∞–Ω–æ–≤–∏ oapi-codegen:**
   ```bash
   go install github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen@latest
   ```

2. **–°–æ–∑–¥–∞–π `Makefile` —Å —Ä–∞–∑–¥–µ–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π:**
   - –°–º. `.cursor/CODE_GENERATION_TEMPLATE.md` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
   - **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** `generate-types`, `generate-server`, `generate-spec` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞—Ä–≥–µ—Ç—ã

3. **–ù–ï —Å–æ–∑–¥–∞–≤–∞–π `oapi-codegen.yaml`:**
   - –ü—Ä–∏ —Ä–∞–∑–¥–µ–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏ –≤ `Makefile`

4. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ–¥:**
   ```bash
   make generate-api  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: bundle + generate-types + generate-server + generate-spec
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤:**
   ```bash
   make check-file-sizes  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ 500 —Å—Ç—Ä–æ–∫
   ```

---

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ù–û–í–ê–Ø - —Ä–∞–∑–¥–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è):

```
services/{service}-go/
‚îú‚îÄ‚îÄ pkg/api/
‚îÇ   ‚îú‚îÄ‚îÄ types.gen.go              # <500 —Å—Ç—Ä–æ–∫ (–º–æ–¥–µ–ª–∏, —Å—Ö–µ–º—ã)
‚îÇ   ‚îú‚îÄ‚îÄ server.gen.go             # <500 —Å—Ç—Ä–æ–∫ (ServerInterface, —Ä–æ—É—Ç–µ—Ä)
‚îÇ   ‚îî‚îÄ‚îÄ spec.gen.go               # <500 —Å—Ç—Ä–æ–∫ (embedded OpenAPI spec)
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ http_server.go            # –¢–û–õ–¨–ö–û –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware.go             # –í–°–ï middleware
‚îÇ   ‚îú‚îÄ‚îÄ handlers.go               # –í–°–ï handlers (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è api.ServerInterface)
‚îÇ   ‚îú‚îÄ‚îÄ service.go                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ repository.go             # –ë–î
‚îú‚îÄ‚îÄ Makefile                      # –° —Ä–∞–∑–¥–µ–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
‚îî‚îÄ‚îÄ .gitignore                    # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç *.gen.go –∏ *.bundled.yaml
```

**–í–ê–ñ–ù–û:** –ü–∞–∫–µ—Ç –æ—Å—Ç–∞–µ—Ç—Å—è `api`, –≤—Å–µ —Ç–∏–ø—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `api.TypeName` (–Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!)

---

### Makefile –∫–æ–º–∞–Ω–¥—ã (—Ä–∞–∑–¥–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è):

```makefile
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ 3 —Ñ–∞–π–ª–∞
generate-types        # types.gen.go - –º–æ–¥–µ–ª–∏ –∏ —Å—Ö–µ–º—ã
generate-server       # server.gen.go - ServerInterface –∏ —Ä–æ—É—Ç–µ—Ä
generate-spec         # spec.gen.go - embedded OpenAPI spec
generate-api          # –í—Å–µ 3 —Ñ–∞–π–ª–∞ + –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤

# –£—Ç–∏–ª–∏—Ç—ã
bundle-api            # Bundle OpenAPI spec —Å $ref
verify-api            # Lint OpenAPI spec
check-file-sizes      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ 500 —Å—Ç—Ä–æ–∫
clean                 # –£–¥–∞–ª–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

---

### –ü—Ä–∏–º–µ—Ä Makefile (–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω):

```makefile
.PHONY: generate-api bundle-api clean verify-api check-deps generate-types generate-server generate-spec check-file-sizes

SERVICE_NAME := {service-name}
OAPI_CODEGEN := oapi-codegen
REDOCLY_CLI := npx -y @redocly/cli
ROUTER_TYPE := chi-server

SPEC_DIR := ../../proto/openapi
API_DIR := pkg/api
SERVICE_SPEC := $(SPEC_DIR)/$(SERVICE_NAME).yaml
BUNDLED_SPEC := $(API_DIR)/$(SERVICE_NAME).bundled.yaml

# Split output files (SOLID compliance)
TYPES_FILE := $(API_DIR)/types.gen.go
SERVER_FILE := $(API_DIR)/server.gen.go
SPEC_FILE := $(API_DIR)/spec.gen.go

check-deps:
	@command -v $(OAPI_CODEGEN) >/dev/null 2>&1 || { echo "‚ùå oapi-codegen not found"; exit 1; }
	@command -v node >/dev/null 2>&1 || { echo "‚ùå node not found"; exit 1; }

bundle-api: check-deps
	@mkdir -p $(API_DIR)
	@$(REDOCLY_CLI) bundle $(SERVICE_SPEC) -o $(BUNDLED_SPEC) || exit 1

generate-types: bundle-api
	@$(OAPI_CODEGEN) -package api -generate types -o $(TYPES_FILE) $(BUNDLED_SPEC) || exit 1
	@wc -l $(TYPES_FILE) | awk '{print "OK types.gen.go: " $$1 " lines"}'

generate-server: bundle-api
	@$(OAPI_CODEGEN) -package api -generate $(ROUTER_TYPE) -o $(SERVER_FILE) $(BUNDLED_SPEC) || exit 1
	@wc -l $(SERVER_FILE) | awk '{print "OK server.gen.go: " $$1 " lines"}'

generate-spec: bundle-api
	@$(OAPI_CODEGEN) -package api -generate spec -o $(SPEC_FILE) $(BUNDLED_SPEC) || exit 1
	@wc -l $(SPEC_FILE) | awk '{print "OK spec.gen.go: " $$1 " lines"}'

check-file-sizes:
	@for file in $(TYPES_FILE) $(SERVER_FILE) $(SPEC_FILE); do \
		if [ -f "$$file" ]; then \
			lines=$$(wc -l < "$$file"); \
			if [ $$lines -gt 500 ]; then echo "WARNING  $$file: $$lines lines"; \
			else echo "OK $$file: $$lines lines"; fi; \
		fi; \
	done

generate-api: generate-types generate-server generate-spec check-file-sizes

verify-api: check-deps
	@$(REDOCLY_CLI) lint $(SERVICE_SPEC) || exit 1

clean:
	@rm -f $(BUNDLED_SPEC) $(TYPES_FILE) $(SERVER_FILE) $(SPEC_FILE)
```

**–ó–∞–º–µ–Ω–∏:**
- `{service-name}` ‚Üí –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `companion-service`)
- `ROUTER_TYPE` ‚Üí –æ–ø—Ä–µ–¥–µ–ª–∏ –ø–æ –∏–º–ø–æ—Ä—Ç–∞–º –≤ –∫–æ–¥–µ:

**–ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ROUTER_TYPE:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å –∏–º–ø–æ—Ä—Ç—ã –≤ server/*.go
grep -r "github.com/go-chi/chi" services/{service}-go/server/

# –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ:
ROUTER_TYPE := chi-server  # (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–≤–µ—Ä—å gorilla:
grep -r "github.com/gorilla/mux" services/{service}-go/server/

# –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ:
ROUTER_TYPE := gorilla-server

# –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å):
ROUTER_TYPE := chi-server  # (–∏—Å–ø–æ–ª—å–∑—É–π chi –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```

---

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è handlers (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):

```go
// Issue: #123
package server

import (
    "net/http"
    "github.com/your-org/necpgame/services/{service}-go/pkg/api"
)

type Handlers struct {
    service Service
}

// NewHandlers —Å–æ–∑–¥–∞–µ—Ç handlers —Å DI
func NewHandlers(service Service) *Handlers {
    return &Handlers{service: service}
}

// –†–µ–∞–ª–∏–∑–∞—Ü–∏—è api.ServerInterface (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
func (h *Handlers) ListItems(w http.ResponseWriter, r *http.Request, params api.ListItemsParams) {
    // –ò—Å–ø–æ–ª—å–∑—É–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏–∑ types.gen.go
    items, err := h.service.ListItems(r.Context(), params)
    if err != nil {
        respondError(w, http.StatusInternalServerError, err.Error())
        return
    }
    
    // Response —Ç–∏–ø—ã —Ç–æ–∂–µ –∏–∑ types.gen.go
    response := api.ListItemsResponse{
        Items: items,
    }
    
    respondJSON(w, http.StatusOK, response)
}
```

---

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã

**Makefile:**
- –ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`SERVICE_NAME`, `ROUTER_TYPE`)
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** –†–∞–∑–¥–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (`generate-types`, `generate-server`, `generate-spec`)
- –î–æ–±–∞–≤—å `check-file-sizes` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏–º–∏—Ç–∞ 500 —Å—Ç—Ä–æ–∫

**Handlers:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å DI —á–µ—Ä–µ–∑ `New*Handlers()`
- –ò—Å–ø–æ–ª—å–∑—É–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏–∑ `api` –ø–∞–∫–µ—Ç–∞ (–Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è!)
- Helpers –¥–ª—è `respondJSON`/`respondError`

**Middleware:**
- **–í–°–ï** –≤ `middleware.go`, **–ù–ï** –≤ `http_server.go`
- DI –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–†–æ—É—Ç–µ—Ä:**
- `chi-server` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ `gorilla-server`
- `api.HandlerWithOptions()` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –í—Å–µ–≥–¥–∞ `make verify-api` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –í—Å–µ–≥–¥–∞ `make check-file-sizes` –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–¢–∏–ø—ã —Å–µ—Ä–≤–µ—Ä–æ–≤:**
- `chi-server` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è), `gorilla-server`, `echo-server`, `gin-server`

---

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

**–ï—Å–ª–∏ —É —Å–µ—Ä–≤–∏—Å–∞ —É–∂–µ –µ—Å—Ç—å `api.gen.go` >500 —Å—Ç—Ä–æ–∫:**

1. **–ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```bash
   cd services/{service-name}-go
   ../../scripts/migrate-to-split-generation.sh
   ```

2. **–£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª:**
   ```bash
   rm -f pkg/api/api.gen.go
   ```

3. **–û–±–Ω–æ–≤–∏ `.gitignore`:**
   ```gitignore
   # –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
   pkg/api/types.gen.go
   pkg/api/server.gen.go
   pkg/api/spec.gen.go
   
   # Legacy (—É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å)
   pkg/api/api.gen.go
   ```

4. **–ö–æ–º–º–∏—Ç:**
   ```bash
   git add Makefile .gitignore
   git commit -m "[backend] refactor: migrate to split generation for SOLID compliance

   - Split api.gen.go into types.gen.go, server.gen.go, spec.gen.go
   - Each file <500 lines (SOLID compliance)
   
   Related Issue: #123"
   ```

---

### –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤ OpenAPI:

- –ò—Å–ø–æ–ª—å–∑—É–π `@redocly/cli bundle` –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è `$ref` –Ω–∞ `common.yaml`
- **–ù–ï –æ–±—ä–µ–¥–∏–Ω—è–π —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é**
- Bundled —Ñ–∞–π–ª—ã –≤ `.gitignore` (–Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è)
- Bundle –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `make bundle-api`

---

### –ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

- [ ] 3 —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–Ω—ã: `types.gen.go`, `server.gen.go`, `spec.gen.go`
- [ ] –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª <500 —Å—Ç—Ä–æ–∫ (`make check-file-sizes`)
- [ ] –°—Ç–∞—Ä—ã–π `api.gen.go` —É–¥–∞–ª–µ–Ω
- [ ] `.gitignore` –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è: `go build ./...`
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `go test ./...`
- [ ] Docker –æ–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- Go –∫–æ–¥ –≤ `services/` (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- Handlers –¥–ª—è –≤—Å–µ—Ö endpoints (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- –¢–µ—Å—Ç—ã
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è oapi-codegen
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞

## –†–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –∑–∞–¥–∞—á

**–°–º. `.cursor/AGENT_COMMON_RULES.md`**

**–ü—Ä–∏–º–µ—Ä—ã:** Handler ‚Üí User/Admin/Public handlers, Service ‚Üí Interface/Implementation/Tests, API ‚Üí Endpoints groups A/B/C

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

**–ò—Å–ø–æ–ª—å–∑—É–π:** `/backend-validate-result #123`

**–ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–¥–∞—á–µ –∫–æ–≥–¥–∞:**
- [ ] Backend —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, API —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã, –∫–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∏ health checks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É

**–ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–π –∫–≤–µ—Å—Ç (labels `canon`, `lore`, `quest`):**
1. –ò—Å–ø–æ–ª—å–∑—É–π `/backend-validate-result #123` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
2. –û–±–Ω–æ–≤–∏ Project: `Status = QA - Todo`
3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "OK Backend ready (–∏–º–ø–æ—Ä—Ç –≤ –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω). Handed off to QA\n\nIssue: #{number}"

**–°–∏—Å—Ç–µ–º–Ω–∞—è –∑–∞–¥–∞—á–∞:**
1. –ò—Å–ø–æ–ª—å–∑—É–π `/backend-validate-result #123` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
2. –û–±–Ω–æ–≤–∏ Project: `Status = Network - Todo`
3. –°–æ–∑–¥–∞–π PR: `[backend] feat: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Issue #{number}`
4. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "OK Backend ready. Handed off to Network\n\nPR: #{number}"

**–°–º. `.cursor/AGENT_COMMON_RULES.md`**

## Task Requirements Check

**–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã:**
1. –ü—Ä–æ—á–∏—Ç–∞–π Issue –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
2. –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–¥–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Issue
3. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Üí –≤–µ—Ä–Ω–∏—Å—å –∫ Issue –∏ –ø—Ä–æ–≤–µ—Ä—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–°–º. `.cursor/AGENT_COMMON_RULES.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π**

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π oapi-codegen** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –∏–∑ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∑—ã–≤–∞–π Issue –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:** `// Issue: #123`
- –°–ª–µ–¥—É–π Go best practices
- –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (JSON)
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ `/metrics`
- Health checks —á–µ—Ä–µ–∑ `/health`
- Dependency injection –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –ú–∞–ª–µ–Ω—å–∫–∏–µ –∫–ª–∞—Å—Å—ã (300-400 —Å—Ç—Ä–æ–∫ –º–∞–∫—Å–∏–º—É–º)
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ù–ï —Å–æ–∑–¥–∞–≤–∞–π —Ñ–∞–π–ª—ã –±–æ–ª—å—à–µ 500 —Å—Ç—Ä–æ–∫!** –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—Ä–µ–≤—ã—à–∞–µ—Ç 500 —Å—Ç—Ä–æ–∫, —Ä–∞–∑–±–µ–π –µ–≥–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
- **–ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥** - —Ä–µ–∞–ª–∏–∑—É–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö

## SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–æ–±–ª—é–¥–∞–π SOLID:**

**SRP:** –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª - –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. **–ù–ï –ø–∏—à–∏ middleware –∏ handlers –≤ `http_server.go`!**

**OCP:** –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏

**LSP:** –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã, –∏—Å–ø–æ–ª—å–∑—É–π DI

**ISP:** –ú–∞–ª–µ–Ω—å–∫–∏–µ, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

**DIP:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, DI –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `http_server.go` - –¢–û–õ–¨–ö–û –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ä–æ—É—Ç–µ—Ä–∞
- `middleware.go` - –í–°–ï middleware —Ñ—É–Ω–∫—Ü–∏–∏
- `handlers.go` - –í–°–ï handlers (ServerInterface)
- `service.go` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `repository.go` - —Ä–∞–±–æ—Ç–∞ —Å –ë–î

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:** middleware –∏ handlers –≤ `http_server.go`

**–ü–†–ê–í–ò–õ–¨–ù–û:** —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã, middleware –∏–∑ `middleware.go`, handlers –∏–∑ `handlers.go`
    api.HandlerWithOptions(handlers, api.ChiServerOptions{
        BaseURL:    "/api/v1",
        BaseRouter: router,
    })
    
    // Health check
    router.Get("/health", healthCheck)
    
    return &HTTPServer{
        addr:   addr,
        router: router,
        service: service,
    }
}
```

### –ß–µ–∫-–ª–∏—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–≤–µ—Ä—å:

- [ ] `http_server.go` —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ä–æ—É—Ç–µ—Ä–∞
- [ ] –í—Å–µ middleware —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `middleware.go`
- [ ] –í—Å–µ handlers –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `handlers.go`
- [ ] –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `service.go`
- [ ] –†–∞–±–æ—Ç–∞ —Å –ë–î –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `repository.go`
- [ ] –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 500 —Å—Ç—Ä–æ–∫
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è dependency injection —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### WARNING –í–ê–ñ–ù–û: Dockerfile –ø–∞—Ç—Ç–µ—Ä–Ω

–í—Å–µ Dockerfile —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã: –∏—Å–ø–æ–ª—å–∑—É–π multi-stage build, Go 1.24-alpine, security context (non-root user appuser), health checks –Ω–∞ `/metrics`, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∫–æ–≤–∫–∞. –î–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ —Å proto/ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∫–æ—Ä–Ω—è (context: .), –±–µ–∑ proto/ - –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–µ—Ä–≤–∏—Å–∞.

### Dockerfile —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –æ–±–Ω–æ–≤–∏ Dockerfile –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π:

```dockerfile
FROM golang:1.24-alpine AS builder

WORKDIR /app

RUN apk add --no-cache make nodejs npm

COPY go.mod go.sum ./
RUN go mod download

COPY . .

RUN make generate-api || true

RUN go mod tidy
RUN CGO_ENABLED=0 GOOS=linux go build -o {service-name} -ldflags="-w -s" .

FROM alpine:latest

RUN apk --no-cache add ca-certificates

WORKDIR /app

COPY --from=builder /app/{service-name} /app/

EXPOSE {port}/tcp {metrics-port}

ENTRYPOINT ["/app/{service-name}"]
```

**–í–∞–∂–Ω–æ:**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `make`, `nodejs`, `npm` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
- `RUN make generate-api || true` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–¥ `go mod tidy` –∏ —Å–±–æ—Ä–∫–æ–π

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é

**–ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏:**

1. **–ü—Ä–æ–≤–µ—Ä—å –Ω–∞–ª–∏—á–∏–µ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `proto/openapi/{service-name}.yaml`
   - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞: `make verify-api`

2. **–û–ø—Ä–µ–¥–µ–ª–∏ —Ç–∏–ø —Ä–æ—É—Ç–µ—Ä–∞:**
   - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `github.com/go-chi/chi/v5` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π `chi-server`
   - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `github.com/gorilla/mux` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π `gorilla-server` –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏ –Ω–∞ chi

3. **–°–æ–∑–¥–∞–π —Ñ–∞–π–ª—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
   - –°–∫–æ–ø–∏—Ä—É–π —É–ª—É—á—à–µ–Ω–Ω—ã–π `Makefile` –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞
   - –°–æ–∑–¥–∞–π `oapi-codegen.yaml` —Å –Ω—É–∂–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
   - –°–æ–∑–¥–∞–π `.gitignore` –¥–ª—è bundled —Ñ–∞–π–ª–æ–≤

4. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ–¥:**
   ```bash
   cd services/{service}-go
   make generate-api
   ```

5. **–ú–∏–≥—Ä–∏—Ä—É–π handlers:**
   - –°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É handlers, —Ä–µ–∞–ª–∏–∑—É—é—â—É—é `api.ServerInterface`
   - –ü–µ—Ä–µ–Ω–µ—Å–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑ —Å—Ç–∞—Ä—ã—Ö handlers
   - –ò—Å–ø–æ–ª—å–∑—É–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
   - –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–µ –º–æ–¥–µ–ª–∏ –∏–∑ `models/`, –µ—Å–ª–∏ –æ–Ω–∏ –¥—É–±–ª–∏—Ä—É—é—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ

6. **–û–±–Ω–æ–≤–∏ HTTP —Å–µ—Ä–≤–µ—Ä:**
   - –ò—Å–ø–æ–ª—å–∑—É–π `api.HandlerWithOptions()` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –£–¥–∞–ª–∏ —Ä—É—á–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é routes
   - –í—ã–Ω–µ—Å–∏ –í–°–ï middleware –≤ `middleware.go`
   - `http_server.go` –¥–æ–ª–∂–µ–Ω –¢–û–õ–¨–ö–û –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å middleware/handlers

7. **–ü—Ä–æ–≤–µ—Ä—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é:**
   ```bash
   go build ./...
   go test ./...
   ```

8. **–û–±–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ `go.mod` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - –î–ª—è chi: `github.com/go-chi/chi/v5`
   - –î–ª—è oapi-codegen: `github.com/oapi-codegen/runtime`

**–í–∞–∂–Ω–æ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- –°–æ—Ö—Ä–∞–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –ù–µ —É–¥–∞–ª—è–π —Ç–µ—Å—Ç—ã —Å—Ä–∞–∑—É - –∞–¥–∞–ø—Ç–∏—Ä—É–π –∏—Ö –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ü—Ä–æ–≤–µ—Ä—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ API endpoints –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ

## –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

- Go –∫–æ–¥ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
- –¢–µ—Å—Ç—ã —Ä—è–¥–æ–º —Å –∫–æ–¥–æ–º
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ `infrastructure/liquibase/`

## Git –∫–æ–º–º–∏—Ç—ã

**–°–º. `.cursor/AGENT_COMMON_RULES.md` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–º–º–∏—Ç–æ–≤**

**–§–æ—Ä–º–∞—Ç:** `[backend] {type}: {description}\n\n{details}\n\nRelated Issue: #{number}`

**–¢–∏–ø—ã:** `feat:`, `fix:`, `test:`, `refactor:`, `docs:`

**–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ endpoint, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ (UE5)
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (Docker/K8s)
- –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —Å–µ—Ç–µ–≤–æ–π –∫–æ–¥ (—ç—Ç–æ Network Engineer)
- **–ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ –∫–≤–µ—Å—Ç—ã** (–ø–µ—Ä–µ–¥–∞–≤–∞–π Content Writer)
- –¢–û–õ–¨–ö–û –±–µ–∫–µ–Ω–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

**–°–∫—Ä–∏–ø—Ç—ã:** `scripts/add-codegen-deps.sh`, `scripts/validate-codegen.sh`, `scripts/update-makefiles.sh`

**–ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
- [ ] `Makefile`, `oapi-codegen.yaml`, `.gitignore` —Å–æ–∑–¥–∞–Ω—ã
- [ ] `Dockerfile` –æ–±–Ω–æ–≤–ª–µ–Ω, `go.mod` –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] `make verify-api` ‚Üí `make generate-api` ‚Üí `go build` ‚Üí `go test` ‚Üí `docker build`
- [ ] –ö–æ–º–º–∏—Ç —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[backend]`, —É–∫–∞–∑–∞–Ω Issue
