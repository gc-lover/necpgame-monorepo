---
alwaysApply: true
---

# DevOps/Infrastructure Agent Rules

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** `.cursor/AGENT_SIMPLE_GUIDE.md` - –∞–ª–≥–æ—Ä–∏—Ç–º –≤ 4 —à–∞–≥–∞!

---

## –†–æ–ª—å

DevOps –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ Docker, Kubernetes, –¥–µ–ø–ª–æ–π, CI/CD, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É, observability (Grafana, Prometheus, Loki, Tempo).

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- Docker –æ–±—Ä–∞–∑—ã (multi-stage)
- K8s –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –≤ `k8s/`
- CI/CD workflows
- Liquibase –º–∏–≥—Ä–∞—Ü–∏–∏
- **Observability:** Grafana, Prometheus, Loki, Tempo
- –ê–ª–µ—Ä—Ç—ã, –º–µ—Ç—Ä–∏–∫–∏, —Ç—Ä–µ–π—Å–∏–Ω–≥

## –°—Ç–∞—Ç—É—Å –≤ Project

- **–°—Ç–∞—Ç—É—Å—ã:** `DevOps - Todo`, `DevOps - In Progress`, `DevOps - Blocked`, `DevOps - Review`, `DevOps - Returned`
- **–ú–µ—Ç–∫–∏ (–æ–ø—Ü):** `infrastructure`

## Workflow

### üîÑ –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò:** `Status:"DevOps - Todo"`
2. **–í–ó–Ø–¢–¨:** –û–±–Ω–æ–≤–∏ –Ω–∞ `DevOps - In Progress` (`f5a718a4`)
3. **–†–ê–ë–û–¢–ê–¢–¨:** Docker, K8s, CI/CD, observability
4. **–ü–ï–†–ï–î–ê–¢–¨:** `UE5 - Todo` (`fa5905fb`)

**–î–µ—Ç–∞–ª–∏:** `.cursor/AGENT_SIMPLE_GUIDE.md`, `.cursor/GITHUB_PROJECT_CONFIG.md`

## ‚ö° K8s –¥–ª—è MMOFPS (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### 1. Resources (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã)

```yaml
resources:
  requests:
    memory: "512Mi"
    cpu: "500m"
  limits:
    memory: "2Gi"
    cpu: "2000m"
```

### 2. HPA (Auto-scaling)

```yaml
minReplicas: 3
maxReplicas: 20
metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        averageUtilization: 70
```

### 3. PDB (Availability)

```yaml
spec:
  minAvailable: 80%  # –ú–∏–Ω–∏–º—É–º 80% pods
```

### 4. Probes (Health checks)

```yaml
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  periodSeconds: 5

startupProbe:  # –î–ª—è –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
  failureThreshold: 30
```

### 5. üÜï Affinity (Optimal placement)

```yaml
affinity:
  podAntiAffinity:  # –†–∞–∑–Ω—ã–µ –Ω–æ–¥—ã
    preferredDuringSchedulingIgnoredDuringExecution:
    - podAffinityTerm:
        labelSelector:
          matchLabels:
            app: game-server
        topologyKey: kubernetes.io/hostname
  
  nodeAffinity:  # –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –Ω–æ–¥—ã
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: node-type
          operator: In
          values: [game-server]
```

## üìä Observability (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### 1. Prometheus Metrics

```yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
spec:
  endpoints:
  - port: metrics
    interval: 15s
    path: /metrics
```

**Game-specific metrics:**
- `game_server_player_count`
- `game_server_tick_duration_seconds`
- `game_server_network_bytes_sent/received`
- `game_server_match_duration_seconds`

### 2. Grafana Dashboards

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- Game Server Overview
- Network Performance
- Database Performance
- Application Metrics

### 3. Alerting

```yaml
rules:
- alert: HighGameServerLatency
  expr: histogram_quantile(0.99, tick_duration_seconds) > 0.05
  for: 5m
  
- alert: GameServerDown
  expr: up{job="game-server"} == 0
  for: 1m
  severity: critical
```

### 4. üÜï Structured Logging (Loki)

```yaml
scrape_configs:
- job_name: kubernetes-pods
  kubernetes_sd_configs:
  - role: pod
  relabel_configs:
  - source_labels: [__meta_kubernetes_pod_label_app]
    target_label: app
```

## üê≥ Docker Patterns

**–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã:**
- Go 1.24-alpine
- Multi-stage build
- Non-root user (appuser)
- Health checks
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∫–æ–≤–∫–∞

```dockerfile
FROM golang:1.24-alpine AS builder
RUN apk add --no-cache make nodejs npm
COPY . .
RUN make generate-api || true
RUN CGO_ENABLED=0 go build -ldflags="-w -s" .

FROM alpine:latest
RUN apk --no-cache add ca-certificates
COPY --from=builder /app/{service} /app/
ENTRYPOINT ["/app/{service}"]
```

## –ö–æ–º–∞–Ω–¥—ã

- `/devops-find-tasks`
- `/devops-validate-result #123`

**–î–µ—Ç–∞–ª–∏:** `.cursor/commands/devops-*.md`

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ì–æ—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- K8s requirements
- Monitoring requirements

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- Dockerfile –≤ `infrastructure/docker/`
- K8s –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –≤ `k8s/`
- GitHub Actions
- Observability config –≤ `infrastructure/observability/`
- **Issue –≤ –Ω–∞—á–∞–ª–µ:** `# Issue: #123`

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

1. `/devops-validate-result #123`
2. Update: `UE5 - Todo`
3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ health checks
- –†–µ—Å—É—Ä—Å—ã –≤ K8s
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è
- Structured logging (JSON)
- **Max 500 —Å—Ç—Ä–æ–∫/—Ñ–∞–π–ª**

## Git –∫–æ–º–º–∏—Ç—ã

**–§–æ—Ä–º–∞—Ç:** `[devops] chore: {desc}\n\n{details}\n\nRelated Issue: #{n}`

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –∫–æ–¥ (Performance)
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π —Å–µ—Ç—å (Network)
- –¢–û–õ–¨–ö–û –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**K8s & Observability:**
- –ü—Ä–∏–º–µ—Ä—ã –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –∞–≥–µ–Ω—Ç–æ–≤ (k8s –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã)

**–û–±—â–µ–µ:**
- `.cursor/AGENT_COMMON_RULES.md`
- `.cursor/GITHUB_PROJECT_CONFIG.md`
