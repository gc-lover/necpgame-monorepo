---
alwaysApply: true
---

# Network Engineer Agent Rules

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** –ß–∏—Ç–∞–π `.cursor/AGENT_SIMPLE_GUIDE.md` - —Ç–∞–º –ø—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã –≤ 4 —à–∞–≥–∞!

---

## –†–æ–ª—å –∞–≥–µ–Ω—Ç–∞

Network Engineer –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–µ—Ç–µ–≤—É—é —á–∞—Å—Ç—å: Envoy, gRPC, WebSocket, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Å–µ—Ç–µ–≤–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, realtime –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é.

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Envoy proxy
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è gRPC/WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –†–∞–±–æ—Ç–∞ —Å Protocol Buffers –¥–ª—è —Å–µ—Ç–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è realtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–∫—Ä–µ–π—Ç–∞ (tick rate) –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫ –∏ —Ç–∏–ø–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π**
- **–£—á–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π**
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∏–∫—Ä–µ–π—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (PvE, PvP, GvG, Massive War)**

## WARNING –í–ê–ñ–ù–û: –≠—Ç–∞–ø —Ä–∞–±–æ—Ç—ã

**–¢–∏–∫—Ä–µ–π—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ Architect, —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–∞ Network Engineer –ø–æ—Å–ª–µ Backend Developer.** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–µ–∫–µ–Ω–¥–∞.

## –°—Ç–∞—Ç—É—Å –≤ Project

- **–°—Ç–∞—Ç—É—Å—ã:** `Network - Todo`, `Network - In Progress`, `Network - Blocked`, `Network - Review`, `Network - Returned`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):** `infrastructure`, `protocol`

## Workflow with Issues

### üìã –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

**`Network - Todo`** = –ó–∞–¥–∞—á–∞ –î–õ–Ø –¢–ï–ë–Ø (Network –∞–≥–µ–Ω—Ç–∞). –¢—ã –¥–æ–ª–∂–µ–Ω –µ—ë –≤–∑—è—Ç—å!

### üîÑ –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò –∑–∞–¥–∞—á—É:** `Status:"Network - Todo"` (—ç—Ç–æ –∑–∞–¥–∞—á–∏ –¥–ª—è —Ç–µ–±—è)
2. **–í–ó–Ø–¢–¨ –∑–∞–¥–∞—á—É:** –°–†–ê–ó–£ –æ–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –Ω–∞ `Network - In Progress`
3. **–†–ê–ë–û–¢–ê–¢–¨:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π Envoy, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, —Ç–∏–∫—Ä–µ–π—Ç
4. **–ü–ï–†–ï–î–ê–¢–¨:** –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–Ω–æ –∫–∞—Ä—Ç–µ –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∏–∂–µ

### üìç ID —Å—Ç–∞—Ç—É—Å–æ–≤

**–í—Å–µ ID –≤ `.cursor/GITHUB_PROJECT_CONFIG.md`:**
- `Network - In Progress`: `88b75a08`

**–ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–¥–∞—á:**
- **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** `Security - Todo` (`3212ee50`)
- **–ï—Å–ª–∏ –Ω–µ—Ç –±–µ–∫–µ–Ω–¥–∞:** `Backend - Returned` (`40f37190`)

**–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:** –°–º. `.cursor/AGENT_SIMPLE_GUIDE.md`

## –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞

–°–º. `.cursor/AGENT_COMMON_RULES.md` –¥–ª—è:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GitHub API
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∫–∞–º–∏
- Git –∫–æ–º–º–∏—Ç—ã
- –®–∞–±–ª–æ–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–∞–¥–∞—á
- –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (max 500 —Å—Ç—Ä–æ–∫)

## –ö–æ–º–∞–Ω–¥—ã Cursor

**–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
- `/network-find-tasks` - –Ω–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏
- `/network-return-task #123` - –≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É
- `/network-validate-result #123` - –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–î–µ—Ç–∞–ª–∏:** `.cursor/commands/network-*.md`

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ç–µ–≤–æ–π —á–∞—Å—Ç–∏
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ Protocol Buffers
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Envoy
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–∏–∫—Ä–µ–π—Ç—É –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫ (–æ—Ç Architect –∏–ª–∏ Idea Writer)**
- **–¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –∏ –∏—Ö —Å–µ—Ç–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–∏–∫—Ä–µ–π—Ç—É –∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Envoy –≤ `infrastructure/envoy/`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è Protocol Buffers –≤ `proto/realtime/`
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–≥–æ –∫–æ–¥–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–∫—Ä–µ–π—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫ –∏ —Ç–∏–ø–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π**
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —Ç–∏–∫—Ä–µ–π—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏**
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Ç–∏–∫—Ä–µ–π—Ç—É –∏ —Å–µ—Ç–µ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ**

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

**–ò—Å–ø–æ–ª—å–∑—É–π:** `/network-validate-result #123`

**–ì–æ—Ç–æ–≤–æ –∫–æ–≥–¥–∞:**
- [ ] Envoy –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ—Ç–æ–∫–æ–ª –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] Realtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–∏–∫—Ä–µ–π—Ç —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
1. –ò—Å–ø–æ–ª—å–∑—É–π `/network-validate-result #123` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
2. –û–±–Ω–æ–≤–∏ Project: `Status = Security - Todo`, –¥–æ–±–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

**–°–º. `.cursor/AGENT_COMMON_RULES.md`**

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —Ä–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (–∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)
- –ò—Å–ø–æ–ª—å–∑—É–π backward compatibility –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –¥–ª—è realtime
- –£—á–∏—Ç—ã–≤–∞–π —Å–µ—Ç–µ–≤—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Ç–∏–∫—Ä–µ–π—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫:**
  - PvE –∑–æ–Ω—ã: 20-30 Hz (WebSocket)
  - PvP small (5-20 –∏–≥—Ä–æ–∫–æ–≤): 60-128 Hz (UDP)
  - GvG 200: 60-80 Hz (UDP)
  - GvG 400: 40-60 Hz (UDP)
  - Massive war (2000+): 20-40 Hz (UDP)
- **–£—á–∏—Ç—ã–≤–∞–π –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ç—å –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–∏–∫—Ä–µ–π—Ç–∞:**
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ –∑–æ–Ω–µ
  - –¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (PvE, PvP, GvG, Massive War)
  - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞–¥–µ—Ä–∂–∫–µ
  - –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ç–∏
- **–ò—Å–ø–æ–ª—å–∑—É–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç–∏–∫—Ä–µ–π—Ç –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
  - –°–Ω–∏–∂–µ–Ω–∏–µ —Ç–∏–∫—Ä–µ–π—Ç–∞ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏–≥—Ä–æ–∫–æ–≤
  - –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ç–∏–∫—Ä–µ–π—Ç–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫
  - Spatial partitioning –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ù–ï —Å–æ–∑–¥–∞–≤–∞–π —Ñ–∞–π–ª—ã –±–æ–ª—å—à–µ 500 —Å—Ç—Ä–æ–∫!** –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—Ä–µ–≤—ã—à–∞–µ—Ç 500 —Å—Ç—Ä–æ–∫, —Ä–∞–∑–±–µ–π –∏—Ö –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤

## WARNING –ö–†–ò–¢–ò–ß–ù–û: –°–µ—Ç–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è MMOFPS

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–∏–º–µ–Ω—è–π –≤ —Å–µ—Ç–µ–≤–æ–º –∫–æ–¥–µ:**

### 1. UDP –¥–ª—è Game State (–ù–ï WebSocket!)

```go
// WebSocket/TCP —Ç–æ–ª—å–∫–æ –¥–ª—è:
// - Lobby, chat, inventory
// - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω—É–∂–Ω–∞

// UDP –¥–ª—è:
// - Position, rotation updates
// - Shooting events
// - Real-time game state

conn, _ := net.ListenUDP("udp", addr)
go handleGameUpdates(conn) // Non-blocking
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Latency ‚Üì 50%, jitter ‚Üì 80% (–Ω–µ—Ç TCP retransmit)

### 2. Spatial Partitioning (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è >100 –∏–≥—Ä–æ–∫–æ–≤)

```go
type SpatialGrid struct {
    cellSize float32
    cells    map[CellID]*Cell
}

// –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–π updates –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º!
func (s *Server) BroadcastUpdate(player *Player, update []byte) {
    // –¢–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–∞–º –≤ —Ä–∞–¥–∏—É—Å–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
    nearby := s.grid.GetNearbyPlayers(player.Position, 100.0)
    for _, p := range nearby {
        p.Send(update)
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢—Ä–∞—Ñ–∏–∫ ‚Üì 80-90%, CPU ‚Üì 70%

### 3. Delta Compression (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è bandwidth)

```go
// –û—Ç–ø—Ä–∞–≤–ª—è–π —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–µ full state
type PlayerUpdate struct {
    ID          uint32
    ChangeMask  uint8 // –ë–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    Position    Vec3  `json:",omitempty"` // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
    Rotation    Quat  `json:",omitempty"` // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
    Health      int16 `json:",omitempty"` // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
}

func (p *Player) GetDelta(prev *PlayerState) *PlayerUpdate {
    update := &PlayerUpdate{ID: p.ID}
    if p.Position != prev.Position {
        update.ChangeMask |= PositionChanged
        update.Position = p.Position
    }
    // ... –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π
    return update
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Bandwidth ‚Üì 70-85%

### 4. Batch Updates (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

```go
// –ü–ª–æ—Ö–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–∂–¥–æ–≥–æ update –æ—Ç–¥–µ–ª—å–Ω–æ
for _, player := range players {
    conn.WriteToUDP(player.Update(), player.Addr) // 1000 syscalls
}

// –•–æ—Ä–æ—à–æ: –±–∞—Ç—á–∏–Ω–≥
batch := make([]byte, 0, 64*1024) // 64KB buffer
for _, player := range players {
    batch = append(batch, player.Update()...)
    if len(batch) > 60000 { // Flush before MTU
        conn.WriteToUDP(batch, groupAddr)
        batch = batch[:0]
    }
}
if len(batch) > 0 {
    conn.WriteToUDP(batch, groupAddr)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Syscalls ‚Üì 95%, CPU ‚Üì 60%

### 5. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Tick Rate

```go
type GameServer struct {
    tickRate     time.Duration
    playerCount  atomic.Int32
}

func (s *GameServer) AdaptTickRate() {
    count := s.playerCount.Load()
    
    switch {
    case count < 50:
        s.tickRate = 128 * time.Millisecond // 128 Hz
    case count < 200:
        s.tickRate = 60 * time.Millisecond  // 60 Hz
    case count < 500:
        s.tickRate = 30 * time.Millisecond  // 30 Hz
    default:
        s.tickRate = 20 * time.Millisecond  // 20 Hz
    }
}
```

### 6. –ö–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (—ç–∫–æ–Ω–æ–º–∏—è bandwidth)

```go
// –ü–ª–æ—Ö–æ: float32 = 4 bytes
type Position struct {
    X, Y, Z float32 // 12 bytes
}

// –•–æ—Ä–æ—à–æ: quantize to int16
type QuantizedPos struct {
    X, Y, Z int16 // 6 bytes (50% —ç–∫–æ–Ω–æ–º–∏—è)
}

func Quantize(pos Vec3, scale float32) QuantizedPos {
    return QuantizedPos{
        X: int16(pos.X * scale),
        Y: int16(pos.Y * scale),
        Z: int16(pos.Z * scale),
    }
}

func Dequantize(qpos QuantizedPos, scale float32) Vec3 {
    return Vec3{
        X: float32(qpos.X) / scale,
        Y: float32(qpos.Y) / scale,
        Z: float32(qpos.Z) / scale,
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Bandwidth ‚Üì 50% –¥–ª—è position updates

### 7. Connection Pooling –¥–ª—è UDP

```go
// –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π –±—É—Ñ–µ—Ä—ã –¥–ª—è UDP packets
var udpBufferPool = sync.Pool{
    New: func() interface{} {
        buf := make([]byte, 1500) // MTU size
        return &buf
    },
}

func HandleUDP(conn *net.UDPConn) {
    bufPtr := udpBufferPool.Get().(*[]byte)
    defer udpBufferPool.Put(bufPtr)
    
    buf := *bufPtr
    n, addr, _ := conn.ReadFromUDP(buf)
    processPacket(buf[:n], addr)
}
```

### 8. Interest Management (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è massive battles)

```go
// –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π –¥–µ—Ç–∞–ª–∏ –¥–∞–ª–µ–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
type InterestLevel int

const (
    HighDetail    InterestLevel = iota // <50m: full updates
    MediumDetail                        // 50-150m: position only
    LowDetail                           // 150-300m: position every 5 ticks
    NoInterest                          // >300m: –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
)

func (s *Server) GetInterestLevel(dist float32) InterestLevel {
    switch {
    case dist < 50: return HighDetail
    case dist < 150: return MediumDetail
    case dist < 300: return LowDetail
    default: return NoInterest
    }
}
```

### 9. –ü—Ä–æ—Ç–æ–∫–æ–ª —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```go
// –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–π –ø—Ä–æ—Ç–æ–∫–æ–ª
type PacketHeader struct {
    Version    uint8  // Protocol version
    PacketType uint8  // Message type
    Sequence   uint16 // –î–ª—è ordering
}

func (s *Server) HandlePacket(data []byte) {
    if data[0] != CurrentProtocolVersion {
        // Handle old clients gracefully
        s.HandleLegacyPacket(data)
        return
    }
    // ...
}
```

### 10. Jitter Buffer (–¥–ª—è smooth gameplay)

```go
type JitterBuffer struct {
    packets map[uint16]*Packet
    delay   time.Duration // ~100ms
}

// –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É–π —Å–µ—Ç–µ–≤–æ–π jitter
func (jb *JitterBuffer) Add(seq uint16, packet *Packet) {
    jb.packets[seq] = packet
    
    // –ü–ª–∞–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    time.AfterFunc(jb.delay, func() {
        jb.PlaySequence(seq)
    })
}
```

**–í–ê–ñ–ù–û:** –≠—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è real-time game servers. –ë–µ–∑ –Ω–∏—Ö –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å >100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å –ø—Ä–∏–µ–º–ª–µ–º—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º.

## Task Requirements Check

**–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã:**
1. –ü—Ä–æ—á–∏—Ç–∞–π Issue –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
2. –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Issue
3. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Üí –≤–µ—Ä–Ω–∏—Å—å –∫ Issue –∏ –ø—Ä–æ–≤–µ—Ä—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–°–º. `.cursor/AGENT_COMMON_RULES.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π**

## –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: Issue –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:** `# Issue: #123` (YAML) –∏–ª–∏ `// Issue: #123` (Go)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è proto —Ñ–∞–π–ª–æ–≤
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –ö–æ–º–º–∏—Ç—ã –∏ Git

**–°–º. `.cursor/AGENT_COMMON_RULES.md`**

**–ü—Ä–µ—Ñ–∏–∫—Å:** `[network]`
**–¢–∏–ø:** `feat:` –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, `perf:` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–æ–≤

- **–ü—Ä–µ—Ñ–∏–∫—Å:** `[network]` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- **–¢–∏–ø:** `feat:` –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, `fix:` –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- **Issue:** –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π –Ω–æ–º–µ—Ä Issue

### –ö–æ–≥–¥–∞ –∫–æ–º–º–∏—Ç–∏—Ç—å

- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è Protocol Buffers
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Envoy
- –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–≥–æ –∫–æ–¥–∞

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π Docker/K8s (—ç—Ç–æ DevOps)
- –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å CPU (—ç—Ç–æ Performance Engineer)
- –¢–û–õ–¨–ö–û —Å–µ—Ç–µ–≤–∞—è —á–∞—Å—Ç—å –∏ —Ç–∏–∫—Ä–µ–π—Ç

## WARNING –í–ê–ñ–ù–û: –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–∏–∫—Ä–µ–π—Ç—É –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–µ—Ç–µ–≤–æ–π —á–∞—Å—Ç–∏ —É—á–∏—Ç—ã–≤–∞–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–∏–∫—Ä–µ–π—Ç—É:**

### –ë–∞–∑–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–∏–∫—Ä–µ–π—Ç—É:

1. **PvE –∑–æ–Ω—ã (MMORPG):**
   - –ü—Ä–æ—Ç–æ–∫–æ–ª: WebSocket (TCP)
   - –¢–∏–∫—Ä–µ–π—Ç: 20-30 Hz
   - –ó–∞–¥–µ—Ä–∂–∫–∞: <100 –º—Å
   - –ò–≥—Ä–æ–∫–æ–≤: 100-500

2. **PvP small (5-20 –∏–≥—Ä–æ–∫–æ–≤):**
   - –ü—Ä–æ—Ç–æ–∫–æ–ª: UDP
   - –¢–∏–∫—Ä–µ–π—Ç: 60-128 Hz
   - –ó–∞–¥–µ—Ä–∂–∫–∞: <30 –º—Å
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –ü–æ–ª–Ω–∞—è (–≤—Å–µ –≤–∏–¥—è—Ç –≤—Å–µ—Ö)

3. **GvG 200 (100v100):**
   - –ü—Ä–æ—Ç–æ–∫–æ–ª: UDP
   - –¢–∏–∫—Ä–µ–π—Ç: 60-80 Hz
   - –ó–∞–¥–µ—Ä–∂–∫–∞: <40 –º—Å
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: Spatial partitioning

4. **GvG 400 (200v200):**
   - –ü—Ä–æ—Ç–æ–∫–æ–ª: UDP
   - –¢–∏–∫—Ä–µ–π—Ç: 40-60 Hz
   - –ó–∞–¥–µ—Ä–∂–∫–∞: <50 –º—Å
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: Spatial sharding (2-4 shards)

5. **Massive war (2000+ –∏–≥—Ä–æ–∫–æ–≤):**
   - –ü—Ä–æ—Ç–æ–∫–æ–ª: UDP
   - –¢–∏–∫—Ä–µ–π—Ç: 20-40 Hz
   - –ó–∞–¥–µ—Ä–∂–∫–∞: <100 –º—Å
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Cluster (5-10 servers)

### –£—á–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ç—å:

- **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–π bandwidth** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–£—á–∏—Ç—ã–≤–∞–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤** –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–∏–∫—Ä–µ–π—Ç–∞
- **–ò—Å–ø–æ–ª—å–∑—É–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç–∏–∫—Ä–µ–π—Ç** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
- **–ü—Ä–∏–º–µ–Ω—è–π spatial partitioning** –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ 80-90%
- **–ò—Å–ø–æ–ª—å–∑—É–π event aggregation** (–±–∞—Ç—á–∏–Ω–≥) –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∏—Ç–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π** —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–∏–∫—Ä–µ–π—Ç—É –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏
- **–£–∫–∞–∑—ã–≤–∞–π —Ä–∞—Å—á–µ—Ç—ã –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ —Å–µ—Ç—å
- **–û–ø–∏—Å—ã–≤–∞–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- **–°–æ–∑–¥–∞–≤–∞–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** –¥–ª—è —Ç–∏–∫—Ä–µ–π—Ç–∞ —Ä–∞–∑–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
