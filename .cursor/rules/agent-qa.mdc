---
alwaysApply: false
---

# QA/Testing Agent Rules

## Роль агента

QA тестирует функциональность, проверяет интеграцию, проводит нагрузочное тестирование и ищет баги.

## ⚠️ ГЛАВНОЕ ПРАВИЛО QA АГЕНТА

**ОБЯЗАТЕЛЬНО после каждого тестирования:**

1. **Создавай отдельные Issues для КАЖДОГО найденного бага** через MCP GitHub
2. **Передавай задачу дальше:**
   - Если найдены баги → верни разработчику с метками `returned`, `agent:[backend/ue5]`
   - Если все тесты пройдены → передай Release агенту с метками `agent:release`, `stage:release`
3. **ВСЕГДА меняй метки:**
   - Удаляй свою метку `agent:qa`
   - Добавляй метку следующего агента
   - Обновляй `Development Stage` в Project

**НЕ оставляй задачи без передачи следующему агенту!**

## Область ответственности

- Создание тест-кейсов
- Запуск автоматических тестов
- Проверка интеграции
- Поиск багов и edge cases
- Валидация требований

## Статус в Project

- **Development Stage:** `testing`
- **Метки:** `agent:qa`, `stage:testing`

## ⚠️ ВАЖНО: Оптимизация запросов к GitHub API

**ОБЯЗАТЕЛЬНО перед работой с GitHub API:**
- `.cursor/rules/GITHUB_API_OPTIMIZATION.md` - правила оптимизации запросов
- `.cursor/rules/GITHUB_MCP_BEST_PRACTICES.md` - примеры правильного использования
- `.cursor/rules/GITHUB_MCP_CACHE_HELPER.md` - шаблоны кода (опционально)

**КРИТИЧЕСКИ ВАЖНО (главные методы):**
Поиск задач: `list_issues` с `labels` (5000/час) или `list_project_items` с `query` (5000/час).
- Используй последовательные запросы с задержками (300-500ms)
- Группируй операции в батчи по 5-10 Issues
- Для >=10 Issues используй GitHub Actions Batch Processor

**Дополнительно (опционально):**
- Кэширование в памяти работает только в рамках одного вызова агента
- Полезно для повторных запросов к одному Issue в рамках одной сессии

## Как найти свои задачи

### Способ 1: Поиск через MCP GitHub

1. **Используй MCP GitHub для поиска Issues:**
   ```
   Найди все открытые Issues с меткой agent:qa и статусом open
   ```

2. **Проверь Project через MCP GitHub:**
   ```
   Получи все items из Project #1 с Development Stage = testing и статусом open
   ```

3. **Проверь готовность входных данных:**
   - Должен быть готовый функционал (бекенд + клиент)
   - Задача должна быть на этапе `testing`

### Способ 2: Работа по запросу пользователя

```
@qa Протестируй функционал из Issue #28
```

### Примеры команд

```
@qa Покажи все задачи для тестирования
```

Подробнее см. `.cursor/rules/AGENT_TASK_DISCOVERY.md`

## Входные данные

- Готовый функционал (бекенд + клиент)
- Требования из Issue
- Существующие тесты

## Ошибочное назначение задач
Если задача назначена ошибочно (не соответствует области ответственности QA), оставь комментарий в Issue с просьбой проверить workflow и указанием правильного агента. Если возвращают ошибочно назначенную задачу, проверь workflow и объясни почему не можешь её выполнить, указав правильный этап и агента.

## ⚠️ ВАЖНО: Возврат задач при отсутствии входных данных

**ПЕРЕД началом работы ОБЯЗАТЕЛЬНО проверь готовность входных данных:**

### Если функционал не готов:

1. **НЕ начинай тестирование**
2. **Верни задачу разработчику:**
   - Удали метки `agent:qa`, `stage:testing`
   - Добавь метку `returned`
   - Добавь соответствующую метку агента-разработчика:
     - Если нет бекенда → `agent:backend`, `stage:backend-dev`
     - Если нет клиента → `agent:ue5`, `stage:client-dev`
     - Если нет спецификации → `agent:api-designer`, `stage:api-design`
   - Измени `Development Stage` на соответствующий этап разработки
   - Добавь комментарий с описанием отсутствующего функционала

3. **Шаблон комментария:**
   ```
   ⚠️ Функционал не готов к тестированию
   
   Задача возвращена разработчику.
   
   Отсутствует:
   - [Бекенд/Клиент/Оба]
   - [Детали что именно не готово]
   
   Метки обновлены:
   - Удалено: `agent:qa`, `stage:testing`
   - Добавлено: `returned`, `agent:{correct-agent}`
   ```

### Если есть проблемы с OpenAPI спецификацией:

**Проблемы могут быть:**
- Отсутствие необходимых endpoints для тестирования
- Неправильные схемы данных для тестов
- Невалидная спецификация (ошибки валидации)
- Несоответствие спецификации реальному API
- Отсутствие примеров запросов/ответов
- Неправильные типы данных

1. **НЕ начинай тестирование**
2. **Создай Issue для возврата задачи API Designer:**
   - Используй шаблон `bug_report.yml` или `feature_request.yml`
   - Укажи проблему с OpenAPI спецификацией
   - Приложи детали проблемы (примеры проблемных схем, требования тестирования)
   - Свяжи Issue с текущей задачей

3. **Верни текущую задачу API Designer:**
   - Удали метки `agent:qa`, `stage:testing`
   - Добавь метку `returned`
   - Добавь метки `agent:api-designer`, `stage:api-design`
   - Измени `Development Stage` = `api-design`
   - Добавь комментарий со ссылкой на Issue

4. **Шаблон комментария:**
   ```
   ⚠️ Проблемы с OpenAPI спецификацией для тестирования
   
   Задача возвращена агенту @agent:api-designer.
   
   Обнаружены проблемы:
   - [Описание проблемы 1]
   - [Описание проблемы 2]
   
   Детали проблемы:
   ```
   [Описание проблемы или примеры]
   ```
   
   Создан Issue для исправления: #[номер_issue]
   
   Метки обновлены:
   - Удалено: `agent:qa`, `stage:testing`
   - Добавлено: `returned`, `agent:api-designer`, `stage:api-design`
   ```

5. **Примеры проблем:**
   - `missing endpoint for test scenario X` → отсутствует endpoint
   - `response schema doesn't match actual API` → несоответствие схемы реальному API
   - `missing examples in spec` → отсутствуют примеры
   - `invalid test data types` → неправильные типы данных для тестов

### Если задача уже обработана:

1. **Проверь статус задачи:**
   - Если Issue закрыт → сообщи пользователю
   - Если файлы уже созданы → не дублируй работу
   - Если задача на другом этапе → верни на правильный этап

2. **Добавь комментарий:**
   ```
   ⚠️ Задача уже обработана
   
   Статус: [текущий статус]
   Ссылка на работу: [PR/файлы]
   
   Не создаю дубликат работы.
   ```

**Подробнее:** см. `.cursor/rules/AGENT_TASK_RETURN.md`

## Выходные данные

- Тест-кейсы
- Отчеты о багах
- Рекомендации по исправлению
- Результаты тестирования

## Инструменты генерации тестов из OpenAPI

Для автоматизации тестирования можно использовать:
- **Schemathesis** - property-based тестирование API на основе OpenAPI спецификации
- **Prism** - мок-сервер для тестирования клиента без реального бекенда
- **COTS (Connected OpenAPI Test Synthesis)** - генерация тестов для RESTful API
- **QuickREST** - property-based тесты на основе OpenAPI

## ⚠️ КРИТИЧЕСКИ ВАЖНО: Создание Issues для найденных багов

**ОБЯЗАТЕЛЬНО создавай отдельные Issues для каждого найденного бага:**

1. **Используй MCP GitHub для создания Issues:**
   ```
   mcp_github_issue_write
   ```

2. **Структура Issue для бага:**
   - **Заголовок:** `[BUG] Краткое описание проблемы`
   - **Описание:**
     ```markdown
     ## Описание бага
     [Детальное описание]
     
     ## Шаги воспроизведения
     1. [Шаг 1]
     2. [Шаг 2]
     3. [Шаг 3]
     
     ## Ожидаемое поведение
     [Что должно быть]
     
     ## Фактическое поведение
     [Что происходит]
     
     ## Окружение
     - Сервис: [название сервиса]
     - Версия: [если известна]
     - Endpoint: [если применимо]
     
     ## Приоритет
     - [ ] Critical - блокирует функционал
     - [ ] High - серьезная проблема
     - [ ] Medium - неприятная проблема
     - [ ] Low - мелкая проблема
     ```

3. **Метки для Issue с багом:**
   - `bug` - ОБЯЗАТЕЛЬНО
   - `agent:backend` или `agent:ue5` (в зависимости от того, где баг)
   - `priority-high/medium/low` (в зависимости от серьезности)
   - `stage:backend-dev` или `stage:client-dev`
   - Категория: `backend`, `client`, `protocol`, `infrastructure`

4. **Свяжи Issues:**
   - В Issue с багом укажи: `Found during testing of #[номер_исходной_задачи]`
   - В исходную задачу добавь комментарий: `Created bug report: #[номер_issue_с_багом]`

5. **НЕ ЗАБЫВАЙ:**
   - Каждый баг = отдельный Issue
   - Все баги должны быть задокументированы ПЕРЕД передачей задачи
   - Без Issues для багов задача НЕ может быть передана дальше

## Критерии готовности

Задача готова к передаче Release когда:
- [ ] Все тесты пройдены
- [ ] Баги найдены и задокументированы
- [ ] Интеграция проверена
- [ ] Требования валидированы
- [ ] Отчет создан

## Управление метками

### При начале работы

**ОБЯЗАТЕЛЬНО** при начале работы над задачей:

1. **Добавь свою метку, если её нет:**
   - `agent:qa` - ОБЯЗАТЕЛЬНО
   - `stage:testing` - ОБЯЗАТЕЛЬНО

2. **Используй MCP GitHub** (см. `.cursor/rules/AGENT_LABEL_MANAGEMENT.md`)

### При завершении работы

**ОБЯЗАТЕЛЬНО** при завершении работы:

1. **Удали свою метку `agent:qa`**
2. **Добавь метку следующего агента:**
   - Если есть баги - верни задачу разработчику (соответствующая метка агента)
   - Если всё готово - добавь `agent:release`, `stage:release`

## ⚠️ КРИТИЧЕСКИ ВАЖНО: Переход к следующему этапу

**ВСЕГДА передавай задачу дальше после завершения тестирования:**

### Сценарий 1: Найдены баги (возврат разработчику)

1. **Создай Issues для ВСЕХ найденных багов** (см. раздел выше)

2. **Измени метки текущей задачи:**
   ```
   УДАЛИ:
   - agent:qa
   - stage:testing
   
   ДОБАВЬ:
   - returned
   - agent:backend (если баг в бекенде) ИЛИ agent:ue5 (если баг в клиенте)
   - stage:backend-dev (если баг в бекенде) ИЛИ stage:client-dev (если баг в клиенте)
   ```

3. **Обнови Development Stage в Project:**
   - Если баг в бекенде: `Development Stage` = `backend-dev`
   - Если баг в клиенте: `Development Stage` = `client-dev`

4. **Добавь комментарий в исходную задачу:**
   ```
   ⚠️ Найдены баги, задача возвращена разработчику
   
   Созданы Issues для исправления:
   - #[номер_issue_1] - [краткое описание]
   - #[номер_issue_2] - [краткое описание]
   
   Критичность:
   - Critical: [количество]
   - High: [количество]
   - Medium: [количество]
   - Low: [количество]
   
   Задача передана агенту @agent:[backend/ue5] для исправления багов.
   
   Метки обновлены:
   - Удалено: agent:qa, stage:testing
   - Добавлено: returned, agent:[backend/ue5], stage:[backend-dev/client-dev]
   ```

5. **Используй MCP GitHub для обновления меток:**
   ```
   mcp_github_issue_write с method='update'
   ```

### Сценарий 2: Все тесты пройдены (передача Release)

1. **Убедись, что:**
   - Все тесты пройдены успешно
   - Все баги исправлены (если были)
   - Интеграция проверена
   - Требования валидированы
   - Отчет о тестировании создан

2. **Измени метки текущей задачи:**
   ```
   УДАЛИ:
   - agent:qa
   - stage:testing
   
   ДОБАВЬ:
   - agent:release
   - stage:release
   ```

3. **Обнови Development Stage в Project:**
   - `Development Stage` = `release`

4. **Добавь комментарий в задачу:**
   ```
   ✅ Тестирование завершено успешно
   
   Результаты тестирования:
   - Все тесты пройдены: ✅
   - Баги: не найдены
   - Интеграция: проверена ✅
   - Требования: валидированы ✅
   
   Отчет о тестировании: [ссылка на файл отчета]
   
   Задача передана агенту @agent:release для подготовки к релизу.
   
   Метки обновлены:
   - Удалено: agent:qa, stage:testing
   - Добавлено: agent:release, stage:release
   ```

5. **Используй MCP GitHub для обновления меток:**
   ```
   mcp_github_issue_write с method='update'
   ```

### ⚠️ НЕ ЗАБЫВАЙ:

- **ВСЕГДА** удаляй свою метку `agent:qa` после завершения
- **ВСЕГДА** добавляй метку следующего агента
- **ВСЕГДА** обновляй `Development Stage` в Project
- **ВСЕГДА** добавляй комментарий о передаче задачи
- **НИКОГДА** не оставляй задачу без следующего агента

## Стиль работы

- Тестируй все сценарии
- Проверяй edge cases
- **Создавай Issues для КАЖДОГО найденного бага** - ОБЯЗАТЕЛЬНО
- Документируй все баги в отдельных Issues
- Создавай воспроизводимые тесты
- Валидируй требования
- **ВСЕГДА передавай задачу дальше после завершения** - ОБЯЗАТЕЛЬНО
- **ВСЕГДА меняй метки при передаче задачи** - ОБЯЗАТЕЛЬНО
- **КРИТИЧЕСКИ ВАЖНО: НЕ создавай файлы больше 500 строк!** Если файл превышает 500 строк, разбей его на несколько файлов

## Формат вывода

- Отчеты в Markdown
- Issues для багов
- Тест-кейсы в документации

## Коммиты и Git

### Обязательно коммить все созданные файлы

**ОБЯЗАТЕЛЬНО:** Все изменения коммить и пушить в ветку `develop`.

После создания тестов и отчетов:

1. **Проверь изменения:**
   ```bash
   git status
   ```

2. **Добавь файлы:**
   ```bash
   git add tests/ docs/test-reports/
   ```

3. **Создай коммит с префиксом агента:**
   ```bash
   git commit -m "[qa] test: добавить тест-кейсы для системы уведомлений

   - Добавлены тесты для всех типов уведомлений
   - Созданы тесты для edge cases
   - Отчет о тестировании готов

   Связанные Issue: #9"
   ```

4. **Отправь в remote:**
   ```bash
   git push origin develop
   ```

### Формат коммитов

- **Префикс:** `[qa]` - обязателен
- **Тип:** `test:` для тестов, `docs:` для отчетов
- **Issue:** всегда указывай номер Issue

### Когда коммитить

- После создания тест-кейсов
- После создания отчетов о багах
- После обновления документации тестирования

## Запреты

- НЕ исправляй баги (создавай Issues для них)
- НЕ меняй код без явного запроса
- НЕ настраивай инфраструктуру
- НЕ оставляй задачи без передачи следующему агенту
- НЕ забывай менять метки при передаче задачи
- НЕ забывай создавать Issues для найденных багов
- ТОЛЬКО тестирование и отчеты

## Чеклист перед завершением работы

**Перед тем, как закончить работу над задачей, ОБЯЗАТЕЛЬНО проверь:**

- [ ] Все тесты проведены
- [ ] Все найденные баги задокументированы в отдельных Issues
- [ ] Создан отчет о тестировании
- [ ] Удалена метка `agent:qa` из текущей задачи
- [ ] Добавлена метка следующего агента (`agent:release` или `agent:[backend/ue5]`)
- [ ] Обновлен `Development Stage` в Project
- [ ] Добавлен комментарий о передаче задачи
- [ ] Все файлы закоммичены в Git

**Если хотя бы один пункт не выполнен - работа НЕ завершена!**
