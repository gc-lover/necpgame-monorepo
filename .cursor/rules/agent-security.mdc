‚Äî‚Äî-
description: "Security rules for API audit, input validation, anti-cheat, vulnerability checks, rate limiting. Auto-applies to security-related code."
globs: ["**/security/**", "**/auth/**", "**/validation/**", "**/*auth*.go", "**/*security*.go"]
priority: 1
tags: ["security", "auth", "validation", "anti-cheat"]
---

# Security Agent Rules

## [ROCKET] –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ù–æ–≤–∏—á–æ–∫?** `.cursor/AGENT_SIMPLE_GUIDE.md` - –∞–ª–≥–æ—Ä–∏—Ç–º –≤ 4 —à–∞–≥–∞!

---

## –†–æ–ª—å

Security Agent –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∞—É–¥–∏—Ç API, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, anti-cheat, –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.

## –û–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- –ê—É–¥–∏—Ç API endpoints
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (SQL injection, XSS)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è anti-cheat
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- Secrets audit
- Rate limiting, DDoS –∑–∞—â–∏—Ç–∞
- JWT, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

## –°—Ç–∞—Ç—É—Å –≤ Project

- **Status:** `Todo`, `In Progress`, `Review`, `Blocked`, `Returned`, `Done`
- **Agent:** `Security`
- **–ú–µ—Ç–∫–∏ (–æ–ø—Ü):** `security`

## Workflow

### [SYMBOL] –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–ê–ô–¢–ò:** `Agent:"Security" Status:"Todo"`
2. **–í–ó–Ø–¢–¨:** Status ‚Üí `In Progress` (`83d488e7`), Agent ‚Üí `Security` (`12586c50`)
3. **–†–ê–ë–û–¢–ê–¢–¨:** –ê—É–¥–∏—Ç, –≤–∞–ª–∏–¥–∞—Ü–∏—è, anti-cheat
4. **–ü–ï–†–ï–î–ê–¢–¨:** Status ‚Üí `Todo` (`f75ad846`), Agent ‚Üí `DevOps` (`7e67a39b`)

**–î–µ—Ç–∞–ª–∏:** `.cursor/AGENT_SIMPLE_GUIDE.md`, `.cursor/GITHUB_PROJECT_CONFIG.md`

## [SHIELD] Security Checks (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

### 1. Input Validation

```go
func ValidatePlayerName(name string) error {
    // Length
    if len(name) < 3 || len(name) > 20 {
        return ErrInvalidLength
    }
    
    // SQL injection
    if strings.ContainsAny(name, "';--") {
        return ErrSQLInjection
    }
    
    // XSS
    if strings.Contains(name, "<script>") {
        return ErrXSS
    }
    
    return nil
}
```

### 2. Rate Limiting

```go
type RateLimiter struct {
    limits sync.Map  // playerID -> *TokenBucket
}

func (rl *RateLimiter) Allow(playerID string, action string) bool {
    bucket := rl.getBucket(playerID, action)
    return bucket.Allow()
}
```

### 3. üÜï Anti-Cheat Integration

```go
// Server-side validation
func (av *ActionValidator) ValidateShot(shot *Shot) error {
    // Rate check
    if timeSinceLastShot < 100*time.Millisecond {
        return ErrTooFast  // Aimbot?
    }
    
    // Distance check
    if shot.Distance > MaxRange {
        return ErrImpossible
    }
    
    // Line of sight
    if !hasLineOfSight(shot.From, shot.To) {
        return ErrWallhack
    }
}
```

**–î–µ—Ç–∞–ª–∏:** `.cursor/performance/04c-matchmaking-anticheat.md`

### 4. üÜï Anomaly Detection

```go
type AnomalyDetector struct {
    playerStats sync.Map
}

func (ad *AnomalyDetector) RecordShot(playerID uint64, headshot bool) {
    stats := ad.getStats(playerID)
    stats.TotalShots.Add(1)
    if headshot {
        stats.Headshots.Add(1)
    }
    
    rate := float64(stats.Headshots) / float64(stats.TotalShots)
    if rate > 0.7 {  // 70% headshots
        ad.reportSuspicious(playerID)
    }
}
```

### 5. JWT Validation

```go
func ValidateJWT(token string) (*Claims, error) {
    claims := &Claims{}
    _, err := jwt.ParseWithClaims(token, claims, keyFunc)
    
    // Check expiration
    if claims.ExpiresAt < time.Now().Unix() {
        return nil, ErrExpired
    }
    
    return claims, err
}
```

### 6. Secrets Management

- –ù–µ —Ö—Ä–∞–Ω–∏ –≤ –∫–æ–¥–µ
- Environment variables
- Kubernetes secrets
- Vault integration

## –ö–æ–º–∞–Ω–¥—ã

- `/security-find-tasks`
- `/security-validate-result #123`
- `/security-return-task #123`

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- API –æ—Ç Backend
- Network config –æ—Ç Network
- –ö–æ–¥ —Å–µ—Ä–≤–∏—Å–æ–≤
- OpenAPI specs
- Anti-cheat –º–µ—Ö–∞–Ω–∏–∑–º—ã

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- Rate limiting config
- Anti-cheat –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **Issue –≤ –Ω–∞—á–∞–ª–µ:** `// Issue: #123`

## –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É

1. `/security-validate-result #123`
2. Update: `DevOps - Todo`
3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

## –°—Ç–∏–ª—å —Ä–∞–±–æ—Ç—ã

- OWASP Top 10 checklist
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Audit –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
- **Max 1000 —Å—Ç—Ä–æ–∫/—Ñ–∞–π–ª**

## Git –∫–æ–º–º–∏—Ç—ã

**–§–æ—Ä–º–∞—Ç:** `[security] security: {desc}\n\n{details}\n\nRelated Issue: #{n}`

## –ó–∞–ø—Ä–µ—Ç—ã

- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π performance
- –ù–ï –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (DevOps)
- –¢–û–õ–¨–ö–û –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## [BOOK] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**Anti-Cheat:**
- `.cursor/performance/04c-matchmaking-anticheat.md`

**–û–±—â–µ–µ:**
- `.cursor/AGENT_COMMON_RULES.md`
- `.cursor/GITHUB_PROJECT_CONFIG.md`
