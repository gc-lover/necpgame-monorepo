---
alwaysApply: true
---

## Запреты на создание файлов

- НЕ создавай документы .MD (README, документация, инструкции, отчеты и т.д.) без явного запроса в промпте
- НЕ создавай скрипты (bash, bat, ps1, sh и т.д.) без явного запроса в промпте
- НЕ создавай конфигурационные файлы для инструментов разработки без явного запроса
- НЕ создавай тестовые файлы, примеры кода, демо-файлы без явного запроса
- НЕ создавай временные файлы, файлы для отладки или вспомогательные файлы без явного запроса
- Создавай ТОЛЬКО файлы, которые нужны для продакшена и явно запрошены пользователем

## Принципы разработки

- Соблюдай SOLID принципы
- Следуй принципам SRE (Site Reliability Engineering)
- Пиши код для продакшена, не для демонстрации
- Делай маленькие классы на 300-400 строк максимум
- Не используй комментарии и TODO в коде
- Используй встроенные инструменты (поиск по проекту, web-search)

## Контекст проекта

- Игра в стиле Cyberpunk 2077
- Киберспортивный шутер с элементами MMOFPS RPG
- Лутинг шутер механики
- Бекенд: Go
- Клиент: Unreal Engine 5.7 и C++

## Структура проекта (Монорепозиторий)

Проект организован как монорепозиторий со следующей структурой:

- `services/` - Go микросервисы (character-service, inventory-service, movement-service, matchmaking-go, realtime-gateway-go, ws-lobby-go)
- `client/UE5/` - Unreal Engine 5.7 клиент на C++
- `infrastructure/` - Docker, Kubernetes, Envoy, Liquibase миграции, Observability (Grafana, Prometheus, Loki, Tempo)
- `proto/realtime/` - Protocol Buffers определения для realtime коммуникации
- `scripts/` - Утилиты и скрипты для разработки и тестирования
- `k8s/` - Kubernetes манифесты для деплоя
- `knowledge/` - Документация, спецификации, дизайн игры

## GitHub интеграция и workflow

### Управление задачами

- Используй GitHub Issues для всех задач, багов и фич
- Создавай Issues через шаблоны: `bug_report.yml` или `feature_request.yml`
- Используй метки для категоризации: `backend`, `client`, `infrastructure`, `protocol`, `priority-high/medium/low`
- Issues автоматически синхронизируются с GitHub Projects

### Pull Requests

- Все изменения через Pull Requests
- Используй шаблон PR из `.github/PULL_REQUEST_TEMPLATE.md`
- PR должны проходить CI проверки перед мержем
- Используй `@Cursor` в комментариях для помощи с кодом

### MCP GitHub

- MCP GitHub настроен и доступен для работы с репозиторием
- Можно использовать для создания issues, управления PR, поиска кода
- Используй MCP функции для автоматизации задач через GitHub API

### Автоматизация

- GitHub Actions настроены для CI/CD:
  - `ci-backend.yml` - тесты и сборка Go сервисов
  - `ci-client.yml` - валидация UE5 проекта
  - `auto-assign.yml` - автоматическое назначение issues
  - `dependency-review.yml` - проверка зависимостей
- Dependabot настроен для автоматических обновлений зависимостей
- Issues автоматически закрываются после 60 дней неактивности

## Принципы работы с кодом

### Go сервисы

- Следуй Go best practices и стандартам
- Используй структурированное логирование (JSON)
- Все сервисы должны экспортировать метрики на `/metrics`
- Health checks через `/health` или `/metrics`
- Используй dependency injection где возможно

### UE5 клиент

- Следуй Unreal Engine coding standards
- Используй UPROPERTY, UFUNCTION макросы правильно
- Избегай утечек памяти (используй smart pointers)
- Оптимизируй сетевой код для realtime синхронизации
- Используй Protobuf для сериализации (через `ProtobufCodec`)

### Protocol Buffers

- Все изменения в `proto/realtime/realtime.proto` требуют обновления клиента и сервера
- Используй backward compatibility при изменении протокола
- Квантуй координаты для оптимизации размера сообщений

### Инфраструктура

- Docker образы должны быть минимальными (multi-stage builds)
- Kubernetes манифесты в `k8s/` для всех сервисов
- Миграции БД через Liquibase в `infrastructure/liquibase/`
- Observability: метрики в Prometheus, логи в Loki, трейсы в Tempo

## Workflow разработки

1. Создай Issue для задачи через шаблон
2. Создай ветку от `main`: `git checkout -b feature/issue-number-description`
3. Реализуй изменения, следуя принципам разработки
4. Создай PR с описанием изменений
5. Дождись прохождения CI и ревью
6. После мержа в `main` - автоматический деплой (если настроен)

## Использование Cursor AI

- Используй `@Cursor` в комментариях Issues/PR для помощи
- Используй MCP GitHub для автоматизации задач
- Используй поиск по проекту перед созданием нового кода
- Проверяй существующие паттерны перед внедрением новых
