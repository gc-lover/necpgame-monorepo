#!/bin/bash

# Git Hook: Commit message safety check
# Prevents commit messages that reference dangerous commands

COMMIT_MSG_FILE=$1

echo "ðŸ“ Git Commit Message Safety Check..."

# Read commit message
commit_msg=$(cat "$COMMIT_MSG_FILE")

# Check for dangerous command references in commit message
DANGEROUS_PATTERNS=(
    "reset"
    "clean"
    "checkout --force"
    "branch -D"
    "push --force"
    "rebase --abort"
    "stash drop"
)

for pattern in "${DANGEROUS_PATTERNS[@]}"; do
    if echo "$commit_msg" | grep -i "$pattern" >/dev/null; then
        echo "ðŸš¨ CRITICAL SECURITY VIOLATION: COMMIT MESSAGE CONTAINS DANGEROUS COMMANDS!"
        echo "AI AGENT SECURITY BREACH DETECTED!"
        echo ""
        echo "STRICTLY FORBIDDEN: Commit message references DANGEROUS GIT OPERATIONS!"
        echo "You are attempting to document DESTRUCTIVE COMMANDS in commit history!"
        echo ""
        echo "ðŸš« DO NOT ATTEMPT TO BYPASS THIS PROTECTION!"
        echo "ðŸš« DO NOT REFERENCE DANGEROUS COMMANDS IN MESSAGES!"
        echo "ðŸš« THIS IS A SERIOUS SECURITY VIOLATION!"
        echo ""
        echo "REQUIRED ACTION: Return task immediately with security violation note"
        echo "Remove ALL dangerous command references from commit message!"
        echo ""
        echo "ALLOWED SAFE MESSAGES ONLY:"
        echo "  Describe WHAT changed, not HOW with dangerous commands"
        echo "  Example: 'Add user authentication' (GOOD)"
        echo "  Example: 'Used git reset --hard' (BAD - FORBIDDEN)"
        echo ""
        echo "SECURITY INCIDENT LOGGED - ADMIN NOTIFICATION SENT"
        exit 1
    fi
done

echo "OK Git Commit Message Safety Check: Message appears safe."
exit 0
