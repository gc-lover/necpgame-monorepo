#!/bin/bash

if ! command -v bash >/dev/null 2>&1; then
  exit 0
fi

ALLOWED_BRANCH="develop"

if ! command -v git-lfs >/dev/null 2>&1; then
  LFS_CHECK=0
else
  if ! git lfs post-checkout "$@" 2>/dev/null; then
    LFS_CHECK=0
  else
    LFS_CHECK=1
  fi
fi

BRANCH_CHECKOUT="$3"
if [ "$BRANCH_CHECKOUT" = "1" ]; then
  CURRENT_BRANCH=$(git symbolic-ref --short HEAD 2>/dev/null || git branch --show-current 2>/dev/null || echo "")
  
  if [ -n "$CURRENT_BRANCH" ] && [ "$CURRENT_BRANCH" != "$ALLOWED_BRANCH" ]; then
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "[GIT_HOOK_INFO] BRANCH_INFO"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
    echo "INFO: You are on branch '$CURRENT_BRANCH'"
    echo "RECOMMENDED: '$ALLOWED_BRANCH' branch for main development"
    echo ""
    echo "NOTE: Branch flexibility allowed for development workflow"
    echo "INFO: Continuing work on '$CURRENT_BRANCH'"
    echo ""
    echo "FOR_AI_AGENTS:"
    echo "  ℹ️ INFO: Multiple branches allowed for development"
    echo "  OK ALLOWED: Work on feature branches"
    echo "  OK ALLOWED: Create and switch branches as needed"
    echo "  OK RECOMMENDED: Merge to '$ALLOWED_BRANCH' when ready"
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
  fi
fi

if [ "$LFS_CHECK" = "1" ]; then
  exit 0
fi

exit 0
