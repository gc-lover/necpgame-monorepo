#!/bin/bash

# Git Hook: Pre-commit protection against dangerous commands
# This hook prevents commits that might contain traces of dangerous git operations

echo "ðŸ” Git Safety Check: Scanning for dangerous command traces..."

# Check if any staged files contain dangerous git command patterns
# This catches cases where agents might have accidentally included command output

DANGEROUS_PATTERNS=(
    "git reset --hard"
    "git clean -fd"
    "git clean -fdx"
    "git checkout --force"
    "git branch -D"
    "git push --force"
    "git rebase --abort"
    "git stash drop"
)

# Check staged files for dangerous patterns
if git diff --cached --name-only | xargs grep -l "${DANGEROUS_PATTERNS[@]}" 2>/dev/null; then
    echo "ðŸš¨ BLOCKED: Found traces of dangerous git commands in staged files!"
    echo "These commands can cause data loss and are forbidden for agents."
    echo ""
    echo "Forbidden commands detected:"
    for pattern in "${DANGEROUS_PATTERNS[@]}"; do
        echo "  - $pattern"
    done
    echo ""
    echo "Please remove these traces and use safe git commands only."
    echo "Safe commands: git add, git commit, git push, git pull, git checkout <branch>"
    exit 1
fi

echo "OK Git Safety Check: No dangerous command traces found."
exit 0