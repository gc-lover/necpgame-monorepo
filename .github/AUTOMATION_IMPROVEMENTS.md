# Улучшения автоматизации агентов

## Что было сделано

### 1. Исправление имени поля в Project
- **Проблема:** Workflow искал поле "Development Stage", но реальное поле называется "Developmen Stage" (с опечаткой)
- **Решение:** Добавлена поддержка обоих вариантов имени поля
- **Файл:** `.github/workflows/project-status-automation.yml`

### 2. Автоматические комментарии при назначении агента
- **Функция:** При назначении задачи агенту автоматически создается комментарий с информацией о назначенном агенте
- **Содержание комментария:**
  - Название назначенного агента
  - Текущий этап разработки
  - Ссылка на правила агента
  - Следующие шаги
- **Файл:** `.github/workflows/project-status-automation.yml` (шаг "Add Agent Label")

### 3. Автоматическое определение готовности задачи
- **Функция:** Система проверяет все чекбоксы в описании задачи
- **Логика:** Когда все чекбоксы отмечены, задача автоматически переходит к следующему этапу
- **Файл:** `.github/workflows/project-status-automation.yml` (шаг "Check Task Readiness")

### 4. Улучшенная логика переходов между этапами
- **Функция:** Улучшена логика автоматических переходов при объединении PR
- **Переходы:**
  - `idea-writer` → `architect`
  - `architect` → `api-designer`
  - `api-designer` → `backend-dev`
  - `backend-dev` → `network-dev`
  - `network-dev` → `ue5-dev`
  - `ue5-dev` → `testing`
  - `testing` → `release`
- **Файл:** `.github/workflows/project-status-automation.yml` (шаг "Auto-transition on PR Merge")

### 5. Новый workflow для переходов между этапами
- **Функция:** Отдельный workflow для обработки переходов между этапами
- **Триггеры:**
  - Комментарии в Issues (проверка чекбоксов)
  - Закрытие Issues
- **Логика:**
  - Проверяет все критерии приемки (чекбоксы)
  - Определяет текущий этап по меткам
  - Автоматически переходит к следующему этапу
  - Создает комментарий о переходе
- **Файл:** `.github/workflows/agent-stage-transition.yml`

## Как это работает

### Сценарий 1: Создание новой задачи
1. Пользователь создает Issue через шаблон `agent_task.yml`
2. Workflow `agent-workflow.yml` определяет начальный этап
3. Добавляются соответствующие метки (`agent:*`, `stage:*`)
4. Workflow `project-status-automation.yml`:
   - Добавляет Issue в Project
   - Обновляет поле "Developmen Stage"
   - Создает комментарий о назначении агента

### Сценарий 2: Выполнение критериев приемки
1. Агент работает над задачей
2. Пользователь отмечает чекбоксы в описании Issue
3. Workflow `agent-stage-transition.yml` проверяет все чекбоксы
4. Когда все чекбоксы отмечены:
   - Определяется следующий этап
   - Добавляются новые метки
   - Обновляется поле в Project
   - Создается комментарий о переходе

### Сценарий 3: Объединение PR
1. PR объединяется в main
2. Workflow `project-status-automation.yml` определяет связанные Issues
3. Автоматически переходит к следующему этапу
4. Создает комментарий о переходе

## Использование

### Для агентов в Cursor
1. Откройте Issue, назначенное вашему агенту
2. Прочитайте комментарий о назначении
3. Следуйте правилам в `.cursor/rules/agent-{role}.mdc`
4. По мере выполнения отмечайте чекбоксы в описании
5. Когда все чекбоксы отмечены, задача автоматически перейдет к следующему агенту

### Для пользователей
1. Создайте задачу через шаблон `agent_task.yml`
2. Выберите начальный этап
3. Заполните описание и критерии приемки
4. Система автоматически назначит агента
5. Следите за комментариями о переходах между этапами

## Следующие шаги для улучшения

### Возможные улучшения:
1. **Автоматическое создание подзадач** - при переходе к новому этапу создавать подзадачи
2. **Уведомления в Slack/Discord** - отправка уведомлений о переходах
3. **Метрики и аналитика** - отслеживание времени на каждом этапе
4. **Автоматическое создание PR** - агенты могут создавать PR при завершении этапа
5. **Интеграция с Cursor AI** - прямое взаимодействие агентов через MCP

## Отладка

### Проверка работы workflows
1. Перейдите в Actions → выберите workflow
2. Проверьте логи выполнения
3. Убедитесь, что метки добавляются правильно
4. Проверьте комментарии в Issues

### Частые проблемы
- **Поле не обновляется:** Проверьте имя поля в Project (может быть опечатка)
- **Переходы не работают:** Убедитесь, что все чекбоксы отмечены
- **Метки не добавляются:** Проверьте права доступа workflow (нужен `issues: write`)

