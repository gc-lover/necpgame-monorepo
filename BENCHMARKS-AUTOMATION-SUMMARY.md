# üìä Benchmarks Automation - Summary

**–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤**

---

## OK –ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### 1. **Pre-commit hook** (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ!)

**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:** –ü—Ä–∏ `git commit`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- OK –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏–∑ staged files
- OK –ó–∞–ø—É—Å–∫–∞–µ—Ç `bench-quick` –¢–û–õ–¨–ö–û –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö
- OK –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å `handlers_bench_test.go`
- OK –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–º–º–∏—Ç (continue-on-error)
- OK –ë–∏–ª–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ –Ω–µ—Ç

**–ü—Ä–∏–º–µ—Ä:**
```bash
# –ò–∑–º–µ–Ω–∏–ª —Ç–æ–ª—å–∫–æ loot-service-go
git add services/loot-service-go/server/handlers.go
git commit -m "feat: update handler"
# ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è bench-quick –¢–û–õ–¨–ö–û –¥–ª—è loot-service-go
```

---

### 2. **Makefile targets** (–≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö!)

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ 81 Makefile –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

```makefile
.PHONY: bench bench-json bench-quick

bench:
	go test -run=^$$ -bench=. -benchmem ./server

bench-json:
	@mkdir -p ../../.benchmarks/results
	go test -run=^$$ -bench=. -benchmem -json ./server > ../../.benchmarks/results/{service}_bench.json

bench-quick:
	go test -run=^$$ -bench=. -benchmem -benchtime=100ms ./server
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```powershell
# –°–∫–æ–ª—å–∫–æ Makefiles –∏–º–µ—é—Ç bench-quick
Get-ChildItem services -Directory | Where-Object { 
    $makefile = Join-Path $_.FullName "Makefile"
    if (Test-Path $makefile) {
        (Get-Content $makefile -Raw) -match 'bench-quick:'
    }
} | Measure-Object | Select-Object -ExpandProperty Count
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 81
```

---

### 3. **GitHub Actions** (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ!)

**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:** –ü—Ä–∏ push/PR

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- OK –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (git diff)
- OK –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –¢–û–õ–¨–ö–û –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö
- OK –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `.benchmarks/results/`
- OK –ö–æ–º–º–∏—Ç–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

---

## üîß –ë–∏–ª–¥ –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏

### ‚ùå –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç –±–∏–ª–¥!

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
```makefile
build: generate-api
	go build -o service .
# OK –ë–∏–ª–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ –Ω–µ—Ç
```

**–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏ –≤ build (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```makefile
build: generate-api bench-quick
	go build -o service .
# WARNING –ë–∏–ª–¥ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏ (–Ω–æ –æ–Ω–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–ï –¥–æ–±–∞–≤–ª—è–π –≤ build –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∑–∞–ø—É—Å–∫–∞–π –æ—Ç–¥–µ–ª—å–Ω–æ:
```bash
make build        # –ë–∏–ª–¥
make bench-quick  # –ë–µ–Ω—á–º–∞—Ä–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

## üìã –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

### Q: –î–ª—è –≤—Å–µ—Ö –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö?

**A: –¢–û–õ–¨–ö–û –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö!**

- Pre-commit: —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏–∑ staged files
- GitHub Actions: —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (git diff)
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫: `.\scripts\run-changed-benchmarks.ps1` - —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ

### Q: –ë–∏–ª–¥ –ø—Ä–æ–π–¥–µ—Ç –µ—Å–ª–∏ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ –Ω–µ—Ç?

**A: –î–ê!**

- –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ build –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ë–∏–ª–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
- –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Q: –ü–æ—á–µ–º—É —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º Makefile –ø—Ä–∞–≤–∫–∏?

**A: –ù–µ—Ç, –≤–æ –≤—Å–µ—Ö 81 Makefile!**

–°–∫—Ä–∏–ø—Ç `add-bench-to-makefile.ps1` –¥–æ–±–∞–≤–∏–ª bench targets –≤–æ –≤—Å–µ Makefiles –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```powershell
# –ù–∞–π—Ç–∏ Makefiles –ë–ï–ó bench-quick
Get-ChildItem services -Directory | Where-Object { 
    $makefile = Join-Path $_.FullName "Makefile"
    if (Test-Path $makefile) {
        $content = Get-Content $makefile -Raw
        $content -notmatch 'bench-quick:'
    }
} | Select-Object Name
```

---

## üéØ Workflow

### –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:

```bash
# 1. –ò–∑–º–µ–Ω–∏–ª –∫–æ–¥
vim services/my-service-go/server/handlers.go

# 2. –ö–æ–º–º–∏—Ç (–±–µ–Ω—á–º–∞—Ä–∫–∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¢–û–õ–¨–ö–û –¥–ª—è my-service-go)
git add services/my-service-go/server/handlers.go
git commit -m "feat: update handler"
# ‚Üí bench-quick –¥–ª—è my-service-go (–µ—Å–ª–∏ –µ—Å—Ç—å handlers_bench_test.go)

# 3. –ë–∏–ª–¥ (–ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
cd services/my-service-go
make build  # OK –ü—Ä–æ—Ö–æ–¥–∏—Ç –¥–∞–∂–µ –±–µ–∑ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
```

### –ü—Ä–∏ push:

```bash
git push
# ‚Üí CI –∑–∞–ø—É—Å—Ç–∏—Ç –ø–æ–ª–Ω—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –¢–û–õ–¨–ö–û –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
# ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ .benchmarks/results/
```

---

## OK –ò—Ç–æ–≥

- OK **–¢–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ** —Å–µ—Ä–≤–∏—Å—ã (–Ω–µ –≤—Å–µ!)
- OK **–ë–∏–ª–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç** –¥–∞–∂–µ –±–µ–∑ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
- OK **81 Makefile** –æ–±–Ω–æ–≤–ª–µ–Ω (–Ω–µ –æ–¥–∏–Ω!)
- OK **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç** –∫–æ–º–º–∏—Ç—ã/–±–∏–ª–¥—ã
- OK **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** - –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (`SKIP_BENCHMARKS=1`)

