# Устранение проблем QUIC подключения

## Текущая проблема

Ошибка `ConnectionStart failed with status 0x80070057` (E_INVALIDARG) указывает на неверные параметры при вызове `ConnectionStart`.

## Возможные причины

### 1. Несовместимость quic-go и MsQuic

Go сервер использует библиотеку `quic-go`, которая может иметь несовместимости с Microsoft MsQuic:
- Разные реализации QUIC протокола
- Различия в обработке TLS handshake
- Различия в ALPN negotiation

### 2. Проблема с ConfigurationLoadCredential

Ошибка `ConfigurationLoadCredential failed (0x80090331)` (SEC_E_INVALID_TOKEN) может указывать на:
- Неправильную структуру credentials
- Несовместимость версий MsQuic
- Требования к credentials для клиента

## Решения

### Вариант 1: Переписать сервер на C++ с MsQuic (РЕКОМЕНДУЕТСЯ)

**Преимущества:**
- Полная совместимость между клиентом и сервером
- Одинаковая реализация QUIC протокола
- Лучшая производительность
- Единая кодовая база

**Недостатки:**
- Требует времени на переписывание
- Нужно изучить MsQuic API для сервера

**Шаги:**
1. Создать C++ сервер используя MsQuic
2. Использовать те же настройки TLS и ALPN
3. Обеспечить совместимость с текущим протоколом

### Вариант 2: Использовать другой QUIC стек

**Альтернативы:**
- **quiche** (Cloudflare) - кроссплатформенный, но требует больше работы
- **s2n-quic** (AWS) - хорошая производительность, но меньше документации

**Недостатки:**
- Требует переписывания как клиента, так и сервера
- Меньше поддержки в сообществе

### Вариант 3: Исправить текущую реализацию

**Попытки:**
1. OK Использование "localhost" для SNI при IP адресе
2. OK Использование QUIC_ADDRESS_FAMILY_UNSPEC
3. OK Правильная настройка credentials

**Если не работает:**
- Проверить версии библиотек
- Использовать Wireshark для анализа QUIC handshake
- Проверить совместимость ALPN протоколов

## Рекомендации

**Для быстрого решения:** Переписать сервер на C++ с MsQuic - это обеспечит полную совместимость и решит проблему раз и навсегда.

**Для долгосрочного решения:** Использовать единый QUIC стек для всего проекта (MsQuic или другой проверенный стек).

## Тестирование

После исправлений проверить:
1. Успешное подключение
2. TLS handshake завершается
3. ALPN negotiation работает
4. Данные передаются корректно

