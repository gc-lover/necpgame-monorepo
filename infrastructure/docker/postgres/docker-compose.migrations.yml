version: '3.8'

# Extends the main docker-compose.yml to add Liquibase service
# Usage: docker compose -f docker-compose.yml -f docker-compose.migrations.yml up liquibase

services:
  liquibase:
    image: liquibase/liquibase:latest
    container_name: necpgame-liquibase
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      LIQUIBASE_COMMAND_URL: jdbc:postgresql://postgres:5432/necpgame
      LIQUIBASE_COMMAND_USERNAME: postgres
      LIQUIBASE_COMMAND_PASSWORD: postgres
      LIQUIBASE_COMMAND_CHANGELOG_FILE: changelog.yaml
    volumes:
      - ../../../liquibase:/liquibase:ro
    working_dir: /liquibase
    command: ["update"]
    networks:
      - default

networks:
  default:
    name: necpgame_postgres_default

