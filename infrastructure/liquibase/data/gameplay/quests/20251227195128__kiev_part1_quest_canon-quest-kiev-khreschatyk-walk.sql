--liquibase formatted sql

--changeset kiev-part1-quests:canon-quest-kiev-khreschatyk-walk runOnChange:true

INSERT INTO gameplay.quests (
    id,
    metadata_id,
    title,
    english_title,
    type,
    location,
    time_period,
    difficulty,
    estimated_duration,
    player_level_min,
    player_level_max,
    status,
    version,
    quest_definition,
    narrative_context,
    gameplay_mechanics,
    additional_npcs,
    environmental_challenges,
    visual_design,
    cultural_elements,
    metadata_hash,
    content_hash,
    created_at,
    updated_at,
    source_file
) VALUES (
    'fe32aeb1-931a-4f20-8ad4-ab6a867a0023',
    'canon-quest-kiev-khreschatyk-walk',
    'Киев 2020-2029 — «Прогулка по Крещатику»',
    'Киев 2020-2029 — «Прогулка по Крещатику»',
    'side',
    'Kiev',
    '2020-2029',
    'easy',
    '30-60 минут',
    1,
    NULL,
    'active',
    '1.0.0',
    '{
  "quest_type": "side",
  "level_min": 1,
  "level_max": null
}',
    '[
  {
    "id": "overview",
    "title": "Обзор: Киев 2020-2029 — «Прогулка по Крещатику»",
    "body": "Этот side квест \"Киев 2020-2029 — «Прогулка по Крещатику»\" предлагает увлекательное исследование и взаимодействие с миром игры.",
    "mechanics_links": [],
    "assets": []
  },
  {
    "id": "stages",
    "title": "Этапы выполнения",
    "body": "Этапы квеста:\n",
    "mechanics_links": [],
    "assets": []
  },
  {
    "id": "introduction",
    "title": "Прибытие на Крещатик",
    "body": "Квест начинается у станции метро \"Крещатик\" или на площади Независимости. Игрок получает уведомление о выходном дне на главной улице Киева.\n\n**Сценарий старта:**\nСистема показывает: \"Сегодня выходной день на Крещатике! Улица закрыта для транспорта, и город живет своей особой жизнью.\"\n\n**Визуальные эффекты:**\n- Яркое солнце, цветущие каштаны\n- Толпы улыбающихся людей\n- Музыка из динамиков и уличных артистов\n- Запах кофе и выпечки из кафе\n\n**Выбор стартовой точки:**\n- \"От Майдана Независимости\" → классический маршрут\n- \"От Европейской площади\" → современный маршрут\n- \"Посередине улицы\" → свободное исследование\n\n**Исторический контекст:**\nКрещатик - главная улица Киева длиной 1,2 км. По выходным с 2010-х закрывается для транспорта, становясь пешеходной зоной.\n",
    "mechanics_links": [
      "weather-system",
      "time-of-day-mechanics"
    ],
    "assets": [
      "location-khreschatyk-street",
      "ambient-street-sounds"
    ]
  },
  {
    "id": "observation_phase",
    "title": "Наблюдение и знакомство с атмосферой",
    "body": "Игрок начинает прогулку, просто наблюдая за происходящим вокруг.\n\n**Уровень 1: Пассивное наблюдение**\n- Уличные музыканты играют на гитарах и скрипках\n- Художники рисуют портреты прохожих\n- Фокусники показывают простые трюки\n- Продавцы продают сувениры и сладости\n\n**Интерактивные элементы:**\n- Прослушивание музыки (дает временный бафф настроения)\n- Осмотр картин художников (мини-игра на оценку искусства)\n- Фотографирование уличных сцен для коллекции\n\n**Случайные события:**\n- Внезапный дождь (нужно найти укрытие)\n- Неожиданная встреча с другом\n- Предложение сфотографироваться\n\n**Проверка восприятия:** Perception DC 12 → замечает интересные детали\n**Награда за уровень:** +5 XP, +1 к настроению, разблокировка общения\n",
    "mechanics_links": [
      "observation-mechanics",
      "random-events",
      "mood-system"
    ],
    "assets": [
      "street-performers",
      "ambient-animations"
    ]
  },
  {
    "id": "social_interactions",
    "title": "Общение с жителями и гостями",
    "body": "Игрок начинает активное взаимодействие с окружающими.\n\n**Уровень 2: Социальное взаимодействие**\n- Разговоры с местными жителями о жизни в Киеве\n- Обмен историями с туристами из других стран\n- Участие в уличных опросах и конкурсах\n- Помощь в простых делах (найти потерянную вещь)\n\n**Ключевые NPC:**\n- **Бабушка с каштанами:** Рассказывает истории старого Киева\n- **Молодой музыкант:** Предлагает сыграть вместе\n- **Турист из Азии:** Просит перевести указатели\n- **Уличный художник:** Предлагает нарисовать портрет\n\n**Диалоговые ветки:**\n- Рассказы о прошлом Киева (исторические факты)\n- Обсуждение современной жизни (социальные темы)\n- Шутки и анекдоты (повышение настроения)\n- Советы по городу (практическая информация)\n\n**Система отношений:**\n- Успешные разговоры повышают социальную репутацию\n- Помощь NPC дает дополнительные очки дружбы\n- Юморные диалоги дают бонусы настроения\n\n**Проверка общения:** Communication DC 14 → глубокие разговоры\n**Награда за уровень:** +10 XP, +2 к настроению, социальные связи\n",
    "mechanics_links": [
      "dialogue-system",
      "social-reputation",
      "relationship-system"
    ],
    "assets": [
      "diverse-npc-models",
      "conversation-interfaces"
    ]
  },
  {
    "id": "active_participation",
    "title": "Активное участие в уличной жизни",
    "body": "Игрок полностью погружается в атмосферу улицы, участвуя в активностях.\n\n**Уровень 3: Активное участие**\n- Танцы под уличную музыку\n- Участие в импровизированных спектаклях\n- Покупка уличной еды и напитков\n- Фотосессии и селфи с окружающими\n\n**Мини-игры и активности:**\n- **Уличные танцы:** Следование ритму (QTE система)\n- **Караоке:** Пение с музыкантами\n- **Уличная еда:** Дегустация и оценка блюд\n- **Фотоконкурс:** Лучшие снимки Крещатика\n\n**Специальные события:**\n- Флешмоб (неожиданный массовый танец)\n- Уличный концерт известного музыканта\n- Парад уличных артистов\n- Религиозная процессия\n\n**Экономический аспект:**\n- Покупка кофе, мороженого, сувениров\n- Чаевые артистам и продавцам\n- Выигрыш в уличных конкурсах\n\n**Проверка активности:** Dexterity/Charisma DC 16 → идеальное исполнение\n**Награда за уровень:** +15 XP, +3 к настроению, достижения\n",
    "mechanics_links": [
      "mini-games-system",
      "economic-system",
      "event-system"
    ],
    "assets": [
      "interactive-animations",
      "mini-game-interfaces"
    ]
  },
  {
    "id": "deep_immersion",
    "title": "Глубокое погружение в киевскую жизнь",
    "body": "Финальная фаза квеста - полное слияние с атмосферой улицы.\n\n**Уровень 4: Глубокое погружение**\n- Становление частью толпы\n- Осознание ритма города\n- Эмоциональная связь с Киевом\n- Философские размышления о жизни\n\n**Интроспективные моменты:**\n- Размышления о быстротечности жизни\n- Воспоминания о собственном прошлом\n- Осознание важности простых радостей\n- Связь с коллективным духом города\n\n**Мистические элементы:**\n- \"Дух Крещатика\" - ощущение присутствия истории\n- Синхронизация с ритмом города\n- Чувство принадлежности к сообществу\n\n**Завершающий ритуал:**\n- Посадка воображаемого каштана\n- Оставление следа в цифровой книге пожеланий\n- Финальный танец под закат\n\n**Проверка эмпатии:** Wisdom DC 18 → глубокие прозрения\n**Награда за уровень:** +20 XP, +4 к настроению, духовное просветление\n",
    "mechanics_links": [
      "introspection-mechanics",
      "spiritual-system",
      "city-bond-system"
    ],
    "assets": [
      "atmospheric-effects",
      "philosophical-dialogues"
    ]
  },
  {
    "id": "rewards_completion",
    "title": "Награды и последствия",
    "body": "В зависимости от глубины участия игрок получает соответствующие награды.\n\n**Базовые награды (все уровни):**\n- 500 XP\n- +5 к параметру \"Настроение\"\n- Достижение \"Прогулка по Крещатику\"\n\n**Расширенные награды (3+ уровня):**\n- Дополнительные 250 XP\n- +3 к параметру \"Социальность\"\n- Доступ к социальной сети Киева\n\n**Полные награды (все уровни):**\n- Дополнительные 500 XP\n- +5 к обоим параметрам\n- Достижение \"Дух Крещатика\"\n- Временный бафф \"Киевское Настроение\" (48 часов)\n\n**Снижение стресса:**\n- -30% от текущего уровня стресса\n- Временная защита от стрессовых событий\n- Улучшение сна и восстановления\n\n**Долгосрочные эффекты:**\n- Повышенная социальная репутация в Киеве\n- Доступ к специальным социальным событиям\n- Бонусы к взаимодействию с киевскими NPC\n- Возможность стать \"Киевским Гидом\"\n\n**Экономические последствия:**\n- Потраченные деньги на кафе и сувениры (-500 едди)\n- Возможный выигрыш от конкурсов (+100-300 едди)\n- Специальные скидки в местных заведениях\n",
    "mechanics_links": [
      "reward-system",
      "mood-system",
      "stress-reduction",
      "reputation-system"
    ],
    "assets": [
      "reward-screens",
      "achievement-icons",
      "mood-indicators"
    ]
  },
  {
    "id": "technical_details",
    "title": "Технические детали реализации",
    "body": "**Система прогресса:**\n- Quest progress: 0-100% с чекпоинтами на каждом уровне\n- Social interaction counter: количество успешных взаимодействий\n- Mood improvement tracking: отслеживание изменения настроения\n\n**Интеграция с системами:**\n- Mood system: повышение настроения и снижение стресса\n- Social system: новые связи и репутационные изменения\n- Time system: ограничение выходными днями\n\n**Баланс и тестирование:**\n- DC проверки откалиброваны для среднего уровня 15-35\n- Время прохождения: 1-2 часа\n- Риск провала: минимальный (социальные активности)\n",
    "mechanics_links": [
      "quest-progression",
      "balance-system",
      "integration-points"
    ],
    "assets": [
      "quest-tracker-ui",
      "social-interaction-ui",
      "mood-tracking-interface"
    ]
  }
]',
    '{}',
    '[]',
    '[]',
    '{}',
    '{}',
    '50192aa1a7ce6381807b29f856b3bd25de5f0068705bf704f300110e3fca9e6b',
    '30b6ef117de8ccfc3a6efc93066aba3c6b3a1b9ab4e38ab5ebe825e3296220eb',
    CURRENT_TIMESTAMP,
    CURRENT_TIMESTAMP,
    'knowledge\canon\lore\timeline-author\quests\cis\kiev\2020-2029\quest-009-khreschatyk-walk.yaml'
);

--rollback DELETE FROM gameplay.quests WHERE metadata_id = 'canon-quest-kiev-khreschatyk-walk';

