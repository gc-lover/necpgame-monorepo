--liquibase formatted sql

--changeset kiev-part1-quests:canon-quest-kiev-cossack-heritage runOnChange:true

INSERT INTO gameplay.quests (
    id,
    metadata_id,
    title,
    english_title,
    type,
    location,
    time_period,
    difficulty,
    estimated_duration,
    player_level_min,
    player_level_max,
    status,
    version,
    quest_definition,
    narrative_context,
    gameplay_mechanics,
    additional_npcs,
    environmental_challenges,
    visual_design,
    cultural_elements,
    metadata_hash,
    content_hash,
    created_at,
    updated_at,
    source_file
) VALUES (
    'a146f128-fde3-401a-a769-2abedf47f20e',
    'canon-quest-kiev-cossack-heritage',
    'Киев 2020-2029 — «Казацкое наследие»',
    'Киев 2020-2029 — «Казацкое наследие»',
    'side',
    'Kiev',
    '2020-2029',
    'easy',
    '30-60 минут',
    1,
    NULL,
    'active',
    '1.0.0',
    '{
  "quest_type": "side",
  "level_min": 1,
  "level_max": null
}',
    '[
  {
    "id": "overview",
    "title": "Обзор: Киев 2020-2029 — «Казацкое наследие»",
    "body": "Этот side квест \"Киев 2020-2029 — «Казацкое наследие»\" предлагает увлекательное исследование и взаимодействие с миром игры.",
    "mechanics_links": [],
    "assets": []
  },
  {
    "id": "stages",
    "title": "Этапы выполнения",
    "body": "Этапы квеста:\n",
    "mechanics_links": [],
    "assets": []
  },
  {
    "id": "call_to_arms",
    "title": "Призыв к оружию",
    "body": "Квест начинается с получения таинственного сообщения или слухов о возрождении казачьего братства. Игрок находит старый чубук (трубку) с выгравированным казачьим гербом.\n\n**Сценарий активации:**\nВ таверне или на базаре игрок слышит разговоры о \"новых казаках\" на Хортице. Один из посетителей оставляет чубук с запиской: \"Если кровь бурлит, как Днепр в половодье, приходи к нам\".\n\n**Выборы:**\n- \"Интересно, что там?\" → квест принят\n- \"Казаки? Это же история\" → отказ, но возможность передумать позже\n- \"Расскажите подробнее\" → дополнительные подсказки о локации\n\n**Исторический контекст:**\nКазаки - воины XVII-XVIII веков, защищавшие Украину от захватчиков. В 2020-х годах традиция возрождается как культурное движение с элементами боевых искусств.\n",
    "mechanics_links": [
      "quest-discovery-mechanics",
      "rumor-system"
    ],
    "assets": [
      "cossack-pipe-artifact",
      "tavern-ambient-sounds"
    ]
  },
  {
    "id": "journey_to_khortytsia",
    "title": "Путешествие на Хортицу",
    "body": "Игрок отправляется на остров Хортица - историческую родину запорожских казаков, расположенную на Днепре недалеко от Запорожья.\n\n**Путь к острову:**\n- Автобусом или поездом до Запорожья\n- Паромом через Днепр на остров\n- Пешком по историческим тропам\n\n**Встречи в пути:**\n- Старик-рыбак рассказывает легенды о казаках\n- Туристы фотографируют исторические места\n- Дикие животные (олени, птицы) создают атмосферу\n\n**Подготовка к встрече:**\n- Сбор информации о казачьих традициях\n- Покупка скромных подарков (табак, горилка)\n- Размышления о собственной готовности\n\n**Проверка восприятия:** Perception DC 14 → замечает скрытые казачьи символы\n**Награда за этап:** +100 XP, знание о локации сбора\n",
    "mechanics_links": [
      "travel-mechanics",
      "exploration-system"
    ],
    "assets": [
      "khortytsia-island-map",
      "dnieper-river-sounds"
    ]
  },
  {
    "id": "first_encounter",
    "title": "Первая встреча с казаками",
    "body": "На острове игрок находит временный лагерь казаков и проходит первое собеседование.\n\n**Сцена встречи:**\nГруппа мужчин в казачьей одежде (шаровары, вышиванки, оселедцы) занимается тренировками. Атаман - крепкий мужчина средних лет - замечает пришельца.\n\n**Диалог с атаманом:**\n\"Что привело тебя в нашу сечь, странник? Ищешь славы или просто любопытствуешь? Казаки не принимают каждого, кто постучит в дверь.\"\n\n**Вопросы атамана:**\n- Почему ты хочешь присоединиться к казакам?\n- Что ты знаешь о нашей истории?\n- Готов ли ты к испытаниям?\n\n**Проверка харизмы:** Charisma DC 16 → положительное впечатление\n- Успех: приглашение остаться на ночь у костра\n- Провал: совет вернуться позже, после раздумий\n\n**Знакомство с традициями:**\n- Рассказы у костра о казачьей славе\n- Демонстрация боевых приемов\n- Традиционная казачья кухня\n",
    "mechanics_links": [
      "dialogue-system",
      "charisma-checks",
      "faction-introduction"
    ],
    "assets": [
      "cossack-camp-models",
      "campfire-atmosphere"
    ]
  },
  {
    "id": "preparation_phase",
    "title": "Подготовка к испытаниям",
    "body": "После положительного впечатления игроку дают время подготовиться к четырем великим испытаниям казака.\n\n**Обучение основам:**\n- Изучение казачьей истории и традиций\n- Базовые уроки верховой езды\n- Знакомство с казачьим оружием (шабля, лук)\n\n**Физическая подготовка:**\n- Утренние пробежки по острову\n- Плавание в Днепре\n- Упражнения с оружием\n\n**Духовная подготовка:**\n- Медитация у казачьих курганов\n- Изучение казачьих заповедей\n- Размышления о чести и свободе\n\n**Сбор снаряжения:**\n- Казачья одежда (шаровары, вышиванка)\n- Базовое оружие (деревянная сабля для тренировок)\n- Символические предметы (чубук, пояс)\n\n**Проверка силы:** Strength DC 14 → успешная подготовка\n**Награда за этап:** +200 XP, казачья экипировка\n",
    "mechanics_links": [
      "training-mechanics",
      "equipment-system",
      "character-development"
    ],
    "assets": [
      "training-grounds",
      "cossack-armor-preview"
    ]
  },
  {
    "id": "trial_of_horse",
    "title": "Первое испытание - Конь",
    "body": "Испытание верховой езды - основа казачьей жизни. Конь для казака как брат.\n\n**Задание:**\nОседлать дикого коня и проехать маршрут по острову, преодолевая препятствия.\n\n**Этапы испытания:**\n1. Выбор и успокоение коня (Animal Handling DC 16)\n2. Прыжки через барьеры (Acrobatics DC 15)\n3. Стрельба на скаку из лука (Ranged Attack DC 18)\n4. Возвращение в лагерь в срок\n\n**Философия испытания:**\n\"Конь должен чувствовать твою волю, а ты - его силу. В битве вы одно целое.\"\n\n**Награды за успех:**\n- +5 к навыку верховой езды\n- Казачья лошадь как companion\n- Уважение братьев\n\n**Последствия провала:**\n- Повтор через неделю\n- Потеря уважения\n- Дополнительные тренировки\n",
    "mechanics_links": [
      "riding-mechanics",
      "animal-handling",
      "skill-progression"
    ],
    "assets": [
      "horse-trial-course",
      "cossack-horses"
    ]
  },
  {
    "id": "trial_of_saber",
    "title": "Второе испытание - Шабля",
    "body": "Владение казачькой саблей - искусство боя и чести. Шабля не просто оружие, а символ свободы.\n\n**Задание:**\nТурнир по фехтованию с опытными казаками. Показать мастерство и благородство.\n\n**Этапы испытания:**\n1. Базовые формы (Form Training DC 16)\n2. Дуэль с инструктором (Combat DC 18)\n3. Групповой бой (Team Combat DC 20)\n4. Демонстрация чести (победа без убийства)\n\n**Философия испытания:**\n\"Шабля режет врага, но честь режет душу. Настоящий казак защищает слабых.\"\n\n**Специальные техники:**\n- Казачьи рубящие удары\n- Защитные приемы с плащом\n- Комбо с пистолетами\n\n**Награды за успех:**\n- +10% к урону холодным оружием\n- Казачья сабля\n- Боевой стиль \"Казацкий\"\n",
    "mechanics_links": [
      "melee-combat-system",
      "weapon-mastery",
      "honor-system"
    ],
    "assets": [
      "saber-training-animations",
      "cossack-saber-models"
    ]
  },
  {
    "id": "trial_of_bow",
    "title": "Третье испытание - Лук",
    "body": "Стрельба из лука - искусство дальнего боя и терпения. Казаки были непревзойденными лучниками.\n\n**Задание:**\nСтрельба по мишеням разной сложности на дистанции и в движении.\n\n**Этапы испытания:**\n1. Статическая стрельба по мишеням (Ranged DC 16)\n2. Движущиеся цели (Tracking DC 18)\n3. Стрельба верхом (Mounted Archery DC 20)\n4. \"Охотничий вызов\" (Survival DC 19)\n\n**Философия испытания:**\n\"Стрела летит прямо, как казачья правда. Промах - это слабость духа.\"\n\n**Казачьи техники:**\n- Стрельба с двух рук\n- Специальные стрелы (зажигательные, сигнальные)\n- Охота на крупную дичь\n\n**Награды за успех:**\n- +15% точность лука\n- Казачий лук и колчан стрел\n- Навык \"Казачья охота\"\n",
    "mechanics_links": [
      "archery-system",
      "ranged-combat",
      "hunting-mechanics"
    ],
    "assets": [
      "archery-range-models",
      "cossack-bow-weapons"
    ]
  },
  {
    "id": "trial_of_spirit",
    "title": "Четвертое испытание - Дух",
    "body": "Танец гопак - выражение казачьего духа, свободы и жизнерадостности.\n\n**Задание:**\nИсполнить гопак перед советом старейшин и доказать, что дух не сломлен.\n\n**Этапы испытания:**\n1. Изучение базовых шагов (Performance DC 14)\n2. Импровизация (Creativity DC 16)\n3. Танец с препятствиями (Agility DC 18)\n4. Финальное исполнение (Spirit DC 20)\n\n**Философия испытания:**\n\"Танец - это битва с самим собой. Высокий прыжок - преодоление страха.\"\n\n**Элементы гопака:**\n- Высокие прыжки (символ свободы)\n- Быстрые вращения (казачья удаль)\n- Импровизация (творческий дух)\n\n**Награды за успех:**\n- +20% к моральным бонусам\n- Бафф \"Казацкий дух\" (в бою)\n- Респект всего братства\n",
    "mechanics_links": [
      "performance-system",
      "dance-mechanics",
      "morale-system"
    ],
    "assets": [
      "gopak-dance-animations",
      "traditional-music"
    ]
  },
  {
    "id": "initiation_ceremony",
    "title": "Церемония посвящения",
    "body": "Кульминация квеста - официальное принятие в казачье братство.\n\n**Подготовка к церемонии:**\n- Очищение в Днепре (символическое)\n- Надевание полной казачьей формы\n- Медитация у казачьих могил\n\n**Церемония:**\n1. Клятва верности традициям\n2. Вручение сабли атаманом\n3. Питье горилки из чарки\n4. Боевой клич \"Слава козацтву!\"\n\n**Символические акты:**\n- Заплетание оселедца\n- Вручение пояса и шаровар\n- Братский поцелуй\n\n**Финальный момент:**\nАтаман провозглашает: \"Отныне ты - казак! Защищай слабых, чти традиции, живи свободно!\"\n\n**Эмоциональный пик:**\nЧувство принадлежности к древнему братству, ответственности за наследие.\n",
    "mechanics_links": [
      "ceremony-system",
      "faction-joining",
      "emotional-mechanics"
    ],
    "assets": [
      "initiation-ceremony-scenes",
      "cossack-full-armor"
    ]
  },
  {
    "id": "rewards_completion",
    "title": "Награды и братство",
    "body": "После успешного посвящения игрок становится полноправным членом казачьего братства.\n\n**Базовые награды:**\n- 4000 XP\n- +15% к бонусам кавалерии\n- Казачья сабля и лук\n- Достижение \"Казак\"\n\n**Фракционные привилегии:**\n- Доступ к казачьим квестам\n- Скидки в казачьих магазинах\n- Казачьи союзники в боях\n- Репутация в военных кругах\n\n**Навыки и способности:**\n- Боевой стиль \"Казацкий\" (+10% урон в конном бою)\n- Навык \"Верховая езда\" (улучшен)\n- Бафф \"Братство\" (моральные бонусы от союзников)\n\n**Долгосрочные эффекты:**\n- Квесты от атамана\n- Возможность стать офицером\n- Защита от бандитов\n- Участие в казачьих праздниках\n\n**Специальные предметы:**\n- Казачья форма (защита + сопротивление страху)\n- Чубук с казачьим гербом (артефакт)\n- Горилка \"Казачья\" (восстанавливает здоровье и мораль)\n",
    "mechanics_links": [
      "reward-system",
      "faction-system",
      "progression-system"
    ],
    "assets": [
      "cossack-reward-items",
      "faction-interface"
    ]
  },
  {
    "id": "technical_details",
    "title": "Технические детали реализации",
    "body": "**Система прогресса:**\n- Quest progress: 0-100% с чекпоинтами на каждом испытании\n- Trial success rate: отслеживание прохождения испытаний\n- Faction reputation: рост уважения в братстве\n\n**Интеграция с системами:**\n- Faction system: новые квесты и привилегии\n- Combat system: казачьи боевые стили\n- Reputation system: фракционная лояльность\n\n**Баланс и тестирование:**\n- DC проверки откалиброваны для уровня 30-50\n- Время прохождения: 4-6 часов\n- Риск провала: средний (возможность повторных попыток)\n",
    "mechanics_links": [
      "quest-progression",
      "balance-system",
      "integration-points"
    ],
    "assets": [
      "quest-tracker-ui",
      "faction-progression-tree",
      "balance-sheets"
    ]
  }
]',
    '{}',
    '[]',
    '[]',
    '{}',
    '{}',
    '81a1c92ed1c481d68f75d2318ab9fb6cdd6b9cfffe2bf145601f499299c88dd3',
    '30b6ef117de8ccfc3a6efc93066aba3c6b3a1b9ab4e38ab5ebe825e3296220eb',
    CURRENT_TIMESTAMP,
    CURRENT_TIMESTAMP,
    'knowledge\canon\lore\timeline-author\quests\cis\kiev\2020-2029\quest-010-cossack-heritage.yaml'
);

--rollback DELETE FROM gameplay.quests WHERE metadata_id = 'canon-quest-kiev-cossack-heritage';

