databaseChangeLog:
- changeSet:
    id: documentation-README-a8cf443c
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '8493768100093131'
        - column:
            name: doc_id
            value: narrative-coherence-quest-sql-migrations
        - column:
            name: title
            value: SQL Migrations for Quest System
        - column:
            name: document_type
            value: canon
        - column:
            name: category
            value: narrative-coherence
        - column:
            name: status
            value: approved
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-07 00:28:00+00:00
        - column:
            name: concept_approved
            value: true
        - column:
            name: concept_reviewed_at
            value: 2025-11-07 00:28:00+00:00
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - migrations
            - sql
            - narrative
        - column:
            name: topics
            value:
            - database
            - quest-system
        - column:
            name: related_systems
            value:
            - narrative-service
            - world-state-service
        - column:
            name: related_documents
            value: '[{"id": "narrative-coherence-quest-branches", "relation": "references"},
              {"id": "narrative-coherence-dialogue-system", "relation": "references"}]'
        - column:
            name: source
            value: shared/docs/knowledge/canon/narrative/narrative-coherence/phase4-database/migrations/README.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - backend
            - devops
            - concept
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "narrative-coherence-quest-sql-migrations",
              "title": "SQL Migrations for Quest System", "document_type": "canon",
              "category": "narrative-coherence", "status": "approved", "version":
              "1.0.0", "last_updated": "2025-11-07T00:28:00+00:00", "concept_approved":
              true, "concept_reviewed_at": "2025-11-07T00:28:00+00:00", "owners":
              [{"role": "concept_director", "contact": "concept@necp.game"}], "tags":
              ["migrations", "sql", "narrative"], "topics": ["database", "quest-system"],
              "related_systems": ["narrative-service", "world-state-service"], "related_documents":
              [{"id": "narrative-coherence-quest-branches", "relation": "references"},
              {"id": "narrative-coherence-dialogue-system", "relation": "references"}],
              "source": "shared/docs/knowledge/canon/narrative/narrative-coherence/phase4-database/migrations/README.md",
              "visibility": "internal", "audience": ["backend", "devops", "concept"],
              "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "", "reviewed_at": "2025-11-07T00:28:00+00:00", "status":
              "approved"}], "next_actions": []}, "summary": {"problem": "Нужно консолидировать
              набор миграций для запуска квестового графа и world state в production.",
              "goal": "Перечислить SQL-скрипты, способы их применения, отката и проверки
              результатов.", "essence": "Документ описывает пять основных миграций,
              команды для Linux/Windows и процедуры валидации схемы.", "key_points":
              ["В комплект входит пять миграций, расширяющих таблицы квестов и создающих
              world state.", "Предоставлены инструкции для автоматического и ручного
              применения.", "Добавлены шаги rollback и SQL проверки таблиц и индексов."]},
              "content": {"sections": [{"id": "overview", "title": "Краткое описание",
              "body": "Набор миграций формирует базу данных для квестовой системы,
              диалогов, трекинга игрока и world state. Документ\nслужит источником
              ссылок при деплое и обновлениях.\n", "mechanics_links": [], "assets":
              []}, {"id": "migrations-list", "title": "Список миграций", "body": "1.
              `001-expand-quests-table.sql` — расширяет таблицу `quests`.\n2. `002-create-quest-branches.sql`
              — создаёт `quest_branches`.\n3. `003-create-dialogue-system.sql` — добавляет
              узлы и выборы диалогов.\n4. `004-create-player-systems.sql` — создаёт
              таблицы выбора игрока и флагов.\n5. `005-create-world-state-system.sql`
              — формирует трёхуровневый world state.\n\nВсего: 5 миграций, более 24
              таблиц.\n", "mechanics_links": ["services/backend/database/migration-index.yaml"],
              "assets": []}, {"id": "apply", "title": "Как применить", "body": "###
              Linux/Mac\n```\nexport DB_NAME=necpgame\nexport DB_USER=postgres\nexport
              DB_PASSWORD=your_password\nexport DB_HOST=localhost\nexport DB_PORT=5432\nchmod
              +x apply-all-migrations.sh\n./apply-all-migrations.sh\n```\n\n### Windows\n```\n$env:DB_NAME
              = \"necpgame\"\n$env:DB_USER = \"postgres\"\n$env:DB_PASSWORD = \"your_password\"\n$env:DB_HOST
              = \"localhost\"\n$env:DB_PORT = \"5432\"\n.\\apply-all-migrations.ps1\n```\n\n###
              Вручную\n```\npsql -d necpgame -U postgres -f 001-expand-quests-table.sql\npsql
              -d necpgame -U postgres -f 002-create-quest-branches.sql\npsql -d necpgame
              -U postgres -f 003-create-dialogue-system.sql\npsql -d necpgame -U postgres
              -f 004-create-player-systems.sql\npsql -d necpgame -U postgres -f 005-create-world-state-system.sql\n```\n",
              "mechanics_links": [], "assets": []}, {"id": "rollback", "title": "Rollback",
              "body": "Выполняется в обратном порядке:\n```\npsql -d necpgame -f rollback/005-rollback-world-state.sql\npsql
              -d necpgame -f rollback/004-rollback-player-systems.sql\npsql -d necpgame
              -f rollback/003-rollback-dialogue.sql\npsql -d necpgame -f rollback/002-rollback-branches.sql\npsql
              -d necpgame -f rollback/001-rollback-expand-quests.sql\n```\n", "mechanics_links":
              ["services/backend/database/migration-rollback.yaml"], "assets": []},
              {"id": "verification", "title": "Проверка", "body": "После применения
              миграций:\n```\n\\dt quest*\n\\dt player*\n\\dt server*\n\\dt dialogue*\n\\dt
              territory*\n\\di quest*\nSELECT * FROM quest_branches LIMIT 5;\nSELECT
              * FROM server_world_state;\nSELECT * FROM territory_control;\n```\n",
              "mechanics_links": [], "assets": []}, {"id": "created-tables", "title":
              "Созданные сущности", "body": "- Quest System: `quests` (расширенная),
              `quest_branches`, `dialogue_nodes`, `dialogue_choices`.\n- Player Tracking:
              `player_quest_choices`, `player_flags`, `player_dialogue_progress`.\n-
              Quest Objectives: `quest_objectives`.\n- World State: `player_world_state`,
              `server_world_state`, `world_state_votes`, `faction_world_state`, `territory_control`.\n\nИтого:
              13 таблиц плюс вспомогательные функции.\n", "mechanics_links": [], "assets":
              []}]}, "appendix": {"glossary": [], "references": [], "decisions": []},
              "implementation": {"github_issue": 109, "needs_task": false, "queue_reference":
              [], "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-11-07",
              "author": "concept_director", "changes": "Полный набор миграций оформлен
              и снабжён инструкциями по применению и откату."}], "validation": {"checksum":
              "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "narrative-coherence-quest-sql-migrations", "title": "SQL
              Migrations for Quest System", "document_type": "canon", "category":
              "narrative-coherence", "status": "approved", "version": "1.0.0", "last_updated":
              "2025-11-07T00:28:00+00:00", "concept_approved": true, "concept_reviewed_at":
              "2025-11-07T00:28:00+00:00", "owners": [{"role": "concept_director",
              "contact": "concept@necp.game"}], "tags": ["migrations", "sql", "narrative"],
              "topics": ["database", "quest-system"], "related_systems": ["narrative-service",
              "world-state-service"], "related_documents": [{"id": "narrative-coherence-quest-branches",
              "relation": "references"}, {"id": "narrative-coherence-dialogue-system",
              "relation": "references"}], "source": "shared/docs/knowledge/canon/narrative/narrative-coherence/phase4-database/migrations/README.md",
              "visibility": "internal", "audience": ["backend", "devops", "concept"],
              "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\canon\narrative\narrative-coherence\phase4-database\migrations\README.yaml
