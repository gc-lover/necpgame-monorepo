databaseChangeLog:
- changeSet:
    id: documentation-api-integration-0b3897c2
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-415033307821936'
        - column:
            name: doc_id
            value: narrative-coherence-api-integration
        - column:
            name: title
            value: API Integration Guide
        - column:
            name: document_type
            value: canon
        - column:
            name: category
            value: narrative-coherence
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-07 00:01:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - api
            - narrative-coherence
            - integration
        - column:
            name: topics
            value:
            - quest-service
            - world-state
        - column:
            name: related_systems
            value:
            - narrative-service
            - quest-service
            - world-state-service
        - column:
            name: related_documents
            value: '[{"id": "narrative-coherence-developer-guide", "relation": "references"},
              {"id": "narrative-coherence-quest-tables", "relation": "references"}]'
        - column:
            name: source
            value: shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/api-integration.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - backend
            - api
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "narrative-coherence-api-integration", "title":
              "API Integration Guide", "document_type": "canon", "category": "narrative-coherence",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-07T00:01:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["api",
              "narrative-coherence", "integration"], "topics": ["quest-service", "world-state"],
              "related_systems": ["narrative-service", "quest-service", "world-state-service"],
              "related_documents": [{"id": "narrative-coherence-developer-guide",
              "relation": "references"}, {"id": "narrative-coherence-quest-tables",
              "relation": "references"}], "source": "shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/api-integration.md",
              "visibility": "internal", "audience": ["concept", "backend", "api"],
              "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions":
              []}, "summary": {"problem": "Требуется описать интеграцию квестового
              графа и глобального состояния с REST и WebSocket интерфейсами.", "goal":
              "Зафиксировать рекомендуемые эндпоинты, структуры данных и события для
              сервисов narrative и world state.", "essence": "Документ определяет
              единый контракт API, охватывающий чтение и обновление квестов, мирового
              состояния и подписку на события.", "key_points": ["Рекомендованные REST
              маршруты для квестов и мирового состояния с параметрами запросов.",
              "Типы данных для сущностей Quest, WorldState и PlayerFlag.", "WebSocket
              события и стандартные ответы об ошибках."]}, "content": {"sections":
              [{"id": "overview", "title": "Краткое описание", "body": "Руководство
              описывает интеграцию квестового графа и глобального состояния через
              REST и WebSocket. Оно задаёт\nструктуру API для получения, обновления
              и отслеживания изменений в игре.\n", "mechanics_links": [], "assets":
              []}, {"id": "quest-api", "title": "Quest API", "body": "Рекомендуемые
              эндпоинты:\n\n```\nGET /api/v1/narrative/quests/available\n  Query:
              characterId*, era, type\n  Response: quests[], total\n\nGET /api/v1/narrative/quests/{questId}\n  Query:
              characterId*\n  Response: quest, branches[], dialogue_tree, available,
              blocked_by[]\n\nPOST /api/v1/narrative/quests/{questId}/choice\n  Body:
              characterId, choiceId, nodeId\n  Response: success, consequences, unlocked_quests[],
              blocked_quests[], reputation_changes, flags_set[]\n```\n", "mechanics_links":
              ["services/backend/narrative/api-spec.yaml"], "assets": []}, {"id":
              "world-state-api", "title": "World State API", "body": "Эндпоинты мирового
              состояния:\n\n```\nGET /api/v1/narrative/world-state\n  Query: characterId*,
              serverId*\n  Response: personal_state, server_state, faction_state,
              combined_view\n\nPOST /api/v1/narrative/world-state/vote\n  Body: characterId,
              serverId, stateKey, voteValue\n  Response: vote_recorded, current_votes,
              threshold_required, status\n\nGET /api/v1/narrative/territory-control\n  Query:
              serverId*, territoryId\n  Response: territories[]\n```\n", "mechanics_links":
              ["services/backend/world-state/api-overview.yaml"], "assets": []}, {"id":
              "data-models", "title": "Модели данных", "body": "Основные структуры:\n\n```\ninterface
              Quest {\n  id: string;\n  name: string;\n  description: string;\n  type:
              QuestType;\n  era: string;\n  minLevel: number;\n  requiredQuests: string[];\n  requiredFlags:
              Flag[];\n  hasBranches: boolean;\n  dialogueTreeRoot: number | null;\n  rewards:
              Rewards;\n}\n```\n\n```\ninterface WorldState {\n  personal: Map<string,
              any>;\n  server: Map<string, any>;\n  faction: Map<string, any> | null;\n}\n```\n\n```\ninterface
              PlayerFlag {\n  characterId: UUID;\n  flagKey: string;\n  flagValue:
              any;\n  setByQuest: string | null;\n  createdAt: Date;\n}\n```\n", "mechanics_links":
              ["services/backend/narrative/data-contracts.yaml"], "assets": []}, {"id":
              "websocket", "title": "WebSocket события", "body": "Канал реального
              времени поддерживает события:\n\n```\nworld_state_changed:\n  serverId,
              stateKey, oldValue, newValue, timestamp\n\nquest_unlocked:\n  characterId,
              questId, unlockedBy, timestamp\n\nterritory_control_changed:\n  serverId,
              territoryId, oldFaction, newFaction, controlPercentage\n```\n", "mechanics_links":
              ["services/backend/narrative/realtime-events.yaml"], "assets": []},
              {"id": "error-handling", "title": "Обработка ошибок", "body": "Стандартные
              ответы:\n\n```\nQUEST_NOT_AVAILABLE → причины недоступности, требования
              уровня\nQUEST_BLOCKED → блокировка выбором, возможность восстановления\nCHOICE_INVALID
              → недоступная ветка, требуемый навык\n```\n", "mechanics_links": ["services/backend/common/error-codes.yaml"],
              "assets": []}, {"id": "references", "title": "Связанные документы",
              "body": "- Developer Guide\n- Quest Tables\n- Event Matrix Architecture\n",
              "mechanics_links": [], "assets": [{"type": "document", "path": "shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/developer-guide.yaml"}]}]},
              "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation":
              {"github_issue": 109, "needs_task": false, "queue_reference": [], "blockers":
              []}, "history": [{"version": "1.0.0", "date": "2025-11-07", "author":
              "concept_director", "changes": "Конвертирован гайд по интеграции API
              из Markdown в YAML и структурирован по разделам контрактов."}], "validation":
              {"checksum": "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "narrative-coherence-api-integration", "title": "API Integration
              Guide", "document_type": "canon", "category": "narrative-coherence",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-07T00:01:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["api",
              "narrative-coherence", "integration"], "topics": ["quest-service", "world-state"],
              "related_systems": ["narrative-service", "quest-service", "world-state-service"],
              "related_documents": [{"id": "narrative-coherence-developer-guide",
              "relation": "references"}, {"id": "narrative-coherence-quest-tables",
              "relation": "references"}], "source": "shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/api-integration.md",
              "visibility": "internal", "audience": ["concept", "backend", "api"],
              "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\canon\narrative\narrative-coherence\phase6-documentation\dev-guides\api-integration.yaml
