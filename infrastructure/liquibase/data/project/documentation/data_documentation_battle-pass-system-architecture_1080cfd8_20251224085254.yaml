databaseChangeLog:
- changeSet:
    id: documentation-battle-pass-system-architecture-1080cfd8
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-185775053611942'
        - column:
            name: doc_id
            value: architecture-battle-pass-system
        - column:
            name: title
            value: Battle Pass System Architecture
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: implementation
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-02 18:30:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect"}]'
        - column:
            name: tags
            value:
            - battle-pass
            - monetization
            - progression
            - architecture
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - battle-pass-service
            - economy-service
            - notification-service
            - quest-service
            - achievement-service
        - column:
            name: related_documents
            value: '[{"id": "backend-battle-pass-overview", "relation": "implements"},
              {"id": "backend-battle-pass-part1-core", "relation": "implements"},
              {"id": "backend-battle-pass-part2-rewards", "relation": "implements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: ''
        - column:
            name: audience
            value: []
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "architecture-battle-pass-system", "title":
              "Battle Pass System Architecture", "document_type": "architecture",
              "category": "implementation", "status": "draft", "version": "1.0.0",
              "last_updated": "2025-12-02T18:30:00+00:00", "owners": [{"role": "architect"}],
              "tags": ["battle-pass", "monetization", "progression", "architecture"],
              "related_systems": ["battle-pass-service", "economy-service", "notification-service",
              "quest-service", "achievement-service"], "related_documents": [{"id":
              "backend-battle-pass-overview", "relation": "implements"}, {"id": "backend-battle-pass-part1-core",
              "relation": "implements"}, {"id": "backend-battle-pass-part2-rewards",
              "relation": "implements"}]}, "summary": {"problem": "Необходима архитектура
              Battle Pass для сезонов, прогрессии, наград и премиум-треков.", "goal":
              "Спроектировать систему Battle Pass с сезонами, прогрессией, наградами
              и челленджами.", "essence": "Event-driven система сезонной прогрессии
              с бесплатным и премиум треками."}, "content": {"sections": [{"id": "system-overview",
              "title": "Обзор", "body": "Battle Pass System:\n- Сезонная прогрессия
              (100 уровней)\n- Бесплатный и премиум треки\n- Еженедельные челленджи\n-
              Система XP источников\n- Выдача наград\n- Интеграция с экономикой\n"},
              {"id": "components", "title": "Компоненты", "body": "## battle-pass-service\n**Port:**
              TBD (8087 recommended)\n**API:** `/api/v1/economy/battle-pass/*`\n\nКомпоненты:\n-
              SeasonManager - управление сезонами\n- ProgressionTracker - отслеживание
              прогресса\n- RewardDistributor - выдача наград\n- ChallengeGenerator
              - генерация челленджей\n- PremiumHandler - обработка премиум покупок\n-
              XPSystem - система опыта\n\n## Интеграции\n- **Economy Service:** Проверка
              валюты, выдача наград\n- **Notification Service:** Уведомления о прогрессе\n-
              **Quest Service:** Интеграция с квестами\n- **Achievement Service:**
              Связь с достижениями\n- **Event Bus (Kafka):** События прогресса и наград\n"},
              {"id": "api-endpoints", "title": "API Endpoints", "body": "GET /api/v1/economy/battle-pass/current\n-
              Текущий сезон\n- Response: Season info\n\nGET /api/v1/economy/battle-pass/progress\n-
              Прогресс игрока\n- Query: player_id\n- Response: Player progress\n\nPOST
              /api/v1/economy/battle-pass/claim\n- Забрать награду уровня\n- Request:
              level, track (free/premium)\n- Response: Rewards\n\nPOST /api/v1/economy/battle-pass/purchase-premium\n-
              Купить премиум трек\n- Request: player_id\n- Response: Premium status\n\nGET
              /api/v1/economy/battle-pass/challenges/weekly\n- Еженедельные челленджи\n-
              Query: player_id\n- Response: Weekly challenges\n\nPOST /api/v1/economy/battle-pass/challenges/{id}/complete\n-
              Завершить челлендж\n- Request: player_id\n- Response: XP awarded\n\nGET
              /api/v1/economy/battle-pass/rewards\n- Все награды сезона\n- Query:
              season_id\n- Response: Array of rewards\n"}, {"id": "database", "title":
              "База данных", "body": "## battle_pass_seasons\n```sql\nCREATE TABLE
              battle_pass_seasons (\n  id UUID PRIMARY KEY,\n  name VARCHAR(200),\n  start_date
              TIMESTAMP,\n  end_date TIMESTAMP,\n  is_active BOOLEAN,\n  max_level
              INT DEFAULT 100\n);\n```\n\n## battle_pass_rewards\n```sql\nCREATE TABLE
              battle_pass_rewards (\n  id UUID PRIMARY KEY,\n  season_id UUID REFERENCES
              battle_pass_seasons(id),\n  level INT,\n  track VARCHAR(20), -- ''free''
              or ''premium''\n  reward_type VARCHAR(50),\n  reward_data JSONB,\n  UNIQUE(season_id,
              level, track)\n);\n```\n\n## player_battle_pass_progress\n```sql\nCREATE
              TABLE player_battle_pass_progress (\n  player_id UUID,\n  season_id
              UUID REFERENCES battle_pass_seasons(id),\n  current_level INT,\n  current_xp
              INT,\n  premium_owned BOOLEAN,\n  premium_purchased_at TIMESTAMP,\n  claimed_levels
              INT[],\n  PRIMARY KEY (player_id, season_id)\n);\n```\n\n## weekly_challenges\n```sql\nCREATE
              TABLE weekly_challenges (\n  id UUID PRIMARY KEY,\n  season_id UUID
              REFERENCES battle_pass_seasons(id),\n  week_number INT,\n  challenge_type
              VARCHAR(50),\n  description TEXT,\n  target_value INT,\n  xp_reward
              INT,\n  created_at TIMESTAMP\n);\n```\n\n## player_weekly_challenges\n```sql\nCREATE
              TABLE player_weekly_challenges (\n  player_id UUID,\n  challenge_id
              UUID REFERENCES weekly_challenges(id),\n  progress INT,\n  completed
              BOOLEAN,\n  completed_at TIMESTAMP,\n  PRIMARY KEY (player_id, challenge_id)\n);\n```\n"},
              {"id": "progression-system", "title": "Система прогрессии", "body":
              "## XP Sources\n- Quest completion\n- Daily activities\n- Weekly challenges\n-
              Combat actions\n- Social interactions\n- Economic activities\n\n## Level
              Calculation\n- XP required per level increases\n- Formula: base_xp *
              (level * multiplier)\n- Max level: 100\n\n## Premium Benefits\n- Additional
              rewards per level\n- XP boost (1.5x)\n- Exclusive cosmetics\n- Early
              access to rewards\n"}, {"id": "season-system", "title": "Система сезонов",
              "body": "## Season Lifecycle\n1. Season creation\n2. Season activation\n3.
              Active period (8-12 weeks)\n4. Season end\n5. Rewards claim period (2
              weeks)\n6. Season archive\n\n## Season Management\n- One active season
              at a time\n- Automatic progression reset\n- Season-specific rewards\n-
              Season themes and cosmetics\n"}, {"id": "reward-system", "title": "Система
              наград", "body": "## Reward Types\n- Currency (eurodollars, cryptos)\n-
              Items (equipment, consumables)\n- Cosmetics (skins, emotes)\n- XP boosters\n-
              Titles\n\n## Reward Distribution\n- Free track: every level\n- Premium
              track: every level (additional)\n- Claim mechanism: manual or auto\n-
              Overflow handling: mail system\n"}, {"id": "challenge-system", "title":
              "Система челленджей", "body": "## Weekly Challenges\n- 5 challenges
              per week\n- Auto-generation on Monday\n- XP rewards on completion\n-
              Challenge types:\n  * Combat (kills, damage)\n  * Quest (completions)\n  *
              Social (interactions)\n  * Economic (trades, crafting)\n  * Exploration
              (locations)\n\n## Challenge Processing\n1. Event received from game
              services\n2. Match challenge criteria\n3. Update progress\n4. Check
              completion\n5. Award XP if completed\n"}, {"id": "event-driven", "title":
              "Event-Driven Architecture", "body": "## Subscribed Events\n- quest.completed\n-
              combat.action\n- economy.transaction\n- social.interaction\n- exploration.discovered\n\n##
              Published Events\n- battle_pass.xp_awarded\n- battle_pass.level_up\n-
              battle_pass.reward_claimed\n- battle_pass.premium_purchased\n- battle_pass.challenge_completed\n\n##
              Event Processing\n1. Receive event from Kafka\n2. Calculate XP from
              event\n3. Update player progress\n4. Check level up\n5. Check challenge
              progress\n6. Publish battle pass events\n"}, {"id": "premium-system",
              "title": "Премиум система", "body": "## Premium Purchase\n- Currency:
              Premium currency\n- Price: Configurable per season\n- Validation: Economy
              service\n- Activation: Immediate\n- Retroactive rewards: Yes (all previous
              levels)\n\n## Premium Features\n- Premium track rewards\n- XP boost
              (1.5x)\n- Exclusive cosmetics\n- Early access to content\n"}]}, "appendix":
              {"decisions": [{"id": "bp-001", "decision": "Event-driven progression",
              "rationale": "Decoupling от других систем"}, {"id": "bp-002", "decision":
              "100 levels per season", "rationale": "Оптимальный баланс прогрессии"},
              {"id": "bp-003", "decision": "Weekly challenges", "rationale": "Поддержание
              активности"}]}, "implementation": {"github_issue": 227, "needs_task":
              true, "next_steps": ["Database: Миграции", "API Designer: OpenAPI",
              "Backend: Реализация"]}, "history": [{"version": "1.0.0", "date": "2025-12-02",
              "author": "architect", "changes": "Battle Pass System architecture"}]}'
        - column:
            name: metadata
            value: '{"id": "architecture-battle-pass-system", "title": "Battle Pass
              System Architecture", "document_type": "architecture", "category": "implementation",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-12-02T18:30:00+00:00",
              "owners": [{"role": "architect"}], "tags": ["battle-pass", "monetization",
              "progression", "architecture"], "related_systems": ["battle-pass-service",
              "economy-service", "notification-service", "quest-service", "achievement-service"],
              "related_documents": [{"id": "backend-battle-pass-overview", "relation":
              "implements"}, {"id": "backend-battle-pass-part1-core", "relation":
              "implements"}, {"id": "backend-battle-pass-part2-rewards", "relation":
              "implements"}]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\battle-pass-system-architecture.yaml
