databaseChangeLog:
- changeSet:
    id: documentation-combat-abilities-architecture-6ee86dd1
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '6880103313466076'
        - column:
            name: doc_id
            value: combat-abilities-architecture
        - column:
            name: title
            value: Архитектура системы боевых способностей
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 17:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - combat
            - abilities
            - synergies
            - cyberpsychosis
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - gameplay-service
            - progression-service
            - economy-service
            - analytics-service
        - column:
            name: related_documents
            value: '[{"id": "combat-abilities", "relation": "implements"}, {"id":
              "mechanics-combat-combos-synergies", "relation": "implements"}, {"id":
              "analysis-2025-11-09-combat-abilities-package", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "combat-abilities-architecture", "title":
              "Архитектура системы боевых способностей", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-23T17:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "combat", "abilities",
              "synergies", "cyberpsychosis"], "related_systems": ["gameplay-service",
              "progression-service", "economy-service", "analytics-service"], "related_documents":
              [{"id": "combat-abilities", "relation": "implements"}, {"id": "mechanics-combat-combos-synergies",
              "relation": "implements"}, {"id": "analysis-2025-11-09-combat-abilities-package",
              "relation": "extends"}], "github_issue": 156, "visibility": "internal",
              "audience": ["architect", "backend", "gameplay", "api-designer"]}, "summary":
              {"problem": "Требуется спроектировать архитектуру системы боевых способностей,
              включающую:\n- Каталог способностей с источниками (экипировка, импланты,
              прокачка, кибердека)\n- Управление лоадаутами (Q/E/R слоты, пассивы,
              хакерские слоты)\n- Активацию способностей с кулдаунами и ресурсами\n-
              Синергии между способностями, имплантами и комбо\n- Влияние на киберпсихоз\n-
              Метрики и аналитику\n", "goal": "Создать архитектурную схему системы
              боевых способностей с определением:\n- Компонентов для управления способностями\n-
              REST, WebSocket и Event Bus контрактов\n- Интеграций с другими системами\n-
              Структуры БД\n- Технического задания для реализации\n", "essence": "Объединенная
              архитектура системы боевых способностей с поддержкой каталога,\nлоадаутов,
              активации, синергий и киберпсихоза.\n"}, "architecture": {"overview":
              "Архитектура системы боевых способностей состоит из следующих компонентов:\n1.
              Ability Catalog Manager - управление каталогом способностей\n2. Ability
              Loadout Manager - управление лоадаутами\n3. Ability Activation Engine
              - активация способностей\n4. Cooldown Manager - управление кулдаунами\n5.
              Synergy System - система синергий\n6. Cyberpsychosis Tracker - отслеживание
              киберпсихоза\n7. Ability Metrics Collector - сбор метрик\n", "microservices":
              [{"name": "gameplay-service", "port": 8083, "responsibility": "Обработка
              боевых способностей:\n- Управление каталогом способностей\n- Управление
              лоадаутами\n- Активация способностей\n- Управление кулдаунами\n- Обработка
              синергий\n- Отслеживание киберпсихоза\n", "components": [{"ability-catalog-manager":
              "управление каталогом способностей"}, {"ability-loadout-manager": "управление
              лоадаутами"}, {"ability-activation-engine": "активация способностей"},
              {"cooldown-manager": "управление кулдаунами"}, {"synergy-system": "система
              синергий"}, {"cyberpsychosis-tracker": "отслеживание киберпсихоза"},
              {"ability-metrics-collector": "сбор метрик"}], "endpoints": ["GET /api/v1/gameplay/combat/abilities/catalog
              - каталог способностей", "GET /api/v1/gameplay/combat/abilities/{abilityId}
              - информация о способности", "POST /api/v1/gameplay/combat/abilities/loadouts
              - создание/обновление лоадаута", "GET /api/v1/gameplay/combat/abilities/loadouts
              - получение лоадаутов", "POST /api/v1/gameplay/combat/abilities/activate
              - активация способности", "POST /api/v1/gameplay/combat/abilities/cooldowns
              - проверка кулдаунов", "GET /api/v1/gameplay/combat/abilities/synergies
              - доступные синергии", "POST /api/v1/gameplay/combat/abilities/synergies/apply
              - применение синергии", "POST /api/v1/gameplay/combat/abilities/cyberpsychosis
              - обновление киберпсихоза", "GET /api/v1/gameplay/combat/abilities/metrics
              - метрики способностей"], "websocket_channels": ["wss://api.necp.game/v1/gameplay/combat/abilities/{sessionId}
              - live события активаций", "wss://api.necp.game/v1/gameplay/combat/abilities/player/{characterId}
              - обновления лоадаутов"], "events_published": [{"combat.ability.activated":
              "активация способности"}, {"combat.ability.cooldown-started": "начало
              кулдауна"}, {"combat.ability.cooldown-finished": "окончание кулдауна"},
              {"combat.ability.synergy-triggered": "срабатывание синергии"}, {"combat.ability.cyberpsychosis-updated":
              "обновление киберпсихоза"}, {"combat.ability.loadout-updated": "обновление
              лоадаута"}], "events_subscribed": [{"combat.freerun.mobile-ability":
              "мобильные способности из паркура"}, {"combat.combos.apply": "применение
              комбо"}, {"progression.attribute-updated": "обновление атрибутов"},
              {"quest.trigger": "триггеры квестов"}]}], "data_flows": {"ability_activation_flow":
              "1. Клиент отправляет POST /api/v1/gameplay/combat/abilities/activate\n2.
              Ability Activation Engine проверяет доступность способности\n3. Ability
              Activation Engine проверяет кулдауны через Cooldown Manager\n4. Ability
              Activation Engine проверяет ресурсы (энергия, здоровье)\n5. Ability
              Activation Engine проверяет киберпсихоз через Cyberpsychosis Tracker\n6.
              Ability Activation Engine активирует способность\n7. Cooldown Manager
              запускает кулдаун\n8. Synergy System проверяет доступные синергии\n9.
              Cyberpsychosis Tracker обновляет уровень киберпсихоза\n10. Gameplay
              Service публикует событие combat.ability.activated\n11. Realtime Gateway
              отправляет обновление клиенту\n", "loadout_update_flow": "1. Клиент
              отправляет POST /api/v1/gameplay/combat/abilities/loadouts\n2. Ability
              Loadout Manager валидирует лоадаут\n3. Ability Loadout Manager проверяет
              требования способностей\n4. Ability Loadout Manager проверяет доступность
              способностей через Ability Catalog Manager\n5. Ability Loadout Manager
              проверяет синергии через Synergy System\n6. Ability Loadout Manager
              сохраняет лоадаут в БД\n7. Gameplay Service публикует событие combat.ability.loadout-updated\n8.
              Realtime Gateway отправляет обновление клиенту\n", "synergy_trigger_flow":
              "1. Игрок активирует способность\n2. Synergy System проверяет условия
              синергии\n3. Synergy System проверяет наличие других способностей/имплантов/экипировки\n4.
              Synergy System рассчитывает бонусы синергии\n5. Synergy System применяет
              эффекты синергии\n6. Gameplay Service публикует событие combat.ability.synergy-triggered\n7.
              Analytics Service логирует синергию\n", "cyberpsychosis_update_flow":
              "1. Игрок активирует способность\n2. Cyberpsychosis Tracker рассчитывает
              влияние на киберпсихоз\n3. Cyberpsychosis Tracker учитывает активные
              импланты\n4. Cyberpsychosis Tracker учитывает длительность использования\n5.
              Cyberpsychosis Tracker проверяет пороговые значения\n6. Cyberpsychosis
              Tracker обновляет уровень киберпсихоза\n7. Gameplay Service публикует
              событие combat.ability.cyberpsychosis-updated\n8. Если достигнут порог,
              применяются штрафы через Progression Service\n"}, "database_structure":
              {"tables": [{"name": "abilities_catalog", "description": "Каталог способностей",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"name": "VARCHAR(255)"}, {"description":
              "TEXT"}, {"ability_type": "ENUM (tactical, signature, ultimate, passive,
              hacking)"}, {"slot": "ENUM (Q, E, R, passive, hacking)"}, {"source":
              "ENUM (equipment, implant, progression, cyberdeck)"}, {"rank": "INTEGER"},
              {"energy_cost": "INTEGER"}, {"health_cost": "INTEGER"}, {"cooldown_base":
              "INTEGER"}, {"requirements": "JSONB"}, {"modifiers": "JSONB"}, {"cyberpsychosis_impact":
              "DECIMAL(3,2)"}, {"created_at": "TIMESTAMP"}]}, {"name": "ability_loadouts",
              "description": "Лоадауты способностей", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"character_id": "UUID FOREIGN KEY"}, {"name": "VARCHAR(255)"},
              {"slot_q": "UUID FOREIGN KEY (nullable)"}, {"slot_e": "UUID FOREIGN
              KEY (nullable)"}, {"slot_r": "UUID FOREIGN KEY (nullable)"}, {"passive_abilities":
              "JSONB"}, {"hacking_abilities": "JSONB"}, {"auto_cast_enabled": "BOOLEAN"},
              {"priority": "INTEGER"}, {"is_active": "BOOLEAN"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "ability_cooldowns", "description":
              "Состояние кулдаунов", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id":
              "UUID FOREIGN KEY"}, {"ability_id": "UUID FOREIGN KEY"}, {"started_at":
              "TIMESTAMP"}, {"expires_at": "TIMESTAMP"}, {"cooldown_duration": "INTEGER"},
              {"modifiers": "JSONB"}, {"is_active": "BOOLEAN"}]}, {"name": "ability_synergies",
              "description": "Синергии способностей", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"synergy_type": "ENUM (ability, team, equipment, implant, timing)"},
              {"ability_ids": "JSONB"}, {"implant_ids": "JSONB (nullable)"}, {"equipment_ids":
              "JSONB (nullable)"}, {"requirements": "JSONB"}, {"bonuses": "JSONB"},
              {"complexity": "VARCHAR(50)"}, {"created_at": "TIMESTAMP"}]}, {"name":
              "ability_effects_history", "description": "История активаций способностей",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID FOREIGN
              KEY"}, {"ability_id": "UUID FOREIGN KEY"}, {"activated_at": "TIMESTAMP"},
              {"target_id": "UUID (nullable)"}, {"result": "JSONB"}, {"synergy_triggered":
              "BOOLEAN"}, {"cyberpsychosis_before": "DECIMAL(3,2)"}, {"cyberpsychosis_after":
              "DECIMAL(3,2)"}]}, {"name": "cyberpsychosis_state", "description": "Состояние
              киберпсихоза", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id":
              "UUID FOREIGN KEY"}, {"current_level": "DECIMAL(3,2)"}, {"threshold_breaches":
              "INTEGER"}, {"active_implants_count": "INTEGER"}, {"last_update": "TIMESTAMP"},
              {"restrictions": "JSONB"}]}]}, "integrations": {"progression_service":
              "- Получение данных о прокачке для проверки требований способностей\n-
              Обновление атрибутов влияет на эффективность способностей\n- Киберпсихоз
              влияет на атрибуты через Progression Service\n", "economy_service":
              "- Проверка доступности способностей из экипировки\n- Покупка способностей
              через Economy Service\n- Экономические модификаторы для способностей\n",
              "inventory_service": "- Получение данных об экипировке для способностей\n-
              Проверка наличия предметов для активации способностей\n- Обновление
              инвентаря при использовании расходников\n", "implant_service": "- Получение
              данных об имплантах для способностей\n- Проверка активных имплантов
              для синергий\n- Обновление киберпсихоза на основе имплантов\n", "analytics_service":
              "- Логирование всех активаций способностей\n- Сбор метрик использования
              способностей\n- Анализ синергий и комбо\n- Античит мониторинг\n", "realtime_gateway":
              "- Отправка realtime обновлений активаций\n- Синхронизация кулдаунов\n-
              Уведомления о синергиях\n"}}, "technical_specification": {"subtasks":
              [{"id": "ability-catalog-manager", "title": "Реализация менеджера каталога
              способностей", "description": "Реализация Ability Catalog Manager с
              загрузкой и кэшированием способностей,\nфильтрацией по источникам и
              рангам.\n", "dependencies": [], "estimated_effort": "3 days"}, {"id":
              "ability-loadout-manager", "title": "Реализация менеджера лоадаутов",
              "description": "Реализация Ability Loadout Manager с поддержкой Q/E/R
              слотов, пассивов,\nхакерских слотов и валидации требований.\n", "dependencies":
              ["ability-catalog-manager"], "estimated_effort": "4 days"}, {"id": "ability-activation-engine",
              "title": "Реализация движка активации способностей", "description":
              "Реализация Ability Activation Engine с проверкой доступности, ресурсов,\nкулдаунов
              и киберпсихоза.\n", "dependencies": ["ability-catalog-manager", "ability-loadout-manager"],
              "estimated_effort": "5 days"}, {"id": "cooldown-manager", "title": "Реализация
              менеджера кулдаунов", "description": "Реализация Cooldown Manager с
              отслеживанием кулдаунов, модификаторами\nи автоматическим истечением.\n",
              "dependencies": ["ability-activation-engine"], "estimated_effort": "3
              days"}, {"id": "synergy-system", "title": "Реализация системы синергий",
              "description": "Реализация Synergy System с поддержкой ability/team/equipment/implant/timing\nсинергий
              и расчетом бонусов.\n", "dependencies": ["ability-activation-engine"],
              "estimated_effort": "5 days"}, {"id": "cyberpsychosis-tracker", "title":
              "Реализация трекера киберпсихоза", "description": "Реализация Cyberpsychosis
              Tracker с расчетом влияния способностей,\nотслеживанием порогов и применением
              ограничений.\n", "dependencies": ["ability-activation-engine"], "estimated_effort":
              "4 days"}, {"id": "ability-metrics-collector", "title": "Реализация
              сборщика метрик", "description": "Реализация Ability Metrics Collector
              с логированием активаций,\nсбором статистики и интеграцией с Analytics
              Service.\n", "dependencies": ["ability-activation-engine"], "estimated_effort":
              "3 days"}, {"id": "websocket-channels", "title": "Реализация WebSocket
              каналов", "description": "Реализация WebSocket каналов для realtime
              обновлений активаций\nи лоадаутов.\n", "dependencies": ["ability-activation-engine",
              "ability-loadout-manager"], "estimated_effort": "3 days"}, {"id": "event-bus-integration",
              "title": "Интеграция с Event Bus", "description": "Реализация публикации
              и подписки на события через Kafka\nдля всех компонентов системы способностей.\n",
              "dependencies": ["ability-activation-engine", "synergy-system", "cyberpsychosis-tracker"],
              "estimated_effort": "2 days"}, {"id": "database-schema", "title": "Создание
              схемы БД", "description": "Создание таблиц БД для способностей, лоадаутов,
              кулдаунов, синергий\nи киберпсихоза с миграциями Liquibase.\n", "dependencies":
              [], "estimated_effort": "2 days"}]}, "diagrams": {"component_diagram":
              "```mermaid\ngraph TB\n    Client[UE5 Client] --> Gateway[API Gateway]\n\n    Gateway
              --> GameplayService[Gameplay Service<br/>8083]\n\n    GameplayService
              --> ACM[Ability Catalog Manager]\n    GameplayService --> ALM[Ability
              Loadout Manager]\n    GameplayService --> AAE[Ability Activation Engine]\n    GameplayService
              --> CM[Cooldown Manager]\n    GameplayService --> SS[Synergy System]\n    GameplayService
              --> CT[Cyberpsychosis Tracker]\n    GameplayService --> AMC[Ability
              Metrics Collector]\n\n    AAE --> CM\n    AAE --> CT\n    AAE --> SS\n\n    GameplayService
              --> ProgressionService[Progression Service]\n    GameplayService -->
              EconomyService[Economy Service]\n    GameplayService --> InventoryService[Inventory
              Service]\n    GameplayService --> ImplantService[Implant Service]\n    GameplayService
              --> AnalyticsService[Analytics Service]\n\n    GameplayService --> EventBus[Event
              Bus<br/>Kafka]\n    EventBus --> RealtimeGateway[Realtime Gateway]\n\n    GameplayService
              --> DB[(Gameplay DB)]\n\n    Client --> WSAbl[WebSocket<br/>Abilities]\n    WSAbl
              --> GameplayService\n```\n", "ability_activation_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              C as Client\n    participant AAE as Ability Activation Engine\n    participant
              CM as Cooldown Manager\n    participant CT as Cyberpsychosis Tracker\n    participant
              SS as Synergy System\n    participant PS as Progression Service\n    participant
              EB as Event Bus\n\n    C->>AAE: POST /abilities/activate\n    AAE->>AAE:
              Check ability availability\n    AAE->>CM: Check cooldowns\n    CM-->>AAE:
              Cooldown status\n    AAE->>AAE: Check resources (energy, health)\n    AAE->>CT:
              Check cyberpsychosis\n    CT-->>AAE: Cyberpsychosis level\n    AAE->>AAE:
              Activate ability\n    AAE->>CM: Start cooldown\n    AAE->>SS: Check
              synergies\n    SS-->>AAE: Available synergies\n    AAE->>CT: Update
              cyberpsychosis\n    AAE->>EB: Publish combat.ability.activated\n    AAE-->>C:
              Activation result\n\n    EB->>PS: combat.ability.activated\n    PS->>PS:
              Update attributes if needed\n```\n", "loadout_synergy_diagram": "```mermaid\nsequenceDiagram\n    participant
              C as Client\n    participant ALM as Ability Loadout Manager\n    participant
              ACM as Ability Catalog Manager\n    participant SS as Synergy System\n    participant
              IS as Implant Service\n    participant ES as Economy Service\n    participant
              EB as Event Bus\n\n    C->>ALM: POST /abilities/loadouts\n    ALM->>ALM:
              Validate loadout\n    ALM->>ACM: Check ability requirements\n    ACM-->>ALM:
              Ability data\n    ALM->>SS: Check synergies\n    SS->>IS: Get active
              implants\n    IS-->>SS: Implants data\n    SS->>ES: Check equipment\n    ES-->>SS:
              Equipment data\n    SS->>SS: Calculate synergy bonuses\n    SS-->>ALM:
              Synergy results\n    ALM->>ALM: Save loadout\n    ALM->>EB: Publish
              combat.ability.loadout-updated\n    ALM-->>C: Loadout saved\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "combat-abilities-architecture", "title": "Архитектура
              системы боевых способностей", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T17:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "combat", "abilities", "synergies", "cyberpsychosis"],
              "related_systems": ["gameplay-service", "progression-service", "economy-service",
              "analytics-service"], "related_documents": [{"id": "combat-abilities",
              "relation": "implements"}, {"id": "mechanics-combat-combos-synergies",
              "relation": "implements"}, {"id": "analysis-2025-11-09-combat-abilities-package",
              "relation": "extends"}], "github_issue": 156, "visibility": "internal",
              "audience": ["architect", "backend", "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\combat-abilities-architecture.yaml
