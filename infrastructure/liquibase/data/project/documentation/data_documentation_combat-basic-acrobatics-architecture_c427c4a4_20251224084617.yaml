databaseChangeLog:
- changeSet:
    id: documentation-combat-basic-acrobatics-architecture-c427c4a4
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-189176499551204'
        - column:
            name: doc_id
            value: combat-basic-acrobatics-architecture
        - column:
            name: title
            value: Архитектура базовых элементов акробатики
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-29 12:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - combat
            - movement
            - acrobatics
            - freerun
            - stamina
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - gameplay-service
            - movement-service
            - character-service
            - progression-service
        - column:
            name: related_documents
            value: '[{"id": "combat-freerun-architecture", "relation": "extends"},
              {"id": "analysis-ideas-2025-11-29-vertical-city-architecture-part3-mechanics",
              "relation": "implements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - client
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "combat-basic-acrobatics-architecture", "title":
              "Архитектура базовых элементов акробатики", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-29T12:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "combat", "movement",
              "acrobatics", "freerun", "stamina"], "related_systems": ["gameplay-service",
              "movement-service", "character-service", "progression-service"], "related_documents":
              [{"id": "combat-freerun-architecture", "relation": "extends"}, {"id":
              "analysis-ideas-2025-11-29-vertical-city-architecture-part3-mechanics",
              "relation": "implements"}], "github_issue": 1510, "visibility": "internal",
              "audience": ["architect", "backend", "client", "gameplay", "api-designer"]},
              "summary": {"problem": "Требуется спроектировать архитектуру базовых
              элементов акробатики для вертикального мира:\n- Wall Run (бег по стенам)
              - вертикальное перемещение по стенам\n- Double Jump (двойной прыжок)
              - второй прыжок в воздухе\n- Slide (скольжение) - быстрое скольжение
              по горизонтальным поверхностям\nВсе элементы должны интегрироваться
              с системой выносливости, боевой системой и системой движения.\n", "goal":
              "Создать архитектурную схему базовых элементов акробатики с определением:\n-
              Компонентов для каждого элемента (Wall Run, Double Jump, Slide)\n- API
              endpoints для управления элементами\n- Интеграций с Freerun системой,
              Stamina Manager, Movement Service\n- Структуры БД для отслеживания состояний\n-
              Технического задания для реализации\n", "essence": "Детальная архитектура
              базовых элементов акробатики, расширяющая общую систему Freerun\nи обеспечивающая
              вертикальное перемещение и динамичный геймплей.\n"}, "architecture":
              {"overview": "Архитектура базовых элементов акробатики состоит из следующих
              компонентов:\n1. Wall Run Manager - управление бегом по стенам\n2. Double
              Jump Manager - управление двойным прыжком\n3. Slide Manager - управление
              скольжением\n4. Acrobatics State Tracker - отслеживание состояний акробатики\n5.
              Surface Detection System - определение подходящих поверхностей\n6. Acrobatics
              Animation Controller - управление анимациями\n", "microservices": [{"name":
              "gameplay-service", "port": 8083, "responsibility": "Обработка базовых
              элементов акробатики:\n- Управление Wall Run, Double Jump, Slide\n-
              Отслеживание состояний акробатики\n- Определение подходящих поверхностей\n-
              Интеграция с выносливостью и движением\n", "components": [{"wall-run-manager":
              "управление бегом по стенам"}, {"double-jump-manager": "управление двойным
              прыжком"}, {"slide-manager": "управление скольжением"}, {"acrobatics-state-tracker":
              "отслеживание состояний"}, {"surface-detection-system": "определение
              поверхностей"}], "endpoints": ["POST /api/v1/gameplay/combat/acrobatics/wall-run/start
              - начало Wall Run", "POST /api/v1/gameplay/combat/acrobatics/wall-run/stop
              - остановка Wall Run", "POST /api/v1/gameplay/combat/acrobatics/wall-run/kick
              - отталкивание от стены", "GET /api/v1/gameplay/combat/acrobatics/wall-run/surfaces
              - доступные поверхности", "POST /api/v1/gameplay/combat/acrobatics/double-jump
              - выполнение Double Jump", "GET /api/v1/gameplay/combat/acrobatics/double-jump/available
              - проверка доступности", "POST /api/v1/gameplay/combat/acrobatics/slide/start
              - начало Slide", "POST /api/v1/gameplay/combat/acrobatics/slide/stop
              - остановка Slide", "GET /api/v1/gameplay/combat/acrobatics/state -
              текущее состояние акробатики"], "websocket_channels": ["wss://api.necp.game/v1/gameplay/combat/acrobatics/{sessionId}
              - поток состояний акробатики"], "events_published": [{"combat.acrobatics.wall-run.started":
              "начало Wall Run"}, {"combat.acrobatics.wall-run.stopped": "остановка
              Wall Run"}, {"combat.acrobatics.wall-run.kick": "отталкивание от стены"},
              {"combat.acrobatics.double-jump": "выполнение Double Jump"}, {"combat.acrobatics.slide.started":
              "начало Slide"}, {"combat.acrobatics.slide.stopped": "остановка Slide"},
              {"combat.acrobatics.stamina-depleted": "истощение выносливости"}], "events_subscribed":
              [{"movement.position-updated": "обновление позиции"}, {"combat.freerun.stamina":
              "изменение выносливости"}, {"progression.skill-updated": "обновление
              навыков"}, {"character.implant-activated": "активация импланта"}]}],
              "wall_run": {"description": "Бег по вертикальным поверхностям для быстрого
              вертикального перемещения.\n", "mechanics": {"activation": "- Активация
              при приближении к стене во время бега\n- Автоматическое определение
              подходящих поверхностей\n- Проверка угла поверхности (должна быть вертикальной
              или близкой к вертикали)\n- Проверка наличия достаточной скорости\n",
              "execution": "- Расход выносливости: 15-20 единиц/сек\n- Ограничение
              по времени/расстоянию\n- Возможность оттолкнуться от стены (wall kick)\n-
              Автоматическое завершение при истощении выносливости\n", "surface_requirements":
              "- Вертикальная или близкая к вертикали поверхность\n- Достаточная площадь
              для контакта\n- Отсутствие препятствий\n- Подходящий материал (не скользкий)\n"},
              "integration": {"freerun_system": "- Использует Freerun Action Manager
              для базовой обработки\n- Интегрируется с Freerun Combo System для комбо\n",
              "stamina_manager": "- Расход выносливости: 15-20 единиц/сек\n- Автоматическая
              остановка при истощении\n- Восстановление выносливости после остановки\n",
              "movement_service": "- Синхронизация позиции во время Wall Run\n- Отслеживание
              скорости и направления\n- Интеграция с системой движения\n"}, "control_modes":
              {"auto": "- Автоматическое определение поверхностей\n- Автоматическое
              начало при приближении\n- Автоматическое завершение при достижении конца
              стены\n", "manual": "- Ручная активация через ввод игрока\n- Полный
              контроль направления и скорости\n- Ручное завершение\n"}}, "double_jump":
              {"description": "Второй прыжок в воздухе для увеличения высоты и доступа
              к высоким точкам.\n", "mechanics": {"activation": "- Активация во время
              прыжка (пока персонаж в воздухе)\n- Ограничение: только один double
              jump до приземления\n- Проверка наличия выносливости\n- Проверка навыков/имплантов
              для дополнительных прыжков\n", "execution": "- Расход выносливости:
              10-15 единиц\n- Мгновенное выполнение\n- Изменение траектории в зависимости
              от ввода\n- Интеграция с Air Dash для комбо\n", "limitations": "- Только
              один double jump до приземления\n- Требует наличия выносливости\n- Может
              быть улучшен через импланты/навыки (triple jump)\n"}, "integration":
              {"gas_system": "- Использует Gameplay Ability System для активации\n-
              Интегрируется с системой способностей\n", "progression_system": "- Навыки
              паркура влияют на доступность\n- Импланты могут предоставлять дополнительные
              прыжки\n- Прогрессия навыков увеличивает эффективность\n", "implant_system":
              "- Импланты ног могут предоставлять дополнительные прыжки\n- Модификаторы
              имплантов влияют на расход выносливости\n"}, "control_modes": {"manual":
              "- Ручная активация через ввод игрока\n- Направление зависит от ввода\n-
              Полный контроль траектории\n"}}, "slide": {"description": "Быстрое скольжение
              по горизонтальным поверхностям для уклонения и быстрого перемещения.\n",
              "mechanics": {"activation": "- Активация при приседе во время бега\n-
              Требует минимальной скорости для начала\n- Проверка подходящей поверхности
              (не скользкая)\n", "execution": "- Расход выносливости: 5-8 единиц\n-
              Сохранение инерции движения\n- Возможность стрельбы во время скольжения\n-
              Автоматическое вставание после скольжения\n- Интеграция с атаками\n",
              "duration": "- Зависит от скорости и поверхности\n- Автоматическое завершение
              при замедлении\n- Возможность ручного завершения\n"}, "integration":
              {"combat_system": "- Возможность стрельбы во время Slide\n- Специальные
              атаки при выходе из Slide\n- Интеграция с комбо-системой\n", "movement_service":
              "- Синхронизация позиции во время Slide\n- Отслеживание скорости и направления\n-
              Интеграция с системой движения\n", "animation_system": "- Анимации скольжения\n-
              Анимации вставания после Slide\n- Анимации атак во время Slide\n"},
              "control_modes": {"auto": "- Автоматическое вставание после замедления\n-
              Автоматическое определение подходящих поверхностей\n", "manual": "-
              Ручная активация через ввод игрока\n- Ручное завершение\n- Полный контроль
              направления\n"}}, "data_flows": {"wall_run_flow": "1. Игрок приближается
              к стене во время бега\n2. Surface Detection System определяет подходящую
              поверхность\n3. Wall Run Manager проверяет доступность (выносливость,
              навыки)\n4. Игрок активирует Wall Run (автоматически или вручную)\n5.
              Wall Run Manager начинает отслеживание состояния\n6. Stamina Manager
              расходует выносливость (15-20 единиц/сек)\n7. Movement Service синхронизирует
              позицию\n8. Acrobatics State Tracker обновляет состояние\n9. Gameplay
              Service публикует событие combat.acrobatics.wall-run.started\n10. Realtime
              Gateway отправляет обновление клиентам\n11. При истощении выносливости
              или достижении конца стены - остановка\n12. Gameplay Service публикует
              событие combat.acrobatics.wall-run.stopped\n", "double_jump_flow": "1.
              Игрок находится в воздухе после прыжка\n2. Игрок активирует Double Jump\n3.
              Double Jump Manager проверяет доступность (в воздухе, есть выносливость,
              не использован)\n4. Stamina Manager расходует выносливость (10-15 единиц)\n5.
              Double Jump Manager применяет импульс вверх/в сторону\n6. Movement Service
              обновляет позицию и траекторию\n7. Acrobatics State Tracker отмечает
              использование Double Jump\n8. Gameplay Service публикует событие combat.acrobatics.double-jump\n9.
              Realtime Gateway отправляет обновление клиентам\n10. При приземлении
              состояние сбрасывается\n", "slide_flow": "1. Игрок приседает во время
              бега\n2. Slide Manager проверяет условия (скорость, поверхность)\n3.
              Игрок активирует Slide\n4. Slide Manager начинает отслеживание состояния\n5.
              Stamina Manager расходует выносливость (5-8 единиц)\n6. Movement Service
              сохраняет инерцию и обновляет позицию\n7. Combat System разрешает стрельбу
              во время Slide\n8. Acrobatics State Tracker обновляет состояние\n9.
              Gameplay Service публикует событие combat.acrobatics.slide.started\n10.
              Realtime Gateway отправляет обновление клиентам\n11. При замедлении
              или ручном завершении - остановка\n12. Animation System воспроизводит
              анимацию вставания\n13. Gameplay Service публикует событие combat.acrobatics.slide.stopped\n"},
              "database_structure": {"tables": [{"name": "acrobatics_wall_run_state",
              "description": "Состояние Wall Run", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"character_id": "UUID FOREIGN KEY"}, {"is_active": "BOOLEAN"},
              {"wall_surface_id": "UUID"}, {"start_position": "JSONB"}, {"current_position":
              "JSONB"}, {"direction": "JSONB"}, {"stamina_consumed": "INTEGER"}, {"duration":
              "INTEGER"}, {"started_at": "TIMESTAMP"}, {"stopped_at": "TIMESTAMP"}]},
              {"name": "acrobatics_double_jump_state", "description": "Состояние Double
              Jump", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID
              FOREIGN KEY"}, {"is_available": "BOOLEAN"}, {"was_used": "BOOLEAN"},
              {"jump_count": "INTEGER"}, {"max_jumps": "INTEGER"}, {"last_jump_position":
              "JSONB"}, {"last_jump_direction": "JSONB"}, {"stamina_consumed": "INTEGER"},
              {"last_used_at": "TIMESTAMP"}]}, {"name": "acrobatics_slide_state",
              "description": "Состояние Slide", "columns": [{"id": "UUID PRIMARY KEY"},
              {"character_id": "UUID FOREIGN KEY"}, {"is_active": "BOOLEAN"}, {"start_position":
              "JSONB"}, {"current_position": "JSONB"}, {"direction": "JSONB"}, {"speed":
              "DECIMAL(10,2)"}, {"stamina_consumed": "INTEGER"}, {"duration": "INTEGER"},
              {"started_at": "TIMESTAMP"}, {"stopped_at": "TIMESTAMP"}]}, {"name":
              "acrobatics_surfaces", "description": "Определенные поверхности для
              акробатики", "columns": [{"id": "UUID PRIMARY KEY"}, {"surface_type":
              "ENUM (wall, floor, obstacle)"}, {"position": "JSONB"}, {"normal": "JSONB"},
              {"material": "VARCHAR(50)"}, {"is_suitable_for_wall_run": "BOOLEAN"},
              {"is_suitable_for_slide": "BOOLEAN"}, {"detected_at": "TIMESTAMP"}]}]},
              "integrations": {"freerun_system": "- Использование Freerun Action Manager
              для базовой обработки\n- Интеграция с Freerun Combo System\n- Использование
              общих компонентов выносливости\n", "stamina_manager": "- Расход выносливости
              для каждого элемента\n- Автоматическая остановка при истощении\n- Восстановление
              выносливости после использования\n", "movement_service": "- Синхронизация
              позиций во время акробатики\n- Отслеживание скорости и направления\n-
              Интеграция с системой движения\n", "combat_system": "- Возможность стрельбы
              во время Slide и Wall Run\n- Интеграция с атаками\n- Специальные атаки
              при выходе из элементов\n", "progression_system": "- Навыки паркура
              влияют на доступность и эффективность\n- Прогрессия навыков увеличивает
              возможности\n- Обновление навыков на основе использования\n", "implant_system":
              "- Импланты ног влияют на Double Jump\n- Импланты рук влияют на Wall
              Run\n- Модификаторы имплантов влияют на расход выносливости\n", "animation_system":
              "- Анимации для каждого элемента\n- Плавные переходы между состояниями\n-
              Анимации атак во время акробатики\n", "realtime_gateway": "- Отправка
              realtime обновлений состояний\n- Синхронизация позиций\n- Уведомления
              о событиях акробатики\n"}}, "technical_specification": {"subtasks":
              [{"id": "wall-run-manager", "title": "Реализация менеджера Wall Run",
              "description": "Реализация Wall Run Manager с обработкой начала/остановки
              Wall Run,\nопределением поверхностей, управлением выносливостью и синхронизацией
              позиций.\n", "dependencies": [], "estimated_effort": "5 days", "file_size_estimate":
              "350 lines"}, {"id": "double-jump-manager", "title": "Реализация менеджера
              Double Jump", "description": "Реализация Double Jump Manager с проверкой
              доступности, применением импульса,\nотслеживанием использования и интеграцией
              с GAS.\n", "dependencies": [], "estimated_effort": "3 days", "file_size_estimate":
              "250 lines"}, {"id": "slide-manager", "title": "Реализация менеджера
              Slide", "description": "Реализация Slide Manager с обработкой начала/остановки
              Slide,\nсохранением инерции, интеграцией с боевой системой и анимациями.\n",
              "dependencies": [], "estimated_effort": "4 days", "file_size_estimate":
              "300 lines"}, {"id": "surface-detection-system", "title": "Реализация
              системы определения поверхностей", "description": "Реализация Surface
              Detection System с определением подходящих поверхностей\nдля Wall Run
              и Slide, кэшированием результатов и обновлением в реальном времени.\n",
              "dependencies": [], "estimated_effort": "4 days", "file_size_estimate":
              "280 lines"}, {"id": "acrobatics-state-tracker", "title": "Реализация
              трекера состояний акробатики", "description": "Реализация Acrobatics
              State Tracker с отслеживанием состояний всех элементов,\nсинхронизацией
              с клиентом и сохранением в БД.\n", "dependencies": ["wall-run-manager",
              "double-jump-manager", "slide-manager"], "estimated_effort": "3 days",
              "file_size_estimate": "200 lines"}, {"id": "acrobatics-api-endpoints",
              "title": "Реализация API endpoints для акробатики", "description": "Реализация
              REST API endpoints для управления элементами акробатики,\nполучения
              состояний и доступных поверхностей.\n", "dependencies": ["wall-run-manager",
              "double-jump-manager", "slide-manager"], "estimated_effort": "2 days",
              "file_size_estimate": "180 lines"}, {"id": "acrobatics-websocket", "title":
              "Реализация WebSocket каналов для акробатики", "description": "Реализация
              WebSocket каналов для realtime обновлений состояний акробатики,\nсинхронизации
              позиций и уведомлений о событиях.\n", "dependencies": ["acrobatics-state-tracker"],
              "estimated_effort": "2 days", "file_size_estimate": "150 lines"}, {"id":
              "acrobatics-event-bus", "title": "Интеграция с Event Bus для акробатики",
              "description": "Реализация публикации и подписки на события через Kafka\nдля
              всех элементов акробатики.\n", "dependencies": ["wall-run-manager",
              "double-jump-manager", "slide-manager"], "estimated_effort": "2 days",
              "file_size_estimate": "120 lines"}, {"id": "acrobatics-database-schema",
              "title": "Создание схемы БД для акробатики", "description": "Создание
              таблиц БД для состояний Wall Run, Double Jump, Slide и поверхностей\nс
              миграциями Liquibase.\n", "dependencies": [], "estimated_effort": "2
              days", "file_size_estimate": "100 lines"}]}, "diagrams": {"component_diagram":
              "```mermaid\ngraph TB\n    Client[UE5 Client] --> Gateway[API Gateway]\n\n    Gateway
              --> GameplayService[Gameplay Service<br/>8083]\n\n    GameplayService
              --> WRM[Wall Run Manager]\n    GameplayService --> DJM[Double Jump Manager]\n    GameplayService
              --> SM[Slide Manager]\n    GameplayService --> AST[Acrobatics State
              Tracker]\n    GameplayService --> SDS[Surface Detection System]\n\n    WRM
              --> SM[Stamina Manager]\n    DJM --> SM\n    SM --> SM\n\n    WRM -->
              MS[Movement Service]\n    DJM --> MS\n    SM --> MS\n\n    WRM --> CS[Combat
              System]\n    SM --> CS\n\n    WRM --> PS[Progression Service]\n    DJM
              --> PS\n    SM --> PS\n\n    GameplayService --> EventBus[Event Bus<br/>Kafka]\n    EventBus
              --> RealtimeGateway[Realtime Gateway]\n\n    GameplayService --> DB[(Gameplay
              DB)]\n\n    Client --> WSAcrobatics[WebSocket<br/>Acrobatics]\n    WSAcrobatics
              --> GameplayService\n```\n", "wall_run_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              C as Client\n    participant WRM as Wall Run Manager\n    participant
              SDS as Surface Detection\n    participant SM as Stamina Manager\n    participant
              MS as Movement Service\n    participant EB as Event Bus\n\n    C->>WRM:
              POST /wall-run/start\n    WRM->>SDS: Check surface\n    SDS-->>WRM:
              Surface available\n    WRM->>SM: Check stamina\n    SM-->>WRM: Stamina
              OK\n    WRM->>WRM: Start wall run\n    WRM->>MS: Update position\n    WRM->>SM:
              Consume stamina (15-20/sec)\n    WRM->>EB: Publish wall-run.started\n    WRM-->>C:
              Wall run active\n\n    loop During wall run\n        WRM->>SM: Consume
              stamina\n        WRM->>MS: Update position\n        SM-->>WRM: Stamina
              status\n    end\n\n    alt Stamina depleted or end of wall\n        WRM->>WRM:
              Stop wall run\n        WRM->>EB: Publish wall-run.stopped\n        WRM-->>C:
              Wall run stopped\n    end\n```\n", "double_jump_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              C as Client\n    participant DJM as Double Jump Manager\n    participant
              SM as Stamina Manager\n    participant MS as Movement Service\n    participant
              GAS as GAS System\n    participant EB as Event Bus\n\n    C->>DJM: POST
              /double-jump\n    DJM->>DJM: Check in air\n    DJM->>DJM: Check not
              used\n    DJM->>SM: Check stamina\n    SM-->>DJM: Stamina OK\n    DJM->>GAS:
              Activate ability\n    DJM->>SM: Consume stamina (10-15)\n    DJM->>MS:
              Apply impulse\n    DJM->>DJM: Mark as used\n    DJM->>EB: Publish double-jump\n    DJM-->>C:
              Double jump executed\n\n    Note over DJM: Reset on landing\n```\n",
              "slide_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              C as Client\n    participant SLM as Slide Manager\n    participant SM
              as Stamina Manager\n    participant MS as Movement Service\n    participant
              CS as Combat System\n    participant EB as Event Bus\n\n    C->>SLM:
              POST /slide/start\n    SLM->>SLM: Check speed and surface\n    SLM->>SM:
              Check stamina\n    SM-->>SLM: Stamina OK\n    SLM->>SLM: Start slide\n    SLM->>MS:
              Preserve momentum\n    SLM->>SM: Consume stamina (5-8)\n    SLM->>CS:
              Enable combat\n    SLM->>EB: Publish slide.started\n    SLM-->>C: Slide
              active\n\n    loop During slide\n        SLM->>MS: Update position\n        SLM->>CS:
              Allow combat\n        SLM->>SM: Consume stamina\n    end\n\n    alt
              Slowdown or manual stop\n        SLM->>SLM: Stop slide\n        SLM->>CS:
              Disable combat\n        SLM->>EB: Publish slide.stopped\n        SLM-->>C:
              Slide stopped\n    end\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "combat-basic-acrobatics-architecture", "title": "Архитектура
              базовых элементов акробатики", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-29T12:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "combat", "movement", "acrobatics", "freerun",
              "stamina"], "related_systems": ["gameplay-service", "movement-service",
              "character-service", "progression-service"], "related_documents": [{"id":
              "combat-freerun-architecture", "relation": "extends"}, {"id": "analysis-ideas-2025-11-29-vertical-city-architecture-part3-mechanics",
              "relation": "implements"}], "github_issue": 1510, "visibility": "internal",
              "audience": ["architect", "backend", "client", "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\combat-basic-acrobatics-architecture.yaml
