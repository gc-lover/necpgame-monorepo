databaseChangeLog:
- changeSet:
    id: documentation-combat-combos-synergies-architecture-09508a2e
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-205965489936597'
        - column:
            name: doc_id
            value: combat-combos-synergies-architecture
        - column:
            name: title
            value: Архитектура системы комбо и синергий
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 19:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - combat
            - combos
            - synergies
            - scoring
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - gameplay-service
            - analytics-service
            - economy-service
        - column:
            name: related_documents
            value: '[{"id": "mechanics-combat-combos-synergies", "relation": "implements"},
              {"id": "analysis-2025-11-09-combat-combos-brief", "relation": "extends"},
              {"id": "combat-abilities-architecture", "relation": "complements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "combat-combos-synergies-architecture", "title":
              "Архитектура системы комбо и синергий", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-23T19:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "combat", "combos",
              "synergies", "scoring"], "related_systems": ["gameplay-service", "analytics-service",
              "economy-service"], "related_documents": [{"id": "mechanics-combat-combos-synergies",
              "relation": "implements"}, {"id": "analysis-2025-11-09-combat-combos-brief",
              "relation": "extends"}, {"id": "combat-abilities-architecture", "relation":
              "complements"}], "github_issue": 158, "visibility": "internal", "audience":
              ["architect", "backend", "gameplay", "api-designer"]}, "summary": {"problem":
              "Требуется спроектировать архитектуру системы комбо и синергий, включающую:\n-
              Каталог комбо (solo, team, legendary)\n- Типы синергий (ability, team,
              equipment, implant, timing)\n- Систему scoring для оценки комбо\n- Chain-комбо
              с сокращением кулдаунов\n- Интеграцию с abilities, implants, progression
              и quest engine\n", "goal": "Создать архитектурную схему системы комбо
              и синергий с определением:\n- Компонентов для управления комбо и синергиями\n-
              REST, WebSocket и Event Bus контрактов\n- Интеграций с другими системами\n-
              Структуры БД\n- Технического задания для реализации\n", "essence": "Объединенная
              архитектура системы комбо и синергий с поддержкой каталога,\nактивации,
              scoring и аналитики.\n"}, "architecture": {"overview": "Архитектура
              системы комбо и синергий состоит из следующих компонентов:\n1. Combo
              Catalog Manager - управление каталогом комбо\n2. Combo Activation Engine
              - активация комбо\n3. Synergy System - система синергий\n4. Combo Scoring
              System - система оценки комбо\n5. Chain Combo Manager - управление chain-комбо\n6.
              Combo Loadout Manager - управление лоадаутами комбо\n7. Combo Analytics
              Collector - сбор аналитики\n", "microservices": [{"name": "gameplay-service",
              "port": 8083, "responsibility": "Обработка комбо и синергий:\n- Управление
              каталогом комбо\n- Активация комбо\n- Обработка синергий\n- Система
              scoring\n- Управление chain-комбо\n- Сбор аналитики\n", "components":
              [{"combo-catalog-manager": "управление каталогом комбо"}, {"combo-activation-engine":
              "активация комбо"}, {"synergy-system": "система синергий"}, {"combo-scoring-system":
              "система оценки комбо"}, {"chain-combo-manager": "управление chain-комбо"},
              {"combo-loadout-manager": "управление лоадаутами"}, {"combo-analytics-collector":
              "сбор аналитики"}], "endpoints": ["GET /api/v1/gameplay/combat/combos/catalog
              - каталог комбо", "GET /api/v1/gameplay/combat/combos/{comboId} - информация
              о комбо", "POST /api/v1/gameplay/combat/combos/activate - активация
              комбо", "POST /api/v1/gameplay/combat/combos/synergy - применение синергии",
              "GET /api/v1/gameplay/combat/combos/loadout - получение лоадаута", "POST
              /api/v1/gameplay/combat/combos/loadout - обновление лоадаута", "POST
              /api/v1/gameplay/combat/combos/score - отправка результатов scoring",
              "GET /api/v1/gameplay/combat/combos/analytics - метрики эффективности"],
              "websocket_channels": ["wss://api.necp.game/v1/gameplay/combat/combos/{sessionId}
              - поток активированных комбо", "wss://api.necp.game/v1/gameplay/combat/combos/player/{characterId}
              - персональные уведомления"], "events_published": [{"combat.combo.activated":
              "активация комбо"}, {"combat.combo.synergy": "фиксация синергий"}, {"combat.combo.failure":
              "аналитика неудачных попыток"}, {"combat.combo.score": "итоговый рейтинг
              и очки"}, {"combat.combo.chain": "срабатывание chain-комбо"}, {"combat.combo.loadout-updated":
              "обновление лоадаута"}], "events_subscribed": [{"combat.ability.activated":
              "активация способности"}, {"combat.freerun.actions": "действия паркура"},
              {"combat.stealth.action": "действия скрытности"}, {"quest.trigger":
              "триггеры квестов"}, {"combat.ai.state": "состояние AI врагов"}]}],
              "combo_types": [{"name": "solo", "description": "Соло комбо", "examples":
              ["Aerial Devastation", "Shadow Assassin", "Bullet Time Massacre"], "participants":
              1, "complexity": "Bronze to Legendary"}, {"name": "team", "description":
              "Командные комбо", "examples": ["Tank & Spank", "Netrunner Setup", "Raid
              Opener"], "participants": "2-5", "complexity": "Silver to Legendary"},
              {"name": "legendary", "description": "Легендарные сценарии", "examples":
              ["The Perfect Heist", "The Raid Wipe"], "participants": "3-5", "complexity":
              "Legendary only"}], "synergy_types": [{"name": "ability", "description":
              "Синергии способностей", "source": "abilities", "effects": "damage multipliers,
              control effects"}, {"name": "team", "description": "Командные синергии",
              "source": "multiple players", "effects": "coordination bonuses, synchronized
              effects"}, {"name": "equipment", "description": "Синергии экипировки",
              "source": "equipment", "effects": "weapon bonuses, gear set effects"},
              {"name": "implant", "description": "Синергии имплантов", "source": "implants",
              "effects": "cyberware bonuses, implant combinations"}, {"name": "timing",
              "description": "Тайминговые синергии", "source": "execution timing",
              "effects": "chain bonuses, cooldown reductions"}], "data_flows": {"combo_activation_flow":
              "1. Игрок(и) выполняют последовательность действий\n2. Combo Activation
              Engine отслеживает действия\n3. Combo Activation Engine проверяет соответствие
              каталогу комбо\n4. Combo Activation Engine проверяет требования комбо\n5.
              Combo Activation Engine проверяет участников\n6. Combo Activation Engine
              активирует комбо\n7. Synergy System проверяет доступные синергии\n8.
              Synergy System применяет синергии\n9. Combo Scoring System оценивает
              комбо\n10. Chain Combo Manager проверяет chain-комбо\n11. Gameplay Service
              публикует событие combat.combo.activated\n12. Realtime Gateway отправляет
              обновление клиентам\n", "synergy_application_flow": "1. Combo активирован\n2.
              Synergy System анализирует контекст комбо\n3. Synergy System проверяет
              ability синергии\n4. Synergy System проверяет equipment синергии через
              Inventory Service\n5. Synergy System проверяет implant синергии через
              Implant Service\n6. Synergy System проверяет team синергии через Social
              Service\n7. Synergy System проверяет timing синергии\n8. Synergy System
              рассчитывает бонусы\n9. Synergy System применяет эффекты\n10. Gameplay
              Service публикует событие combat.combo.synergy\n11. Realtime Gateway
              отправляет обновление клиентам\n", "scoring_flow": "1. Combo активирован
              и выполнен\n2. Combo Scoring System собирает метрики:\n   - executionDifficulty
              (сложность исполнения)\n   - damageOutput (выданный урон)\n   - visualImpact
              (визуальный эффект)\n   - teamCoordination (координация команды)\n3.
              Combo Scoring System рассчитывает общий score\n4. Combo Scoring System
              определяет категорию (Bronze/Silver/Gold/Platinum/Legendary)\n5. Combo
              Scoring System сохраняет результат\n6. Gameplay Service публикует событие
              combat.combo.score\n7. Analytics Service логирует scoring\n8. Economy
              Service может выдать награды на основе score\n", "chain_combo_flow":
              "1. Первое комбо активировано\n2. Chain Combo Manager отслеживает временное
              окно (<3 секунд)\n3. Игрок(и) выполняют следующее комбо в окне\n4. Chain
              Combo Manager проверяет совместимость комбо\n5. Chain Combo Manager
              применяет бонусы chain-комбо\n6. Chain Combo Manager сокращает кулдауны\n7.
              Gameplay Service публикует событие combat.combo.chain\n8. Realtime Gateway
              отправляет обновление клиентам\n"}, "database_structure": {"tables":
              [{"name": "combo_catalog", "description": "Каталог комбо", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"name": "VARCHAR(255)"}, {"description":
              "TEXT"}, {"combo_type": "ENUM (solo, team, legendary)"}, {"complexity":
              "ENUM (Bronze, Silver, Gold, Platinum, Legendary)"}, {"requirements":
              "JSONB"}, {"sequence": "JSONB"}, {"bonuses": "JSONB"}, {"cooldown":
              "INTEGER"}, {"chain_compatible": "BOOLEAN"}, {"created_at": "TIMESTAMP"}]},
              {"name": "combo_activations", "description": "Журнал активаций комбо",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"combo_id": "UUID FOREIGN KEY"},
              {"character_id": "UUID FOREIGN KEY"}, {"participants": "JSONB"}, {"context":
              "JSONB"}, {"success": "BOOLEAN"}, {"score": "INTEGER"}, {"activated_at":
              "TIMESTAMP"}, {"duration": "INTEGER"}]}, {"name": "combo_synergies",
              "description": "Связи синергий", "columns": [{"id": "UUID PRIMARY KEY"},
              {"synergy_type": "ENUM (ability, team, equipment, implant, timing)"},
              {"combo_id": "UUID FOREIGN KEY"}, {"ability_ids": "JSONB (nullable)"},
              {"equipment_ids": "JSONB (nullable)"}, {"implant_ids": "JSONB (nullable)"},
              {"team_size": "INTEGER (nullable)"}, {"timing_window": "INTEGER (nullable)"},
              {"bonuses": "JSONB"}, {"requirements": "JSONB"}]}, {"name": "combo_loadouts",
              "description": "Лоадауты комбо", "columns": [{"id": "UUID PRIMARY KEY"},
              {"character_id": "UUID FOREIGN KEY"}, {"active_combos": "JSONB"}, {"preferences":
              "JSONB"}, {"auto_activate": "BOOLEAN"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "combo_scoring_history", "description":
              "История scoring", "columns": [{"id": "UUID PRIMARY KEY"}, {"activation_id":
              "UUID FOREIGN KEY"}, {"execution_difficulty": "INTEGER"}, {"damage_output":
              "INTEGER"}, {"visual_impact": "INTEGER"}, {"team_coordination": "INTEGER"},
              {"total_score": "INTEGER"}, {"category": "VARCHAR(50)"}, {"timestamp":
              "TIMESTAMP"}]}, {"name": "combo_failure_log", "description": "Лог неудачных
              попыток", "columns": [{"id": "UUID PRIMARY KEY"}, {"combo_id": "UUID
              FOREIGN KEY"}, {"character_id": "UUID FOREIGN KEY"}, {"failure_reason":
              "VARCHAR(255)"}, {"context": "JSONB"}, {"timestamp": "TIMESTAMP"}]},
              {"name": "combo_chains", "description": "История chain-комбо", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"first_combo_id": "UUID FOREIGN KEY"},
              {"second_combo_id": "UUID FOREIGN KEY"}, {"character_id": "UUID FOREIGN
              KEY"}, {"time_between": "INTEGER"}, {"bonuses_applied": "JSONB"}, {"cooldown_reduction":
              "INTEGER"}, {"timestamp": "TIMESTAMP"}]}]}, "integrations": {"ability_service":
              "- Проверка доступности способностей для комбо\n- Получение данных о
              способностях для синергий\n- Интеграция с системой способностей\n",
              "implant_service": "- Проверка активных имплантов для синергий\n- Получение
              данных об имплантах\n- Расчет бонусов имплантов\n", "inventory_service":
              "- Проверка экипировки для синергий\n- Получение данных об экипировке\n-
              Расчет бонусов экипировки\n", "progression_service": "- Проверка требований
              комбо (навыки, уровень)\n- Начисление опыта за комбо\n- Обновление навыков
              на основе комбо\n", "quest_service": "- Триггеры квестов при выполнении
              комбо\n- Проверка достижений комбо\n- Интеграция с системой квестов\n",
              "analytics_service": "- Логирование всех активаций комбо\n- Сбор метрик
              эффективности\n- Анализ синергий и комбо\n- Детект эксплойтов\n", "economy_service":
              "- Выдача наград на основе scoring\n- Экономические модификаторы для
              комбо\n- Интеграция с системой наград\n", "social_service": "- Координация
              командных комбо\n- Проверка участников команды\n- Социальные бонусы
              для командных комбо\n", "realtime_gateway": "- Отправка realtime обновлений
              комбо\n- Синхронизация активаций\n- Уведомления о синергиях\n"}, "network_requirements":
              {"protocol": "Combat Combos система использует WebSocket (TCP) для realtime
              синхронизации:\n- Протокол: WebSocket (TCP) - постоянно, без переключения\n-
              Применение: realtime обновления активаций комбо, персональные уведомления\n-
              Надежная доставка сообщений для синхронизации комбо\n- Поддержка TLS
              (wss://)\n- Интеграция с Realtime Gateway для WebSocket соединений\n",
              "tickrate_and_frequency": "Тикрейт и частота обновлений:\n- Активация
              комбо: Event-based (при активации комбо)\n- Синхронизация комбо: Event-based
              (при изменениях состояния)\n- Персональные уведомления: Event-based
              (при событиях комбо)\n- WebSocket heartbeat: каждые 30 секунд\n- Event
              Bus синхронизация: batch каждые 100 мс (для оптимизации)\n", "latency_requirements":
              "Требования к задержке:\n- WebSocket обновления комбо: <50 мс (p99)
              для realtime синхронизации\n- Активация комбо: <100 мс (p99)\n- Event
              Bus синхронизация: <200 мс (p99)\n- Персональные уведомления: <50 мс
              (p99)\n", "network_load": "Сетевая нагрузка:\n- WebSocket обновления
              комбо: 0.5-2 KB/sec на игрока (зависит от частоты активаций)\n- Event
              Bus синхронизация: 1-5 KB/sec (batch синхронизация)\n- Персональные
              уведомления: 0.1-0.5 KB/sec на игрока\n- Общий трафик: ~0.6-2.5 KB/sec
              на игрока\n", "optimization": "Оптимизации:\n- Event-based синхронизация
              для снижения трафика\n- Batch синхронизация через Event Bus (каждые
              100 мс)\n- WebSocket каналы только для активных подписчиков\n- Кэширование
              каталога комбо для быстрого доступа\n"}}, "technical_specification":
              {"subtasks": [{"id": "combo-catalog-manager", "title": "Реализация менеджера
              каталога комбо", "description": "Реализация Combo Catalog Manager с
              загрузкой и кэшированием комбо,\nфильтрацией по типам и сложности.\n",
              "dependencies": [], "estimated_effort": "3 days"}, {"id": "combo-activation-engine",
              "title": "Реализация движка активации комбо", "description": "Реализация
              Combo Activation Engine с отслеживанием действий,\nпроверкой последовательностей
              и активацией комбо.\n", "dependencies": ["combo-catalog-manager"], "estimated_effort":
              "5 days"}, {"id": "synergy-system", "title": "Реализация системы синергий",
              "description": "Реализация Synergy System с поддержкой всех типов синергий\nи
              расчетом бонусов.\n", "dependencies": ["combo-activation-engine"], "estimated_effort":
              "5 days"}, {"id": "combo-scoring-system", "title": "Реализация системы
              scoring", "description": "Реализация Combo Scoring System с расчетом
              метрик,\nопределением категорий и сохранением результатов.\n", "dependencies":
              ["combo-activation-engine"], "estimated_effort": "4 days"}, {"id": "chain-combo-manager",
              "title": "Реализация менеджера chain-комбо", "description": "Реализация
              Chain Combo Manager с отслеживанием временных окон,\nпроверкой совместимости
              и применением бонусов.\n", "dependencies": ["combo-activation-engine"],
              "estimated_effort": "4 days"}, {"id": "combo-loadout-manager", "title":
              "Реализация менеджера лоадаутов", "description": "Реализация Combo Loadout
              Manager с управлением активными комбо\nи настройками персонажей.\n",
              "dependencies": ["combo-catalog-manager"], "estimated_effort": "3 days"},
              {"id": "combo-analytics-collector", "title": "Реализация сборщика аналитики",
              "description": "Реализация Combo Analytics Collector с логированием
              активаций,\nсбором метрик и интеграцией с Analytics Service.\n", "dependencies":
              ["combo-activation-engine", "combo-scoring-system"], "estimated_effort":
              "3 days"}, {"id": "websocket-channels", "title": "Реализация WebSocket
              каналов", "description": "Реализация WebSocket каналов для realtime
              обновлений комбо\nи персональных уведомлений.\n", "dependencies": ["combo-activation-engine"],
              "estimated_effort": "3 days"}, {"id": "event-bus-integration", "title":
              "Интеграция с Event Bus", "description": "Реализация публикации и подписки
              на события через Kafka\nдля всех компонентов системы комбо.\n", "dependencies":
              ["combo-activation-engine", "synergy-system"], "estimated_effort": "2
              days"}, {"id": "database-schema", "title": "Создание схемы БД", "description":
              "Создание таблиц БД для комбо, синергий, scoring, лоадаутов\nи chain-комбо
              с миграциями Liquibase.\n", "dependencies": [], "estimated_effort":
              "2 days"}]}, "diagrams": {"component_diagram": "```mermaid\ngraph TB\n    Client[UE5
              Client] --> Gateway[API Gateway]\n\n    Gateway --> GameplayService[Gameplay
              Service<br/>8083]\n\n    GameplayService --> CCM[Combo Catalog Manager]\n    GameplayService
              --> CAE[Combo Activation Engine]\n    GameplayService --> SS[Synergy
              System]\n    GameplayService --> CSS[Combo Scoring System]\n    GameplayService
              --> CCM2[Chain Combo Manager]\n    GameplayService --> CLM[Combo Loadout
              Manager]\n    GameplayService --> CAC[Combo Analytics Collector]\n\n    CAE
              --> CCM\n    CAE --> SS\n    CAE --> CSS\n    CAE --> CCM2\n\n    GameplayService
              --> AbilityService[Ability Service]\n    GameplayService --> ImplantService[Implant
              Service]\n    GameplayService --> InventoryService[Inventory Service]\n    GameplayService
              --> ProgressionService[Progression Service]\n    GameplayService -->
              QuestService[Quest Service]\n    GameplayService --> AnalyticsService[Analytics
              Service]\n    GameplayService --> EconomyService[Economy Service]\n    GameplayService
              --> SocialService[Social Service]\n\n    GameplayService --> EventBus[Event
              Bus<br/>Kafka]\n    EventBus --> RealtimeGateway[Realtime Gateway]\n\n    GameplayService
              --> DB[(Gameplay DB)]\n\n    Client --> WSCombo[WebSocket<br/>Combos]\n    WSCombo
              --> GameplayService\n```\n", "combo_activation_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              P as Player(s)\n    participant CAE as Combo Activation Engine\n    participant
              CCM as Combo Catalog Manager\n    participant SS as Synergy System\n    participant
              CSS as Combo Scoring System\n    participant CCM2 as Chain Combo Manager\n    participant
              EB as Event Bus\n\n    P->>CAE: Execute action sequence\n    CAE->>CCM:
              Check combo match\n    CCM-->>CAE: Combo found\n    CAE->>CAE: Validate
              requirements\n    CAE->>CAE: Check participants\n    CAE->>CAE: Activate
              combo\n    CAE->>SS: Check synergies\n    SS->>SS: Analyze context\n    SS->>SS:
              Apply synergies\n    SS-->>CAE: Synergies applied\n    CAE->>CSS: Calculate
              score\n    CSS-->>CAE: Score calculated\n    CAE->>CCM2: Check chain
              combo\n    CCM2-->>CAE: Chain status\n    CAE->>EB: Publish combat.combo.activated\n    CAE-->>P:
              Combo activated\n```\n", "synergy_scoring_diagram": "```mermaid\nsequenceDiagram\n    participant
              CAE as Combo Activation Engine\n    participant SS as Synergy System\n    participant
              IS as Implant Service\n    participant ES as Economy Service\n    participant
              CSS as Combo Scoring System\n    participant AS as Analytics Service\n\n    CAE->>SS:
              Combo activated\n    SS->>SS: Check ability synergies\n    SS->>IS:
              Get active implants\n    IS-->>SS: Implants data\n    SS->>SS: Check
              equipment synergies\n    SS->>SS: Check team synergies\n    SS->>SS:
              Check timing synergies\n    SS->>SS: Calculate bonuses\n    SS->>CSS:
              Apply synergies to scoring\n    CSS->>CSS: Calculate total score\n    CSS->>AS:
              Log scoring\n    CSS->>ES: Check rewards\n    ES-->>CSS: Rewards determined\n    CSS-->>CAE:
              Scoring complete\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "combat-combos-synergies-architecture", "title": "Архитектура
              системы комбо и синергий", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T19:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "combat", "combos", "synergies", "scoring"],
              "related_systems": ["gameplay-service", "analytics-service", "economy-service"],
              "related_documents": [{"id": "mechanics-combat-combos-synergies", "relation":
              "implements"}, {"id": "analysis-2025-11-09-combat-combos-brief", "relation":
              "extends"}, {"id": "combat-abilities-architecture", "relation": "complements"}],
              "github_issue": 158, "visibility": "internal", "audience": ["architect",
              "backend", "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\combat-combos-synergies-architecture.yaml
