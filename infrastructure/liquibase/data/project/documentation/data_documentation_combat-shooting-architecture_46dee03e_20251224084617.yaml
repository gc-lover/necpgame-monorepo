databaseChangeLog:
- changeSet:
    id: documentation-combat-shooting-architecture-46dee03e
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '6013880175621367'
        - column:
            name: doc_id
            value: combat-shooting-architecture
        - column:
            name: title
            value: Архитектура системы стрельбы
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 21:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - combat
            - shooting
            - ttk
            - recoil
            - ballistics
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - gameplay-service
            - analytics-service
            - economy-service
        - column:
            name: related_documents
            value: '[{"id": "combat-shooting", "relation": "implements"}, {"id": "combat-shooting-advanced",
              "relation": "implements"}, {"id": "analysis-combat-shooting-package",
              "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "combat-shooting-architecture", "title": "Архитектура
              системы стрельбы", "document_type": "architecture", "category": "systems",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T21:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "combat", "shooting", "ttk", "recoil", "ballistics"],
              "related_systems": ["gameplay-service", "analytics-service", "economy-service"],
              "related_documents": [{"id": "combat-shooting", "relation": "implements"},
              {"id": "combat-shooting-advanced", "relation": "implements"}, {"id":
              "analysis-combat-shooting-package", "relation": "extends"}], "github_issue":
              161, "visibility": "internal", "audience": ["architect", "backend",
              "gameplay", "api-designer"]}, "summary": {"problem": "Требуется спроектировать
              архитектуру системы стрельбы, включающую:\n- Профили TTK по режимам
              (PvE, PvP, арены)\n- Систему урона и части тела (органические и кибер-части)\n-
              Отдачу и точность\n- Модификаторы (импланты, навыки, экипировка)\n-
              Лоадауты оружия\n- Профили дистанции\n- Рикошеты и закрученные выстрелы\n-
              Кастомизацию оружия\n- Телеметрию\n", "goal": "Создать архитектурную
              схему системы стрельбы с определением:\n- Компонентов для управления
              стрельбой\n- REST, WebSocket и Event Bus контрактов\n- Интеграций с
              другими системами\n- Структуры БД\n- Технического задания для реализации\n",
              "essence": "Объединенная архитектура системы стрельбы с поддержкой гибридного
              боя,\nTTK профилей, отдачи, модификаторов и расширенных механик.\n"},
              "architecture": {"overview": "Архитектура системы стрельбы состоит из
              следующих компонентов:\n1. Shooting Profile Manager - управление профилями
              стрельбы\n2. Recoil Pattern Manager - управление отдачей\n3. TTK Calculator
              - расчет TTK\n4. Damage Calculator - расчет урона\n5. Modifier System
              - система модификаторов\n6. Loadout Manager - управление лоадаутами\n7.
              Ballistics Engine - движок баллистики\n8. Weapon Customization Manager
              - управление кастомизацией\n9. Shooting Telemetry Collector - сбор телеметрии\n",
              "microservices": [{"name": "gameplay-service", "port": 8083, "responsibility":
              "Обработка стрельбы:\n- Управление профилями стрельбы\n- Управление
              отдачей\n- Расчет TTK\n- Расчет урона\n- Применение модификаторов\n-
              Управление лоадаутами\n- Обработка баллистики\n- Управление кастомизацией\n-
              Сбор телеметрии\n", "components": [{"shooting-profile-manager": "управление
              профилями стрельбы"}, {"recoil-pattern-manager": "управление отдачей"},
              {"ttk-calculator": "расчет TTK"}, {"damage-calculator": "расчет урона"},
              {"modifier-system": "система модификаторов"}, {"loadout-manager": "управление
              лоадаутами"}, {"ballistics-engine": "движок баллистики"}, {"weapon-customization-manager":
              "управление кастомизацией"}, {"shooting-telemetry-collector": "сбор
              телеметрии"}], "endpoints": ["GET /api/v1/gameplay/combat/shooting/profiles
              - получение профилей стрельбы", "GET /api/v1/gameplay/combat/shooting/weapons/{weaponId}/recoil
              - получение отдачи оружия", "POST /api/v1/gameplay/combat/shooting/weapons/{weaponId}/recoil
              - обновление отдачи", "GET /api/v1/gameplay/combat/shooting/ttk - расчет
              TTK", "POST /api/v1/gameplay/combat/shooting/ttk - обновление TTK",
              "GET /api/v1/gameplay/combat/shooting/modifiers - получение модификаторов",
              "POST /api/v1/gameplay/combat/shooting/modifiers - применение модификаторов",
              "GET /api/v1/gameplay/combat/shooting/loadouts - получение лоадаутов",
              "POST /api/v1/gameplay/combat/shooting/loadouts - сохранение лоадаута",
              "POST /api/v1/gameplay/combat/shooting/ballistics/simulate - симуляция
              баллистики", "GET /api/v1/gameplay/combat/shooting/weapons/{weaponId}/customization
              - получение кастомизации", "POST /api/v1/gameplay/combat/shooting/weapons/{weaponId}/customization
              - обновление кастомизации", "GET /api/v1/gameplay/combat/shooting/telemetry
              - телеметрия стрельбы"], "websocket_channels": ["wss://api.necp.game/v1/gameplay/combat/shooting/{sessionId}
              - поток отдачи и TTK в реальном времени"], "events_published": [{"combat.shooting.recoil-updated":
              "обновление отдачи"}, {"combat.shooting.modifier-applied": "применение
              модификатора"}, {"combat.shooting.ttk-adjusted": "корректировка TTK"},
              {"combat.shooting.loadout-saved": "сохранение лоадаута"}, {"combat.shooting.ballistics-calculated":
              "расчет баллистики"}, {"combat.shooting.customization-updated": "обновление
              кастомизации"}], "events_subscribed": [{"combat.session.started": "начало
              боевой сессии"}, {"combat.weapon.equipped": "экипировка оружия"}, {"combat.implant.activated":
              "активация импланта"}, {"progression.skill-updated": "обновление навыков"},
              {"inventory.item-updated": "обновление предмета"}]}], "ttk_profiles":
              [{"name": "open_world_pve", "description": "Открытый мир и PvE", "ttk_range":
              "5-10+ попаданий", "characteristics": "Высокий TTK, продлевающий бои,
              позволяет имплантам и прогрессии проявляться"}, {"name": "tactical_pvp",
              "description": "Тактические PvP-зоны", "ttk_range": "1-3 попадания",
              "characteristics": "Низкий TTK с акцентом на позиционирование и точность"},
              {"name": "arena_ranked", "description": "Арены и рейтинговые матчи",
              "ttk_range": "1-3 попадания", "characteristics": "Низкий TTK с акцентом
              на позиционирование и точность"}], "damage_system": {"body_parts_organic":
              [{"name": "head", "multiplier": 2.0, "description": "Голова (органическая)"},
              {"name": "torso", "multiplier": 1.0, "description": "Торс (органический)"},
              {"name": "arms_legs", "multiplier": 0.7, "description": "Руки/ноги (органические)"}],
              "body_parts_cyber": [{"name": "cyber_head", "multiplier": 1.5, "description":
              "Кибер-голова", "vulnerabilities": ["EMP", "cyber-damage"]}, {"name":
              "cyber_torso", "multiplier": 0.8, "description": "Кибер-торс", "vulnerabilities":
              ["EMP", "cyber-damage"]}, {"name": "cyber_limbs", "multiplier": 0.5,
              "description": "Кибер-конечности", "vulnerabilities": ["EMP", "cyber-damage"]}],
              "damage_types": ["physical", "energy", "chemical", "thermal", "emp",
              "cyber", "poison", "electromagnetic"], "weapon_types": ["kinetic", "energy",
              "explosive", "melee", "smart", "implanted", "chemical", "emp"]}, "recoil_system":
              {"recoil_patterns": [{"name": "predictable", "description": "Предсказуемая
              отдача для аркадного стиля", "characteristics": "Прямолинейная баллистика,
              предсказуемые паттерны"}, {"name": "realistic", "description": "Реалистичная
              отдача для дальнобойных комплектов", "characteristics": "Учет траектории
              и отдачи глубже"}], "recoil_modifiers": [{"source": "implants", "description":
              "Импланты влияют на контроль отдачи"}, {"source": "skills", "description":
              "Навыки снижают отдачу"}, {"source": "weapon_mods", "description": "Моды
              оружия модифицируют отдачу"}]}, "ballistics_features": [{"name": "distance_profiles",
              "description": "Профили эффективности по дистанции", "characteristics":
              "Формулы падения урона и отклонения"}, {"name": "smart_ricochet", "description":
              "Smart Ricochet 2.0", "requirements": "Смарт-прицелы, специальные патроны,
              перки", "characteristics": "Расчет отскоков, ограничение количества
              рикошетов"}, {"name": "curved_shot", "description": "Curved Shot (закрученные
              выстрелы)", "requirements": "Комбинация имплантов и модов", "characteristics":
              "Обход укрытий по bezier-траектории"}], "weapon_customization": {"modular_slots":
              ["barrel", "sight", "stock", "chip", "magazine"], "mod_levels": ["MK_I",
              "MK_II", "MK_III"], "customization_features": [{"crafting": "Крафт модов
              через economy-service"}, {"dismantling": "Распыление оружия для ресурсов"},
              {"reconfiguration": "Перенастройка модулей без потерь"}]}, "data_flows":
              {"shooting_profile_flow": "1. Игрок начинает стрельбу\n2. Shooting Profile
              Manager получает запрос через GET /api/v1/gameplay/combat/shooting/profiles\n3.
              Shooting Profile Manager определяет режим (PvE/PvP/арена)\n4. Shooting
              Profile Manager применяет соответствующий TTK профиль\n5. TTK Calculator
              рассчитывает TTK на основе режима и модификаторов\n6. Gameplay Service
              публикует событие combat.shooting.ttk-adjusted\n7. Realtime Gateway
              отправляет обновление клиентам\n", "recoil_management_flow": "1. Игрок
              стреляет\n2. Recoil Pattern Manager получает данные о выстреле\n3. Recoil
              Pattern Manager определяет паттерн отдачи оружия\n4. Modifier System
              применяет модификаторы от имплантов и навыков\n5. Recoil Pattern Manager
              рассчитывает итоговую отдачу\n6. Gameplay Service публикует событие
              combat.shooting.recoil-updated\n7. Realtime Gateway отправляет обновление
              через WebSocket\n", "damage_calculation_flow": "1. Игрок попадает в
              цель\n2. Damage Calculator получает данные о попадании\n3. Damage Calculator
              определяет часть тела (органическая/кибер)\n4. Damage Calculator применяет
              множитель части тела\n5. Damage Calculator учитывает тип урона и сопротивления\n6.
              Modifier System применяет модификаторы от имплантов и навыков\n7. Damage
              Calculator рассчитывает итоговый урон\n8. Gameplay Service применяет
              урон к цели\n", "modifier_application_flow": "1. Игрок активирует имплант
              или получает бонус навыка\n2. Modifier System получает событие через
              Event Bus\n3. Modifier System определяет тип модификатора\n4. Modifier
              System применяет модификатор к стрельбе\n5. Modifier System обновляет
              профиль стрельбы\n6. Gameplay Service публикует событие combat.shooting.modifier-applied\n7.
              Realtime Gateway отправляет обновление клиентам\n", "loadout_management_flow":
              "1. Игрок сохраняет лоадаут оружия\n2. Loadout Manager получает запрос
              через POST /api/v1/gameplay/combat/shooting/loadouts\n3. Loadout Manager
              валидирует лоадаут\n4. Loadout Manager сохраняет лоадаут в БД\n5. Gameplay
              Service публикует событие combat.shooting.loadout-saved\n6. Realtime
              Gateway отправляет подтверждение клиенту\n", "ballistics_simulation_flow":
              "1. Игрок запрашивает симуляцию баллистики\n2. Ballistics Engine получает
              запрос через POST /api/v1/gameplay/combat/shooting/ballistics/simulate\n3.
              Ballistics Engine определяет профиль дистанции оружия\n4. Ballistics
              Engine рассчитывает траекторию и отклонение\n5. Ballistics Engine проверяет
              рикошеты и закрученные выстрелы\n6. Ballistics Engine возвращает результат
              симуляции\n7. Gameplay Service публикует событие combat.shooting.ballistics-calculated\n",
              "weapon_customization_flow": "1. Игрок кастомизирует оружие\n2. Weapon
              Customization Manager получает запрос через POST /api/v1/gameplay/combat/shooting/weapons/{weaponId}/customization\n3.
              Weapon Customization Manager валидирует модули\n4. Weapon Customization
              Manager проверяет совместимость модулей\n5. Weapon Customization Manager
              применяет кастомизацию\n6. Weapon Customization Manager обновляет характеристики
              оружия\n7. Gameplay Service публикует событие combat.shooting.customization-updated\n8.
              Realtime Gateway отправляет обновление клиенту\n"}, "database_structure":
              {"tables": [{"name": "shooting_profiles", "description": "Профили стрельбы
              персонажей", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id":
              "UUID FOREIGN KEY"}, {"ttk_profile": "ENUM (open_world_pve, tactical_pvp,
              arena_ranked)"}, {"current_ttk": "DECIMAL(5,2)"}, {"modifiers": "JSONB"},
              {"created_at": "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}]}, {"name":
              "weapon_recoil_patterns", "description": "Паттерны отдачи оружия", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"weapon_id": "UUID FOREIGN KEY"}, {"pattern_type":
              "ENUM (predictable, realistic)"}, {"pattern_data": "JSONB"}, {"modifiers":
              "JSONB"}, {"created_at": "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}]},
              {"name": "ttk_matrix", "description": "Матрица TTK по режимам и оружию",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"weapon_id": "UUID FOREIGN
              KEY"}, {"mode": "ENUM (open_world_pve, tactical_pvp, arena_ranked)"},
              {"base_ttk": "DECIMAL(5,2)"}, {"min_ttk": "DECIMAL(5,2)"}, {"max_ttk":
              "DECIMAL(5,2)"}, {"modifiers": "JSONB"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "shooting_modifiers", "description":
              "Модификаторы стрельбы", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id":
              "UUID FOREIGN KEY"}, {"modifier_type": "ENUM (implant, skill, equipment,
              weapon_mod)"}, {"modifier_source_id": "UUID"}, {"modifier_value": "JSONB"},
              {"applied_at": "TIMESTAMP"}, {"expires_at": "TIMESTAMP"}]}, {"name":
              "player_loadouts", "description": "Лоадауты оружия игроков", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID FOREIGN KEY"}, {"name":
              "VARCHAR(255)"}, {"weapon_id": "UUID FOREIGN KEY"}, {"weapon_mods":
              "JSONB"}, {"is_active": "BOOLEAN"}, {"created_at": "TIMESTAMP"}, {"updated_at":
              "TIMESTAMP"}]}, {"name": "ballistics_profiles", "description": "Профили
              баллистики оружия", "columns": [{"id": "UUID PRIMARY KEY"}, {"weapon_id":
              "UUID FOREIGN KEY"}, {"optimal_range": "INTEGER"}, {"max_range": "INTEGER"},
              {"damage_falloff": "JSONB"}, {"deviation_cone": "JSONB"}, {"ricochet_enabled":
              "BOOLEAN"}, {"curved_shot_enabled": "BOOLEAN"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "weapon_customization", "description":
              "Кастомизация оружия", "columns": [{"id": "UUID PRIMARY KEY"}, {"weapon_id":
              "UUID FOREIGN KEY"}, {"character_id": "UUID FOREIGN KEY"}, {"barrel_mod":
              "UUID FOREIGN KEY"}, {"sight_mod": "UUID FOREIGN KEY"}, {"stock_mod":
              "UUID FOREIGN KEY"}, {"chip_mod": "UUID FOREIGN KEY"}, {"magazine_mod":
              "UUID FOREIGN KEY"}, {"stats": "JSONB"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "shooting_telemetry", "description":
              "Телеметрия стрельбы"}]}}}'
        - column:
            name: metadata
            value: '{"id": "combat-shooting-architecture", "title": "Архитектура системы
              стрельбы", "document_type": "architecture", "category": "systems", "status":
              "draft", "version": "1.0.0", "last_updated": "2025-11-23T21:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "combat", "shooting", "ttk", "recoil", "ballistics"],
              "related_systems": ["gameplay-service", "analytics-service", "economy-service"],
              "related_documents": [{"id": "combat-shooting", "relation": "implements"},
              {"id": "combat-shooting-advanced", "relation": "implements"}, {"id":
              "analysis-combat-shooting-package", "relation": "extends"}], "github_issue":
              161, "visibility": "internal", "audience": ["architect", "backend",
              "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\combat-shooting-architecture.yaml
