databaseChangeLog:
- changeSet:
    id: documentation-combat-shooting-shooter-architecture-ca6e6e3d
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '8453404869111905'
        - column:
            name: doc_id
            value: architecture-combat-shooting-shooter-update
        - column:
            name: title
            value: Combat Shooting — Shooter Paradigm Architecture
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: implementation
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-14 14:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - combat
            - shooting
            - shooter
            - ttk
            - ballistics
        - column:
            name: topics
            value:
            - combat-systems
            - real-time-gaming
            - weapon-balance
        - column:
            name: related_systems
            value:
            - gameplay-service
            - character-service
            - analytics-service
        - column:
            name: related_documents
            value: '[{"id": "mechanics-combat-shooting", "relation": "implements"},
              {"id": "combat-shooter-core", "relation": "extends"}, {"id": "combat-session-system-part1",
              "relation": "integrates"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: ''
        - column:
            name: audience
            value: []
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "architecture-combat-shooting-shooter-update",
              "title": "Combat Shooting — Shooter Paradigm Architecture", "document_type":
              "architecture", "category": "implementation", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-14T14:00:00+00:00", "concept_approved":
              false, "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["combat", "shooting", "shooter", "ttk", "ballistics"], "topics":
              ["combat-systems", "real-time-gaming", "weapon-balance"], "related_systems":
              ["gameplay-service", "character-service", "analytics-service"], "related_documents":
              [{"id": "mechanics-combat-shooting", "relation": "implements"}, {"id":
              "combat-shooter-core", "relation": "extends"}, {"id": "combat-session-system-part1",
              "relation": "integrates"}]}, "summary": {"problem": "Требуется обновление
              архитектуры стрельбы для перехода от MMORPG к shooter парадигме с детальными
              TTK, баллистикой и оружием", "goal": "Спроектировать масштабируемую
              архитектуру боевой системы для MMOFPS с 60+ FPS и P99 <50ms", "essence":
              "Микросервисная архитектура с event-driven интеграцией, server-authoritative
              моделью и оптимизациями для high-throughput", "key_points": ["Server-authoritative
              модель с client-side prediction", "Event-driven архитектура через Kafka
              для телеметрии", "Масштабируемые сервисы с horizontal scaling", "Детальная
              баллистика с raycasting и hit registration"]}, "content": {"sections":
              [{"id": "system-overview", "title": "Обзор системы", "body": "## Shooter
              Paradigm Transition\n\nCombat Shooting переходит от MMORPG dice-roll
              механик к полноценной 3D-shooter системе:\n\n### Ключевые изменения:\n-
              **От dice-roll к баллистике**: Реальная физика пуль, raycasting, hit
              registration\n- **От abstract damage к detailed TTK**: Weapon-specific
              time-to-kill с учетом дистанции, accuracy\n- **От turn-based к real-time**:
              60-128 Hz tick rate, client-side prediction\n- **От simplified к complex
              weapons**: Множество типов оружия с уникальными параметрами\n\n### Архитектурные
              принципы:\n- **Server-authoritative**: Сервер контролирует все боевые
              действия\n- **Event-driven**: Все события через Kafka для analytics
              и quest integration\n- **Horizontally scalable**: Stateless handlers
              + stateful session managers\n- **Low latency**: P99 <50ms для всех операций\n"},
              {"id": "weapon-system", "title": "Система оружия", "body": "## Weapon
              Categories\n\n### Primary Weapons (Основное оружие)\n- **Assault Rifles**:
              AR-15 платформа с различными калибрами\n- **SMGs**: Высокий fire rate,
              low recoil, close-quarters\n- **Shotguns**: High damage at close range,
              spread patterns\n- **Sniper Rifles**: Long-range precision, bolt-action
              mechanics\n- **LMGs**: Sustained fire, high magazine capacity\n\n###
              Secondary Weapons (Второстепенное)\n- **Pistols**: Backup weapons, high
              accuracy\n- **Machine Pistols**: High fire rate, low damage\n- **Revolvers**:
              High damage, slow fire rate\n\n### Special Weapons (Специальное)\n-
              **Grenade Launchers**: Area denial, explosive damage\n- **Rocket Launchers**:
              Heavy anti-vehicle, splash damage\n- **Railguns**: Energy weapons, high
              penetration\n\n## Weapon Parameters\n\n### Core Stats:\n- **Damage**:
              Base damage per shot\n- **Fire Rate**: Rounds per minute\n- **Magazine
              Size**: Bullets per magazine\n- **Reload Time**: Time to reload\n- **Recoil
              Pattern**: Vertical/horizontal recoil\n- **Accuracy**: Base accuracy,
              bloom mechanics\n\n### Advanced Mechanics:\n- **Bullet Drop**: Gravity
              simulation\n- **Wind Effects**: Environmental factors\n- **Penetration**:
              Wall/material penetration\n- **Ricochet**: Bullet bouncing physics\n"},
              {"id": "ttk-system", "title": "Time-to-Kill (TTK) система", "body":
              "## TTK Calculation\n\n### Base Formula:\n```\nTTK = (Health / DPS)
              + Reload_Penalty + Positioning_Penalty\n```\n\n### Factors Affecting
              TTK:\n- **Weapon DPS**: Damage × Fire Rate\n- **Player Positioning**:
              Cover usage, distance\n- **Reload Timing**: Weapon-specific reload times\n-
              **Hit Accuracy**: Headshot multipliers, body part modifiers\n\n### Zone-Based
              TTK Scaling\n\n#### PvP Arenas (Competitive):\n- **Fast TTK**: 150-300ms
              average\n- **High skill ceiling**: Precision aiming required\n- **Counter-play**:
              Positioning, cover usage\n\n#### PvP Streets (Open World):\n- **Medium
              TTK**: 400-600ms average\n- **Environmental factors**: Cover, elevation\n-
              **Vehicle integration**: Drive-by shooting\n\n#### PvE Zones:\n- **Variable
              TTK**: 200-800ms based on enemy type\n- **Scaling difficulty**: AI behavior
              affects effective TTK\n- **Group mechanics**: Multiple targets, area
              effects\n"}, {"id": "ballistics-system", "title": "Баллистическая система",
              "body": "## Physics Simulation\n\n### Bullet Trajectory:\n- **Gravity**:
              Realistic bullet drop over distance\n- **Drag**: Air resistance affecting
              velocity\n- **Wind**: Environmental wind effects\n- **Magnus Effect**:
              Bullet spin stabilization\n\n### Hit Registration:\n- **Raycasting**:
              Server-side line-of-sight checks\n- **Hitbox System**: Multi-part hitboxes
              (head, torso, limbs)\n- **Material Penetration**: Wall thickness, armor
              types\n- **Ricochet**: Angle-based bullet bouncing\n\n### Anti-Cheat
              Integration:\n- **Position Validation**: Client position verification\n-
              **Angle Validation**: View angle sanity checks\n- **Timing Validation**:
              Shot timing verification\n- **Pattern Analysis**: Aimbot detection algorithms\n"},
              {"id": "network-architecture", "title": "Сетевая архитектура", "body":
              "## Communication Protocols\n\n### PvP (Competitive):\n- **Protocol**:
              UDP with reliability layer\n- **Tick Rate**: 128 Hz (8ms intervals)\n-
              **Latency Target**: <30ms P99\n- **Bandwidth**: ~50 KB/s per player\n\n###
              PvE (Story):\n- **Protocol**: WebSocket + UDP hybrid\n- **Tick Rate**:
              60 Hz (16ms intervals)\n- **Latency Target**: <100ms P99\n- **Bandwidth**:
              ~20 KB/s per player\n\n### Open World (Exploration):\n- **Protocol**:
              WebSocket primary, UDP for combat\n- **Tick Rate**: 30 Hz (33ms intervals)\n-
              **Latency Target**: <150ms P99\n- **Bandwidth**: ~10 KB/s per player\n\n##
              Server Architecture\n\n### Session Managers:\n- **Stateful**: Maintain
              combat session state\n- **Sharded**: session_id % num_shards\n- **Redundant**:
              Active-passive failover\n\n### Combat Engines:\n- **Stateless**: Pure
              calculation services\n- **Horizontally scaled**: Load balancer distribution\n-
              **Cached**: Hot path optimizations\n\n### Event Publishers:\n- **Kafka
              Integration**: Async event publishing\n- **Batch Processing**: High-throughput
              optimization\n- **Reliability**: At-least-once delivery\n"}, {"id":
              "services-architecture", "title": "Архитектура сервисов", "body": "##
              Core Services\n\n### gameplay-service (Combat Core):\n- **Responsibilities**:
              Session management, damage calculation, state sync\n- **Scaling**: 10-20
              instances, session-sticky routing\n- **Performance**: P99 <50ms for
              all operations\n\n### character-service (Stats):\n- **Responsibilities**:
              Character stats, weapon loadouts, progression\n- **Integration**: REST
              API for stat queries\n- **Caching**: Redis with 10min TTL\n\n### analytics-service
              (Telemetry):\n- **Responsibilities**: Combat event logging, performance
              metrics\n- **Storage**: ClickHouse for time-series data\n- **Throughput**:
              100k+ events/sec\n\n### security-service (Anti-Cheat):\n- **Responsibilities**:
              Action validation, cheat detection\n- **Processing**: Real-time pattern
              analysis\n- **Alerting**: Automated ban systems\n\n## Database Schema\n\n###
              combat_weapons:\n```sql\nCREATE TABLE combat_weapons (\n  id UUID PRIMARY
              KEY,\n  weapon_type VARCHAR(50),\n  base_damage INT,\n  fire_rate INT,\n  magazine_size
              INT,\n  reload_time_ms INT,\n  recoil_pattern JSONB,\n  created_at TIMESTAMP\n);\n```\n\n###
              combat_shots:\n```sql\nCREATE TABLE combat_shots (\n  id BIGSERIAL PRIMARY
              KEY,\n  session_id UUID,\n  shooter_id UUID,\n  weapon_id UUID,\n  hit_position
              POINT,\n  damage_dealt INT,\n  hit_part VARCHAR(20),\n  timestamp TIMESTAMP,\n  server_verified
              BOOLEAN\n);\n```\n\n### combat_damage_events:\n```sql\nCREATE TABLE
              combat_damage_events (\n  id BIGSERIAL PRIMARY KEY,\n  session_id UUID,\n  attacker_id
              UUID,\n  victim_id UUID,\n  weapon_id UUID,\n  damage_amount INT,\n  damage_type
              VARCHAR(20),\n  was_fatal BOOLEAN,\n  timestamp TIMESTAMP\n);\n```\n"},
              {"id": "performance-targets", "title": "Цели производительности", "body":
              "## Latency Requirements\n\n### Critical Path (<10ms):\n- Hit registration
              validation\n- Damage calculation\n- State synchronization\n\n### Fast
              Path (<50ms):\n- Session state updates\n- Inventory changes\n- Progression
              updates\n\n### Normal Path (<200ms):\n- Analytics processing\n- Match
              history updates\n- Leaderboard calculations\n\n## Throughput Targets\n\n###
              Peak Load:\n- 10,000 concurrent sessions\n- 100,000 shots per minute\n-
              1,000,000 damage events per minute\n\n### Scaling Strategy:\n- Horizontal
              scaling of stateless services\n- Sharding of stateful session managers\n-
              Redis clustering for cache\n- Kafka partitioning for events\n\n## Memory
              Optimization\n\n### Hot Path Allocations:\n- Zero allocations in damage
              calculation\n- Pooled objects for frequent structs\n- Stack allocation
              for temporary data\n\n### Cache Strategy:\n- Weapon stats: Redis, 1hr
              TTL\n- Player stats: Redis, 10min TTL\n- Session state: Redis, 30min
              TTL\n"}]}, "appendix": {"glossary": [{"term": "TTK", "definition": "Time
              To Kill - время, необходимое для убийства противника"}, {"term": "Server
              Authoritative", "definition": "Модель, где сервер контролирует все игровые
              действия"}, {"term": "Client-side Prediction", "definition": "Предсказание
              действий клиента для плавного геймплея"}], "references": [{"title":
              "Combat Shooting Mechanics", "url": "knowledge/mechanics/combat/combat-shooting.yaml"},
              {"title": "Shooter Core Systems", "url": "knowledge/mechanics/combat/combat-shooter-core.yaml"}]},
              "implementation": {"github_issue": 1638, "needs_task": false, "next_steps":
              ["API Designer: Создать OpenAPI спецификации для weapon system", "Backend:
              Реализовать weapon handlers с оптимизациями", "Network: Настроить UDP/WebSocket
              для real-time shooting"]}, "history": [{"version": "1.0.0", "date":
              "2025-12-14", "author": "architect", "changes": "Initial shooter paradigm
              architecture for combat shooting system"}]}'
        - column:
            name: metadata
            value: '{"id": "architecture-combat-shooting-shooter-update", "title":
              "Combat Shooting — Shooter Paradigm Architecture", "document_type":
              "architecture", "category": "implementation", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-14T14:00:00+00:00", "concept_approved":
              false, "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["combat", "shooting", "shooter", "ttk", "ballistics"], "topics":
              ["combat-systems", "real-time-gaming", "weapon-balance"], "related_systems":
              ["gameplay-service", "character-service", "analytics-service"], "related_documents":
              [{"id": "mechanics-combat-shooting", "relation": "implements"}, {"id":
              "combat-shooter-core", "relation": "extends"}, {"id": "combat-session-system-part1",
              "relation": "integrates"}]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\combat-shooting-shooter-architecture.yaml
