databaseChangeLog:
- changeSet:
    id: documentation-combat-stealth-architecture-960e0abd
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '8455442288776994'
        - column:
            name: doc_id
            value: combat-stealth-architecture
        - column:
            name: title
            value: Архитектура системы стелса
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 22:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - combat
            - stealth
            - detection
            - disguise
            - hacking
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - gameplay-service
            - combat-hacking-service
            - quest-service
            - social-service
        - column:
            name: related_documents
            value: '[{"id": "combat-stealth", "relation": "implements"}, {"id": "analysis-combat-stealth-brief",
              "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "combat-stealth-architecture", "title": "Архитектура
              системы стелса", "document_type": "architecture", "category": "systems",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T22:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "combat", "stealth", "detection", "disguise",
              "hacking"], "related_systems": ["gameplay-service", "combat-hacking-service",
              "quest-service", "social-service"], "related_documents": [{"id": "combat-stealth",
              "relation": "implements"}, {"id": "analysis-combat-stealth-brief", "relation":
              "extends"}], "github_issue": 162, "visibility": "internal", "audience":
              ["architect", "backend", "gameplay", "api-designer"]}, "summary": {"problem":
              "Требуется спроектировать архитектуру системы стелса, включающую:\n-
              Каналы обнаружения (визуальные, аудиальные, технологические, сетевые)\n-
              Элементы стелса (укрытия, тени, маскировка, убийства из засады, отвлечения,
              взлом камер)\n- Профили обнаружения\n- Маскировку под NPC\n- Хак сетей
              и камер\n- Достижения стелса\n- Карту угроз\n- Репутационные последствия\n",
              "goal": "Создать архитектурную схему системы стелса с определением:\n-
              Компонентов для управления стелсом\n- REST, WebSocket и Event Bus контрактов\n-
              Интеграций с другими системами\n- Структуры БД\n- Технического задания
              для реализации\n", "essence": "Объединенная архитектура системы стелса
              с поддержкой скрытности,\nобнаружения, маскировки и интеграции с киберпространством.\n"},
              "architecture": {"overview": "Архитектура системы стелса состоит из
              следующих компонентов:\n1. Stealth Action Manager - управление действиями
              стелса\n2. Detection System - система обнаружения\n3. Disguise Manager
              - управление маскировкой\n4. Network Hacking Integrator - интеграция
              хак сетей\n5. Threat Map Manager - управление картой угроз\n6. Stealth
              Achievement Tracker - отслеживание достижений\n7. Reputation Impact
              Calculator - расчет репутационных последствий\n8. Stealth Telemetry
              Collector - сбор телеметрии\n", "microservices": [{"name": "gameplay-service",
              "port": 8083, "responsibility": "Обработка стелса:\n- Управление действиями
              стелса\n- Система обнаружения\n- Управление маскировкой\n- Интеграция
              хак сетей\n- Управление картой угроз\n- Отслеживание достижений\n- Расчет
              репутационных последствий\n- Сбор телеметрии\n", "components": [{"stealth-action-manager":
              "управление действиями стелса"}, {"detection-system": "система обнаружения"},
              {"disguise-manager": "управление маскировкой"}, {"network-hacking-integrator":
              "интеграция хак сетей"}, {"threat-map-manager": "управление картой угроз"},
              {"stealth-achievement-tracker": "отслеживание достижений"}, {"reputation-impact-calculator":
              "расчет репутационных последствий"}, {"stealth-telemetry-collector":
              "сбор телеметрии"}], "endpoints": ["POST /api/v1/gameplay/combat/stealth/actions
              - выполнение действия стелса", "GET /api/v1/gameplay/combat/stealth/detection
              - получение состояния обнаружения", "POST /api/v1/gameplay/combat/stealth/detection/recalculate
              - пересчет обнаружения", "GET /api/v1/gameplay/combat/stealth/profile
              - получение профиля стелса", "POST /api/v1/gameplay/combat/stealth/profile
              - обновление профиля", "POST /api/v1/gameplay/combat/stealth/disguise
              - активация маскировки", "GET /api/v1/gameplay/combat/stealth/disguise/{disguiseId}
              - получение маскировки", "POST /api/v1/gameplay/combat/stealth/network/hack
              - взлом сетевого узла", "GET /api/v1/gameplay/combat/stealth/network/nodes
              - получение сетевых узлов", "GET /api/v1/gameplay/combat/stealth/achievements
              - получение достижений стелса", "GET /api/v1/gameplay/combat/stealth/threat-map
              - получение карты угроз", "POST /api/v1/gameplay/combat/stealth/reputation/calculate
              - расчет репутационных последствий"], "websocket_channels": ["wss://api.necp.game/v1/gameplay/combat/stealth/{sessionId}
              - поток обнаружения, маскировки и тревог"], "events_published": [{"combat.stealth.action":
              "выполнение действия стелса"}, {"combat.stealth.detection": "изменение
              состояния обнаружения"}, {"combat.stealth.disguise": "активация/деактивация
              маскировки"}, {"combat.stealth.hack": "взлом сетевого узла"}, {"combat.stealth.achievement":
              "получение достижения стелса"}, {"combat.stealth.threat-updated": "обновление
              карты угроз"}, {"combat.stealth.reputation-impact": "изменение репутации"}],
              "events_subscribed": [{"combat.hacking.network-accessed": "доступ к
              сети"}, {"npc.interaction": "взаимодействие с NPC"}, {"quest.trigger":
              "триггеры квестов"}, {"social.reputation-updated": "обновление репутации"},
              {"combat.ability.activated": "активация способности"}, {"combat.implant.activated":
              "активация импланта"}]}], "detection_channels": [{"name": "visual",
              "description": "Визуальное обнаружение", "sensors": ["cameras", "guards",
              "drones"], "modifiers": ["shadows", "cover", "disguise"]}, {"name":
              "audio", "description": "Аудиальное обнаружение", "sensors": ["microphones",
              "guards", "sound-detectors"], "modifiers": ["silence", "distractions",
              "sound-dampening"]}, {"name": "technological", "description": "Технологическое
              обнаружение", "sensors": ["thermal", "EMF", "motion-detectors"], "modifiers":
              ["implants", "equipment", "abilities"]}, {"name": "network", "description":
              "Сетевое обнаружение", "sensors": ["netrunners", "security-systems",
              "network-monitors"], "modifiers": ["hacking", "network-signature", "cyberdeck"]}],
              "stealth_elements": [{"name": "cover", "description": "Укрытия", "detection_reduction":
              "high", "requirements": []}, {"name": "shadows", "description": "Тени",
              "detection_reduction": "medium", "requirements": []}, {"name": "disguise",
              "description": "Маскировка под NPC", "detection_reduction": "very_high",
              "requirements": ["disguise_item", "faction_rep"]}, {"name": "ambush_kill",
              "description": "Убийство из засады", "detection_reduction": "none",
              "requirements": ["stealth_position", "target_unaware"]}, {"name": "distraction",
              "description": "Отвлечения", "detection_reduction": "medium", "requirements":
              ["distraction_item", "timing"]}, {"name": "crowd", "description": "Толпа",
              "detection_reduction": "high", "requirements": ["crowd_present", "blend_in"]},
              {"name": "camera_hack", "description": "Взлом камер", "detection_reduction":
              "very_high", "requirements": ["hacking_skill", "network_access"]}, {"name":
              "network_signature", "description": "Сетевые подписи", "detection_reduction":
              "high", "requirements": ["cyberdeck", "hacking_skill"]}], "detection_stages":
              [{"name": "undetected", "description": "Не обнаружен", "reaction": "none",
              "escalation_time": null}, {"name": "suspicious", "description": "Подозрение",
              "reaction": "investigate", "escalation_time": "30s"}, {"name": "partially_detected",
              "description": "Частичное обнаружение", "reaction": "alert", "escalation_time":
              "15s"}, {"name": "fully_detected", "description": "Полное обнаружение",
              "reaction": "combat", "escalation_time": "immediate"}], "disguise_system":
              {"disguise_types": [{"name": "npc_disguise", "description": "Маскировка
              под NPC", "requirements": ["disguise_item", "faction_rep"], "detection_reduction":
              0.8}, {"name": "faction_disguise", "description": "Маскировка под фракцию",
              "requirements": ["faction_rep", "faction_uniform"], "detection_reduction":
              0.9}, {"name": "social_engineering", "description": "Социальная инженерия",
              "requirements": ["social_skill", "npc_interaction"], "detection_reduction":
              0.7}], "disguise_compatibility": [{"factions": ["maelstrom", "valentinos",
              "tyger_claws"], "compatibility": "low", "reason": "Враждебные фракции"},
              {"factions": ["corpos", "police"], "compatibility": "medium", "reason":
              "Нейтральные фракции"}, {"factions": ["same_faction"], "compatibility":
              "high", "reason": "Своя фракция"}]}, "data_flows": {"stealth_action_flow":
              "1. Игрок выполняет действие стелса\n2. Stealth Action Manager получает
              запрос через POST /api/v1/gameplay/combat/stealth/actions\n3. Stealth
              Action Manager проверяет доступность действия\n4. Detection System пересчитывает
              обнаружение\n5. Stealth Action Manager выполняет действие\n6. Detection
              System обновляет состояние обнаружения\n7. Threat Map Manager обновляет
              карту угроз\n8. Gameplay Service публикует событие combat.stealth.action\n9.
              Realtime Gateway отправляет обновление клиентам\n", "detection_calculation_flow":
              "1. Игрок перемещается или выполняет действие\n2. Detection System получает
              данные о позиции и действиях\n3. Detection System проверяет все каналы
              обнаружения (визуальный, аудиальный, технологический, сетевой)\n4. Detection
              System учитывает элементы стелса (укрытия, тени, маскировка)\n5. Detection
              System применяет модификаторы от имплантов и способностей\n6. Detection
              System рассчитывает уровень обнаружения\n7. Detection System определяет
              стадию обнаружения (undetected, suspicious, partially_detected, fully_detected)\n8.
              Gameplay Service публикует событие combat.stealth.detection\n9. Realtime
              Gateway отправляет обновление через WebSocket\n", "disguise_activation_flow":
              "1. Игрок активирует маскировку\n2. Disguise Manager получает запрос
              через POST /api/v1/gameplay/combat/stealth/disguise\n3. Disguise Manager
              проверяет требования маскировки\n4. Disguise Manager проверяет совместимость
              с текущей фракцией\n5. Disguise Manager применяет маскировку\n6. Detection
              System пересчитывает обнаружение с учетом маскировки\n7. Gameplay Service
              публикует событие combat.stealth.disguise\n8. Realtime Gateway отправляет
              обновление клиентам\n", "network_hacking_flow": "1. Игрок взламывает
              сетевой узел\n2. Network Hacking Integrator получает запрос через POST
              /api/v1/gameplay/combat/stealth/network/hack\n3. Network Hacking Integrator
              проверяет навыки хакера\n4. Network Hacking Integrator интегрируется
              с Combat Hacking Service\n5. Network Hacking Integrator выполняет взлом\n6.
              Network Hacking Integrator обновляет сетевые подписи\n7. Detection System
              пересчитывает обнаружение\n8. Gameplay Service публикует событие combat.stealth.hack\n9.
              Realtime Gateway отправляет обновление клиентам\n", "threat_map_update_flow":
              "1. Игрок перемещается или изменяется окружение\n2. Threat Map Manager
              получает данные о позиции\n3. Threat Map Manager сканирует окружение
              на угрозы\n4. Threat Map Manager определяет типы угроз (охранники, дроны,
              камеры, сетевые узлы)\n5. Threat Map Manager рассчитывает уровень угрозы
              для каждой позиции\n6. Threat Map Manager обновляет карту угроз\n7.
              Gameplay Service публикует событие combat.stealth.threat-updated\n8.
              Realtime Gateway отправляет обновление клиентам\n", "achievement_tracking_flow":
              "1. Игрок выполняет стелс-прохождение\n2. Stealth Achievement Tracker
              отслеживает качество стелса\n3. Stealth Achievement Tracker проверяет
              критерии достижений (незаметность, отсутствие тревог, отсутствующие
              тела)\n4. Stealth Achievement Tracker начисляет достижения\n5. Gameplay
              Service публикует событие combat.stealth.achievement\n6. Realtime Gateway
              отправляет уведомление клиенту\n", "reputation_impact_flow": "1. Игрок
              завершает миссию в стелсе\n2. Reputation Impact Calculator получает
              данные о прохождении\n3. Reputation Impact Calculator проверяет качество
              стелса\n4. Reputation Impact Calculator рассчитывает репутационные последствия\n5.
              Reputation Impact Calculator применяет бонусы/штрафы к репутации\n6.
              Gameplay Service публикует событие combat.stealth.reputation-impact\n7.
              Social Service обновляет репутацию\n8. Realtime Gateway отправляет обновление
              клиентам\n"}, "database_structure": {"tables": [{"name": "stealth_actions",
              "description": "Действия стелса", "columns": [{"id": "UUID PRIMARY KEY"},
              {"character_id": "UUID FOREIGN KEY"}, {"action_type": "ENUM (cover,
              shadows, disguise, ambush_kill, distraction, crowd, camera_hack, network_signature)"},
              {"position": "JSONB"}, {"target_id": "UUID FOREIGN KEY"}, {"detection_impact":
              "DECIMAL(5,2)"}, {"timestamp": "TIMESTAMP"}]}, {"name": "stealth_profiles",
              "description": "Профили стелса персонажей", "columns": [{"id": "UUID
              PRIMARY KEY"}, {"character_id": "UUID FOREIGN KEY"}, {"detection_modifiers":
              "JSONB"}, {"preferred_elements": "JSONB"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "stealth_detection_state", "description":
              "Состояние обнаружения", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id":
              "UUID FOREIGN KEY"}, {"current_stage": "ENUM (undetected, suspicious,
              partially_detected, fully_detected)"}, {"detection_level": "DECIMAL(5,2)"},
              {"channel_detection": "JSONB"}, {"modifiers": "JSONB"}, {"last_update":
              "TIMESTAMP"}]}, {"name": "stealth_disguises", "description": "Маскировки",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID FOREIGN
              KEY"}, {"disguise_type": "ENUM (npc_disguise, faction_disguise, social_engineering)"},
              {"target_faction": "VARCHAR(100)"}, {"compatibility": "DECIMAL(3,2)"},
              {"detection_reduction": "DECIMAL(3,2)"}, {"active": "BOOLEAN"}, {"activated_at":
              "TIMESTAMP"}, {"expires_at": "TIMESTAMP"}]}, {"name": "stealth_network_nodes",
              "description": "Сетевые узлы для стелса", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"node_id": "UUID FOREIGN KEY"}, {"node_type": "VARCHAR(100)"},
              {"hacked": "BOOLEAN"}, {"hack_timestamp": "TIMESTAMP"}, {"network_signature":
              "JSONB"}]}, {"name": "stealth_achievements", "description": "Достижения
              стелса", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID
              FOREIGN KEY"}, {"achievement_type": "VARCHAR(100)"}, {"quality_score":
              "DECIMAL(5,2)"}, {"criteria_met": "JSONB"}, {"unlocked_at": "TIMESTAMP"}]},
              {"name": "stealth_reputation_buffs", "description": "Репутационные бонусы
              стелса", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID
              FOREIGN KEY"}, {"mission_id": "UUID FOREIGN KEY"}, {"stealth_quality":
              "DECIMAL(5,2)"}, {"reputation_bonus": "DECIMAL(5,2)"}, {"applied_at":
              "TIMESTAMP"}]}, {"name": "stealth_threat_map", "description": "Карта
              угроз", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID
              FOREIGN KEY"}, {"zone_id": "UUID FOREIGN KEY"}, {"threat_positions":
              "JSONB"}, {"threat_levels": "JSONB"}, {"last_update": "TIMESTAMP"}]}]},
              "integrations": {"combat_hacking_service": "- Интеграция взлома сетевых
              узлов\n- Управление сетевыми подписями\n- Взлом камер и сенсоров\n"}}}'
        - column:
            name: metadata
            value: '{"id": "combat-stealth-architecture", "title": "Архитектура системы
              стелса", "document_type": "architecture", "category": "systems", "status":
              "draft", "version": "1.0.0", "last_updated": "2025-11-23T22:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "combat", "stealth", "detection", "disguise",
              "hacking"], "related_systems": ["gameplay-service", "combat-hacking-service",
              "quest-service", "social-service"], "related_documents": [{"id": "combat-stealth",
              "relation": "implements"}, {"id": "analysis-combat-stealth-brief", "relation":
              "extends"}], "github_issue": 162, "visibility": "internal", "audience":
              ["architect", "backend", "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\combat-stealth-architecture.yaml
