databaseChangeLog:
- changeSet:
    id: documentation-corporation-system-architecture-671fd5e1
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '3533734462359414'
        - column:
            name: doc_id
            value: corporation-system-architecture
        - column:
            name: title
            value: Архитектура системы корпораций
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-29 12:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - corporation
            - social
            - economy
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - social-service-go
            - economy-service-go
        - column:
            name: related_documents
            value: '[{"id": "cooperation-hierarchy-system-architecture", "relation":
              "extends"}, {"id": "guild-system-architecture", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - social
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "corporation-system-architecture", "title":
              "Архитектура системы корпораций", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-29T12:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "corporation", "social", "economy"], "related_systems":
              ["social-service-go", "economy-service-go"], "related_documents": [{"id":
              "cooperation-hierarchy-system-architecture", "relation": "extends"},
              {"id": "guild-system-architecture", "relation": "extends"}], "github_issue":
              1435, "visibility": "internal", "audience": ["architect", "backend",
              "social", "api-designer"]}, "summary": {"problem": "Требуется спроектировать
              архитектуру системы корпораций - официально\nзарегистрированных кланов
              с минимум одной официальной деятельностью,\nиерархией должностей, зарплатами
              и должностными обязательствами.\n", "goal": "Создать архитектурную схему
              системы корпораций с определением:\n- Микросервисов для управления корпорациями\n-
              Компонентов для иерархии должностей\n- Системы зарплат\n- Должностных
              обязательств\n- API endpoints (высокоуровнево)\n- Структуры БД\n- Технического
              задания для реализации\n", "essence": "Система корпораций с поддержкой
              официальной регистрации, иерархии должностей,\nзарплат и должностных
              обязательств.\n"}, "architecture": {"overview": "Система корпораций
              состоит из следующих компонентов:\n1. Corporation Service - управление
              корпорациями\n2. Corporation Registration Service - регистрация корпораций\n3.
              Corporation Hierarchy Manager - управление иерархией должностей\n4.
              Corporation Salary Manager - управление зарплатами\n5. Corporation Duty
              Manager - управление должностными обязательствами\n6. Corporation Activity
              Manager - управление официальной деятельностью\n", "microservices":
              [{"name": "corporation-service", "location": "social-service-go (модуль
              corporation)", "port": 8084, "responsibility": "Управление корпорациями:\n-
              CRUD операции с корпорациями\n- Управление информацией о корпорации\n-
              Управление статусом корпорации\n", "endpoints": ["POST /api/v1/social/corporations
              - создание корпорации", "GET /api/v1/social/corporations/{corporationId}
              - информация о корпорации", "PUT /api/v1/social/corporations/{corporationId}
              - обновление корпорации", "DELETE /api/v1/social/corporations/{corporationId}
              - удаление корпорации"]}, {"name": "corporation-registration-service",
              "location": "social-service-go (модуль corporation-registration)", "port":
              8084, "responsibility": "Регистрация корпораций:\n- Регистрация корпорации\n-
              Валидация требований для регистрации\n- Управление регистрационными
              данными\n", "endpoints": ["POST /api/v1/social/corporations/register
              - регистрация корпорации", "GET /api/v1/social/corporations/{corporationId}/registration
              - регистрационные данные", "POST /api/v1/social/corporations/{corporationId}/registration/update
              - обновление регистрации"]}, {"name": "corporation-hierarchy-manager",
              "location": "social-service-go (модуль corporation-hierarchy)", "port":
              8084, "responsibility": "Управление иерархией должностей:\n- Создание
              должностей\n- Управление иерархией должностей\n- Назначение должностей\n-
              Управление правами должностей\n", "endpoints": ["POST /api/v1/social/corporations/{corporationId}/positions
              - создание должности", "GET /api/v1/social/corporations/{corporationId}/positions
              - список должностей", "POST /api/v1/social/corporations/{corporationId}/positions/{positionId}/assign
              - назначение должности", "DELETE /api/v1/social/corporations/{corporationId}/positions/{positionId}
              - удаление должности"]}, {"name": "corporation-salary-manager", "location":
              "economy-service-go (модуль corporation-salary)", "port": 8085, "responsibility":
              "Управление зарплатами:\n- Настройка зарплат для должностей\n- Выплата
              зарплат\n- Управление зарплатным фондом\n- Интеграция с экономикой\n",
              "endpoints": ["POST /api/v1/economy/corporations/{corporationId}/salaries
              - настройка зарплат", "POST /api/v1/economy/corporations/{corporationId}/salaries/pay
              - выплата зарплат", "GET /api/v1/economy/corporations/{corporationId}/salaries/fund
              - зарплатный фонд"]}, {"name": "corporation-duty-manager", "location":
              "social-service-go (модуль corporation-duty)", "port": 8084, "responsibility":
              "Управление должностными обязательствами:\n- Определение должностных
              обязательств\n- Назначение обязательств\n- Отслеживание выполнения обязательств\n",
              "endpoints": ["POST /api/v1/social/corporations/{corporationId}/duties
              - создание обязательства", "GET /api/v1/social/corporations/{corporationId}/duties
              - список обязательств", "POST /api/v1/social/corporations/{corporationId}/duties/{dutyId}/assign
              - назначение обязательства", "POST /api/v1/social/corporations/{corporationId}/duties/{dutyId}/complete
              - выполнение обязательства"]}, {"name": "corporation-activity-manager",
              "location": "social-service-go (модуль corporation-activity)", "port":
              8084, "responsibility": "Управление официальной деятельностью:\n- Регистрация
              официальной деятельности\n- Управление деятельностью\n- Отчетность по
              деятельности\n", "endpoints": ["POST /api/v1/social/corporations/{corporationId}/activities
              - регистрация деятельности", "GET /api/v1/social/corporations/{corporationId}/activities
              - список деятельности", "POST /api/v1/social/corporations/{corporationId}/activities/{activityId}/report
              - отчет по деятельности"]}], "integrations": {"economy_service": "-
              Управление зарплатами\n- Экономические транзакции\n- Управление ресурсами\n-
              Интеграция с системой валют\n", "guild_service": "- Использование системы
              кланов\n- Интеграция с гильдиями\n- Преобразование клана в корпорацию\n",
              "world_service": "- Интеграция с миром игры\n- Управление территориями\n-
              Влияние на экономику мира\n", "character_service": "- Данные сотрудников\n-
              Статистика сотрудников\n- Вклад в корпорацию\n", "realtime_gateway":
              "- Realtime синхронизация состояния корпорации\n- Push уведомления о
              событиях\n- Синхронизация сотрудников\n"}, "database": {"tables": [{"name":
              "corporations", "description": "Корпорации", "columns": [{"id": "UUID
              PRIMARY KEY"}, {"guild_id": "UUID REFERENCES guilds(id)"}, {"name":
              "VARCHAR(255) UNIQUE"}, {"registration_number": "VARCHAR(50) UNIQUE"},
              {"status": "VARCHAR(20) (PENDING, ACTIVE, SUSPENDED, DISBANDED)"}, {"official_activity":
              "VARCHAR(100)"}, {"capital": "DECIMAL(20, 4)"}, {"registered_at": "TIMESTAMP"},
              {"created_at": "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}]}, {"name":
              "corporation_positions", "description": "Должности в корпорациях", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"corporation_id": "UUID REFERENCES corporations(id)"},
              {"name": "VARCHAR(100)"}, {"position_type": "VARCHAR(50) (CEO, COO,
              CFO, CTO, MANAGER, SPECIALIST, INTERN)"}, {"hierarchy_level": "INTEGER"},
              {"parent_position_id": "UUID REFERENCES corporation_positions(id) NULL"},
              {"salary_type": "VARCHAR(20) (FIXED, PERCENTAGE, BONUS)"}, {"salary_amount":
              "DECIMAL(20, 4)"}, {"permissions": "JSONB"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "corporation_employees", "description":
              "Сотрудники корпораций", "columns": [{"id": "UUID PRIMARY KEY"}, {"corporation_id":
              "UUID REFERENCES corporations(id)"}, {"account_id": "UUID"}, {"position_id":
              "UUID REFERENCES corporation_positions(id)"}, {"hired_at": "TIMESTAMP"},
              {"last_active_at": "TIMESTAMP"}, {"performance_score": "DECIMAL(5, 2)"},
              {"total_salary_paid": "DECIMAL(20, 4)"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "corporation_duties", "description":
              "Должностные обязательства", "columns": [{"id": "UUID PRIMARY KEY"},
              {"corporation_id": "UUID REFERENCES corporations(id)"}, {"position_id":
              "UUID REFERENCES corporation_positions(id)"}, {"title": "VARCHAR(255)"},
              {"description": "TEXT"}, {"requirements": "JSONB"}, {"completion_criteria":
              "JSONB"}, {"status": "VARCHAR(20) (ACTIVE, COMPLETED, CANCELLED)"},
              {"assigned_to": "UUID REFERENCES corporation_employees(id) NULL"}, {"assigned_at":
              "TIMESTAMP NULL"}, {"completed_at": "TIMESTAMP NULL"}, {"created_at":
              "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}]}, {"name": "corporation_activities",
              "description": "Официальная деятельность корпораций", "columns": [{"id":
              "UUID PRIMARY KEY"}, {"corporation_id": "UUID REFERENCES corporations(id)"},
              {"activity_type": "VARCHAR(50) (PRODUCTION, TRADING, SERVICES, RESEARCH,
              SECURITY, TRANSPORT)"}, {"description": "TEXT"}, {"status": "VARCHAR(20)
              (ACTIVE, SUSPENDED, TERMINATED)"}, {"registered_at": "TIMESTAMP"}, {"created_at":
              "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}]}, {"name": "corporation_salary_payments",
              "description": "Выплаты зарплат", "columns": [{"id": "UUID PRIMARY KEY"},
              {"corporation_id": "UUID REFERENCES corporations(id)"}, {"employee_id":
              "UUID REFERENCES corporation_employees(id)"}, {"amount": "DECIMAL(20,
              4)"}, {"currency_type": "VARCHAR(50)"}, {"payment_type": "VARCHAR(20)
              (SALARY, BONUS, PREMIUM)"}, {"tax_amount": "DECIMAL(20, 4)"}, {"net_amount":
              "DECIMAL(20, 4)"}, {"paid_at": "TIMESTAMP"}, {"created_at": "TIMESTAMP"}]},
              {"name": "corporation_reports", "description": "Отчетность корпораций",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"corporation_id": "UUID REFERENCES
              corporations(id)"}, {"report_type": "VARCHAR(50) (FINANCIAL, ACTIVITY,
              PERFORMANCE)"}, {"period_start": "DATE"}, {"period_end": "DATE"}, {"data":
              "JSONB"}, {"created_at": "TIMESTAMP"}]}]}, "event_bus": {"topics": [{"name":
              "social.corporation.created", "description": "Создана корпорация", "schema":
              {"corporation_id": "UUID", "guild_id": "UUID", "name": "string", "registration_number":
              "string"}}, {"name": "social.corporation.registered", "description":
              "Корпорация зарегистрирована", "schema": {"corporation_id": "UUID",
              "registration_number": "string", "official_activity": "string"}}, {"name":
              "social.corporation.position.created", "description": "Создана должность",
              "schema": {"corporation_id": "UUID", "position_id": "UUID", "name":
              "string", "position_type": "string"}}, {"name": "social.corporation.employee.hired",
              "description": "Нанят сотрудник", "schema": {"corporation_id": "UUID",
              "employee_id": "UUID", "account_id": "UUID", "position_id": "UUID"}},
              {"name": "social.corporation.salary.paid", "description": "Выплачена
              зарплата", "schema": {"corporation_id": "UUID", "employee_id": "UUID",
              "amount": "number", "currency_type": "string"}}, {"name": "social.corporation.duty.completed",
              "description": "Выполнено обязательство", "schema": {"corporation_id":
              "UUID", "duty_id": "UUID", "employee_id": "UUID"}}]}, "websocket": {"channels":
              [{"name": "corporation.{corporation_id}.updates", "description": "Realtime
              обновления корпорации"}, {"name": "corporation.{corporation_id}.employees",
              "description": "Realtime обновления сотрудников"}, {"name": "corporation.{corporation_id}.salaries",
              "description": "Realtime обновления зарплат"}]}, "tickrate_and_network_requirements":
              {"corporation_management": {"tickrate": "Event-based (on-demand)", "network_load":
              "- Создание корпорации: event-based, ~0.01-0.05 events/sec\n- Регистрация
              корпорации: event-based, ~0.01-0.05 events/sec\n- Обновление корпорации:
              event-based, ~0.05-0.1 events/sec\n- Общий трафик: ~0.1-0.3 KB/sec на
              корпорацию\n", "sync_strategy": "Strong Consistency"}, "hierarchy_management":
              {"tickrate": "Event-based (on-demand)", "network_load": "- Создание
              должности: event-based, ~0.01-0.05 events/sec\n- Назначение должности:
              event-based, ~0.05-0.1 events/sec\n- Обновление иерархии: event-based,
              ~0.05-0.1 events/sec\n- Общий трафик: ~0.1-0.2 KB/sec на корпорацию\n",
              "sync_strategy": "Strong Consistency"}, "salary_management": {"tickrate":
              "Event-based (on-demand) + 1 Hz (автоматические выплаты)", "network_load":
              "- Настройка зарплат: event-based, ~0.01-0.05 events/sec\n- Выплата
              зарплат: event-based, ~0.1-0.5 events/sec (при выплате)\n- Автоматические
              выплаты: 1 update/sec (периодические)\n- Общий трафик: ~0.2-0.5 KB/sec
              на корпорацию\n", "sync_strategy": "Strong Consistency (ACID транзакции)"},
              "duty_management": {"tickrate": "Event-based (on-demand)", "network_load":
              "- Создание обязательства: event-based, ~0.05-0.1 events/sec\n- Выполнение
              обязательства: event-based, ~0.1-0.3 events/sec\n- Общий трафик: ~0.1-0.2
              KB/sec на корпорацию\n", "sync_strategy": "Strong Consistency"}, "activity_management":
              {"tickrate": "Event-based (on-demand)", "network_load": "- Регистрация
              деятельности: event-based, ~0.01-0.05 events/sec\n- Отчетность: event-based,
              ~0.01-0.05 events/sec\n- Общий трафик: ~0.1-0.2 KB/sec на корпорацию\n",
              "sync_strategy": "Strong Consistency"}}, "technical_specification":
              {"subtasks": null, "phase_1": {"name": "Corporation Service Core", "tasks":
              ["Реализация Corporation Service", "CRUD операции с корпорациями"],
              "estimated_effort": "4 days"}, "phase_2": {"name": "Corporation Registration
              Service", "tasks": ["Реализация Corporation Registration Service", "Регистрация
              корпораций"], "estimated_effort": "3 days"}, "phase_3": {"name": "Corporation
              Hierarchy Manager", "tasks": ["Реализация Corporation Hierarchy Manager",
              "Управление иерархией должностей"], "estimated_effort": "4 days"}, "phase_4":
              {"name": "Corporation Salary Manager", "tasks": ["Реализация Corporation
              Salary Manager", "Управление зарплатами", "Интеграция с экономикой"],
              "estimated_effort": "4 days"}, "phase_5": {"name": "Corporation Duty
              Manager", "tasks": ["Реализация Corporation Duty Manager", "Управление
              должностными обязательствами"], "estimated_effort": "3 days"}, "phase_6":
              {"name": "Corporation Activity Manager", "tasks": ["Реализация Corporation
              Activity Manager", "Управление официальной деятельностью"], "estimated_effort":
              "3 days"}, "phase_7": {"name": "Интеграции", "tasks": ["Интеграция с
              Economy Service", "Интеграция с Guild Service", "Интеграция с World
              Service", "WebSocket каналы"], "estimated_effort": "2 days"}, "total_estimated_effort":
              "23 days"}}, "diagrams": {"component_diagram": "```mermaid\ngraph TB\n    Client[UE5
              Client] --> Gateway[API Gateway]\n\n    Gateway --> SocialService[Social
              Service<br/>8084]\n    Gateway --> EconomyService[Economy Service<br/>8085]\n\n    SocialService
              --> CS[Corporation Service]\n    SocialService --> CRS[Corporation Registration
              Service]\n    SocialService --> CHM[Corporation Hierarchy Manager]\n    SocialService
              --> CDM[Corporation Duty Manager]\n    SocialService --> CAM[Corporation
              Activity Manager]\n\n    EconomyService --> CSM[Corporation Salary Manager]\n\n    CS
              --> GuildService[Guild Service]\n    CS --> WorldService[World Service]\n    CSM
              --> EconomyService\n\n    SocialService --> EventBus[Event Bus<br/>Kafka]\n    EconomyService
              --> EventBus\n    EventBus --> RealtimeGateway[Realtime Gateway]\n\n    SocialService
              --> DB[(Social DB)]\n    EconomyService --> DB\n\n    Client --> WSCorp[WebSocket<br/>Corporation
              Updates]\n    WSCorp --> SocialService\n```\n", "corporation_registration_flow":
              "```mermaid\nsequenceDiagram\n    participant Client\n    participant
              SocialService\n    participant RegistrationService\n    participant
              GuildService\n    participant EconomyService\n    participant EventBus\n\n    Client->>SocialService:
              POST /corporations/register\n    SocialService->>RegistrationService:
              Validate requirements\n    RegistrationService->>GuildService: Check
              guild exists\n    RegistrationService->>EconomyService: Check capital\n    RegistrationService->>RegistrationService:
              Create registration\n    RegistrationService->>SocialService: Registration
              created\n    SocialService->>EventBus: Publish corporation.registered\n    SocialService->>Client:
              Registration successful\n```\n", "salary_payment_flow": "```mermaid\nsequenceDiagram\n    participant
              Scheduler\n    participant SalaryManager\n    participant EconomyService\n    participant
              Employee\n    participant EventBus\n\n    Scheduler->>SalaryManager:
              Payment time\n    SalaryManager->>SalaryManager: Calculate salaries\n    SalaryManager->>EconomyService:
              Transfer funds\n    EconomyService->>Employee: Credit salary\n    SalaryManager->>EventBus:
              Publish salary.paid\n    SalaryManager->>Scheduler: Payment completed\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "corporation-system-architecture", "title": "Архитектура
              системы корпораций", "document_type": "architecture", "category": "systems",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-29T12:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "corporation", "social", "economy"], "related_systems":
              ["social-service-go", "economy-service-go"], "related_documents": [{"id":
              "cooperation-hierarchy-system-architecture", "relation": "extends"},
              {"id": "guild-system-architecture", "relation": "extends"}], "github_issue":
              1435, "visibility": "internal", "audience": ["architect", "backend",
              "social", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\corporation-system-architecture.yaml
