databaseChangeLog:
- changeSet:
    id: documentation-cosmetic-technical-e715e78f
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-510548173197121'
        - column:
            name: doc_id
            value: cosmetic-technical
        - column:
            name: title
            value: Архитектура системы косметики - Техническое задание
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.1.0
        - column:
            name: last_updated
            value: 2025-11-30 20:50:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[]'
        - column:
            name: tags
            value: []
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value: []
        - column:
            name: related_documents
            value: '[{"id": "cosmetic-core", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: ''
        - column:
            name: audience
            value: []
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "cosmetic-technical", "title": "Архитектура
              системы косметики - Техническое задание", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.1.0", "last_updated":
              "2025-11-30T20:50:00+00:00", "github_issue": 315, "related_documents":
              [{"id": "cosmetic-core", "relation": "extends"}]}, "technical_specification":
              {"subtasks": [{"id": "cosmetic-manager", "title": "Реализация менеджера
              системы косметики", "description": "Реализация Cosmetic Manager с управлением
              системой косметики\nи интеграцией с другими компонентами.\n", "dependencies":
              [], "estimated_effort": "4 days"}, {"id": "cosmetic-catalog-manager",
              "title": "Реализация менеджера каталога косметики", "description": "Реализация
              Cosmetic Catalog Manager с управлением каталогом косметики,\nтипами
              и доступностью.\n", "dependencies": ["cosmetic-manager"], "estimated_effort":
              "3 days"}, {"id": "cosmetic-ownership-manager", "title": "Реализация
              менеджера владения косметикой", "description": "Реализация Cosmetic
              Ownership Manager с управлением владением косметикой,\nпроверкой владения
              и выдачей косметики.\n", "dependencies": ["cosmetic-manager"], "estimated_effort":
              "3 days"}, {"id": "cosmetic-shop-manager", "title": "Реализация менеджера
              магазина и ротации", "description": "Реализация Cosmetic Shop Manager
              с управлением магазином,\nротацией товаров и алгоритмом выбора.\n",
              "dependencies": ["cosmetic-manager"], "estimated_effort": "4 days"},
              {"id": "cosmetic-equip-manager", "title": "Реализация менеджера экипировки
              косметики", "description": "Реализация Cosmetic Equip Manager с управлением
              экипировкой косметики,\nслотами и применением косметики.\n", "dependencies":
              ["cosmetic-manager"], "estimated_effort": "4 days"}, {"id": "cosmetic-rarity-manager",
              "title": "Реализация менеджера редкостей", "description": "Реализация
              Cosmetic Rarity Manager с управлением редкостями,\nрасчетом вероятностей
              и визуальными эффектами.\n", "dependencies": ["cosmetic-manager"], "estimated_effort":
              "3 days"}, {"id": "cosmetic-purchase-manager", "title": "Реализация
              менеджера покупки косметики", "description": "Реализация Cosmetic Purchase
              Manager с управлением покупкой косметики,\nпроверкой ограничений и обработкой
              транзакций.\n", "dependencies": ["cosmetic-ownership-manager"], "estimated_effort":
              "4 days"}, {"id": "cosmetic-preview-manager", "title": "Реализация менеджера
              предпросмотра косметики", "description": "Реализация Cosmetic Preview
              Manager с управлением предпросмотром косметики,\n3D предпросмотром и
              сравнением.\n", "dependencies": ["cosmetic-manager"], "estimated_effort":
              "3 days"}, {"id": "cosmetic-analytics-collector", "title": "Реализация
              сборщика аналитики", "description": "Реализация Cosmetic Analytics Collector
              с логированием операций,\nсбором метрик и интеграцией с Analytics Service.\n",
              "dependencies": ["cosmetic-manager"], "estimated_effort": "3 days"},
              {"id": "cosmetic-telemetry-collector", "title": "Реализация сборщика
              телеметрии", "description": "Реализация Cosmetic Telemetry Collector
              с логированием событий,\nсбором телеметрии и интеграцией с Analytics
              Service.\n", "dependencies": ["cosmetic-manager"], "estimated_effort":
              "2 days"}, {"id": "websocket-channels", "title": "Реализация WebSocket
              каналов", "description": "Реализация WebSocket каналов для realtime
              обновлений косметики,\nэкипировки и уведомлений.\n", "dependencies":
              ["cosmetic-manager"], "estimated_effort": "3 days"}, {"id": "event-bus-integration",
              "title": "Интеграция с Event Bus", "description": "Реализация публикации
              и подписки на события через Kafka\nдля всех компонентов системы косметики.\n",
              "dependencies": ["cosmetic-manager"], "estimated_effort": "2 days"},
              {"id": "database-schema", "title": "Создание схемы БД", "description":
              "Создание таблиц БД для косметических предметов, владения,\nэкипировки,
              ротаций и телеметрии с миграциями Liquibase.\n", "dependencies": [],
              "estimated_effort": "3 days"}]}, "diagrams": {"component_diagram": "```mermaid\ngraph
              TB\n    Client[UE5 Client] --> Gateway[API Gateway]\n\n    Gateway -->
              CosmeticService[Cosmetic Service<br/>8092]\n\n    CosmeticService -->
              CM[Cosmetic Manager]\n    CosmeticService --> CCM[Cosmetic Catalog Manager]\n    CosmeticService
              --> COM[Cosmetic Ownership Manager]\n    CosmeticService --> CSM[Cosmetic
              Shop Manager]\n    CosmeticService --> CEM[Cosmetic Equip Manager]\n    CosmeticService
              --> CRM[Cosmetic Rarity Manager]\n    CosmeticService --> CPM[Cosmetic
              Purchase Manager]\n    CosmeticService --> CPvM[Cosmetic Preview Manager]\n    CosmeticService
              --> CAC[Cosmetic Analytics Collector]\n    CosmeticService --> CTC[Cosmetic
              Telemetry Collector]\n\n    CM --> CCM\n    CM --> COM\n    CM --> CSM\n    CM
              --> CEM\n    CM --> CRM\n    COM --> CPM\n    CM --> CPvM\n\n    CosmeticService
              --> InventoryService[Inventory Service]\n    CosmeticService --> EconomyService[Economy
              Service]\n    CosmeticService --> CharacterService[Character Service]\n    CosmeticService
              --> ShopService[Shop Service]\n    CosmeticService --> AnalyticsService[Analytics
              Service]\n    CosmeticService --> NotificationService[Notification Service]\n    CosmeticService
              --> AchievementService[Achievement Service]\n\n    CosmeticService -->
              EventBus[Event Bus<br/>Kafka]\n    EventBus --> RealtimeGateway[Realtime
              Gateway]\n\n    CosmeticService --> DB[(Cosmetic DB)]\n\n    Client
              --> WSCosmetic[WebSocket<br/>Cosmetic]\n    WSCosmetic --> CosmeticService\n```\n",
              "purchase_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              P as Player\n    participant CPM as Cosmetic Purchase Manager\n    participant
              ES as Economy Service\n    participant COM as Cosmetic Ownership Manager\n    participant
              EB as Event Bus\n\n    P->>CPM: Purchase cosmetic\n    CPM->>CPM: Check
              ownership\n    CPM->>CPM: Check availability\n    CPM->>ES: Check balance\n    ES->>ES:
              Deduct currency\n    CPM->>COM: Grant ownership\n    CPM->>EB: Publish
              cosmetic.purchased\n```\n", "equip_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              P as Player\n    participant CEM as Cosmetic Equip Manager\n    participant
              EB as Event Bus\n\n    P->>CEM: Equip cosmetic\n    CEM->>CEM: Check
              ownership\n    CEM->>CEM: Validate slot\n    CEM->>CEM: Unequip current
              (if any)\n    CEM->>CEM: Apply cosmetic\n    CEM->>EB: Publish cosmetic.equipped\n```\n"},
              "history": [{"version": "1.1.0", "date": "2025-11-30", "author": "Architect
              Agent", "changes": "Добавлена детальная синхронизация данных:\n- Event
              Sourcing для всех изменений состояния косметики\n- CQRS Pattern для
              разделения команд и запросов\n- Saga Pattern для распределенных операций
              (покупка косметики, экипировка, ротация магазина)\n- Outbox Pattern
              для гарантированной доставки событий\n- Обновлена секция data_consistency
              с механизмами синхронизации\n- Добавлена спецификация тикрейта для каталога,
              магазина, покупки, экипировки, предпросмотра, редкостей, статистики
              и обработки событий\n"}, {"version": "1.0.0", "date": "2025-11-23",
              "author": "Architect Agent", "changes": "Создана полная архитектура
              системы косметики:\n- Определены компоненты (Cosmetic Manager, Cosmetic
              Catalog Manager, Cosmetic Ownership Manager, Cosmetic Shop Manager,
              Cosmetic Equip Manager, Cosmetic Rarity Manager, Cosmetic Purchase Manager,
              Cosmetic Preview Manager)\n- Описаны API endpoints (высокоуровнево)\n-
              Спроектированы потоки данных\n- Определена структура БД (cosmetic_items,
              player_cosmetics, player_equipped_cosmetics, cosmetic_shop_rotations,
              cosmetic_telemetry)\n- Спроектирована система покупки косметики\n- Спроектирована
              система экипировки косметики\n- Спроектирована система магазина и ротации\n-
              Спроектирована система редкостей\n- Создано техническое задание\n- Разбито
              на подзадачи\n"}]}'
        - column:
            name: metadata
            value: '{"id": "cosmetic-technical", "title": "Архитектура системы косметики
              - Техническое задание", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.1.0", "last_updated": "2025-11-30T20:50:00+00:00",
              "github_issue": 315, "related_documents": [{"id": "cosmetic-core", "relation":
              "extends"}]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\cosmetic-technical.yaml
