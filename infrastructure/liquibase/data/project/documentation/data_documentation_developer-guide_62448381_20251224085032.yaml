databaseChangeLog:
- changeSet:
    id: documentation-developer-guide-62448381
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-622747656749566'
        - column:
            name: doc_id
            value: canon-narrative-developer-guide
        - column:
            name: title
            value: 'Developer Guide: Narrative System'
        - column:
            name: document_type
            value: canon
        - column:
            name: category
            value: narrative-coherence
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-13 00:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - narrative
            - developer-guide
            - quest-graph
        - column:
            name: topics
            value:
            - system-architecture
            - world-state
        - column:
            name: related_systems
            value:
            - narrative-service
            - world-state-service
            - dynamic-content-service
        - column:
            name: related_documents
            value: '[{"id": "canon-backend-integration-part1-entities", "relation":
              "references"}, {"id": "canon-backend-integration-part2-services", "relation":
              "references"}, {"id": "canon-backend-integration-part3-api", "relation":
              "references"}]'
        - column:
            name: source
            value: shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/developer-guide.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - narrative
            - backend
            - data
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "canon-narrative-developer-guide", "title":
              "Developer Guide: Narrative System", "document_type": "canon", "category":
              "narrative-coherence", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-13T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at":
              "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}],
              "tags": ["narrative", "developer-guide", "quest-graph"], "topics": ["system-architecture",
              "world-state"], "related_systems": ["narrative-service", "world-state-service",
              "dynamic-content-service"], "related_documents": [{"id": "canon-backend-integration-part1-entities",
              "relation": "references"}, {"id": "canon-backend-integration-part2-services",
              "relation": "references"}, {"id": "canon-backend-integration-part3-api",
              "relation": "references"}], "source": "shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/developer-guide.md",
              "visibility": "internal", "audience": ["concept", "narrative", "backend",
              "data"], "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions":
              []}, "summary": {"problem": "Команде требовалось единое руководство
              по использованию сюжетного графа, состоянию мира и динамическому контенту.",
              "goal": "Зафиксировать архитектуру, сценарии использования и практики
              тестирования narrative системы.", "essence": "Документ объясняет как
              проверять доступность квестов, управлять состоянием мира и генерировать
              динамические задания.", "key_points": ["Квестовый граф объединяет зависимости,
              флаги и блокировки для выдачи контента.", "Состояние мира агрегируется
              из персональных, серверных и фракционных слоёв.", "Система динамических
              квестов использует вероятностные модификаторы на основе world state.",
              "Performance раздел описывает кэширование и индексацию критичных запросов."]},
              "content": {"sections": [{"id": "architecture", "title": "Архитектура
              и компоненты", "body": "Система состоит из графа квестов, слоя состояния
              мира, триггеров событий и генератора динамического контента. Quest Graph
              насчитывает сотни узлов и связей, отражая зависимости между сюжетными
              линиями. World State разделён на personal, server и faction уровни,
              что позволяет строить локализованные последствия. Event Triggers управляют
              запуском новых веток, а Dynamic Content создаёт задания в ответ на изменения.\n",
              "mechanics_links": [], "assets": []}, {"id": "quest-availability", "title":
              "Проверка доступности квестов", "body": "Алгоритм проверяет выполнение
              зависимых квестов, наличие обязательных флагов, отсутствие блокировок
              и соответствие уровня персонажа. При успешном прохождении всех проверок
              квест считается доступным. Логика позволяет расширять проверки без изменения
              интерфейса методов.\n\nОбработка выбора применяет репутационные изменения,
              управляет флагами и обновляет набор доступных квестов. Последствия фиксируются
              в аудите, чтобы восстановить состояние при необходимости.\n", "mechanics_links":
              [], "assets": []}, {"id": "world-state", "title": "Управление состоянием
              мира", "body": "World State комбинирует персональные, серверные и фракционные
              данные с учётом приоритетов. Голосование позволяет игрокам влиять на
              состояние серверного слоя. При достижении порога система применяет изменения
              и триггерит последствия, включая запуск событий и обновление NPC.\n\nПодсистема
              голосования использует веса на основе репутации и поддерживает расширение
              новыми правилами валидации.\n", "mechanics_links": [], "assets": []},
              {"id": "dynamic-content", "title": "Динамический контент", "body": "Генерация
              квестов использует пул шаблонов, где вероятность каждого шаблона модифицируется
              текущим состоянием мира. После выбора шаблона создаётся экземпляр квеста,
              адаптированный под контекст персонажа и сервера. Метод применяет ограничение
              диапазона вероятностей, что предотвращает появление некорректных значений.\n",
              "mechanics_links": [], "assets": []}, {"id": "performance", "title":
              "Производительность и тестирование", "body": "Кэширование quest graph
              в Redis с часовой валидностью и хранение серверного состояния с коротким
              TTL уменьшают нагрузку на базу данных. Индексы на player_flags, server_world_state
              и quest_branches ускоряют проверки. Тестовые сценарии включают проверку
              доступности при выполненных зависимостях и обработку взаимного исключения
              после сюжетных развилок.\n\nРекомендуется поддерживать набор юнит-тестов,
              покрывающих ключевые выборы и квоты голосования, чтобы гарантировать
              корректность при наполнении контентом.\n", "mechanics_links": [], "assets":
              []}]}, "appendix": {"glossary": [], "references": [], "decisions": []},
              "implementation": {"github_issue": 109, "needs_task": false, "queue_reference":
              [], "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-11-07",
              "author": "narrative_platform_team", "changes": "Обобщено руководство
              по narrative системе и практикам её использования."}], "validation":
              {"checksum": "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "canon-narrative-developer-guide", "title": "Developer
              Guide: Narrative System", "document_type": "canon", "category": "narrative-coherence",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-13T00:00:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["narrative",
              "developer-guide", "quest-graph"], "topics": ["system-architecture",
              "world-state"], "related_systems": ["narrative-service", "world-state-service",
              "dynamic-content-service"], "related_documents": [{"id": "canon-backend-integration-part1-entities",
              "relation": "references"}, {"id": "canon-backend-integration-part2-services",
              "relation": "references"}, {"id": "canon-backend-integration-part3-api",
              "relation": "references"}], "source": "shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/developer-guide.md",
              "visibility": "internal", "audience": ["concept", "narrative", "backend",
              "data"], "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\canon\narrative\narrative-coherence\phase6-documentation\dev-guides\developer-guide.yaml
