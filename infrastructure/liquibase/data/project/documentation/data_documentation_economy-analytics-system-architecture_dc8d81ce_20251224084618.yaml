databaseChangeLog:
- changeSet:
    id: documentation-economy-analytics-system-architecture-dc8d81ce
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-482697310059933'
        - column:
            name: doc_id
            value: economy-analytics-system-architecture
        - column:
            name: title
            value: Архитектура системы экономической аналитики
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 16:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - economy
            - analytics
            - charts
            - market-intelligence
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - economy-service
            - analytics-service
            - stock-exchange-service
        - column:
            name: related_documents
            value: '[{"id": "economy-analytics", "relation": "extends"}, {"id": "game-mechanics-systems-architecture",
              "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - economy
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "economy-analytics-system-architecture", "title":
              "Архитектура системы экономической аналитики", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-23T16:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "economy", "analytics",
              "charts", "market-intelligence"], "related_systems": ["economy-service",
              "analytics-service", "stock-exchange-service"], "related_documents":
              [{"id": "economy-analytics", "relation": "extends"}, {"id": "game-mechanics-systems-architecture",
              "relation": "extends"}], "github_issue": 216, "visibility": "internal",
              "audience": ["architect", "backend", "economy", "api-designer"]}, "summary":
              {"problem": "Требуется спроектировать архитектуру системы экономической
              аналитики для предоставления игрокам\nинструментов визуализации и отслеживания
              трендов: графики цен, технические индикаторы, анализ настроений,\nпортфельная
              аналитика и оповещения.\n", "goal": "Создать архитектурную схему системы
              экономической аналитики с определением:\n- Микросервисов для управления
              аналитикой\n- Компонентов для графиков, индикаторов, анализа настроений,
              портфельной аналитики\n- API endpoints (высокоуровнево)\n- Интеграций
              с другими экономическими системами\n- Структуры БД для хранения аналитических
              данных\n- Технического задания для реализации\n", "essence": "Система
              экономической аналитики предоставляет профессиональные графики, технические
              индикаторы,\nанализ настроений рынка, портфельную аналитику и систему
              оповещений для принятия торговых решений.\n"}, "architecture": {"overview":
              "Система экономической аналитики состоит из следующих компонентов:\n1.
              Analytics Data Collector - сбор данных для аналитики\n2. Chart Data
              Manager - управление данными для графиков\n3. Technical Indicators Calculator
              - расчёт технических индикаторов\n4. Sentiment Analyzer - анализ настроений
              рынка\n5. Portfolio Analytics Manager - аналитика портфеля\n6. Alert
              Manager - управление оповещениями\n7. Analytics Cache Manager - кэширование
              аналитических данных\n8. Analytics API Gateway - API для доступа к аналитике\n",
              "microservices": [{"name": "analytics-service", "location": "services/analytics-service",
              "responsibility": "Основной сервис для экономической аналитики:\n- Сбор
              данных для аналитики\n- Расчёт технических индикаторов\n- Анализ настроений\n-
              Портфельная аналитика\n- Управление оповещениями\n", "components": ["Analytics
              Data Collector", "Chart Data Manager", "Technical Indicators Calculator",
              "Sentiment Analyzer", "Portfolio Analytics Manager", "Alert Manager",
              "Analytics Cache Manager"], "endpoints": ["GET /api/v1/analytics/chart/{symbol}
              - данные для графика", "GET /api/v1/analytics/chart/{symbol}/history
              - история цен", "GET /api/v1/analytics/indicators/{symbol} - технические
              индикаторы", "GET /api/v1/analytics/sentiment/{symbol} - анализ настроений",
              "GET /api/v1/analytics/portfolio/{player_id} - аналитика портфеля",
              "GET /api/v1/analytics/portfolio/{player_id}/history - история портфеля",
              "GET /api/v1/analytics/portfolio/{player_id}/metrics - метрики портфеля",
              "GET /api/v1/analytics/heatmap - тепловая карта рынка", "GET /api/v1/analytics/alerts
              - список оповещений игрока", "POST /api/v1/analytics/alerts - создание
              оповещения", "PUT /api/v1/analytics/alerts/{id} - обновление оповещения",
              "DELETE /api/v1/analytics/alerts/{id} - удаление оповещения", "WS /ws/analytics/chart/{symbol}
              - WebSocket для потоковых данных графика", "WS /ws/analytics/alerts
              - WebSocket для оповещений"]}, {"name": "economy-service", "location":
              "services/economy-service", "responsibility": "Интеграция с экономическими
              данными:\n- Предоставление данных о ценах\n- Предоставление данных о
              транзакциях\n- Интеграция с экономическими событиями\n", "components":
              ["Economy Data Provider"], "endpoints": ["GET /api/v1/economy/prices/{symbol}
              - текущие цены", "GET /api/v1/economy/prices/{symbol}/history - история
              цен"]}, {"name": "stock-exchange-service", "location": "services/stock-exchange-service",
              "responsibility": "Интеграция с биржей:\n- Предоставление данных об
              акциях\n- Предоставление данных о сделках\n- Интеграция с биржевыми
              событиями\n", "components": ["Stock Exchange Data Provider"], "endpoints":
              ["GET /api/v1/stock-exchange/stocks/{id}/prices - цены акций", "GET
              /api/v1/stock-exchange/stocks/{id}/trades - сделки"]}], "components":
              [{"name": "Analytics Data Collector", "location": "analytics-service",
              "responsibility": "Сбор данных для аналитики:\n- Сбор данных о ценах
              из economy-service и stock-exchange-service\n- Сбор данных о транзакциях\n-
              Сбор данных о событиях\n- Хранение исторических данных\n", "methods":
              ["collectPriceData(symbol, timeRange)", "collectTransactionData(playerId,
              timeRange)", "collectEventData(timeRange)", "storeHistoricalData(data)"]},
              {"name": "Chart Data Manager", "location": "analytics-service", "responsibility":
              "Управление данными для графиков:\n- Подготовка данных для различных
              типов графиков (линейные, свечные, OHLC, area, гистограммы)\n- Агрегация
              данных по таймфреймам\n- Кэширование данных графиков\n", "methods":
              ["getChartData(symbol, chartType, timeFrame, timeRange)", "aggregateData(data,
              timeFrame)", "formatCandlestickData(data)", "formatOHLCData(data)"]},
              {"name": "Technical Indicators Calculator", "location": "analytics-service",
              "responsibility": "Расчёт технических индикаторов:\n- MA (Moving Average)\n-
              RSI (Relative Strength Index)\n- MACD (Moving Average Convergence Divergence)\n-
              Bollinger Bands\n- Другие индикаторы\n", "methods": ["calculateMA(data,
              period)", "calculateRSI(data, period)", "calculateMACD(data, fastPeriod,
              slowPeriod, signalPeriod)", "calculateBollingerBands(data, period, stdDev)",
              "calculateIndicator(symbol, indicatorType, parameters)"]}, {"name":
              "Sentiment Analyzer", "location": "analytics-service", "responsibility":
              "Анализ настроений рынка:\n- Расчёт баланса бычьих и медвежьих сигналов\n-
              Индекс страха и жадности\n- Тепловые карты по секторам\n- Анализ настроений
              портфеля\n", "methods": ["analyzeSentiment(symbol, timeRange)", "calculateFearGreedIndex(timeRange)",
              "generateHeatmap(sector, timeRange)", "analyzePortfolioSentiment(playerId)"]},
              {"name": "Portfolio Analytics Manager", "location": "analytics-service",
              "responsibility": "Аналитика портфеля:\n- Расчёт доходности (total return)\n-
              Расчёт риска (Sharpe ratio)\n- Win rate и profit factor\n- История сделок\n-
              Динамика прибыли и убытков\n", "methods": ["calculateTotalReturn(playerId,
              timeRange)", "calculateSharpeRatio(playerId, timeRange)", "calculateWinRate(playerId,
              timeRange)", "calculateProfitFactor(playerId, timeRange)", "getTradeHistory(playerId,
              timeRange)", "getProfitLossChart(playerId, timeRange)"]}, {"name": "Alert
              Manager", "location": "analytics-service", "responsibility": "Управление
              оповещениями:\n- Создание ценовых оповещений\n- Создание событийных
              оповещений\n- Проверка условий оповещений\n- Отправка уведомлений\n",
              "methods": ["createPriceAlert(playerId, symbol, condition, targetPrice)",
              "createEventAlert(playerId, eventType, condition)", "checkAlerts(symbol,
              currentPrice)", "sendAlert(alertId, notification)"]}, {"name": "Analytics
              Cache Manager", "location": "analytics-service", "responsibility": "Кэширование
              аналитических данных:\n- Кэширование данных графиков\n- Кэширование
              индикаторов\n- Кэширование портфельной аналитики\n- Инвалидация кэша\n",
              "methods": ["cacheChartData(symbol, chartType, timeFrame, data)", "getCachedChartData(symbol,
              chartType, timeFrame)", "cacheIndicator(symbol, indicatorType, data)",
              "invalidateCache(symbol, dataType)"]}, {"name": "Analytics API Gateway",
              "location": "analytics-service", "responsibility": "API Gateway для
              аналитики:\n- Маршрутизация запросов\n- Агрегация данных из разных источников\n-
              Форматирование ответов\n- WebSocket для потоковых данных\n", "methods":
              ["routeRequest(endpoint, parameters)", "aggregateData(sources)", "formatResponse(data,
              format)", "streamChartData(symbol, clientId)"]}], "data_flow": {"chart_data_request":
              "1. Клиент запрашивает данные для графика через Analytics API Gateway\n2.
              Analytics Cache Manager проверяет кэш\n3. Если данных нет в кэше: Analytics
              Data Collector собирает данные из economy-service/stock-exchange-service\n4.
              Chart Data Manager форматирует данные для типа графика\n5. Данные кэшируются\n6.
              Данные возвращаются клиенту\n", "indicator_calculation": "1. Клиент
              запрашивает технический индикатор\n2. Analytics Cache Manager проверяет
              кэш\n3. Если данных нет: Analytics Data Collector собирает исторические
              данные\n4. Technical Indicators Calculator рассчитывает индикатор\n5.
              Результат кэшируется\n6. Результат возвращается клиенту\n", "sentiment_analysis":
              "1. Клиент запрашивает анализ настроений\n2. Sentiment Analyzer собирает
              данные о сигналах и событиях\n3. Рассчитывается баланс бычьих/медвежьих
              сигналов\n4. Рассчитывается индекс страха и жадности\n5. Генерируется
              тепловая карта (если требуется)\n6. Результат возвращается клиенту\n",
              "portfolio_analytics": "1. Клиент запрашивает аналитику портфеля\n2.
              Portfolio Analytics Manager получает данные о позициях игрока\n3. Собираются
              данные о транзакциях и сделках\n4. Рассчитываются метрики (total return,
              Sharpe ratio, win rate, profit factor)\n5. Формируется история сделок\n6.
              Генерируется график прибыли/убытков\n7. Результат возвращается клиенту\n",
              "alert_processing": "1. Alert Manager периодически проверяет условия
              оповещений\n2. Для ценовых оповещений: проверяется текущая цена символа\n3.
              Для событийных оповещений: проверяются активные события\n4. При выполнении
              условия: отправляется уведомление через notification-service\n5. WebSocket
              отправляет оповещение клиенту в реальном времени\n"}, "integrations":
              {"with_economy_service": "- Получение данных о ценах\n- Получение данных
              о транзакциях\n- Интеграция с экономическими событиями\n", "with_stock_exchange_service":
              "- Получение данных об акциях\n- Получение данных о сделках\n- Интеграция
              с биржевыми событиями\n", "with_investment_service": "- Получение данных
              о портфеле игрока\n- Получение данных о позициях\n- Получение данных
              о сделках\n", "with_notification_service": "- Отправка оповещений\n-
              Push-уведомления\n- Email-уведомления\n", "with_event_bus": "- Подписка
              на события цен\n- Подписка на экономические события\n- Публикация аналитических
              событий\n"}, "event_bus_events": {"published": ["analytics.chart.data.updated",
              "analytics.indicator.calculated", "analytics.sentiment.updated", "analytics.portfolio.updated",
              "analytics.alert.triggered"], "subscribed": ["economy.price.updated
              (для обновления графиков)", "stock-exchange.price.updated (для обновления
              графиков)", "economy.event.active (для событийных оповещений)", "investment.position.updated
              (для портфельной аналитики)"]}, "database_schema": {"tables": [{"name":
              "analytics_chart_data", "description": "Данные для графиков", "fields":
              [{"id": "UUID (PK)"}, {"symbol": "VARCHAR(50)"}, {"chart_type": "ENUM
              (line, candlestick, ohlc, area, volume)"}, {"time_frame": "VARCHAR(20)
              (1m, 5m, 15m, 1h, 4h, 1d, 1w)"}, {"timestamp": "TIMESTAMP"}, {"open":
              "DECIMAL(20,8) (nullable)"}, {"high": "DECIMAL(20,8) (nullable)"}, {"low":
              "DECIMAL(20,8) (nullable)"}, {"close": "DECIMAL(20,8)"}, {"volume":
              "DECIMAL(20,2) (nullable)"}, {"data": "JSONB (дополнительные данные)"}],
              "indexes": ["symbol, chart_type, time_frame, timestamp", "timestamp"]},
              {"name": "analytics_indicators", "description": "Технические индикаторы",
              "fields": [{"id": "UUID (PK)"}, {"symbol": "VARCHAR(50)"}, {"indicator_type":
              "VARCHAR(50) (MA, RSI, MACD, BollingerBands, etc.)"}, {"parameters":
              "JSONB (параметры индикатора)"}, {"timestamp": "TIMESTAMP"}, {"value":
              "DECIMAL(20,8)"}, {"signal": "ENUM (buy, sell, neutral, nullable)"}],
              "indexes": ["symbol, indicator_type, timestamp", "timestamp"]}, {"name":
              "analytics_sentiment", "description": "Анализ настроений", "fields":
              [{"id": "UUID (PK)"}, {"symbol": "VARCHAR(50) (nullable, для общего
              рынка может быть NULL)"}, {"timestamp": "TIMESTAMP"}, {"bullish_signals":
              "INTEGER"}, {"bearish_signals": "INTEGER"}, {"fear_greed_index": "DECIMAL(5,2)
              (0.00-100.00)"}, {"sentiment_score": "DECIMAL(5,2) (-100.00 to 100.00)"}],
              "indexes": ["symbol, timestamp", "timestamp"]}, {"name": "analytics_portfolio_snapshots",
              "description": "Снимки портфеля для аналитики", "fields": [{"id": "UUID
              (PK)"}, {"player_id": "UUID (FK accounts)"}, {"timestamp": "TIMESTAMP"},
              {"total_value": "DECIMAL(10,2)"}, {"total_cost": "DECIMAL(10,2)"}, {"total_return":
              "DECIMAL(10,2)"}, {"total_return_percentage": "DECIMAL(5,2)"}, {"sharpe_ratio":
              "DECIMAL(5,2) (nullable)"}, {"win_rate": "DECIMAL(5,2) (nullable)"},
              {"profit_factor": "DECIMAL(5,2) (nullable)"}], "indexes": ["player_id,
              timestamp", "timestamp"]}, {"name": "analytics_alerts", "description":
              "Оповещения игроков", "fields": [{"id": "UUID (PK)"}, {"player_id":
              "UUID (FK accounts)"}, {"alert_type": "ENUM (price, event)"}, {"symbol":
              "VARCHAR(50) (nullable, для событийных оповещений)"}, {"event_type":
              "VARCHAR(50) (nullable, для событийных оповещений)"}, {"condition":
              "ENUM (above, below, equals, change_percentage)"}, {"target_value":
              "DECIMAL(20,8) (nullable)"}, {"triggered": "BOOLEAN"}, {"triggered_at":
              "TIMESTAMP (nullable)"}, {"active": "BOOLEAN"}, {"created_at": "TIMESTAMP"},
              {"updated_at": "TIMESTAMP"}]}]}}}'
        - column:
            name: metadata
            value: '{"id": "economy-analytics-system-architecture", "title": "Архитектура
              системы экономической аналитики", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T16:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "economy", "analytics", "charts", "market-intelligence"],
              "related_systems": ["economy-service", "analytics-service", "stock-exchange-service"],
              "related_documents": [{"id": "economy-analytics", "relation": "extends"},
              {"id": "game-mechanics-systems-architecture", "relation": "extends"}],
              "github_issue": 216, "visibility": "internal", "audience": ["architect",
              "backend", "economy", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\economy-analytics-system-architecture.yaml
