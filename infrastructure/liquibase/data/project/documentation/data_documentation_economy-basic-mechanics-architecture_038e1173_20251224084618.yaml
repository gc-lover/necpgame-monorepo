databaseChangeLog:
- changeSet:
    id: documentation-economy-basic-mechanics-architecture-038e1173
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '5041061034256945'
        - column:
            name: doc_id
            value: economy-basic-mechanics-architecture
        - column:
            name: title
            value: Архитектура базовых экономических механик
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-01 00:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - economy
            - trading
            - currencies
            - resources
            - guilds
            - world-impact
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - economy-service
            - social-service
            - world-service
            - wallet-service
            - inventory-service
        - column:
            name: related_documents
            value: '[{"id": "economy-overview", "relation": "implements"}, {"id":
              "economy-trading", "relation": "implements"}, {"id": "economy-trading-guilds",
              "relation": "implements"}, {"id": "economy-currencies-resources", "relation":
              "implements"}, {"id": "economy-world-impact", "relation": "implements"},
              {"id": "economy-trading-markets-auctions-architecture", "relation":
              "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - economy
            - api-designer
            - network
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "economy-basic-mechanics-architecture", "title":
              "Архитектура базовых экономических механик", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-12-01T00:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "economy", "trading",
              "currencies", "resources", "guilds", "world-impact"], "related_systems":
              ["economy-service", "social-service", "world-service", "wallet-service",
              "inventory-service"], "related_documents": [{"id": "economy-overview",
              "relation": "implements"}, {"id": "economy-trading", "relation": "implements"},
              {"id": "economy-trading-guilds", "relation": "implements"}, {"id": "economy-currencies-resources",
              "relation": "implements"}, {"id": "economy-world-impact", "relation":
              "implements"}, {"id": "economy-trading-markets-auctions-architecture",
              "relation": "extends"}], "github_issue": 60, "visibility": "internal",
              "audience": ["architect", "backend", "economy", "api-designer", "network"]},
              "summary": {"problem": "Требуется спроектировать архитектуру базовых
              экономических механик:\n- Обзор экономической системы\n- Базовая P2P
              торговля\n- Торговые гильдии\n- Валюты и ресурсы\n- Влияние экономики
              на игровой мир\n", "goal": "Создать архитектурную схему базовых экономических
              механик с определением:\n- Компонентов для управления базовыми экономическими
              операциями\n- REST, WebSocket и Event Bus контрактов\n- Синхронизации
              данных между слоями (Event Sourcing, CQRS)\n- Тикрейта и требований
              к сетевой нагрузке\n- Интеграций между компонентами\n- Структуры БД\n-
              Технического задания для реализации\n", "essence": "Архитектура базовых
              экономических механик, обеспечивающая фундамент для\nболее сложных экономических
              систем (рынки, аукционы, биржа).\n"}, "architecture": {"overview": "Архитектура
              базовых экономических механик состоит из следующих компонентов:\n1.
              Economy Overview Manager - управление обзором экономики\n2. Basic Trading
              System - базовая P2P торговля\n3. Trading Guilds System - система торговых
              гильдий\n4. Currencies & Resources Manager - управление валютами и ресурсами\n5.
              World Impact System - система влияния экономики на мир\n", "microservices":
              [{"name": "economy-service", "port": 8085, "responsibility": "Обработка
              базовых экономических механик:\n- Обзор экономической системы\n- Базовая
              P2P торговля между игроками\n- Торговые гильдии\n- Управление валютами
              и ресурсами\n- Влияние экономики на игровой мир\n", "components": [{"economy-overview-manager":
              "управление обзором экономики"}, {"basic-trading-system": "базовая P2P
              торговля"}, {"trading-guilds-system": "система торговых гильдий"}, {"currencies-resources-manager":
              "управление валютами и ресурсами"}, {"world-impact-system": "влияние
              экономики на мир"}], "endpoints": ["GET /api/v1/economy/overview - обзор
              экономики", "GET /api/v1/economy/currencies - список валют", "GET /api/v1/economy/resources
              - список ресурсов", "POST /api/v1/economy/trade/initiate - инициация
              торговли", "POST /api/v1/economy/trade/accept - принятие торговли",
              "POST /api/v1/economy/trade/cancel - отмена торговли", "GET /api/v1/economy/guilds
              - список торговых гильдий", "POST /api/v1/economy/guilds/create - создание
              гильдии", "POST /api/v1/economy/guilds/{id}/join - вступление в гильдию",
              "GET /api/v1/economy/world-impact - влияние на мир"], "websocket_channels":
              ["wss://api.necp.game/v1/economy/trade/{sessionId} - live события торговли",
              "wss://api.necp.game/v1/economy/guilds/{guildId} - события гильдии",
              "wss://api.necp.game/v1/economy/world-impact - обновления влияния"],
              "events_published": [{"economy.trade.initiated": "инициация торговли"},
              {"economy.trade.completed": "завершение торговли"}, {"economy.trade.cancelled":
              "отмена торговли"}, {"economy.guild.created": "создание гильдии"}, {"economy.guild.member-joined":
              "вступление в гильдию"}, {"economy.currency.rate-updated": "обновление
              курса валюты"}, {"economy.resource.price-updated": "обновление цены
              ресурса"}, {"economy.world-impact.updated": "обновление влияния на мир"}],
              "events_subscribed": [{"inventory.item-moved": "перемещение предмета"},
              {"wallet.balance-updated": "обновление баланса"}, {"social.reputation-updated":
              "обновление репутации"}, {"world.event-triggered": "триггер мирового
              события"}]}], "data_synchronization": {"strategy": "Event Sourcing +
              CQRS", "event_store": "Все события базовых экономических механик сохраняются
              в Event Store:\n- economy.trade.initiated\n- economy.trade.completed\n-
              economy.trade.cancelled\n- economy.guild.created\n- economy.guild.member-joined\n-
              economy.currency.rate-updated\n- economy.resource.price-updated\n- economy.world-impact.updated\n",
              "command_side": "Command Side (Write Model):\n- economy-service: обработка
              команд торговли, гильдий, валют, влияния\n", "query_side": "Query Side
              (Read Model):\n- economy-service: получение обзора экономики, статуса
              операций, курсов валют\n", "saga_pattern": "Saga Pattern для распределенных
              транзакций:\n- Trade Initiation Saga: инициация торговли → проверка
              инвентаря → блокировка предметов\n- Trade Completion Saga: завершение
              торговли → обмен предметами → обновление балансов\n- Guild Creation
              Saga: создание гильдии → проверка требований → создание структуры\n-
              Currency Exchange Saga: обмен валют → проверка баланса → обновление
              курсов\n", "consistency": {"strong_consistency": "Критичные операции
              требуют Strong Consistency:\n- Торговые операции (инициация, завершение,
              отмена)\n- Операции с гильдиями (создание, вступление)\n- Обмен валют\n",
              "eventual_consistency": "Не критичные операции допускают Eventual Consistency:\n-
              Обзор экономики\n- Статистика гильдий\n- Влияние на мир (обновляется
              периодически)\n"}}, "tick_rate_and_network_load": {"trading_operations":
              {"tick_rate": "on-demand", "protocol": "WebSocket (TCP)", "latency":
              "<100ms", "bandwidth": "~1-5 KB per operation", "optimization": "- Кэширование
              статуса торговых сессий\n- Батчинг обновлений инвентаря\n"}, "guild_operations":
              {"tick_rate": "on-demand", "protocol": "WebSocket (TCP)", "latency":
              "<100ms", "bandwidth": "~1-3 KB per operation", "optimization": "- Кэширование
              структуры гильдий\n- Ленивая загрузка членов гильдии\n"}, "currency_updates":
              {"tick_rate": "1-5 Hz (зависит от волатильности)", "protocol": "WebSocket
              (TCP)", "latency": "<200ms", "bandwidth": "~0.5-1 KB per update", "optimization":
              "- Агрегация обновлений курсов\n- Кэширование курсов валют\n"}, "world_impact_updates":
              {"tick_rate": "0.1-1 Hz (периодические обновления)", "protocol": "WebSocket
              (TCP)", "latency": "<500ms", "bandwidth": "~2-5 KB per update", "optimization":
              "- Периодические обновления влияния\n- Кэширование данных влияния\n"}},
              "data_flows": {"trade_flow": "1. Инициация торговли: Client → economy-service
              → проверка инвентаря → блокировка предметов\n2. Принятие торговли: Client
              → economy-service → проверка балансов → обмен предметами\n3. Завершение
              торговли: economy-service → обновление инвентарей → обновление балансов
              → события\n", "guild_flow": "1. Создание гильдии: Client → economy-service
              → проверка требований → создание структуры\n2. Вступление в гильдию:
              Client → economy-service → проверка условий → добавление члена\n3. Обновление
              гильдии: economy-service → обновление структуры → события\n", "currency_flow":
              "1. Обмен валют: Client → economy-service → проверка баланса → обновление
              курсов → обмен\n2. Обновление курсов: economy-service → расчет курсов
              → обновление кэша → события\n", "world_impact_flow": "1. Расчет влияния:
              economy-service → анализ экономических данных → расчет влияния\n2. Обновление
              влияния: economy-service → обновление данных → события → world-service\n"},
              "integrations": {"with_social_service": "- Получение репутации игроков
              для торговли\n- Интеграция с системой гильдий\n- Влияние экономики на
              репутацию фракций\n", "with_world_service": "- Влияние экономики на
              регионы\n- Триггеры мировых событий\n- Обновление состояния мира\n",
              "with_wallet_service": "- Проверка балансов для торговли\n- Обновление
              балансов после операций\n- Управление валютами\n", "with_inventory_service":
              "- Проверка наличия предметов\n- Блокировка предметов для торговли\n-
              Обновление инвентарей после операций\n"}}, "database": {"tables": [{"name":
              "economy_overview", "description": "Обзор экономической системы", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"region_id": "UUID REFERENCES regions(id)"},
              {"currency_id": "UUID REFERENCES currencies(id)"}, {"total_volume":
              "DECIMAL(20,2)"}, {"active_trades": "INTEGER"}, {"active_guilds": "INTEGER"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "trade_sessions", "description":
              "Торговые сессии", "columns": [{"id": "UUID PRIMARY KEY"}, {"initiator_id":
              "UUID REFERENCES characters(id)"}, {"target_id": "UUID REFERENCES characters(id)"},
              {"status": "VARCHAR(20) (pending, active, completed, cancelled)"}, {"created_at":
              "TIMESTAMP"}, {"completed_at": "TIMESTAMP"}]}, {"name": "trade_items",
              "description": "Предметы в торговой сессии", "columns": [{"id": "UUID
              PRIMARY KEY"}, {"session_id": "UUID REFERENCES trade_sessions(id)"},
              {"character_id": "UUID REFERENCES characters(id)"}, {"item_id": "UUID
              REFERENCES items(id)"}, {"quantity": "INTEGER"}]}, {"name": "trading_guilds",
              "description": "Торговые гильдии", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"name": "VARCHAR(100)"}, {"leader_id": "UUID REFERENCES characters(id)"},
              {"capital": "DECIMAL(20,2)"}, {"member_count": "INTEGER"}, {"created_at":
              "TIMESTAMP"}]}, {"name": "guild_members", "description": "Члены торговых
              гильдий", "columns": [{"id": "UUID PRIMARY KEY"}, {"guild_id": "UUID
              REFERENCES trading_guilds(id)"}, {"character_id": "UUID REFERENCES characters(id)"},
              {"role": "VARCHAR(20) (member, officer, leader)"}, {"joined_at": "TIMESTAMP"}]},
              {"name": "currencies", "description": "Валюты", "columns": [{"id": "UUID
              PRIMARY KEY"}, {"code": "VARCHAR(10) UNIQUE"}, {"name": "VARCHAR(100)"},
              {"region_id": "UUID REFERENCES regions(id)"}, {"exchange_rate": "DECIMAL(20,8)"},
              {"updated_at": "TIMESTAMP"}]}, {"name": "resources", "description":
              "Ресурсы", "columns": [{"id": "UUID PRIMARY KEY"}, {"name": "VARCHAR(100)"},
              {"category": "VARCHAR(50)"}, {"base_price": "DECIMAL(20,2)"}, {"current_price":
              "DECIMAL(20,2)"}, {"updated_at": "TIMESTAMP"}]}, {"name": "world_economy_impact",
              "description": "Влияние экономики на мир", "columns": [{"id": "UUID
              PRIMARY KEY"}, {"region_id": "UUID REFERENCES regions(id)"}, {"faction_id":
              "UUID REFERENCES factions(id)"}, {"economic_power": "DECIMAL(20,2)"},
              {"trade_volume": "DECIMAL(20,2)"}, {"influence_level": "INTEGER"}, {"updated_at":
              "TIMESTAMP"}]}], "indexes": [{"table": "trade_sessions", "columns":
              ["initiator_id", "target_id", "status"]}, {"table": "trade_items", "columns":
              ["session_id", "character_id"]}, {"table": "trading_guilds", "columns":
              ["leader_id"]}, {"table": "guild_members", "columns": ["guild_id", "character_id"]},
              {"table": "currencies", "columns": ["code", "region_id"]}, {"table":
              "resources", "columns": ["category", "name"]}, {"table": "world_economy_impact",
              "columns": ["region_id", "faction_id"]}]}, "subtasks": [{"id": "economy-overview-manager",
              "title": "Economy Overview Manager", "description": "Управление обзором
              экономической системы", "effort_days": 3, "dependencies": []}, {"id":
              "basic-trading-system", "title": "Basic Trading System", "description":
              "Базовая P2P торговля между игроками", "effort_days": 5, "dependencies":
              ["economy-overview-manager"]}, {"id": "trading-guilds-system", "title":
              "Trading Guilds System", "description": "Система торговых гильдий",
              "effort_days": 5, "dependencies": ["basic-trading-system"]}, {"id":
              "currencies-resources-manager", "title": "Currencies & Resources Manager",
              "description": "Управление валютами и ресурсами", "effort_days": 4,
              "dependencies": ["economy-overview-manager"]}, {"id": "world-impact-system",
              "title": "World Impact System", "description": "Система влияния экономики
              на мир", "effort_days": 4, "dependencies": ["trading-guilds-system",
              "currencies-resources-manager"]}, {"id": "trade-integration", "title":
              "Trade Integration", "description": "Интеграция торговли с другими системами",
              "effort_days": 3, "dependencies": ["basic-trading-system"]}, {"id":
              "guild-integration", "title": "Guild Integration", "description": "Интеграция
              гильдий с социальными системами", "effort_days": 3, "dependencies":
              ["trading-guilds-system"]}, {"id": "currency-integration", "title":
              "Currency Integration", "description": "Интеграция валют с кошельком
              и биржей", "effort_days": 3, "dependencies": ["currencies-resources-manager"]},
              {"id": "world-impact-integration", "title": "World Impact Integration",
              "description": "Интеграция влияния с мировыми событиями", "effort_days":
              3, "dependencies": ["world-impact-system"]}], "total_estimated_effort":
              "33 days", "diagrams": {"component_diagram": "```mermaid\ngraph TB\n    subgraph
              \"Economy Service\"\n        EOM[Economy Overview Manager]\n        BTS[Basic
              Trading System]\n        TGS[Trading Guilds System]\n        CRM[Currencies
              & Resources Manager]\n        WIS[World Impact System]\n    end\n\n    subgraph
              \"Database\"\n        DB[(PostgreSQL<br/>economy_overview<br/>trade_sessions<br/>trading_guilds<br/>currencies<br/>resources<br/>world_economy_impact)]\n    end\n\n    subgraph
              \"External Services\"\n        SS[Social Service]\n        WS[World
              Service]\n        WLS[Wallet Service]\n        IS[Inventory Service]\n        RG[Realtime
              Gateway]\n        EB[Event Bus]\n    end\n\n    subgraph \"Client\"\n        CL[UE5
              Client]\n    end\n\n    CL -->|API requests| EOM\n    CL -->|API requests|
              BTS\n    CL -->|API requests| TGS\n    CL -->|API requests| CRM\n    CL
              -->|API requests| WIS\n\n    EOM -->|store| DB\n    BTS -->|store| DB\n    TGS
              -->|store| DB\n    CRM -->|store| DB\n    WIS -->|store| DB\n\n    BTS
              -->|check inventory| IS\n    BTS -->|check balance| WLS\n    TGS -->|get
              reputation| SS\n    WIS -->|update world| WS\n    CRM -->|update balance|
              WLS\n\n    EOM -->|events| EB\n    BTS -->|events| EB\n    TGS -->|events|
              EB\n    CRM -->|events| EB\n    WIS -->|events| EB\n\n    EB -->|push|
              RG\n    RG -->|updates| CL\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "economy-basic-mechanics-architecture", "title": "Архитектура
              базовых экономических механик", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-12-01T00:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "economy", "trading", "currencies", "resources",
              "guilds", "world-impact"], "related_systems": ["economy-service", "social-service",
              "world-service", "wallet-service", "inventory-service"], "related_documents":
              [{"id": "economy-overview", "relation": "implements"}, {"id": "economy-trading",
              "relation": "implements"}, {"id": "economy-trading-guilds", "relation":
              "implements"}, {"id": "economy-currencies-resources", "relation": "implements"},
              {"id": "economy-world-impact", "relation": "implements"}, {"id": "economy-trading-markets-auctions-architecture",
              "relation": "extends"}], "github_issue": 60, "visibility": "internal",
              "audience": ["architect", "backend", "economy", "api-designer", "network"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\economy-basic-mechanics-architecture.yaml
