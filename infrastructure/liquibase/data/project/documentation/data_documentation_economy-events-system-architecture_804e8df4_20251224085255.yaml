databaseChangeLog:
- changeSet:
    id: documentation-economy-events-system-architecture-804e8df4
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '4366525509007240'
        - column:
            name: doc_id
            value: economy-events-system-architecture
        - column:
            name: title
            value: Архитектура системы экономических событий
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-30 19:25:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - economy-events
            - backend
            - economy
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - economy-service-go
            - pricing-engine-go
            - analytics-service-go
        - column:
            name: related_documents
            value: '[{"id": "economy-events", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "economy-events-system-architecture", "title":
              "Архитектура системы экономических событий", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-30T19:25:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "economy-events",
              "backend", "economy"], "related_systems": ["economy-service-go", "pricing-engine-go",
              "analytics-service-go"], "related_documents": [{"id": "economy-events",
              "relation": "extends"}], "github_issue": 225, "visibility": "internal",
              "audience": ["architect", "backend", "api-designer"]}, "summary": {"problem":
              "Требуется спроектировать полную техническую архитектуру системы экономических
              событий\nдля управления событиями, влияющими на цены, курсы и активность
              игроков,\nс поддержкой планирования, жизненного цикла и интеграций.\n",
              "goal": "Создать архитектурную схему системы экономических событий с
              определением:\n- Компонентов системы (микросервисы, модули)\n- API endpoints
              (высокоуровнево)\n- Потоков данных и интеграций\n- Технического задания
              для реализации\n", "essence": "Система управления экономическими событиями
              с поддержкой планирования, жизненного цикла,\nприменения эффектов, мониторинга
              и интеграции с pricing-engine, stock-exchange,\ncurrency-exchange и
              analytics-service.\n"}, "architecture": {"overview": "Система экономических
              событий состоит из следующих компонентов:\n1. Event Manager - управление
              событиями и их жизненным циклом\n2. Event Scheduler - планирование и
              триггеры событий\n3. Effect Applier - применение эффектов к ценам и
              курсам\n4. Event Monitor - мониторинг и аудит событий\n5. Integration
              Handler - интеграция с другими сервисами\n6. Notification Manager -
              уведомления игроков о событиях\n", "components": [{"name": "Event Manager",
              "location": "economy-service-go (модуль economy-events)", "responsibility":
              "- Управление жизненным циклом событий (PLANNED, ANNOUNCED, ACTIVE,
              COOLDOWN, ARCHIVED)\n- CRUD операции с событиями\n- Валидация событий\n-
              Управление типами событий (кризисы, бумы, инфляция, эмбарго, санкции,
              тарифы, скандалы, технологические прорывы)\n- Управление охватом событий
              (глобальные, региональные)\n", "port": "8085 (economy-service-go)",
              "endpoints": ["GET /api/v1/economy/events - список событий", "GET /api/v1/economy/events/{event_id}
              - получение события", "POST /api/v1/economy/events - создание события",
              "PUT /api/v1/economy/events/{event_id} - обновление события", "DELETE
              /api/v1/economy/events/{event_id} - удаление события", "POST /api/v1/economy/events/{event_id}/announce
              - анонс события", "POST /api/v1/economy/events/{event_id}/activate -
              активация события", "POST /api/v1/economy/events/{event_id}/archive
              - архивация события"]}, {"name": "Event Scheduler", "location": "economy-service-go
              (модуль economy-events)", "responsibility": "- Планирование событий
              (cron, триггеры)\n- Автоматический запуск событий\n- Управление ограничениями
              (количество активных событий, минимальные перерывы)\n- Интеграция с
              quest-service для триггеров от квестов\n- Интеграция с симуляцией для
              автоматических событий\n", "integration": "Интегрируется с quest-service
              для триггеров от квестов\nИнтегрируется с симуляцией для автоматических
              событий\nИспользует cron для запланированных событий\n"}, {"name": "Effect
              Applier", "location": "economy-service-go (модуль economy-events)",
              "responsibility": "- Применение эффектов к ценам и курсам\n- Модификация
              цен товаров\n- Модификация курсов валют\n- Модификация ликвидности\n-
              Управление модификаторами (JSON-поля)\n", "integration": "Интегрируется
              с pricing-engine для изменения цен\nИнтегрируется с currency-exchange
              для изменения курсов\nИнтегрируется с stock-exchange для изменения котировок\n"},
              {"name": "Event Monitor", "location": "economy-service-go (модуль economy-events)",
              "responsibility": "- Мониторинг активных событий\n- Аудит изменений
              событий\n- KPI метрики (PriceDeviation, TransactionVolume, EventUptime)\n-
              Алерты при нарушении прогнозов\n- Отчеты о событиях\n", "integration":
              "Интегрируется с analytics-service для метрик\nПубликует события мониторинга
              через Event Bus\n"}, {"name": "Integration Handler", "location": "economy-service-go
              (модуль economy-events)", "responsibility": "- Интеграция с pricing-engine\n-
              Интеграция с stock-exchange\n- Интеграция с currency-exchange\n- Интеграция
              с quest-service\n- Интеграция с analytics-service\n- Публикация событий
              через Event Bus\n", "integration": "Публикует события через Event Bus
              для других сервисов\nПодписывается на события от других сервисов\n"},
              {"name": "Notification Manager", "location": "economy-service-go (модуль
              economy-events)", "responsibility": "- Уведомления игроков о событиях\n-
              Баннеры в игре\n- Push/email уведомления\n- Советы игрокам\n- WebSocket
              feed для realtime обновлений\n", "integration": "Интегрируется с notification-service
              для отправки уведомлений\nИспользует Realtime Gateway для WebSocket
              feed\n"}], "microservices": [{"name": "economy-service-go", "port":
              8085, "responsibility": "Основной сервис для экономических событий:\n-
              Управление событиями и их жизненным циклом\n- Планирование и триггеры
              событий\n- Применение эффектов к ценам и курсам\n- Мониторинг и аудит
              событий\n- Интеграция с другими сервисами\n- Уведомления игроков\n",
              "components": ["Event Manager", "Event Scheduler", "Effect Applier",
              "Event Monitor", "Integration Handler", "Notification Manager"]}], "database_schema":
              {"tables": [{"name": "economic_events", "description": "Хранит экономические
              события\n", "columns": ["event_id (UUID, PK)", "event_type (VARCHAR,
              NOT NULL) -- ''CRISIS'', ''BOOM'', ''INFLATION'', ''EMBARGO'', ''SANCTIONS'',
              ''TARIFFS'', ''SCANDAL'', ''TECH_BREAKTHROUGH''", "scope (VARCHAR, NOT
              NULL) -- ''GLOBAL'', ''REGIONAL''", "region_id (UUID, FK) -- для региональных
              событий", "title (VARCHAR, NOT NULL)", "description (TEXT)", "status
              (VARCHAR, NOT NULL) -- ''PLANNED'', ''ANNOUNCED'', ''ACTIVE'', ''COOLDOWN'',
              ''ARCHIVED''", "planned_start (TIMESTAMP)", "announced_at (TIMESTAMP)",
              "started_at (TIMESTAMP)", "ended_at (TIMESTAMP)", "archived_at (TIMESTAMP)",
              "effects (JSONB) -- модификаторы цен, курсов, ликвидности", "coverage
              (JSONB) -- охват (регионы, отрасли, товары)", "created_at (TIMESTAMP)",
              "updated_at (TIMESTAMP)"], "indexes": ["idx_event_type (event_type)",
              "idx_status (status)", "idx_scope (scope)", "idx_region_id (region_id)",
              "idx_planned_start (planned_start)", "idx_started_at (started_at)"]},
              {"name": "economic_event_history", "description": "Хранит историю изменений
              событий для аудита\n", "columns": ["history_id (UUID, PK)", "event_id
              (UUID, FK, NOT NULL)", "action (VARCHAR, NOT NULL) -- ''CREATED'', ''UPDATED'',
              ''ANNOUNCED'', ''ACTIVATED'', ''ARCHIVED''", "changed_by (UUID) -- user_id
              или system", "changes (JSONB) -- детали изменений", "timestamp (TIMESTAMP,
              NOT NULL)"], "indexes": ["idx_event_id (event_id)", "idx_timestamp (timestamp)"]},
              {"name": "economic_event_metrics", "description": "Хранит метрики событий
              для мониторинга\n", "columns": ["metric_id (UUID, PK)", "event_id (UUID,
              FK, NOT NULL)", "metric_type (VARCHAR, NOT NULL) -- ''PRICE_DEVIATION'',
              ''TRANSACTION_VOLUME'', ''EVENT_UPTIME''", "value (DECIMAL, NOT NULL)",
              "recorded_at (TIMESTAMP, NOT NULL)"], "indexes": ["idx_event_id (event_id)",
              "idx_metric_type (metric_type)", "idx_recorded_at (recorded_at)"]}]},
              "data_consistency": {"strategy": "Strong Consistency (ACID транзакции)
              для критичных операций", "mechanisms": ["ACID транзакции для создания
              и активации событий", "Оптимистичные блокировки (versioning) для предотвращения
              конфликтов", "Валидация перед применением эффектов", "Синхронизация
              с другими сервисами через Event Bus", "Outbox Pattern для гарантированной
              доставки событий", "Saga Pattern для распределенных операций (активация
              события, применение эффектов)"]}, "data_synchronization": {"event_sourcing":
              "Все изменения состояния событий (создание, активация, применение эффектов)\nзаписываются
              как события в Event Store. Это обеспечивает полный аудит,\nвозможность
              восстановления состояния и \"time travel\" для отладки.\nПримеры событий:
              EventCreatedEvent, EventActivatedEvent, EffectAppliedEvent.\n", "cqrs_pattern":
              "Разделение команд (создание событий, активация) и запросов (получение
              событий,\nистория) для оптимизации производительности и масштабируемости.\nRead-модели
              могут быть кэшированы в Redis для быстрых запросов.\n", "saga_pattern":
              "Для распределенных транзакций, таких как активация события (применение
              эффектов\nк pricing-engine, currency-exchange, stock-exchange), используется
              Saga Pattern\nдля обеспечения атомарности операций между Event Service
              и другими сервисами.\n", "outbox_pattern": "Для гарантированной доставки
              событий в Event Bus используется Outbox Pattern,\nкоторый записывает
              события в транзакционную таблицу перед публикацией.\n"}, "tickrate_specification":
              {"event_operations": {"tickrate": "Event-based (on-demand) + 1-5 Hz
              для мониторинга", "network_load": "- Обновления событий: event-based,
              ~0.1-0.5 events/sec\n- WebSocket feed событий: 1-5 Hz, ~0.2-0.5 KB/sec
              на игрока\n- Применение эффектов: event-based, ~0.1-0.3 events/sec\n-
              Общий трафик: ~0.3-1 KB/sec на игрока\n", "latency_requirements": "<
              50-200ms для операций с событиями", "sync_strategy": "Strong Consistency
              (ACID транзакции) для управления событиями, Eventual Consistency для
              эффектов"}}, "scalability_requirements": ["Горизонтальное масштабирование
              через economy-service", "Распределение нагрузки на обработку событий",
              "Оптимизация запросов к БД (batch, индексы)", "Кэширование активных
              событий в Redis", "WebSocket для потоковой передачи событий"]}, "subtasks":
              {"phase_1": {"name": "Event Manager", "tasks": ["Реализация Event Manager",
              "CRUD операции с событиями", "Управление жизненным циклом событий",
              "Валидация событий"], "estimated_effort": "4 days"}, "phase_2": {"name":
              "Event Scheduler", "tasks": ["Реализация Event Scheduler", "Планирование
              событий (cron)", "Триггеры от квестов", "Автоматические события"], "estimated_effort":
              "4 days"}, "phase_3": {"name": "Effect Applier", "tasks": ["Реализация
              Effect Applier", "Применение эффектов к ценам", "Применение эффектов
              к курсам", "Интеграция с pricing-engine и currency-exchange"], "estimated_effort":
              "5 days"}, "phase_4": {"name": "Event Monitor и Integration Handler",
              "tasks": ["Реализация Event Monitor", "Метрики и KPI", "Аудит событий",
              "Integration Handler", "Интеграция с другими сервисами"], "estimated_effort":
              "5 days"}, "phase_5": {"name": "Notification Manager и WebSocket", "tasks":
              ["Реализация Notification Manager", "Уведомления игроков", "WebSocket
              feed", "Интеграция с notification-service"], "estimated_effort": "3
              days"}, "phase_6": {"name": "Тестирование и оптимизация", "tasks": ["Нагрузочное
              тестирование", "Оптимизация запросов", "Мониторинг и алерты"], "estimated_effort":
              "3 days"}, "total_estimated_effort": "24 days"}, "diagrams": {"component_diagram":
              "```mermaid\ngraph TB\n    subgraph \"Economy Service\"\n        EM[Event
              Manager]\n        ES[Event Scheduler]\n        EA[Effect Applier]\n        EMO[Event
              Monitor]\n        IH[Integration Handler]\n        NM[Notification Manager]\n    end\n\n    subgraph
              \"Database\"\n        DB[(PostgreSQL<br/>economic_events<br/>economic_event_history<br/>economic_event_metrics)]\n    end\n\n    subgraph
              \"External Services\"\n        PE[Pricing Engine]\n        CE[Currency
              Exchange]\n        SE[Stock Exchange]\n        QS[Quest Service]\n        AS[Analytics
              Service]\n        NS[Notification Service]\n        RG[Realtime Gateway]\n        EB[Event
              Bus]\n    end\n\n    subgraph \"Client\"\n        CL[UE5 Client]\n    end\n\n    CL
              -->|API requests| EM\n    EM --> ES\n    EM --> EA\n    EM --> EMO\n    ES
              --> IH\n    EA --> PE\n    EA --> CE\n    EA --> SE\n    EMO --> AS\n    IH
              --> EB\n    IH --> QS\n    NM --> NS\n    NM --> RG\n    EM -->|store|
              DB\n    EMO -->|store| DB\n    RG -->|push updates| CL\n```\n", "data_flow_diagram":
              "```mermaid\nsequenceDiagram\n    participant S as Scheduler\n    participant
              EM as Event Manager\n    participant EA as Effect Applier\n    participant
              PE as Pricing Engine\n    participant CE as Currency Exchange\n    participant
              RG as Realtime Gateway\n    participant CL as Client\n\n    S->>EM:
              Trigger event activation\n    EM->>EM: Update event status\n    EM->>EA:
              Apply effects\n    EA->>PE: Update prices\n    EA->>CE: Update rates\n    PE->>EA:
              Prices updated\n    CE->>EA: Rates updated\n    EA->>EM: Effects applied\n    EM->>RG:
              Notify clients\n    RG->>CL: Push event update\n```\n", "event_lifecycle":
              "```mermaid\nstateDiagram-v2\n    [*] --> PLANNED: Event Created\n    PLANNED
              --> ANNOUNCED: Announce Event\n    ANNOUNCED --> ACTIVE: Activate Event\n    ACTIVE
              --> COOLDOWN: Event Ended\n    COOLDOWN --> ARCHIVED: Archive Event\n    PLANNED
              --> ARCHIVED: Cancel Event\n    ANNOUNCED --> ARCHIVED: Cancel Event\n    ACTIVE
              --> ARCHIVED: Force Archive\n    ARCHIVED --> [*]\n```\n"}, "decisions":
              [{"id": "adr-economy-events-architecture", "title": "Централизованная
              модель экономических событий", "status": "approved", "rationale": "Обеспечивает
              единый контроль событий, применение эффектов и интеграцию с сервисами.\nУпрощает
              мониторинг и аудит событий.\n"}], "history": [{"version": "1.0.0", "date":
              "2025-11-30", "author": "Architect Agent", "changes": "Создана полная
              архитектура системы экономических событий:\n- Определены компоненты
              (Event Manager, Event Scheduler, Effect Applier, Event Monitor, Integration
              Handler, Notification Manager)\n- Описаны API endpoints (высокоуровнево)\n-
              Спроектированы потоки данных\n- Определена структура БД (economic_events,
              economic_event_history, economic_event_metrics)\n- Спроектирована система
              жизненного цикла событий\n- Спроектирована система применения эффектов\n-
              Добавлена детальная синхронизация данных (Event Sourcing, CQRS, Saga
              Pattern, Outbox Pattern)\n- Добавлена спецификация тикрейта для операций
              с событиями\n- Создано техническое задание\n- Разбито на подзадачи\n"}]}'
        - column:
            name: metadata
            value: '{"id": "economy-events-system-architecture", "title": "Архитектура
              системы экономических событий", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-30T19:25:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "economy-events", "backend", "economy"], "related_systems":
              ["economy-service-go", "pricing-engine-go", "analytics-service-go"],
              "related_documents": [{"id": "economy-events", "relation": "extends"}],
              "github_issue": 225, "visibility": "internal", "audience": ["architect",
              "backend", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\economy-events-system-architecture.yaml
