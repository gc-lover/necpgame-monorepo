databaseChangeLog:
- changeSet:
    id: documentation-economy-logistics-system-architecture-51eeaa88
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '5080863763162196'
        - column:
            name: doc_id
            value: economy-logistics-system-architecture
        - column:
            name: title
            value: Архитектура системы логистики и перевозок
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 13:30:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - economy
            - logistics
            - transportation
            - insurance
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - economy-service
            - logistics-service
            - insurance-service
            - inventory-service
            - world-service
        - column:
            name: related_documents
            value: '[{"id": "economy-logistics", "relation": "extends"}, {"id": "economy-contracts",
              "relation": "integrates_with"}, {"id": "economy-events", "relation":
              "influences"}, {"id": "game-mechanics-systems-architecture", "relation":
              "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - economy
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "economy-logistics-system-architecture", "title":
              "Архитектура системы логистики и перевозок", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-23T13:30:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "economy", "logistics",
              "transportation", "insurance"], "related_systems": ["economy-service",
              "logistics-service", "insurance-service", "inventory-service", "world-service"],
              "related_documents": [{"id": "economy-logistics", "relation": "extends"},
              {"id": "economy-contracts", "relation": "integrates_with"}, {"id": "economy-events",
              "relation": "influences"}, {"id": "game-mechanics-systems-architecture",
              "relation": "extends"}], "github_issue": 230, "visibility": "internal",
              "audience": ["architect", "backend", "economy", "api-designer"]}, "summary":
              {"problem": "Требуется спроектировать архитектуру системы логистики
              и перевозок для перемещения товаров\nмежду регионами с учётом рисков,
              страхования, эскорта и мониторинга SLA.\n", "goal": "Создать архитектурную
              схему системы логистики с определением:\n- Микросервисов для управления
              перевозками\n- Компонентов для расчёта стоимости, управления рисками,
              страхования\n- API endpoints (высокоуровнево)\n- Интеграций с другими
              экономическими системами\n- Структуры БД для хранения перевозок и их
              состояния\n- Технического задания для реализации\n", "essence": "Система
              логистики управляет жизненным циклом перевозок (DRAFT → SCHEDULED →
              IN_TRANSIT → DELIVERED/LOST),\nрассчитывает стоимость с учётом транспорта,
              рисков, страхования и эскорта, отслеживает перевозки в реальном времени\nи
              управляет рисками через вероятностные модели.\n"}, "architecture": {"overview":
              "Система логистики состоит из следующих компонентов:\n1. Logistics Manager
              - управление перевозками и их жизненным циклом\n2. Quote Calculator
              - расчёт стоимости перевозки\n3. Route Planner - планирование маршрутов\n4.
              Transport Manager - управление типами транспорта\n5. Risk Engine - управление
              рисками и вероятностные модели\n6. Insurance Manager - управление страхованием
              перевозок\n7. Escort Manager - управление конвоями и эскортом\n8. Tracking
              Manager - отслеживание перевозок в реальном времени\n9. SLA Monitor
              - мониторинг SLA и алертинг\n10. Incident Manager - обработка инцидентов
              (атаки, аварии, задержки)\n", "microservices": [{"name": "logistics-service",
              "location": "services/logistics-service", "responsibility": "Основной
              сервис для управления логистикой и перевозками:\n- CRUD операции с перевозками\n-
              Управление жизненным циклом перевозок\n- Расчёт стоимости перевозок\n-
              Планирование маршрутов\n- Отслеживание перевозок\n", "components": ["Logistics
              Manager", "Quote Calculator", "Route Planner", "Transport Manager",
              "Tracking Manager"], "endpoints": ["POST /api/v1/logistics/shipments/quote
              - расчёт стоимости перевозки", "POST /api/v1/logistics/shipments - создание
              перевозки", "GET /api/v1/logistics/shipments/{id} - детали перевозки",
              "PUT /api/v1/logistics/shipments/{id} - обновление перевозки", "DELETE
              /api/v1/logistics/shipments/{id} - отмена перевозки", "POST /api/v1/logistics/shipments/{id}/schedule
              - планирование перевозки", "POST /api/v1/logistics/shipments/{id}/start
              - начало перевозки", "POST /api/v1/logistics/shipments/{id}/complete
              - завершение перевозки", "GET /api/v1/logistics/shipments - список перевозок
              (с фильтрами)", "GET /api/v1/logistics/shipments/active - активные перевозки",
              "WS /ws/logistics/shipments/{id} - WebSocket для отслеживания перевозки"]},
              {"name": "risk-service", "location": "services/risk-service (или модуль
              в logistics-service)", "responsibility": "Управление рисками перевозок:\n-
              Расчёт вероятностей рисков\n- Обработка инцидентов\n- Динамическая смена
              маршрутов\n- Интеграция с экономическими событиями\n", "components":
              ["Risk Engine", "Incident Manager", "Route Optimizer"], "endpoints":
              ["POST /api/v1/risk/calculate - расчёт рисков для маршрута", "POST /api/v1/risk/incidents
              - создание инцидента", "GET /api/v1/risk/incidents/{id} - детали инцидента",
              "POST /api/v1/risk/reroute - пересчёт маршрута при риске"]}, {"name":
              "insurance-service", "location": "services/insurance-service", "responsibility":
              "Управление страхованием перевозок:\n- Расчёт стоимости страхования\n-
              Управление страховыми планами\n- Обработка страховых выплат\n- Интеграция
              с логистикой\n", "components": ["Insurance Manager", "Insurance Calculator",
              "Claim Processor"], "endpoints": ["POST /api/v1/insurance/calculate
              - расчёт стоимости страхования", "POST /api/v1/insurance/policies -
              создание страхового полиса", "GET /api/v1/insurance/policies/{id} -
              детали полиса", "POST /api/v1/insurance/claims - создание страхового
              требования", "GET /api/v1/insurance/claims/{id} - детали требования"]},
              {"name": "escort-service", "location": "services/escort-service (или
              модуль в logistics-service)", "responsibility": "Управление конвоями
              и эскортом:\n- Найм эскорта\n- Управление бронированным транспортом\n-
              Расчёт влияния эскорта на риски\n- Координация конвоев\n", "components":
              ["Escort Manager", "Escort Calculator", "Convoy Coordinator"], "endpoints":
              ["POST /api/v1/escort/calculate - расчёт стоимости эскорта", "POST /api/v1/escort/hire
              - найм эскорта", "GET /api/v1/escort/available - доступные эскорты",
              "POST /api/v1/escort/convoy - создание конвоя"]}], "components": [{"name":
              "Logistics Manager", "location": "logistics-service", "responsibility":
              "Управление перевозками и их жизненным циклом:\n- Создание, обновление,
              отмена перевозок\n- Переходы между состояниями (DRAFT → SCHEDULED →
              IN_TRANSIT → DELIVERED/LOST)\n- Валидация данных перевозок\n- Управление
              версиями перевозок\n", "methods": ["createShipment(shipmentData)", "updateShipment(shipmentId,
              shipmentData)", "cancelShipment(shipmentId)", "transitionState(shipmentId,
              newState)", "getShipment(shipmentId)", "listShipments(filters)"]}, {"name":
              "Quote Calculator", "location": "logistics-service", "responsibility":
              "Расчёт стоимости перевозки:\n- Расчёт базовой стоимости по маршруту
              и транспорту\n- Учёт рисков и страхования\n- Учёт эскорта\n- Финальная
              стоимость перевозки\n", "methods": ["calculateQuote(route, transport,
              cargo, insurance, escort)", "calculateBaseCost(route, transport, cargo)",
              "calculateRiskCost(route, risks)", "calculateInsuranceCost(cargo, insurancePlan)",
              "calculateEscortCost(escortType, route)"]}, {"name": "Route Planner",
              "location": "logistics-service", "responsibility": "Планирование маршрутов:\n-
              Определение оптимальных маршрутов\n- Расчёт расстояний и времени доставки\n-
              Учёт рисков на маршрутах\n- Динамическая смена маршрутов при инцидентах\n",
              "methods": ["planRoute(origin, destination, transportType)", "calculateDistance(origin,
              destination)", "calculateDeliveryTime(route, transportType)", "optimizeRoute(route,
              risks)", "reroute(shipmentId, newRoute)"]}, {"name": "Transport Manager",
              "location": "logistics-service", "responsibility": "Управление типами
              транспорта:\n- Каталог транспорта (наземный, воздушный, железнодорожный,
              курьерский, самовывоз)\n- Характеристики транспорта (скорость, вместимость,
              стоимость)\n- Доступность транспорта\n", "methods": ["getTransportTypes()",
              "getTransportDetails(transportType)", "checkAvailability(transportType,
              route)", "reserveTransport(transportType, shipmentId)"]}, {"name": "Risk
              Engine", "location": "risk-service", "responsibility": "Управление рисками
              и вероятностные модели:\n- Расчёт вероятностей рисков (атаки бандитов,
              аварии, таможенные задержки, погода)\n- Моделирование инцидентов\n-
              Расчёт влияния эскорта на риски\n- Интеграция с экономическими событиями\n",
              "methods": ["calculateRisks(route, transportType, cargo)", "simulateIncident(riskType,
              probability)", "applyEscortRiskReduction(escortType, baseRisks)", "getEventInfluencedRisks(route,
              activeEvents)"]}, {"name": "Insurance Manager", "location": "insurance-service",
              "responsibility": "Управление страхованием перевозок:\n- Расчёт стоимости
              страхования (basic, premium, full)\n- Создание страховых полисов\n-
              Обработка страховых требований\n- Выплаты при потере груза\n", "methods":
              ["calculateInsuranceCost(cargo, insurancePlan)", "createPolicy(shipmentId,
              insurancePlan)", "processClaim(claimId)", "payoutClaim(claimId, amount)"]},
              {"name": "Escort Manager", "location": "escort-service", "responsibility":
              "Управление конвоями и эскортом:\n- Найм эскорта (NPC или игроки)\n-
              Управление бронированным транспортом\n- Расчёт влияния эскорта на вероятность
              атак\n- Координация конвоев\n", "methods": ["calculateEscortCost(escortType,
              route)", "hireEscort(shipmentId, escortType)", "getAvailableEscorts(route)",
              "createConvoy(shipmentIds)"]}, {"name": "Tracking Manager", "location":
              "logistics-service", "responsibility": "Отслеживание перевозок в реальном
              времени:\n- Обновление позиции перевозки\n- WebSocket поток для клиентов\n-
              Уведомления о статусе\n- Интеграция с картой мира\n", "methods": ["updatePosition(shipmentId,
              position)", "getCurrentPosition(shipmentId)", "subscribeToTracking(shipmentId,
              clientId)", "sendTrackingUpdate(shipmentId, update)"]}, {"name": "SLA
              Monitor", "location": "logistics-service", "responsibility": "Мониторинг
              SLA и алертинг:\n- Отслеживание времени доставки\n- Проверка отклонений
              от SLA\n- Генерация алертов\n- KPI метрики\n", "methods": ["monitorSLA(shipmentId)",
              "checkSLAViolations()", "generateAlert(shipmentId, violation)", "calculateKPIs(timeRange)"]},
              {"name": "Incident Manager", "location": "risk-service", "responsibility":
              "Обработка инцидентов:\n- Создание инцидентов (атаки, аварии, задержки)\n-
              Обработка последствий инцидентов\n- Уведомления об инцидентах\n- Интеграция
              со страхованием\n", "methods": ["createIncident(shipmentId, incidentType,
              details)", "processIncident(incidentId)", "notifyIncident(shipmentId,
              incident)", "handleLoss(shipmentId, incidentId)"]}], "data_flow": {"shipment_creation":
              "1. Игрок запрашивает расчёт стоимости через Quote Calculator\n2. Quote
              Calculator получает данные о маршруте, транспорте, грузе\n3. Risk Engine
              рассчитывает риски для маршрута\n4. Insurance Manager рассчитывает стоимость
              страхования\n5. Escort Manager рассчитывает стоимость эскорта (если
              требуется)\n6. Quote Calculator суммирует все стоимости\n7. Игрок создаёт
              перевозку через Logistics Manager\n8. Перевозка сохраняется в БД со
              статусом DRAFT\n", "shipment_scheduling": "1. Игрок планирует перевозку
              (выбирает время отправки)\n2. Logistics Manager переводит статус DRAFT
              → SCHEDULED\n3. Transport Manager резервирует транспорт\n4. Insurance
              Manager создаёт страховой полис (если выбрано)\n5. Escort Manager нанимает
              эскорт (если требуется)\n6. Route Planner финализирует маршрут\n7. Событие
              публикуется в Event Bus (logistics.shipment.scheduled)\n", "shipment_start":
              "1. Наступает время отправки или игрок запускает перевозку вручную\n2.
              Logistics Manager переводит статус SCHEDULED → IN_TRANSIT\n3. Tracking
              Manager начинает отслеживание позиции\n4. SLA Monitor начинает мониторинг
              времени доставки\n5. WebSocket соединение открывается для клиента\n6.
              Событие публикуется в Event Bus (logistics.shipment.started)\n", "shipment_tracking":
              "1. Tracking Manager обновляет позицию перевозки (каждые N секунд)\n2.
              WebSocket отправляет обновления клиентам\n3. Risk Engine проверяет риски
              на текущей позиции\n4. При обнаружении риска: Incident Manager создаёт
              инцидент\n5. При инциденте: обработка последствий (потеря груза, задержка,
              повреждение)\n6. При потере: Insurance Manager обрабатывает страховое
              требование\n", "shipment_completion": "1. Перевозка достигает пункта
              назначения\n2. Logistics Manager переводит статус IN_TRANSIT → DELIVERED\n3.
              Inventory Service получает груз в пункте назначения\n4. SLA Monitor
              финализирует метрики\n5. Tracking Manager останавливает отслеживание\n6.
              Событие публикуется в Event Bus (logistics.shipment.delivered)\n7. Уведомления
              отправляются игроку\n", "incident_handling": "1. Risk Engine обнаруживает
              риск или инцидент происходит\n2. Incident Manager создаёт инцидент (атака,
              авария, задержка)\n3. Обработка последствий:\n   - Потеря груза → статус
              LOST, страховое требование\n   - Задержка → статус DELAYED, пересчёт
              времени доставки\n   - Повреждение → снижение стоимости груза, страховое
              требование\n4. Уведомления отправляются игроку\n5. Событие публикуется
              в Event Bus (logistics.shipment.incident)\n"}, "integrations": {"with_economy_service":
              "- Получение данных о грузе\n- Синхронизация стоимости перевозок\n-
              Интеграция с контрактами\n", "with_inventory_service": "- Резервирование
              груза при создании перевозки\n- Передача груза в пункте назначения\n-
              Возврат груза при отмене перевозки\n", "with_insurance_service": "-
              Расчёт стоимости страхования\n- Создание страховых полисов\n- Обработка
              страховых требований\n", "with_world_service": "- Получение данных о
              регионах и маршрутах\n- Интеграция с картой мира\n- Синхронизация позиций
              перевозок\n", "with_economy_events": "- Получение активных экономических
              событий\n- Влияние событий на риски (кризисы, эмбарго)\n- Влияние событий
              на стоимость перевозок\n", "with_notification_service": "- Уведомления
              о статусе перевозки\n- Уведомления об инцидентах\n- Уведомления о доставке\n"},
              "event_bus_events": {"published": ["logistics.shipment.created", "logistics.shipment.scheduled",
              "logistics.shipment.started", "logistics.shipment.position_updated",
              "logistics.shipment.incident", "logistics.shipment.delayed", "logistics.shipment.delivered",
              "logistics.shipment.lost", "logistics.shipment.cancelled"], "subscribed":
              ["economy.event.active (для влияния на риски)", "world.region.changed
              (для изменения маршрутов)"]}}}'
        - column:
            name: metadata
            value: '{"id": "economy-logistics-system-architecture", "title": "Архитектура
              системы логистики и перевозок", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T13:30:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "economy", "logistics", "transportation", "insurance"],
              "related_systems": ["economy-service", "logistics-service", "insurance-service",
              "inventory-service", "world-service"], "related_documents": [{"id":
              "economy-logistics", "relation": "extends"}, {"id": "economy-contracts",
              "relation": "integrates_with"}, {"id": "economy-events", "relation":
              "influences"}, {"id": "game-mechanics-systems-architecture", "relation":
              "extends"}], "github_issue": 230, "visibility": "internal", "audience":
              ["architect", "backend", "economy", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\economy-logistics-system-architecture.yaml
