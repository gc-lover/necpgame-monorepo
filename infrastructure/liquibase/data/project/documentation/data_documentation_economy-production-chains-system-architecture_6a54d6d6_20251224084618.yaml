databaseChangeLog:
- changeSet:
    id: documentation-economy-production-chains-system-architecture-6a54d6d6
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-580669486948201'
        - column:
            name: doc_id
            value: economy-production-chains-system-architecture
        - column:
            name: title
            value: Архитектура системы производственных цепочек
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 15:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - economy
            - production
            - crafting
            - manufacturing
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - economy-service
            - crafting-service
            - guild-service
            - inventory-service
        - column:
            name: related_documents
            value: '[{"id": "mechanics-economy-production-chains", "relation": "extends"},
              {"id": "game-mechanics-systems-architecture", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - economy
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "economy-production-chains-system-architecture",
              "title": "Архитектура системы производственных цепочек", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-11-23T15:00:00+00:00", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "economy", "production", "crafting", "manufacturing"], "related_systems":
              ["economy-service", "crafting-service", "guild-service", "inventory-service"],
              "related_documents": [{"id": "mechanics-economy-production-chains",
              "relation": "extends"}, {"id": "game-mechanics-systems-architecture",
              "relation": "extends"}], "github_issue": 232, "visibility": "internal",
              "audience": ["architect", "backend", "economy", "api-designer"]}, "summary":
              {"problem": "Требуется спроектировать архитектуру системы производственных
              цепочек для управления\nпроизводством от добычи сырья до крафта легендарных
              предметов с учётом этапов, инвестиций,\nрисков, массового производства
              и ускорителей.\n", "goal": "Создать архитектурную схему системы производственных
              цепочек с определением:\n- Микросервисов для управления производством\n-
              Компонентов для цепочек, станций, лицензий, ускорителей\n- API endpoints
              (высокоуровнево)\n- Интеграций с другими системами\n- Структуры БД для
              хранения цепочек и производства\n- Технического задания для реализации\n",
              "essence": "Система производственных цепочек управляет многоэтапным
              производством предметов,\nподдерживает массовое производство, ускорители,
              rush-заказы и легендарный крафт,\nинтегрируется с crafting-service,
              guild-service и economy-service.\n"}, "architecture": {"overview": "Система
              производственных цепочек состоит из следующих компонентов:\n1. Production
              Chain Manager - управление производственными цепочками\n2. Production
              Stage Manager - управление этапами производства\n3. Station Manager
              - управление производственными станциями\n4. License Manager - управление
              лицензиями на производство\n5. Resource Manager - управление ресурсами
              для производства\n6. Bulk Production Manager - управление массовым производством\n7.
              Accelerator Manager - управление ускорителями и rush-заказами\n8. Legendary
              Craft Manager - управление легендарным крафтом\n9. Production Analytics
              Collector - сбор аналитики по производству\n", "microservices": [{"name":
              "production-service", "location": "services/production-service", "responsibility":
              "Основной сервис для управления производственными цепочками:\n- CRUD
              операции с цепочками\n- Управление этапами производства\n- Управление
              станциями и лицензиями\n- Массовое производство\n- Интеграция с crafting-service\n",
              "components": ["Production Chain Manager", "Production Stage Manager",
              "Station Manager", "License Manager", "Resource Manager", "Bulk Production
              Manager", "Accelerator Manager", "Legendary Craft Manager"], "endpoints":
              ["GET /api/v1/production/chains - список производственных цепочек",
              "GET /api/v1/production/chains/{id} - детали цепочки", "POST /api/v1/production/chains/{id}/start
              - запуск производства", "GET /api/v1/production/orders/{id} - детали
              заказа на производство", "POST /api/v1/production/orders - создание
              заказа", "DELETE /api/v1/production/orders/{id} - отмена заказа", "POST
              /api/v1/production/orders/{id}/rush - rush-заказ", "POST /api/v1/production/bulk
              - массовое производство", "GET /api/v1/production/stations - список
              станций игрока", "GET /api/v1/production/stations/{id} - детали станции",
              "POST /api/v1/production/stations/{id}/upgrade - улучшение станции",
              "GET /api/v1/production/licenses - список лицензий игрока", "POST /api/v1/production/licenses/{id}/purchase
              - покупка лицензии", "GET /api/v1/production/accelerators - доступные
              ускорители", "POST /api/v1/production/orders/{id}/accelerator - применение
              ускорителя", "GET /api/v1/production/legendary/quests - квесты для легендарного
              крафта", "POST /api/v1/production/legendary/craft - запуск легендарного
              крафта"]}, {"name": "crafting-service", "location": "services/crafting-service",
              "responsibility": "Интеграция с системой крафта:\n- Выполнение этапов
              крафта\n- Управление рецептами\n- Обработка результатов крафта\n", "components":
              ["Crafting Integration Manager"], "endpoints": ["POST /api/v1/crafting/execute
              - выполнение крафта", "GET /api/v1/crafting/recipes/{id} - детали рецепта"]},
              {"name": "guild-service", "location": "services/guild-service", "responsibility":
              "Интеграция с гильдиями:\n- Гильдийное производство\n- Распределение
              ролей (добытчики, переработчики, крафтеры)\n- Кооперативное производство\n",
              "components": ["Guild Production Manager"], "endpoints": ["GET /api/v1/guilds/{id}/production
              - производство гильдии", "POST /api/v1/guilds/{id}/production/assign
              - назначение ролей"]}], "components": [{"name": "Production Chain Manager",
              "location": "production-service", "responsibility": "Управление производственными
              цепочками:\n- Создание и управление цепочками\n- Определение этапов
              производства\n- Валидация цепочек\n- Интеграция с рецептами\n", "methods":
              ["getChains(itemTier, itemType)", "getChainDetails(chainId)", "validateChain(chainId,
              playerId)", "calculateChainCost(chainId, quantity)"]}, {"name": "Production
              Stage Manager", "location": "production-service", "responsibility":
              "Управление этапами производства:\n- Выполнение этапов (добыча сырья,
              переработка, крафт)\n- Переходы между этапами\n- Валидация ресурсов
              для этапа\n- Обработка результатов этапа\n", "methods": ["executeStage(orderId,
              stageId)", "validateStageResources(stageId, resources)", "processStageResult(stageId,
              result)", "transitionToNextStage(orderId)"]}, {"name": "Station Manager",
              "location": "production-service", "responsibility": "Управление производственными
              станциями:\n- Управление станциями игрока\n- Улучшение станций\n- Проверка
              доступности станций\n- Резервирование станций\n", "methods": ["getStations(playerId)",
              "getStationDetails(stationId)", "upgradeStation(stationId, upgradeType)",
              "reserveStation(stationId, orderId)", "releaseStation(stationId, orderId)"]},
              {"name": "License Manager", "location": "production-service", "responsibility":
              "Управление лицензиями на производство:\n- Каталог лицензий\n- Покупка
              лицензий\n- Проверка наличия лицензий\n- Управление сроками действия
              лицензий\n", "methods": ["getLicenses(itemTier, itemType)", "purchaseLicense(playerId,
              licenseId)", "checkLicense(playerId, licenseId)", "renewLicense(licenseId)"]},
              {"name": "Resource Manager", "location": "production-service", "responsibility":
              "Управление ресурсами для производства:\n- Проверка наличия ресурсов\n-
              Резервирование ресурсов\n- Расход ресурсов\n- Интеграция с inventory-service\n",
              "methods": ["checkResources(playerId, resources)", "reserveResources(playerId,
              resources, orderId)", "consumeResources(orderId, resources)", "releaseResources(orderId,
              resources)"]}, {"name": "Bulk Production Manager", "location": "production-service",
              "responsibility": "Управление массовым производством:\n- Создание массовых
              заказов\n- Оптимизация времени и ресурсов\n- Управление производственными
              площадками\n- Сборочные линии\n", "methods": ["createBulkOrder(playerId,
              itemId, quantity)", "optimizeBulkProduction(orderId)", "getProductionLines(playerId)",
              "assignToProductionLine(orderId, lineId)"]}, {"name": "Accelerator Manager",
              "location": "production-service", "responsibility": "Управление ускорителями
              и rush-заказами:\n- Применение ускорителей (Efficiency Catalyst, Quality
              Enhancer, Material Optimizer)\n- Создание rush-заказов\n- Расчёт стоимости
              ускорения\n- Управление эффектами ускорителей\n", "methods": ["getAccelerators()",
              "applyAccelerator(orderId, acceleratorId)", "createRushOrder(orderId,
              rushOptions)", "calculateRushCost(orderId, timeReduction)", "getAcceleratorEffects(orderId)"]},
              {"name": "Legendary Craft Manager", "location": "production-service",
              "responsibility": "Управление легендарным крафтом:\n- Квестовые цепочки
              для легендарных предметов\n- Проверка требований (чертежи, мастерство,
              компоненты)\n- Доступ к легендарным кузням\n- Обработка высоких рисков
              провала\n", "methods": ["getLegendaryQuests(itemId)", "checkLegendaryRequirements(playerId,
              itemId)", "startLegendaryCraft(playerId, itemId, questChainId)", "processLegendaryResult(craftId,
              success)"]}, {"name": "Production Analytics Collector", "location":
              "analytics-service", "responsibility": "Сбор аналитики по производству:\n-
              Сбор метрик производства\n- Анализ прибыльности\n- Отчёты по производству\n-
              Интеграция с analytics-service\n", "methods": ["collectProductionMetrics(playerId,
              timeRange)", "analyzeProfitability(chainId, timeRange)", "generateProductionReport(playerId,
              timeRange)"]}], "data_flow": {"production_start": "1. Игрок выбирает
              производственную цепочку через Production Chain Manager\n2. Production
              Chain Manager валидирует цепочку и проверяет лицензии\n3. License Manager
              проверяет наличие необходимых лицензий\n4. Resource Manager проверяет
              наличие ресурсов\n5. Station Manager резервирует станцию\n6. Создаётся
              заказ на производство со статусом PENDING\n7. Событие публикуется в
              Event Bus (production.order.created)\n", "production_execution": "1.
              Production Stage Manager начинает выполнение первого этапа\n2. Resource
              Manager резервирует ресурсы для этапа\n3. Выполняется этап (добыча сырья,
              переработка, крафт)\n4. Обрабатывается результат этапа (успех/провал)\n5.
              При успехе: переход к следующему этапу\n6. При провале: обработка провала
              (потеря ресурсов, возможность повтора)\n7. Событие публикуется в Event
              Bus (production.stage.completed, production.stage.failed)\n", "production_completion":
              "1. Все этапы выполнены успешно\n2. Production Stage Manager завершает
              производство\n3. Resource Manager освобождает неиспользованные ресурсы\n4.
              Station Manager освобождает станцию\n5. Inventory Service получает готовый
              предмет\n6. Заказ переводится в статус COMPLETED\n7. Production Analytics
              Collector обновляет метрики\n8. Событие публикуется в Event Bus (production.order.completed)\n",
              "bulk_production": "1. Игрок создаёт массовый заказ через Bulk Production
              Manager\n2. Bulk Production Manager оптимизирует производство (экономия
              времени и ресурсов)\n3. Заказ распределяется по производственным линиям\n4.
              Параллельное выполнение этапов на разных линиях\n5. Сбор результатов
              и передача в inventory-service\n6. Событие публикуется в Event Bus (production.bulk.completed)\n",
              "rush_order": "1. Игрок создаёт rush-заказ через Accelerator Manager\n2.
              Accelerator Manager рассчитывает стоимость ускорения\n3. Игрок подтверждает
              rush-заказ (увеличение стоимости)\n4. Время производства сокращается\n5.
              Заказ выполняется с ускорением\n6. Событие публикуется в Event Bus (production.order.rushed)\n",
              "legendary_craft": "1. Игрок начинает квестовую цепочку для легендарного
              предмета\n2. Legendary Craft Manager проверяет требования (чертежи,
              мастерство, компоненты)\n3. Игрок выполняет квестовые этапы\n4. При
              выполнении всех требований: доступ к легендарной кузне\n5. Запускается
              производство с высоким риском провала\n6. Обрабатывается результат (успех/провал)\n7.
              Событие публикуется в Event Bus (production.legendary.crafted, production.legendary.failed)\n"},
              "integrations": {"with_crafting_service": "- Выполнение этапов крафта\n-
              Получение рецептов\n- Обработка результатов крафта\n", "with_guild_service":
              "- Гильдийное производство\n- Распределение ролей\n- Кооперативное производство\n",
              "with_inventory_service": "- Проверка наличия ресурсов\n- Резервирование
              ресурсов\n- Получение готовых предметов\n", "with_economy_service":
              "- Расчёт стоимости производства\n- Расчёт прибыльности\n- Интеграция
              с экономическими событиями\n", "with_quest_service": "- Квестовые цепочки
              для легендарных предметов\n- Интеграция с квестами производства\n"},
              "event_bus_events": {"published": ["production.order.created", "production.order.started",
              "production.stage.started", "production.stage.completed", "production.stage.failed",
              "production.order.completed", "production.order.failed", "production.order.cancelled",
              "production.bulk.created", "production.bulk.completed", "production.order.rushed",
              "production.accelerator.applied", "production.legendary.quest.started",
              "production.legendary.crafted", "production.legendary.failed"], "subscribed":
              ["economy.event.active (для влияния на стоимость производства)", "inventory.resource.updated
              (для проверки ресурсов)"]}, "database_schema": {"tables": [{"name":
              "production_chains", "description": "Производственные цепочки", "fields":
              [{"id": "UUID (PK)"}, {"name": "VARCHAR(255)"}, {"description": "TEXT"},
              {"item_tier": "INTEGER (1-5)"}, {"item_type": "VARCHAR(50) (weapon,
              cyberdeck, consumable, mod, etc.)"}, {"stages": "JSONB (массив этапов
              цепочки)"}, {"base_cost": "DECIMAL(10,2)"}, {"base_time_minutes": "INTEGER"},
              {"base_success_rate": "DECIMAL(5,2) (0.00-100.00)"}, {"required_licenses":
              "UUID[] (FK production_licenses)"}, {"created_at": "TIMESTAMP"}, {"updated_at":
              "TIMESTAMP"}], "indexes": ["item_tier, item_type", "name"]}, {"name":
              "production_orders", "description": "Заказы на производство", "fields":
              [{"id": "UUID (PK)"}, {"player_id": "UUID (FK accounts)"}, {"chain_id":
              "UUID (FK production_chains)"}, {"guild_id": "UUID (FK guilds, nullable)"},
              {"quantity": "INTEGER"}, {"status": "ENUM (pending, started, in_progress,
              completed, failed, cancelled)"}, {"current_stage": "INTEGER"}, {"total_stages":
              "INTEGER"}, {"total_cost": "DECIMAL(10,2)"}, {"actual_cost": "DECIMAL(10,2)"},
              {"estimated_time_minutes": "INTEGER"}, {"actual_time_minutes": "INTEGER
              (nullable)"}, {"success_rate": "DECIMAL(5,2)"}, {"is_rush": "BOOLEAN"},
              {"rush_cost_multiplier": "DECIMAL(3,2) (nullable)"}, {"is_bulk": "BOOLEAN"},
              {"bulk_efficiency": "DECIMAL(5,2) (nullable)"}, {"station_id": "UUID
              (FK production_stations, nullable)"}]}]}}}'
        - column:
            name: metadata
            value: '{"id": "economy-production-chains-system-architecture", "title":
              "Архитектура системы производственных цепочек", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-23T15:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "economy", "production",
              "crafting", "manufacturing"], "related_systems": ["economy-service",
              "crafting-service", "guild-service", "inventory-service"], "related_documents":
              [{"id": "mechanics-economy-production-chains", "relation": "extends"},
              {"id": "game-mechanics-systems-architecture", "relation": "extends"}],
              "github_issue": 232, "visibility": "internal", "audience": ["architect",
              "backend", "economy", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\economy-production-chains-system-architecture.yaml
