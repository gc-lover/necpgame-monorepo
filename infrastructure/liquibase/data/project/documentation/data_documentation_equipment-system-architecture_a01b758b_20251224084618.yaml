databaseChangeLog:
- changeSet:
    id: documentation-equipment-system-architecture-a01b758b
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-143581101478772'
        - column:
            name: doc_id
            value: equipment-system-architecture
        - column:
            name: title
            value: Архитектура системы оборудования
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-01 00:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - economy
            - equipment
            - catalog
            - iconic
            - procedural
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - economy-service
            - inventory-service
            - gameplay-service
            - narrative-service
        - column:
            name: related_documents
            value: '[{"id": "equipment-navigation", "relation": "implements"}, {"id":
              "equipment-catalog-manual", "relation": "implements"}, {"id": "equipment-iconic-timeline",
              "relation": "implements"}, {"id": "procedural-equipment-library", "relation":
              "implements"}, {"id": "procedural-equipment-matrix-architecture", "relation":
              "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - economy
            - api-designer
            - network
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "equipment-system-architecture", "title":
              "Архитектура системы оборудования", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-12-01T00:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "economy", "equipment",
              "catalog", "iconic", "procedural"], "related_systems": ["economy-service",
              "inventory-service", "gameplay-service", "narrative-service"], "related_documents":
              [{"id": "equipment-navigation", "relation": "implements"}, {"id": "equipment-catalog-manual",
              "relation": "implements"}, {"id": "equipment-iconic-timeline", "relation":
              "implements"}, {"id": "procedural-equipment-library", "relation": "implements"},
              {"id": "procedural-equipment-matrix-architecture", "relation": "extends"}],
              "github_issue": 62, "visibility": "internal", "audience": ["architect",
              "backend", "economy", "api-designer", "network"]}, "summary": {"problem":
              "Требуется спроектировать архитектуру системы оборудования, включающую:\n-
              Каталог оборудования (ручной срез ключевых предметов)\n- Временную линию
              культового оборудования (Iconic Equipment Timeline)\n- Процедурную библиотеку
              генерации оборудования\n- Интеграцию с inventory-service и economy-service\n",
              "goal": "Создать архитектурную схему системы оборудования с определением:\n-
              Компонентов для управления каталогом, временной линией и процедурной
              генерацией\n- REST, WebSocket и Event Bus контрактов\n- Синхронизации
              данных между слоями (Event Sourcing, CQRS)\n- Тикрейта и требований
              к сетевой нагрузке\n- Интеграций между компонентами\n- Структуры БД\n-
              Технического задания для реализации\n", "essence": "Объединенная архитектура
              системы оборудования, интегрирующая каталог, временную линию\nкультового
              оборудования и процедурную генерацию в единую систему.\n"}, "architecture":
              {"overview": "Архитектура системы оборудования состоит из следующих
              компонентов:\n1. Equipment Catalog Manager - управление каталогом оборудования\n2.
              Iconic Timeline Manager - управление временной линией культового оборудования\n3.
              Procedural Generator - процедурная генерация оборудования\n4. Equipment
              Matrix Manager - управление матрицей характеристик\n5. Equipment Analytics
              System - аналитика оборудования\n", "microservices": [{"name": "economy-service",
              "port": 8085, "responsibility": "Обработка системы оборудования:\n-
              Управление каталогом оборудования\n- Управление временной линией культового
              оборудования\n- Процедурная генерация оборудования\n- Управление матрицей
              характеристик\n- Аналитика оборудования\n", "components": [{"equipment-catalog-manager":
              "управление каталогом"}, {"iconic-timeline-manager": "управление временной
              линией"}, {"procedural-generator": "процедурная генерация"}, {"equipment-matrix-manager":
              "управление матрицей"}, {"equipment-analytics-system": "аналитика оборудования"}],
              "endpoints": ["GET /api/v1/economy/equipment/catalog - каталог оборудования",
              "GET /api/v1/economy/equipment/catalog/{id} - предмет из каталога",
              "GET /api/v1/economy/equipment/iconic/timeline - временная линия культового",
              "GET /api/v1/economy/equipment/iconic/{id} - культовый предмет", "POST
              /api/v1/economy/equipment/generate - процедурная генерация", "GET /api/v1/economy/equipment/matrix
              - матрица характеристик", "GET /api/v1/economy/equipment/analytics -
              аналитика оборудования"], "websocket_channels": ["wss://api.necp.game/v1/economy/equipment/catalog/{characterId}
              - обновления каталога", "wss://api.necp.game/v1/economy/equipment/iconic/{characterId}
              - обновления культового"], "events_published": [{"equipment.catalog.updated":
              "обновление каталога"}, {"equipment.iconic.unlocked": "разблокировка
              культового предмета"}, {"equipment.iconic.available": "культовый предмет
              доступен"}, {"equipment.generated": "генерация предмета"}, {"equipment.matrix-updated":
              "обновление матрицы"}], "events_subscribed": [{"inventory.item-added":
              "добавление предмета в инвентарь"}, {"world.event-triggered": "триггер
              мирового события"}, {"narrative.quest-completed": "завершение квеста"}]}],
              "data_synchronization": {"strategy": "Event Sourcing + CQRS", "event_store":
              "Все события системы оборудования сохраняются в Event Store:\n- equipment.catalog.updated\n-
              equipment.iconic.unlocked\n- equipment.iconic.available\n- equipment.generated\n-
              equipment.matrix-updated\n", "command_side": "Command Side (Write Model):\n-
              economy-service: обработка команд каталога, временной линии, генерации\n",
              "query_side": "Query Side (Read Model):\n- economy-service: получение
              каталога, временной линии, матрицы\n", "saga_pattern": "Saga Pattern
              для распределенных транзакций:\n- Iconic Unlock Saga: разблокировка
              культового → проверка условий → добавление в инвентарь\n- Equipment
              Generation Saga: генерация → проверка баланса → добавление в инвентарь\n",
              "consistency": {"strong_consistency": "Критичные операции требуют Strong
              Consistency:\n- Разблокировка культового оборудования\n- Генерация предметов\n-
              Обновление каталога\n", "eventual_consistency": "Не критичные операции
              допускают Eventual Consistency:\n- Поиск в каталоге\n- Аналитика оборудования\n-
              Временная линия (обновляется периодически)\n"}}, "tick_rate_and_network_load":
              {"catalog_operations": {"tick_rate": "on-demand", "protocol": "WebSocket
              (TCP)", "latency": "<100ms", "bandwidth": "~2-5 KB per operation", "optimization":
              "- Кэширование каталога\n- Ленивая загрузка деталей предметов\n"}, "iconic_timeline_updates":
              {"tick_rate": "on-demand (при разблокировке)", "protocol": "WebSocket
              (TCP)", "latency": "<100ms", "bandwidth": "~1-3 KB per update", "optimization":
              "- Кэширование временной линии\n- Периодические обновления доступности\n"},
              "procedural_generation": {"tick_rate": "on-demand", "protocol": "REST
              (HTTP)", "latency": "<200ms", "bandwidth": "~3-8 KB per generation",
              "optimization": "- Кэширование матрицы характеристик\n- Батчинг генерации
              для массовых операций\n"}}, "data_flows": {"catalog_flow": "1. Получение
              каталога: Client → economy-service → кэш → каталог\n2. Обновление каталога:
              economy-service → обновление БД → события → кэш\n", "iconic_timeline_flow":
              "1. Проверка доступности: economy-service → проверка условий → временная
              линия\n2. Разблокировка: economy-service → проверка условий → разблокировка
              → события\n3. Обновление доступности: economy-service → периодическая
              проверка → обновление\n", "procedural_generation_flow": "1. Генерация:
              Client → economy-service → матрица → генератор → предмет\n2. Валидация:
              economy-service → проверка баланса → предмет\n3. Сохранение: economy-service
              → сохранение в БД → события\n"}, "integrations": {"with_inventory_service":
              "- Добавление предметов в инвентарь\n- Проверка наличия предметов\n-
              Обновление инвентаря после генерации\n", "with_economy_service": "-
              Интеграция с торговлей\n- Интеграция с рынками\n- Интеграция с аукционами\n",
              "with_gameplay_service": "- Расчет характеристик предметов\n- Применение
              модификаторов\n- Синергии с имплантами\n", "with_narrative_service":
              "- Разблокировка культового оборудования через квесты\n- Интеграция
              с событиями мира\n"}}, "database": {"tables": [{"name": "equipment_catalog",
              "description": "Каталог оборудования", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"name": "VARCHAR(100)"}, {"category": "VARCHAR(50) (weapon,
              armor, cyberware, consumable)"}, {"brand": "VARCHAR(50)"}, {"rarity":
              "VARCHAR(20) (common, uncommon, rare, epic, legendary, iconic)"}, {"stats":
              "JSONB"}, {"signature": "TEXT"}, {"created_at": "TIMESTAMP"}, {"updated_at":
              "TIMESTAMP"}]}, {"name": "iconic_equipment_timeline", "description":
              "Временная линия культового оборудования", "columns": [{"id": "UUID
              PRIMARY KEY"}, {"equipment_id": "UUID REFERENCES equipment_catalog(id)"},
              {"era_start": "INTEGER (год начала эпохи)"}, {"era_end": "INTEGER (год
              конца эпохи)"}, {"unlock_conditions": "JSONB"}, {"availability": "VARCHAR(20)
              (always, seasonal, event, quest)"}, {"unlock_date": "TIMESTAMP"}, {"created_at":
              "TIMESTAMP"}]}, {"name": "iconic_unlocks", "description": "Разблокировки
              культового оборудования", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id":
              "UUID REFERENCES characters(id)"}, {"iconic_id": "UUID REFERENCES iconic_equipment_timeline(id)"},
              {"unlocked_at": "TIMESTAMP"}, {"unlock_method": "VARCHAR(50) (quest,
              event, purchase, drop)"}]}, {"name": "equipment_matrix", "description":
              "Матрица характеристик оборудования", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"brand": "VARCHAR(50)"}, {"category": "VARCHAR(50)"}, {"rarity":
              "VARCHAR(20)"}, {"stat_pools": "JSONB"}, {"modifiers": "JSONB"}, {"version":
              "INTEGER"}, {"updated_at": "TIMESTAMP"}]}, {"name": "generated_equipment",
              "description": "Процедурно сгенерированное оборудование", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"seed": "BIGINT"}, {"brand": "VARCHAR(50)"},
              {"category": "VARCHAR(50)"}, {"rarity": "VARCHAR(20)"}, {"stats": "JSONB"},
              {"generated_at": "TIMESTAMP"}]}], "indexes": [{"table": "equipment_catalog",
              "columns": ["category", "brand", "rarity"]}, {"table": "iconic_equipment_timeline",
              "columns": ["equipment_id", "era_start", "era_end"]}, {"table": "iconic_unlocks",
              "columns": ["character_id", "iconic_id"]}, {"table": "equipment_matrix",
              "columns": ["brand", "category", "rarity"]}, {"table": "generated_equipment",
              "columns": ["seed", "brand", "category"]}]}, "subtasks": [{"id": "equipment-catalog-manager",
              "title": "Equipment Catalog Manager", "description": "Управление каталогом
              оборудования", "effort_days": 3, "dependencies": []}, {"id": "iconic-timeline-manager",
              "title": "Iconic Timeline Manager", "description": "Управление временной
              линией культового оборудования", "effort_days": 4, "dependencies": ["equipment-catalog-manager"]},
              {"id": "procedural-generator-integration", "title": "Procedural Generator
              Integration", "description": "Интеграция процедурной генерации", "effort_days":
              3, "dependencies": ["equipment-catalog-manager"]}, {"id": "equipment-matrix-manager",
              "title": "Equipment Matrix Manager", "description": "Управление матрицей
              характеристик", "effort_days": 3, "dependencies": []}, {"id": "equipment-analytics-system",
              "title": "Equipment Analytics System", "description": "Аналитика оборудования",
              "effort_days": 2, "dependencies": ["equipment-catalog-manager"]}, {"id":
              "inventory-integration", "title": "Inventory Integration", "description":
              "Интеграция с inventory-service", "effort_days": 3, "dependencies":
              ["equipment-catalog-manager", "iconic-timeline-manager"]}, {"id": "economy-integration",
              "title": "Economy Integration", "description": "Интеграция с economy-service",
              "effort_days": 2, "dependencies": ["equipment-catalog-manager"]}, {"id":
              "gameplay-integration", "title": "Gameplay Integration", "description":
              "Интеграция с gameplay-service", "effort_days": 2, "dependencies": ["equipment-matrix-manager"]},
              {"id": "narrative-integration", "title": "Narrative Integration", "description":
              "Интеграция с narrative-service для разблокировки культового", "effort_days":
              2, "dependencies": ["iconic-timeline-manager"]}], "total_estimated_effort":
              "24 days", "diagrams": {"component_diagram": "```mermaid\ngraph TB\n    subgraph
              \"Economy Service\"\n        ECM[Equipment Catalog Manager]\n        ITM[Iconic
              Timeline Manager]\n        PG[Procedural Generator]\n        EMM[Equipment
              Matrix Manager]\n        EAS[Equipment Analytics System]\n    end\n\n    subgraph
              \"Database\"\n        DB[(PostgreSQL<br/>equipment_catalog<br/>iconic_equipment_timeline<br/>iconic_unlocks<br/>equipment_matrix<br/>generated_equipment)]\n    end\n\n    subgraph
              \"External Services\"\n        IS[Inventory Service]\n        ES[Economy
              Service]\n        GS[Gameplay Service]\n        NS[Narrative Service]\n        RG[Realtime
              Gateway]\n        EB[Event Bus]\n    end\n\n    subgraph \"Client\"\n        CL[UE5
              Client]\n    end\n\n    CL -->|API requests| ECM\n    CL -->|API requests|
              ITM\n    CL -->|API requests| PG\n    CL -->|API requests| EMM\n\n    ECM
              -->|store| DB\n    ITM -->|store| DB\n    PG -->|store| DB\n    EMM
              -->|store| DB\n\n    ECM -->|add items| IS\n    ITM -->|unlock items|
              IS\n    PG -->|generate items| IS\n    ECM -->|trade| ES\n    EMM -->|calculate
              stats| GS\n    ITM -->|quest unlock| NS\n\n    ECM -->|events| EB\n    ITM
              -->|events| EB\n    PG -->|events| EB\n    EMM -->|events| EB\n\n    EB
              -->|push| RG\n    RG -->|updates| CL\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "equipment-system-architecture", "title": "Архитектура
              системы оборудования", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-12-01T00:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "economy", "equipment", "catalog", "iconic",
              "procedural"], "related_systems": ["economy-service", "inventory-service",
              "gameplay-service", "narrative-service"], "related_documents": [{"id":
              "equipment-navigation", "relation": "implements"}, {"id": "equipment-catalog-manual",
              "relation": "implements"}, {"id": "equipment-iconic-timeline", "relation":
              "implements"}, {"id": "procedural-equipment-library", "relation": "implements"},
              {"id": "procedural-equipment-matrix-architecture", "relation": "extends"}],
              "github_issue": 62, "visibility": "internal", "audience": ["architect",
              "backend", "economy", "api-designer", "network"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\equipment-system-architecture.yaml
