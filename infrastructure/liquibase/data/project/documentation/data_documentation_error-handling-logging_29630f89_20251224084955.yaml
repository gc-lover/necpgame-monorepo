databaseChangeLog:
- changeSet:
    id: documentation-error-handling-logging-29630f89
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-820763588207259'
        - column:
            name: doc_id
            value: infrastructure-error-handling-logging
        - column:
            name: title
            value: Error Handling & Logging
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: infrastructure
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-07 00:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "infrastructure_lead", "contact": "infrastructure@necp.game"}]'
        - column:
            name: tags
            value:
            - logging
            - monitoring
            - error-handling
        - column:
            name: topics
            value:
            - observability
            - platform
        - column:
            name: related_systems
            value:
            - monitoring-service
            - logging-stack
        - column:
            name: related_documents
            value: '[{"id": "infrastructure-api-gateway-architecture", "relation":
              "references"}, {"id": "infrastructure-database-architecture", "relation":
              "references"}]'
        - column:
            name: source
            value: shared/docs/knowledge/implementation/infrastructure/error-handling-logging.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - infrastructure
            - devops
            - backend
        - column:
            name: risk_level
            value: high
        - column:
            name: content
            value: '{"metadata": {"id": "infrastructure-error-handling-logging", "title":
              "Error Handling & Logging", "document_type": "implementation", "category":
              "infrastructure", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-07T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at":
              "", "owners": [{"role": "infrastructure_lead", "contact": "infrastructure@necp.game"}],
              "tags": ["logging", "monitoring", "error-handling"], "topics": ["observability",
              "platform"], "related_systems": ["monitoring-service", "logging-stack"],
              "related_documents": [{"id": "infrastructure-api-gateway-architecture",
              "relation": "references"}, {"id": "infrastructure-database-architecture",
              "relation": "references"}], "source": "shared/docs/knowledge/implementation/infrastructure/error-handling-logging.md",
              "visibility": "internal", "audience": ["infrastructure", "devops", "backend"],
              "risk_level": "high"}, "review": {"chain": [{"role": "infrastructure_lead",
              "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions":
              []}, "summary": {"problem": "Логи и ошибки разбросаны по сервисам, отсутствует
              централизованная стратегия наблюдаемости и оповещений.", "goal": "Описать
              целевую архитектуру обработки ошибок и логирования для микросервисов
              NECPGAME.", "essence": "Документ задаёт стек ELK, distributed tracing,
              структуру логов, SLA по уровням логирования, мониторинг, алертинг и
              принципы клиентских/серверных ответов.", "key_points": ["Централизованное
              хранение логов через ELK и трассировка запросов по trace_id.", "Единые
              уровни логирования и формат JSON с обязательными полями.", "Разделение
              ошибок на клиентские и серверные с стандартизированными payload.", "Метрики,
              алерты и инструменты мониторинга, включая Prometheus, Grafana, Sentry."]},
              "content": {"sections": [{"id": "architecture_overview", "title": "Микросервисная
              архитектура", "body": "Централизованная система основана на стеке ELK:
              микросервисы отправляют логи в Logstash, который передаёт\nзаписи в
              Elasticsearch, а визуализация и поиск выполняются в Kibana. Все сервисы
              (auth, character, gameplay,\nsocial, economy, world) публикуют структурированные
              события.\n\nДля распределённых запросов применяется трассировка (Zipkin/Jaeger).
              Клиентский запрос получает trace_id в API\nGateway и передаёт его по
              цепочке сервисов. Все логи с одинаковым trace_id позволяют восстановить
              путь запроса.\n", "mechanics_links": []}, {"id": "logging_levels", "title":
              "Уровни и политика логирования", "body": "Иерархия уровней: TRACE, DEBUG,
              INFO, WARN, ERROR, FATAL. В production включены только INFO и выше.
              DEBUG/TRACE\nиспользуются локально для отладки. Для каждого сервиса
              определяется политика хранения и ротации.\n", "mechanics_links": []},
              {"id": "log_structure", "title": "Формат логов", "body": "Логи сериализуются
              в JSON и содержат timestamp, уровень, сервис, trace_id, player_id, message,
              описание ошибки\nи контекст. Формат унифицирован для анализа и интеграции
              со сторонними инструментами.\n", "mechanics_links": []}, {"id": "error_handling",
              "title": "Ответы об ошибках", "body": "Клиентские ошибки (400) возвращают
              структурированное тело с кодом, сообщением и полем. Серверные ошибки
              (500)\nскрывают детали внутренней реализации и включают trace_id для
              диагностики. Запрещено раскрывать стек трейс клиенту.\n", "mechanics_links":
              []}, {"id": "monitoring", "title": "Мониторинг и метрики", "body": "Метрические
              показатели включают request rate, error rate, латентность p50/p95/p99.
              Пороговые значения (например,\nerror rate > 1%) инициируют алерты. Используются
              Prometheus для метрик, Grafana для дашбордов, Sentry для\nотслеживания
              ошибок и Elastic Stack для логов.\n", "mechanics_links": []}, {"id":
              "alerting", "title": "Алерты и реагирование", "body": "Алерты настраиваются
              для ключевых порогов (ошибки, недоступность БД, деградация latency).
              Уведомления отправляются\nв Slack, по email и в PagerDuty. Для критических
              инцидентов предусмотрены телефонные вызовы on-call инженерам.\n", "mechanics_links":
              []}]}, "appendix": {"glossary": [], "references": [], "decisions": []},
              "implementation": {"github_issue": 136, "needs_task": false, "queue_reference":
              ["shared/trackers/queues/concept/queued.yaml"], "blockers": []}, "history":
              [{"version": "1.0.0", "date": "2025-11-06", "author": "infrastructure_lead",
              "changes": "Стартовое описание централизованной системы обработки ошибок
              и логирования."}], "validation": {"checksum": "", "schema_version":
              "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "infrastructure-error-handling-logging", "title": "Error
              Handling & Logging", "document_type": "implementation", "category":
              "infrastructure", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-07T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at":
              "", "owners": [{"role": "infrastructure_lead", "contact": "infrastructure@necp.game"}],
              "tags": ["logging", "monitoring", "error-handling"], "topics": ["observability",
              "platform"], "related_systems": ["monitoring-service", "logging-stack"],
              "related_documents": [{"id": "infrastructure-api-gateway-architecture",
              "relation": "references"}, {"id": "infrastructure-database-architecture",
              "relation": "references"}], "source": "shared/docs/knowledge/implementation/infrastructure/error-handling-logging.md",
              "visibility": "internal", "audience": ["infrastructure", "devops", "backend"],
              "risk_level": "high"}'
        - column:
            name: source_file
            value: knowledge\implementation\infrastructure\error-handling-logging.yaml
