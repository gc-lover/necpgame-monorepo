databaseChangeLog:
- changeSet:
    id: documentation-faction-analytics-balance-0988dd56
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '1905181888070834'
        - column:
            name: doc_id
            value: implementation-analytics-faction-balance
        - column:
            name: title
            value: Faction Analytics & Balance — Метрики и авто-тюнинг
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: analytics
        - column:
            name: status
            value: approved
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-08 12:20:00+00:00
        - column:
            name: concept_approved
            value: true
        - column:
            name: concept_reviewed_at
            value: 2025-11-08 12:20:00+00:00
        - column:
            name: owners
            value: '[{"role": "analytics_lead", "contact": "analytics@necp.game"}]'
        - column:
            name: tags
            value:
            - analytics
            - factions
            - balance
        - column:
            name: topics
            value:
            - analytics
            - world
        - column:
            name: related_systems
            value:
            - analytics-service
            - world-service
            - economy-service
            - social-service
        - column:
            name: related_documents
            value: '[{"id": "implementation-analytics-dashboard-overview", "relation":
              "references"}, {"id": "mechanics-world-events-framework", "relation":
              "supports"}]'
        - column:
            name: source
            value: shared/docs/knowledge/implementation/analytics/faction-analytics-balance.yaml
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - analytics
            - backend
            - live-ops
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "implementation-analytics-faction-balance",
              "title": "Faction Analytics & Balance — Метрики и авто-тюнинг", "document_type":
              "implementation", "category": "analytics", "status": "approved", "version":
              "1.0.0", "last_updated": "2025-11-08T12:20:00+00:00", "concept_approved":
              true, "concept_reviewed_at": "2025-11-08T12:20:00+00:00", "owners":
              [{"role": "analytics_lead", "contact": "analytics@necp.game"}], "tags":
              ["analytics", "factions", "balance"], "topics": ["analytics", "world"],
              "related_systems": ["analytics-service", "world-service", "economy-service",
              "social-service"], "related_documents": [{"id": "implementation-analytics-dashboard-overview",
              "relation": "references"}, {"id": "mechanics-world-events-framework",
              "relation": "supports"}], "source": "shared/docs/knowledge/implementation/analytics/faction-analytics-balance.yaml",
              "visibility": "internal", "audience": ["analytics", "backend", "live-ops"],
              "risk_level": "medium"}, "review": {"chain": [{"role": "analytics_lead",
              "reviewer": "", "reviewed_at": "2025-11-08T12:20:00+00:00", "status":
              "approved"}], "next_actions": []}, "summary": {"problem": "Требуется
              единый документ с метриками и правилами авто-тюнинга для фракционных
              систем, чтобы синхронизировать сервисы и dashboard.", "goal": "Описать
              целевые метрики, алгоритмы авто-настройки, REST/WS контуры и схемы данных
              для analytics-service.", "essence": "Документ задаёт показатели эффективности
              фракций, триггеры автоматических правок и структуру данных для хранения
              и мониторинга.", "key_points": ["Метрики охватывают контракты, рейды,
              экономику, климат и социальные деревья.", "Авто-тюнинг использует пороговые
              значения для корректировки сложности, наград и world flags.", "REST/WS
              интерфейсы и SQL-схемы определены для реализации analytics-service."]},
              "content": {"sections": [{"id": "goals", "title": "Цели", "body": "Документ
              фиксирует цели аналитики фракций: определение ключевых метрик, настройка
              авто-тюнинга наград и сложности,\nобеспечение наблюдаемости через REST
              и WebSocket контуры. Интеграции охватывают raids, contracts, economy
              и\nsocial-service.\n", "mechanics_links": ["implementation/analytics/dashboard-overview.yaml",
              "mechanics/world/events/world-events-framework.yaml"], "assets": []},
              {"id": "metrics", "title": "Ключевые метрики", "body": "| Метрика |
              Описание | Источник | Использование |\n| --- | --- | --- | --- |\n|
              contractSuccessRate | Успешность этапов контрактов | world-service contracts
              | Тюнинг порогов репутации |\n| branchPreferenceIndex | Распределение
              выборов веток | social-service decisions | Планирование событий |\n|
              raidClearTime | Среднее время рейдов | raids telemetry | Корректировка
              HP/урона |\n| ecoAssetVelocity | Скорость оборота активов | economy-service
              | Баланс цен и налогов |\n| legacyImpactScore | Влияние исторических
              событий | history subsystem | Seasonal rotation |\n| affinityGrowthRate
              | Рост привязанности | social-service dialogues | Настройка требований
              |\n| climateStabilityIndex | Контролируемость погоды | world climate
              | Управление окнами Badlands |\n| metanetComplianceRate | Решения трибуналов
              | analytics-service logs | Допуск ИИ |\n", "mechanics_links": ["implementation/analytics/data-pipeline-overview.yaml",
              "mechanics/economy/economy-analytics.yaml"], "assets": []}, {"id": "autotune",
              "title": "Авто-тюнинг", "body": "- **Контракты:** при contractSuccessRate
              > 0.8 повышать требования репутации на 5%, при < 0.4 снижать.\n- **Рейды:**
              raidClearTime сравнивается с целевым диапазоном, отклонения корректируются
              через `/world/raids/{id}/balance`.\n- **Экономика:** ecoAssetVelocity
              > 1.5 — повышать налог, < 0.7 — снижать.\n- **История:** низкий legacyImpactScore
              активирует дополнительные historical events.\n- **Социальные линии:**
              высокий affinityGrowthRate повышает стоимость ключевых выборов.\n- **Климат:**
              climateStabilityIndex < 0.5 усиливает бури, > 0.8 снижает награды.\n-
              **Metanet:** metanetComplianceRate > 0.75 открывает больше ИИ-сервисов,
              < 0.4 вводит ограничения.\n", "mechanics_links": ["mechanics/world/world-state/world-bosses-catalog.yaml",
              "mechanics/social/player-orders-system.yaml"], "assets": []}, {"id":
              "interfaces", "title": "REST и WebSocket контуры", "body": "| Endpoint
              | Метод | Назначение |\n| --- | --- | --- |\n| /analytics/factions/metrics
              | GET | Агрегированные метрики |\n| /analytics/factions/metrics/{metricId}
              | GET | Детализация по времени |\n| /analytics/factions/autotune | POST
              | Применение изменений |\n| /analytics/factions/alerts | GET | Пороговые
              события для GM |\n\nWebSocket `wss://api.necp.game/v1/analytics/factions`
              транслирует события MetricUpdate, AutotuneApplied и AlertRaised\nдля
              dashboard.\n", "mechanics_links": ["implementation/api/api-gateway-overview.yaml",
              "implementation/analytics/dashboard-ws.yaml"], "assets": []}, {"id":
              "schema", "title": "Схемы данных", "body": "```sql\nCREATE TABLE faction_metrics
              (\n    metric_id VARCHAR(64) PRIMARY KEY,\n    faction_id VARCHAR(64)
              NOT NULL,\n    metric_name VARCHAR(64) NOT NULL,\n    value NUMERIC(12,4)
              NOT NULL,\n    time_bucket TIMESTAMPTZ NOT NULL,\n    metadata JSONB,\n    created_at
              TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE faction_autotune_actions
              (\n    action_id UUID PRIMARY KEY,\n    metric_id VARCHAR(64) NOT NULL,\n    previous_value
              NUMERIC(12,4) NOT NULL,\n    new_value NUMERIC(12,4) NOT NULL,\n    applied_at
              TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    applied_by VARCHAR(64)
              NOT NULL,\n    notes TEXT\n);\n```\n", "mechanics_links": ["implementation/backend/data-modeling-guidelines.yaml"],
              "assets": []}, {"id": "readiness", "title": "Готовность", "body": "Метрики
              и правила авто-тюнинга описаны, интеграции с сервисами определены. Документ
              готов к реализации в\nanalytics-service и world-service и служит основой
              для dashboard.\n", "mechanics_links": ["implementation/analytics/dashboard-overview.yaml"],
              "assets": []}]}, "appendix": {"glossary": [], "references": [{"title":
              "Analytics Service Specification", "link": "../service-spec/analytics-service.yaml"},
              {"title": "World Events Integration", "link": "../../../mechanics/world/events/world-events-framework.yaml"}],
              "decisions": []}, "implementation": {"github_issue": 136, "needs_task":
              false, "queue_reference": ["shared/trackers/queues/api/queued.yaml"],
              "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-11-11",
              "author": "analytics_team", "changes": "Конвертирован документ аналитики
              и авто-тюнинга фракций в YAML."}], "validation": {"checksum": "", "schema_version":
              "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "implementation-analytics-faction-balance", "title": "Faction
              Analytics & Balance — Метрики и авто-тюнинг", "document_type": "implementation",
              "category": "analytics", "status": "approved", "version": "1.0.0", "last_updated":
              "2025-11-08T12:20:00+00:00", "concept_approved": true, "concept_reviewed_at":
              "2025-11-08T12:20:00+00:00", "owners": [{"role": "analytics_lead", "contact":
              "analytics@necp.game"}], "tags": ["analytics", "factions", "balance"],
              "topics": ["analytics", "world"], "related_systems": ["analytics-service",
              "world-service", "economy-service", "social-service"], "related_documents":
              [{"id": "implementation-analytics-dashboard-overview", "relation": "references"},
              {"id": "mechanics-world-events-framework", "relation": "supports"}],
              "source": "shared/docs/knowledge/implementation/analytics/faction-analytics-balance.yaml",
              "visibility": "internal", "audience": ["analytics", "backend", "live-ops"],
              "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\implementation\analytics\faction-analytics-balance.yaml
