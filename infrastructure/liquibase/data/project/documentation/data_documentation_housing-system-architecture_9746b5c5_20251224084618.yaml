databaseChangeLog:
- changeSet:
    id: documentation-housing-system-architecture-9746b5c5
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-874760367117188'
        - column:
            name: doc_id
            value: housing-system-architecture
        - column:
            name: title
            value: Архитектура системы жилья (Housing System)
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.1.0
        - column:
            name: last_updated
            value: 2025-11-30 20:35:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - housing
            - backend
            - social
            - customization
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - world-service-go
            - economy-service-go
            - social-service-go
        - column:
            name: related_documents
            value: '[{"id": "backend-housing-system", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "housing-system-architecture", "title": "Архитектура
              системы жилья (Housing System)", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.1.0", "last_updated": "2025-11-30T20:35:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "housing", "backend", "social", "customization"],
              "related_systems": ["world-service-go", "economy-service-go", "social-service-go"],
              "related_documents": [{"id": "backend-housing-system", "relation": "extends"}],
              "github_issue": 299, "visibility": "internal", "audience": ["architect",
              "backend", "api-designer"]}, "summary": {"problem": "Требуется спроектировать
              полную техническую архитектуру системы жилья\nдля управления квартирами,
              мебелью, престижем, функциональными бонусами\nи посещениями для player
              engagement.\n", "goal": "Создать архитектурную схему системы жилья с
              определением:\n- Компонентов системы (микросервисы, модули)\n- API endpoints
              (высокоуровнево)\n- Потоков данных и интеграций\n- Системы покупки жилья\n-
              Системы размещения мебели\n- Системы престижа\n- Системы функциональных
              бонусов\n- Технического задания для реализации\n", "essence": "Игровая
              система жилья для управления квартирами, мебелью, престижем\nи функциональными
              бонусами для player engagement.\n"}, "architecture": {"overview": "Система
              жилья состоит из восьми основных компонентов:\n1. Apartment Manager
              - управление квартирами\n2. Furniture Manager - управление мебелью\n3.
              Furniture Placement System - система размещения мебели\n4. Prestige
              Calculator - расчёт престижа\n5. Functional Bonus Aggregator - агрегация
              функциональных бонусов\n6. Visit Manager - управление посещениями\n7.
              Housing Event Handler - обработка событий\n8. Housing Shop Manager -
              управление магазином мебели\n", "components": [{"name": "Apartment Manager",
              "location": "world-service-go (модуль housing)", "responsibility": "-
              Управление квартирами игроков\n- Покупка квартир\n- Выбор локации\n-
              Управление настройками доступа\n- Интеграция с economy service\n", "apartment_types":
              "- STUDIO: студия (50,000 eddies, 20 слотов мебели)\n- STANDARD: стандартная
              квартира (200,000 eddies, 40 слотов)\n- PENTHOUSE: пентхаус (1,000,000
              eddies, 80 слотов, вертолётная площадка)\n- GUILD_HALL: гильдейский
              зал (5,000,000 eddies из гильдейского банка, 200 слотов)\n", "access_settings":
              "- PRIVATE: приватная квартира\n- FRIENDS_ONLY: только для друзей\n-
              PUBLIC: публичная квартира\n- GUILD_ONLY: только для гильдии\n", "endpoints":
              ["GET /api/v1/world/housing/apartments/available - доступные квартиры",
              "POST /api/v1/world/housing/apartments/purchase - покупка квартиры",
              "GET /api/v1/world/housing/apartments/{apartment_id} - информация о
              квартире", "POST /api/v1/world/housing/apartments/{apartment_id}/settings
              - настройки доступа"]}, {"name": "Furniture Manager", "location": "world-service-go
              (модуль housing-furniture)", "responsibility": "- Управление мебелью\n-
              Каталог мебели\n- Покупка мебели\n- Хранение мебели\n- Интеграция с
              economy service\n", "furniture_categories": "- DECORATIVE: декоративные
              предметы (постеры, растения, неон, ковры, арт)\n- FUNCTIONAL: функциональные
              бонусы (крафт-столы, регенерация, стойки оружия)\n- COMFORT: комфорт
              (кровати, диваны, кресла, столы)\n- STORAGE: хранилища (шкафы, сейфы,
              оружейные шкафы)\n", "furniture_properties": "- Престиж\n- Функциональные
              бонусы\n- Размер (слоты)\n- Уникальность\n", "endpoints": ["GET /api/v1/world/housing/furniture/catalog
              - каталог мебели", "POST /api/v1/world/housing/furniture/purchase -
              покупка мебели", "GET /api/v1/world/housing/furniture/owned/{player_id}
              - мебель игрока"]}, {"name": "Furniture Placement System", "location":
              "world-service-go (модуль housing-placement)", "responsibility": "-
              Размещение мебели в квартирах\n- Позиционирование мебели\n- Трансформации
              мебели (позиция, поворот, масштаб)\n- Валидация размещения\n- Проверка
              лимитов слотов\n", "placement_features": "- 3D позиционирование\n- Поворот
              мебели\n- Масштабирование\n- Проверка коллизий\n- Проверка лимитов\n",
              "validation_rules": "- Проверка доступных слотов\n- Проверка коллизий
              с другими предметами\n- Проверка границ квартиры\n", "endpoints": ["POST
              /api/v1/world/housing/apartments/{apartment_id}/furniture/place - размещение
              мебели", "POST /api/v1/world/housing/apartments/{apartment_id}/furniture/{furniture_id}/move
              - перемещение мебели", "POST /api/v1/world/housing/apartments/{apartment_id}/furniture/{furniture_id}/remove
              - удаление мебели"]}, {"name": "Prestige Calculator", "location": "world-service-go
              (модуль housing-prestige)", "responsibility": "- Расчёт престижа квартиры\n-
              Агрегация очков престижа\n- Обновление рейтинга\n- Интеграция с leaderboard\n",
              "prestige_sources": "- Базовый престиж типа квартиры\n- Очки за мебель\n-
              Бонусы за локацию\n- Бонусы за уникальные предметы\n", "prestige_formula":
              "- Базовый престиж квартиры\n- Сумма престижа мебели\n- Множитель локации\n-
              Бонус за уникальность\n", "endpoints": ["GET /api/v1/world/housing/apartments/{apartment_id}/prestige
              - престиж квартиры", "GET /api/v1/world/housing/prestige/leaderboard
              - лидерборд престижа"]}, {"name": "Functional Bonus Aggregator", "location":
              "world-service-go (модуль housing-bonuses)", "responsibility": "- Агрегация
              функциональных бонусов мебели\n- Расчёт бонусов к характеристикам\n-
              Применение бонусов к игроку\n- Интеграция с character service\n", "bonus_types":
              "- CRAFT_SPEED: скорость крафта\n- STORAGE_SLOTS: слоты хранилища\n-
              HUMANITY_REGENERATION: регенерация человечности\n- WEAPON_STORAGE: хранение
              оружия\n", "bonus_aggregation": "- Суммирование бонусов от всех размещённых
              предметов\n- Применение к характеристикам игрока\n- Обновление при изменении
              мебели\n", "endpoints": ["GET /api/v1/world/housing/apartments/{apartment_id}/bonuses
              - бонусы квартиры", "GET /api/v1/world/housing/player/{player_id}/bonuses
              - бонусы игрока"]}, {"name": "Visit Manager", "location": "world-service-go
              (модуль housing-visits)", "responsibility": "- Управление посещениями
              квартир\n- Проверка доступа\n- Загрузка состояния квартиры\n- Трекинг
              посещений\n- Уведомления владельца\n", "visit_features": "- Проверка
              настроек доступа\n- Загрузка состояния квартиры\n- Трекинг визитов\n-
              Уведомления владельцу\n- История посещений\n", "endpoints": ["POST /api/v1/world/housing/apartments/{apartment_id}/visit
              - посещение квартиры", "GET /api/v1/world/housing/apartments/{apartment_id}/visits
              - история посещений", "GET /api/v1/world/housing/player/{player_id}/visits
              - посещения игрока"]}, {"name": "Housing Event Handler", "location":
              "world-service-go (модуль housing-events)", "responsibility": "- Обработка
              событий жилья\n- Публикация событий в event bus\n- Подписка на события
              от других систем\n- Уведомления игроков\n", "housing_events_published":
              "- housing:apartment-purchased\n- housing:furniture-placed\n- housing:furniture-removed\n-
              housing:prestige-updated\n- housing:apartment-visited\n", "housing_events_consumed":
              "- character:level-up\n- guild:member-joined\n- friend:added\n", "endpoints":
              ["GET /api/v1/world/housing/events/{apartment_id} - события квартиры"]},
              {"name": "Housing Shop Manager", "location": "world-service-go (модуль
              housing-shop)", "responsibility": "- Управление магазином мебели\n-
              Каталог мебели\n- Фильтрация и поиск\n- Покупка мебели\n- Интеграция
              с economy service\n", "shop_features": "- Каталог с фильтрацией\n- Поиск
              по категориям\n- Просмотр деталей\n- Покупка мебели\n", "endpoints":
              ["GET /api/v1/world/housing/shop/catalog - каталог магазина", "GET /api/v1/world/housing/shop/furniture/{furniture_id}
              - детали мебели", "POST /api/v1/world/housing/shop/purchase - покупка
              мебели"]}], "data_flow": {"apartment_purchase": "1. Игрок выбирает тип
              квартиры и локацию\n2. Apartment Manager проверяет доступность\n3. Economy
              Service проверяет наличие средств\n4. Economy Service списывает валюту\n5.
              Создаётся запись квартиры\n6. Housing Event Handler публикует housing:apartment-purchased\n7.
              Notification Service уведомляет игрока\n8. Realtime Gateway синхронизирует
              состояние\n", "furniture_placement": "1. Игрок выбирает мебель для размещения\n2.
              Furniture Placement System проверяет доступные слоты\n3. Проверяются
              коллизии и границы\n4. Мебель размещается в квартире\n5. Prestige Calculator
              пересчитывает престиж\n6. Functional Bonus Aggregator обновляет бонусы\n7.
              Housing Event Handler публикует housing:furniture-placed\n8. Realtime
              Gateway синхронизирует изменения\n", "apartment_visit": "1. Игрок запрашивает
              посещение квартиры\n2. Visit Manager проверяет настройки доступа\n3.
              Если доступ разрешён - загружается состояние квартиры\n4. Трекится посещение\n5.
              Housing Event Handler публикует housing:apartment-visited\n6. Notification
              Service уведомляет владельца\n7. Realtime Gateway синхронизирует состояние\n"},
              "integrations": {"with_economy_service": "- Покупка квартир и мебели\n-
              Списание валюты\n- Интеграция с экономической системой\n", "with_social_service":
              "- Проверка друзей для доступа\n- Интеграция с системой друзей\n- Уведомления
              о посещениях\n", "with_guild_service": "- Покупка гильдейских залов\n-
              Проверка членства в гильдии\n- Интеграция с гильдиями\n", "with_character_service":
              "- Применение функциональных бонусов\n- Обновление характеристик\n-
              Интеграция с персонажем\n", "with_leaderboard_service": "- Лидерборд
              престижа\n- Обновление рейтингов\n- Интеграция с лидербордами\n", "with_notification_service":
              "- Уведомления о покупках\n- Уведомления о посещениях\n- Уведомления
              о престиже\n", "with_realtime_gateway": "- Синхронизация состояния квартир\n-
              Уведомления о событиях\n- Обновления в реальном времени\n"}, "data_consistency":
              {"strategy": "Strong Consistency (ACID транзакции) для критичных операций",
              "mechanisms": ["ACID транзакции для покупки квартир, размещения мебели,
              расчёта престижа и применения бонусов", "Оптимистичные блокировки (versioning)
              для предотвращения конфликтов", "Валидация перед покупкой квартиры и
              размещением мебели", "Синхронизация с другими сервисами через Event
              Bus", "Outbox Pattern для гарантированной доставки событий", "Saga Pattern
              для распределенных операций (покупка квартиры, размещение мебели, применение
              бонусов)"]}, "data_synchronization": {"event_sourcing": "Все изменения
              состояния жилья (покупка квартиры, размещение мебели, удаление мебели,\nобновление
              престижа, применение бонусов, посещение квартиры) записываются как события
              в Event Store.\nЭто обеспечивает полный аудит, возможность восстановления
              состояния и \"time travel\" для отладки.\nПримеры событий: ApartmentPurchasedEvent,
              FurniturePlacedEvent, FurnitureRemovedEvent, PrestigeUpdatedEvent, BonusAppliedEvent,
              ApartmentVisitedEvent.\n", "cqrs_pattern": "Разделение команд (покупка
              квартиры, размещение мебели, применение бонусов) и запросов\n(получение
              информации о квартире, получение каталога мебели, получение престижа)
              для оптимизации производительности\nи масштабируемости. Read-модели
              могут быть кэшированы в Redis для быстрых запросов.\n", "saga_pattern":
              "Для распределенных транзакций, таких как покупка квартиры (проверка
              средств, списание валюты,\nсоздание квартиры, уведомление игрока) или
              размещение мебели (проверка слотов, размещение мебели,\nпересчёт престижа,
              обновление бонусов, уведомление игрока), используется Saga Pattern\nдля
              обеспечения атомарности операций между World Service, Economy Service,
              Character Service и Notification Service.\n", "outbox_pattern": "Для
              гарантированной доставки событий в Event Bus используется Outbox Pattern,\nкоторый
              записывает события в транзакционную таблицу перед публикацией.\n"},
              "tickrate_specification": {"apartment_operations": {"tickrate": "Event-based
              (on-demand)", "network_load": "- Покупка квартиры: event-based, ~0.001-0.01
              events/sec на игрока\n- Получение информации о квартире: event-based,
              ~0.01-0.05 requests/sec на игрока\n- Обновление настроек доступа: event-based,
              ~0.001-0.01 events/sec на игрока\n- Общий трафик: ~0.1-0.3 KB/sec на
              игрока для операций квартир\n", "latency_requirements": "< 200-300ms
              для покупки квартиры, < 30-100ms для получения информации", "sync_strategy":
              "Strong Consistency (ACID транзакции) для покупки квартир"}, "furniture_operations":
              {"tickrate": "Event-based (on-demand)", "network_load": "- Покупка мебели:
              event-based, ~0.01-0.05 events/sec на игрока\n- Размещение мебели: event-based,
              ~0.01-0.1 events/sec на игрока\n- Перемещение мебели: event-based, ~0.01-0.1
              events/sec на игрока\n- Удаление мебели: event-based, ~0.01-0.05 events/sec
              на игрока\n- Получение каталога мебели: event-based, ~0.01-0.02 requests/sec
              на игрока\n- Общий трафик: ~0.2-0.5 KB/sec на игрока для операций мебели\n",
              "latency_requirements": "< 100-200ms для размещения мебели, < 30-100ms
              для получения каталога", "sync_strategy": "Strong Consistency (ACID
              транзакции) для размещения мебели"}, "prestige_operations": {"tickrate":
              "Event-based (on-demand при изменении мебели) + 1-5 Hz для обновления
              лидерборда", "network_load": "- Расчёт престижа: event-based, ~0.01-0.05
              events/sec на игрока\n- Получение престижа: event-based, ~0.01-0.02
              requests/sec на игрока\n- Обновление лидерборда: 1-5 Hz, ~0.05-0.2 KB/sec\n-
              Общий трафик: ~0.1-0.3 KB/sec на игрока для операций престижа\n", "latency_requirements":
              "< 50-100ms для расчёта престижа, < 30-100ms для получения престижа",
              "sync_strategy": "Strong Consistency (ACID транзакции) для расчёта престижа,
              Eventual Consistency для лидерборда"}, "bonus_operations": {"tickrate":
              "Event-based (on-demand при изменении мебели)", "network_load": "- Агрегация
              бонусов: event-based, ~0.01-0.05 events/sec на игрока\n- Применение
              бонусов: event-based, ~0.01-0.05 events/sec на игрока\n- Получение бонусов:
              event-based, ~0.01-0.02 requests/sec на игрока\n- Общий трафик: ~0.1-0.3
              KB/sec на игрока для операций бонусов\n", "latency_requirements": "<
              50-150ms для применения бонусов, < 30-100ms для получения бонусов",
              "sync_strategy": "Strong Consistency (ACID транзакции) для применения
              бонусов"}, "visit_operations": {"tickrate": "Event-based (on-demand)",
              "network_load": "- Посещение квартиры: event-based, ~0.01-0.05 events/sec
              на игрока\n- Загрузка состояния квартиры: event-based, ~0.01-0.05 requests/sec
              на игрока\n- Получение истории посещений: event-based, ~0.001-0.01 requests/sec
              на игрока\n- Общий трафик: ~0.2-0.5 KB/sec на игрока для операций посещений\n",
              "latency_requirements": "< 200-300ms для посещения квартиры, < 100-200ms
              для загрузки состояния", "sync_strategy": "Strong Consistency (ACID
              транзакции) для посещений"}, "event_handling": {"tickrate": "Event-based
              (on-demand)", "network_load": "- Публикация событий жилья: event-based,
              ~0.1-0.5 events/sec\n- Подписка на события: event-based, ~0.05-0.2 events/sec\n-
              Общий трафик: ~0.2-0.7 KB/sec для событий\n", "latency_requirements":
              "< 100-300ms для публикации событий", "sync_strategy": "Eventual Consistency
              для событий (через Event Bus)"}}, "database_schema": {"tables": [{"name":
              "apartments", "description": "Квартиры игроков", "fields": [{"id": "UUID
              (PK)"}, {"owner_id": "UUID (FK accounts)"}, {"guild_id": "UUID (FK guilds,
              nullable)"}, {"apartment_type": "ENUM (STUDIO, STANDARD, PENTHOUSE,
              GUILD_HALL)"}, {"location_id": "VARCHAR(100)"}, {"price": "BIGINT"},
              {"furniture_slots": "INTEGER"}]}]}}}'
        - column:
            name: metadata
            value: '{"id": "housing-system-architecture", "title": "Архитектура системы
              жилья (Housing System)", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.1.0", "last_updated": "2025-11-30T20:35:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "housing", "backend", "social", "customization"],
              "related_systems": ["world-service-go", "economy-service-go", "social-service-go"],
              "related_documents": [{"id": "backend-housing-system", "relation": "extends"}],
              "github_issue": 299, "visibility": "internal", "audience": ["architect",
              "backend", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\housing-system-architecture.yaml
