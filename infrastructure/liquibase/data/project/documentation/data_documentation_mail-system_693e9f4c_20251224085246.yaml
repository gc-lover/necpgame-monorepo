databaseChangeLog:
- changeSet:
    id: documentation-mail-system-693e9f4c
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-705451374224552'
        - column:
            name: doc_id
            value: mail-system
        - column:
            name: title
            value: Backend почтовой системы
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: approved
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-07 05:20:00+00:00
        - column:
            name: concept_approved
            value: true
        - column:
            name: concept_reviewed_at
            value: 2025-11-07 05:20:00+00:00
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - social
            - mail
            - backend
        - column:
            name: topics
            value:
            - player-messaging
            - deliveries
        - column:
            name: related_systems
            value:
            - social-service
            - economy-service
            - notification-service
        - column:
            name: related_documents
            value: '[{"id": "inventory-system", "relation": "references"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - social
            - backend
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "mail-system", "title": "Backend почтовой
              системы", "document_type": "implementation", "category": "systems",
              "status": "approved", "version": "1.0.0", "last_updated": "2025-11-07T05:20:00+00:00",
              "concept_approved": true, "concept_reviewed_at": "2025-11-07T05:20:00+00:00",
              "owners": [{"role": "concept_director", "contact": "concept@necp.game"}],
              "tags": ["social", "mail", "backend"], "topics": ["player-messaging",
              "deliveries"], "related_systems": ["social-service", "economy-service",
              "notification-service"], "related_documents": [{"id": "inventory-system",
              "relation": "references"}], "source": "", "visibility": "internal",
              "audience": ["concept", "social", "backend"], "risk_level": "medium"},
              "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at":
              "2025-11-07T05:20:00+00:00", "status": "approved"}], "next_actions":
              []}, "summary": {"problem": "Нужна универсальная система доставки сообщений,
              предметов и наград между игроками.", "goal": "Описать backend-компонент
              почты, который поддерживает письма, вложения, COD и системные рассылки.",
              "essence": "Social-service хранит письма, управляет вложениями и синхронизируется
              с экономикой и уведомлениями.", "key_points": ["Поддержка писем игроку,
              системных наград и заданий.", "Вложения предметов и валюты, механика
              COD и возврата.", "Автоматическое истечение и журнал для аналитики."]},
              "content": {"sections": [{"id": "architecture", "title": "Архитектура
              сервиса", "body": "Почтовый сервис работает в рамках social-service
              (порт 8084) и доступен по маршруту\n`/api/v1/social/mail/*`. Он публикует
              события `mail:sent`, `mail:received`,\n`mail:attachment-claimed`, `mail:expired`
              и подписывается на события квестов и аукционов\nдля отправки наград.\n",
              "mechanics_links": [], "assets": []}, {"id": "data-model", "title":
              "Модель данных", "body": "Таблица `mail_messages` хранит отправителя,
              получателя, тип, вложения, статус и временные\nметки (отправлено, прочитано,
              истекает). Поля поддерживают возврат писем, COD и очистку\nпросроченных
              сообщений. Индексы оптимизируют поиск по получателю и истечению срока.\n",
              "mechanics_links": [], "assets": []}, {"id": "flows", "title": "Основные
              сценарии", "body": "При отправке письма сервис валидирует получателя,
              проверяет вложения и баланс, создаёт запись,\nсписывает предметы и валюту,
              уведомляет адресата и ставит срок истечения. Вложения можно забрать\nодин
              раз; при истечении письма возвращаются отправителю.\n", "mechanics_links":
              [], "assets": []}]}, "appendix": {"glossary": [], "references": [{"type":
              "repository", "path": "shared/code/backend/social/mail-service/"}],
              "decisions": [{"id": "adr-mail-service", "summary": "Утверждён почтовый
              сервис с поддержкой вложений, COD и событийных рассылок."}]}, "implementation":
              {"needs_task": false, "github_issue": 79, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"],
              "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-11-07",
              "author": "Concept Director", "changes": "Описана архитектура почтовой
              системы и поддерживаемые сценарии."}], "validation": {"checksum": "",
              "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "mail-system", "title": "Backend почтовой системы", "document_type":
              "implementation", "category": "systems", "status": "approved", "version":
              "1.0.0", "last_updated": "2025-11-07T05:20:00+00:00", "concept_approved":
              true, "concept_reviewed_at": "2025-11-07T05:20:00+00:00", "owners":
              [{"role": "concept_director", "contact": "concept@necp.game"}], "tags":
              ["social", "mail", "backend"], "topics": ["player-messaging", "deliveries"],
              "related_systems": ["social-service", "economy-service", "notification-service"],
              "related_documents": [{"id": "inventory-system", "relation": "references"}],
              "source": "", "visibility": "internal", "audience": ["concept", "social",
              "backend"], "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\implementation\backend\mail-system.yaml
