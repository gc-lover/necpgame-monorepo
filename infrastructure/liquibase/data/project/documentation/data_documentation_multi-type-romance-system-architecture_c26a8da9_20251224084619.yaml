databaseChangeLog:
- changeSet:
    id: documentation-multi-type-romance-system-architecture-c26a8da9
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '3735619224990525'
        - column:
            name: doc_id
            value: multi-type-romance-system-architecture
        - column:
            name: title
            value: Архитектура системы многотипной романтики
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-XXT00:00:00Z
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - social
            - romance
            - relationships
            - player-player
            - player-npc
            - player-digital-avatar
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - social-service
            - character-service
            - world-service
            - economy-service
        - column:
            name: related_documents
            value: '[{"id": "relationships-system-architecture", "relation": "extends"},
              {"id": "romance-database-schema", "relation": "implements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - social
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "multi-type-romance-system-architecture",
              "title": "Архитектура системы многотипной романтики", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-XXT00:00:00Z", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "social", "romance", "relationships", "player-player", "player-npc",
              "player-digital-avatar"], "related_systems": ["social-service", "character-service",
              "world-service", "economy-service"], "related_documents": [{"id": "relationships-system-architecture",
              "relation": "extends"}, {"id": "romance-database-schema", "relation":
              "implements"}], "github_issue": 1493, "visibility": "internal", "audience":
              ["architect", "backend", "social", "api-designer"]}, "summary": {"problem":
              "Требуется спроектировать архитектуру системы многотипной романтики,
              включающую:\n- Романтику между игроками (player-player)\n- Романтику
              между игроком и NPC (player-npc)\n- Романтику между игроком и цифровыми
              аватарами (player-digital-avatar)\n- Единую систему управления отношениями
              для всех типов\n- Интеграцию с существующими системами отношений и репутации\n",
              "goal": "Создать архитектурную схему системы многотипной романтики с
              определением:\n- Компонентов для управления романтическими отношениями
              всех типов\n- REST, WebSocket и Event Bus контрактов\n- Интеграций с
              другими системами\n- Структуры БД для всех типов отношений\n- Технического
              задания для реализации\n", "essence": "Объединенная архитектура системы
              многотипной романтики с поддержкой отношений\nмежду игроками, NPC и
              цифровыми аватарами, расширяющая существующую систему отношений.\n"},
              "architecture": {"overview": "Архитектура системы многотипной романтики
              состоит из следующих компонентов:\n1. Romance Type Manager - управление
              типами романтических отношений\n2. Player-Player Romance Manager - управление
              романтикой между игроками\n3. Player-NPC Romance Manager - управление
              романтикой с NPC\n4. Player-Digital Avatar Romance Manager - управление
              романтикой с цифровыми аватарами\n5. Romance Event Manager - управление
              романтическими событиями\n6. Romance Compatibility Calculator - расчёт
              совместимости\n7. Romance Privacy Manager - управление приватностью
              отношений\n8. Romance Notification Manager - управление уведомлениями\n",
              "romance_types": [{"type": "player_player", "description": "Романтика
              между двумя игроками", "features": [{"mutual_consent": "требуется взаимное
              согласие"}, {"privacy_settings": "настройки приватности"}, {"relationship_status":
              "публичный/приватный статус"}, {"virtual_dates": "виртуальные свидания"},
              {"gift_exchange": "обмен подарками"}, {"relationship_milestones": "важные
              моменты"}], "constraints": [{"both_players_online": "не требуется, но
              предпочтительно"}, {"age_verification": "проверка возраста"}, {"consent_management":
              "управление согласием"}]}, {"type": "player_npc", "description": "Романтика
              между игроком и NPC", "features": [{"npc_personality": "личность NPC
              влияет на отношения"}, {"cultural_context": "культурный контекст"},
              {"romance_events": "1550+ романтических событий"}, {"chemistry_calculation":
              "расчёт совместимости"}, {"relationship_stages": "стадии отношений"},
              {"companion_perks": "бонусы спутника"}], "constraints": [{"npc_availability":
              "NPC должен быть доступен для романтики"}, {"relationship_requirements":
              "требования к уровню отношений"}, {"cultural_compatibility": "культурная
              совместимость"}]}, {"type": "player_digital_avatar", "description":
              "Романтика между игроком и цифровым аватаром", "features": [{"digital_consciousness":
              "цифровое сознание"}, {"virtual_interactions": "виртуальные взаимодействия"},
              {"net_access": "доступ через NET"}, {"ai_personality": "AI личность"},
              {"digital_gifts": "цифровые подарки"}, {"consciousness_evolution": "эволюция
              сознания"}], "constraints": [{"net_connection": "требуется подключение
              к NET"}, {"consciousness_stability": "стабильность сознания"}, {"digital_limitations":
              "ограничения цифрового формата"}]}], "microservices": [{"name": "social-service",
              "port": 8084, "responsibility": "Обработка многотипной романтики:\n-
              Управление романтическими отношениями всех типов\n- Управление событиями
              романтики\n- Расчёт совместимости\n- Управление приватностью\n- Уведомления
              о романтике\n", "components": [{"romance-type-manager": "управление
              типами романтики"}, {"player-player-romance-manager": "романтика игрок-игрок"},
              {"player-npc-romance-manager": "романтика игрок-NPC"}, {"player-digital-avatar-romance-manager":
              "романтика игрок-цифровой аватар"}, {"romance-event-manager": "управление
              событиями"}, {"romance-compatibility-calculator": "расчёт совместимости"},
              {"romance-privacy-manager": "управление приватностью"}, {"romance-notification-manager":
              "уведомления"}], "endpoints": ["GET /api/v1/social/romance/types - список
              типов романтики", "GET /api/v1/social/romance/{playerId}/relationships
              - все романтические отношения игрока", "GET /api/v1/social/romance/{playerId}/relationships/{type}
              - отношения по типу", "POST /api/v1/social/romance/player-player/initiate
              - инициация романтики игрок-игрок", "POST /api/v1/social/romance/player-player/accept
              - принятие предложения", "POST /api/v1/social/romance/player-player/reject
              - отклонение предложения", "POST /api/v1/social/romance/player-player/breakup
              - разрыв отношений", "GET /api/v1/social/romance/player-player/{playerId1}/{playerId2}
              - отношения между игроками", "POST /api/v1/social/romance/player-npc/initiate
              - инициация романтики с NPC", "GET /api/v1/social/romance/player-npc/{playerId}/{npcId}
              - отношения с NPC", "POST /api/v1/social/romance/player-npc/{playerId}/{npcId}/event
              - запуск романтического события", "POST /api/v1/social/romance/player-digital-avatar/initiate
              - инициация романтики с цифровым аватаром", "GET /api/v1/social/romance/player-digital-avatar/{playerId}/{avatarId}
              - отношения с цифровым аватаром", "POST /api/v1/social/romance/player-digital-avatar/{playerId}/{avatarId}/interact
              - взаимодействие с аватаром", "GET /api/v1/social/romance/compatibility/{playerId}/{targetId}
              - совместимость", "POST /api/v1/social/romance/privacy/update - обновление
              настроек приватности", "GET /api/v1/social/romance/notifications/{playerId}
              - уведомления о романтике"], "websocket_channels": ["wss://api.necp.game/v1/social/romance/{playerId}
              - поток обновлений романтики", "wss://api.necp.game/v1/social/romance/player-player/{playerId}
              - романтика игрок-игрок", "wss://api.necp.game/v1/social/romance/player-npc/{playerId}
              - романтика игрок-NPC", "wss://api.necp.game/v1/social/romance/player-digital-avatar/{playerId}
              - романтика игрок-цифровой аватар"], "events_published": [{"romance.initiated":
              "инициация романтики"}, {"romance.accepted": "принятие предложения"},
              {"romance.rejected": "отклонение предложения"}, {"romance.stage.changed":
              "изменение стадии отношений"}, {"romance.event.triggered": "запуск романтического
              события"}, {"romance.event.completed": "завершение романтического события"},
              {"romance.compatibility.calculated": "расчёт совместимости"}, {"romance.breakup":
              "разрыв отношений"}, {"romance.milestone.reached": "достижение важного
              момента"}, {"romance.privacy.updated": "обновление приватности"}], "events_subscribed":
              [{"character.created": "создание персонажа"}, {"character.level-up":
              "повышение уровня"}, {"quest.completed": "завершение квеста"}, {"world.location.changed":
              "изменение локации"}, {"net.connection.established": "установка соединения
              с NET"}, {"net.connection.lost": "потеря соединения с NET"}, {"economy.transaction":
              "транзакция в экономике"}, {"social.relationship.changed": "изменение
              отношений"}]}], "data_flows": {"player_player_romance_flow": "1. Игрок
              A инициирует романтику с игроком B\n2. Player-Player Romance Manager
              проверяет согласие и настройки приватности\n3. Система отправляет уведомление
              игроку B\n4. Игрок B принимает или отклоняет предложение\n5. При принятии
              создаётся романтическое отношение\n6. Система публикует событие romance.initiated\n7.
              Игроки могут обмениваться подарками и проводить виртуальные свидания\n8.
              Система отслеживает важные моменты и публикует события\n", "player_npc_romance_flow":
              "1. Игрок взаимодействует с NPC\n2. Player-NPC Romance Manager проверяет
              доступность NPC для романтики\n3. Система проверяет уровень отношений
              и требования\n4. Romance Event Manager выбирает доступные романтические
              события\n5. Игрок запускает романтическое событие\n6. Система обрабатывает
              событие и обновляет отношения\n7. При достижении порога стадии система
              обновляет стадию отношений\n8. Система публикует события изменения отношений\n",
              "player_digital_avatar_romance_flow": "1. Игрок подключается к NET\n2.
              Player-Digital Avatar Romance Manager проверяет доступность цифрового
              аватара\n3. Система устанавливает соединение с цифровым сознанием\n4.
              Игрок взаимодействует с цифровым аватаром\n5. AI личность аватара обрабатывает
              взаимодействие\n6. Система обновляет отношения на основе взаимодействий\n7.
              При эволюции сознания система обновляет личность аватара\n8. Система
              публикует события взаимодействий\n"}, "network_requirements": {"protocol":
              "Romance система использует WebSocket (TCP) для realtime синхронизации:\n-
              Протокол: WebSocket (TCP) - постоянно, без переключения\n- Применение:
              realtime обновления романтических отношений, уведомления\n- Надежная
              доставка сообщений для синхронизации отношений\n- Поддержка TLS (wss://)\n-
              Интеграция с Realtime Gateway для WebSocket соединений\n", "tickrate_and_frequency":
              "Тикрейт и частота обновлений:\n- Обновления отношений: Event-based
              (при изменениях отношений)\n- Уведомления о романтике: Event-based (при
              событиях романтики)\n- Синхронизация совместимости: Event-based (при
              расчете совместимости)\n- WebSocket heartbeat: каждые 30 секунд\n- Event
              Bus синхронизация: batch каждые 100 мс (для оптимизации)\n", "latency_requirements":
              "Требования к задержке:\n- WebSocket обновления отношений: <100 мс (p99)
              для realtime синхронизации\n- Инициация романтики: <200 мс (p99)\n-
              Event Bus синхронизация: <200 мс (p99)\n- Уведомления о романтике: <100
              мс (p99)\n", "network_load": "Сетевая нагрузка:\n- WebSocket обновления
              отношений: 0.2-1 KB/sec на игрока (зависит от активности)\n- Event Bus
              синхронизация: 0.5-2 KB/sec (batch синхронизация)\n- Уведомления о романтике:
              0.1-0.3 KB/sec на игрока\n- Общий трафик: ~0.3-1.3 KB/sec на игрока\n",
              "optimization": "Оптимизации:\n- Event-based синхронизация для снижения
              трафика\n- Batch синхронизация через Event Bus (каждые 100 мс)\n- WebSocket
              каналы только для активных подписчиков\n- Кэширование профилей романтики
              для быстрого доступа\n"}, "database": {"tables": [{"name": "romance_relationships",
              "description": "Романтические отношения всех типов", "columns": [{"relationship_id":
              "UUID PRIMARY KEY"}, {"romance_type": "VARCHAR(20) NOT NULL CHECK (romance_type
              IN (''player_player'', ''player_npc'', ''player_digital_avatar''))"},
              {"player_id": "VARCHAR(50) NOT NULL"}, {"target_id": "VARCHAR(50) NOT
              NULL"}, {"relationship_score": "INTEGER DEFAULT 0 CHECK (relationship_score
              >= -100 AND relationship_score <= 100)"}, {"chemistry_score": "INTEGER
              DEFAULT 0 CHECK (chemistry_score >= 0 AND chemistry_score <= 100)"},
              {"trust_score": "INTEGER DEFAULT 0 CHECK (trust_score >= 0 AND trust_score
              <= 100)"}, {"physical_intimacy": "INTEGER DEFAULT 0 CHECK (physical_intimacy
              >= 0 AND physical_intimacy <= 100)"}, {"emotional_intimacy": "INTEGER
              DEFAULT 0 CHECK (emotional_intimacy >= 0 AND emotional_intimacy <= 100)"},
              {"relationship_stage": "VARCHAR(30) DEFAULT ''stranger''"}, {"is_active":
              "BOOLEAN DEFAULT TRUE"}, {"is_romantic": "BOOLEAN DEFAULT FALSE"}, {"is_public":
              "BOOLEAN DEFAULT FALSE"}, {"consent_status": "VARCHAR(20) DEFAULT ''pending''
              CHECK (consent_status IN (''pending'', ''accepted'', ''rejected'', ''revoked''))"},
              {"relationship_health": "INTEGER DEFAULT 100 CHECK (relationship_health
              >= 0 AND relationship_health <= 100)"}, {"flags": "TEXT[]"}, {"metadata":
              "JSONB"}, {"created_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}, {"updated_at":
              "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}], "indexes": [{"idx_romance_relationships_player":
              "(player_id, romance_type)"}, {"idx_romance_relationships_target": "(target_id,
              romance_type)"}, {"idx_romance_relationships_active": "(is_active, is_romantic)"},
              {"idx_romance_relationships_type": "(romance_type)"}]}, {"name": "player_player_romance_profiles",
              "description": "Профили романтики игрок-игрок", "columns": [{"profile_id":
              "UUID PRIMARY KEY"}, {"player_id": "VARCHAR(50) NOT NULL UNIQUE"}, {"romance_preferences":
              "JSONB"}, {"privacy_settings": "JSONB"}, {"relationship_status": "VARCHAR(20)
              DEFAULT ''single'' CHECK (relationship_status IN (''single'', ''dating'',
              ''in_relationship'', ''engaged'', ''married''))"}, {"max_concurrent_romances":
              "INTEGER DEFAULT 1"}, {"polyamory_allowed": "BOOLEAN DEFAULT FALSE"},
              {"age_verification": "BOOLEAN DEFAULT FALSE"}, {"created_at": "TIMESTAMP
              DEFAULT CURRENT_TIMESTAMP"}, {"updated_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}]},
              {"name": "digital_avatar_profiles", "description": "Профили цифровых
              аватаров для романтики", "columns": [{"avatar_id": "VARCHAR(50) PRIMARY
              KEY"}, {"name": "VARCHAR(200) NOT NULL"}, {"consciousness_type": "VARCHAR(20)
              CHECK (consciousness_type IN (''uploaded'', ''ai'', ''hybrid''))"},
              {"personality": "JSONB NOT NULL"}, {"ai_model": "VARCHAR(50)"}, {"net_location":
              "VARCHAR(100)"}, {"romance_available": "BOOLEAN DEFAULT TRUE"}, {"consciousness_stability":
              "INTEGER DEFAULT 100 CHECK (consciousness_stability >= 0 AND consciousness_stability
              <= 100)"}, {"evolution_level": "INTEGER DEFAULT 0"}, {"metadata": "JSONB"},
              {"created_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}, {"updated_at":
              "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}]}, {"name": "romance_event_history",
              "description": "История романтических событий", "columns": [{"history_id":
              "UUID PRIMARY KEY"}, {"relationship_id": "UUID NOT NULL REFERENCES romance_relationships(relationship_id)"},
              {"event_id": "VARCHAR(50)"}, {"event_type": "VARCHAR(20) NOT NULL"},
              {"triggered_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}, {"location":
              "VARCHAR(100)"}, {"outcome": "VARCHAR(30)"}, {"relationship_changes":
              "JSONB"}, {"metadata": "JSONB"}, {"created_at": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}]},
              {"name": "romance_milestones", "description": "Важные моменты в романтических
              отношениях", "columns": [{"milestone_id": "UUID PRIMARY KEY"}, {"relationship_id":
              "UUID NOT NULL REFERENCES romance_relationships(relationship_id)"},
              {"milestone_type": "VARCHAR(50) NOT NULL"}, {"milestone_name": "VARCHAR(200)"},
              {"description": "TEXT"}, {"location": "VARCHAR(100)"}, {"achieved_at":
              "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}, {"metadata": "JSONB"}, {"created_at":
              "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"}]}]}, "integration_points": [{"system":
              "character-service", "integration": "Получение информации о персонажах:\n-
              Профили игроков для романтики игрок-игрок\n- Внешний вид и характеристики\n-
              Уровень и прогресс персонажа\n", "events": ["character.created", "character.level-up",
              "character.appearance.changed"]}, {"system": "world-service", "integration":
              "Интеграция с миром:\n- Локации для виртуальных свиданий\n- События
              мира влияют на романтику\n- Региональные особенности\n", "events": ["world.location.changed",
              "world.event.triggered"]}, {"system": "economy-service", "integration":
              "Экономика романтики:\n- Обмен подарками\n- Виртуальные свидания (платные
              локации)\n- Цифровые подарки для аватаров\n", "events": ["economy.transaction",
              "economy.gift.sent"]}, {"system": "net-service", "integration": "Интеграция
              с NET для цифровых аватаров:\n- Подключение к NET\n- Взаимодействие
              с цифровыми сознаниями\n- Стабильность соединения\n", "events": ["net.connection.established",
              "net.connection.lost", "net.avatar.available"]}], "technical_tasks":
              [{"id": "task-1", "title": "Реализация Romance Type Manager", "description":
              "Создать компонент для управления типами романтических отношений.\nПоддержка
              трёх типов: player-player, player-npc, player-digital-avatar.\n", "estimated_time":
              "2 дня", "dependencies": []}, {"id": "task-2", "title": "Реализация
              Player-Player Romance Manager", "description": "Создать компонент для
              управления романтикой между игроками.\nВключает инициацию, принятие/отклонение,
              управление согласием, приватность.\n", "estimated_time": "4 дня", "dependencies":
              ["task-1"]}, {"id": "task-3", "title": "Расширение Player-NPC Romance
              Manager", "description": "Расширить существующий компонент для интеграции
              с новой системой.\nИспользовать существующую схему БД и события.\n",
              "estimated_time": "2 дня", "dependencies": ["task-1"]}, {"id": "task-4",
              "title": "Реализация Player-Digital Avatar Romance Manager", "description":
              "Создать компонент для управления романтикой с цифровыми аватарами.\nИнтеграция
              с NET, AI личность, эволюция сознания.\n", "estimated_time": "5 дней",
              "dependencies": ["task-1", "net-service"]}, {"id": "task-5", "title":
              "Реализация Romance Compatibility Calculator", "description": "Создать
              компонент для расчёта совместимости для всех типов романтики.\nРазные
              алгоритмы для разных типов.\n", "estimated_time": "3 дня", "dependencies":
              ["task-1"]}, {"id": "task-6", "title": "Реализация Romance Privacy Manager",
              "description": "Создать компонент для управления приватностью романтических
              отношений.\nНастройки видимости, согласие, возрастная верификация.\n",
              "estimated_time": "2 дня", "dependencies": ["task-1"]}, {"id": "task-7",
              "title": "Реализация Romance Notification Manager", "description": "Создать
              компонент для управления уведомлениями о романтике.\nУведомления о предложениях,
              событиях, важных моментах.\n", "estimated_time": "2 дня", "dependencies":
              ["task-1"]}, {"id": "task-8", "title": "Создание схемы БД для многотипной
              романтики", "description": "Создать таблицы для романтических отношений
              всех типов.\nИнтеграция с существующей схемой БД для NPC романтики.\n",
              "estimated_time": "3 дня", "dependencies": []}, {"id": "task-9", "title":
              "Реализация REST API endpoints", "description": "Создать все REST API
              endpoints для управления многотипной романтикой.\nДокументация OpenAPI,
              валидация, обработка ошибок.\n", "estimated_time": "5 дней", "dependencies":
              ["task-2", "task-3", "task-4"]}, {"id": "task-10", "title": "Реализация
              WebSocket channels", "description": "Создать WebSocket channels для
              realtime обновлений романтики.\nПоддержка всех типов романтики.\n",
              "estimated_time": "3 дня", "dependencies": ["task-2", "task-3", "task-4"]},
              {"id": "task-11", "title": "Интеграция с Event Bus", "description":
              "Настроить публикацию и подписку на события романтики.\nИнтеграция с
              другими системами через события.\n", "estimated_time": "2 дня", "dependencies":
              ["task-2", "task-3", "task-4"]}, {"id": "task-12", "title": "Тестирование
              системы многотипной романтики", "description": "Написать unit и integration
              тесты для всех компонентов.\nТестирование всех типов романтики, edge
              cases.\n", "estimated_time": "4 дня", "dependencies": ["task-9", "task-10",
              "task-11"]}]}, "diagrams": {"component_diagram": "```mermaid\ngraph
              TB\n    subgraph \"Social Service\"\n        RTM[Romance Type Manager]\n        PPRM[Player-Player
              Romance Manager]\n        PNRM[Player-NPC Romance Manager]\n        PDARM[Player-Digital
              Avatar Romance Manager]\n        REM[Romance Event Manager]\n        RCC[Romance
              Compatibility Calculator]\n        RPM[Romance Privacy Manager]\n        RNM[Romance
              Notification Manager]\n    end\n\n    subgraph \"External Services\"\n        CS[Character
              Service]\n        WS[World Service]\n        ES[Economy Service]\n        NS[Net
              Service]\n    end\n\n    subgraph \"Database\"\n        DB[(PostgreSQL<br/>romance_relationships<br/>player_player_romance_profiles<br/>digital_avatar_profiles<br/>romance_event_history<br/>romance_milestones)]\n    end\n\n    subgraph
              \"Event Bus\"\n        EB[Event Bus]\n    end\n\n    subgraph \"Client\"\n        CL[UE5
              Client]\n    end\n\n    CL -->|REST/WebSocket| RTM\n    RTM --> PPRM\n    RTM
              --> PNRM\n    RTM --> PDARM\n    PPRM --> REM\n    PNRM --> REM\n    PDARM
              --> REM\n    PPRM --> RCC\n    PNRM --> RCC\n    PDARM --> RCC\n    PPRM
              --> RPM\n    PPRM --> RNM\n    PNRM --> RNM\n    PDARM --> RNM\n    PPRM
              --> DB\n    PNRM --> DB\n    PDARM --> DB\n    REM --> DB\n    PPRM
              --> EB\n    PNRM --> EB\n    PDARM --> EB\n    PPRM --> CS\n    PNRM
              --> CS\n    PDARM --> NS\n    PNRM --> WS\n    PPRM --> ES\n```\n",
              "romance_types_diagram": "```mermaid\ngraph LR\n    subgraph \"Romance
              Types\"\n        PP[Player-Player<br/>Взаимное согласие<br/>Приватность<br/>Виртуальные
              свидания]\n        PN[Player-NPC<br/>NPC личность<br/>Культурный контекст<br/>1550+
              событий]\n        PDA[Player-Digital Avatar<br/>Цифровое сознание<br/>NET
              доступ<br/>AI личность]\n    end\n\n    subgraph \"Common Features\"\n        CF[Совместимость<br/>Стадии
              отношений<br/>Важные моменты<br/>Уведомления]\n    end\n\n    PP -->
              CF\n    PN --> CF\n    PDA --> CF\n```\n", "data_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              P1 as Player 1\n    participant P2 as Player 2/NPC/Avatar\n    participant
              RM as Romance Manager\n    participant DB as Database\n    participant
              EB as Event Bus\n\n    P1->>RM: Initiate Romance\n    RM->>DB: Check
              Compatibility\n    RM->>P2: Send Notification\n    P2->>RM: Accept/Reject\n    alt
              Accepted\n        RM->>DB: Create Relationship\n        RM->>EB: Publish
              romance.initiated\n        RM->>P1: Confirm Relationship\n        RM->>P2:
              Confirm Relationship\n    else Rejected\n        RM->>P1: Rejection
              Notification\n    end\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "multi-type-romance-system-architecture", "title": "Архитектура
              системы многотипной романтики", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-12-XXT00:00:00Z",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "social", "romance", "relationships", "player-player",
              "player-npc", "player-digital-avatar"], "related_systems": ["social-service",
              "character-service", "world-service", "economy-service"], "related_documents":
              [{"id": "relationships-system-architecture", "relation": "extends"},
              {"id": "romance-database-schema", "relation": "implements"}], "github_issue":
              1493, "visibility": "internal", "audience": ["architect", "backend",
              "social", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\multi-type-romance-system-architecture.yaml
