databaseChangeLog:
- changeSet:
    id: documentation-network-architecture-analysis-398aa13e
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-864806150887286'
        - column:
            name: doc_id
            value: implementation-networking-architecture-analysis
        - column:
            name: title
            value: Анализ сетевой архитектуры для MMORPG с киберспортивными элементами
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: networking
        - column:
            name: status
            value: completed
        - column:
            name: version
            value: 1.4.0
        - column:
            name: last_updated
            value: 2025-11-30 23:10:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "tech_director", "contact": "tech@necp.game"}]'
        - column:
            name: tags
            value:
            - networking
            - architecture
            - tcp
            - udp
            - websocket
            - quic
            - performance
        - column:
            name: topics
            value:
            - network-architecture
            - protocol-selection
            - performance-optimization
        - column:
            name: related_systems
            value:
            - realtime-gateway
            - ue5-client
            - ue5-dedicated-server
        - column:
            name: related_documents
            value: '[{"id": "roadmap-v0.1-tech-demo", "relation": "references"}, {"id":
              "roadmap-v0.3-mvp-core", "relation": "references"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - backend
            - platform
            - tech_director
        - column:
            name: risk_level
            value: high
        - column:
            name: content
            value: '{"metadata": {"id": "implementation-networking-architecture-analysis",
              "title": "Анализ сетевой архитектуры для MMORPG с киберспортивными элементами",
              "document_type": "implementation", "category": "networking", "status":
              "completed", "version": "1.4.0", "last_updated": "2025-11-30T23:10:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "tech_director", "contact": "tech@necp.game"}], "tags": ["networking",
              "architecture", "tcp", "udp", "websocket", "quic", "performance"], "topics":
              ["network-architecture", "protocol-selection", "performance-optimization"],
              "related_systems": ["realtime-gateway", "ue5-client", "ue5-dedicated-server"],
              "related_documents": [{"id": "roadmap-v0.1-tech-demo", "relation": "references"},
              {"id": "roadmap-v0.3-mvp-core", "relation": "references"}], "visibility":
              "internal", "audience": ["backend", "platform", "tech_director"], "risk_level":
              "high"}, "review": {"chain": [{"role": "tech_director", "reviewer":
              "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary":
              {"problem": "Необходимо определить оптимальную сетевую архитектуру для
              MMORPG с киберспортивными элементами, поддерживающую различные типы
              зон и масштабы битв.", "goal": "Создать гибридную архитектуру с динамическим
              переключением протоколов, оптимизированную для разных сценариев использования.",
              "essence": "Гибридный подход с WebSocket/TCP для MMORPG части и UDP
              для PvP, с динамическим переключением и масштабированием для больших
              битв.", "key_points": [{"Глобальные зоны": "WebSocket (PvE) → UDP (PvP)
              с динамическим переключением"}, {"Малые PvP зоны": "UDP, 60-128 Hz,
              5-20 игроков"}, {"GvG 200": "UDP, 60-80 Hz, spatial partitioning"},
              {"GvG 400": "UDP, 40-60 Hz, sharding"}, {"Война 2000": "UDP, 20-40 Hz,
              мультисерверный кластер"}]}, "content": {"sections": [{"id": "protocol_comparison",
              "title": "Сравнение протоколов", "body": "| Протокол | Tick Rate | Задержка
              | Надежность | Применение |\n|----------|-----------|----------|------------|------------|\n|
              **WebSocket (TCP)** | 30-60 Hz | 50-150 мс | Высокая | MMORPG, PvE зоны
              |\n| **UDP** | 60-128 Hz | 5-50 мс | Средняя (нужна своя) | PvP, арены,
              боевые зоны |\n| **QUIC** | 60-128 Hz | 10-50 мс | Высокая | Потенциально
              (проблемы совместимости) |\n", "mechanics_links": [], "assets": []},
              {"id": "zone_architecture", "title": "Архитектура по типам зон", "body":
              "## Безопасные зоны (Safe Zones)\n\n**Характеристики:**\n- PvP: отключен
              полностью\n- Протокол: WebSocket (TCP) - постоянно, без переключения\n-
              Tick Rate: 20-30 Hz\n- Задержка: <100 мс\n- Игроков: 100-500\n- Данные:
              Квесты, инвентарь, чат, торговля, социальные взаимодействия\n- Применение:
              города, торговые зоны, лобби, социальные хабы\n\n**Особенности:**\n-
              Нет динамического переключения протоколов\n- Только WebSocket для надежности
              критичных данных\n- Защита от PvP в безопасных зонах\n\n## Открытый
              мир (Open World Zones)\n\n**PvE режим (по умолчанию):**\n- Протокол:
              WebSocket (TCP)\n- Tick Rate: 20-30 Hz\n- Задержка: <100 мс\n- Игроков:
              100-500\n- Данные: Квесты, инвентарь, чат, торговля, исследование\n-
              PvP: возможен (при входе в бой)\n\n**PvP режим (в бою):**\n- Протокол:
              UDP (динамическое переключение из WebSocket)\n- Tick Rate: 40-60 Hz\n-
              Задержка: <50 мс\n- Переключение: Бесшовное (0.5-1 сек)\n- Данные: Позиции,
              выстрелы, урон, боевые события\n- Триггеры: Вход в боевой режим, детекция
              врагов, активация боевых способностей\n\n**Особенности:**\n- Динамическое
              переключение WebSocket ↔ UDP\n- Автоматическое переключение при входе/выходе
              из боя\n- Fallback на WebSocket при проблемах с UDP\n- Применение: открытый
              мир, квестовые зоны, исследовательские зоны\n\n## Выделенные PvP зоны
              (Dedicated PvP Zones)\n\n### Малые PvP зоны (5-20 игроков)\n\n- Протокол:
              UDP - постоянно (без переключения)\n- Tick Rate: 60-128 Hz\n- Задержка:
              <30 мс\n- Архитектура: Выделенный инстанс\n- Синхронизация: Полная (все
              видят всех)\n- PvP: всегда включен\n- Применение: арены, дуэли, малые
              PvP инстансы\n\n### GvG (100v100 = 200 игроков)\n\n- Протокол: UDP -
              постоянно (без переключения)\n- Tick Rate: 60-80 Hz\n- Задержка: <40
              мс\n- Архитектура: Выделенный сервер + Spatial Partitioning\n- Оптимизация:
              Grid-based разделение на сектора\n- PvP: всегда включен\n- Применение:
              GvG битвы, клановые войны\n\n### GvG (200v200 = 400 игроков)\n\n- Протокол:
              UDP - постоянно (без переключения)\n- Tick Rate: 40-60 Hz\n- Задержка:
              <50 мс\n- Архитектура: Кластер серверов (2-4 сервера)\n- Оптимизация:
              Sharding по секторам\n- PvP: всегда включен\n- Применение: масштабные
              GvG битвы\n\n### Супер зона войны (1000v1000 = 2000 игроков)\n\n- Протокол:
              UDP - постоянно (без переключения)\n- Tick Rate: 20-40 Hz\n- Задержка:
              <60 мс\n- Архитектура: Мультисерверный кластер (5-10 серверов)\n- Оптимизация:
              Spatial sharding, LOD, агрегация событий\n- PvP: всегда включен\n- Применение:
              массовые войны, серверные события\n", "mechanics_links": [], "assets":
              []}, {"id": "dynamic_switching", "title": "Динамическое переключение
              протоколов", "body": "## Механизм переключения\n\n**Применение:**\n-
              Только для открытого мира (Open World Zones)\n- НЕ применяется в безопасных
              зонах (Safe Zones) - только WebSocket\n- НЕ применяется в выделенных
              PvP зонах (Dedicated PvP Zones) - только UDP\n\n**Триггеры переключения:**\n\n**WebSocket
              → UDP (вход в бой):**\n- Вход в боевой режим (детекция врагов)\n- Активация
              боевых способностей\n- Вход в зону боевых действий\n- Применение: открытый
              мир, квестовые зоны с возможностью PvP\n\n**UDP → WebSocket (выход из
              боя):**\n- Выход из боя (отсутствие врагов 5+ секунд)\n- Выход из зоны
              боевых действий\n- Деактивация боевых способностей\n- Применение: возврат
              в PvE режим в открытом мире\n\n**Реализация:**\n1. Оба соединения активны
              1-2 секунды (overlap период)\n2. Синхронизация состояния через WebSocket
              перед переключением (критичные данные)\n3. Установка нового соединения
              (UDP или WebSocket)\n4. Миграция всех обновлений на новый протокол\n5.
              Закрытие старого соединения после подтверждения\n6. Время переключения:
              0.5-1 секунда\n\n**Fallback механизм:**\n- UDP недоступен: Автоматический
              fallback на WebSocket\n- Проблемы с UDP соединением: Возврат на WebSocket\n-
              Обеспечивает надежность даже при проблемах с сетью\n\n**Преимущества:**\n-
              Оптимальная производительность для каждого режима\n- Надежность для
              критичных данных (PvE через WebSocket)\n- Низкая задержка для боевых
              действий (PvP через UDP)\n- Бесшовное переключение без потери данных\n",
              "mechanics_links": [], "assets": []}, {"id": "optimization_techniques",
              "title": "Техники оптимизации для масштабных битв", "body": "## Spatial
              Partitioning (100-400 игроков)\n\n- Разделение зоны на сетку (grid)\n-
              Игрок видит только свой сектор + соседние\n- Снижение трафика: 80-90%\n\n##
              Spatial Sharding (1000+ игроков)\n\n- Разделение зоны на серверы по
              координатам\n- Каждый сервер обрабатывает свой сектор\n- Синхронизация
              между серверами кластера\n\n## LOD (Level of Detail)\n\n- Дальние объекты:
              низкая детализация\n- Меньше обновлений для дальних объектов\n- Снижение
              трафика: 60-70%\n\n## Агрегация событий\n\n- Группировка событий по
              времени (100 мс)\n- Отправка батчами вместо отдельных пакетов\n- Снижение
              трафика: 80-90%\n", "mechanics_links": [], "assets": []}, {"id": "performance_metrics",
              "title": "Метрики производительности", "body": "| Тип зоны | Пакетов/сек
              | Трафик/игрок | CPU сервер | RAM сервер |\n|----------|-------------|--------------|------------|------------|\n|
              Город PvE | 20-30 | 5-10 KB/s | Низкая | Средняя |\n| Город PvP | 40-60
              | 15-25 KB/s | Средняя | Средняя |\n| Малые PvP | 60-128 | 30-50 KB/s
              | Средняя | Низкая |\n| GvG 200 | 60-80 | 25-40 KB/s | Высокая | Средняя
              |\n| GvG 400 | 40-60 | 20-35 KB/s | Очень высокая | Высокая |\n| Война
              2000 | 20-40 | 15-30 KB/s | Критическая | Очень высокая |\n", "mechanics_links":
              [], "assets": []}, {"id": "implementation_phases", "title": "Фазы реализации",
              "body": "## Фаза 1: Базовая реализация\n- WebSocket для глобальных зон
              (PvE)\n- UDP для малых PvP зон (5-20 игроков)\n- Простое переключение
              протоколов\n\n## Фаза 2: Масштабирование\n- Spatial partitioning для
              GvG 200\n- Sharding для GvG 400\n- Оптимизация трафика\n\n## Фаза 3:
              Масштабные битвы\n- Мультисерверный кластер\n- Spatial sharding\n- Агрегация
              событий\n- LOD система\n", "mechanics_links": [], "assets": []}]}, "appendix":
              {"glossary": [{"term": "Safe Zones (Безопасные зоны)", "definition":
              "Зоны с отключенным PvP (города, торговые зоны, лобби). Используют только
              WebSocket протокол без переключения. PvP полностью отключен."}, {"term":
              "Open World Zones (Открытый мир)", "definition": "Зоны с возможностью
              PvP в открытом мире. Используют WebSocket по умолчанию (PvE режим) и
              UDP при входе в бой (PvP режим) с динамическим переключением протоколов."},
              {"term": "Dedicated PvP Zones (Выделенные PvP зоны)", "definition":
              "Зоны предназначенные только для PvP (арены, GvG, массовые войны). Используют
              только UDP протокол без переключения. PvP всегда включен."}, {"term":
              "Spatial Partitioning", "definition": "Разделение игрового пространства
              на сектора для оптимизации сетевого трафика"}, {"term": "Spatial Sharding",
              "definition": "Распределение игроков по серверам на основе их позиции
              в мире"}, {"term": "LOD", "definition": "Level of Detail - система детализации
              объектов в зависимости от расстояния"}, {"term": "Head-of-line blocking",
              "definition": "Проблема TCP, когда потеря одного пакета блокирует доставку
              последующих"}, {"term": "Protocol Switching (Переключение протоколов)",
              "definition": "Динамическое переключение между WebSocket и UDP протоколами.
              Применяется только в открытом мире при входе/выходе из боя. Не применяется
              в безопасных зонах (только WebSocket) и выделенных PvP зонах (только
              UDP)."}], "references": [{"title": "QUIC vs TCP vs UDP для игр", "link":
              "https://arxiv.org/abs/2310.09423"}, {"title": "Планеты 2 - архитектура
              для больших битв", "link": "https://www.planetside2.com"}], "decisions":
              [{"date": "2025-11-18", "decision": "Выбран гибридный подход WebSocket/UDP
              вместо чистого QUIC из-за проблем совместимости", "rationale": "QUIC
              имеет проблемы совместимости между MsQuic (UE5) и quic-go (Go сервер)"},
              {"date": "2025-11-18", "decision": "Реализация динамического переключения
              протоколов для глобальных зон", "rationale": "Позволяет использовать
              оптимальный протокол для каждого режима игры"}, {"date": "2025-11-18",
              "decision": "Базовая реализация WebSocket завершена", "rationale": "Go
              сервер (gorilla/websocket) работает, UE5 клиент (WebSocketNetworking
              plugin) интегрирован, все краши и ошибки исправлены, добавлен flush
              для корректного закрытия соединения"}, {"date": "2025-11-18", "decision":
              "Интеграция SendPlayerInput завершена", "rationale": {"Движение (WASD),
              прицеливание (мышь/геймпад), стрельба (левая кнопка мыши) - все данные
              отправляются на сервер через WebSocket. Проверено": "сервер получает
              PlayerInput сообщения каждые ~15-17 мс (60 сообщений/сек), задержка
              10-20 мс, размер сообщений 47 байт. Интеграция в ULyraHeroComponent
              завершена"}}, {"date": "2025-11-19", "decision": "Исправлена обработка
              Heartbeat/Echo сообщений", "rationale": "Парсер теперь корректно обрабатывает
              field 10 (Heartbeat) и field 11 (Echo) без ошибок. Tick инкрементируется
              правильно - добавлен ClientTick счетчик в клиенте, сбрасывается при
              переподключении. Сервер получает последовательные значения tick (1154,
              1155, 1156...)"}]}, "implementation": {"needs_task": false, "github_issue":
              11, "queue_reference": ["roadmap-v0.1-tech-demo", "roadmap-v0.3-mvp-core"],
              "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-11-18",
              "author": "tech_director", "changes": "Создан анализ сетевой архитектуры
              на основе исследования протоколов и требований проекта"}, {"version":
              "1.1.0", "date": "2025-11-18", "author": "tech_director", "changes":
              {"Отмечено завершение базовой реализации WebSocket": "Go сервер и UE5
              клиент работают стабильно, все краши исправлены"}}, {"version": "1.2.0",
              "date": "2025-11-18", "author": "tech_director", "changes": {"Отмечено
              завершение интеграции SendPlayerInput": {"движение, прицеливание, стрельба
              - все данные отправляются на сервер в реальном времени. Проверено":
              "сервер получает PlayerInput сообщения каждые ~15-17 мс, задержка 10-20
              мс"}}}, {"version": "1.3.0", "date": "2025-11-19", "author": "tech_director",
              "changes": "Исправлена обработка Heartbeat/Echo сообщений - парсер корректно
              обрабатывает field 10 и 11 без ошибок. Tick инкрементируется правильно
              - добавлен ClientTick счетчик, сервер получает последовательные значения.
              Все системы работают стабильно без ошибок в логах"}, {"version": "1.4.0",
              "date": "2025-11-29", "author": "architect", "changes": {"Уточнены определения
              типов зон": "разделены безопасные зоны (Safe Zones - только WebSocket,
              PvP отключен), открытый мир (Open World - динамическое переключение
              WebSocket ↔ UDP), выделенные PvP зоны (Dedicated PvP Zones - только
              UDP). Обновлено описание динамического переключения протоколов с указанием
              применения только для открытого мира."}}, {"version": "1.4.1", "date":
              "2025-11-30", "author": "network_engineer", "changes": "Добавлен номер
              Issue в начало файла. Проверена актуальность анализа и соответствие
              спецификациям тикрейта. Анализ завершен и готов к передаче Security
              для аудита безопасности."}], "validation": {"checksum": "", "schema_version":
              "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "implementation-networking-architecture-analysis", "title":
              "Анализ сетевой архитектуры для MMORPG с киберспортивными элементами",
              "document_type": "implementation", "category": "networking", "status":
              "completed", "version": "1.4.0", "last_updated": "2025-11-30T23:10:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "tech_director", "contact": "tech@necp.game"}], "tags": ["networking",
              "architecture", "tcp", "udp", "websocket", "quic", "performance"], "topics":
              ["network-architecture", "protocol-selection", "performance-optimization"],
              "related_systems": ["realtime-gateway", "ue5-client", "ue5-dedicated-server"],
              "related_documents": [{"id": "roadmap-v0.1-tech-demo", "relation": "references"},
              {"id": "roadmap-v0.3-mvp-core", "relation": "references"}], "visibility":
              "internal", "audience": ["backend", "platform", "tech_director"], "risk_level":
              "high"}'
        - column:
            name: source_file
            value: knowledge\implementation\networking\network-architecture-analysis.yaml
