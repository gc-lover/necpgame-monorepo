databaseChangeLog:
- changeSet:
    id: documentation-notification-system-architecture-0a7d66b8
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '8403344128016905'
        - column:
            name: doc_id
            value: notification-system-architecture
        - column:
            name: title
            value: Архитектура системы уведомлений
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-22 18:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - notifications
            - backend
            - client
            - realtime
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - social-service-go
            - realtime-gateway-go
            - achievement-service-go
            - gameplay-service-go
            - economy-service-go
        - column:
            name: related_documents
            value: '[{"id": "notification-system", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - client
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "notification-system-architecture", "title":
              "Архитектура системы уведомлений", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-22T18:00:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "notifications", "backend",
              "client", "realtime"], "related_systems": ["social-service-go", "realtime-gateway-go",
              "achievement-service-go", "gameplay-service-go", "economy-service-go"],
              "related_documents": [{"id": "notification-system", "relation": "extends"}],
              "github_issue": 9, "visibility": "internal", "audience": ["architect",
              "backend", "client", "api-designer"]}, "summary": {"problem": "Требуется
              спроектировать полную архитектуру системы уведомлений, включающую:\n-
              Бекенд обработку и доставку уведомлений\n- Клиентскую интеграцию в UE5\n-
              Визуальный дизайн в стиле Cyberpunk 2077\n- Интеграцию с существующими
              сервисами\n", "goal": "Создать архитектурную схему системы уведомлений
              с определением:\n- Компонентов системы (микросервисы, клиентские модули)\n-
              API endpoints (высокоуровнево)\n- Потоков данных и интеграций\n- Технического
              задания для реализации\n", "essence": "Event-driven система уведомлений
              с поддержкой множественных каналов доставки\n(in-game HUD, WebSocket
              realtime, email), персонализацией и интеграцией\nсо всеми игровыми системами.\n"},
              "architecture": {"overview": "Система уведомлений состоит из трёх основных
              компонентов:\n1. Backend (social-service-go) - обработка, хранение и
              маршрутизация уведомлений\n2. Realtime Gateway (realtime-gateway-go)
              - доставка через WebSocket\n3. Client (UE5) - визуальное отображение
              и управление уведомлениями\n", "components": [{"name": "Notification
              Backend Service", "location": "social-service-go", "responsibility":
              "- Приём событий от всех игровых сервисов\n- Хранение уведомлений в
              БД\n- Применение настроек персонализации\n- Маршрутизация по каналам
              доставки\n- Управление историей и статусами\n", "port": 8084, "endpoints":
              ["GET /api/v1/social/notifications - список уведомлений", "GET /api/v1/social/notifications/{id}
              - получение уведомления", "POST /api/v1/social/notifications - создание
              уведомления", "PUT /api/v1/social/notifications/{id}/status - обновление
              статуса", "GET /api/v1/social/notifications/preferences - настройки
              пользователя", "PUT /api/v1/social/notifications/preferences - обновление
              настроек", "DELETE /api/v1/social/notifications/{id} - удаление уведомления",
              "POST /api/v1/social/notifications/batch/read - массовое прочтение"]},
              {"name": "Realtime Gateway", "location": "realtime-gateway-go", "responsibility":
              "- Поддержка WebSocket соединений\n- Доставка уведомлений в реальном
              времени\n- Управление сессиями игроков\n- Интеграция с social-service
              для получения уведомлений\n", "integration": "Получает уведомления от
              social-service через gRPC/internal API\nи доставляет их клиентам через
              WebSocket соединения.\n"}, {"name": "Client Notification System", "location":
              "client/UE5", "responsibility": "- Визуальное отображение уведомлений
              в HUD\n- Звуковые сигналы\n- Управление очередью уведомлений\n- Анимации
              появления/исчезновения\n- Интеграция с настройками игры\n", "modules":
              ["NotificationWidget - UI компонент для отображения", "NotificationManager
              - менеджер очереди и логики", "NotificationSoundManager - управление
              звуками", "NotificationSettings - настройки персонализации"]}], "data_flow":
              {"event_generation": "1. Игровые сервисы (achievement, quest, trade,
              etc.) генерируют события\n2. События отправляются в social-service через
              event bus или direct API\n3. Social-service обрабатывает событие и создаёт
              уведомление\n", "notification_processing": "1. Social-service проверяет
              настройки пользователя\n2. Определяет каналы доставки (in-game, WebSocket,
              email)\n3. Сохраняет уведомление в БД\n4. Отправляет в соответствующие
              каналы\n", "delivery_channels": {"in_game": "- Уведомление доставляется
              через realtime-gateway по WebSocket\n- Клиент получает уведомление и
              отображает в HUD\n- Игрок может взаимодействовать с уведомлением\n",
              "websocket": "- Для online игроков уведомление отправляется через realtime-gateway\n-
              Поддерживается realtime доставка без задержек\n", "email": "- Для критических
              уведомлений или offline игроков\n- Используется email-service (будущий
              сервис)\n- Отправка асинхронная через очередь\n"}}, "integrations":
              {"event_sources": [{"service": "achievement-service-go", "events": ["achievement_unlocked",
              "achievement_progress"]}, {"service": "gameplay-service-go", "events":
              ["quest_started", "quest_completed", "quest_failed", "quest_objective_completed"]},
              {"service": "economy-service-go", "events": ["trade_completed", "trade_request",
              "item_sold"]}, {"service": "social-service-go", "events": ["friend_request",
              "friend_accepted", "guild_invite", "message_received"]}, {"service":
              "matchmaking-go", "events": ["match_found", "match_cancelled"]}, {"service":
              "realtime-gateway-go", "events": ["player_joined", "player_left", "combat_event"]}]},
              "database_schema": {"tables": [{"name": "notifications", "description":
              "Основная таблица уведомлений", "fields": [{"id": "UUID (PK)"}, {"account_id":
              "UUID (FK, indexed)"}, {"type": "ENUM (quest, message, achievement,
              system, friend, guild, trade, combat)"}, {"priority": "ENUM (low, medium,
              high, critical)"}, {"title": "VARCHAR(255)"}, {"content": "TEXT"}, {"data":
              "JSONB"}, {"status": "ENUM (unread, read, archived)"}, {"channels":
              "ARRAY[ENUM]"}, {"created_at": "TIMESTAMP"}, {"read_at": "TIMESTAMP
              (nullable)"}, {"expires_at": "TIMESTAMP (nullable)"}], "indexes": ["account_id,
              status, created_at (DESC)", "account_id, type", "expires_at (для очистки)"]},
              {"name": "notification_preferences", "description": "Настройки персонализации
              уведомлений", "fields": [{"account_id": "UUID (PK)"}, {"quest_enabled":
              "BOOLEAN"}, {"message_enabled": "BOOLEAN"}, {"achievement_enabled":
              "BOOLEAN"}, {"system_enabled": "BOOLEAN"}, {"friend_enabled": "BOOLEAN"},
              {"guild_enabled": "BOOLEAN"}, {"trade_enabled": "BOOLEAN"}, {"combat_enabled":
              "BOOLEAN"}, {"preferred_channels": "ARRAY[ENUM]"}, {"updated_at": "TIMESTAMP"}]}]},
              "visual_design": {"style": "Cyberpunk 2077", "elements": [{"name": "Notification
              Panel", "description": "Панель уведомлений в правом верхнем углу экрана\nСтиль:
              неоновые цвета, глитч-эффекты, киберпанк шрифты\n", "position": "top-right",
              "animation": "slide-in from right, fade out", "duration": "3-5 секунд
              (зависит от приоритета)"}, {"name": "Notification Types Visual", "quest":
              "Цвет: синий/голубой неон\nИконка: значок квеста\nЗвук: короткий электронный
              сигнал\n", "message": "Цвет: зелёный неон\nИконка: сообщение/чат\nЗвук:
              мягкий уведомляющий звук\n", "achievement": "Цвет: золотой/жёлтый неон\nИконка:
              трофей/медаль\nЗвук: триумфальный звук\n", "system": "Цвет: красный
              неон\nИконка: системный значок\nЗвук: предупреждающий сигнал\n", "friend":
              "Цвет: фиолетовый неон\nИконка: друг/контакт\nЗвук: социальный сигнал\n",
              "guild": "Цвет: оранжевый неон\nИконка: гильдия/группа\nЗвук: групповой
              сигнал\n", "trade": "Цвет: бирюзовый неон\nИконка: торговля/обмен\nЗвук:
              коммерческий сигнал\n", "combat": "Цвет: красный неон (пульсирующий)\nИконка:
              боевой/оружие\nЗвук: боевой сигнал тревоги\n"}, {"name": "Priority Indicators",
              "low": "Прозрачность: 70%\nРазмер: стандартный\nАнимация: плавное появление\n",
              "medium": "Прозрачность: 85%\nРазмер: стандартный\nАнимация: стандартное
              появление\n", "high": "Прозрачность: 100%\nРазмер: увеличенный\nАнимация:
              пульсация\n", "critical": "Прозрачность: 100%\nРазмер: увеличенный\nАнимация:
              пульсация + глитч-эффекты\nЗвук: принудительный (не отключается)\n"}]},
              "client_architecture": {"ue5_modules": [{"name": "NotificationWidget",
              "type": "UUserWidget", "responsibility": "UI компонент для отображения
              одного уведомления\nСодержит: иконку, заголовок, текст, кнопки действий\n",
              "styling": "Использует киберпанк стиль с неоновыми эффектами\nПоддержка
              анимаций появления/исчезновения\n"}, {"name": "NotificationManager",
              "type": "UObject (Singleton)", "responsibility": "Управление очередью
              уведомлений\nПолучение уведомлений от сервера\nПрименение настроек персонализации\nУправление
              жизненным циклом уведомлений\n", "integration": "Подключается к realtime-gateway
              через WebSocket\nСинхронизируется с social-service через REST API\n"},
              {"name": "NotificationSoundManager", "type": "UObject", "responsibility":
              "Воспроизведение звуков уведомлений\nУправление громкостью и приоритетами\nИнтеграция
              с настройками звука игры\n"}, {"name": "NotificationSettings", "type":
              "UObject", "responsibility": "Хранение настроек уведомлений\nСинхронизация
              с сервером\nПрименение настроек в реальном времени\n"}], "data_structures":
              [{"name": "FNotificationData", "fields": [{"Id": "FString (UUID)"},
              {"Type": "ENotificationType"}, {"Priority": "ENotificationPriority"},
              {"Title": "FString"}, {"Content": "FString"}, {"Data": "TMap<FString,
              FString>"}, {"CreatedAt": "FDateTime"}, {"ExpiresAt": "FDateTime (optional)"}]},
              {"name": "FNotificationPreferences", "fields": [{"QuestEnabled": "bool"},
              {"MessageEnabled": "bool"}, {"AchievementEnabled": "bool"}, {"SystemEnabled":
              "bool"}, {"FriendEnabled": "bool"}, {"GuildEnabled": "bool"}, {"TradeEnabled":
              "bool"}, {"CombatEnabled": "bool"}, {"PreferredChannels": "TArray<EDeliveryChannel>"}]}]}},
              "technical_specification": {"backend_requirements": ["Реализация REST
              API endpoints в social-service-go", "Интеграция с event bus для получения
              событий", "Реализация логики маршрутизации по каналам", "Оптимизация
              запросов к БД (индексы, кэширование)", "Реализация batch операций для
              массовых действий"], "realtime_requirements": ["Интеграция social-service
              с realtime-gateway", "Реализация push уведомлений через WebSocket",
              "Управление сессиями и доставкой", "Обработка offline игроков (queue
              для email)"], "client_requirements": ["Создание UI компонентов в UE5",
              "Реализация анимаций и эффектов", "Интеграция с WebSocket клиентом",
              "Реализация звуковой системы", "Создание системы настроек"], "performance_requirements":
              ["Доставка уведомлений < 100ms для online игроков", "Поддержка до 1000
              уведомлений в секунду", "Оптимизация БД запросов (batch, индексы)",
              "Кэширование настроек пользователей"], "scalability_requirements": ["Горизонтальное
              масштабирование social-service", "Распределение нагрузки через realtime-gateway",
              "Очистка старых уведомлений (TTL)", "Rate limiting для предотвращения
              спама"]}, "subtasks": [{"id": "backend-api", "title": "Реализация REST
              API в social-service-go", "description": "Создание всех endpoints для
              управления уведомлениями\nИнтеграция с существующими моделями\n", "priority":
              "high", "estimated_time": "2-3 дня"}, {"id": "event-integration", "title":
              "Интеграция с event sources", "description": "Подключение всех игровых
              сервисов к системе уведомлений\nСоздание event handlers для каждого
              типа события\n", "priority": "high", "estimated_time": "3-4 дня"}, {"id":
              "realtime-delivery", "title": "Реализация realtime доставки", "description":
              "Интеграция social-service с realtime-gateway\nРеализация push уведомлений
              через WebSocket\n", "priority": "high", "estimated_time": "2-3 дня"},
              {"id": "client-ui", "title": "Создание UI компонентов в UE5", "description":
              "Реализация NotificationWidget\nСоздание анимаций и визуальных эффектов\n",
              "priority": "medium", "estimated_time": "4-5 дней"}, {"id": "client-manager",
              "title": "Реализация NotificationManager в UE5", "description": "Создание
              менеджера уведомлений\nИнтеграция с WebSocket\nРеализация логики очереди\n",
              "priority": "medium", "estimated_time": "3-4 дня"}, {"id": "client-sound",
              "title": "Реализация звуковой системы", "description": "Создание NotificationSoundManager\nИнтеграция
              звуков для каждого типа уведомления\n", "priority": "low", "estimated_time":
              "1-2 дня"}, {"id": "client-settings", "title": "Реализация системы настроек",
              "description": "Создание NotificationSettings\nUI для настройки уведомлений\nСинхронизация
              с сервером\n", "priority": "medium", "estimated_time": "2-3 дня"}, {"id":
              "database-optimization", "title": "Оптимизация БД и миграции", "description":
              "Создание индексов\nОптимизация запросов\nРеализация TTL для старых
              уведомлений\n", "priority": "medium", "estimated_time": "1-2 дня"},
              {"id": "testing", "title": "Тестирование системы", "description": "Unit
              тесты для backend\nIntegration тесты для realtime\nUI тесты для клиента\n",
              "priority": "high", "estimated_time": "2-3 дня"}], "diagrams": {"component_diagram":
              "```mermaid\ngraph TB\n    subgraph \"Game Services\"\n        AS[Achievement
              Service]\n        GS[Gameplay Service]\n        ES[Economy Service]\n        SS[Social
              Service]\n        MS[Matchmaking Service]\n    end\n\n    subgraph \"Notification
              System\"\n        NS[Notification Backend<br/>social-service-go:8084]\n        DB[(PostgreSQL<br/>notifications)]\n    end\n\n    subgraph
              \"Realtime Delivery\"\n        RG[Realtime Gateway<br/>realtime-gateway-go]\n        WS[WebSocket
              Connections]\n    end\n\n    subgraph \"Client\"\n        CM[Notification
              Manager]\n        CW[Notification Widget]\n        CS[Notification Sound]\n    end\n\n    AS
              -->|events| NS\n    GS -->|events| NS\n    ES -->|events| NS\n    SS
              -->|events| NS\n    MS -->|events| NS\n\n    NS -->|store| DB\n    NS
              -->|push| RG\n    RG -->|deliver| WS\n    WS -->|receive| CM\n    CM
              -->|display| CW\n    CM -->|play| CS\n```\n", "data_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              GS as Game Service\n    participant NS as Notification Backend\n    participant
              DB as Database\n    participant RG as Realtime Gateway\n    participant
              CL as Client\n\n    GS->>NS: Event (quest_completed)\n    NS->>DB: Check
              user preferences\n    NS->>DB: Create notification\n    NS->>RG: Push
              notification\n    RG->>CL: WebSocket delivery\n    CL->>CL: Display
              in HUD\n    CL->>NS: Mark as read\n    NS->>DB: Update status\n```\n",
              "integration_diagram": "```mermaid\ngraph LR\n    subgraph \"Backend
              Services\"\n        A1[Achievement]\n        A2[Quest]\n        A3[Trade]\n        A4[Social]\n    end\n\n    subgraph
              \"Notification Core\"\n        B1[Event Handler]\n        B2[Router]\n        B3[Delivery
              Manager]\n    end\n\n    subgraph \"Delivery Channels\"\n        C1[In-Game
              HUD]\n        C2[WebSocket]\n        C3[Email]\n    end\n\n    A1 -->
              B1\n    A2 --> B1\n    A3 --> B1\n    A4 --> B1\n    B1 --> B2\n    B2
              --> B3\n    B3 --> C1\n    B3 --> C2\n    B3 --> C3\n```\n"}, "decisions":
              [{"id": "adr-notification-architecture", "summary": "Выбрана event-driven
              архитектура с централизованным обработчиком\nв social-service-go для
              обеспечения единой точки управления\nуведомлениями и упрощения интеграции.\n"},
              {"id": "adr-realtime-delivery", "summary": "Использование realtime-gateway
              для доставки уведомлений\nобеспечивает низкую задержку и масштабируемость
              системы.\n"}, {"id": "adr-client-architecture", "summary": "Модульная
              архитектура клиента (Manager, Widget, Sound, Settings)\nобеспечивает
              гибкость и переиспользование компонентов.\n"}, {"id": "adr-visual-style",
              "summary": "Стиль Cyberpunk 2077 выбран для соответствия общему дизайну
              игры\nи создания атмосферного опыта для игроков.\n"}], "validation":
              {"architecture_complete": true, "components_defined": true, "microservices_identified":
              true, "api_endpoints_described": true, "technical_specification_ready":
              true, "subtasks_defined": true}, "next_steps": ["Передача задачи агенту
              API Designer для создания OpenAPI спецификации", "Детализация API endpoints",
              "Создание request/response схем"], "history": [{"version": "1.0.0",
              "date": "2025-11-22", "author": "Architect Agent", "changes": "Создана
              полная архитектура системы уведомлений:\n- Определены компоненты (Backend,
              Realtime, Client)\n- Описаны API endpoints (высокоуровнево)\n- Спроектированы
              потоки данных\n- Определены визуальные элементы\n- Создано техническое
              задание\n- Разбито на подзадачи\n"}]}'
        - column:
            name: metadata
            value: '{"id": "notification-system-architecture", "title": "Архитектура
              системы уведомлений", "document_type": "architecture", "category": "systems",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-22T18:00:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "notifications", "backend", "client", "realtime"],
              "related_systems": ["social-service-go", "realtime-gateway-go", "achievement-service-go",
              "gameplay-service-go", "economy-service-go"], "related_documents": [{"id":
              "notification-system", "relation": "extends"}], "github_issue": 9, "visibility":
              "internal", "audience": ["architect", "backend", "client", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\notification-system-architecture.yaml
