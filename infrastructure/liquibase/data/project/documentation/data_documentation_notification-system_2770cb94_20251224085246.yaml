databaseChangeLog:
- changeSet:
    id: documentation-notification-system-2770cb94
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '2305164435908616'
        - column:
            name: doc_id
            value: notification-system
        - column:
            name: title
            value: Backend системы уведомлений
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-07 05:20:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - backend
            - social
            - notifications
        - column:
            name: topics
            value:
            - event-driven
            - player-messaging
        - column:
            name: related_systems
            value:
            - social-service
            - world-service
            - email-service
        - column:
            name: related_documents
            value: '[{"id": "session-management-system", "relation": "references"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - social
            - live-ops
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "notification-system", "title": "Backend системы
              уведомлений", "document_type": "implementation", "category": "systems",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-07T05:20:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["backend",
              "social", "notifications"], "topics": ["event-driven", "player-messaging"],
              "related_systems": ["social-service", "world-service", "email-service"],
              "related_documents": [{"id": "session-management-system", "relation":
              "references"}], "source": "", "visibility": "internal", "audience":
              ["concept", "social", "live-ops"], "risk_level": "medium"}, "review":
              {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at":
              "", "status": "pending"}], "next_actions": []}, "summary": {"problem":
              "Требуется единый сервис уведомлений, реагирующий на события из всех
              подсистем.", "goal": "Описать архитектуру и модель данных, позволяющую
              доставлять in-game, WebSocket и email уведомления.", "essence": "Social-service
              обрабатывает события, сохраняет их в истории и доставляет игрокам с
              учётом предпочтений.", "key_points": ["Подписка на события от большинства
              сервисов и отправка в разные каналы.", "Настройки предпочтений и история
              уведомлений для аккаунта.", "Масштабируемая модель данных для push и
              почтовых рассылок."]}, "content": {"sections": [{"id": "service-architecture",
              "title": "Архитектура сервиса", "body": "Notification System реализована
              в social-service (порт 8084) с маршрутом\n`/api/v1/social/notifications/*`.
              Сервис подписывается на событийную шину и обрабатывает\nсобытия дружбы,
              гильдий, торговли, достижений, квестов и боёв. Для online-игроков\nиспользуется
              WebSocket канал world-service; email отправляется для уведомлений высокого\nприоритета.\n",
              "mechanics_links": [], "assets": []}, {"id": "data-model", "title":
              "Модель данных и предпочтения", "body": "Таблица `notifications` хранит
              тип, приоритет, контент, дополнительные данные, статусы и\nканалы доставки.
              Индексы оптимизированы под выборку по аккаунту и очистку просроченных\nуведомлений.
              Настройки предпочтений и история читаемости обеспечивают контроль за\nспамом
              и персонализацию каналов.\n", "mechanics_links": [], "assets": []},
              {"id": "delivery-flow", "title": "Поток доставки", "body": "Сервис проверяет
              пользовательские настройки, сохраняет уведомление, отправляет push\nчерез
              WebSocket при активной сессии и, при необходимости, дублирует email.
              Для высокого\nприоритета используются дополнительные каналы, а события
              логируются для аналитики.\n", "mechanics_links": [], "assets": []}]},
              "appendix": {"glossary": [], "references": [{"type": "api", "path":
              "api/v1/social/notifications/"}, {"type": "repository", "path": "shared/code/backend/social/notification-service/"}],
              "decisions": [{"id": "adr-notification-system", "summary": "Утверждён
              event-driven сервис уведомлений с поддержкой WebSocket и email."}]},
              "implementation": {"needs_task": false, "github_issue": 79, "queue_reference":
              ["shared/trackers/queues/concept/queued.yaml"], "blockers": []}, "history":
              [{"version": "1.0.0", "date": "2025-11-07", "author": "Concept Director",
              "changes": "Описана архитектура уведомлений, каналы доставки и интеграции
              с сервисами."}], "validation": {"checksum": "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "notification-system", "title": "Backend системы уведомлений",
              "document_type": "implementation", "category": "systems", "status":
              "draft", "version": "1.0.0", "last_updated": "2025-11-07T05:20:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["backend",
              "social", "notifications"], "topics": ["event-driven", "player-messaging"],
              "related_systems": ["social-service", "world-service", "email-service"],
              "related_documents": [{"id": "session-management-system", "relation":
              "references"}], "source": "", "visibility": "internal", "audience":
              ["concept", "social", "live-ops"], "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\implementation\backend\notification-system.yaml
