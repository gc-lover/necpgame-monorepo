databaseChangeLog:
- changeSet:
    id: documentation-npc-system-architecture-e7da47ee
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-491008898815896'
        - column:
            name: doc_id
            value: npc-system-architecture
        - column:
            name: title
            value: Архитектура системы основных NPC
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 14:40:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - npc
            - social
            - game-design
            - ui-ux
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - social-service
            - economy-service
            - quest-service
            - gameplay-service
            - world-service
        - column:
            name: related_documents
            value: '[{"id": "npc-hiring-system-architecture", "relation": "extends"},
              {"id": "npc-integration-system-architecture", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - game-design
            - ui-ux
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "npc-system-architecture", "title": "Архитектура
              системы основных NPC", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T14:40:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "npc", "social", "game-design", "ui-ux"], "related_systems":
              ["social-service", "economy-service", "quest-service", "gameplay-service",
              "world-service"], "related_documents": [{"id": "npc-hiring-system-architecture",
              "relation": "extends"}, {"id": "npc-integration-system-architecture",
              "relation": "extends"}], "github_issue": 407, "visibility": "internal",
              "audience": ["architect", "backend", "game-design", "ui-ux", "api-designer"]},
              "summary": {"problem": "Требуется спроектировать архитектуру системы
              основных NPC, включающую:\n- Типы NPC (Фиксер, Торговец, Тренер, Главарь
              банды, Директор корпорации и др.)\n- Интерфейсы взаимодействия для каждого
              типа\n- Функционал, доступный при взаимодействии\n- Интеграцию с квестами,
              экономикой, репутацией, навыками и фракциями\n", "goal": "Создать архитектурную
              схему системы основных NPC с определением:\n- Компонентов для управления
              типами NPC и их функционалом\n- REST, WebSocket и Event Bus контрактов\n-
              Интерфейсов взаимодействия (диалоги, торговля, обучение, фракции)\n-
              Интеграций с другими системами\n- Структуры БД для NPC, их типов и взаимодействий\n-
              Технического задания для реализации\n", "essence": "Система основных
              NPC обеспечивает взаимодействие игроков с различными типами NPC\n(Фиксер,
              Торговец, Тренер, Главарь банды, Директор корпорации и др.) через специализированные\nинтерфейсы
              (диалоги, торговля, обучение, фракции) с интеграцией в квесты, экономику,\nрепутацию,
              навыки и фракционную систему.\n"}, "architecture": {"overview": "Система
              основных NPC состоит из следующих компонентов:\n1. NPC Type Manager
              - управление типами NPC и их функционалом\n2. NPC Interaction Manager
              - управление взаимодействиями с NPC\n3. Dialogue System - система диалогов
              с ветвлением\n4. Trading Interface Manager - управление торговыми интерфейсами\n5.
              Training Interface Manager - управление интерфейсами обучения\n6. Faction
              Interface Manager - управление фракционными интерфейсами\n7. NPC Quest
              Provider - предоставление квестов от NPC\n8. NPC Reputation Tracker
              - отслеживание репутации с NPC\n9. NPC State Manager - управление состоянием
              NPC\n", "microservices": [{"name": "social-service", "port": 8084, "responsibility":
              "Основной сервис для системы NPC:\n- Управление типами NPC\n- Управление
              взаимодействиями\n- Система диалогов\n- Управление репутацией с NPC\n-
              Интеграция с фракциями\n", "components": ["NPC Type Manager", "NPC Interaction
              Manager", "Dialogue System", "NPC Reputation Tracker", "NPC State Manager",
              "Faction Interface Manager"], "endpoints": ["GET /api/v1/social/npc
              - список NPC", "GET /api/v1/social/npc/{id} - детали NPC", "GET /api/v1/social/npc/types
              - типы NPC", "GET /api/v1/social/npc/{id}/interact - начать взаимодействие",
              "GET /api/v1/social/npc/{id}/dialogue - диалог с NPC", "POST /api/v1/social/npc/{id}/dialogue/response
              - ответ в диалоге", "GET /api/v1/social/npc/{id}/reputation - репутация
              с NPC", "GET /api/v1/social/npc/{id}/quests - квесты от NPC"]}, {"name":
              "economy-service", "port": 8085, "responsibility": "Торговые интерфейсы
              для NPC:\n- Управление торговыми интерфейсами\n- Каталоги товаров NPC\n-
              Покупка/продажа предметов\n- Обмен валют\n- Ремонт и модификация оборудования\n-
              Специальные предложения\n", "components": ["Trading Interface Manager",
              "NPC Trader Catalog", "Currency Exchange Handler", "Equipment Repair
              Handler"], "endpoints": ["GET /api/v1/economy/npc/{id}/shop - магазин
              NPC", "GET /api/v1/economy/npc/{id}/shop/items - товары в магазине",
              "POST /api/v1/economy/npc/{id}/shop/buy - покупка предмета", "POST /api/v1/economy/npc/{id}/shop/sell
              - продажа предмета", "POST /api/v1/economy/npc/{id}/repair - ремонт
              оборудования", "GET /api/v1/economy/npc/{id}/currency-exchange - обмен
              валют"]}, {"name": "gameplay-service", "port": 8083, "responsibility":
              "Интерфейсы обучения для NPC:\n- Управление интерфейсами обучения\n-
              Дерево навыков\n- Обучение новым навыкам\n- Повышение уровня навыков\n-
              Тренировочные режимы\n", "components": ["Training Interface Manager",
              "Skill Tree Manager", "Skill Trainer", "Training Simulator"], "endpoints":
              ["GET /api/v1/gameplay/npc/{id}/training - обучение у NPC", "GET /api/v1/gameplay/npc/{id}/skills
              - доступные навыки", "POST /api/v1/gameplay/npc/{id}/skills/{skill_id}/learn
              - изучить навык", "POST /api/v1/gameplay/npc/{id}/skills/{skill_id}/upgrade
              - повысить навык", "GET /api/v1/gameplay/npc/{id}/training/simulations
              - тренировочные режимы"]}, {"name": "quest-service", "port": 8087, "responsibility":
              "Квесты от NPC:\n- Предоставление квестов от NPC\n- Управление квестовыми
              цепочками\n- Проверка условий доступности\n- Выдача наград\n", "components":
              ["NPC Quest Provider", "Quest Chain Manager", "Quest Condition Validator"],
              "endpoints": ["GET /api/v1/quests/npc/{id}/available - доступные квесты",
              "GET /api/v1/quests/npc/{id}/active - активные квесты", "POST /api/v1/quests/npc/{id}/quests/{quest_id}/accept
              - принять квест", "POST /api/v1/quests/npc/{id}/quests/{quest_id}/complete
              - завершить квест"]}], "components": [{"name": "NPC Type Manager", "location":
              "social-service", "responsibility": "Управление типами NPC:\n- Реестр
              типов NPC (Fixer, Trader, Trainer, Gang Leader, Corporate Director и
              др.)\n- Функционал каждого типа\n- Специализация NPC\n- Связь с фракциями\n",
              "npc_types": [{"Fixer": "посредник, контракты, квесты, контакты"}, {"Trader":
              "торговля, ремонт, модификация, аукционы"}, {"Trainer": "обучение навыкам,
              тренировки, симуляции"}, {"Gang Leader": "банды, задания, территория,
              войны"}, {"Corporate Director": "корпорации, контракты, карьера, политика"},
              {"Medic": "лечение, импланты, киберимпланты"}, {"Engineer": "крафт,
              модификация оружия, создание предметов"}, {"Hacker": "взлом, доступ
              к данным, кибербезопасность"}, {"Informant": "информация, слухи, разведка"},
              {"Bartender": "социальный хаб, слухи, встречи"}, {"Guard": "контроль
              доступа, безопасность территорий"}], "dependencies": ["Database", "Social
              Service (фракции)"]}, {"name": "NPC Interaction Manager", "location":
              "social-service", "responsibility": "Управление взаимодействиями:\n-
              Инициализация взаимодействия\n- Определение доступных действий\n- Переключение
              между интерфейсами\n- Завершение взаимодействия\n- История взаимодействий\n",
              "dependencies": ["NPC Type Manager", "Dialogue System", "Trading Interface
              Manager", "Training Interface Manager", "Faction Interface Manager"]},
              {"name": "Dialogue System", "location": "social-service", "responsibility":
              "Система диалогов:\n- Дерево диалогов с ветвлением\n- Выбор ответов
              игрока\n- Условия доступности реплик\n- Влияние на репутацию\n- Триггеры
              квестов и событий\n- Сохранение прогресса диалогов\n", "dependencies":
              ["NPC State Manager", "NPC Reputation Tracker", "Quest Service"]}, {"name":
              "Trading Interface Manager", "location": "economy-service", "responsibility":
              "Управление торговыми интерфейсами:\n- Каталог товаров NPC\n- Фильтрация
              и поиск\n- Покупка/продажа предметов\n- Обмен валют\n- Ремонт оборудования\n-
              Специальные предложения\n- Аукционы\n", "dependencies": ["Inventory
              Service", "Wallet Service", "NPC Trader Catalog"]}, {"name": "Training
              Interface Manager", "location": "gameplay-service", "responsibility":
              "Управление интерфейсами обучения:\n- Дерево навыков\n- Доступные навыки
              для обучения\n- Стоимость обучения\n- Требования к обучению\n- Тренировочные
              режимы\n- Симуляции\n", "dependencies": ["Skill System", "Progression
              Service", "Wallet Service"]}, {"name": "Faction Interface Manager",
              "location": "social-service", "responsibility": "Управление фракционными
              интерфейсами:\n- Вступление в банду/корпорацию\n- Получение заданий\n-
              Доступ к ресурсам\n- Управление территорией\n- Войны между фракциями\n-
              Карьерная лестница\n", "dependencies": ["Faction System", "Quest Service",
              "World Service (территории)"]}, {"name": "NPC Quest Provider", "location":
              "quest-service", "responsibility": "Предоставление квестов от NPC:\n-
              Список доступных квестов\n- Условия доступности\n- Цепочки квестов\n-
              Выдача наград\n- Прогресс квестов\n", "dependencies": ["Quest System",
              "NPC Reputation Tracker", "NPC State Manager"]}, {"name": "NPC Reputation
              Tracker", "location": "social-service", "responsibility": "Отслеживание
              репутации:\n- Репутация с каждым NPC\n- Влияние действий на репутацию\n-
              Уровни репутации (Hostile, Neutral, Friendly, Trusted)\n- Разблокировка
              контента по репутации\n- История изменений репутации\n", "dependencies":
              ["Database", "Relationship System"]}, {"name": "NPC State Manager",
              "location": "social-service", "responsibility": "Управление состоянием
              NPC:\n- Текущее состояние (Available, Busy, Unavailable)\n- Расположение
              NPC\n- Активность NPC\n- История взаимодействий\n- Сохранение прогресса
              диалогов\n", "dependencies": ["Database", "World Service (локации)"]}],
              "integrations": [{"name": "Quest Service Integration", "description":
              "Интеграция с системой квестов:\n- NPC предоставляют квесты\n- Условия
              доступности квестов\n- Выдача наград\n- Прогресс квестов\n", "events":
              ["quest.available", "quest.accepted", "quest.completed"], "endpoints":
              ["GET /api/v1/quests/npc/{id}/quests"]}, {"name": "Economy Service Integration",
              "description": "Интеграция с экономикой:\n- Торговля с NPC\n- Цены на
              товары\n- Обмен валют\n- Ремонт оборудования\n", "events": ["economy.trade.completed",
              "economy.currency.exchanged"], "endpoints": ["GET /api/v1/economy/npc/{id}/shop"]},
              {"name": "Reputation System Integration", "description": "Интеграция
              с системой репутации:\n- Влияние действий на репутацию\n- Разблокировка
              контента\n- Уровни доступа\n", "events": ["reputation.changed", "reputation.level_up"],
              "endpoints": ["GET /api/v1/social/npc/{id}/reputation"]}, {"name": "Skill
              System Integration", "description": "Интеграция с системой навыков:\n-
              Обучение навыкам\n- Повышение уровня\n- Тренировки\n", "events": ["skill.learned",
              "skill.upgraded"], "endpoints": ["GET /api/v1/gameplay/npc/{id}/training"]},
              {"name": "Faction System Integration", "description": "Интеграция с
              фракционной системой:\n- Вступление в фракции\n- Задания фракций\n-
              Доступ к ресурсам\n- Управление территорией\n", "events": ["faction.joined",
              "faction.quest.available", "territory.control.changed"], "endpoints":
              ["GET /api/v1/social/factions/{id}/npc"]}], "database": {"tables": [{"name":
              "npc_types", "description": "Типы NPC", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"name": "VARCHAR(100) UNIQUE"}, {"display_name": "VARCHAR(255)"},
              {"description": "TEXT"}, {"functionality": "JSONB"}, {"default_interfaces":
              "JSONB"}, {"created_at": "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}]},
              {"name": "npcs", "description": "NPC в игре", "columns": [{"id": "UUID
              PRIMARY KEY"}, {"npc_type_id": "UUID REFERENCES npc_types(id)"}, {"name":
              "VARCHAR(255)"}, {"location_id": "UUID"}, {"faction_id": "UUID NULL"},
              {"state": "VARCHAR(50) (AVAILABLE, BUSY, UNAVAILABLE)"}, {"metadata":
              "JSONB"}, {"created_at": "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}]},
              {"name": "npc_dialogues", "description": "Диалоги с NPC", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"npc_id": "UUID REFERENCES npcs(id)"}]}]}}}'
        - column:
            name: metadata
            value: '{"id": "npc-system-architecture", "title": "Архитектура системы
              основных NPC", "document_type": "architecture", "category": "systems",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T14:40:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "npc", "social", "game-design", "ui-ux"], "related_systems":
              ["social-service", "economy-service", "quest-service", "gameplay-service",
              "world-service"], "related_documents": [{"id": "npc-hiring-system-architecture",
              "relation": "extends"}, {"id": "npc-integration-system-architecture",
              "relation": "extends"}], "github_issue": 407, "visibility": "internal",
              "audience": ["architect", "backend", "game-design", "ui-ux", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\npc-system-architecture.yaml
