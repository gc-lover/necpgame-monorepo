databaseChangeLog:
- changeSet:
    id: documentation-player-character-technical-39fc100c
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '4590144998392115'
        - column:
            name: doc_id
            value: player-character-technical
        - column:
            name: title
            value: Архитектура системы управления персонажами игроков - Техническое
              задание
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.1.0
        - column:
            name: last_updated
            value: 2025-11-30 20:45:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[]'
        - column:
            name: tags
            value: []
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value: []
        - column:
            name: related_documents
            value: '[{"id": "player-character-core", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: ''
        - column:
            name: audience
            value: []
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "player-character-technical", "title": "Архитектура
              системы управления персонажами игроков - Техническое задание", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.1.0", "last_updated": "2025-11-30T20:45:00+00:00", "github_issue":
              389, "related_documents": [{"id": "player-character-core", "relation":
              "extends"}]}, "technical_specification": {"backend_requirements": [{"Реализация
              модулей в character-service-go": ["character-creation (создание персонажей)",
              "character-deletion (удаление персонажей)", "character-restoration (восстановление
              персонажей)", "character-switching (переключение персонажей)", "slot-management
              (управление слотами)", "stats-recalculation (пересчёт статов)", "character-state
              (сохранение и загрузка состояния)"]}, "Интеграция с inventory-service
              для инвентаря", "Интеграция с quest-service для квестов", "Интеграция
              с session-service для сессий", "Интеграция с economy-service для валюты",
              "Оптимизация запросов к БД (индексы, кэширование)"], "realtime_requirements":
              ["Синхронизация состояния персонажа через WebSocket", "Уведомления о
              событиях", "Обновления в реальном времени"], "performance_requirements":
              ["Создание персонажа < 500ms", "Удаление персонажа < 300ms", "Переключение
              персонажа < 400ms", "Пересчёт статов < 200ms", "Загрузка состояния <
              300ms", "Поддержка до 1M персонажей", "Поддержка до 100K одновременных
              переключений"], "scalability_requirements": ["Горизонтальное масштабирование
              через character-service", "Распределение нагрузки на персонажей", "Оптимизация
              запросов к БД (batch, индексы)", "Кэширование состояния персонажей в
              Redis", "Оптимизация интеграций"]}, "subtasks": [{"id": "character-creation-manager-module",
              "title": "Реализация модуля Character Creation Manager", "description":
              "Создание персонажей\nВалидация данных\nПроверка слотов\nВыдача стартовых
              ресурсов\n", "priority": "high", "estimated_time": "4-5 дней"}, {"id":
              "character-deletion-manager", "title": "Реализация Character Deletion
              Manager", "description": "Удаление персонажей (soft delete)\nОсвобождение
              слотов\nУстановка окна восстановления\n", "priority": "high", "estimated_time":
              "3-4 дня"}, {"id": "character-restoration-manager", "title": "Реализация
              Character Restoration Manager", "description": "Восстановление удалённых
              персонажей\nПроверка окна восстановления\nВозврат слотов\n", "priority":
              "high", "estimated_time": "3-4 дня"}, {"id": "character-switching-manager",
              "title": "Реализация Character Switching Manager", "description": "Переключение
              между персонажами\nСохранение текущего персонажа\nОбновление сессии\n",
              "priority": "high", "estimated_time": "4-5 дней"}, {"id": "slot-management-manager",
              "title": "Реализация Slot Management Manager", "description": "Управление
              слотами персонажей\nПокупка дополнительных слотов\nОтслеживание использования
              слотов\n", "priority": "high", "estimated_time": "3-4 дня"}, {"id":
              "stats-recalculation-manager", "title": "Реализация Stats Recalculation
              Manager", "description": "Пересчёт боевых статов\nУчёт атрибутов, экипировки
              и бафов\nСинхронизация здоровья и брони\n", "priority": "high", "estimated_time":
              "3-4 дня"}, {"id": "character-state-manager", "title": "Реализация Character
              State Manager", "description": "Сохранение состояния персонажа\nЗагрузка
              состояния персонажа\nСоздание снапшотов\n", "priority": "high", "estimated_time":
              "4-5 дней"}, {"id": "database-optimization", "title": "Оптимизация БД
              и запросов", "description": "Создание индексов\nОптимизация запросов\nКэширование
              состояния\n", "priority": "medium", "estimated_time": "2-3 дня"}, {"id":
              "api-endpoints", "title": "Реализация REST API endpoints", "description":
              "Создание всех endpoints для управления персонажами\nИнтеграция с существующим
              API character-service\n", "priority": "high", "estimated_time": "3-4
              дня"}, {"id": "integration-testing", "title": "Интеграционное тестирование",
              "description": "Тесты создания персонажей\nТесты удаления персонажей\nТесты
              переключения персонажей\nТесты управления слотами\nТесты пересчёта статов\nТесты
              интеграций\n", "priority": "high", "estimated_time": "5-6 дней"}], "diagrams":
              {"component_diagram": "```mermaid\ngraph TB\n    subgraph \"Character
              Service\"\n        CCM[Character Creation Manager]\n        CDM[Character
              Deletion Manager]\n        CRM[Character Restoration Manager]\n        CSM[Character
              Switching Manager]\n        SMM[Slot Management Manager]\n        SRM[Stats
              Recalculation Manager]\n        CSM2[Character State Manager]\n    end\n\n    subgraph
              \"Database\"\n        DB[(PostgreSQL<br/>players<br/>characters<br/>character_slots<br/>character_snapshots)]\n    end\n\n    subgraph
              \"External Services\"\n        IS[Inventory Service]\n        QS[Quest
              Service]\n        SS[Session Service]\n        ES[Economy Service]\n        NS[Notification
              Service]\n        RG[Realtime Gateway]\n    end\n\n    subgraph \"Client\"\n        CL[UE5
              Client]\n    end\n\n    CL -->|create character| CCM\n    CL -->|switch
              character| CSM\n    CCM --> IS\n    CCM --> QS\n    CSM --> SS\n    SMM
              --> ES\n    CDM --> NS\n    CSM --> RG\n    RG -->|push events| CL\n```\n",
              "data_flow_diagram": "```mermaid\nsequenceDiagram\n    participant P
              as Player\n    participant CCM as Character Creation Manager\n    participant
              IS as Inventory Service\n    participant QS as Quest Service\n\n    P->>CCM:
              Create character\n    CCM->>IS: Create inventory\n    CCM->>QS: Assign
              initial quests\n    CCM->>P: Character created\n```\n"}, "decisions":
              [{"id": "adr-player-character-architecture", "summary": "Выбрана модульная
              архитектура внутри character-service-go для обеспечения\nцентрализованного
              управления персонажами игроков.\n"}, {"id": "adr-soft-delete", "summary":
              "Использован soft delete для возможности восстановления персонажей в
              течение\n30 дней, что улучшает пользовательский опыт.\n"}, {"id": "adr-slot-management",
              "summary": "Система слотов с базовыми и премиальными слотами обеспечивает
              гибкость\nв управлении персонажами и монетизацию.\n"}, {"id": "adr-stats-recalculation",
              "summary": "Пересчёт статов с учётом атрибутов, экипировки и бафов обеспечивает\nактуальность
              боевых характеристик персонажа.\n"}, {"id": "adr-character-state", "summary":
              "Система сохранения и загрузки состояния с снапшотами обеспечивает\nнадёжность
              и возможность восстановления данных.\n"}], "validation": {"architecture_complete":
              true, "components_defined": true, "microservices_identified": true,
              "api_endpoints_described": true, "technical_specification_ready": true,
              "subtasks_defined": true}, "next_steps": ["Передача задачи агенту API
              Designer для создания OpenAPI спецификации", "Детализация API endpoints",
              "Создание request/response схем", "Определение формата данных персонажей
              и слотов"], "history": [{"version": "1.1.0", "date": "2025-11-30", "author":
              "Architect Agent", "changes": "Добавлена детальная синхронизация данных:\n-
              Event Sourcing для всех изменений состояния персонажей\n- CQRS Pattern
              для разделения команд и запросов\n- Saga Pattern для распределенных
              операций (создание персонажа, удаление, переключение, покупка слотов)\n-
              Outbox Pattern для гарантированной доставки событий\n- Обновлена секция
              data_consistency с механизмами синхронизации\n- Добавлена спецификация
              тикрейта для создания, удаления, восстановления, переключения, управления
              слотами, пересчёта статов, управления состоянием и обработки событий\n"},
              {"version": "1.0.0", "date": "2025-11-23", "author": "Architect Agent",
              "changes": "Создана полная архитектура системы управления персонажами
              игроков:\n- Определены компоненты (Character Creation Manager, Character
              Deletion Manager, Character Restoration Manager, Character Switching
              Manager, Slot Management Manager, Stats Recalculation Manager, Character
              State Manager)\n- Описаны API endpoints (высокоуровнево)\n- Спроектированы
              потоки данных\n- Определена структура БД (players, characters, character_slots,
              character_snapshots)\n- Спроектирована система создания персонажей\n-
              Спроектирована система удаления персонажей (soft delete)\n- Спроектирована
              система восстановления персонажей\n- Спроектирована система переключения
              персонажей\n- Спроектирована система управления слотами\n- Спроектирована
              система пересчёта статов\n- Спроектирована система сохранения и загрузки
              состояния\n- Создано техническое задание\n- Разбито на подзадачи\n"}]}'
        - column:
            name: metadata
            value: '{"id": "player-character-technical", "title": "Архитектура системы
              управления персонажами игроков - Техническое задание", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.1.0", "last_updated": "2025-11-30T20:45:00+00:00", "github_issue":
              389, "related_documents": [{"id": "player-character-core", "relation":
              "extends"}]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\player-character-technical.yaml
