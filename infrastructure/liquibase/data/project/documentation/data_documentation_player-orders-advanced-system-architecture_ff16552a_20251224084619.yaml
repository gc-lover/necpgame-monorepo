databaseChangeLog:
- changeSet:
    id: documentation-player-orders-advanced-system-architecture-ff16552a
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-591965935257679'
        - column:
            name: doc_id
            value: arch-player-orders-advanced
        - column:
            name: title
            value: Player Orders Advanced System Architecture
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: social
        - column:
            name: status
            value: approved
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-02 20:35:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[]'
        - column:
            name: tags
            value: []
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value: []
        - column:
            name: related_documents
            value: '["mechanics/social/player-orders-advanced.yaml", "architecture/social-player-orders-system-architecture.yaml"]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: ''
        - column:
            name: audience
            value: []
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "arch-player-orders-advanced", "title": "Player
              Orders Advanced System Architecture", "document_type": "architecture",
              "category": "social", "status": "approved", "version": "1.0.0", "last_updated":
              "2025-12-02T20:35:00+00:00", "architect": "ai-agent", "github_issue":
              305, "related_documents": ["mechanics/social/player-orders-advanced.yaml",
              "architecture/social-player-orders-system-architecture.yaml"]}, "summary":
              {"problem": "Расширить базовую систему заказов продвинутыми механиками:
              multi-executor, auctions, arbitration, insurance", "goal": "Создать
              архитектуру для сложных социальных взаимодействий вокруг заказов", "essence":
              "Advanced Orders Service добавляет многопользовательские заказы, аукционы,
              арбитраж и страхование"}, "components": [{"name": "Multi-Executor Order
              Manager", "type": "core", "responsibilities": ["Создание заказов с несколькими
              ролями", "Приглашение и подтверждение участников", "Распределение наград
              по вкладу", "Координация выполнения"], "integration": ["player-orders-core-service",
              "social-service"]}, {"name": "Order Auction System", "type": "core",
              "responsibilities": ["Создание аукционов на заказы", "Прием ставок от
              исполнителей", "Автоматическое завершение аукциона", "Выбор победителя"],
              "integration": ["player-orders-core-service", "economy-service"]}, {"name":
              "Arbitration Service", "type": "core", "responsibilities": ["Создание
              споров по заказам", "Сбор доказательств (screenshots, logs)", "Арбитражное
              разбирательство", "Вынесение решения и компенсация"], "integration":
              ["player-orders-core-service", "reputation-service", "anti-cheat-service"]},
              {"name": "Insurance Manager", "type": "supporting", "responsibilities":
              ["Расчет стоимости страховки", "Активация страховки при провале", "Выплата
              компенсаций", "Fraud detection"], "integration": ["player-orders-core-service",
              "economy-service", "wallet-service"]}], "api_endpoints": {"multi_executor":
              {"base_path": "/api/v1/orders/multi-executor", "endpoints": [{"method":
              "POST", "path": "/orders/multi-executor", "description": "Создать multi-executor
              заказ", "expected_rps": 100}, {"method": "POST", "path": "/orders/{id}/invite",
              "description": "Пригласить участника", "expected_rps": 200}, {"method":
              "POST", "path": "/orders/{id}/join", "description": "Присоединиться
              к заказу", "expected_rps": 300}, {"method": "GET", "path": "/orders/{id}/participants",
              "description": "Список участников", "expected_rps": 500}]}, "auctions":
              {"base_path": "/api/v1/orders/auctions", "endpoints": [{"method": "POST",
              "path": "/auctions", "description": "Создать аукцион на заказ", "expected_rps":
              50}, {"method": "POST", "path": "/auctions/{id}/bids", "description":
              "Сделать ставку", "expected_rps": 200}, {"method": "GET", "path": "/auctions/{id}",
              "description": "Статус аукциона", "expected_rps": 300}, {"method": "POST",
              "path": "/auctions/{id}/complete", "description": "Завершить аукцион",
              "expected_rps": 50}]}, "arbitration": {"base_path": "/api/v1/orders/arbitration",
              "endpoints": [{"method": "POST", "path": "/disputes", "description":
              "Создать спор", "expected_rps": 20}, {"method": "POST", "path": "/disputes/{id}/evidence",
              "description": "Добавить доказательства", "expected_rps": 50}, {"method":
              "GET", "path": "/disputes/{id}", "description": "Статус спора", "expected_rps":
              100}, {"method": "POST", "path": "/disputes/{id}/resolve", "description":
              "Разрешить спор (arbitrator)", "expected_rps": 10}]}, "insurance": {"base_path":
              "/api/v1/orders/insurance", "endpoints": [{"method": "GET", "path":
              "/orders/{id}/insurance/quote", "description": "Расчет стоимости страховки",
              "expected_rps": 300}, {"method": "POST", "path": "/orders/{id}/insurance/purchase",
              "description": "Купить страховку", "expected_rps": 100}, {"method":
              "POST", "path": "/orders/{id}/insurance/claim", "description": "Заявка
              на выплату", "expected_rps": 50}]}}, "data_model": {"entities": [{"name":
              "MultiExecutorOrder", "description": "Заказ с несколькими исполнителями",
              "fields_ordered_by_size": [{"name": "base_order_id", "type": "uuid",
              "size": "16 bytes"}, {"name": "total_reward", "type": "int64", "size":
              "8 bytes"}, {"name": "coordinator_bonus_percent", "type": "int32", "size":
              "4 bytes"}, {"name": "min_participants", "type": "int32", "size": "4
              bytes"}, {"name": "max_participants", "type": "int32", "size": "4 bytes"},
              {"name": "status", "type": "enum", "size": "1 byte"}], "expected_struct_size":
              "~48 bytes"}, {"name": "OrderParticipant", "description": "Участник
              multi-executor заказа", "fields_ordered_by_size": [{"name": "order_id",
              "type": "uuid", "size": "16 bytes"}, {"name": "player_id", "type": "uuid",
              "size": "16 bytes"}, {"name": "role", "type": "string", "size": "16
              bytes"}, {"name": "contribution_percent", "type": "int32", "size": "4
              bytes"}, {"name": "reward_share", "type": "int64", "size": "8 bytes"},
              {"name": "confirmed", "type": "bool", "size": "1 byte"}], "expected_struct_size":
              "~64 bytes"}, {"name": "OrderAuction", "description": "Аукцион на заказ",
              "fields_ordered_by_size": [{"name": "order_id", "type": "uuid", "size":
              "16 bytes"}, {"name": "starting_bid", "type": "int64", "size": "8 bytes"},
              {"name": "current_bid", "type": "int64", "size": "8 bytes"}, {"name":
              "end_time", "type": "timestamp", "size": "8 bytes"}, {"name": "winner_id",
              "type": "uuid", "size": "16 bytes (nullable)"}, {"name": "status", "type":
              "enum", "size": "1 byte"}], "expected_struct_size": "~60 bytes"}, {"name":
              "OrderDispute", "description": "Спор по заказу", "fields_ordered_by_size":
              [{"name": "order_id", "type": "uuid", "size": "16 bytes"}, {"name":
              "plaintiff_id", "type": "uuid", "size": "16 bytes"}, {"name": "defendant_id",
              "type": "uuid", "size": "16 bytes"}, {"name": "arbitrator_id", "type":
              "uuid", "size": "16 bytes (nullable)"}, {"name": "resolution", "type":
              "string", "size": "16 bytes"}, {"name": "compensation", "type": "int64",
              "size": "8 bytes"}, {"name": "status", "type": "enum", "size": "1 byte"}],
              "expected_struct_size": "~92 bytes"}, {"name": "OrderInsurance", "description":
              "Страховка заказа", "fields_ordered_by_size": [{"name": "order_id",
              "type": "uuid", "size": "16 bytes"}, {"name": "premium", "type": "int64",
              "size": "8 bytes"}, {"name": "coverage", "type": "int64", "size": "8
              bytes"}, {"name": "claimed", "type": "bool", "size": "1 byte"}], "expected_struct_size":
              "~36 bytes"}]}, "database_schema": {"tables": [{"name": "multi_executor_orders",
              "columns": ["id UUID PRIMARY KEY", "base_order_id UUID NOT NULL REFERENCES
              orders(id)", "total_reward BIGINT NOT NULL", "coordinator_bonus_percent
              INTEGER NOT NULL DEFAULT 10", "min_participants INTEGER NOT NULL DEFAULT
              2", "max_participants INTEGER NOT NULL DEFAULT 10", "status VARCHAR(20)
              NOT NULL", "created_at TIMESTAMP NOT NULL DEFAULT NOW()"], "indexes":
              ["idx_multi_orders_base ON multi_executor_orders(base_order_id)", "idx_multi_orders_status
              ON multi_executor_orders(status)"], "expected_rows": 5000}, {"name":
              "order_participants", "columns": ["id UUID PRIMARY KEY", "order_id UUID
              NOT NULL REFERENCES multi_executor_orders(id)", "player_id UUID NOT
              NULL", "role VARCHAR(50) NOT NULL", "contribution_percent INTEGER NOT
              NULL DEFAULT 0", "reward_share BIGINT NOT NULL DEFAULT 0", "confirmed
              BOOLEAN NOT NULL DEFAULT false", "joined_at TIMESTAMP NOT NULL DEFAULT
              NOW()"], "indexes": ["idx_participants_order ON order_participants(order_id)",
              "idx_participants_player ON order_participants(player_id)"], "expected_rows":
              30000}, {"name": "order_auctions", "columns": ["id UUID PRIMARY KEY",
              "order_id UUID NOT NULL REFERENCES orders(id)", "starting_bid BIGINT
              NOT NULL", "current_bid BIGINT NOT NULL", "winner_id UUID", "end_time
              TIMESTAMP NOT NULL", "status VARCHAR(20) NOT NULL", "created_at TIMESTAMP
              NOT NULL DEFAULT NOW()"], "indexes": ["idx_auctions_order ON order_auctions(order_id)",
              "idx_auctions_end_time ON order_auctions(end_time) WHERE status = ''active''"],
              "expected_rows": 3000}, {"name": "order_disputes", "columns": ["id UUID
              PRIMARY KEY", "order_id UUID NOT NULL REFERENCES orders(id)", "plaintiff_id
              UUID NOT NULL", "defendant_id UUID NOT NULL", "arbitrator_id UUID",
              "description TEXT NOT NULL", "resolution TEXT", "compensation BIGINT
              NOT NULL DEFAULT 0", "status VARCHAR(20) NOT NULL", "created_at TIMESTAMP
              NOT NULL DEFAULT NOW()", "resolved_at TIMESTAMP"], "indexes": ["idx_disputes_order
              ON order_disputes(order_id)", "idx_disputes_status ON order_disputes(status)",
              "idx_disputes_arbitrator ON order_disputes(arbitrator_id) WHERE arbitrator_id
              IS NOT NULL"], "expected_rows": 1000}, {"name": "order_insurance", "columns":
              ["id UUID PRIMARY KEY", "order_id UUID NOT NULL REFERENCES orders(id)",
              "premium BIGINT NOT NULL", "coverage BIGINT NOT NULL", "claimed BOOLEAN
              NOT NULL DEFAULT false", "purchased_at TIMESTAMP NOT NULL DEFAULT NOW()",
              "claimed_at TIMESTAMP"], "indexes": ["idx_insurance_order ON order_insurance(order_id)",
              "idx_insurance_claimed ON order_insurance(claimed) WHERE claimed = true"],
              "expected_rows": 10000}]}, "event_bus_contracts": {"publishes": [{"topic":
              "orders.multi_executor.created", "description": "Multi-executor заказ
              создан"}, {"topic": "orders.auction.bid_placed", "description": "Ставка
              сделана на аукционе"}, {"topic": "orders.dispute.created", "description":
              "Спор создан"}, {"topic": "orders.insurance.claimed", "description":
              "Страховка активирована"}], "subscribes": [{"topic": "orders.completed",
              "description": "Заказ выполнен - распределить награды"}, {"topic": "orders.failed",
              "description": "Заказ провален - обработать insurance"}]}, "data_synchronization":
              {"pattern": "Event Sourcing + Saga Pattern", "sagas": [{"name": "Multi-Executor
              Order Completion", "steps": ["Validate all participants confirmed",
              "Calculate reward distribution", "Transfer rewards to participants",
              "Update reputation for all"]}, {"name": "Auction Completion", "steps":
              ["Close bidding", "Assign order to winner", "Charge auction fee", "Notify
              participants"]}, {"name": "Dispute Resolution", "steps": ["Freeze order
              funds", "Collect evidence", "Arbitrator review", "Execute compensation",
              "Update reputation"]}, {"name": "Insurance Claim", "steps": ["Validate
              claim", "Fraud check", "Calculate payout", "Transfer funds"]}]}, "performance_requirements":
              {"load": {"peak_rps": 1000, "concurrent_users": 5000, "p99_latency":
              "<100ms"}, "backend_optimizations": {"level": 1, "required": ["DB connection
              pool", "Transaction handling", "Event bus integration"]}}, "tick_rate":
              {"type": "event-based", "auction_check_interval": "30 seconds", "dispute_timeout":
              "72 hours"}, "integration": {"services": [{"name": "player-orders-core-service",
              "integration_type": "API + Event Bus", "description": "Базовая система
              заказов"}, {"name": "reputation-service", "integration_type": "Event
              Bus", "description": "Обновление репутации"}, {"name": "wallet-service",
              "integration_type": "API", "description": "Переводы средств"}, {"name":
              "anti-cheat-service", "integration_type": "API", "description": "Fraud
              detection"}]}, "notes": ["Расширение базовой системы Player Orders",
              "Saga Pattern для сложных транзакций", "Arbitration требует manual review",
              "Insurance требует fraud detection"]}'
        - column:
            name: metadata
            value: '{"id": "arch-player-orders-advanced", "title": "Player Orders
              Advanced System Architecture", "document_type": "architecture", "category":
              "social", "status": "approved", "version": "1.0.0", "last_updated":
              "2025-12-02T20:35:00+00:00", "architect": "ai-agent", "github_issue":
              305, "related_documents": ["mechanics/social/player-orders-advanced.yaml",
              "architecture/social-player-orders-system-architecture.yaml"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\player-orders-advanced-system-architecture.yaml
