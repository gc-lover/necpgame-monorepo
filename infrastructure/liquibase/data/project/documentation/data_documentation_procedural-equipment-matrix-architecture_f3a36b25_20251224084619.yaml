databaseChangeLog:
- changeSet:
    id: documentation-procedural-equipment-matrix-architecture-f3a36b25
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-376776179831463'
        - column:
            name: doc_id
            value: procedural-equipment-matrix-architecture
        - column:
            name: title
            value: Архитектура процедурной матрицы снаряжения
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 23:50:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - loot
            - procedural-generation
            - equipment
            - combat
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - economy-service
            - gameplay-service
            - inventory-service
            - crafting-service
            - analytics-service
        - column:
            name: related_documents
            value: '[{"id": "analysis-ideas-2025-11-03-procedural-equipment-matrix",
              "relation": "implements"}, {"id": "loot-system-architecture", "relation":
              "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - combat
            - economy
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "procedural-equipment-matrix-architecture",
              "title": "Архитектура процедурной матрицы снаряжения", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-11-23T23:50:00+00:00", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "loot", "procedural-generation", "equipment", "combat"], "related_systems":
              ["economy-service", "gameplay-service", "inventory-service", "crafting-service",
              "analytics-service"], "related_documents": [{"id": "analysis-ideas-2025-11-03-procedural-equipment-matrix",
              "relation": "implements"}, {"id": "loot-system-architecture", "relation":
              "extends"}], "github_issue": 461, "visibility": "internal", "audience":
              ["architect", "backend", "combat", "economy", "api-designer"]}, "summary":
              {"problem": "Требуется спроектировать архитектуру процедурной матрицы
              снаряжения для генерации\nоружия, имплантов и экипировки с учетом брендов,
              редкостей, характеристик и модификаторов:\n- Процедурная генерация предметов
              по типу Borderlands\n- Матрица характеристик на основе брендов и типов\n-
              Детерминированные сиды для балансировки\n- Интеграция с экономикой,
              крафтом и кибернетикой\n- Балансировка по лигам, режимам PvE/PvP/экстракта\n",
              "goal": "Создать архитектурную схему процедурной матрицы снаряжения
              с определением:\n- Компонентов для генерации предметов\n- Матрицы характеристик
              и модификаторов\n- API endpoints (высокоуровнево)\n- Интеграций с системами
              лута, крафта и экономики\n- Структуры БД для матрицы\n- Технического
              задания для реализации\n", "essence": "Система процедурной генерации
              снаряжения с матрицей брендов, типов, редкостей,\nхарактеристик и модификаторов,
              интегрированная с существующей системой лута.\n"}, "architecture": {"overview":
              "Процедурная матрица снаряжения состоит из следующих компонентов:\n1.
              Equipment Matrix Manager - управление матрицей характеристик\n2. Procedural
              Generator - процедурная генерация предметов\n3. Brand Handler - обработчики
              брендов (корпораций)\n4. Rarity Calculator - расчет редкости предметов\n5.
              Stat Pool Manager - управление пулами характеристик\n6. Modifier Generator
              - генерация модификаторов\n7. Seed Manager - управление детерминированными
              сидами\n8. Balance Validator - валидация баланса по лигам и режимам\n",
              "microservices": [{"name": "economy-service", "port": 8085, "responsibility":
              "Основной сервис для процедурной генерации снаряжения:\n- Управление
              матрицей характеристик\n- Процедурная генерация предметов\n- Управление
              брендами и их идентичностями\n- Расчет редкости и характеристик\n- Генерация
              модификаторов\n- Интеграция с системой лута\n", "components": ["Equipment
              Matrix Manager", "Procedural Generator", "Brand Handler", "Rarity Calculator",
              "Stat Pool Manager", "Modifier Generator", "Seed Manager", "Balance
              Validator"], "endpoints": ["POST /api/v1/economy/equipment/generate
              - генерация предмета", "GET /api/v1/economy/equipment/matrix - матрица
              характеристик", "GET /api/v1/economy/equipment/brands - список брендов",
              "GET /api/v1/economy/equipment/rarities - список редкостей", "GET /api/v1/economy/equipment/stat-pools
              - пулы характеристик", "POST /api/v1/economy/equipment/validate-balance
              - валидация баланса"]}, {"name": "gameplay-service", "port": 8083, "responsibility":
              "Применение сгенерированного снаряжения в бою:\n- Расчет боевых параметров\n-
              Применение модификаторов\n- Синергии имплантов\n- Сет-бонусы\n- Энергобюджет
              персонажа\n", "components": ["Combat Stats Calculator", "Modifier Applier",
              "Synergy Handler"], "endpoints": ["POST /api/v1/gameplay/equipment/calculate-stats
              - расчет статов", "POST /api/v1/gameplay/equipment/apply-modifiers -
              применение модификаторов"]}, {"name": "crafting-service", "port": 8087,
              "responsibility": "Интеграция с крафтом:\n- Процедурная генерация при
              крафте\n- Использование матрицы для крафта\n- Детерминированные сиды
              для крафта\n", "components": ["Crafting Generator", "Craft Seed Manager"],
              "endpoints": ["POST /api/v1/crafting/generate - генерация при крафте",
              "GET /api/v1/crafting/matrix - матрица для крафта"]}], "components":
              [{"name": "Equipment Matrix Manager", "location": "economy-service",
              "responsibility": "Управление матрицей характеристик:\n- Хранение матрицы
              брендов, типов, редкостей\n- Управление пулами характеристик\n- Управление
              модификаторами\n- Версионирование матрицы\n- Кэширование матрицы\n",
              "dependencies": ["Database", "Redis Cache"]}, {"name": "Procedural Generator",
              "location": "economy-service", "responsibility": "Процедурная генерация
              предметов:\n- Выбор бренда и типа\n- Расчет редкости\n- Генерация характеристик
              из пулов\n- Применение модификаторов\n- Генерация слотов модов\n- Использование
              детерминированных сидов\n", "dependencies": ["Equipment Matrix Manager",
              "Brand Handler", "Rarity Calculator", "Stat Pool Manager", "Modifier
              Generator", "Seed Manager"]}, {"name": "Brand Handler", "location":
              "economy-service", "responsibility": "Обработчики брендов (корпораций):\n-
              Лорные идентичности брендов\n- Специфичные характеристики брендов\n-
              Бонусы брендов\n- Фракционные эксклюзивы\n", "dependencies": ["Equipment
              Matrix Manager"]}, {"name": "Rarity Calculator", "location": "economy-service",
              "responsibility": "Расчет редкости предметов:\n- Определение редкости
              на основе источника\n- Модификаторы редкости\n- Гарантированные редкости\n-
              Балансировка редкостей\n", "dependencies": ["Equipment Matrix Manager"]},
              {"name": "Stat Pool Manager", "location": "economy-service", "responsibility":
              "Управление пулами характеристик:\n- Пулы характеристик по типам предметов\n-
              Распределение характеристик\n- Минимальные и максимальные значения\n-
              Балансировка пулов\n", "dependencies": ["Equipment Matrix Manager"]},
              {"name": "Modifier Generator", "location": "economy-service", "responsibility":
              "Генерация модификаторов:\n- Пулы модификаторов\n- Редкость модификаторов\n-
              Совместимость модификаторов\n- Балансировка модификаторов\n", "dependencies":
              ["Equipment Matrix Manager"]}, {"name": "Seed Manager", "location":
              "economy-service", "responsibility": "Управление детерминированными
              сидами:\n- Генерация сидов для предметов\n- Хранение сидов\n- Воспроизводимость
              генерации\n- Балансировка через сиды\n", "dependencies": ["Database"]},
              {"name": "Balance Validator", "location": "economy-service", "responsibility":
              "Валидация баланса:\n- Проверка баланса по лигам\n- Проверка баланса
              по режимам (PvE/PvP/экстракт)\n- Проверка температурных ограничений\n-
              Проверка TTK\n- Проверка рисков киберпсихоза\n", "dependencies": ["Procedural
              Generator", "Gameplay Service"]}], "data_models": {"equipment_matrix":
              {"fields": [{"id": "UUID"}, {"brand_id": "UUID"}, {"item_type": "enum
              (WEAPON, IMPLANT, ARMOR, ACCESSORY)"}, {"rarity": "enum (COMMON, UNCOMMON,
              RARE, EPIC, LEGENDARY)"}, {"stat_pools": "array of StatPool"}, {"modifiers":
              "array of Modifier"}, {"brand_bonuses": "json"}, {"created_at": "timestamp"},
              {"updated_at": "timestamp"}, {"version": "integer"}]}, "stat_pool":
              {"fields": [{"id": "UUID"}, {"name": "string"}, {"stat_type": "enum
              (DAMAGE, ACCURACY, RANGE, FIRE_RATE, RELOAD_SPEED, etc.)"}, {"min_value":
              "float"}, {"max_value": "float"}, {"distribution": "enum (UNIFORM, NORMAL,
              EXPONENTIAL)"}, {"rarity_modifiers": "json"}]}, "modifier": {"fields":
              [{"id": "UUID"}, {"name": "string"}, {"modifier_type": "enum (DAMAGE_BOOST,
              CRIT_CHANCE, ELEMENTAL_DAMAGE, etc.)"}, {"value": "float"}, {"rarity":
              "enum (COMMON, UNCOMMON, RARE, EPIC, LEGENDARY)"}, {"compatibility":
              "array of string"}, {"restrictions": "json"}]}, "generated_item": {"fields":
              [{"id": "UUID"}, {"seed": "string"}, {"brand_id": "UUID"}, {"item_type":
              "enum"}, {"rarity": "enum"}, {"stats": "json"}, {"modifiers": "array
              of UUID"}, {"mod_slots": "integer"}, {"generated_at": "timestamp"}]}},
              "api_endpoints": {"economy_service": {"base_path": "/api/v1/economy/equipment",
              "endpoints": [{"method": "POST", "path": "/generate", "description":
              "Генерация предмета процедурно", "request_body": "GenerateEquipmentRequest",
              "response": "GeneratedItem"}, {"method": "GET", "path": "/matrix", "description":
              "Получение матрицы характеристик", "query_params": [{"brand_id": "UUID
              (optional)"}, {"item_type": "enum (optional)"}, {"rarity": "enum (optional)"}],
              "response": "EquipmentMatrix"}, {"method": "GET", "path": "/brands",
              "description": "Список брендов", "response": "array of Brand"}, {"method":
              "GET", "path": "/rarities", "description": "Список редкостей", "response":
              "array of Rarity"}, {"method": "GET", "path": "/stat-pools", "description":
              "Пулы характеристик", "query_params": [{"item_type": "enum (optional)"}],
              "response": "array of StatPool"}, {"method": "POST", "path": "/validate-balance",
              "description": "Валидация баланса предмета", "request_body": "ValidateBalanceRequest",
              "response": "BalanceValidationResult"}]}}, "integrations": {"with_loot_system":
              "- Использование процедурной генерации в системе лута\n- Интеграция
              с Loot Generator\n- Применение матрицы к дропам\n", "with_crafting_system":
              "- Процедурная генерация при крафте\n- Использование матрицы для крафта\n-
              Детерминированные сиды для крафта\n", "with_gameplay_system": "- Расчет
              боевых параметров\n- Применение модификаторов\n- Синергии имплантов\n-
              Сет-бонусы\n", "event_bus": {"type": "Kafka", "topics": ["equipment.generated",
              "equipment.matrix-updated", "equipment.balance-validated"]}, "database":
              {"type": "PostgreSQL", "schema": "equipment_matrix", "tables": ["equipment_matrix",
              "stat_pools", "modifiers", "generated_items", "brand_configs"]}, "cache":
              {"type": "Redis", "keys": ["equipment-matrix:brands", "equipment-matrix:stat-pools",
              "equipment-matrix:modifiers"], "ttl": "3600 seconds"}}, "technical_specification":
              {"implementation_phases": {"phase_1": {"name": "Базовая матрица", "tasks":
              ["Создание структуры БД для матрицы", "Реализация Equipment Matrix Manager",
              "Реализация Brand Handler", "Базовые CRUD endpoints"], "estimated_effort":
              "4 days"}, "phase_2": {"name": "Процедурная генерация", "tasks": ["Реализация
              Procedural Generator", "Реализация Rarity Calculator", "Реализация Stat
              Pool Manager", "Реализация Modifier Generator", "Интеграция с системой
              лута"], "estimated_effort": "5 days"}, "phase_3": {"name": "Детерминированные
              сиды", "tasks": ["Реализация Seed Manager", "Воспроизводимость генерации",
              "Балансировка через сиды"], "estimated_effort": "3 days"}, "phase_4":
              {"name": "Балансировка", "tasks": ["Реализация Balance Validator", "Интеграция
              с Gameplay Service", "Балансировка по лигам", "Балансировка по режимам"],
              "estimated_effort": "4 days"}, "phase_5": {"name": "Интеграции", "tasks":
              ["Интеграция с Crafting Service", "Интеграция с Gameplay Service", "Event
              Bus интеграция", "Кэширование"], "estimated_effort": "3 days"}}, "total_estimated_effort":
              "19 days"}}, "diagrams": {"component_diagram": "```mermaid\ngraph TB\n    Client[UE5
              Client] --> Gateway[API Gateway]\n\n    Gateway --> EconomyService[Economy
              Service<br/>8085]\n\n    EconomyService --> EMM[Equipment Matrix Manager]\n    EconomyService
              --> PG[Procedural Generator]\n    EconomyService --> BH[Brand Handler]\n    EconomyService
              --> RC[Rarity Calculator]\n    EconomyService --> SPM[Stat Pool Manager]\n    EconomyService
              --> MG[Modifier Generator]\n    EconomyService --> SM[Seed Manager]\n    EconomyService
              --> BV[Balance Validator]\n\n    EconomyService --> LootSystem[Loot
              System]\n    EconomyService --> CraftingService[Crafting Service<br/>8087]\n    EconomyService
              --> GameplayService[Gameplay Service<br/>8083]\n\n    EconomyService
              --> EventBus[Event Bus<br/>Kafka]\n    EconomyService --> DB[(Equipment
              Matrix DB)]\n    EconomyService --> Cache[(Redis Cache)]\n```\n", "generation_flow":
              "```mermaid\ngraph LR\n    Request[Generate Request] --> PG[Procedural
              Generator]\n    PG --> BH[Brand Handler]\n    PG --> RC[Rarity Calculator]\n    PG
              --> SPM[Stat Pool Manager]\n    PG --> MG[Modifier Generator]\n    PG
              --> SM[Seed Manager]\n    SM --> Item[Generated Item]\n    Item -->
              BV[Balance Validator]\n    BV --> Result[Final Item]\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "procedural-equipment-matrix-architecture", "title": "Архитектура
              процедурной матрицы снаряжения", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T23:50:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "loot", "procedural-generation", "equipment",
              "combat"], "related_systems": ["economy-service", "gameplay-service",
              "inventory-service", "crafting-service", "analytics-service"], "related_documents":
              [{"id": "analysis-ideas-2025-11-03-procedural-equipment-matrix", "relation":
              "implements"}, {"id": "loot-system-architecture", "relation": "extends"}],
              "github_issue": 461, "visibility": "internal", "audience": ["architect",
              "backend", "combat", "economy", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\procedural-equipment-matrix-architecture.yaml
