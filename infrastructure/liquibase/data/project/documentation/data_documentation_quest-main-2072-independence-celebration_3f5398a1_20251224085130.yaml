databaseChangeLog:
- changeSet:
    id: documentation-quest-main-2072-independence-celebration-3f5398a1
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '3311826320219971'
        - column:
            name: doc_id
            value: quest-main-2072-independence-celebration
        - column:
            name: title
            value: 'Основной квест: Празднование независимости (2072)'
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: start-content
        - column:
            name: status
            value: in-review
        - column:
            name: version
            value: 2.0.0
        - column:
            name: last_updated
            value: 2025-12-01 00:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - questline
            - downtown
            - security
        - column:
            name: topics
            value:
            - quests
            - social
            - combat
        - column:
            name: related_systems
            value:
            - gameplay-service
            - quest-service
            - narrative-service
            - character-service
            - economy-service
        - column:
            name: related_documents
            value: '[{"id": "quest-main-2065-gray-theater", "relation": "precedes"}]'
        - column:
            name: source
            value: shared/docs/knowledge/implementation/start-content/quests/quest-main-2072-independence-celebration.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - gameplay
            - analytics
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "quest-main-2072-independence-celebration",
              "title": "Основной квест: Празднование независимости (2072)", "document_type":
              "implementation", "category": "start-content", "status": "in-review",
              "version": "2.0.0", "last_updated": "2025-12-01T00:00:00+00:00", "concept_approved":
              false, "concept_reviewed_at": "", "owners": [{"role": "concept_director",
              "contact": "concept@necp.game"}], "tags": ["questline", "downtown",
              "security"], "topics": ["quests", "social", "combat"], "related_systems":
              ["gameplay-service", "quest-service", "narrative-service", "character-service",
              "economy-service"], "related_documents": [{"id": "quest-main-2065-gray-theater",
              "relation": "precedes"}], "source": "shared/docs/knowledge/implementation/start-content/quests/quest-main-2072-independence-celebration.md",
              "visibility": "internal", "audience": ["concept", "gameplay", "analytics"],
              "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions":
              []}, "summary": {"problem": "Ежегодное празднование независимости в
              Downtown может перерасти в хаос из-за заговорщиков и толпы.", "goal":
              "Описать shooter-сценарий патрулирования, расследования и деэскалации
              для защиты события.", "essence": "Игрок помогает Саре Миллер выявить
              угрозы, удержать площадь под контролем и завершить мероприятие без жертв.",
              "key_points": ["Стадии патруля с проверками PERCEPTION/COOL/INVESTIGATION.",
              "Диалоговое дерево на 24 узла, ведущее к складу заговорщиков.", "Награды
              и API-мэппинг, учитывающие социальные и боевые исходы."]}, "quest_definition":
              {"quest_type": "main", "level_min": 8, "level_max": null, "requirements":
              {"required_quests": [], "required_flags": [], "required_reputation":
              {}, "required_items": []}, "objectives": [{"id": "accept_quest", "text":
              "Принять задание у Сары Миллер", "type": "interact", "target": "npc-sarah-miller",
              "count": 1, "optional": false}, {"id": "patrol_area", "text": "Патрулировать
              площадь и выявить угрозы (PERCEPTION 16 для обнаружения закладок, COOL
              16 для деэскалации толпы, INVESTIGATION 15 для выявления канала заговорщиков)",
              "type": "perform", "target": "downtown-square-patrol", "count": 1, "optional":
              false}, {"id": "prevent_incidents", "text": "Предотвратить инциденты
              и задержать заговорщиков (Recon Sweep, Crowd De-escalation, Conspiracy
              Trace)", "type": "perform", "target": "incident-prevention", "count":
              1, "optional": false}, {"id": "handle_encounters", "text": "Обработать
              боевые сценарии (Street Clash, Warehouse Raid, Patrol Ambush) при необходимости",
              "type": "combat", "target": "conspiracy-encounters", "count": 1, "optional":
              true}, {"id": "report_to_sarah", "text": "Вернуться к Саре Миллер с
              отчётом", "type": "interact", "target": "npc-sarah-miller", "count":
              1, "optional": false}], "rewards": {"experience": 680, "currency": 900,
              "items": [], "reputation": {"ncpd": 25}, "flags": ["independence-celebration-quest-completed",
              "downtown-security-unlocked"]}, "branches": [{"id": "perception_path",
              "unlock_condition": {"type": "skill_check", "skill": "perception", "min_value":
              16}, "consequences": {"experience": 100, "currency": 0, "reputation":
              {"ncpd": 5}, "flags": ["perception-master-unlocked"], "unlocked_content":
              [{"quest_type": "side", "category": "investigation", "location": "global"}]}},
              {"id": "cool_deescalation_path", "unlock_condition": {"type": "skill_check",
              "skill": "cool", "min_value": 16}, "consequences": {"experience": 100,
              "currency": 100, "reputation": {"ncpd": 10}, "flags": ["social-master-unlocked"],
              "unlocked_content": [{"quest_type": "side", "category": "social", "location":
              "global"}]}}, {"id": "investigation_path", "unlock_condition": {"type":
              "skill_check", "skill": "investigation", "min_value": 15}, "consequences":
              {"experience": 100, "currency": 50, "reputation": {"ncpd": 5}, "flags":
              ["investigation-master-unlocked", "warehouse-raid-unlocked"], "unlocked_content":
              [{"quest_type": "side", "category": "investigation", "location": "downtown"}]}}]},
              "content": {"sections": [{"id": "synopsis", "title": "Синопсис", "body":
              "- ID: `quest-main-2072-independence-celebration`\n- Контакт: `npc-sarah-miller`\n-
              Локация: `loc-downtown-001`\n- Уровень: 8\n- Основные роли: patrol,
              investigation, de-escalation\n", "mechanics_links": ["mechanics/quests/quest-system.yaml"]},
              {"id": "objectives", "title": "Цели и ветвления", "body": "Основной
              маршрут:\n1. Принять задание у Сары Миллер.\n2. Патрулировать площадь
              и выявить угрозы.\n3. Предотвратить инциденты и задержать заговорщиков.\n4.
              Вернуться к Саре с отчётом.\n\nВетви:\n- PERCEPTION 16 — заранее обнаружить
              закладки, снизить число боёв.\n- COOL 16 — деэскалация толпы, бонус
              к репутации NCPD.\n- INVESTIGATION 15 — выявить канал заговорщиков,
              открыть ветку склада.\n", "mechanics_links": ["mechanics/combat/combat-shooter-core.yaml"]},
              {"id": "interactions", "title": "Shooter взаимодействия", "body": "-
              `Recon Sweep`: PERCEPTION 16, equipment `optic_suite`, событие `quest.recon.scan`,
              уменьшает встречи.\n- `Crowd De-escalation`: COOL 16, ресурс `NCPD megaphone`,
              событие `quest.social.presence`, бонус репутации.\n- `Conspiracy Trace`:
              INVESTIGATION 15, событие `quest.investigation.trace`, открывает склад.\n",
              "mechanics_links": ["mechanics/combat/combat-overview.yaml"]}, {"id":
              "encounters", "title": "Боевые сценарии", "body": "- `Street Clash`:
              2 нарушителя (defense 180–190), инициируется при провале COOL.\n- `Warehouse
              Raid`: 3 лидера (defense 200), альтернатива сдаче через COOL 16.\n-
              `Patrol Ambush`: triggered при провале INVESTIGATION, 2–3 врага.\n",
              "mechanics_links": ["mechanics/combat/combat-shooter-core.yaml"]}, {"id":
              "dialogue", "title": "Диалоговое дерево", "body": "24 узла: старт у
              Сары, ветви угроз, патруля, слежки за складом и финальный отчёт. Узлы
              `p_cool_ok`, `p_invest_ok`, `p_surrender` формируют основные исходы.\n",
              "mechanics_links": ["mechanics/social/social-mechanics-overview.yaml"]},
              {"id": "rewards", "title": "Награды и баланс", "body": "Базовые награды:
              680 XP, 900 eddies, +25 репутации NCPD.\nБонусы: успехи PERCEPTION/COOL/INVESTIGATION
              дают доп. репутацию и XP, снижают количество боёв.\nШтрафы: провал проверок
              добавляет встречи, поражение в бою → медпункт и −10% денег.\n", "mechanics_links":
              ["mechanics/economy/stock-exchange/stock-analytics.yaml"]}, {"id": "interfaces",
              "title": "API и телеметрия", "body": "REST:\n- `POST /api/v1/quests/{id}/accept`\n-
              `POST /api/v1/skill-check`\n- `POST /api/v1/combat/start`\n- `POST /api/v1/quests/{id}/complete`\n\nKafka:\n-
              `quest.progress.main`\n- `combat.shooter.encounter`\n- `analytics.quest.ncpd`\n\nSLA:
              latency ≤ 180 мс на патрульных ивентах, отслеживание деэскалаций.\n",
              "mechanics_links": ["implementation/backend/quest-engine-backend.yaml"]},
              {"id": "qa", "title": "Тестирование", "body": "- Social Path: успешная
              деэскалация, минимум боёв.\n- Combat Path: провал проверок, складовое
              сражение.\n- Investigation Path: слежка, задержание лидеров без боя.\n-
              Failure Loop: поражение и возврат через медпункт.\n", "mechanics_links":
              ["mechanics/quests/quest-system.yaml"]}]}, "appendix": {"glossary":
              [], "references": [], "decisions": []}, "implementation": {"needs_task":
              false, "github_issue": 15, "queue_reference": ["shared/trackers/queues/concept/queued.yaml#quest-main-2072-independence-celebration"],
              "blockers": []}, "history": [{"version": "2.0.0", "date": "2025-12-01",
              "author": "content_writer", "changes": "Добавлен Issue в начало файла.
              Добавлена полная структура quest_definition с objectives, rewards и
              branches согласно архитектуре системы квестов. Создано 5 objectives
              на основе контента квеста (принять задание, патрулировать площадь, предотвратить
              инциденты, обработать боевые сценарии, вернуться с отчётом). Добавлены
              rewards: 680 XP, 900 currency, репутация ncpd: 25, флаги для разблокировки
              контента. Добавлены 3 branches (perception_path, cool_deescalation_path,
              investigation_path) с правильной структурой unlock_condition и consequences,
              учитывающие проверки навыков PERCEPTION 16, COOL 16, INVESTIGATION 15."},
              {"version": "1.0.0", "date": "2025-11-06", "author": "concept_team",
              "changes": "Первичная shooter-спецификация праздника независимости."}],
              "validation": {"checksum": "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "quest-main-2072-independence-celebration", "title": "Основной
              квест: Празднование независимости (2072)", "document_type": "implementation",
              "category": "start-content", "status": "in-review", "version": "2.0.0",
              "last_updated": "2025-12-01T00:00:00+00:00", "concept_approved": false,
              "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact":
              "concept@necp.game"}], "tags": ["questline", "downtown", "security"],
              "topics": ["quests", "social", "combat"], "related_systems": ["gameplay-service",
              "quest-service", "narrative-service", "character-service", "economy-service"],
              "related_documents": [{"id": "quest-main-2065-gray-theater", "relation":
              "precedes"}], "source": "shared/docs/knowledge/implementation/start-content/quests/quest-main-2072-independence-celebration.md",
              "visibility": "internal", "audience": ["concept", "gameplay", "analytics"],
              "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\implementation\start-content\quests\quest-main-2072-independence-celebration.yaml
