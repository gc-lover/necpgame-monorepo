databaseChangeLog:
- changeSet:
    id: documentation-raid-dungeon-affixes-system-architecture-03d4ed22
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '1018411940754587'
        - column:
            name: doc_id
            value: raid-dungeon-affixes-system-architecture
        - column:
            name: title
            value: Архитектура системы аффиксов для рейдов и подземелий
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-XXT00:00:00Z
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - gameplay
            - difficulty
            - affixes
            - raids
            - dungeons
            - hardcore
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - gameplay-service
            - world-service
            - combat-service
            - analytics-service
            - leaderboard-service
        - column:
            name: related_documents
            value: '[{"id": "raid-dungeon-affixes-idea", "relation": "implements"},
              {"id": "combat-ai-enemies-architecture", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "raid-dungeon-affixes-system-architecture",
              "title": "Архитектура системы аффиксов для рейдов и подземелий", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-XXT00:00:00Z", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "gameplay", "difficulty", "affixes", "raids", "dungeons", "hardcore"],
              "related_systems": ["gameplay-service", "world-service", "combat-service",
              "analytics-service", "leaderboard-service"], "related_documents": [{"id":
              "raid-dungeon-affixes-idea", "relation": "implements"}, {"id": "combat-ai-enemies-architecture",
              "relation": "extends"}], "github_issue": 1495, "visibility": "internal",
              "audience": ["architect", "backend", "gameplay", "api-designer"]}, "summary":
              {"problem": "Текущая система сложности рейдов и подземелий ограничена
              базовыми слоями.\nНе хватает динамических модификаторов, которые бы
              меняли механики боя и повышали реиграбельность.\n", "goal": "Создать
              архитектуру системы аффиксов, которая:\n- Добавляет динамическую сложность
              через модификаторы механик\n- Повышает реиграбельность контента\n- Интегрируется
              с существующими системами рейдов и подземелий\n- Поддерживает еженедельную
              ротацию аффиксов\n", "essence": "Система аффиксов добавляет 2-4 случайных
              модификатора к каждому инстансу рейда или подземелья.\nАффиксы меняют
              механики боя, требуют адаптации тактики и влияют на награды.\nРотация
              аффиксов происходит еженедельно.\n"}, "architecture": {"overview": "Система
              аффиксов состоит из следующих компонентов:\n1. Affix Manager - управление
              аффиксами и их конфигурациями\n2. Affix Rotation Controller - управление
              еженедельной ротацией\n3. Affix Applicator - применение аффиксов к инстансам\n4.
              Affix Effect Engine - обработка эффектов аффиксов в бою\n5. Affix Telemetry
              Collector - сбор телеметрии для балансировки\n", "microservices": [{"name":
              "gameplay-service", "port": 8083, "responsibility": "Обработка аффиксов:\n-
              Управление аффиксами и их конфигурациями\n- Применение аффиксов к инстансам\n-
              Обработка эффектов аффиксов в бою\n- Сбор телеметрии\n", "components":
              [{"affix-manager": "управление аффиксами"}, {"affix-rotation-controller":
              "управление ротацией"}, {"affix-applicator": "применение аффиксов"},
              {"affix-effect-engine": "обработка эффектов"}, {"affix-telemetry-collector":
              "сбор телеметрии"}], "endpoints": ["GET /api/v1/gameplay/affixes/active
              - список активных аффиксов", "GET /api/v1/gameplay/affixes/{id} - информация
              об аффиксе", "GET /api/v1/gameplay/instances/{instanceId}/affixes -
              аффиксы инстанса", "GET /api/v1/gameplay/affixes/rotation/history -
              история ротаций", "POST /api/v1/gameplay/affixes/rotation/trigger -
              триггер ротации (admin)"], "websocket_channels": ["wss://api.necp.game/v1/gameplay/affixes/rotation
              - события ротации"], "events_published": [{"gameplay.affixes.rotation.changed":
              "смена ротации аффиксов"}, {"gameplay.affixes.applied": "применение
              аффиксов к инстансу"}, {"gameplay.affixes.telemetry": "телеметрия аффиксов"}]}],
              "data_flows": {"affix_application_flow": "1. Игрок создает инстанс рейда/подземелья\n2.
              Affix Applicator запрашивает активные аффиксы через Affix Manager\n3.
              Affix Applicator выбирает 2-4 случайных аффикса из активных\n4. Affix
              Applicator проверяет совместимость аффиксов\n5. Affix Applicator применяет
              аффиксы к инстансу\n6. Affix Effect Engine инициализирует эффекты аффиксов\n7.
              Gameplay Service публикует событие gameplay.affixes.applied\n8. Realtime
              Gateway отправляет информацию об аффиксах клиентам\n", "affix_rotation_flow":
              "1. Еженедельно (понедельник 00:00 UTC) запускается Affix Rotation Controller\n2.
              Affix Rotation Controller выбирает новый набор активных аффиксов (8-10
              из пула)\n3. Affix Rotation Controller проверяет сезонные аффиксы\n4.
              Affix Rotation Controller сохраняет новую ротацию в БД\n5. Affix Rotation
              Controller публикует событие gameplay.affixes.rotation.changed\n6. Realtime
              Gateway отправляет уведомление всем игрокам\n7. Analytics Service логирует
              смену ротации\n", "affix_effect_flow": "1. В бою Affix Effect Engine
              отслеживает триггеры аффиксов\n2. При срабатывании триггера Affix Effect
              Engine применяет эффект\n3. Combat Service обрабатывает модификаторы
              (урон, HP, способности)\n4. Affix Effect Engine обновляет визуальные
              эффекты\n5. Realtime Gateway синхронизирует эффекты с клиентами\n6.
              Affix Telemetry Collector записывает использование аффикса\n"}, "database_structure":
              {"tables": [{"name": "affixes", "description": "Каталог аффиксов", "columns":
              [{"id": "UUID PRIMARY KEY"}, {"name": "VARCHAR(255)"}, {"category":
              "ENUM (combat, environmental, debuff, defensive)"}, {"description":
              "TEXT"}, {"mechanics": "JSONB"}, {"visual_effects": "JSONB"}, {"reward_modifier":
              "DECIMAL(5,2)"}, {"difficulty_modifier": "DECIMAL(5,2)"}, {"created_at":
              "TIMESTAMP"}]}, {"name": "affix_rotations", "description": "Ротации
              аффиксов", "columns": [{"id": "UUID PRIMARY KEY"}, {"week_start": "TIMESTAMP"},
              {"week_end": "TIMESTAMP"}, {"active_affixes": "JSONB"}, {"seasonal_affix_id":
              "UUID (nullable)"}, {"created_at": "TIMESTAMP"}]}, {"name": "instance_affixes",
              "description": "Аффиксы инстансов", "columns": [{"id": "UUID PRIMARY
              KEY"}, {"instance_id": "UUID FOREIGN KEY"}, {"affix_id": "UUID FOREIGN
              KEY"}, {"applied_at": "TIMESTAMP"}]}, {"name": "affix_telemetry", "description":
              "Телеметрия аффиксов", "columns": [{"id": "UUID PRIMARY KEY"}, {"instance_id":
              "UUID FOREIGN KEY"}, {"affix_id": "UUID FOREIGN KEY"}, {"completion_time":
              "INTEGER"}, {"success": "BOOLEAN"}, {"player_count": "INTEGER"}, {"deaths_count":
              "INTEGER"}, {"timestamp": "TIMESTAMP"}]}]}, "integrations": {"combat_service":
              "- Применение боевых модификаторов (HP, урон, способности)\n- Обработка
              механик аффиксов в бою\n- Синхронизация с combat session\n", "world_service":
              "- Хранение конфигураций аффиксов\n- Ротация аффиксов\n- Интеграция
              с событиями мира\n", "analytics_service": "- Отслеживание успешности
              комбинаций аффиксов\n- Метрики сложности и наград\n- Балансировка аффиксов\n",
              "leaderboard_service": "- Рейтинги по сложности аффиксов\n- Сезонные
              лидерборды\n- Достижения за прохождение с аффиксами\n"}, "technical_tasks":
              {"phases": {"phase_1": {"name": "Affix Manager и Rotation Controller",
              "tasks": ["Реализация Affix Manager", "Реализация Affix Rotation Controller",
              "Управление каталогом аффиксов", "Еженедельная ротация", "Интеграция
              с World Service"], "estimated_effort": "4 days"}, "phase_2": {"name":
              "Affix Applicator и Effect Engine", "tasks": ["Реализация Affix Applicator",
              "Реализация Affix Effect Engine", "Применение аффиксов к инстансам",
              "Обработка эффектов в бою", "Интеграция с Combat Service"], "estimated_effort":
              "5 days"}, "phase_3": {"name": "Telemetry и балансировка", "tasks":
              ["Реализация Affix Telemetry Collector", "Сбор метрик использования",
              "Анализ баланса аффиксов", "Интеграция с Analytics Service"], "estimated_effort":
              "3 days"}}}}}'
        - column:
            name: metadata
            value: '{"id": "raid-dungeon-affixes-system-architecture", "title": "Архитектура
              системы аффиксов для рейдов и подземелий", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-12-XXT00:00:00Z", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "gameplay", "difficulty",
              "affixes", "raids", "dungeons", "hardcore"], "related_systems": ["gameplay-service",
              "world-service", "combat-service", "analytics-service", "leaderboard-service"],
              "related_documents": [{"id": "raid-dungeon-affixes-idea", "relation":
              "implements"}, {"id": "combat-ai-enemies-architecture", "relation":
              "extends"}], "github_issue": 1495, "visibility": "internal", "audience":
              ["architect", "backend", "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\raid-dungeon-affixes-system-architecture.yaml
