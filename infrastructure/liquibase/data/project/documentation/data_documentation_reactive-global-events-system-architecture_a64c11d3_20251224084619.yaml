databaseChangeLog:
- changeSet:
    id: documentation-reactive-global-events-system-architecture-a64c11d3
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '3059894627683475'
        - column:
            name: doc_id
            value: reactive-global-events-system-architecture
        - column:
            name: title
            value: Архитектура системы реактивных глобальных событий
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-XXT00:00:00Z
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - world
            - events
            - reactive
            - player-impact
            - scaling
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - world-service
            - quest-service
            - economy-service
            - social-service
            - analytics-service
        - column:
            name: related_documents
            value: '[{"id": "world-events-system-architecture", "relation": "extends"},
              {"id": "player-impact-systems", "relation": "implements"}, {"id": "live-events-system",
              "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - world
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "reactive-global-events-system-architecture",
              "title": "Архитектура системы реактивных глобальных событий", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-XXT00:00:00Z", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "world", "events", "reactive", "player-impact", "scaling"], "related_systems":
              ["world-service", "quest-service", "economy-service", "social-service",
              "analytics-service"], "related_documents": [{"id": "world-events-system-architecture",
              "relation": "extends"}, {"id": "player-impact-systems", "relation":
              "implements"}, {"id": "live-events-system", "relation": "extends"}],
              "github_issue": 1454, "visibility": "internal", "audience": ["architect",
              "backend", "world", "api-designer"]}, "summary": {"problem": "Требуется
              система, где действия игроков, завершение квестов и накопленная активность\nмогут
              вызывать глобальные события разных масштабов. Сейчас есть система запланированных\nсобытий
              (Live Events System), но нет механики реактивных событий, триггеримых
              действиями игроков.\n", "goal": "Создать архитектурную схему системы
              реактивных глобальных событий с определением:\n- Компонентов для накопления
              активности игроков\n- Системы триггеров для разных масштабов событий\n-
              Механизма каскадных эффектов (локальное → городское → региональное)\n-
              Интеграции с существующими системами событий и влияния игроков\n- REST,
              WebSocket и Event Bus контрактов\n- Структуры БД для отслеживания активности
              и событий\n- Технического задания для реализации\n", "essence": "Система
              реактивных глобальных событий расширяет существующую систему мировых
              событий,\nдобавляя механизм автоматической активации событий на основе
              накопленной активности игроков\nс поддержкой масштабирования от локального
              до межпланетарного уровня.\n"}, "architecture": {"overview": "Архитектура
              системы реактивных глобальных событий состоит из следующих компонентов:\n1.
              Activity Accumulator - накопление активности игроков\n2. Scale Manager
              - управление масштабами событий\n3. Threshold Calculator - расчет порогов
              активации\n4. Reactive Trigger Manager - управление реактивными триггерами\n5.
              Cascade Event Manager - управление каскадными эффектами\n6. Activity
              Window Manager - управление временными окнами\n7. Impact Aggregator
              - агрегация влияния игроков\n8. Event Activation Coordinator - координация
              активации событий\n", "event_scales": [{"scale": "district", "description":
              "Локальный (District) - район города, несколько кварталов", "influence_radius":
              "1-5 км", "player_threshold": "10-50", "activity_window": "1-7 дней",
              "example_events": ["Восстание в районе Watson", "Корпоративный рейд
              на рынок", "Уличная война между бандами"]}, {"scale": "city", "description":
              "Городской (City) - весь город (Night City, London, Tokyo)", "influence_radius":
              "весь город", "player_threshold": "100-500", "activity_window": "7-30
              дней", "example_events": ["Корпоративная война в городе", "Массовые
              протесты", "Технологический прорыв"]}, {"scale": "region", "description":
              "Региональный (Country/Region) - страна или крупный регион", "influence_radius":
              "страна/регион", "player_threshold": "1000-5000", "activity_window":
              "30-90 дней", "example_events": ["Региональный конфликт", "Экономический
              кризис региона", "Политическая революция"]}, {"scale": "continent",
              "description": "Континентальный (Continent) - весь континент", "influence_radius":
              "континент", "player_threshold": "10000-50000", "activity_window": "90-180
              дней", "example_events": ["Континентальная война", "Глобальная пандемия",
              "Технологическая революция"]}, {"scale": "planetary", "description":
              "Планетарный (Planetary) - вся планета Земля", "influence_radius": "планета",
              "player_threshold": "100000-500000", "activity_window": "180-365 дней",
              "example_events": ["Глобальная катастрофа", "Планетарное событие", "Изменение
              климата"]}, {"scale": "interplanetary", "description": "Межпланетарный
              (Interplanetary) - другие планеты, колонии", "influence_radius": "межпланетарный",
              "player_threshold": "500000+", "activity_window": "365+ дней", "example_events":
              ["Колонизация новой планеты", "Межпланетарный конфликт", "Космическая
              катастрофа"]}], "activity_accumulation": {"activity_sources": [{"quest_completion":
              "- Завершение квестов определенного типа\n- Цепочки квестов\n- Уникальные
              квесты\n"}, {"player_actions": "- Массовые действия игроков (убийства,
              торговля)\n- Накопление определенных действий\n- Уникальные комбинации
              действий\n"}, {"economic_activity": "- Крупные транзакции\n- Изменение
              цен на рынке\n- Экономические паттерны\n"}, {"social_activity": "- Изменение
              репутации фракций\n- Массовые социальные действия\n- Фракционные конфликты\n"},
              {"exploration_activity": "- Открытие новых локаций\n- Массовое исследование\n-
              Археологические находки\n"}], "accumulation_mechanism": "activity_score
              = Σ(player_actions * weight) + \n                 Σ(quest_completions
              * weight) +\n                 Σ(economic_activity * weight) +\n                 Σ(social_activity
              * weight) +\n                 Σ(exploration_activity * weight)\n", "time_windows":
              "- Short-term: 1-7 дней (локальные события)\n- Medium-term: 7-30 дней
              (городские события)\n- Long-term: 30-90 дней (региональные события)\n-
              Very-long-term: 90-365 дней (континентальные/планетарные)\n", "decay_mechanism":
              "activity_score = activity_score * decay_factor ^ (time_passed / decay_period)\nСтарая
              активность постепенно теряет вес\n"}, "trigger_system": {"trigger_conditions":
              [{"threshold_based": "- Активность достигает порога для масштаба\n-
              Порог зависит от масштаба события\n- Порог может быть динамическим\n"},
              {"percentage_based": "- Процент игроков выполнил действие\n- Процент
              территории затронут\n- Процент фракций вовлечено\n"}, {"combination_based":
              "- Комбинация нескольких условий\n- Все условия должны быть выполнены\n-
              Или хотя бы одно условие\n"}], "cascade_triggers": "- Локальное событие
              может триггерить городское\n- Городское событие может триггерить региональное\n-
              Региональное событие может триггерить континентальное\n- Каскадные события
              имеют задержку (1-7 дней)\n", "activation_rules": "- Проверка порогов
              каждые 15 минут\n- Минимальный интервал между событиями одного масштаба\n-
              Максимальное количество активных событий одного масштаба\n- Приоритет
              событий при конфликте\n"}, "microservices": [{"name": "world-service",
              "port": 8086, "responsibility": "Управление реактивными событиями:\n-
              Накопление активности игроков\n- Расчет порогов активации\n- Управление
              триггерами\n- Координация каскадных эффектов\n", "components": [{"activity-accumulator":
              "накопление активности"}, {"scale-manager": "управление масштабами"},
              {"threshold-calculator": "расчет порогов"}, {"reactive-trigger-manager":
              "управление триггерами"}, {"cascade-event-manager": "каскадные эффекты"},
              {"activity-window-manager": "временные окна"}, {"impact-aggregator":
              "агрегация влияния"}, {"event-activation-coordinator": "координация
              активации"}]}, {"name": "analytics-service", "port": 8087, "responsibility":
              "Отслеживание активности игроков:\n- Сбор метрик активности\n- Агрегация
              данных по масштабам\n- Расчет пороговых значений\n- Аналитика событий\n",
              "components": [{"activity-tracker": "отслеживание активности"}, {"metrics-aggregator":
              "агрегация метрик"}, {"threshold-analyzer": "анализ порогов"}]}], "data_models":
              [{"name": "ReactiveEvent", "fields": [{"id": "UUID"}, {"event_type":
              "enum (quest, action, economic, social, exploration)"}, {"scale": "enum
              (district, city, region, continent, planetary, interplanetary)"}, {"trigger_conditions":
              "json"}, {"threshold": "float"}, {"current_activity": "float"}, {"activity_window_start":
              "timestamp"}, {"activity_window_end": "timestamp"}, {"status": "enum
              (pending, active, completed, cancelled)"}, {"parent_event_id": "UUID
              (для каскадных событий)"}, {"child_events": "array<UUID>"}, {"created_at":
              "timestamp"}, {"activated_at": "timestamp"}, {"completed_at": "timestamp"}]},
              {"name": "ActivityAccumulation", "fields": [{"id": "UUID"}, {"scale":
              "enum"}, {"region_id": "UUID"}, {"activity_type": "enum"}, {"activity_score":
              "float"}, {"player_count": "int"}, {"window_start": "timestamp"}, {"window_end":
              "timestamp"}, {"decay_factor": "float"}, {"updated_at": "timestamp"}]},
              {"name": "EventTrigger", "fields": [{"id": "UUID"}, {"reactive_event_id":
              "UUID"}, {"trigger_type": "enum (threshold, percentage, combination)"},
              {"conditions": "json"}, {"threshold_value": "float"}, {"check_interval_seconds":
              "int"}, {"last_checked_at": "timestamp"}, {"activated": "boolean"}]},
              {"name": "CascadeEvent", "fields": [{"id": "UUID"}, {"parent_event_id":
              "UUID"}, {"child_event_id": "UUID"}, {"cascade_delay_days": "int"},
              {"cascade_condition": "json"}, {"triggered": "boolean"}, {"triggered_at":
              "timestamp"}]}], "api_endpoints": {"activity_management": ["GET /api/v1/world/reactive-events/activity/{scale}
              - активность по масштабу", "GET /api/v1/world/reactive-events/activity/{scale}/{regionId}
              - активность региона", "POST /api/v1/world/reactive-events/activity/record
              - запись активности", "GET /api/v1/world/reactive-events/thresholds/{scale}
              - пороги для масштаба"], "event_management": ["GET /api/v1/world/reactive-events
              - список реактивных событий", "GET /api/v1/world/reactive-events/{id}
              - детали события", "GET /api/v1/world/reactive-events/active - активные
              события", "GET /api/v1/world/reactive-events/pending - ожидающие события",
              "GET /api/v1/world/reactive-events/by-scale/{scale} - события по масштабу",
              "POST /api/v1/world/reactive-events/{id}/activate - ручная активация",
              "POST /api/v1/world/reactive-events/{id}/cancel - отмена события"],
              "trigger_management": ["GET /api/v1/world/reactive-events/triggers -
              список триггеров", "POST /api/v1/world/reactive-events/triggers - создание
              триггера", "GET /api/v1/world/reactive-events/triggers/{id} - детали
              триггера", "POST /api/v1/world/reactive-events/triggers/{id}/check -
              проверка триггера"], "cascade_management": ["GET /api/v1/world/reactive-events/cascades
              - каскадные связи", "POST /api/v1/world/reactive-events/cascades - создание
              каскада", "GET /api/v1/world/reactive-events/{id}/cascades - каскады
              события"]}, "websocket_events": ["reactive-event:activity-updated -
              обновление активности", "reactive-event:threshold-reached - достигнут
              порог", "reactive-event:event-activated - событие активировано", "reactive-event:cascade-triggered
              - каскадное событие активировано"], "event_bus_topics": ["reactive-event:activity-recorded
              - активность записана", "reactive-event:threshold-checked - проверка
              порога", "reactive-event:event-pending - событие ожидает активации",
              "reactive-event:event-activated - событие активировано", "reactive-event:cascade-triggered
              - каскадное событие", "reactive-event:event-completed - событие завершено"],
              "data_synchronization": {"tick_rate": "- Накопление активности: каждые
              5 минут\n- Проверка порогов: каждые 15 минут\n- Обновление активности:
              при событиях (real-time)\n- Каскадные проверки: каждые 1 час\n", "network_load":
              "- Накопление активности: средняя нагрузка (пакетная обработка)\n- Проверка
              порогов: низкая нагрузка (периодическая)\n- Активация событий: высокая
              нагрузка (требует координации)\n- Каскадные эффекты: средняя нагрузка
              (асинхронная обработка)\n", "caching_strategy": "- Активность по масштабам:
              кэш на 5 минут\n- Пороги активации: кэш на 1 час\n- Активные события:
              кэш на 1 минуту\n- Каскадные связи: кэш на 1 час\n"}, "integrations":
              {"with_world_service": "- Использование существующей системы мировых
              событий\n- Расширение Event Manager для реактивных событий\n- Интеграция
              с Event Scheduler\n", "with_quest_service": "- Подписка на quest:completed
              события\n- Анализ типов завершенных квестов\n- Накопление активности
              от квестов\n", "with_analytics_service": "- Получение метрик активности
              игроков\n- Агрегация данных по масштабам\n- Расчет пороговых значений\n",
              "with_economy_service": "- Подписка на экономические события\n- Анализ
              экономической активности\n- Триггеры экономических событий\n", "with_social_service":
              "- Подписка на изменения репутации\n- Анализ социальной активности\n-
              Триггеры социальных событий\n", "with_player_impact_systems": "- Использование
              данных влияния игроков\n- Интеграция с системой агрегации влияния\n-
              Синхронизация пороговых значений\n"}, "technical_tasks": [{"task": "Расширить
              world-service для реактивных событий", "description": "Добавить компоненты
              в world-service:\n- Activity Accumulator\n- Scale Manager\n- Threshold
              Calculator\n- Reactive Trigger Manager\n- Cascade Event Manager\n",
              "estimated_lines": 450}, {"task": "Создать структуру БД для реактивных
              событий", "description": "Создать таблицы:\n- reactive_events\n- activity_accumulations\n-
              event_triggers\n- cascade_events\n", "estimated_lines": 200}, {"task":
              "Реализовать систему накопления активности", "description": "Создать
              механизм накопления активности:\n- Activity Accumulator\n- Activity
              Window Manager\n- Decay Manager\n", "estimated_lines": 300}, {"task":
              "Реализовать систему триггеров", "description": "Создать систему триггеров:\n-
              Trigger Manager\n- Threshold Calculator\n- Trigger Checker\n", "estimated_lines":
              250}, {"task": "Реализовать каскадные эффекты", "description": "Создать
              механизм каскадных событий:\n- Cascade Event Manager\n- Cascade Condition
              Checker\n- Cascade Delay Manager\n", "estimated_lines": 200}, {"task":
              "Создать API endpoints", "description": "Реализовать REST API для реактивных
              событий:\n- Activity Management endpoints\n- Event Management endpoints\n-
              Trigger Management endpoints\n- Cascade Management endpoints\n", "estimated_lines":
              400}, {"task": "Интегрировать с Event Bus", "description": "Подписка
              на события и публикация событий:\n- Подписка на quest:completed\n- Подписка
              на экономические события\n- Публикация reactive-event:* событий\n",
              "estimated_lines": 200}]}}'
        - column:
            name: metadata
            value: '{"id": "reactive-global-events-system-architecture", "title":
              "Архитектура системы реактивных глобальных событий", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-XXT00:00:00Z", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "world", "events", "reactive", "player-impact", "scaling"], "related_systems":
              ["world-service", "quest-service", "economy-service", "social-service",
              "analytics-service"], "related_documents": [{"id": "world-events-system-architecture",
              "relation": "extends"}, {"id": "player-impact-systems", "relation":
              "implements"}, {"id": "live-events-system", "relation": "extends"}],
              "github_issue": 1454, "visibility": "internal", "audience": ["architect",
              "backend", "world", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\reactive-global-events-system-architecture.yaml
