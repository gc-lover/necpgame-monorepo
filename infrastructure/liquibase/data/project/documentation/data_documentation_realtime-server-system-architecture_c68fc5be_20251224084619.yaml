databaseChangeLog:
- changeSet:
    id: documentation-realtime-server-system-architecture-c68fc5be
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '3108992086392924'
        - column:
            name: doc_id
            value: realtime-server-system-architecture
        - column:
            name: title
            value: Архитектура Realtime Server (Realtime Gateway System)
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 05:30:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - realtime-server
            - backend
            - infrastructure
            - websocket
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - realtime-gateway-go
            - world-service-go
            - gameplay-service-go
            - social-service-go
        - column:
            name: related_documents
            value: '[{"id": "backend-realtime-server-overview", "relation": "extends"},
              {"id": "backend-realtime-server-part1-architecture-zones", "relation":
              "extends"}, {"id": "backend-realtime-server-part2-protocol-optimization",
              "relation": "extends"}, {"id": "backend-realtime-server-part3-performance-profiles",
              "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - infrastructure
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "realtime-server-system-architecture", "title":
              "Архитектура Realtime Server (Realtime Gateway System)", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-11-23T05:30:00+00:00", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "realtime-server", "backend", "infrastructure", "websocket"], "related_systems":
              ["realtime-gateway-go", "world-service-go", "gameplay-service-go", "social-service-go"],
              "related_documents": [{"id": "backend-realtime-server-overview", "relation":
              "extends"}, {"id": "backend-realtime-server-part1-architecture-zones",
              "relation": "extends"}, {"id": "backend-realtime-server-part2-protocol-optimization",
              "relation": "extends"}, {"id": "backend-realtime-server-part3-performance-profiles",
              "relation": "extends"}], "github_issue": 390, "visibility": "internal",
              "audience": ["architect", "backend", "infrastructure", "api-designer"]},
              "summary": {"problem": "Требуется спроектировать полную техническую
              архитектуру Realtime Server для\nобеспечения realtime коммуникации через
              WebSocket, синхронизации состояния игры,\nуправления зонами и оптимизации
              производительности для различных типов контента.\n", "goal": "Создать
              архитектурную схему Realtime Server с определением:\n- Компонентов системы
              (микросервисы, модули)\n- API endpoints (высокоуровнево)\n- Потоков
              данных и интеграций\n- Системы зон (zones)\n- Оптимизации протокола\n-
              Профилей производительности\n- Технического задания для реализации\n",
              "essence": "Realtime Server для обеспечения realtime коммуникации через
              WebSocket,\nсинхронизации состояния игры, управления зонами и оптимизации
              производительности.\n"}, "architecture": {"overview": "Realtime Server
              состоит из восьми основных компонентов:\n1. WebSocket Connection Manager
              - управление WebSocket соединениями\n2. Zone Manager - управление зонами
              и инстансами\n3. Game Loop Manager - управление игровым циклом\n4. Interest
              Management Engine - управление областью интереса\n5. State Synchronization
              Manager - синхронизация состояния\n6. Protocol Optimization Engine -
              оптимизация протокола\n7. Performance Profile Manager - управление профилями
              производительности\n8. Realtime Event Handler - обработка realtime событий\n",
              "components": [{"name": "WebSocket Connection Manager", "location":
              "realtime-gateway-go (модуль websocket-manager)", "responsibility":
              "- Управление WebSocket соединениями\n- Обработка подключений и отключений\n-
              Маршрутизация сообщений\n- Управление подписками на топики\n", "connection_features":
              "- Подключение через WebSocket (ws://localhost:8080/ws/game)\n- Аутентификация
              соединений\n- Управление подписками на топики\n- Heartbeat для проверки
              соединения\n- Graceful disconnect\n", "endpoints": ["WS /ws/game - основной
              WebSocket endpoint", "GET /api/v1/realtime/connections/{connection_id}
              - информация о соединении", "POST /api/v1/realtime/connections/{connection_id}/subscribe
              - подписка на топик", "POST /api/v1/realtime/connections/{connection_id}/unsubscribe
              - отписка от топика"]}, {"name": "Zone Manager", "location": "realtime-gateway-go
              (модуль zone-manager)", "responsibility": "- Управление зонами (Watson,
              Westbrook и т.д.)\n- Распределение зон по инстансам\n- Управление лимитами
              игроков в зонах\n- Мониторинг состояния зон\n", "zone_features": "-
              Определение зон в БД (таблица zones)\n- Распределение зон по инстансам
              (1-5 зон на инстанс)\n- Лимиты игроков в зонах\n- Статусы зон (active,
              maintenance, full)\n- Координаты зон\n", "endpoints": ["GET /api/v1/realtime/zones
              - список зон", "GET /api/v1/realtime/zones/{zone_id} - информация о
              зоне", "GET /api/v1/realtime/zones/{zone_id}/players - игроки в зоне",
              "POST /api/v1/realtime/zones/{zone_id}/join - присоединение к зоне"]},
              {"name": "Game Loop Manager", "location": "realtime-gateway-go (модуль
              game-loop)", "responsibility": "- Управление игровым циклом\n- Обработка
              инпута\n- Обновление состояния\n- Физика и AI\n- Рассылка обновлений
              клиентам\n", "game_loop_features": "- Тикрейт до 20 раз в секунду (20
              Hz)\n- Обработка инпута от клиентов\n- Обновление состояния игры\n-
              Физика и AI\n- Рассылка обновлений клиентам\n- Проверки производительности
              (предупреждение при >50ms на тик)\n", "endpoints": ["GET /api/v1/realtime/game-loop/stats
              - статистика game loop", "POST /api/v1/realtime/game-loop/force-tick
              - принудительный тик"]}, {"name": "Interest Management Engine", "location":
              "realtime-gateway-go (модуль interest-management)", "responsibility":
              "- Управление областью интереса (interest management)\n- Разделение
              зон на ячейки (100x100 м)\n- Определение видимых игроков\n- Минимизация
              трафика\n", "interest_features": "- Разделение зон на ячейки (100x100
              м)\n- Игрок видит свою ячейку и 8 соседних\n- Фильтрация обновлений
              по близости\n- Приоритезация обновлений (близость, боевой статус, party)\n-
              Максимум 50 обновлений за тик\n", "endpoints": ["GET /api/v1/realtime/interest/{zone_id}/{cell_id}/players
              - игроки в ячейке", "POST /api/v1/realtime/interest/{zone_id}/update
              - обновление области интереса"]}, {"name": "State Synchronization Manager",
              "location": "realtime-gateway-go (модуль state-sync)", "responsibility":
              "- Синхронизация состояния игрока\n- Адаптивная частота обновлений\n-
              Delta-компрессия\n- Client prediction и server reconciliation\n", "sync_features":
              "- Адаптивная частота обновлений:\n  - Combat: 60 Hz\n  - Movement:
              20 Hz\n  - Idle: 5 Hz\n- Delta-компрессия (только изменения)\n- Client
              prediction\n- Server reconciliation\n- Lag compensation для боевых событий\n",
              "endpoints": ["POST /api/v1/realtime/sync/{character_id}/state - синхронизация
              состояния", "GET /api/v1/realtime/sync/{character_id}/state - получение
              состояния"]}, {"name": "Protocol Optimization Engine", "location": "realtime-gateway-go
              (модуль protocol-optimization)", "responsibility": "- Оптимизация протокола\n-
              Сериализация (MessagePack)\n- Bandwidth optimization\n- QoS управление\n",
              "protocol_features": "- WebSocket (TCP) для универсальной совместимости\n-
              MessagePack для сериализации\n- Delta-компрессия\n- Приоритезация обновлений\n-
              Network shaping\n- Batching сообщений\n- FEC (Forward Error Correction)\n",
              "endpoints": ["GET /api/v1/realtime/protocol/stats - статистика протокола",
              "POST /api/v1/realtime/protocol/optimize - оптимизация протокола"]},
              {"name": "Performance Profile Manager", "location": "realtime-gateway-go
              (модуль performance-profiles)", "responsibility": "- Управление профилями
              производительности\n- Конфигурация для различных типов контента\n- Автоскейлинг\n-
              Мониторинг производительности\n", "performance_profiles": "- Esports:
              60 Hz, низкая задержка\n- Siege: 30 Hz, средняя задержка\n- Extraction:
              20 Hz, средняя задержка\n- Open World: 20 Hz, высокая задержка\n- Raids:
              20 Hz, средняя задержка\n- Massive Warfront: 10 Hz, высокая задержка\n-
              Casual: 10 Hz, высокая задержка\n- Social: 5 Hz, очень высокая задержка\n",
              "endpoints": ["GET /api/v1/realtime/profiles - список профилей", "GET
              /api/v1/realtime/profiles/{profile_id} - информация о профиле", "POST
              /api/v1/realtime/profiles/{profile_id}/apply - применение профиля"]},
              {"name": "Realtime Event Handler", "location": "realtime-gateway-go
              (модуль event-handler)", "responsibility": "- Обработка realtime событий\n-
              Публикация событий в event bus\n- Подписка на события от других систем\n-
              Маршрутизация событий клиентам\n", "event_types": "- Combat events (damage,
              kills, deaths)\n- Movement events (position, rotation)\n- Chat events
              (messages, commands)\n- World events (spawns, despawns, updates)\n-
              Social events (party, guild, friend)\n", "endpoints": ["GET /api/v1/realtime/events/{zone_id}
              - события зоны", "POST /api/v1/realtime/events/publish - публикация
              события"]}], "data_flow": {"client_connection": "1. Клиент подключается
              через WebSocket\n2. WebSocket Connection Manager аутентифицирует соединение\n3.
              Создаётся сессия соединения\n4. Клиент подписывается на топики (zone,
              character, world)\n5. Zone Manager определяет зону для клиента\n6. Interest
              Management Engine добавляет клиента в ячейку\n7. State Synchronization
              Manager начинает синхронизацию\n8. Realtime Gateway отправляет начальное
              состояние\n", "state_synchronization": "1. Клиент отправляет инпут через
              WebSocket\n2. Game Loop Manager обрабатывает инпут\n3. State Synchronization
              Manager обновляет состояние\n4. Interest Management Engine определяет
              видимых игроков\n5. Protocol Optimization Engine оптимизирует обновления\n6.
              Realtime Gateway отправляет обновления клиентам\n7. Клиент применяет
              client prediction\n8. Server reconciliation корректирует состояние\n",
              "zone_management": "1. Zone Manager получает запрос на присоединение
              к зоне\n2. Проверяются лимиты игроков в зоне\n3. Определяется инстанс
              для зоны\n4. Игрок добавляется в зону\n5. Interest Management Engine
              добавляет игрока в ячейку\n6. State Synchronization Manager начинает
              синхронизацию\n7. Realtime Gateway уведомляет других игроков\n"}, "integrations":
              {"with_world_service": "- Получение данных о зонах\n- Синхронизация
              мировых событий\n- Управление NPC и объектами\n", "with_gameplay_service":
              "- Обработка боевых событий\n- Синхронизация боевого состояния\n- Обработка
              квестов\n", "with_social_service": "- Синхронизация чата\n- Синхронизация
              party/guild событий\n- Синхронизация friend событий\n", "with_character_service":
              "- Получение данных о персонажах\n- Синхронизация позиций\n- Обновление
              статов\n", "with_notification_service": "- Push-уведомления через WebSocket\n-
              Уведомления о событиях\n- Системные уведомления\n", "with_observability":
              "- Метрики производительности\n- Логирование событий\n- Мониторинг соединений\n"},
              "database_schema": {"tables": [{"name": "zones", "description": "Зоны
              игры", "fields": [{"id": "UUID (PK)"}, {"name": "VARCHAR(255)"}, {"zone_type":
              "VARCHAR(50)"}, {"min_x": "FLOAT"}, {"min_y": "FLOAT"}, {"max_x": "FLOAT"},
              {"max_y": "FLOAT"}, {"max_players": "INTEGER"}, {"current_players":
              "INTEGER"}, {"status": "ENUM (active, maintenance, full)"}, {"instance_id":
              "UUID (nullable)"}, {"created_at": "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}],
              "indexes": ["zone_type, status", "instance_id"]}, {"name": "zone_cells",
              "description": "Ячейки зон для interest management", "fields": [{"id":
              "UUID (PK)"}, {"zone_id": "UUID (FK zones)"}, {"cell_x": "INTEGER"},
              {"cell_y": "INTEGER"}, {"min_x": "FLOAT"}, {"min_y": "FLOAT"}, {"max_x":
              "FLOAT"}, {"max_y": "FLOAT"}], "constraints": "- UNIQUE(zone_id, cell_x,
              cell_y)\n", "indexes": ["zone_id, cell_x, cell_y"]}, {"name": "game_instances",
              "description": "Инстансы game server", "fields": [{"id": "UUID (PK)"},
              {"instance_type": "VARCHAR(50)"}, {"status": "ENUM (active, starting,
              stopping, stopped)"}, {"zones": "UUID[] (array of zone IDs)"}, {"current_players":
              "INTEGER"}, {"max_players": "INTEGER"}, {"tick_rate": "INTEGER"}, {"performance_profile":
              "VARCHAR(50)"}, {"created_at": "TIMESTAMP"}, {"updated_at": "TIMESTAMP"}],
              "indexes": ["status, instance_type", "performance_profile"]}, {"name":
              "player_connections", "description": "WebSocket соединения игроков",
              "fields": [{"id": "UUID (PK)"}, {"player_id": "UUID (FK accounts)"},
              {"character_id": "UUID (FK characters, nullable)"}, {"zone_id": "UUID
              (FK zones, nullable)"}, {"cell_x": "INTEGER (nullable)"}, {"cell_y":
              "INTEGER (nullable)"}, {"instance_id": "UUID (FK game_instances, nullable)"},
              {"connection_state": "ENUM (connected, disconnected, reconnecting)"},
              {"last_heartbeat": "TIMESTAMP"}, {"connected_at": "TIMESTAMP"}, {"disconnected_at":
              "TIMESTAMP (nullable)"}], "indexes": ["player_id, connection_state",
              "zone_id, cell_x, cell_y", "instance_id"]}, {"name": "realtime_events",
              "description": "Лог realtime событий", "fields": [{"id": "UUID (PK)"},
              {"event_type": "VARCHAR(50)"}, {"zone_id": "UUID (FK zones, nullable)"},
              {"character_id": "UUID (FK characters, nullable)"}, {"event_data": "JSONB"},
              {"created_at": "TIMESTAMP"}], "indexes": ["event_type, created_at",
              "zone_id, created_at", "character_id, created_at"]}]}}, "technical_specification":
              {"backend_requirements": [{"Реализация модулей в realtime-gateway-go":
              ["websocket-manager (управление WebSocket соединениями)", "zone-manager
              (управление зонами)", "game-loop (игровой цикл)", "interest-management
              (область интереса)", "state-sync (синхронизация состояния)", "protocol-optimization
              (оптимизация протокола)", "performance-profiles (профили производительности)",
              "event-handler (обработка событий)"]}, "Интеграция с world-service для
              зон", "Интеграция с gameplay-service для боевых событий", "Интеграция
              с social-service для чата", "Интеграция с character-service для персонажей",
              "Оптимизация производительности (тикрейт, bandwidth)"], "realtime_requirements":
              ["WebSocket соединения для realtime коммуникации", "Адаптивная частота
              обновлений", "Client prediction и server reconciliation", "Lag compensation
              для боевых событий", "Delta-компрессия для оптимизации трафика"], "performance_requirements":
              [{"Тикрейт": "5-60 Hz (в зависимости от профиля)"}, {"Задержка": "<50ms
              на тик"}, {"Bandwidth": "оптимизация через delta-компрессию"}, "Поддержка
              до 10K одновременных соединений на инстанс", "Поддержка до 100K игроков
              в зоне (Massive Warfront)"]}}'
        - column:
            name: metadata
            value: '{"id": "realtime-server-system-architecture", "title": "Архитектура
              Realtime Server (Realtime Gateway System)", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-23T05:30:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "realtime-server",
              "backend", "infrastructure", "websocket"], "related_systems": ["realtime-gateway-go",
              "world-service-go", "gameplay-service-go", "social-service-go"], "related_documents":
              [{"id": "backend-realtime-server-overview", "relation": "extends"},
              {"id": "backend-realtime-server-part1-architecture-zones", "relation":
              "extends"}, {"id": "backend-realtime-server-part2-protocol-optimization",
              "relation": "extends"}, {"id": "backend-realtime-server-part3-performance-profiles",
              "relation": "extends"}], "github_issue": 390, "visibility": "internal",
              "audience": ["architect", "backend", "infrastructure", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\realtime-server-system-architecture.yaml
