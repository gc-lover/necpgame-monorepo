databaseChangeLog:
- changeSet:
    id: documentation-relationships-system-architecture-c9dd3cbe
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '7066838964388964'
        - column:
            name: doc_id
            value: relationships-system-architecture
        - column:
            name: title
            value: Архитектура системы отношений
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 23:58:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - social
            - relationships
            - trust
            - alliances
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - social-service
            - economy-service
            - world-service
            - gameplay-service
        - column:
            name: related_documents
            value: '[{"id": "relationships-system-detailed", "relation": "implements"},
              {"id": "reputation-system-architecture", "relation": "complements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - social
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "relationships-system-architecture", "title":
              "Архитектура системы отношений", "document_type": "architecture", "category":
              "systems", "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T23:58:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "social", "relationships", "trust", "alliances"],
              "related_systems": ["social-service", "economy-service", "world-service",
              "gameplay-service"], "related_documents": [{"id": "relationships-system-detailed",
              "relation": "implements"}, {"id": "reputation-system-architecture",
              "relation": "complements"}], "github_issue": 306, "visibility": "internal",
              "audience": ["architect", "backend", "social", "api-designer"]}, "summary":
              {"problem": "Требуется спроектировать архитектуру системы отношений,
              включающую:\n- Отношения между игроками (Friends, Close Allies, Pact,
              Enemies, Nemesis)\n- Доверие и договоры доверия (5 уровней)\n- Союзы
              (Combat, Trade, Clan, Faction)\n- Рейтинги и социальный капитал\n- История
              взаимодействий и арбитраж\n- Интеграции с репутацией, экономикой и миром\n",
              "goal": "Создать архитектурную схему системы отношений с определением:\n-
              Компонентов для управления отношениями\n- REST, WebSocket и Event Bus
              контрактов\n- Интеграций с другими системами\n- Структуры БД\n- Технического
              задания для реализации\n", "essence": "Объединенная архитектура системы
              отношений с поддержкой межличностных отношений,\nдоверия, союзов, рейтингов
              и интеграции с репутацией и экономикой.\n"}, "architecture": {"overview":
              "Архитектура системы отношений состоит из следующих компонентов:\n1.
              Relationship Manager - управление отношениями\n2. Player Relationship
              Manager - управление отношениями между игроками\n3. Trust Manager -
              управление доверием\n4. Trust Contract Manager - управление договорами
              доверия\n5. Alliance Manager - управление союзами\n6. Rating Manager
              - управление рейтингами\n7. Social Capital Manager - управление социальным
              капиталом\n8. Interaction History Manager - управление историей взаимодействий\n9.
              Relationship Arbitration Manager - управление арбитражем отношений\n10.
              Relationship Effects Applier - применение эффектов отношений\n11. Relationship
              Telemetry Collector - сбор телеметрии\n", "microservices": [{"name":
              "social-service", "port": 8084, "responsibility": "Обработка отношений:\n-
              Управление отношениями между игроками\n- Управление доверием и договорами\n-
              Управление союзами\n- Управление рейтингами\n- Управление социальным
              капиталом\n- Управление историей взаимодействий\n- Управление арбитражем\n-
              Применение эффектов отношений\n- Сбор телеметрии\n", "components": [{"relationship-manager":
              "управление отношениями"}, {"player-relationship-manager": "управление
              отношениями между игроками"}, {"trust-manager": "управление доверием"},
              {"trust-contract-manager": "управление договорами доверия"}, {"alliance-manager":
              "управление союзами"}, {"rating-manager": "управление рейтингами"},
              {"social-capital-manager": "управление социальным капиталом"}, {"interaction-history-manager":
              "управление историей взаимодействий"}, {"relationship-arbitration-manager":
              "управление арбитражем"}, {"relationship-effects-applier": "применение
              эффектов отношений"}, {"relationship-telemetry-collector": "сбор телеметрии"}],
              "endpoints": ["GET /api/v1/social/relationships/{characterId} - отношения
              персонажа", "POST /api/v1/social/relationships/{characterId}/set - установка
              отношения", "GET /api/v1/social/relationships/{characterId1}/{characterId2}
              - отношение между персонажами", "POST /api/v1/social/relationships/{characterId}/trust/update
              - обновление доверия", "GET /api/v1/social/relationships/{characterId}/trust
              - уровень доверия", "POST /api/v1/social/relationships/trust-contracts/create
              - создание договора доверия", "GET /api/v1/social/relationships/trust-contracts/{contractId}
              - информация о договоре", "POST /api/v1/social/relationships/trust-contracts/{contractId}/terminate
              - расторжение договора", "POST /api/v1/social/relationships/alliances/create
              - создание союза", "GET /api/v1/social/relationships/alliances - список
              союзов", "GET /api/v1/social/relationships/alliances/{allianceId} -
              информация о союзе", "POST /api/v1/social/relationships/alliances/{allianceId}/invite
              - приглашение в союз", "POST /api/v1/social/relationships/alliances/{allianceId}/join
              - присоединение к союзу", "POST /api/v1/social/relationships/alliances/{allianceId}/leave
              - выход из союза", "POST /api/v1/social/relationships/alliances/{allianceId}/terminate
              - расторжение союза", "GET /api/v1/social/relationships/ratings/{characterId}
              - рейтинги персонажа", "POST /api/v1/social/relationships/ratings/{characterId}/update
              - обновление рейтинга", "GET /api/v1/social/relationships/social-capital/{characterId}
              - социальный капитал", "GET /api/v1/social/relationships/history/{characterId}
              - история взаимодействий", "POST /api/v1/social/relationships/arbitration/request
              - запрос арбитража", "GET /api/v1/social/relationships/arbitration/{caseId}
              - информация об арбитраже"], "websocket_channels": ["wss://api.necp.game/v1/social/relationships/{characterId}
              - поток обновлений отношений персонажа"], "events_published": [{"social.relationship.changed":
              "изменено отношение"}, {"social.relationship.trust-updated": "обновлено
              доверие"}, {"social.relationship.trust-contract-created": "создан договор
              доверия"}, {"social.relationship.trust-contract-terminated": "расторгнут
              договор доверия"}, {"social.relationship.alliance-created": "создан
              союз"}, {"social.relationship.alliance-joined": "присоединение к союзу"},
              {"social.relationship.alliance-left": "выход из союза"}, {"social.relationship.alliance-terminated":
              "расторгнут союз"}, {"social.relationship.rating-updated": "обновлен
              рейтинг"}, {"social.relationship.social-capital-updated": "обновлен
              социальный капитал"}, {"social.relationship.interaction-logged": "залогировано
              взаимодействие"}, {"social.relationship.arbitration-requested": "запрошен
              арбитраж"}, {"social.relationship.arbitration-resolved": "арбитраж разрешен"}],
              "events_subscribed": [{"quest.completed": "завершение квеста"}, {"character.level-up":
              "повышение уровня"}, {"reputation.changed": "изменение репутации"},
              {"economy.transaction": "транзакция в экономике"}, {"world.event": "событие
              мира"}, {"combat.pvp-encounter": "PvP встреча"}, {"player-order.completed":
              "завершение заказа"}]}], "player_relationship_levels": [{"name": "friends",
              "description": "Друзья - базовый уровень дружеских отношений", "reputation_range":
              [20, 50], "effects": [{"visibility": "видимость в списке друзей"}, {"coordination":
              "координация действий"}, {"resource_sharing": "базовый доступ к ресурсам"}]},
              {"name": "close_allies", "description": "Близкие союзники - высокий
              уровень доверия", "reputation_range": [50, 80], "effects": [{"visibility":
              "приоритетная видимость"}, {"coordination": "расширенная координация"},
              {"resource_sharing": "расширенный доступ к ресурсам"}, {"base_access":
              "доступ к базам"}]}, {"name": "pact", "description": "Пакт - максимальный
              уровень союза", "reputation_range": [80, 100], "effects": [{"visibility":
              "полная видимость"}, {"coordination": "полная координация"}, {"resource_sharing":
              "полный доступ к ресурсам"}, {"base_access": "полный доступ к базам"},
              {"joint_operations": "совместные операции"}]}, {"name": "neutral", "description":
              "Нейтральные - отсутствие отношений", "reputation_range": [-20, 20],
              "effects": [{"visibility": "стандартная видимость"}, {"coordination":
              "нет координации"}, {"resource_sharing": "нет доступа к ресурсам"}]},
              {"name": "enemies", "description": "Враги - враждебные отношения", "reputation_range":
              [-50, -20], "effects": [{"visibility": "видимость врагов"}, {"warnings":
              "предупреждения о приближении"}, {"pvp_quests": "триггеры PvP-квестов"}]},
              {"name": "nemesis", "description": "Злейшие враги - максимальная враждебность",
              "reputation_range": [-100, -50], "effects": [{"visibility": "приоритетная
              видимость врагов"}, {"warnings": "активные предупреждения"}, {"pvp_quests":
              "приоритетные PvP-квесты"}, {"bounty": "возможность награды за устранение"}]}],
              "trust_levels": [{"level": 0, "name": "No Trust", "description": "Отсутствие
              доверия", "effects": [{"trade_limit": 0}, {"resource_access": false},
              {"contract_depth": "none"}]}, {"level": 1, "name": "Low Trust", "description":
              "Низкий уровень доверия", "range": [1, 25], "effects": [{"trade_limit":
              1000}, {"resource_access": "basic"}, {"contract_depth": "simple"}]},
              {"level": 2, "name": "Moderate Trust", "description": "Умеренный уровень
              доверия", "range": [25, 50], "effects": [{"trade_limit": 5000}, {"resource_access":
              "moderate"}, {"contract_depth": "standard"}]}, {"level": 3, "name":
              "High Trust", "description": "Высокий уровень доверия", "range": [50,
              75], "effects": [{"trade_limit": 20000}, {"resource_access": "high"},
              {"contract_depth": "advanced"}]}, {"level": 4, "name": "Maximum Trust",
              "description": "Максимальный уровень доверия", "range": [75, 100], "effects":
              [{"trade_limit": 100000}, {"resource_access": "full"}, {"contract_depth":
              "complex"}]}], "trust_contracts": {"types": [{"name": "resource_sharing",
              "description": "Договор о совместном использовании ресурсов", "parameters":
              [{"resource_types": "типы ресурсов"}, {"sharing_percentage": "процент
              совместного использования"}, {"duration": "длительность договора"}]},
              {"name": "profit_sharing", "description": "Договор о распределении прибыли",
              "parameters": [{"profit_percentage": "процент прибыли"}, {"distribution_method":
              "метод распределения"}, {"duration": "длительность договора"}]}, {"name":
              "base_access", "description": "Договор о доступе к базам", "parameters":
              [{"base_ids": "список баз"}, {"access_level": "уровень доступа"}, {"duration":
              "длительность договора"}]}], "termination_conditions": [{"violation":
              "нарушение условий"}, {"mutual_agreement": "взаимное согласие"}, {"expiration":
              "истечение срока"}, {"arbitration": "решение арбитража"}]}, "alliance_types":
              [{"name": "combat", "description": "Боевой союз - совместные боевые
              операции", "effects": [{"combat_bonus": "бонусы к боевым действиям"},
              {"shared_objectives": "совместные цели"}, {"reputation_bonus": "бонус
              к репутации"}]}, {"name": "trade", "description": "Торговый союз - совместная
              торговля", "effects": [{"trade_discounts": "торговые скидки"}, {"shared_markets":
              "совместные рынки"}, {"profit_sharing": "распределение прибыли"}]},
              {"name": "clan", "description": "Клановый союз - союз между кланами",
              "effects": [{"clan_bonuses": "бонусы кланов"}, {"shared_resources":
              "совместные ресурсы"}, {"joint_operations": "совместные операции"}]},
              {"name": "faction", "description": "Фракционный союз - союз между фракциями",
              "effects": [{"faction_bonuses": "бонусы фракций"}, {"diplomatic_status":
              "дипломатический статус"}, {"world_influence": "влияние на мир"}]}],
              "ratings": {"types": [{"name": "overall", "description": "Общий рейтинг",
              "factors": [{"completion_rate": "процент успешных выполнений"}, {"quality_score":
              "оценка качества"}, {"timeliness": "своевременность"}]}, {"name": "combat",
              "description": "Боевой рейтинг", "factors": [{"combat_performance":
              "боевая эффективность"}, {"pvp_record": "PvP рекорд"}, {"raid_performance":
              "эффективность в рейдах"}]}, {"name": "trade", "description": "Торговый
              рейтинг", "factors": [{"trade_volume": "объем торговли"}, {"trade_reliability":
              "надежность торговли"}, {"profit_margin": "маржа прибыли"}]}, {"name":
              "reliability", "description": "Рейтинг надежности", "factors": [{"contract_completion":
              "выполнение контрактов"}, {"deadline_adherence": "соблюдение сроков"},
              {"dispute_resolution": "разрешение споров"}]}, {"name": "social_influence",
              "description": "Рейтинг социального влияния", "factors": [{"network_size":
              "размер сети"}, {"mentorship_rating": "рейтинг наставничества"}, {"community_contributions":
              "вклад в сообщество"}]}]}, "social_capital": {"factors": [{"relationship_count":
              "количество отношений"}, {"trust_level_average": "средний уровень доверия"},
              {"alliance_count": "количество союзов"}, {"rating_average": "средний
              рейтинг"}, {"interaction_history": "история взаимодействий"}], "effects":
              [{"mission_access": "доступ к миссиям"}, {"reward_bonuses": "бонусы
              к наградам"}, {"reputation_modifier": "модификатор репутации"}, {"economic_benefits":
              "экономические преимущества"}]}, "interaction_history": {"event_types":
              [{"trade": "торговые сделки"}, {"combat": "боевые встречи"}, {"contracts":
              "контракты"}, {"quests": "квесты"}, {"disputes": "споры"}, {"arbitration":
              "арбитраж"}], "logging": [{"event_type": "тип события"}, {"participants":
              "участники"}, {"outcome": "результат"}, {"timestamp": "временная метка"},
              {"evidence": "доказательства"}]}, "arbitration": {"triggers": [{"contract_violation":
              "нарушение контракта"}, {"trust_abuse": "злоупотребление доверием"},
              {"alliance_violation": "нарушение союза"}, {"dispute": "спор"}], "process":
              [{"complaint_filing": "подача жалобы"}, {"evidence_collection": "сбор
              доказательств"}, {"analysis": "анализ"}, {"decision": "вынесение решения"},
              {"enforcement": "исполнение решения"}], "decisions": [{"compensation":
              "компенсация"}, {"penalty": "штраф"}, {"relationship_change": "изменение
              отношения"}, {"trust_reduction": "снижение доверия"}, {"alliance_termination":
              "расторжение союза"}]}, "data_flows": {"relationship_change_flow": "1.
              Игрок устанавливает отношение к другому игроку\n2. Player Relationship
              Manager проверяет требования\n3. Player Relationship Manager обновляет
              отношение в БД\n4. Relationship Effects Applier применяет эффекты\n5.
              Social Service публикует событие social.relationship.changed\n6. Realtime
              Gateway отправляет обновление клиентам\n", "trust_update_flow": "1.
              Происходит взаимодействие между игроками\n2. Trust Manager рассчитывает
              изменение доверия\n3. Trust Manager обновляет уровень доверия\n"}}}'
        - column:
            name: metadata
            value: '{"id": "relationships-system-architecture", "title": "Архитектура
              системы отношений", "document_type": "architecture", "category": "systems",
              "status": "draft", "version": "1.0.0", "last_updated": "2025-11-23T23:58:00+00:00",
              "owners": [{"role": "architect", "contact": "architect@necp.game"}],
              "tags": ["architecture", "social", "relationships", "trust", "alliances"],
              "related_systems": ["social-service", "economy-service", "world-service",
              "gameplay-service"], "related_documents": [{"id": "relationships-system-detailed",
              "relation": "implements"}, {"id": "reputation-system-architecture",
              "relation": "complements"}], "github_issue": 306, "visibility": "internal",
              "audience": ["architect", "backend", "social", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\relationships-system-architecture.yaml
