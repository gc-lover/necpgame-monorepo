databaseChangeLog:
- changeSet:
    id: documentation-romance-engine-scoring-c60b1ef2
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-341138616784978'
        - column:
            name: doc_id
            value: implementation-romance-engine-scoring
        - column:
            name: title
            value: Romance Event Engine — Оценка и выбор
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: algorithms
        - column:
            name: status
            value: approved
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-07 01:46:00+00:00
        - column:
            name: concept_approved
            value: true
        - column:
            name: concept_reviewed_at
            value: 2025-11-07 01:46:00+00:00
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - romance
            - scoring
            - ai
        - column:
            name: topics
            value:
            - event-engine
            - personalization
        - column:
            name: related_systems
            value:
            - romance-service
            - notification-service
            - analytics-pipeline
        - column:
            name: related_documents
            value: '[{"id": "implementation-romance-engine-filtering", "relation":
              "references"}, {"id": "implementation-romance-engine-execution", "relation":
              "complements"}]'
        - column:
            name: source
            value: shared/docs/knowledge/implementation/algorithms/romance/romance-engine-scoring.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - backend
            - ai
        - column:
            name: risk_level
            value: high
        - column:
            name: content
            value: '{"metadata": {"id": "implementation-romance-engine-scoring", "title":
              "Romance Event Engine — Оценка и выбор", "document_type": "implementation",
              "category": "algorithms", "status": "approved", "version": "1.0.0",
              "last_updated": "2025-11-07T01:46:00+00:00", "concept_approved": true,
              "concept_reviewed_at": "2025-11-07T01:46:00+00:00", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["romance",
              "scoring", "ai"], "topics": ["event-engine", "personalization"], "related_systems":
              ["romance-service", "notification-service", "analytics-pipeline"], "related_documents":
              [{"id": "implementation-romance-engine-filtering", "relation": "references"},
              {"id": "implementation-romance-engine-execution", "relation": "complements"}],
              "source": "shared/docs/knowledge/implementation/algorithms/romance/romance-engine-scoring.md",
              "visibility": "internal", "audience": ["concept", "backend", "ai"],
              "risk_level": "high"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions":
              []}, "summary": {"problem": "Оценка и ранжирование романтических событий
              в Markdown усложняли автоматическое ревью и интеграцию с Vision.", "goal":
              "Перевести микрофичу scoring & selection в YAML, сохранив формулы, стратегию
              выбора и культурные адаптации.", "essence": "Документ описывает расчёт
              итогового балла события, подбор топ-N рекомендаций и правила адаптации
              событий к культуре NPC.", "key_points": ["Composite Score учитывает
              контекст, состояние отношений, драматургию, предпочтения игрока и случайный
              фактор.", "SelectNextEvents формирует кандидатов через фильтрацию, взвешивание,
              сортировку, разнообразие и добавление случайного wild card.", "Система
              адаптации подстраивает диалоги, DC и дополнительные шаги под культуру
              NPC и знания игрока."]}, "content": {"sections": [{"id": "composite_score",
              "title": "Формула итогового балла", "body": "calculate_final_event_score
              стартует с веса события и добавляет бонусы за локацию, особые даты,
              погодные условия,\nпрогресс отношений, химию, предпочтения игрока и
              позитивную историю NPC. Штрафы регулируют драму и конфликт.\nРезультат
              ограничен диапазоном 0–100 и подаётся на этап ранжирования.\n", "mechanics_links":
              ["implementation/algorithms/romance/romance-engine-filtering.yaml"],
              "assets": []}, {"id": "selection_strategy", "title": "Стратегия выбора
              событий", "body": "select_next_events выполняет сбор всех событий, жесткую
              и мягкую фильтрацию, вычисление веса и итогового балла,\nсортировку
              по убыванию, контроль разнообразия и добавление случайного кандидата.
              Метод поддерживает NPC-инициируемые\nсобытия через дополнительную функцию
              npc_initiate_event.\n", "mechanics_links": [], "assets": []}, {"id":
              "cultural_adaptation", "title": "Культурная адаптация", "body": "adapt_event_to_culture
              модифицирует диалоги, сложность проверок, публичность проявлений и добавляет
              шаги с семьёй.\nФункция учитывает знания игрока о культуре, язык, темп
              романтического развития и выдаёт бонусы или штрафы к отношениям.\n",
              "mechanics_links": ["implementation/algorithms/romance/romance-engine-execution.yaml"],
              "assets": []}, {"id": "trigger_validation", "title": "Проверка триггеров
              события", "body": "EventTriggerEngine агрегирует все условия: локацию,
              время, сезон, погоду, отношения, химию, активные квесты,\nприсутствие
              NPC, флаги приватности и случайные шансы. Метод возвращает статус и
              причину отказа, что помогает UI и аналитике.\n", "mechanics_links":
              ["implementation/algorithms/romance/romance-event-triggers.yaml"], "assets":
              []}, {"id": "context_collection", "title": "Сбор контекста", "body":
              "gather_romance_context объединяет данные об окружении, социальном фоне,
              состоянии отношений и флагах,\nобеспечивая модель данными для scoring
              и адаптации. Контекст используется также в аналитике и воспоминаниях
              NPC.\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary":
              [], "references": [], "decisions": []}, "implementation": {"needs_task":
              false, "github_issue": 68, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"],
              "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-11-07",
              "author": "ai_brain_manager", "changes": "Описаны алгоритмы оценки,
              выбора и культурной адаптации романтических событий."}], "validation":
              {"checksum": "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "implementation-romance-engine-scoring", "title": "Romance
              Event Engine — Оценка и выбор", "document_type": "implementation", "category":
              "algorithms", "status": "approved", "version": "1.0.0", "last_updated":
              "2025-11-07T01:46:00+00:00", "concept_approved": true, "concept_reviewed_at":
              "2025-11-07T01:46:00+00:00", "owners": [{"role": "concept_director",
              "contact": "concept@necp.game"}], "tags": ["romance", "scoring", "ai"],
              "topics": ["event-engine", "personalization"], "related_systems": ["romance-service",
              "notification-service", "analytics-pipeline"], "related_documents":
              [{"id": "implementation-romance-engine-filtering", "relation": "references"},
              {"id": "implementation-romance-engine-execution", "relation": "complements"}],
              "source": "shared/docs/knowledge/implementation/algorithms/romance/romance-engine-scoring.md",
              "visibility": "internal", "audience": ["concept", "backend", "ai"],
              "risk_level": "high"}'
        - column:
            name: source_file
            value: knowledge\implementation\algorithms\romance\romance-engine-scoring.yaml
