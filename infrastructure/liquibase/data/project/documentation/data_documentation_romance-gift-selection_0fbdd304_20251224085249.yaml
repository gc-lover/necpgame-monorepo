databaseChangeLog:
- changeSet:
    id: documentation-romance-gift-selection-0fbdd304
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-216404527601380'
        - column:
            name: doc_id
            value: implementation-romance-gift-selection
        - column:
            name: title
            value: Romance Gift & Gesture Engine — Выбор подарков и жестов
        - column:
            name: document_type
            value: implementation
        - column:
            name: category
            value: algorithms
        - column:
            name: status
            value: approved
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-20 00:00:00+00:00
        - column:
            name: concept_approved
            value: true
        - column:
            name: concept_reviewed_at
            value: 2025-12-20 00:00:00+00:00
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - romance
            - gifts
            - gestures
            - personalization
        - column:
            name: topics
            value:
            - romance-system
            - player-choice
            - npc-preferences
        - column:
            name: related_systems
            value:
            - romance-service
            - inventory-service
            - economy-service
        - column:
            name: related_documents
            value: '[{"id": "implementation-romance-engine-scoring", "relation": "references"},
              {"id": "implementation-romance-relationship", "relation": "complements"}]'
        - column:
            name: source
            value: shared/docs/knowledge/implementation/algorithms/romance/romance-gift-selection.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - backend
            - game-design
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "implementation-romance-gift-selection", "title":
              "Romance Gift & Gesture Engine — Выбор подарков и жестов", "document_type":
              "implementation", "category": "algorithms", "status": "approved", "version":
              "1.0.0", "last_updated": "2025-12-20T00:00:00+00:00", "concept_approved":
              true, "concept_reviewed_at": "2025-12-20T00:00:00+00:00", "owners":
              [{"role": "concept_director", "contact": "concept@necp.game"}], "tags":
              ["romance", "gifts", "gestures", "personalization"], "topics": ["romance-system",
              "player-choice", "npc-preferences"], "related_systems": ["romance-service",
              "inventory-service", "economy-service"], "related_documents": [{"id":
              "implementation-romance-engine-scoring", "relation": "references"},
              {"id": "implementation-romance-relationship", "relation": "complements"}],
              "source": "shared/docs/knowledge/implementation/algorithms/romance/romance-gift-selection.md",
              "visibility": "internal", "audience": ["concept", "backend", "game-design"],
              "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "Romance System Review Cell", "reviewed_at": "2025-12-20T00:00:00+00:00",
              "status": "approved"}], "next_actions": []}, "summary": {"problem":
              "Система выбора подарков и романтических жестов отсутствовала в алгоритмах
              романтики.", "goal": "Создать интеллектуальную систему подбора подарков
              на основе предпочтений NPC, стадии отношений и культурного контекста.",
              "essence": "Алгоритм анализирует профиль NPC, историю отношений и доступные
              предметы для предложения наиболее подходящих романтических жестов.",
              "key_points": [{"Анализ профиля NPC": "предпочтения, аллергии, культурный
              фон, текущие отношения"}, {"Система весов": "качество предмета, личные
              предпочтения, стадия отношений, бюджет"}, {"Динамические предложения":
              "от простых жестов до роскошных подарков"}, {"Обратная связь": "адаптация
              предпочтений на основе реакции NPC"}]}, "content": {"sections": [{"id":
              "gift_scoring_algorithm", "title": "Алгоритм оценки подарков", "body":
              "**GiftScore = BaseValue × PersonalMultiplier × RelationshipMultiplier
              × ContextMultiplier × RandomFactor**\n\nГде:\n- **BaseValue**: Базовая
              стоимость предмета в ED (экономический вес)\n- **PersonalMultiplier**:
              Личный коэффициент предпочтений NPC (0.1 - 3.0)\n- **RelationshipMultiplier**:
              Множитель стадии отношений (1.0 - 2.5)\n- **ContextMultiplier**: Контекстный
              множитель (0.5 - 1.5)\n- **RandomFactor**: Случайный элемент для разнообразия
              (0.8 - 1.2)\n"}, {"id": "personal_preferences", "title": "Личные предпочтения
              NPC", "body": "**Категории предпочтений:**\n\n1. **Материальные ценности**\n   -
              Tech: Нейроимпланты, гаджеты, софт\n   - Luxury: Драгоценности, одежда,
              аксессуары\n   - Practical: Инструменты, оружие, полезные предметы\n\n2.
              **Ценности и мировоззрение**\n   - Street: Уличные артефакты, подпольные
              товары\n   - Corporate: Роскошные бренды, статусные предметы\n   - Nomad:
              Рукоделие, природные материалы, культура кочевников\n\n3. **Личные вкусы**\n   -
              Colors: Любимые цвета (адаптация под цветовую схему)\n   - Styles: Визуальный
              стиль (cyberpunk, street, elegant)\n   - Origins: Культурные корни (азиатские,
              европейские, американские мотивы)\n\n**Пример профиля Claire (Afterlife
              bartender):**\n```yaml\npreferences:\n  tech: 0.8\n  luxury: 0.6\n  practical:
              0.9\n  street: 0.9\n  corporate: 0.3\n  nomad: 0.7\nfavorites:\n  colors:
              [\"neon_blue\", \"silver\"]\n  styles: [\"street\", \"cyberpunk\"]\n  origins:
              [\"american\", \"mixed\"]\ndislikes:\n  - \"cheap_synths\"\n  - \"corporate_brands\"\n```\n"},
              {"id": "relationship_stages", "title": "Стадии отношений и множители",
              "body": "**Стадии отношений и соответствующие множители:**\n\n| Стадия
              | Уровень доверия | RelationshipMultiplier | Подходящие подарки |\n|--------|----------------|----------------------|-------------------|\n|
              Acquaintance | 0-20 | 1.0 | Простые жесты, напитки, casual gifts |\n|
              Interest | 21-40 | 1.2 | Личные предметы, внимание к предпочтениям |\n|
              Attraction | 41-60 | 1.4 | Значимые подарки, жесты привязанности |\n|
              Romance | 61-80 | 1.8 | Роскошные подарки, символические предметы |\n|
              Commitment | 81-100 | 2.2 | Крупные инвестиции, семейные символы |\n\n**Динамика
              множителя:**\n- Увеличивается с прогрессом отношений\n- Уменьшается
              при негативных событиях\n- Может быть временно повышен специальными
              событиями\n"}, {"id": "context_modifiers", "title": "Контекстные модификаторы",
              "body": "**Временные факторы:**\n- **Праздники**: +0.3 (рождество, новый
              год, корпоративные праздники)\n- **Юбилеи**: +0.4 (годовщина знакомства,
              важные даты)\n- **Кризисы**: +0.2 (поддержка во время трудностей)\n\n**Ситуационные
              бонусы:**\n- **После успешного квеста**: +0.2 (празднование победы)\n-
              **После конфликта**: +0.3 (заглаживание вины)\n- **Спонтанно**: +0.1
              (неожиданные жесты)\n\n**Штрафы:**\n- **Не вовремя**: -0.3 (неподходящий
              момент)\n- **Повторяющиеся подарки**: -0.2 (потеря оригинальности)\n-
              **Игнорирование предпочтений**: -0.4 (плохой выбор)\n"}, {"id": "gift_suggestions_engine",
              "title": "Движок предложений подарков", "body": "**Алгоритм генерации
              предложений:**\n\n1. **Фильтрация доступных предметов**\n   - По инвентарю
              игрока\n   - По бюджету (максимум 20% от текущих ED)\n   - По доступности
              (магазины, черный рынок, квестовые награды)\n\n2. **Оценка и ранжирование**\n   -
              Расчет GiftScore для каждого предмета\n   - Сортировка по убыванию оценки\n   -
              Выбор топ-5 кандидатов\n\n3. **Диверсификация**\n   - Обеспечение разнообразия
              типов подарков\n   - Избегание повторений в недавней истории\n   - Добавление
              \"диких карт\" (неожиданные, но подходящие варианты)\n\n4. **Персонализация**\n   -
              Адаптация под текущие события в отношениях\n   - Учет недавних разговоров
              и предпочтений\n   - Тематическая привязка к текущему лору\n"}, {"id":
              "gesture_system", "title": "Система романтических жестов", "body": "**Типы
              жестов:**\n\n1. **Словесные (бесплатные)**\n   - Комплименты, признания,
              обещания\n   - Адаптируются под личность NPC\n\n2. **Физические**\n   -
              Касания, объятия, поцелуи\n   - Зависят от стадии отношений и предпочтений\n\n3.
              **Символические**\n   - Совместные активности, планы на будущее\n   -
              Создание воспоминаний\n\n**Gesture Scoring:**\n```\nGestureValue = BaseAppeal
              × RelationshipFit × TimingBonus × PersonalityMatch\n```\n\n**Примеры
              жестов:**\n- **Claire**: \"Я приготовил твой любимый коктейль\" (+0.8
              за персонализацию)\n- **Panam**: \"Давай прокатимся на байке под звездами\"
              (+0.9 за совместную активность)\n- **Judy**: \"Я нашел редкий braindance
              для нас двоих\" (+0.7 за общие интересы)\n"}, {"id": "feedback_adaptation",
              "title": "Адаптация на основе обратной связи", "body": "**Механизм обучения:**\n\n1.
              **Отслеживание реакций**\n   - Положительная: +10% к предпочтению категории\n   -
              Нейтральная: без изменений\n   - Отрицательная: -15% к конкретному предмету/типу\n\n2.
              **Долгосрочная адаптация**\n   - Обновление профиля предпочтений каждые
              5 взаимодействий\n   - Сезонные корректировки (праздники, юбилеи)\n   -
              Эволюция вкусов со временем\n\n3. **Избегание повторений**\n   - Отслеживание
              последних 10 подарков\n   - Штраф за повторения (-20% к оценке)\n   -
              Поощрение разнообразия (+5% за новые категории)\n"}, {"id": "api_integration",
              "title": "API интеграция", "body": "**Основные эндпоинты:**\n\n```\nPOST
              /romance/gifts/suggest\n- Получить предложения подарков для NPC\n\nPOST
              /romance/gestures/suggest\n- Получить предложения жестов\n\nPOST /romance/gifts/give\n-
              Совершить дарение подарка\n\nGET /romance/preferences/{npc_id}\n- Получить
              профиль предпочтений NPC\n```\n\n**Data Models:**\n```yaml\nGiftSuggestion:\n  item_id:
              string\n  score: number\n  reasoning: string[]\n  estimated_reaction:
              \"positive\" | \"neutral\" | \"negative\"\n\nGestureSuggestion:\n  type:
              \"verbal\" | \"physical\" | \"symbolic\"\n  content: string\n  score:
              number\n  context_appropriate: boolean\n```\n"}]}, "appendix": {"glossary":
              [{"term": "GiftScore", "definition": "Композитная оценка подходящести
              подарка, учитывающая все факторы"}, {"term": "PersonalMultiplier", "definition":
              "Коэффициент, отражающий личные предпочтения NPC"}, {"term": "RelationshipMultiplier",
              "definition": "Множитель, зависящий от текущей стадии отношений"}, {"term":
              "ContextMultiplier", "definition": "Бонус/штраф за временные и ситуационные
              факторы"}], "references": [{"title": "Romance Engine Scoring", "link":
              "romance-engine-scoring.yaml"}, {"title": "Romance Relationship States",
              "link": "romance-relationship.yaml"}, {"title": "Romance Triggers",
              "link": "romance-triggers.yaml"}], "decisions": []}, "implementation":
              {"github_issue": "???", "needs_task": false, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"],
              "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-12-20",
              "author": "concept_director", "changes": "Создан алгоритм выбора подарков
              и романтических жестов для системы романтики."}], "validation": {"checksum":
              "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "implementation-romance-gift-selection", "title": "Romance
              Gift & Gesture Engine — Выбор подарков и жестов", "document_type": "implementation",
              "category": "algorithms", "status": "approved", "version": "1.0.0",
              "last_updated": "2025-12-20T00:00:00+00:00", "concept_approved": true,
              "concept_reviewed_at": "2025-12-20T00:00:00+00:00", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["romance",
              "gifts", "gestures", "personalization"], "topics": ["romance-system",
              "player-choice", "npc-preferences"], "related_systems": ["romance-service",
              "inventory-service", "economy-service"], "related_documents": [{"id":
              "implementation-romance-engine-scoring", "relation": "references"},
              {"id": "implementation-romance-relationship", "relation": "complements"}],
              "source": "shared/docs/knowledge/implementation/algorithms/romance/romance-gift-selection.md",
              "visibility": "internal", "audience": ["concept", "backend", "game-design"],
              "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\implementation\algorithms\romance\romance-gift-selection.yaml
