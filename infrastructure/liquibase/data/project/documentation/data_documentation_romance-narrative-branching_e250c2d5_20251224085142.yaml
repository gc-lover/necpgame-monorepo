databaseChangeLog:
- changeSet:
    id: documentation-romance-narrative-branching-e250c2d5
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '5779213751726158'
        - column:
            name: doc_id
            value: romance-narrative-branching
        - column:
            name: title
            value: Нарративное ветвление в романтических историях NECPGAME
        - column:
            name: document_type
            value: mechanics
        - column:
            name: category
            value: romance
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-20 07:00:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - romance
            - narrative
            - branching
            - social
        - column:
            name: topics
            value:
            - story-branching
            - relationship-dynamics
        - column:
            name: related_systems
            value:
            - romance-service
            - narrative-service
            - quest-service
        - column:
            name: related_documents
            value: '[{"id": "romance-relationship-progression", "relation": "complements"},
              {"id": "quest-system-branching-stories", "relation": "references"}]'
        - column:
            name: source
            value: shared/docs/knowledge/mechanics/romance/romance-narrative-branching.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - narrative
            - systems
        - column:
            name: risk_level
            value: high
        - column:
            name: content
            value: '{"metadata": {"id": "romance-narrative-branching", "title": "Нарративное
              ветвление в романтических историях NECPGAME", "document_type": "mechanics",
              "category": "romance", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-12-20T07:00:00+00:00", "concept_approved": false, "concept_reviewed_at":
              "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}],
              "tags": ["romance", "narrative", "branching", "social"], "topics": ["story-branching",
              "relationship-dynamics"], "related_systems": ["romance-service", "narrative-service",
              "quest-service"], "related_documents": [{"id": "romance-relationship-progression",
              "relation": "complements"}, {"id": "quest-system-branching-stories",
              "relation": "references"}], "source": "shared/docs/knowledge/mechanics/romance/romance-narrative-branching.md",
              "visibility": "internal", "audience": ["concept", "narrative", "systems"],
              "risk_level": "high"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions":
              []}, "summary": {"problem": "Романтические истории развивались линейно
              без учета выборов игрока и динамики отношений.", "goal": "Создать систему
              ветвящихся романтических нарративов с множественными концовками и последствиями
              выборов.", "essence": "Каждая романтическая линия имеет 3-5 основных
              ветвей с уникальными событиями, диалогами и исходами.", "key_points":
              ["4 типа ветвления с разными механиками", "Система флагов и состояний
              отношений", "Динамическое влияние на основной сюжет", "Множественные
              концовки для каждой романтической линии"]}, "content": {"sections":
              [{"id": "branching_types", "title": "Типы нарративного ветвления", "body":
              "Романтические истории используют четыре типа ветвления:\n\n**Ветвление
              по выбору (Choice Branching):**\n- Прямые диалоговые выборы определяют
              направление\n- Немедленные последствия для RP\n- Влияние на будущие
              взаимодействия\n\n**Ветвление по поведению (Behavioral Branching):**\n-
              Долгосрочные паттерны поведения формируют ветвь\n- Автоматическое определение
              на основе действий\n- Требует времени для проявления\n\n**Ветвление
              по событиям (Event Branching):**\n- Внешние события изменяют направление
              истории\n- Случайные и сюжетные триггеры\n- Влияние мира на романтические
              отношения\n\n**Ветвление по конфликтам (Conflict Branching):**\n- Разрешение
              конфликтов определяет исход\n- Множественные пути восстановления\n-
              Альтернативные концовки отношений\n", "mechanics_links": ["mechanics/quests/quest-system.yaml"],
              "assets": []}, {"id": "romance_flags_system", "title": "Система флагов
              романтических отношений", "body": "Флаги отслеживают состояние и историю
              отношений:\n\n**Основные флаги состояния:**\n- `romance_stage`: текущая
              стадия отношений (1-7)\n- `romance_type`: тип романтической связи (romantic/partner/forbidden/etc.)\n-
              `trust_level`: уровень доверия (0-100)\n- `intimacy_level`: уровень
              близости (0-100)\n\n**Исторические флаги:**\n- `first_meeting_date`:
              дата первого знакомства\n- `major_events`: массив значимых событий\n-
              `conflict_history`: история конфликтов и их разрешения\n- `shared_secrets`:
              уровень раскрытия личной информации\n\n**Динамические флаги:**\n- `current_mood`:
              текущее эмоциональное состояние\n- `recent_interactions`: последние
              10 взаимодействий\n- `pending_events`: предстоящие события отношений\n-
              `relationship_health`: общий статус здоровья отношений (0-100)\n", "mechanics_links":
              ["mechanics/social/npc-relationships-system.yaml"], "assets": []}, {"id":
              "choice_driven_branching", "title": "Ветвление через выборы игрока",
              "body": "Диалоговые выборы формируют уникальные нарративные пути:\n\n**Критические
              выборы (Major Choices):**\n- Определяют основное направление истории\n-
              Блокирующий эффект на другие ветви\n- Значительное влияние на RP (±50-200)\n\n**Второстепенные
              выборы (Minor Choices):**\n- Влияют на детали и атмосферу\n- Накапливающийся
              эффект на отношения\n- Малое влияние на RP (±5-25)\n\n**Последовательные
              выборы (Chain Choices):**\n- Серия связанных выборов\n- Каждый выбор
              влияет на следующие опции\n- Кумулятивный эффект на исход\n\n**Моральные
              дилеммы:**\n- Выбор между любовью и принципами\n- Конфликт лояльностей
              (партнер vs друзья/семья)\n- Этические компромиссы ради отношений\n",
              "mechanics_links": ["mechanics/romance/romance-conflict-resolution.yaml"],
              "assets": []}, {"id": "behavioral_branching_mechanics", "title": "Механики
              поведенческого ветвления", "body": "Поведение игрока автоматически формирует
              нарративные пути:\n\n**Паттерны поведения:**\n- **Романтический:** Частые
              комплименты, подарки, внимание\n- **Практичный:** Фокус на взаимной
              выгоде, совместные цели\n- **Рискованный:** Совместные авантюры, игнорирование
              опасностей\n- **Надежный:** Стабильность, поддержка, предсказуемость\n\n**Определение
              доминирующего паттерна:**\n```\npattern_score = sum(action_weights)
              / action_count\ndominant_pattern = max(pattern_scores)\n```\n\n**Переключение
              паттернов:**\n- Требует последовательных действий\n- Минимальный период
              для смены (7 дней)\n- RP бонус/штраф за резкие изменения\n\n**Влияние
              на нарратив:**\n- Разные события для каждого паттерна\n- Уникальные
              диалоги и взаимодействия\n- Альтернативные концовки\n", "mechanics_links":
              ["mechanics/social/reputation-formulas.yaml"], "assets": []}, {"id":
              "event_driven_branching", "title": "Ветвление через события мира", "body":
              "Внешние события Night City влияют на романтические истории:\n\n**Корпоративные
              события:**\n- Слияния компаний влияют на карьеру партнера\n- Корпоративные
              интриги создают конфликты\n- Экономические кризисы меняют приоритеты\n\n**Уличные
              события:**\n- Бандитские войны требуют защиты\n- Полицейские рейды создают
              напряжение\n- Уличные фестивали создают романтическую атмосферу\n\n**Глобальные
              события:**\n- Изменения в законодательстве о модификациях\n- Эпидемии
              и пандемии влияют на взаимодействия\n- Технологические прорывы меняют
              динамику отношений\n\n**Случайные события:**\n- Неожиданные встречи
              в городе\n- Совместные проблемы требующие решения\n- Внешние угрозы
              требующие защиты\n", "mechanics_links": ["mechanics/world/dynamic-events-system.yaml"],
              "assets": []}, {"id": "romance_endings_system", "title": "Система концовок
              романтических историй", "body": "Каждая романтическая линия имеет множественные
              исходы:\n\n**Положительные концовки:**\n- **Счастливая любовь:** Совместная
              жизнь, поддержка, рост\n- **Страстная связь:** Интенсивные отношения,
              приключения\n- **Надежное партнерство:** Стабильность, взаимная выгода\n-
              **Эпическая история:** Легендарная любовь, влияющая на город\n\n**Нейтральные
              концовки:**\n- **Дружба:** Переход в крепкую дружбу\n- **Профессиональные
              отношения:** Совместная работа\n- **Воспоминания:** Завершенная глава
              жизни\n\n**Негативные концовки:**\n- **Болезненный разрыв:** Эмоциональные
              травмы, горе\n- **Вражда:** Превращение в противников\n- **Трагедия:**
              Потеря из-за внешних обстоятельств\n- **Пустота:** Постепенное угасание
              без конфликта\n\n**Факторы, влияющие на концовку:**\n- Общий RP на момент
              завершения\n- Количество разрешенных конфликтов\n- Выполненные совместные
              цели\n- Внешние события и вмешательства\n", "mechanics_links": ["mechanics/romance/romance-outcome-determination.yaml"],
              "assets": []}, {"id": "romance_interactions_main_plot", "title": "Взаимодействие
              с основным сюжетом", "body": "Романтические линии влияют на основной
              нарратив игры:\n\n**Влияние на основной сюжет:**\n- Альянсы и коалиции
              через романтические связи\n- Доступ к эксклюзивным квестам и локациям\n-
              Изменение репутации в разных фракциях\n- Альтернативные сюжетные ветви\n\n**Романтические
              NPC в сюжете:**\n- Возможность вовлечь партнера в сюжетные события\n-
              Конфликты лояльности между любовью и миссиями\n- Совместные сюжетные
              арки\n- Влияние на решения и концовки игры\n\n**Динамическое влияние:**\n-
              Решения в отношениях влияют на доступные сюжетные пути\n- Романтические
              события могут блокировать или открывать сюжетные ветви\n- RP влияет
              на исход ключевых сюжетных моментов\n- Возможность романтических суб-сюжетов\n",
              "mechanics_links": ["mechanics/quests/quest-system.yaml"], "assets":
              []}, {"id": "romance_replayability", "title": "Переигрываемость романтических
              историй", "body": "Система обеспечивает высокую переигрываемость:\n\n**Множественные
              пути:**\n- 3-5 основных ветвей на романтическую линию\n- 8-12 различных
              концовок\n- 20+ значимых выборов на линию\n\n**Динамические элементы:**\n-
              Случайные события влияют на исход\n- Внешние факторы меняют доступные
              опции\n- Поведение NPC реагирует на действия игрока\n\n**Сохранение
              прогресса:**\n- Возможность возобновления отношений в новых прохождениях\n-
              Перенос романтических достижений между сохранениями\n- Альтернативные
              timeline для тех же персонажей\n\n**Рандомизация элементов:**\n- Варьирующиеся
              детали в повторных прохождениях\n- Случайные побочные события\n- Динамические
              NPC реакции на выборы\n", "mechanics_links": ["mechanics/world/procedural-generation-algorithms.yaml"],
              "assets": []}, {"id": "implementation_considerations", "title": "Особенности
              реализации", "body": "Технические аспекты системы ветвления:\n\n**Хранение
              состояния:**\n- Redis для быстрого доступа к флагам отношений\n- PostgreSQL
              для исторических данных\n- Кэширование часто используемых состояний\n\n**Производительность:**\n-
              Предварительный расчет возможных ветвей\n- Ленивая загрузка неактивных
              романтических линий\n- Оптимизация запросов к состоянию отношений\n\n**Масштабируемость:**\n-
              Поддержка множественных активных романтических линий\n- Независимое
              состояние для каждого NPC\n- Возможность паузы/возобновления отношений\n\n**Тестирование:**\n-
              Автоматизированные тесты всех ветвей\n- Ручное тестирование нарративной
              связности\n- Баланс-тестирование влияния выборов на RP\n", "mechanics_links":
              ["mechanics/social/social-service-architecture.yaml"], "assets": []}]},
              "appendix": {"glossary": [{"term": "RP (Relationship Points)", "definition":
              "Очки отношений, определяющие прогрессию и исход"}, {"term": "Behavioral
              Branching", "definition": "Ветвление на основе паттернов поведения игрока"},
              {"term": "Event Branching", "definition": "Ветвление под влиянием внешних
              событий мира"}], "references": ["Narrative Branching in Open World RPGs",
              "Cyberpunk 2077 Romance System Design"], "decisions": [{"date": "2025-12-20",
              "decision": "4 типа ветвления для максимальной гибкости нарратива",
              "rationale": "Позволяет создать глубокие и вариативные романтические
              истории"}], "implementation": {"needs_task": true, "github_issue": 82,
              "queue_reference": ["shared/trackers/queues/concept/queued.yaml"], "blockers":
              []}}, "history": [{"version": "1.0.0", "date": "2025-12-20", "author":
              "Idea Writer Agent", "changes": "Создана система нарративного ветвления
              для романтических историй с 4 типами ветвления и множественными концовками"}],
              "validation": {"checksum": "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "romance-narrative-branching", "title": "Нарративное ветвление
              в романтических историях NECPGAME", "document_type": "mechanics", "category":
              "romance", "status": "draft", "version": "1.0.0", "last_updated": "2025-12-20T07:00:00+00:00",
              "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role":
              "concept_director", "contact": "concept@necp.game"}], "tags": ["romance",
              "narrative", "branching", "social"], "topics": ["story-branching", "relationship-dynamics"],
              "related_systems": ["romance-service", "narrative-service", "quest-service"],
              "related_documents": [{"id": "romance-relationship-progression", "relation":
              "complements"}, {"id": "quest-system-branching-stories", "relation":
              "references"}], "source": "shared/docs/knowledge/mechanics/romance/romance-narrative-branching.md",
              "visibility": "internal", "audience": ["concept", "narrative", "systems"],
              "risk_level": "high"}'
        - column:
            name: source_file
            value: knowledge\mechanics\romance\romance-narrative-branching.yaml
