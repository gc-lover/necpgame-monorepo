databaseChangeLog:
- changeSet:
    id: documentation-romance-outcome-determination-2fe7a815
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-403301911389191'
        - column:
            name: doc_id
            value: romance-outcome-determination
        - column:
            name: title
            value: Определение исходов романтических отношений NECPGAME
        - column:
            name: document_type
            value: mechanics
        - column:
            name: category
            value: romance
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-20 07:05:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: ''
        - column:
            name: owners
            value: '[{"role": "concept_director", "contact": "concept@necp.game"}]'
        - column:
            name: tags
            value:
            - romance
            - outcomes
            - determination
            - social
        - column:
            name: topics
            value:
            - relationship-mechanics
            - outcome-calculation
        - column:
            name: related_systems
            value:
            - romance-service
            - analytics-service
            - character-service
        - column:
            name: related_documents
            value: '[{"id": "romance-relationship-progression", "relation": "references"},
              {"id": "romance-narrative-branching", "relation": "complements"}]'
        - column:
            name: source
            value: shared/docs/knowledge/mechanics/romance/romance-outcome-determination.md
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - concept
            - narrative
            - systems
        - column:
            name: risk_level
            value: medium
        - column:
            name: content
            value: '{"metadata": {"id": "romance-outcome-determination", "title":
              "Определение исходов романтических отношений NECPGAME", "document_type":
              "mechanics", "category": "romance", "status": "draft", "version": "1.0.0",
              "last_updated": "2025-12-20T07:05:00+00:00", "concept_approved": false,
              "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact":
              "concept@necp.game"}], "tags": ["romance", "outcomes", "determination",
              "social"], "topics": ["relationship-mechanics", "outcome-calculation"],
              "related_systems": ["romance-service", "analytics-service", "character-service"],
              "related_documents": [{"id": "romance-relationship-progression", "relation":
              "references"}, {"id": "romance-narrative-branching", "relation": "complements"}],
              "source": "shared/docs/knowledge/mechanics/romance/romance-outcome-determination.md",
              "visibility": "internal", "audience": ["concept", "narrative", "systems"],
              "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director",
              "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions":
              []}, "summary": {"problem": "Исходы романтических отношений определялись
              субъективно без формализованных критериев и вероятностей.", "goal":
              "Создать алгоритмическую систему определения исходов отношений на основе
              RP, событий и контекста.", "essence": "Исход отношений рассчитывается
              через взвешенные факторы с учетом вероятностей и случайных элементов.",
              "key_points": ["Многофакторный алгоритм определения исхода", "Система
              вероятностей с модификаторами", "Учет долгосрочных и краткосрочных факторов",
              "Баланс между предсказуемостью и неожиданностью"]}, "content": {"sections":
              [{"id": "outcome_calculation_overview", "title": "Обзор расчета исходов",
              "body": "Определение исхода отношений использует комплексный алгоритм:\n\n**Основные
              компоненты:**\n- RP (Relationship Points) - базовый показатель\n- История
              взаимодействий - паттерны поведения\n- Внешние факторы - события и контекст\n-
              Случайные элементы - для непредсказуемости\n\n**Процесс расчета:**\n1.
              Сбор всех релевантных данных\n2. Применение весовых коэффициентов\n3.
              Расчет базовой вероятности\n4. Применение модификаторов\n5. Определение
              финального исхода\n\n**Частота расчета:**\n- При достижении критических
              порогов RP\n- После значимых событий\n- По запросу игрока (проверка
              совместимости)\n- В ключевые сюжетные моменты\n", "mechanics_links":
              ["mechanics/social/reputation-formulas.yaml"], "assets": []}, {"id":
              "base_probability_formula", "title": "Базовая формула вероятности",
              "body": "Базовая вероятность исхода рассчитывается по шкале 0-100:\n\n**Для
              положительных исходов:**\n```\npositiveOutcomeProb = min(100, max(0,
              (currentRP + 2000) / 40))\n```\n\n**Для нейтральных исходов:**\n```\nneutralOutcomeProb
              = min(100, max(0, 50 + (currentRP / 20)))\n```\n\n**Для отрицательных
              исходов:**\n```\nnegativeOutcomeProb = min(100, max(0, (-currentRP +
              1000) / 15))\n```\n\n**Нормализация вероятностей:**\n```\ntotalProb
              = positiveProb + neutralProb + negativeProb\nnormalizedProb = eachProb
              / totalProb * 100\n```\n\n**Факторы, влияющие на базовую вероятность:**\n-
              Текущий уровень RP\n- Стадия отношений\n- Время существования отношений\n-
              Количество разрешенных конфликтов\n", "mechanics_links": ["mechanics/romance/romance-relationship-progression.yaml"],
              "assets": []}, {"id": "historical_factors", "title": "Исторические факторы",
              "body": "Прошлое отношений значительно влияет на возможные исходы:\n\n**Положительные
              исторические факторы:**\n- Количество совместно пережитых кризисов (+10-30%)\n-
              Регулярные положительные взаимодействия (+5-20%)\n- Выполненные обещания
              и обязательства (+15-40%)\n- Совместные достижения и успехи (+10-25%)\n\n**Отрицательные
              исторические факторы:**\n- История предательств (-20-60%)\n- Не разрешенные
              конфликты (-10-35%)\n- Нарушенные обещания (-15-45%)\n- Длительные периоды
              без взаимодействия (-5-25%)\n\n**Нейтральные исторические факторы:**\n-
              Общее время знакомства (±5-15%)\n- Количество проведенного времени вместе
              (±5-20%)\n- Стабильность паттернов взаимодействия (±10-30%)\n\n**Расчет
              исторического модификатора:**\n```\nhistoricalModifier = sum(weighted_factors)
              / total_interactions\n```\n", "mechanics_links": ["mechanics/social/reputation-decay-recovery.yaml"],
              "assets": []}, {"id": "contextual_modifiers", "title": "Контекстуальные
              модификаторы", "body": "Текущие обстоятельства влияют на вероятность
              исходов:\n\n**Временные модификаторы:**\n- Недавние положительные события
              (+20-50%)\n- Недавние конфликты (-30-70%)\n- Текущая эмоциональная атмосфера
              (±10-40%)\n- Время суток и локация (±5-15%)\n\n**Ситуационные модификаторы:**\n-
              Наличие внешних угроз (+15-35% к сплочению)\n- Экономическая стабильность
              (±10-25%)\n- Здоровье и безопасность (±5-20%)\n- Социальный статус (±10-30%)\n\n**Персональные
              модификаторы:**\n- Уровень стресса персонажей (-10-40%)\n- Доступность
              ресурсов (±5-15%)\n- Личные цели и приоритеты (±10-25%)\n- Внешнее давление
              (±15-35%)\n\n**Расчет контекстуального модификатора:**\n```\ncontextModifier
              = average(contextual_factors) * time_decay_factor\n```\n", "mechanics_links":
              ["mechanics/world/dynamic-events-system.yaml"], "assets": []}, {"id":
              "personality_compatibility", "title": "Совместимость личностей", "body":
              "Личностные черты определяют долгосрочную совместимость:\n\n**Совместимые
              комбинации:**\n- Экстраверт + Экстраверт: +15% к положительным исходам\n-
              Доброжелательный + Доброжелательный: +20% к гармонии\n- Стабильный +
              Стабильный: +25% к долговечности\n- Открытый + Любопытный: +10% к развитию\n\n**Проблемные
              комбинации:**\n- Импульсивный + Консервативный: -15% к стабильности\n-
              Агрессивный + Пассивный: -20% к гармонии\n- Нейротик + Стабильный: -10%
              к эмоциональной связи\n- Конфликтный + Конфликтный: -25% к мирному разрешению\n\n**Киберпанк-специфические
              факторы:**\n- Совместимые импланты: +10-30%\n- Противоположные модификации:
              -15-40%\n- Общие технологические предпочтения: +5-20%\n- Разные уровни
              хрома: ±5-25%\n", "mechanics_links": ["mechanics/romance/romance-attraction-algorithms.yaml"],
              "assets": []}, {"id": "external_influences", "title": "Внешние влияния",
              "body": "Факторы мира Night City влияют на романтические исходы:\n\n**Корпоративные
              влияния:**\n- Корпоративные интриги (-20-50% к стабильности)\n- Карьерные
              конфликты (-10-30% к гармонии)\n- Экономические кризисы (-15-40% к долговечности)\n-
              Корпоративные традиции (±10-25%)\n\n**Уличные влияния:**\n- Бандитские
              войны (+10-30% к страсти, -20-40% к безопасности)\n- Уличные традиции
              (+5-20% к уникальности)\n- Социальные нормы (±5-15% к принятию)\n- Экономическая
              нестабильность (-10-35% к планированию)\n\n**Технологические влияния:**\n-
              Новые импланты (±15-40% к изменениям)\n- Кибернетические сбои (-20-60%
              к стабильности)\n- Виртуальная реальность (±10-30% к близости)\n- Хакерские
              атаки (-30-70% к доверию)\n\n**Расчет внешнего влияния:**\n```\nexternalInfluence
              = sum(active_external_factors) * intensity_modifier\n```\n", "mechanics_links":
              ["mechanics/world/locations-night-city.yaml"], "assets": []}, {"id":
              "random_elements", "title": "Случайные элементы", "body": "Непредсказуемость
              добавляет глубину и переигрываемость:\n\n**Типы случайных элементов:**\n-
              **Критические события:** Редкие, но значимые повороты (±50-200% влияния)\n-
              **Случайные встречи:** Неожиданные взаимодействия (±10-30% влияния)\n-
              **Внешние вмешательства:** Третьи стороны (±15-45% влияния)\n- **Личные
              откровения:** Случайные раскрытия (±20-60% влияния)\n\n**Распределение
              вероятностей:**\n- 70% - малые случайные события (±5-15%)\n- 25% - средние
              события (±15-35%)\n- 5% - критические события (±35-100%)\n\n**Баланс
              предсказуемости:**\n- Базовые исходы определяются детерминированно\n-
              Случайные элементы добавляют вариативность\n- Игрок может влиять на
              вероятность через выборы\n- Система логирует все случайные события\n\n**Механика
              случайности:**\n```\nrandomFactor = random(0, 100) * player_luck_modifier\nif
              randomFactor > threshold then apply_random_event()\n```\n", "mechanics_links":
              ["mechanics/meta/procedural-generation-algorithms.yaml"], "assets":
              []}, {"id": "outcome_types_and_consequences", "title": "Типы исходов
              и их последствия", "body": "Возможные исходы отношений с детальными
              последствиями:\n\n**Положительные исходы (30-70% вероятность):**\n-
              **Гармоничный союз:** +1000 RP, совместные бонусы, сюжетные преимущества\n-
              **Страстная любовь:** +800 RP, повышенная эмоциональность, уникальные
              события\n- **Надежное партнерство:** +600 RP, практические бонусы, стабильность\n-
              **Легендарная история:** +1200 RP, влияние на город, эпические последствия\n\n**Нейтральные
              исходы (20-40% вероятность):**\n- **Стабильная дружба:** 0 RP, социальные
              бонусы, без романтики\n- **Профессиональное сотрудничество:** -200 RP,
              рабочие преимущества\n- **Воспоминания:** -500 RP, эмоциональное завершение,
              новые возможности\n\n**Отрицательные исходы (10-30% вероятность):**\n-
              **Болезненный разрыв:** -1000 RP, эмоциональные дебаффы, социальные
              последствия\n- **Вражда:** -1500 RP, конфликтные взаимодействия, фракционные
              изменения\n- **Трагедия:** -2000 RP, долгосрочные последствия, сюжетные
              изменения\n\n**Долгосрочные последствия:**\n- Изменение репутации в
              социальных кругах\n- Доступ к новым/потеря старых контактов\n- Влияние
              на основной сюжет и побочные квесты\n- Психологические эффекты на персонажа
              игрока\n", "mechanics_links": ["mechanics/romance/romance-narrative-branching.yaml"],
              "assets": []}, {"id": "outcome_timing_and_triggers", "title": "Тайминг
              и триггеры определения исходов", "body": "Когда и как определяются исходы
              отношений:\n\n**Автоматические триггеры:**\n- RP достигает критических
              значений (±2000, ±4000)\n- Проходит значительное время без взаимодействия
              (30+ дней)\n- Происходят ключевые жизненные события\n- Изменяются фундаментальные
              обстоятельства\n\n**Ручные проверки:**\n- Игрок может запросить \"проверку
              совместимости\"\n- Регулярные автоматические оценки (еженедельно)\n-
              Перед важными решениями влияющими на отношения\n\n**Временные рамки:**\n-
              Краткосрочные исходы: немедленное определение\n- Среднесрочные: в течение
              24 часов игрового времени\n- Долгосрочные: в течение 3-7 дней игрового
              времени\n\n**Отмена и пересмотр:**\n- Возможность оспорить отрицательные
              исходы\n- Система апелляций через специальные квесты\n- Возможность
              изменения через значимые действия\n- Временные \"испытательные сроки\"
              для сомнительных исходов\n", "mechanics_links": ["mechanics/social/player-orders-system.yaml"],
              "assets": []}, {"id": "implementation_and_balance", "title": "Реализация
              и баланс", "body": "Технические аспекты системы определения исходов:\n\n**Архитектура
              реализации:**\n- Romance Service отвечает за расчеты\n- Analytics Service
              предоставляет исторические данные\n- Character Service управляет личностными
              факторами\n- Notification Service обрабатывает оповещения\n\n**Баланс
              и тестирование:**\n- A/B тестирование вероятностей на разных группах
              игроков\n- Анализ retention после различных исходов\n- Мониторинг эмоционального
              отклика игроков\n- Регулярная корректировка весовых коэффициентов\n\n**Производительность:**\n-
              Кэширование расчетов на 1-24 часа\n- Асинхронная обработка сложных определений\n-
              Оптимизация запросов к историческим данным\n- Масштабируемость для тысяч
              активных отношений\n\n**Мониторинг и аналитика:**\n- Отслеживание распределения
              исходов\n- Анализ влияния на вовлеченность игроков\n- Метрики удовлетворенности
              отношениями\n- Корреляция с общими метриками игры\n", "mechanics_links":
              ["mechanics/social/social-service-architecture.yaml"], "assets": []}]},
              "appendix": {"glossary": [{"term": "RP (Relationship Points)", "definition":
              "Очки отношений, основной фактор определения исхода"}, {"term": "Contextual
              Modifiers", "definition": "Модификаторы на основе текущих обстоятельств
              и ситуации"}, {"term": "Historical Factors", "definition": "Факторы
              на основе истории отношений и взаимодействий"}], "references": ["Relationship
              Outcome Prediction Models", "Game Design Patterns for Romance Systems"],
              "decisions": [{"date": "2025-12-20", "decision": "Многофакторная модель
              с 30-40% случайным элементом", "rationale": "Баланс между предсказуемостью
              и неожиданностью для лучшего игрового опыта"}], "implementation": {"needs_task":
              true, "github_issue": 82, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"],
              "blockers": []}}, "history": [{"version": "1.0.0", "date": "2025-12-20",
              "author": "Idea Writer Agent", "changes": "Создана система определения
              исходов романтических отношений с многофакторным алгоритмом и балансом
              случайности"}], "validation": {"checksum": "", "schema_version": "1.0"}}'
        - column:
            name: metadata
            value: '{"id": "romance-outcome-determination", "title": "Определение
              исходов романтических отношений NECPGAME", "document_type": "mechanics",
              "category": "romance", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-12-20T07:05:00+00:00", "concept_approved": false, "concept_reviewed_at":
              "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}],
              "tags": ["romance", "outcomes", "determination", "social"], "topics":
              ["relationship-mechanics", "outcome-calculation"], "related_systems":
              ["romance-service", "analytics-service", "character-service"], "related_documents":
              [{"id": "romance-relationship-progression", "relation": "references"},
              {"id": "romance-narrative-branching", "relation": "complements"}], "source":
              "shared/docs/knowledge/mechanics/romance/romance-outcome-determination.md",
              "visibility": "internal", "audience": ["concept", "narrative", "systems"],
              "risk_level": "medium"}'
        - column:
            name: source_file
            value: knowledge\mechanics\romance\romance-outcome-determination.yaml
