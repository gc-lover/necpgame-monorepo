databaseChangeLog:
- changeSet:
    id: documentation-stock-exchange-technical-a29457c5
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '1132611187062188'
        - column:
            name: doc_id
            value: stock-exchange-technical
        - column:
            name: title
            value: Архитектура системы фондовой биржи - Технические задачи и диаграммы
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-11-23 14:30:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - economy
            - stock-exchange
            - technical
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value: []
        - column:
            name: related_documents
            value: '[{"id": "stock-exchange-core", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - economy
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "stock-exchange-technical", "title": "Архитектура
              системы фондовой биржи - Технические задачи и диаграммы", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-11-23T14:30:00+00:00", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "economy", "stock-exchange", "technical"], "related_documents": [{"id":
              "stock-exchange-core", "relation": "extends"}], "github_issue": 393,
              "visibility": "internal", "audience": ["architect", "backend", "economy"]},
              "architecture": {"technical_tasks": {"phases": {"phase_1": {"name":
              "Базовая инфраструктура", "tasks": ["Создание таблиц БД", "Настройка
              миграций Liquibase", "Базовая структура economy-service для stocks",
              "Интеграция с Event Bus", "Настройка Redis для кэширования"], "estimated_effort":
              "5 days"}, "phase_2": {"name": "Торговый движок", "tasks": ["Реализация
              Order Book Manager", "Реализация Stock Trading Engine", "Реализация
              Trade Executor", "Реализация Portfolio Manager", "Тестирование matching
              логики"], "estimated_effort": "8 days"}, "phase_3": {"name": "Pricing
              Engine", "tasks": ["Реализация Stock Pricing Engine", "Расчет цен на
              основе спроса/предложения", "История цен", "Realtime обновления через
              WebSocket"], "estimated_effort": "5 days"}, "phase_4": {"name": "Dividend
              Service", "tasks": ["Реализация Dividend Calculator", "Реализация Dividend
              Scheduler", "Реализация DRIP Manager", "Интеграция с Event Scheduler
              Service", "Автоматические выплаты"], "estimated_effort": "6 days"},
              "phase_5": {"name": "Events Handler", "tasks": ["Реализация Stock Events
              Handler", "Подписка на world events", "Подписка на quest events", "Расчет
              price impact", "Применение модификаторов"], "estimated_effort": "5 days"},
              "phase_6": {"name": "Analytics Service", "tasks": ["Реализация Index
              Calculator", "Реализация Metrics Calculator", "Реализация Technical
              Analyzer", "Расчет индексов", "Перебалансировка"], "estimated_effort":
              "6 days"}, "phase_7": {"name": "Compliance Service", "tasks": ["Реализация
              Trade Monitor", "Реализация Insider Trading Detector", "Реализация Circuit
              Breaker Manager", "Лимиты на позиции", "Алерты и блокировки"], "estimated_effort":
              "5 days"}, "phase_8": {"name": "Интеграции", "tasks": ["Интеграция с
              World Service", "Интеграция с Quest Service", "Интеграция с Social Service",
              "Интеграция с Analytics Service", "WebSocket каналы"], "estimated_effort":
              "4 days"}}, "total_estimated_effort": "44 days"}, "tickrate_and_network_requirements":
              {"stock_trading": {"tickrate": "Event-based (on-demand)", "network_load":
              "- Создание ордера: event-based, ~0.1-0.5 events/sec\n- Исполнение ордера:
              event-based, ~0.1-0.3 events/sec\n- Обновление цен: event-based, ~1-5
              events/sec (пиковая)\n- Общий трафик: ~0.5-2 KB/sec на игрока\n", "sync_strategy":
              "Strong Consistency (ACID транзакции)"}, "stock_prices": {"tickrate":
              "1-10 Hz (обновление цен)", "network_load": "- Обновление цен: 1-10
              updates/sec\n- WebSocket обновления: 1-10 updates/sec\n- Общий трафик:
              ~0.3-1 KB/sec на игрока\n", "sync_strategy": "Eventual Consistency для
              цен, Strong для сделок"}, "dividend_payments": {"tickrate": "Event-based
              (по расписанию)", "network_load": "- Выплата дивидендов: event-based,
              ~0.01-0.1 events/sec\n- Обновление портфеля: event-based, ~0.05-0.2
              events/sec\n- Общий трафик: ~0.1-0.3 KB/sec на игрока\n", "sync_strategy":
              "Strong Consistency"}, "stock_analytics": {"tickrate": "1-5 Hz (расчет
              индексов)", "network_load": "- Расчет индексов: 1-5 updates/sec\n- Обновление
              метрик: 1-5 updates/sec\n- Общий трафик: ~0.2-0.5 KB/sec на игрока\n",
              "sync_strategy": "Eventual Consistency"}}}, "diagrams": {"component_diagram":
              "```mermaid\ngraph TB\n    Client[UE5 Client] --> Gateway[API Gateway]\n\n    Gateway
              --> EconomyService[Economy Service<br/>8085]\n    Gateway --> DividendService[Dividend
              Service<br/>8088]\n    Gateway --> AnalyticsService[Stock Analytics
              Service<br/>8089]\n    Gateway --> ComplianceService[Compliance Service<br/>8091]\n\n    EconomyService
              --> STE[Stock Trading Engine]\n    EconomyService --> SPE[Stock Pricing
              Engine]\n    EconomyService --> PM[Portfolio Manager]\n    EconomyService
              --> CR[Corporation Registry]\n    EconomyService --> OBM[Order Book
              Manager]\n    EconomyService --> TE[Trade Executor]\n\n    DividendService
              --> DC[Dividend Calculator]\n    DividendService --> DS[Dividend Scheduler]\n    DividendService
              --> DRIP[DRIP Manager]\n    DividendService --> DD[Dividend Distributor]\n\n    AnalyticsService
              --> IC[Index Calculator]\n    AnalyticsService --> MC[Metrics Calculator]\n    AnalyticsService
              --> TA[Technical Analyzer]\n\n    ComplianceService --> TM[Trade Monitor]\n    ComplianceService
              --> ITD[Insider Trading Detector]\n    ComplianceService --> CBM[Circuit
              Breaker Manager]\n\n    EconomyService --> WorldService[World Service<br/>8086]\n    EconomyService
              --> QuestService[Quest Service]\n    EconomyService --> SocialService[Social
              Service<br/>8084]\n\n    EconomyService --> EventBus[Event Bus<br/>Kafka]\n    DividendService
              --> EventBus\n    AnalyticsService --> EventBus\n    ComplianceService
              --> EventBus\n\n    EconomyService --> DB[(Stock Exchange DB)]\n    DividendService
              --> DB\n    AnalyticsService --> DB\n    ComplianceService --> DB\n\n    EconomyService
              --> Cache[(Redis Cache)]\n    EconomyService --> WalletService[Wallet
              Service]\n    EconomyService --> NotificationService[Notification Service]\n\n    Client
              --> WSStocks[WebSocket<br/>Stock Prices]\n    WSStocks --> EconomyService\n```\n",
              "trading_flow": "```mermaid\nsequenceDiagram\n    participant Client\n    participant
              EconomyService\n    participant OrderBook\n    participant TradingEngine\n    participant
              Portfolio\n    participant Wallet\n    participant EventBus\n\n    Client->>EconomyService:
              POST /orders (BUY)\n    EconomyService->>OrderBook: Add order\n    OrderBook->>TradingEngine:
              Check for matches\n    TradingEngine->>OrderBook: Find matching SELL
              order\n    TradingEngine->>Portfolio: Update buyer portfolio\n    TradingEngine->>Portfolio:
              Update seller portfolio\n    TradingEngine->>Wallet: Transfer funds\n    TradingEngine->>Wallet:
              Charge commissions\n    TradingEngine->>EventBus: Publish trade.matched\n    TradingEngine->>EventBus:
              Publish price.updated\n    EconomyService->>Client: Order executed\n```\n",
              "dividend_flow": "```mermaid\nsequenceDiagram\n    participant Scheduler\n    participant
              DividendService\n    participant Calculator\n    participant Portfolio\n    participant
              Wallet\n    participant EventBus\n\n    Scheduler->>DividendService:
              Payment date reached\n    DividendService->>Calculator: Calculate dividends\n    Calculator->>Portfolio:
              Get shareholders\n    Calculator->>Calculator: Calculate per player\n    DividendService->>Wallet:
              Transfer dividends\n    DividendService->>EventBus: Publish dividend.paid\n    DividendService->>NotificationService:
              Notify players\n```\n", "event_impact_flow": "```mermaid\nsequenceDiagram\n    participant
              WorldService\n    participant EventBus\n    participant StockEventsHandler\n    participant
              PricingEngine\n    participant EconomyService\n    participant Client\n\n    WorldService->>EventBus:
              world.event.started\n    EventBus->>StockEventsHandler: Event notification\n    StockEventsHandler->>StockEventsHandler:
              Calculate impact\n    StockEventsHandler->>PricingEngine: Apply price
              modifier\n    PricingEngine->>EconomyService: Update prices\n    EconomyService->>EventBus:
              Publish price.updated\n    EconomyService->>Client: WebSocket notification\n```\n"}}'
        - column:
            name: metadata
            value: '{"id": "stock-exchange-technical", "title": "Архитектура системы
              фондовой биржи - Технические задачи и диаграммы", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-11-23T14:30:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "economy", "stock-exchange",
              "technical"], "related_documents": [{"id": "stock-exchange-core", "relation":
              "extends"}], "github_issue": 393, "visibility": "internal", "audience":
              ["architect", "backend", "economy"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\stock-exchange-technical.yaml
