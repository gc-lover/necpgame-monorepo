databaseChangeLog:
- changeSet:
    id: documentation-time-trials-system-architecture-d2b3c1c6
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-370514946401241'
        - column:
            name: doc_id
            value: time-trials-system-architecture
        - column:
            name: title
            value: Архитектура системы временных испытаний (Time Trials)
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-XXT00:00:00Z
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - gameplay
            - time-trials
            - speedrun
            - competitive
            - hardcore
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - gameplay-service
            - leaderboard-service
            - achievement-service
        - column:
            name: related_documents
            value: '[{"id": "time-trials-idea", "relation": "implements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "time-trials-system-architecture", "title":
              "Архитектура системы временных испытаний (Time Trials)", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-XXT00:00:00Z", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "gameplay", "time-trials", "speedrun", "competitive", "hardcore"], "related_systems":
              ["gameplay-service", "leaderboard-service", "achievement-service"],
              "related_documents": [{"id": "time-trials-idea", "relation": "implements"}],
              "github_issue": 1498, "visibility": "internal", "audience": ["architect",
              "backend", "gameplay", "api-designer"]}, "summary": {"problem": "Не
              хватает соревновательных элементов, связанных со скоростью прохождения
              контента.\nИгроки не имеют возможности соревноваться в скорости прохождения
              рейдов и подземелий.\n", "goal": "Создать архитектуру временных испытаний,
              которая:\n- Предоставляет соревнование на скорость прохождения\n- Интегрируется
              с системой лидербордов\n- Награждает игроков за рекорды\n- Поддерживает
              еженедельные испытания\n", "essence": "Система временных испытаний позволяет
              игрокам соревноваться в скорости прохождения\nрейдов, подземелий и других
              контентов. Результаты отслеживаются в лидербордах.\n"}, "architecture":
              {"overview": "Система временных испытаний состоит из следующих компонентов:\n1.
              Time Trial Manager - управление временными испытаниями\n2. Timer Controller
              - отслеживание времени прохождения\n3. Validation Engine - валидация
              результатов\n4. Leaderboard Updater - обновление лидербордов\n5. Weekly
              Challenge Manager - управление еженедельными испытаниями\n", "microservices":
              [{"name": "gameplay-service", "port": 8083, "responsibility": "Обработка
              временных испытаний:\n- Отслеживание времени прохождения\n- Валидация
              результатов\n- Применение бонусов\n", "components": [{"time-trial-manager":
              "управление испытаниями"}, {"timer-controller": "отслеживание времени"},
              {"validation-engine": "валидация результатов"}, {"weekly-challenge-manager":
              "управление еженедельными испытаниями"}], "endpoints": ["POST /api/v1/gameplay/time-trials/start
              - начало испытания", "POST /api/v1/gameplay/time-trials/complete - завершение
              с временем", "GET /api/v1/gameplay/time-trials/weekly/current - текущее
              испытание", "GET /api/v1/gameplay/time-trials/weekly/history - история
              испытаний"], "websocket_channels": ["wss://api.necp.game/v1/gameplay/time-trials/{trialId}
              - события испытания"], "events_published": [{"gameplay.time-trials.completed":
              "завершение испытания"}, {"gameplay.time-trials.record.broken": "новый
              рекорд"}, {"gameplay.time-trials.telemetry": "телеметрия"}]}], "data_flows":
              {"time_trial_start_flow": "1. Игрок начинает временное испытание\n2.
              Time Trial Manager создает сессию испытания\n3. Timer Controller запускает
              отсчет времени\n4. Gameplay Service публикует событие gameplay.time-trials.started\n5.
              Realtime Gateway отправляет информацию об испытании клиентам\n", "time_trial_complete_flow":
              "1. Игрок завершает контент\n2. Timer Controller останавливает отсчет
              времени\n3. Validation Engine проверяет валидность результата\n4. Time
              Trial Manager сохраняет результат\n5. Leaderboard Updater обновляет
              лидерборды\n6. При новом рекорде Achievement Service выдает достижения\n7.
              Gameplay Service публикует событие gameplay.time-trials.completed\n"},
              "database_structure": {"tables": [{"name": "time_trial_sessions", "description":
              "Сессии временных испытаний", "columns": [{"id": "UUID PRIMARY KEY"},
              {"trial_type": "VARCHAR(100)"}, {"content_id": "UUID FOREIGN KEY"},
              {"player_id": "UUID FOREIGN KEY"}, {"team_id": "UUID FOREIGN KEY (nullable)"},
              {"start_time": "TIMESTAMP"}, {"end_time": "TIMESTAMP (nullable)"}, {"completion_time":
              "INTEGER (nullable)"}, {"status": "ENUM (in_progress, completed, failed)"}]},
              {"name": "time_trial_records", "description": "Рекорды временных испытаний",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"trial_type": "VARCHAR(100)"},
              {"content_id": "UUID FOREIGN KEY"}, {"player_id": "UUID FOREIGN KEY"},
              {"team_id": "UUID FOREIGN KEY (nullable)"}, {"completion_time": "INTEGER"},
              {"rank": "INTEGER"}, {"validated": "BOOLEAN"}, {"created_at": "TIMESTAMP"}]},
              {"name": "weekly_time_challenges", "description": "Еженедельные испытания",
              "columns": [{"id": "UUID PRIMARY KEY"}, {"week_start": "TIMESTAMP"},
              {"week_end": "TIMESTAMP"}, {"challenge_type": "VARCHAR(100)"}, {"content_id":
              "UUID FOREIGN KEY"}, {"conditions": "JSONB"}, {"rewards": "JSONB"},
              {"created_at": "TIMESTAMP"}]}]}, "integrations": {"leaderboard_service":
              "- Обновление лидербордов по времени\n- Рейтинги игроков\n- История
              рекордов\n", "achievement_service": "- Отслеживание достижений\n- Выдача
              титулов\n- Уведомления о рекордах\n"}, "technical_tasks": {"phases":
              {"phase_1": {"name": "Time Trial Manager и Timer Controller", "tasks":
              ["Реализация Time Trial Manager", "Реализация Timer Controller", "Отслеживание
              времени прохождения", "Интеграция с Gameplay Service"], "estimated_effort":
              "3 days"}, "phase_2": {"name": "Validation Engine и Leaderboard Integration",
              "tasks": ["Реализация Validation Engine", "Валидация результатов", "Интеграция
              с Leaderboard Service", "Обновление лидербордов"], "estimated_effort":
              "3 days"}, "phase_3": {"name": "Weekly Challenge Manager", "tasks":
              ["Реализация Weekly Challenge Manager", "Управление еженедельными испытаниями",
              "Интеграция с World Service"], "estimated_effort": "2 days"}}}}}'
        - column:
            name: metadata
            value: '{"id": "time-trials-system-architecture", "title": "Архитектура
              системы временных испытаний (Time Trials)", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-12-XXT00:00:00Z", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "gameplay", "time-trials",
              "speedrun", "competitive", "hardcore"], "related_systems": ["gameplay-service",
              "leaderboard-service", "achievement-service"], "related_documents":
              [{"id": "time-trials-idea", "relation": "implements"}], "github_issue":
              1498, "visibility": "internal", "audience": ["architect", "backend",
              "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\time-trials-system-architecture.yaml
