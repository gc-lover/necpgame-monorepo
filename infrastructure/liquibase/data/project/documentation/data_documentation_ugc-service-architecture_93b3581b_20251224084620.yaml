databaseChangeLog:
- changeSet:
    id: documentation-ugc-service-architecture-93b3581b
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-921481238211636'
        - column:
            name: doc_id
            value: ugc-service-architecture
        - column:
            name: title
            value: Архитектура UGC Service - система пользовательского контента
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.0.0
        - column:
            name: last_updated
            value: 2025-12-XXT00:00:00Z
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - infrastructure
            - storage
            - ugc
            - creator-economy
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - creator-platform-service
            - moderation-service
            - cdn-service
            - economy-service
        - column:
            name: related_documents
            value: '[{"id": "creator-economy-platform-architecture", "relation": "integrates"},
              {"id": "economy-monetization", "relation": "implements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - infrastructure
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "ugc-service-architecture", "title": "Архитектура
              UGC Service - система пользовательского контента", "document_type":
              "architecture", "category": "systems", "status": "draft", "version":
              "1.0.0", "last_updated": "2025-12-XXT00:00:00Z", "owners": [{"role":
              "architect", "contact": "architect@necp.game"}], "tags": ["architecture",
              "infrastructure", "storage", "ugc", "creator-economy"], "related_systems":
              ["creator-platform-service", "moderation-service", "cdn-service", "economy-service"],
              "related_documents": [{"id": "creator-economy-platform-architecture",
              "relation": "integrates"}, {"id": "economy-monetization", "relation":
              "implements"}], "github_issue": 1462, "visibility": "internal", "audience":
              ["architect", "backend", "infrastructure", "api-designer"]}, "summary":
              {"problem": "Требуется детальная техническая архитектура для системы
              загрузки, хранения,\nмодерации и распространения пользовательского контента
              (3D модели, текстуры,\nаудио, видео, скрипты, квесты).\n", "goal": "Создать
              архитектурную схему UGC Service с определением:\n- Компонентов для загрузки
              и валидации контента\n- Системы хранения (Hot/Cold Storage)\n- CDN для
              распространения\n- Метаданных и индексации\n- Интеграции с модерацией\n-
              Версионирования контента\n- REST, WebSocket и Event Bus контрактов\n-
              Структуры БД\n- Технического задания для реализации\n", "essence": "Полнофункциональная
              система для управления пользовательским контентом с поддержкой\nзагрузки,
              хранения, модерации, версионирования и распространения через CDN.\n"},
              "architecture": {"overview": "Архитектура UGC Service состоит из следующих
              компонентов:\n1. Upload Service - загрузка и валидация контента\n2.
              Storage Service - управление хранилищами (Hot/Cold Storage)\n3. CDN
              Service - распространение контента\n4. Metadata Service - метаданные
              и индексация\n5. Moderation Integration - интеграция с модерацией\n6.
              Version Control - версионирование контента\n7. API Gateway - единая
              точка входа\n", "content_types": [{"type": "3d_models", "description":
              "3D модели (GLB, FBX, OBJ)", "max_size": "100 MB", "validation": "формат,
              полигоны, текстуры", "storage": "Hot Storage (S3)"}, {"type": "textures",
              "description": "Текстуры (PNG, JPG, DDS)", "max_size": "50 MB", "validation":
              "разрешение, формат, размер", "storage": "Hot Storage (S3)"}, {"type":
              "audio", "description": "Аудио (OGG, WAV, MP3)", "max_size": "20 MB",
              "validation": "формат, длительность, битрейт", "storage": "Hot Storage
              (S3)"}, {"type": "video", "description": "Видео (MP4, WebM)", "max_size":
              "500 MB", "validation": "формат, разрешение, длительность", "storage":
              "Cold Storage (S3 Glacier)"}, {"type": "scripts", "description": "Скрипты
              (Lua, JavaScript)", "max_size": "5 MB", "validation": "синтаксис, безопасность",
              "storage": "Hot Storage (S3)"}, {"type": "quests", "description": "Квесты
              (YAML, JSON)", "max_size": "10 MB", "validation": "структура, валидность",
              "storage": "Hot Storage (PostgreSQL)"}], "microservices": [{"name":
              "ugc-upload-service", "port": 8110, "responsibility": "Загрузка и валидация
              контента:\n- Прием загрузок от клиентов\n- Валидация форматов и размеров\n-
              Проверка безопасности\n- Предварительная обработка\n", "components":
              [{"upload-handler": "обработка загрузок"}, {"content-validator": "валидация
              контента"}, {"security-scanner": "проверка безопасности"}, {"preprocessor":
              "предварительная обработка"}]}, {"name": "ugc-storage-service", "port":
              8111, "responsibility": "Управление хранилищами:\n- Hot Storage (активный
              контент)\n- Cold Storage (архивный контент)\n- Миграция между хранилищами\n-
              Управление жизненным циклом\n", "components": [{"hot-storage-manager":
              "управление Hot Storage"}, {"cold-storage-manager": "управление Cold
              Storage"}, {"lifecycle-manager": "управление жизненным циклом"}, {"migration-manager":
              "миграция между хранилищами"}]}, {"name": "ugc-cdn-service", "port":
              8112, "responsibility": "Распространение контента через CDN:\n- Интеграция
              с CDN провайдерами\n- Кэширование контента\n- Оптимизация доставки\n-
              Мониторинг производительности\n", "components": [{"cdn-manager": "управление
              CDN"}, {"cache-manager": "управление кэшем"}, {"optimization-engine":
              "оптимизация доставки"}, {"performance-monitor": "мониторинг производительности"}]},
              {"name": "ugc-metadata-service", "port": 8113, "responsibility": "Метаданные
              и индексация:\n- Хранение метаданных\n- Индексация для поиска\n- Теги
              и категории\n- Статистика использования\n", "components": [{"metadata-manager":
              "управление метаданными"}, {"search-indexer": "индексация для поиска"},
              {"tag-manager": "управление тегами"}, {"statistics-collector": "сбор
              статистики"}]}, {"name": "ugc-version-service", "port": 8114, "responsibility":
              "Версионирование контента:\n- Управление версиями\n- История изменений\n-
              Откат версий\n- Сравнение версий\n", "components": [{"version-manager":
              "управление версиями"}, {"history-tracker": "отслеживание истории"},
              {"rollback-manager": "откат версий"}, {"diff-engine": "сравнение версий"}]}],
              "storage_strategy": {"hot_storage": "- Назначение: активный контент,
              часто используемый\n- Технология: S3 (AWS S3 или MinIO)\n- Типы контента:
              3D модели, текстуры, аудио, скрипты, квесты\n- Retention: до 90 дней
              без использования\n- Доступ: быстрый (мгновенный)\n", "cold_storage":
              "- Назначение: архивный контент, редко используемый\n- Технология: S3
              Glacier или аналоги\n- Типы контента: старые версии, неиспользуемый
              контент\n- Retention: неограниченный\n- Доступ: медленный (требует восстановления)\n"},
              "data_models": [{"name": "UGCContent", "fields": [{"id": "UUID"}, {"creator_id":
              "UUID"}, {"content_type": "enum (3d_models, textures, audio, video,
              scripts, quests)"}, {"title": "string"}, {"description": "text"}, {"file_path":
              "string"}, {"file_size": "bigint"}, {"file_hash": "string"}, {"storage_type":
              "enum (hot, cold)"}, {"version": "int"}, {"status": "enum (draft, pending_moderation,
              approved, rejected, archived)"}, {"moderation_status": "json"}, {"metadata":
              "json"}, {"tags": "array<string>"}, {"download_count": "int"}, {"rating":
              "float"}, {"created_at": "timestamp"}, {"updated_at": "timestamp"}]},
              {"name": "UGCVersion", "fields": [{"id": "UUID"}, {"content_id": "UUID"},
              {"version_number": "int"}, {"file_path": "string"}, {"file_hash": "string"},
              {"changelog": "text"}, {"created_by": "UUID"}, {"created_at": "timestamp"}]},
              {"name": "UGCMetadata", "fields": [{"id": "UUID"}, {"content_id": "UUID"},
              {"metadata_key": "string"}, {"metadata_value": "json"}, {"indexed":
              "boolean"}, {"created_at": "timestamp"}, {"updated_at": "timestamp"}]},
              {"name": "UGCDownload", "fields": [{"id": "UUID"}, {"content_id": "UUID"},
              {"player_id": "UUID"}, {"version": "int"}, {"downloaded_at": "timestamp"},
              {"cdn_used": "boolean"}]}], "api_endpoints": {"upload": ["POST /api/v1/ugc/upload
              - загрузка контента", "POST /api/v1/ugc/upload/{id}/validate - валидация
              загруженного контента", "GET /api/v1/ugc/upload/{id}/status - статус
              загрузки"], "content_management": ["GET /api/v1/ugc/content - список
              контента", "GET /api/v1/ugc/content/{id} - детали контента", "PUT /api/v1/ugc/content/{id}
              - обновление контента", "DELETE /api/v1/ugc/content/{id} - удаление
              контента", "GET /api/v1/ugc/content/{id}/download - скачивание контента"],
              "version_management": ["GET /api/v1/ugc/content/{id}/versions - список
              версий", "POST /api/v1/ugc/content/{id}/versions - создание новой версии",
              "GET /api/v1/ugc/content/{id}/versions/{version} - детали версии", "POST
              /api/v1/ugc/content/{id}/versions/{version}/rollback - откат версии"],
              "metadata": ["GET /api/v1/ugc/content/{id}/metadata - метаданные контента",
              "PUT /api/v1/ugc/content/{id}/metadata - обновление метаданных", "GET
              /api/v1/ugc/search - поиск контента", "GET /api/v1/ugc/tags - список
              тегов"], "moderation": ["POST /api/v1/ugc/content/{id}/moderate - отправка
              на модерацию", "GET /api/v1/ugc/content/{id}/moderation-status - статус
              модерации"]}, "websocket_events": ["ugc:upload-progress - прогресс загрузки",
              "ugc:content-approved - контент одобрен", "ugc:content-rejected - контент
              отклонен", "ugc:version-created - создана новая версия"], "event_bus_topics":
              ["ugc:content-uploaded - контент загружен", "ugc:content-validated -
              контент валидирован", "ugc:content-approved - контент одобрен модерацией",
              "ugc:content-rejected - контент отклонен модерацией", "ugc:version-created
              - создана версия", "ugc:content-downloaded - контент скачан", "ugc:content-archived
              - контент архивирован"], "data_synchronization": {"tick_rate": "- Загрузка
              контента: real-time (при загрузке)\n- Миграция в Cold Storage: каждые
              24 часа\n- Обновление метаданных: при изменениях\n- Синхронизация CDN:
              при публикации\n", "network_load": "- Загрузка контента: высокая нагрузка
              (большие файлы)\n- Скачивание контента: высокая нагрузка (CDN)\n- Метаданные:
              низкая нагрузка\n- Версионирование: средняя нагрузка\n", "caching_strategy":
              "- Метаданные контента: кэш на 5 минут\n- Список контента: кэш на 1
              минуту\n- Статус модерации: кэш на 1 минуту\n- Версии контента: кэш
              на 10 минут\n"}, "integrations": {"with_creator_platform": "- Загрузка
              контента через Creator Hub\n- Управление контентом создателями\n- Интеграция
              с монетизацией\n", "with_moderation_service": "- Автоматическая модерация
              контента\n- Ручная модерация\n- Отчеты о нарушениях\n", "with_cdn_service":
              "- Распространение контента через CDN\n- Кэширование на edge серверах\n-
              Оптимизация доставки\n", "with_economy_service": "- Монетизация контента\n-
              Отслеживание продаж\n- Выплаты создателям\n", "with_storage_service":
              "- Hot Storage (S3)\n- Cold Storage (S3 Glacier)\n- Управление жизненным
              циклом\n"}, "technical_tasks": [{"task": "Создать ugc-upload-service",
              "description": "Сервис загрузки с Upload Handler, Content Validator,
              Security Scanner, Preprocessor\n", "estimated_lines": 400}, {"task":
              "Создать ugc-storage-service", "description": "Сервис хранения с Hot/Cold
              Storage Managers, Lifecycle Manager, Migration Manager\n", "estimated_lines":
              350}, {"task": "Создать ugc-cdn-service", "description": "Сервис CDN
              с CDN Manager, Cache Manager, Optimization Engine, Performance Monitor\n",
              "estimated_lines": 300}, {"task": "Создать ugc-metadata-service", "description":
              "Сервис метаданных с Metadata Manager, Search Indexer, Tag Manager,
              Statistics Collector\n", "estimated_lines": 300}, {"task": "Создать
              ugc-version-service", "description": "Сервис версионирования с Version
              Manager, History Tracker, Rollback Manager, Diff Engine\n", "estimated_lines":
              250}, {"task": "Создать структуру БД для UGC", "description": "Таблицы:
              ugc_content, ugc_versions, ugc_metadata, ugc_downloads\n", "estimated_lines":
              200}, {"task": "Интегрировать с существующими системами", "description":
              "Интеграция с Creator Platform, Moderation Service, CDN Service, Economy
              Service\n", "estimated_lines": 250}, {"task": "Создать API endpoints",
              "description": "REST API для Upload, Content Management, Version Management,
              Metadata, Moderation\n", "estimated_lines": 400}, {"task": "Интегрировать
              с Event Bus", "description": "Подписка и публикация событий ugc:* для
              интеграции с другими системами\n", "estimated_lines": 200}]}}'
        - column:
            name: metadata
            value: '{"id": "ugc-service-architecture", "title": "Архитектура UGC Service
              - система пользовательского контента", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.0.0", "last_updated":
              "2025-12-XXT00:00:00Z", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "infrastructure",
              "storage", "ugc", "creator-economy"], "related_systems": ["creator-platform-service",
              "moderation-service", "cdn-service", "economy-service"], "related_documents":
              [{"id": "creator-economy-platform-architecture", "relation": "integrates"},
              {"id": "economy-monetization", "relation": "implements"}], "github_issue":
              1462, "visibility": "internal", "audience": ["architect", "backend",
              "infrastructure", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\ugc-service-architecture.yaml
