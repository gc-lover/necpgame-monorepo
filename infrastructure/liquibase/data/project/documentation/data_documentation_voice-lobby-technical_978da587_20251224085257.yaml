databaseChangeLog:
- changeSet:
    id: documentation-voice-lobby-technical-978da587
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-262735709250557'
        - column:
            name: doc_id
            value: voice-lobby-technical
        - column:
            name: title
            value: Архитектура системы голосовых лобби - Техническое задание
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: systems
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.1.0
        - column:
            name: last_updated
            value: 2025-11-30 20:40:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[]'
        - column:
            name: tags
            value: []
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value: []
        - column:
            name: related_documents
            value: '[{"id": "voice-lobby-core", "relation": "extends"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: ''
        - column:
            name: audience
            value: []
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "voice-lobby-technical", "title": "Архитектура
              системы голосовых лобби - Техническое задание", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.1.0", "last_updated":
              "2025-11-30T20:40:00+00:00", "github_issue": 338, "related_documents":
              [{"id": "voice-lobby-core", "relation": "extends"}]}, "technical_specification":
              {"subtasks": [{"id": "voice-lobby-manager", "title": "Реализация менеджера
              системы лобби", "description": "Реализация Voice Lobby Manager с управлением
              системой лобби\nи интеграцией с другими компонентами.\n", "dependencies":
              [], "estimated_effort": "5 days"}, {"id": "lobby-directory-manager",
              "title": "Реализация менеджера каталога лобби", "description": "Реализация
              Lobby Directory Manager с управлением каталогом лобби,\nпоиском и фильтрацией.\n",
              "dependencies": ["voice-lobby-manager"], "estimated_effort": "4 days"},
              {"id": "party-finder-engine", "title": "Реализация движка подбора групп",
              "description": "Реализация Party Finder Engine с подбором групп,\nалгоритмом
              совпадений и управлением очередью.\n", "dependencies": ["voice-lobby-manager"],
              "estimated_effort": "5 days"}, {"id": "subchannel-controller", "title":
              "Реализация контроллера подканалов", "description": "Реализация Subchannel
              Controller с управлением подканалами,\nсозданием и перемещением участников.\n",
              "dependencies": ["voice-lobby-manager"], "estimated_effort": "4 days"},
              {"id": "permissions-engine", "title": "Реализация движка прав доступа",
              "description": "Реализация Permissions Engine с управлением правами
              доступа,\nпроверкой прав и применением ограничений.\n", "dependencies":
              ["voice-lobby-manager"], "estimated_effort": "4 days"}, {"id": "lobby-matchmaker",
              "title": "Реализация подбора лобби", "description": "Реализация Lobby
              Matchmaker с подбором лобби,\nалгоритмом совпадений и управлением очередью.\n",
              "dependencies": ["voice-lobby-manager"], "estimated_effort": "4 days"},
              {"id": "voice-provider-integrator", "title": "Реализация интегратора
              голосового провайдера", "description": "Реализация Voice Provider Integrator
              с интеграцией голосового провайдера,\nсозданием комнат и управлением
              участниками.\n", "dependencies": ["voice-lobby-manager"], "estimated_effort":
              "5 days"}, {"id": "lobby-analytics-collector", "title": "Реализация
              сборщика аналитики", "description": "Реализация Lobby Analytics Collector
              с логированием операций,\nсбором метрик и интеграцией с Analytics Service.\n",
              "dependencies": ["voice-lobby-manager"], "estimated_effort": "3 days"},
              {"id": "lobby-telemetry-collector", "title": "Реализация сборщика телеметрии",
              "description": "Реализация Lobby Telemetry Collector с логированием
              событий,\nсбором телеметрии и интеграцией с Analytics Service.\n", "dependencies":
              ["voice-lobby-manager"], "estimated_effort": "2 days"}, {"id": "websocket-channels",
              "title": "Реализация WebSocket каналов", "description": "Реализация
              WebSocket каналов для realtime обновлений лобби,\nпоиска групп и уведомлений.\n",
              "dependencies": ["voice-lobby-manager"], "estimated_effort": "3 days"},
              {"id": "event-bus-integration", "title": "Интеграция с Event Bus", "description":
              "Реализация публикации и подписки на события через Kafka\nдля всех компонентов
              системы лобби.\n", "dependencies": ["voice-lobby-manager"], "estimated_effort":
              "2 days"}, {"id": "database-schema", "title": "Создание схемы БД", "description":
              "Создание таблиц БД для лобби, участников, подканалов,\nпоисков групп
              и телеметрии с миграциями Liquibase.\n", "dependencies": [], "estimated_effort":
              "3 days"}]}, "diagrams": {"component_diagram": "```mermaid\ngraph TB\n    Client[UE5
              Client] --> Gateway[API Gateway]\n\n    Gateway --> VoiceLobbyService[Voice
              Lobby Service<br/>8096]\n\n    VoiceLobbyService --> VLM[Voice Lobby
              Manager]\n    VoiceLobbyService --> LDM[Lobby Directory Manager]\n    VoiceLobbyService
              --> PFE[Party Finder Engine]\n    VoiceLobbyService --> SC[Subchannel
              Controller]\n    VoiceLobbyService --> PE[Permissions Engine]\n    VoiceLobbyService
              --> LM[Lobby Matchmaker]\n    VoiceLobbyService --> VPI[Voice Provider
              Integrator]\n    VoiceLobbyService --> LAC[Lobby Analytics Collector]\n    VoiceLobbyService
              --> LTC[Lobby Telemetry Collector]\n\n    VLM --> LDM\n    VLM --> PFE\n    VLM
              --> SC\n    VLM --> PE\n    VLM --> LM\n    VLM --> VPI\n\n    VoiceLobbyService
              --> VoiceService[Voice Service]\n    VoiceLobbyService --> PartyService[Party
              Service]\n    VoiceLobbyService --> GuildService[Guild Service]\n    VoiceLobbyService
              --> ClanService[Clan Service]\n    VoiceLobbyService --> CharacterService[Character
              Service]\n    VoiceLobbyService --> AnalyticsService[Analytics Service]\n\n    VoiceLobbyService
              --> EventBus[Event Bus<br/>Kafka]\n    EventBus --> RealtimeGateway[Realtime
              Gateway]\n\n    VoiceLobbyService --> DB[(Voice Lobby DB)]\n\n    Client
              --> WSLobbies[WebSocket<br/>Lobbies]\n    WSLobbies --> VoiceLobbyService\n```\n",
              "lobby_creation_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              Player as Player\n    participant VLM as Voice Lobby Manager\n    participant
              VPI as Voice Provider Integrator\n    participant LDM as Lobby Directory
              Manager\n    participant EB as Event Bus\n\n    Player->>VLM: Create
              lobby\n    VLM->>VLM: Validate data\n    VLM->>VLM: Check limits\n    VLM->>VPI:
              Create voice room\n    VPI->>VPI: Create room in provider\n    VPI->>VLM:
              Return room ID\n    VLM->>VLM: Save to DB\n    VLM->>LDM: Add to directory\n    VLM->>EB:
              Publish voice-lobby.created\n```\n", "party_finder_flow_diagram": "```mermaid\nsequenceDiagram\n    participant
              Player as Player\n    participant PFE as Party Finder Engine\n    participant
              LM as Lobby Matchmaker\n    participant VLM as Voice Lobby Manager\n    participant
              EB as Event Bus\n\n    Player->>PFE: Start search\n    PFE->>PFE: Save
              search criteria\n    PFE->>PFE: Add to queue\n    LM->>LM: Check matches\n    LM->>LM:
              Find matching lobby\n    LM->>VLM: Join player to lobby\n    VLM->>EB:
              Publish party-finder.found\n```\n"}, "history": [{"version": "1.1.0",
              "date": "2025-11-30", "author": "Architect Agent", "changes": "Добавлена
              детальная синхронизация данных:\n- Event Sourcing для всех изменений
              состояния лобби\n- CQRS Pattern для разделения команд и запросов\n-
              Saga Pattern для распределенных операций (создание лобби, присоединение,
              управление подканалами, Party Finder)\n- Outbox Pattern для гарантированной
              доставки событий\n- Обновлена секция data_consistency с механизмами
              синхронизации\n- Добавлена спецификация тикрейта для лобби, присоединения/выхода,
              подканалов, Party Finder, прав, голосового провайдера, статистики и
              обработки событий\n"}, {"version": "1.0.0", "date": "2025-11-23", "author":
              "Architect Agent", "changes": "Создана полная архитектура системы голосовых
              лобби:\n- Определены компоненты (Voice Lobby Manager, Lobby Directory
              Manager, Party Finder Engine, Subchannel Controller, Permissions Engine,
              Lobby Matchmaker, Voice Provider Integrator)\n- Описаны API endpoints
              (высокоуровнево)\n- Спроектированы потоки данных\n- Определена структура
              БД (voice_lobbies, lobby_participants, lobby_subchannels, party_finder_searches,
              lobby_telemetry)\n- Спроектирована система лобби\n- Спроектирована система
              Party Finder\n- Спроектирована система управления подканалами\n- Спроектирована
              система прав доступа\n- Создано техническое задание\n- Разбито на подзадачи\n"}]}'
        - column:
            name: metadata
            value: '{"id": "voice-lobby-technical", "title": "Архитектура системы
              голосовых лобби - Техническое задание", "document_type": "architecture",
              "category": "systems", "status": "draft", "version": "1.1.0", "last_updated":
              "2025-11-30T20:40:00+00:00", "github_issue": 338, "related_documents":
              [{"id": "voice-lobby-core", "relation": "extends"}]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\voice-lobby-technical.yaml
