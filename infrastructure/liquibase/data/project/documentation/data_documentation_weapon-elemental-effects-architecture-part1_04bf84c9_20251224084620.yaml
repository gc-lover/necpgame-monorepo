databaseChangeLog:
- changeSet:
    id: documentation-weapon-elemental-effects-architecture-part1-04bf84c9
    author: content-migration-generator
    changes:
    - insert:
        tableName: project.documentation
        columns:
        - column:
            name: id
            value: '-334479395077499'
        - column:
            name: doc_id
            value: weapon-elemental-effects-architecture
        - column:
            name: title
            value: Архитектура системы стихийных эффектов оружия
        - column:
            name: document_type
            value: architecture
        - column:
            name: category
            value: combat
        - column:
            name: status
            value: draft
        - column:
            name: version
            value: 1.1.0
        - column:
            name: last_updated
            value: 2025-12-07 00:15:00+00:00
        - column:
            name: concept_approved
            value: false
        - column:
            name: concept_reviewed_at
            value: null
        - column:
            name: owners
            value: '[{"role": "architect", "contact": "architect@necp.game"}]'
        - column:
            name: tags
            value:
            - architecture
            - combat
            - weapons
            - elemental
            - effects
        - column:
            name: topics
            value: []
        - column:
            name: related_systems
            value:
            - weapon-system
            - combat-engine
            - effect-system
            - damage-system
        - column:
            name: related_documents
            value: '[{"id": "weapon-special-mechanics-working", "relation": "implements"}]'
        - column:
            name: source
            value: ''
        - column:
            name: visibility
            value: internal
        - column:
            name: audience
            value:
            - architect
            - backend
            - gameplay
            - api-designer
        - column:
            name: risk_level
            value: ''
        - column:
            name: content
            value: '{"metadata": {"id": "weapon-elemental-effects-architecture", "title":
              "Архитектура системы стихийных эффектов оружия", "document_type": "architecture",
              "category": "combat", "status": "draft", "version": "1.1.0", "last_updated":
              "2025-12-07T00:15:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "combat", "weapons",
              "elemental", "effects"], "related_systems": ["weapon-system", "combat-engine",
              "effect-system", "damage-system"], "related_documents": [{"id": "weapon-special-mechanics-working",
              "relation": "implements"}], "github_issue": 1556, "visibility": "internal",
              "audience": ["architect", "backend", "gameplay", "api-designer"]}, "summary":
              {"problem": "Требуется спроектировать архитектуру системы стихийных
              эффектов оружия,\nвключающую огонь, лед, яд и кислоту с DoT эффектами,
              взаимодействиями\nмежду стихиями и интеграцией с окружающей средой.\n",
              "goal": "Создать архитектурную схему с определением компонентов, API,
              потоков данных\nи оптимизаций для системы стихийных эффектов оружия.\n",
              "essence": "Полная архитектура стихийных эффектов оружия с поддержкой
              комплексных\nвзаимодействий и высокой производительностью в боевых сценариях.\n"},
              "architecture": {"overview": "Архитектура системы стихийных эффектов
              оружия состоит из следующих компонентов:\n1. Elemental Effect Manager
              - управление стихийными эффектами\n2. Fire Effect Processor - обработка
              огненных эффектов\n3. Ice Effect Processor - обработка ледяных эффектов\n4.
              Poison Effect Processor - обработка ядовитых эффектов\n5. Acid Effect
              Processor - обработка кислотных эффектов\n6. Elemental Interaction Calculator
              - расчет взаимодействий между стихиями\n7. Environmental Effect Integrator
              - интеграция с окружающей средой\n8. Elemental Damage Calculator - расчет
              урона от стихий\n9. Elemental Effect Visualizer - визуализация эффектов\n10.
              Elemental Telemetry Collector - сбор телеметрии\n", "microservices":
              [{"name": "elemental-effects-service", "port": 8102, "responsibility":
              "Обработка стихийных эффектов оружия:\n- Управление огненными эффектами\n-
              Управление ледяными эффектами\n- Управление ядовитыми эффектами\n- Управление
              кислотными эффектами\n- Расчет взаимодействий между стихиями\n- Интеграция
              с окружающей средой\n- Сбор телеметрии\n", "components": [{"elemental-effect-manager":
              "управление стихийными эффектами"}, {"fire-effect-processor": "обработка
              огненных эффектов"}, {"ice-effect-processor": "обработка ледяных эффектов"},
              {"poison-effect-processor": "обработка ядовитых эффектов"}, {"acid-effect-processor":
              "обработка кислотных эффектов"}, {"elemental-interaction-calculator":
              "расчет взаимодействий"}, {"environmental-effect-integrator": "интеграция
              с окружением"}, {"elemental-damage-calculator": "расчет урона"}, {"elemental-effect-visualizer":
              "визуализация"}, {"elemental-telemetry-collector": "телеметрия"}], "endpoints":
              ["POST /api/v1/elemental-effects/apply - применение стихийного эффекта",
              "POST /api/v1/elemental-effects/interact - расчет взаимодействия стихий",
              "GET /api/v1/elemental-effects/{characterId}/active - активные эффекты",
              "POST /api/v1/elemental-effects/environmental - применение эффектов
              окружения", "GET /api/v1/elemental-effects/damage/calculate - расчет
              стихийного урона"], "websocket_channels": ["wss://api.necp.game/v1/elemental-effects/{characterId}
              - обновления эффектов"], "events_published": [{"elemental.effect_applied":
              "применение эффекта"}, {"elemental.interaction_calculated": "расчет
              взаимодействия"}, {"elemental.environmental_triggered": "срабатывание
              эффекта окружения"}, {"elemental.damage_dealt": "нанесение урона"},
              {"elemental.effect_expired": "истечение эффекта"}], "events_subscribed":
              [{"weapon.fired": "выстрел оружия"}, {"projectile.hit": "попадание снаряда"},
              {"target.damaged": "повреждение цели"}, {"environment.changed": "изменение
              окружения"}, {"combat.round_end": "окончание раунда"}]}], "elemental_types":
              {"fire_effects": {"description": "Огненные эффекты с DoT и распространением",
              "mechanics": [{"direct_damage": "прямой урон огнем"}, {"burn_dot": "DoT
              урон от горения"}, {"spread_fire": "распространение огня на соседние
              объекты"}, {"fire_explosion": "взрыв при взаимодействии с химикатами"},
              {"fire_weakness": "уязвимость к водным атакам"}], "stats": [{"damage_per_second":
              "урон в секунду"}, {"spread_chance": "шанс распространения"}, {"duration":
              "длительность горения"}, {"explosion_multiplier": "множитель взрыва"}]},
              "ice_effects": {"description": "Ледяные эффекты с замедлением и заморозкой",
              "mechanics": [{"cold_damage": "урон холодом"}, {"movement_slow": "замедление
              движения"}, {"attack_slow": "замедление атак"}, {"freeze": "полная заморозка
              при накоплении"}, {"brittle": "хрупкость замороженных целей (+50% урона)"},
              {"water_interaction": "взаимодействие с водой"}], "stats": [{"freeze_threshold":
              "порог заморозки"}, {"slow_percentage": "процент замедления"}, {"brittle_multiplier":
              "множитель хрупкости"}, {"shatter_damage": "урон от разрушения"}]},
              "poison_effects": {"description": "Ядовитые эффекты с накоплением токсинов",
              "mechanics": [{"poison_damage": "урон ядом"}, {"regen_reduction": "снижение
              регенерации"}, {"damage_amplification": "усиление урона при накоплении"},
              {"spread_poison": "распространение на соседние цели"}, {"electricity_interaction":
              "взаимодействие с электричеством"}, {"fire_interaction": "взрыв при
              взаимодействии с огнем"}], "stats": [{"toxin_buildup": "накопление токсинов"},
              {"max_stacks": "максимальное количество стаков"}, {"spread_radius":
              "радиус распространения"}, {"electricity_multiplier": "усиление от электричества"}]},
              "acid_effects": {"description": "Кислотные эффекты с коррозией", "mechanics":
              [{"acid_damage": "урон кислотой"}, {"armor_reduction": "снижение брони
              цели"}, {"surface_damage": "повреждение поверхностей"}, {"corrosion_dot":
              "постепенная коррозия"}, {"water_spread": "распространение в воде"},
              {"metal_weakness": "особая эффективность против металла"}], "stats":
              [{"armor_reduction_percentage": "процент снижения брони"}, {"corrosion_rate":
              "скорость коррозии"}, {"surface_damage_radius": "радиус повреждения
              поверхности"}, {"metal_damage_bonus": "бонус к урону по металлу"}]}},
              "elemental_interactions": {"fire_water": "Огонь + Вода = Пар (снижение
              урона огня, создание облака пара)\n- Fire damage: -50% effectiveness\n-
              Creates steam cloud: reduces visibility in radius\n- Steam cloud duration:
              5 seconds\n", "fire_ice": "Огонь + Лед = Таяние (ускоренное таяние льда,
              пар)\n- Ice duration: -75% reduction\n- Creates steam cloud\n- Additional
              fire damage to frozen targets\n", "fire_poison": "Огонь + Яд = Взрыв
              (ядовитый взрыв при поджоге)\n- Creates poison explosion: radius 3m\n-
              Explosion damage: poison + fire\n- Spreads poison to nearby targets\n",
              "ice_poison": "Лед + Яд = Замороженный яд (яд замедляется, но становится
              сильнее)\n- Poison tick rate: -50% (longer duration)\n- Poison damage:
              +25% when frozen\n- Freeze extends poison duration\n", "ice_acid": "Лед
              + Кислота = Коррозия (кислота медленно разъедает лед)\n- Ice duration:
              gradual reduction over time\n- Acid damage: +50% to frozen targets\n-
              Creates corrosive sludge\n", "poison_acid": "Яд + Кислота = Мутагенный
              яд (усиление эффектов)\n- Combined damage: +100% effectiveness\n- Additional
              mutation effects\n- Increased spread radius\n"}, "data_flows": {"elemental_effect_application":
              "1. Weapon with elemental effect hits target\n2. Elemental Effect Manager
              receives hit data\n3. Effect type determined and routed to appropriate
              processor\n4. Elemental Damage Calculator computes initial damage\n5.
              Effect applied to target with duration timer\n6. Visual effects triggered
              through Elemental Effect Visualizer\n7. Event elemental.effect_applied
              published\n", "elemental_interaction_calculation": "1. Multiple elemental
              effects detected on target/area\n2. Elemental Interaction Calculator
              analyzes effect combinations\n3. Interaction rules applied (fire + ice
              = steam)\n4. Effect modifications calculated\n5. New combined effects
              created if applicable\n6. Event elemental.interaction_calculated published\n",
              "environmental_integration": "1. Target enters environmental area (water,
              fire, etc.)\n2. Environmental Effect Integrator checks for elemental
              synergies\n3. Environmental modifiers applied to active effects\n4.
              Effect duration/damage modified based on environment\n5. Event elemental.environmental_triggered
              published\n"}, "data_consistency": {"strategy": "Eventual Consistency
              для эффектов, Strong Consistency для критичных взаимодействий", "mechanisms":
              ["Event Sourcing для всех изменений состояния эффектов", "Saga Pattern
              для комплексных взаимодействий стихий", "Optimistic locking для предотвращения
              конфликтов эффектов", "Validation перед применением взаимодействий"]},
              "performance_optimizations": {"memory_optimization": {"effect_pooling":
              {"elemental_effect_pool": "size 10000, reuse effect instances", "interaction_pool":
              "size 2000, reuse interaction calculators", "damage_pool": "size 5000,
              reuse damage calculators"}, "struct_alignment": {"elemental_effect_struct":
              ["effect_id(uuid)", "target_id(uuid)", "element_type(uint16)", "damage(float32)",
              "duration(int32)"], "interaction_struct": ["primary_element(uint16)",
              "secondary_element(uint16)", "interaction_type(uint16)", "multiplier(float32)"]}},
              "computation_optimization": {"batch_processing": "group multiple effects
              on same target", "spatial_indexing": "quick lookup for environmental
              effects", "effect_combining": "merge similar elemental effects", "lazy_calculation":
              "calculate complex interactions on-demand"}, "network_optimization":
              {"effect_delta": "send only changed effect states", "area_broadcast":
              "send environmental effects to nearby players only", "effect_prediction":
              "client-side prediction for common effects"}}, "tickrate_specification":
              {"elemental_processing": {"tickrate": "20-60 Hz для активных DoT эффектов,
              Event-based для активации", "network_load": "- Effect application: ~0.3-1
              KB/sec per active effect\n- Interaction calculations: ~0.1-0.5 KB/sec
              per interaction\n- Environmental updates: ~0.2-0.8 KB/sec per environmental
              change\n- Damage ticks: ~0.1-0.3 KB/sec per DoT effect\n- Total elemental
              traffic: ~1-3 KB/sec per player in combat\n", "latency_requirements":
              "< 30ms для применения эффектов, < 50ms для расчетов взаимодействий"}},
              "database_structure": {"tables": [{"name": "elemental_effects_definitions",
              "description": "Определения стихийных эффектов", "columns": [{"id":
              "UUID PRIMARY KEY"}, {"element_type": "ENUM (fire, ice, poison, acid)"},
              {"effect_name": "VARCHAR(100)"}, {"parameters": "JSONB"}, {"interaction_rules":
              "JSONB"}, {"visual_effects": "JSONB"}, {"created_at": "TIMESTAMP"}]},
              {"name": "active_elemental_effects", "description": "Активные стихийные
              эффекты", "columns": [{"id": "UUID PRIMARY KEY"}, {"character_id": "UUID
              FOREIGN KEY"}, {"target_id": "UUID FOREIGN KEY"}, {"effect_id": "UUID
              FOREIGN KEY"}, {"stacks": "INTEGER"}, {"damage_per_tick": "DECIMAL"},
              {"duration_remaining": "INTEGER"}, {"applied_at": "TIMESTAMP"}, {"expires_at":
              "TIMESTAMP"}]}, {"name": "elemental_interactions", "description": "Журнал
              взаимодействий стихий", "columns": [{"id": "UUID PRIMARY KEY"}, {"primary_effect_id":
              "UUID FOREIGN KEY"}, {"secondary_effect_id": "UUID FOREIGN KEY"}, {"interaction_type":
              "VARCHAR(50)"}, {"result_effects": "JSONB"}, {"created_at": "TIMESTAMP"}]},
              {"name": "elemental_telemetry", "description": "Телеметрия стихийных
              эффектов", "columns": [{"id": "UUID PRIMARY KEY"}, {"event_type": "VARCHAR(50)"},
              {"character_id": "UUID FOREIGN KEY"}, {"target_id": "UUID FOREIGN KEY"},
              {"element_type": "VARCHAR(20)"}, {"damage_dealt": "DECIMAL"}, {"effect_duration":
              "INTEGER"}, {"created_at": "TIMESTAMP"}]}]}, "integrations": {"combat_service":
              "- Получение событий попаданий и повреждений\n- Применение стихийных
              эффектов к целям\n- Синхронизация состояния эффектов\n- Расчет комбинированного
              урона\n", "damage_system": "- Расчет стихийного урона через Elemental
              Damage Calculator\n- Применение модификаторов сопротивлений\n- Обработка
              DoT эффектов\n- Интеграция с базовым уроном\n", "effect_system": "-
              Управление визуальными эффектами стихий\n- Синхронизация эффектов между
              клиентами\n- Управление длительностью и стаками эффектов\n- Оптимизация
              рендеринга эффектов\n", "environment_system": "- Получение данных об
              окружающей среде\n- Применение модификаторов окружения\n- Создание динамических
              эффектов окружения\n- Управление зонами эффектов\n"}}, "technical_specification":
              {"subtasks": [{"id": "elemental-effect-manager", "title": "Реализация
              менеджера стихийных эффектов", "description": "Реализация Elemental
              Effect Manager с маршрутизацией эффектов\nпо типам и координацией всех
              компонентов.\n", "dependencies": [], "estimated_effort": "4 days"},
              {"id": "fire-effect-processor", "title": "Реализация процессора огненных
              эффектов", "description": "Реализация Fire Effect Processor с логикой
              горения,\nраспространения и взаимодействия с другими стихиями.\n", "dependencies":
              ["elemental-effect-manager"], "estimated_effort": "3 days"}, {"id":
              "ice-effect-processor", "title": "Реализация процессора ледяных эффектов",
              "description": "Реализация Ice Effect Processor с логикой замедления,\nзаморозки
              и взаимодействия с теплом.\n", "dependencies": ["elemental-effect-manager"],
              "estimated_effort": "3 days"}, {"id": "poison-effect-processor", "title":
              "Реализация процессора ядовитых эффектов", "description": "Реализация
              Poison Effect Processor с логикой накопления,\nраспространения и электрических
              взаимодействий.\n", "dependencies": ["elemental-effect-manager"], "estimated_effort":
              "3 days"}, {"id": "acid-effect-processor", "title": "Реализация процессора
              кислотных эффектов", "description": "Реализация Acid Effect Processor
              с логикой коррозии,\nповреждения поверхностей и водных взаимодействий.\n",
              "dependencies": ["elemental-effect-manager"], "estimated_effort": "3
              days"}, {"id": "elemental-interaction-calculator", "title": "Реализация
              калькулятора взаимодействий стихий", "description": "Реализация Elemental
              Interaction Calculator с правилами\nвзаимодействия между всеми типами
              стихий.\n", "dependencies": ["elemental-effect-manager"], "estimated_effort":
              "4 days"}, {"id": "environmental-effect-integrator", "title": "Реализация
              интегратора эффектов окружения", "description": "Реализация Environmental
              Effect Integrator с логикой\nвзаимодействия стихий с окружающей средой.\n",
              "dependencies": ["elemental-interaction-calculator"], "estimated_effort":
              "3 days"}, {"id": "elemental-damage-calculator", "title": "Реализация
              калькулятора стихийного урона", "description": "Реализация Elemental
              Damage Calculator с расчетом\nурона, сопротивлений и модификаторов.\n",
              "dependencies": ["elemental-effect-manager"], "estimated_effort": "3
              days"}, {"id": "elemental-effect-visualizer", "title": "Реализация визуализатора
              эффектов", "description": ""}]}}'
        - column:
            name: metadata
            value: '{"id": "weapon-elemental-effects-architecture", "title": "Архитектура
              системы стихийных эффектов оружия", "document_type": "architecture",
              "category": "combat", "status": "draft", "version": "1.1.0", "last_updated":
              "2025-12-07T00:15:00+00:00", "owners": [{"role": "architect", "contact":
              "architect@necp.game"}], "tags": ["architecture", "combat", "weapons",
              "elemental", "effects"], "related_systems": ["weapon-system", "combat-engine",
              "effect-system", "damage-system"], "related_documents": [{"id": "weapon-special-mechanics-working",
              "relation": "implements"}], "github_issue": 1556, "visibility": "internal",
              "audience": ["architect", "backend", "gameplay", "api-designer"]}'
        - column:
            name: source_file
            value: knowledge\implementation\architecture\weapon-elemental-effects-architecture-part1.yaml
