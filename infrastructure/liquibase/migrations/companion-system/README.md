# Companion System Database Schema

–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ –≤ NECPGAME.

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ –≤–∫–ª—é—á–∞–µ—Ç –±–æ–µ–≤—ã—Ö –¥—Ä–æ–Ω–æ–≤, —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã—Ö –ø–æ–º–æ—â–Ω–∏–∫–æ–≤, –ø–∏—Ç–æ–º—Ü–µ–≤ –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- –ö–∞—Ç–∞–ª–æ–≥ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ –∏ –∏—Ö —à–∞–±–ª–æ–Ω–æ–≤
- –í–ª–∞–¥–µ–Ω–∏–µ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—é –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
- –°–∏—Å—Ç–µ–º—É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—é –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **–ö–∞—Ç–∞–ª–æ–≥** (`companion_types`, `companion_templates`) - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
2. **–í–ª–∞–¥–µ–Ω–∏–µ** (`character_companions`, `companion_inventory_slots`) - –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º
3. **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è** (`companion_levels`, `companion_experience_events`) - –£—Ä–æ–≤–Ω–∏ –∏ –æ–ø—ã—Ç
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (`companion_stats`) - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
5. **–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏** (`companion_abilities`, `companion_unlocked_abilities`) - –ù–∞–≤—ã–∫–∏ –∏ —É–º–µ–Ω–∏—è
6. **–≠—Ñ—Ñ–µ–∫—Ç—ã** (`companion_active_effects`) - –ê–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ñ—Ñ—ã/–¥–µ–±–∞—Ñ—Ñ—ã
7. **–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è** (`companion_customizations`) - –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
8. **–¢–µ–ª–µ–º–µ—Ç—Ä–∏—è** (`companion_telemetry`, `companion_performance_metrics`) - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üìä –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü

### –ö–∞—Ç–∞–ª–æ–≥ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤

```sql
-- –¢–∏–ø—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ (–±–æ–µ–≤—ã–µ –¥—Ä–æ–Ω—ã, –ø–∏—Ç–æ–º—Ü—ã –∏ —Ç.–¥.)
companion_types
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ type_key (VARCHAR UNIQUE) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á —Ç–∏–ø–∞
‚îú‚îÄ‚îÄ name, description (VARCHAR/TEXT)
‚îú‚îÄ‚îÄ category ('combat_drone', 'utility', 'pet', 'vehicle')
‚îú‚îÄ‚îÄ rarity ('common', 'uncommon', 'rare', 'epic', 'legendary')
‚îú‚îÄ‚îÄ purchase_cost, currency_type
‚îî‚îÄ‚îÄ is_enabled, is_purchasable

-- –®–∞–±–ª–æ–Ω—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Ç–∏–ø–æ–≤)
companion_templates
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ companion_type_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ template_key (VARCHAR UNIQUE)
‚îú‚îÄ‚îÄ base_stats (JSONB) - –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
‚îú‚îÄ‚îÄ appearance_data (JSONB) - –¥–∞–Ω–Ω—ã–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
‚îî‚îÄ‚îÄ is_default (BOOLEAN)
```

### –í–ª–∞–¥–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞–º–∏

```sql
-- –ö–æ–º–ø–∞–Ω—å–æ–Ω—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
character_companions
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_id (BIGINT) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
‚îú‚îÄ‚îÄ companion_template_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ custom_name (VARCHAR)
‚îú‚îÄ‚îÄ current_level, current_experience
‚îú‚îÄ‚îÄ is_active, is_locked
‚îú‚îÄ‚îÄ acquired_at, last_used_at
‚îî‚îÄ‚îÄ UNIQUE(character_id, companion_template_id)

-- –°–ª–æ—Ç—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
companion_inventory_slots
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_id (BIGINT)
‚îú‚îÄ‚îÄ slot_number (INTEGER)
‚îú‚îÄ‚îÄ companion_id (FOREIGN KEY REFERENCES character_companions)
‚îî‚îÄ‚îÄ is_unlocked (BOOLEAN)
```

### –ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è –∏ –æ–ø—ã—Ç

```sql
-- –£—Ä–æ–≤–Ω–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
companion_levels
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ companion_template_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ level (INTEGER)
‚îú‚îÄ‚îÄ experience_required (BIGINT)
‚îú‚îÄ‚îÄ stat_multipliers (JSONB) - –±–æ–Ω—É—Å—ã –∫ —Å—Ç–∞—Ç–∞–º
‚îî‚îÄ‚îÄ unlock_abilities (JSONB) - —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

-- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–ø—ã—Ç–∞
companion_experience_sources
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ source_key (VARCHAR UNIQUE)
‚îú‚îÄ‚îÄ name, description
‚îú‚îÄ‚îÄ experience_multiplier (DECIMAL)
‚îî‚îÄ‚îÄ is_enabled

-- –°–æ–±—ã—Ç–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—ã—Ç–∞
companion_experience_events
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ experience_source_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ experience_gained (BIGINT)
‚îú‚îÄ‚îÄ event_data (JSONB)
‚îî‚îÄ‚îÄ gained_at (TIMESTAMP)
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
companion_stats
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ stat_key (VARCHAR) - 'health', 'damage', 'armor' –∏ —Ç.–¥.
‚îú‚îÄ‚îÄ base_value, bonus_value, multiplier
‚îú‚îÄ‚îÄ final_value (GENERATED) - —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–µ –∏—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ updated_at (TIMESTAMP)

-- –ö–∞—Ç–∞–ª–æ–≥ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
companion_abilities
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ ability_key (VARCHAR UNIQUE)
‚îú‚îÄ‚îÄ name, description, type ('active', 'passive', 'toggle')
‚îú‚îÄ‚îÄ category ('attack', 'defense', 'support', 'utility')
‚îú‚îÄ‚îÄ cooldown_seconds, energy_cost, range, duration_seconds
‚îú‚îÄ‚îÄ effect_data (JSONB)
‚îî‚îÄ‚îÄ is_enabled

-- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
companion_unlocked_abilities
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ companion_ability_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ is_equipped, equipment_slot (1-4)
‚îú‚îÄ‚îÄ unlocked_at
‚îî‚îÄ‚îÄ UNIQUE(character_companion_id, companion_ability_id)

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
companion_ability_usage
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ companion_ability_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ used_at, energy_consumed
‚îú‚îÄ‚îÄ target_data, effect_data (JSONB)
```

### –≠—Ñ—Ñ–µ–∫—Ç—ã –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

```sql
-- –ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
companion_active_effects
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ effect_type, effect_key
‚îú‚îÄ‚îÄ source_type, source_id
‚îú‚îÄ‚îÄ effect_data (JSONB), stacks (INTEGER)
‚îú‚îÄ‚îÄ applied_at, expires_at (GENERATED)
‚îî‚îÄ‚îÄ UNIQUE(character_companion_id, effect_key, source_type, source_id)

-- –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
companion_customizations
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ customization_type ('color', 'pattern', 'accessory', 'effect')
‚îú‚îÄ‚îÄ customization_key, customization_value (JSONB)
‚îî‚îÄ‚îÄ is_active, applied_at
```

### –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

```sql
-- –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
companion_telemetry
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_id, character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ event_type ('summon', 'dismiss', 'ability_used', 'level_up')
‚îú‚îÄ‚îÄ event_data, session_id (JSONB, VARCHAR)
‚îú‚îÄ‚îÄ location_data (JSONB)
‚îî‚îÄ‚îÄ timestamp

-- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
companion_performance_metrics
‚îú‚îÄ‚îÄ id (BIGSERIAL PRIMARY KEY)
‚îú‚îÄ‚îÄ character_companion_id (FOREIGN KEY)
‚îú‚îÄ‚îÄ metric_type ('damage_dealt', 'damage_taken', 'kills', 'deaths')
‚îú‚îÄ‚îÄ metric_value (BIGINT)
‚îú‚îÄ‚îÄ time_period_start, time_period_end
‚îú‚îÄ‚îÄ context_data (JSONB)
```

## üîç –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ò–Ω–¥–µ–∫—Å—ã

- **–°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–æ–ª–µ–π
- **–ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö/–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- **–ò–Ω–¥–µ–∫—Å—ã –ø–æ –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–∞–º** –¥–ª—è JOIN –æ–ø–µ—Ä–∞—Ü–∏–π
- **GIN –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è JSONB –ø–æ–ª–µ–π

### –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
companion_usage_stats

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
companion_ability_usage_stats

-- –°–≤–æ–¥–∫–∞ –ø–æ –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
character_companion_summary
```

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞
get_companion_stats(companion_id BIGINT)

-- –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ —É—Ä–æ–≤–Ω—è
calculate_companion_level_progress(companion_id BIGINT)

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
get_active_companion_effects(companion_id BIGINT)
```

### –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–¢–µ–ª–µ–º–µ—Ç—Ä–∏—è** –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏–∏

### V001 - –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ö–µ–º—ã —Å–æ –≤—Å–µ–º–∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.

### V002 - –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
- –¢–∏–ø—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ (–±–æ–µ–≤—ã–µ –¥—Ä–æ–Ω—ã, –ø–∏—Ç–æ–º—Ü—ã, —É—Ç–∏–ª–∏—Ç—ã)
- –®–∞–±–ª–æ–Ω—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ —Å –±–∞–∑–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è —É—Ä–æ–≤–Ω–µ–π

### V003 - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

```sql
-- –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
SELECT cleanup_expired_companion_effects();

-- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
SELECT archive_old_companion_telemetry(90);

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
SELECT refresh_companion_analytics();
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π

## üîß API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
SELECT * FROM character_companions WHERE character_id = ?;

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞
SELECT * FROM character_companions WHERE character_id = ? AND is_active = true;

-- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞
SELECT * FROM get_companion_stats(?);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
SELECT ca.* FROM companion_unlocked_abilities cua
JOIN companion_abilities ca ON ca.id = cua.companion_ability_id
WHERE cua.character_companion_id = ? AND cua.is_equipped = true;
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î —Å CHECK constraints
- **RLS (Row Level Security)** –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- **–ê—É–¥–∏—Ç** –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤** –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π** –≤ –±–æ—é
- **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è –∏–≥—Ä–æ–∫–æ–≤** —Å –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞–º–∏
- **–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å** –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤

### –û—Ç—á–µ—Ç—ã

- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏
- –ú–µ—Å—è—á–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏

## üîÑ –ë—É–¥—É—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ì–∏–ª—å–¥–∏–∏ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤** - —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã
- **–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤** - –≥–µ–Ω–µ—Ç–∏–∫–∞ –∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
- **–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã** - –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≥—Ä—É–ø–ø—É
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Å—Ç–∏–ª—å –∏–≥—Ä—ã

–≠—Ç–∞ —Å—Ö–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—É—é –±–∞–∑—É –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–≤ –≤ NECPGAME.
