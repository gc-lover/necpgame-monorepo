-- Issue: #50
-- Import dialogue from: npc-sara-miller.yaml
-- Version: 1.1.0
-- Generated: 2025-12-14T16:03:08.336075
-- WARNING  WARNING: Requires 'dialogue_nodes' table (create via Database agent)

BEGIN;

-- Dialogue: canon-narrative-dialogue-sara-miller
INSERT INTO narrative.dialogue_nodes (dialogue_id, title, content_data, version, is_active) VALUES ('canon-narrative-dialogue-sara-miller', 'Диалоги — Сара Миллер', '{"metadata": {"id": "canon-narrative-dialogue-sara-miller", "title": "Диалоги — Сара Миллер", "document_type": "canon", "category": "narrative", "status": "approved", "version": "1.1.0", "last_updated": "2025-11-11T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "2025-11-07T17:05:00+00:00", "owners": [{"role": "narrative_director", "contact": "narrative@necp.game"}], "tags": ["dialogue", "ncpd"], "topics": ["narrative", "law-enforcement"], "related_systems": ["narrative-service", "world-service", "social-service"], "related_documents": [{"id": "canon-npc-sara-miller", "relation": "references"}, {"id": "canon-quests-side-ncpd-patrol-chain", "relation": "complements"}, {"id": "canon-quests-main-002-choose-path", "relation": "references"}], "source": "shared/docs/knowledge/canon/narrative/dialogues/npc-sara-miller.md", "visibility": "internal", "audience": ["narrative", "systems-design", "liveops"], "risk_level": "medium"}, "review": {"chain": [{"role": "narrative_director", "reviewer": "Law Narrative Cell", "reviewed_at": "2025-11-07T17:05:00+00:00", "status": "approved"}], "next_actions": []}, "summary": {"problem": "Диалог офицера NCPD Сары Миллер находился в Markdown и не был приведён к стандартной структуре знаний для интеграции с сервисами.", "goal": "Стандартизировать состояния NCPD (base, trusted, disciplinary, emergency), проверки и события для narrative-service и системы инфракций.", "essence": "Документ покрывает собеседование, доверенные задачи, дисциплинарные слушания и чрезвычайные приказы NCPD.", "key_points": ["Состояния base, trusted, disciplinary и emergency управляются репутацией `rep.law.ncpd`, флагами инфракций и событием `world.event.city_emergency`.", "Узлы `interview`, `trusted-brief`, `disciplinary-review` и `emergency-command` описывают проверки, штрафы, выдачу контрактов и запуск эвентов Amber.", "Проверки Persuasion, Awareness, Logic, Deception и Resolve определяют получение значка, штрафы, отстранение и запуск emergency-response."]}, "content": {"sections": [{"id": "context", "title": "Контекст и роль NCPD", "body": "Сара Миллер контролирует набор оперативников NCPD, проверяет дисциплину и распределяет патрули, расследования и\\nреакцию на чрезвычайные ситуации. Диалог отражает строгую вертикаль и последствия инфракций.\\n", "mechanics_links": [], "assets": []}, {"id": "states", "title": "Состояния и условия", "body": "Состояния base, trusted, disciplinary и emergency активируются диапазонами `rep.law.ncpd`, флагами `flag.ncpd.badge`\\nи `flag.ncpd.infraction_points`, а также событием `world.event.city_emergency`.\\n", "mechanics_links": ["../../02-gameplay/social/reputation-formulas.md", "../../02-gameplay/world/events/world-events-framework.md"], "assets": []}, {"id": "dialogue_nodes", "title": "Основные узлы", "body": "Узлы `interview`, `trusted-brief`, `disciplinary-review` и `emergency-command` задают проверки, выдачу контрактов\\n(`ncpd-patrol-dt12`, `ncpd-cybercrime-taskforce`), сбор штрафов и запуск эвента `ncpd-emergency-response`.\\n", "mechanics_links": [], "assets": []}, {"id": "checks", "title": "Проверки и дисциплина", "body": "Таблица проверок описывает Persuasion, Awareness, Logic, Deception и Resolve с критическими исходами: быстрый кейс,\\nсмарт-дрон, внутреннее расследование или отстранение до 7200 секунд.\\n", "mechanics_links": [], "assets": []}, {"id": "events", "title": "Реакции на события", "body": "При `world.event.city_emergency` активируется ветка Amber, увеличивая приоритет эвакуации. Инфракции управляются\\nфлагами, снижают доверие и могут вызвать suspension.\\n", "mechanics_links": [], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Удачные проверки дают значок NCPD, контракты патруля и расследования, смарт-дроны и репутацию. Провалы добавляют\\nинфракции, штрафы и возможное отстранение, а события определяют влияние на `rep.gang.valentinos`.\\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary": [], "references": [{"title": "NCPD Patrol Chain", "link": "../quests/side/ncpd-patrol-chain.md"}, {"title": "Reputation Formulas", "link": "../../02-gameplay/social/reputation-formulas.md"}, {"title": "City Emergency Event", "link": "../../02-gameplay/world/events/world-events-framework.md"}], "decisions": []}, "implementation": {"needs_task": false, "github_issue": 107, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"], "blockers": []}, "history": [{"version": "1.1.0", "date": "2025-11-11", "author": "narrative_team", "changes": "Диалог Сары Миллер перенесён в YAML, добавлены состояния, дисциплинарные проверки и события Amber."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (dialogue_id) DO UPDATE SET title = EXCLUDED.title, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 dialogue