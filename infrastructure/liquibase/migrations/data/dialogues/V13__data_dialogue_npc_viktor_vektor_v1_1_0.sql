-- Issue: #50
-- Import dialogue from: npc-viktor-vektor.yaml
-- Version: 1.1.0
-- Generated: 2025-12-06T21:13:01.272830
-- WARNING  WARNING: Requires 'dialogue_nodes' table (create via Database agent)

BEGIN;

-- Dialogue: canon-narrative-dialogue-viktor-vektor
INSERT INTO narrative.dialogue_nodes (dialogue_id, title, content_data, version, is_active) VALUES ('canon-narrative-dialogue-viktor-vektor', 'Диалоги — Виктор Вектор', '{"metadata": {"id": "canon-narrative-dialogue-viktor-vektor", "title": "Диалоги — Виктор Вектор", "document_type": "canon", "category": "narrative", "status": "approved", "version": "1.1.0", "last_updated": "2025-11-11T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "2025-11-07T18:05:00+00:00", "owners": [{"role": "narrative_director", "contact": "narrative@necp.game"}], "tags": ["dialogue", "ripperdoc"], "topics": ["narrative", "medical"], "related_systems": ["narrative-service", "world-service", "social-service"], "related_documents": [{"id": "canon-npc-viktor-vektor", "relation": "references"}, {"id": "canon-quests-side-medical-balance-chain", "relation": "complements"}, {"id": "canon-mechanics-combat-cyberpsychosis", "relation": "references"}], "source": "shared/docs/knowledge/canon/narrative/dialogues/npc-viktor-vektor.md", "visibility": "internal", "audience": ["narrative", "systems-design", "liveops"], "risk_level": "medium"}, "review": {"chain": [{"role": "narrative_director", "reviewer": "Medical Narrative Cell", "reviewed_at": "2025-11-07T18:05:00+00:00", "status": "approved"}], "next_actions": []}, "summary": {"problem": "Диалог риппердока Виктора Вектора существовал в Markdown и не был приведён к стандартному формату знаний для интеграции с сервисами здоровья и романтики.", "goal": "Структурировать состояния, проверки и реакции на киберпсихоз, чтобы облегчить экспорт в narrative-service и связку с medical-телеметрией.", "essence": "Документ фиксирует intake, steady, emergency и romance ветви Виктора, включая проверки Technical, Insight, Willpower и Empathy с выдачей имплантов и стабилизаторов.", "key_points": ["Состояния intake, steady, emergency и romance-consult управляются репутацией `rep.med.viktor`, стадией киберпсихоза и активностью романтических флагов.", "Узлы охватывают диагностику, апгрейды имплантов, стабилизацию психоза и советы по отношениям для Hanako и Judy.", "Проверки влияют на флаги пациента, выдачу предметов (`medkit`, `psycho-stabilizer`) и корректируют стадию киберпсихоза."]}, "content": {"sections": [{"id": "context", "title": "Контекст и роль Виктора", "body": "Виктор Вектор обслуживает игроков как независимый риппердок Downtown, контролируя импланты, здоровье и симптомы\\nкиберпсихоза, а также даёт советы по романтическим линиям. Диалог реагирует на события медкризиса и всплески Blackwall.\\n", "mechanics_links": ["../../02-gameplay/combat/combat-cyberpsychosis.md"], "assets": []}, {"id": "states", "title": "Состояния и триггеры", "body": "Состояния intake, steady, emergency и romance-consult активируются первичным посещением, репутацией `rep.med.viktor`,\\nстадией `flag.cyberpsychosis.stage` и флагом `flag.romance.active`. Emergency ветка снижает риск психоза и\\nвыдаёт стабилизаторы.\\n", "mechanics_links": ["../../02-gameplay/social/reputation-formulas.md"], "assets": []}, {"id": "dialogue_flow", "title": "Узлы и ключевые опции", "body": "Узлы `intake-check`, `steady-upgrade`, `emergency-stabilize` и `romance-consult` описывают опции игрока, требования\\nпроверок и последствия: установка имплантов, снятие дебаффов, снижение стадии психоза и выдачу советов по романтике.\\n", "mechanics_links": [], "assets": []}, {"id": "checks", "title": "Проверки и исходы", "body": "Таблица проверок покрывает Technical, Insight, Willpower и Empathy с модификаторами (класс Techie, стабилизаторы,\\nромантические флаги). Успехи увеличивают репутацию и открывают предметы, провалы вызывают судороги, перегрузку или\\nрост стадии психоза.\\n", "mechanics_links": [], "assets": []}, {"id": "events", "title": "Реакции на внешние события", "body": "Диалог пересчитывает DC и доступность веток при `world.event.med_crisis` и `world.event.blackwall_breach`, обеспечивая\\nскидки и снижение порогов стабилизации.\\n", "mechanics_links": ["../../02-gameplay/world/events/world-events-framework.md"], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Игроки получают репутацию `rep.med.viktor`, предметы `viktor-kinetic-shield`, `viktor-neuro-damper`, `psycho-stabilizer`\\nи советы для романтических линий, а также обновляют флаги лояльности и стадию психоза.\\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary": [], "references": [{"title": "Viktor Viktor Lore", "link": "../npc-lore/important/viktor-vektor.md"}, {"title": "Medical Balance Chain", "link": "../quests/side/medical-balance-chain.md"}, {"title": "Combat Cyberpsychosis Mechanics", "link": "../../02-gameplay/combat/combat-cyberpsychosis.md"}], "decisions": []}, "implementation": {"needs_task": false, "github_issue": 106, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"], "blockers": []}, "history": [{"version": "1.1.0", "date": "2025-11-11", "author": "narrative_team", "changes": "Диалог Виктора Вектора перенесён в YAML, структурированы состояния intake, steady, emergency и romance."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (dialogue_id) DO UPDATE SET title = EXCLUDED.title, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 dialogue