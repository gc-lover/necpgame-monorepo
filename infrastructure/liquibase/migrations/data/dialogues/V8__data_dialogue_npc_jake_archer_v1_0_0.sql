-- Issue: #50
-- Import dialogue from: npc-jake-archer.yaml
-- Version: 1.0.0
-- Generated: 2025-12-21T02:15:38.978910
-- [WARNING]  WARNING: Requires 'dialogue_nodes' table (create via Database agent)

BEGIN;

-- Dialogue: dialogue-npc-jake-archer
INSERT INTO narrative.dialogue_nodes (dialogue_id, title, content_data, version, is_active)
VALUES ('dialogue-npc-jake-archer', 'Диалог Джейка Арчера',
        '{"metadata": {"id": "dialogue-npc-jake-archer", "title": "Диалог Джейка Арчера", "document_type": "canon", "category": "dialogue", "status": "approved", "version": "1.0.0", "last_updated": "2025-11-12T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}], "tags": ["npc", "trade", "dialogue"], "topics": ["economy", "branching-dialogues"], "related_systems": ["narrative-service", "economy-service"], "related_documents": [{"id": "npc-lore-jake-archer", "relation": "references"}, {"id": "mechanics-economy-trading", "relation": "supports"}], "source": "shared/docs/knowledge/canon/narrative/dialogues/npc-jake-archer.md", "visibility": "internal", "audience": ["concept", "economy"], "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Диалог торговца Джейка Арчера содержался в Markdown и не был приведён к стандарту знаний.", "goal": "Структурировать состояния, скидки и кризисные ветки торгового NPC для интеграции с экономическими сервисами.", "essence": "Джейк управляет скидками, корпоративными контрактами и логистическими кризисами, адаптируя предложения по репутации.", "key_points": ["Состояния market-entry, preferred-client, corporate-sponsor и supply-chain-crisis зависят от репутаций и мировых событий.", "Узлы handshake, preferred-catalog, corporate-brief и crisis-routing охватывают скидки, скрытые товары и логистику.", "Диалог подключён к системе контрактов, выдаёт активности доставки и реагирует на эвенты Blackwall и забастовок."]}, "content": {"sections": [{"id": "context", "title": "Контекст", "body": "Джейк Арчер — независимый торговец Downtown Market. Диалог раскрывает его роль поставщика с гибкой системой\\nскидок и связями с корпорациями и Nomad-кланами.\\n", "mechanics_links": ["mechanics/economy/economy-trading.yaml"], "assets": []}, {"id": "states", "title": "Состояния и зависимости", "body": "Репутация `rep.traders.jake` и флаги `flag.jake.preferred`, `flag.jake.corporate`, `flag.jake.crisis`\\nпереключают диалоговые ветви. События `world.event.logistics_strike` и `world.event.blackwall_breach`\\nинициируют сценарии кризиса поставок.\\n", "mechanics_links": ["mechanics/world/world-state/player-impact-systems.yaml"], "assets": []}, {"id": "structure", "title": "Узлы и проверки", "body": "Проверки Negotiation, Insight, Streetwise, Technical и Hacking определяют скидки, доступ к экзотике,\\nвыдачу контрактов и решение кризисов. Ветви включают выдачу активностей и возможные засады Tyger Claws.\\n", "mechanics_links": ["mechanics/narrative/quest-system.yaml"], "assets": []}, {"id": "integrations", "title": "Интеграции и сервисы", "body": "Диалог экспортируется в narrative-service и economy-service. REST/GraphQL эндпоинты управляют\\nпроверками и активностями, а симуляция `dialogue-simulator.ps1 -Scenario trader-jake` поддерживает тесты.\\n", "mechanics_links": [], "assets": []}, {"id": "outcomes", "title": "Экономические эффекты", "body": "Репутация торговца меняется в диапазоне -20..+40, открываются магазины `jake-default` и `jake-exotics`,\\nконтракты `arasaka-supply-run` и `militech-salvage`, а также активности `delivery-night-shift` и\\n`blackwall-manifest-hack`.\\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation": {"needs_task": false, "github_issue": 107, "queue_reference": [], "blockers": []}, "history": [{"version": "1.0.0", "date": "2025-11-12", "author": "concept_director", "changes": "Конвертирован диалог Джейка Арчера в формат знаний с интеграцией экономических веток."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb,
        1, true) ON CONFLICT (dialogue_id) DO
UPDATE
    SET title = EXCLUDED.title, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 dialogue