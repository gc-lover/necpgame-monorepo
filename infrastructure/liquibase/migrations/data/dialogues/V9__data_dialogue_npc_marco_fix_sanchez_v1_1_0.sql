-- Issue: #50
-- Import dialogue from: npc-marco-fix-sanchez.yaml
-- Version: 1.1.0
-- Generated: 2025-12-14T16:03:08.320919
-- WARNING  WARNING: Requires 'dialogue_nodes' table (create via Database agent)

BEGIN;

-- Dialogue: canon-narrative-dialogue-marco-fix-sanchez
INSERT INTO narrative.dialogue_nodes (dialogue_id, title, content_data, version, is_active) VALUES ('canon-narrative-dialogue-marco-fix-sanchez', 'Диалоги — Марко «Фикс» Санчес', '{"metadata": {"id": "canon-narrative-dialogue-marco-fix-sanchez", "title": "Диалоги — Марко «Фикс» Санчес", "document_type": "canon", "category": "narrative", "status": "approved", "version": "1.1.0", "last_updated": "2025-11-11T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "2025-11-07T17:32:00+00:00", "owners": [{"role": "narrative_director", "contact": "narrative@necp.game"}], "tags": ["dialogue", "fixer"], "topics": ["narrative", "quests"], "related_systems": ["narrative-service", "social-service", "world-service"], "related_documents": [{"id": "canon-npc-marco-fix-sanchez", "relation": "references"}, {"id": "canon-quests-main-001-first-steps", "relation": "references"}, {"id": "canon-quests-main-002-choose-path", "relation": "complements"}], "source": "shared/docs/knowledge/canon/narrative/dialogues/npc-marco-fix-sanchez.md", "visibility": "internal", "audience": ["narrative", "systems-design", "liveops"], "risk_level": "medium"}, "review": {"chain": [{"role": "narrative_director", "reviewer": "Street Narrative Cell", "reviewed_at": "2025-11-07T17:32:00+00:00", "status": "approved"}], "next_actions": []}, "summary": {"problem": "Руководство по диалогам фикса Марко находилось в Markdown и не было синхронизировано с шаблоном знаний и системами контрактов.", "goal": "Стандартизировать состояния, проверки и реакции на события для onboarding фикса, выборов фракций и сценариев Blackwall.", "essence": "YAML фиксирует приветствия, ветки выбора корпораций/банд/фриланса, дисциплинарные последствия и реакции на Blackwall для narrative-service.", "key_points": ["Состояния base, trusted, hostile и blackwall-alert управляются репутацией `rep.fixers.marco`, флагами доверия и глобальными событиями.", "Узлы `intro`, `choose-path`, `betrayal` и `blackwall` описывают выдачу стартовых контрактов, последствия предательства и срочные задания.", "Проверки Perception, Persuasion, Intimidation, NetrunnerFocus и Negotiation регулируют скидки, контракты и активность containment."]}, "content": {"sections": [{"id": "context", "title": "Контекст и роль NPC", "body": "Марко «Фикс» Санчес — точка входа в Watson, помогает игроку выбрать корпорацию, банду или независимый путь,\\nреагируя на репутацию и глобальные события Blackwall. Он связывает стартовые квесты с экономикой контракта.\\n", "mechanics_links": [], "assets": []}, {"id": "states", "title": "Состояния и триггеры", "body": "Состояния base, trusted, hostile и blackwall-alert активируются диапазонами `rep.fixers.marco`, флагами\\n`flag.marco.*` и событием `world.blackwall_breach`. Hostile блокирует часть выбора, пока игрок не восстановит доверие.\\n", "mechanics_links": ["../../02-gameplay/social/reputation-formulas.md", "../../02-gameplay/world/events/blackwall/blackwall-breach.md"], "assets": []}, {"id": "dialogue_nodes", "title": "Основные узлы", "body": "Узлы `intro`, `choose-path`, `betrayal` и `blackwall` задают выдачу стартовых контрактов, проверок фракций,\\nдисциплинарных мер и реакций на Blackwall. Каждый исход обновляет флаги (`flag.marco.met`, `flag.marco.corp`,\\n`flag.marco.betrayal`) и репутацию.\\n", "mechanics_links": [], "assets": []}, {"id": "checks", "title": "Проверки и исходы", "body": "Таблица проверок описывает Perception, Persuasion, Intimidation, ClassChoice, Negotiation и NetrunnerFocus,\\nвключая модификаторы (корпоративный костюм, тату Valentinos, Blackwall-щит) и критические исходы (сейф-наводка,\\nскидки, события containment).\\n", "mechanics_links": [], "assets": []}, {"id": "integrations", "title": "API и интеграции", "body": "Диалог синхронизирован с REST/GraphQL эндпоинтами `/narrative/dialogues/marco-fix-sanchez`, поддерживает запуск\\nконтрактов `arasaka-entry`, `valentinos-trial`, `freelance-sprint` и ивента `blackwall-containment`.\\n", "mechanics_links": [], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Контракты изменяют `rep.fixers.marco`, открывают предметы (`corp-access-pass`, street pointers), влияют на\\nрепутации Arasaka и Valentinos и вызывают мировые события фракционных цепочек.\\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary": [], "references": [{"title": "Fixer Reputation Scale", "link": "../../02-gameplay/social/reputation-formulas.md"}, {"title": "Blackwall Breach Event", "link": "../../02-gameplay/world/events/blackwall/blackwall-breach.md"}, {"title": "First Steps Quest", "link": "../../content/quests/main/mq-001-first-steps.yaml"}], "decisions": []}, "implementation": {"needs_task": false, "github_issue": 107, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"], "blockers": []}, "history": [{"version": "1.1.0", "date": "2025-11-11", "author": "narrative_team", "changes": "Диалог Марко Санчеса перенесён в YAML с описанием состояний, проверок и событий Blackwall."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (dialogue_id) DO UPDATE SET title = EXCLUDED.title, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 dialogue