-- Issue: #50
-- Import quest from: america\sao-paulo\2020-2029\quest-002-traffic-nightmare.yaml
-- Generated: 2025-12-21T02:15:35.157275

BEGIN;

-- Quest: canon-quest-sao-paulo-traffic-nightmare
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES ('canon-quest-sao-paulo-traffic-nightmare', 'Сан-Паулу — Гонка в пробке', 'Игрок должен доставить донорское сердце 8-летней девочке через 300 км пробок Сан-Паулу за 30 минут, выбирая маршруты, уходя от конкурентов и преодолевая препятствия.', 'side', 20, NULL, '{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, '[{"id": "receive_organ_container", "text": "Получить термоконтейнер с донорским сердцем от BioMed Corp", "type": "interact", "target": "biomed_corp_hq", "count": 1, "optional": false}, {"id": "choose_route", "text": "Выбрать маршрут через пробки (между машин/тротуар/парк/метро)", "type": "choice", "target": "route_selection", "count": 1, "optional": false}, {"id": "overcome_police_barrier", "text": "Преодолеть полицейское перекрытие (разрешение/обман/метро)", "type": "choice", "target": "police_barrier", "count": 1, "optional": false}, {"id": "evade_competitors", "text": "Уйти от конкурентов на черном SUV (агрессивная езда/переулки/полиция)", "type": "choice", "target": "competitor_chase", "count": 1, "optional": false}, {"id": "deliver_to_hospital", "text": "Доставить сердце в госпиталь за 30 минут", "type": "interact", "target": "hospital_delivery_point", "count": 1, "optional": false, "time_limit": 1800}]'::jsonb, '{"experience": 5000, "money": 0, "items": [{"item_id": "achievement_life_saver", "quantity": 1}], "reputation": {"BioMed_Corp": 25}, "unlocks": ["emergency_delivery_quests", "biomed_reputation_system"], "time_bonus": {"experience": 10000, "condition": "< 20 minutes"}}'::jsonb, '[{"branch_id": "aggressive_driving", "description": "Агрессивная езда между машин", "consequences": {"skills": {"driving": 40}, "reputation": {"Traffic_Police": -10}, "risks": {"accident_chance": 0.3}}}, {"branch_id": "sidewalk_route", "description": "Маршрут по тротуару и переулкам", "consequences": {"skills": {"driving": 20, "navigation": 30}, "reputation": {"Pedestrians": -5}}}, {"branch_id": "metro_escape", "description": "Использование метро для обхода пробок", "consequences": {"skills": {"navigation": 50}, "time_saved": 600, "reputation": {"Metro_System": 10}}}]'::jsonb, '{"metadata": {"id": "canon-quest-sao-paulo-traffic-nightmare", "title": "Сан-Паулу — Гонка в пробке", "document_type": "canon", "category": "quest", "status": "approved", "version": "2.0.0", "last_updated": "2025-11-29T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "2025-11-11T15:48:30+00:00", "owners": [{"role": "narrative_team", "contact": "narrative@necp.game"}], "tags": ["sao_paulo", "traffic", "mobility"], "topics": ["transportation", "urban-life", "inequality"], "related_systems": ["driving-system", "real-time-timer-system", "chase-system", "skill-check-engine", "reputation-system", "quest-engine"], "related_documents": [{"id": "canon-quest-sao-paulo-mega-city", "relation": "follows"}, {"id": "github-issue-364", "title": "GitHub Issue", "link": "https://github.com/gc-lover/necpgame-monorepo/issues/364", "relation": "migrated_to", "migrated_at": "2025-11-22T21:10:00+00:00"}], "source": "shared/docs/knowledge/canon/lore/_03-lore/timeline-author/quests/america/sao-paulo/2020-2029/quest-002-traffic-nightmare.md", "visibility": "internal", "audience": ["lore", "narrative", "quest-design"], "risk_level": "medium"}, "review": {"chain": [{"role": "narrative_lead", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Квест time-critical доставки донорского сердца через пробки требует детализации механик времени, chase sequences и эмоциональных ставок.", "goal": "Создать полноценный контентный квест с real-time таймером, chase mechanics и интеграцией с системами вождения и времени.", "essence": "Игрок должен доставить донорское сердце 8-летней девочке через 300 км пробок Сан-Паулу за 30 минут, выбирая маршруты, уходя от конкурентов и преодолевая препятствия.", "key_points": ["Real-time timer (30 минут) с бонусами за скорость (< 20 минут = 10 000 XP).", {"Множественные маршруты": "между машин, по тротуару, через парк, метро."}, "Chase sequence с конкурентами на черном SUV.", {"Эмоциональные ставки": "жизнь ребенка на кону."}, "Driving skill checks (0.7-0.9 difficulty)."]}, "quest_definition": {"quest_type": "side", "level_min": 20, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "receive_organ_container", "text": "Получить термоконтейнер с донорским сердцем от BioMed Corp", "type": "interact", "target": "biomed_corp_hq", "count": 1, "optional": false}, {"id": "choose_route", "text": "Выбрать маршрут через пробки (между машин/тротуар/парк/метро)", "type": "choice", "target": "route_selection", "count": 1, "optional": false}, {"id": "overcome_police_barrier", "text": "Преодолеть полицейское перекрытие (разрешение/обман/метро)", "type": "choice", "target": "police_barrier", "count": 1, "optional": false}, {"id": "evade_competitors", "text": "Уйти от конкурентов на черном SUV (агрессивная езда/переулки/полиция)", "type": "choice", "target": "competitor_chase", "count": 1, "optional": false}, {"id": "deliver_to_hospital", "text": "Доставить сердце в госпиталь за 30 минут", "type": "interact", "target": "hospital_delivery_point", "count": 1, "optional": false, "time_limit": 1800}], "rewards": {"experience": 5000, "money": 0, "items": [{"item_id": "achievement_life_saver", "quantity": 1}], "reputation": {"BioMed_Corp": 25}, "unlocks": ["emergency_delivery_quests", "biomed_reputation_system"], "time_bonus": {"experience": 10000, "condition": "< 20 minutes"}}, "branches": [{"branch_id": "aggressive_driving", "description": "Агрессивная езда между машин", "consequences": {"skills": {"driving": 40}, "reputation": {"Traffic_Police": -10}, "risks": {"accident_chance": 0.3}}}, {"branch_id": "sidewalk_route", "description": "Маршрут по тротуару и переулкам", "consequences": {"skills": {"driving": 20, "navigation": 30}, "reputation": {"Pedestrians": -5}}}, {"branch_id": "metro_escape", "description": "Использование метро для обхода пробок", "consequences": {"skills": {"navigation": 50}, "time_saved": 600, "reputation": {"Metro_System": 10}}}]}, "content": {"sections": [{"id": "quest_profile", "title": "Параметры квеста", "body": "Тип: side quest (time-critical delivery). Сложность: hard. Формат: solo. Длительность: 30 минут реального времени.\\nНаграды: 5 000 XP (до 10 000 если < 20 минут), driving skill boost, ачивка «Спаситель жизни», репутация BioMed +25.\\n", "mechanics_links": [], "assets": []}, {"id": "stages", "title": "Этапы квеста", "body": "1. Получить термоконтейнер с донорским сердцем от BioMed Corp (8-летняя девочка ждет).\\n2. Выбрать маршрут через пробки: между машин, по тротуару, через парк, метро.\\n3. Преодолеть полицейское перекрытие: получить разрешение, обмануть, использовать метро.\\n4. Уйти от конкурентов на черном SUV: агрессивная езда, переулки, вызвать полицию.\\n5. Доставить сердце в госпиталь за 30 минут (бонус XP если < 20 минут).\\n", "mechanics_links": [], "assets": []}, {"id": "systems_hooks", "title": "Системные крючки", "body": "driving-system обрабатывает управление мотоциклом Yamaha MT-09, real-time-timer-system отслеживает время доставки (30 минут), chase-system управляет погоней конкурентов, skill-check-system проверяет навыки вождения (0.7-0.9 difficulty), reputation-system обновляет репутацию с BioMed Corp, Traffic Police и Pedestrians.\\n", "mechanics_links": [], "assets": []}, {"id": "regional_details", "title": "Региональные детали", "body": "Сан-Паулу 2028 — чемпион мира по пробкам. 300 км застывшего металла в час пик. BioMed Corp — служба экстренной доставки органов на мотоциклах. 30 минут или смерть пациента. Конкуренты готовы саботировать — большие деньги на кону. Клаксоны, выхлопы, 35°C жара. Chase sequence через весь город.\\n", "mechanics_links": [], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Базовые награды: 5 000 XP, ачивка «Спаситель жизни», репутация BioMed +25.\\nБонус за скорость: если доставка < 20 минут, дополнительно 10 000 XP.\\nDriving skill boost: +40 (агрессивная езда), +20 (тротуар), +50 navigation (метро).\\nВетвления влияют на репутацию: Traffic Police (-10 при агрессивной езде), Pedestrians (-5 при тротуаре), Metro System (+10 при использовании метро).\\nРиски: вероятность аварии 30% при агрессивной езде.\\n", "mechanics_links": [], "assets": []}, {"id": "emotional_stakes", "title": "Эмоциональные ставки", "body": "Жизнь 8-летней девочки на кону. Каждая секунда важна. Таймер показывает оставшееся время. Музыка становится напряженнее по мере приближения дедлайна. Успешная доставка — триумф, опоздание — трагедия.\\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary": [], "references": [{"title": "CET Traffic Index Report", "link": "https://www.prefeitura.sp.gov.br"}, {"title": "Helicopter Commute Statistics", "link": "https://www.reuters.com"}], "decisions": []}, "implementation": {"github_issue": 249, "needs_task": false, "queue_reference": ["shared/trackers/queues/concept/queued.yaml"], "blockers": []}, "history": [{"version": "2.0.0", "date": "2025-11-29", "author": "content_writer", "changes": "Добавлена полная структура quest_definition с objectives, rewards и branches. Детализирован контент согласно концепции \\"Гонка в пробке\\". Добавлены time-critical механики, chase sequences и эмоциональные ставки. Интеграция с системами вождения, таймера и погони."}, {"version": "1.1.0", "date": "2025-11-11", "author": "narrative_team", "changes": "Добавлены этапы, системные связи и последствия класса транспорта."}, {"version": "0.1.0", "date": "2025-11-09", "author": "narrative_team", "changes": "Markdown-описание транспортного кризиса Сан-Паулу."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest