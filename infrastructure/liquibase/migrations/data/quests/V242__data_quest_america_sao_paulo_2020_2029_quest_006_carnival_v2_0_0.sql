-- Issue: #50
-- Import quest from: america\sao-paulo\2020-2029\quest-006-carnival.yaml
-- Generated: 2025-12-21T02:15:35.196503

BEGIN;

-- Quest: canon-quest-sao-paulo-carnival
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES ('canon-quest-sao-paulo-carnival', 'Сан-Паулу — Маски и секреты', 'Игрок должен найти убийцу choreographer школы самбы Vai-Vai за 48 часов до конца карнавала: исследовать crime scene, опросить 5 suspects, проверить alibis, собрать DNA samples и принять решение о правосудии.', 'side', 25, NULL, '{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, '[{"id": "investigate_crime_scene", "text": "Исследовать crime scene (warehouse, удушение samba sash)", "type": "investigate", "target": "crime_scene_warehouse", "count": 1, "optional": false}, {"id": "interview_suspects", "text": "Опросить 5 suspects (rival choreographer, demoted dancer, bookie, ex-girlfriend, president)", "type": "interact", "target": "suspects_list", "count": 5, "optional": false}, {"id": "verify_alibis", "text": "Проверить alibis и найти inconsistencies", "type": "investigate", "target": "alibi_verification", "count": 5, "optional": false}, {"id": "collect_dna_samples", "text": "Собрать DNA samples скрытно на карнавале", "type": "collect", "target": "dna_evidence", "count": 5, "optional": false}, {"id": "identify_killer", "text": "Идентифицировать killer (президент Fernando Costa из любви к школе)", "type": "investigate", "target": "killer_identification", "count": 1, "optional": false}, {"id": "make_final_choice", "text": "Принять решение: арестовать сейчас/после performance/завтра/отпустить", "type": "choice", "target": "final_justice_choice", "count": 1, "optional": false, "time_limit": 172800}]'::jsonb, '{"experience": 3000, "money": 0, "items": [{"item_id": "achievement_merciful_justice", "quantity": 1}], "reputation": {}, "unlocks": ["detective_quests", "carnival_events"]}'::jsonb, '[{"branch_id": "arrest_now", "description": "Арестовать сейчас (карнавал испорчен)", "consequences": {"world_state": {"carnival_ruined": true, "killer_arrested": true}, "reputation": {"Samba_Schools": -30, "Police": 20}, "experience": 3000}}, {"branch_id": "arrest_after_performance", "description": "Арестовать после performance (баланс)", "consequences": {"world_state": {"carnival_completed": true, "killer_arrested": true}, "reputation": {"Samba_Schools": 10, "Police": 15}, "experience": 5000}}, {"branch_id": "arrest_tomorrow", "description": "Сдача завтра (лучший outcome)", "consequences": {"world_state": {"carnival_completed": true, "killer_arrested": true, "justice_delayed": true}, "reputation": {"Samba_Schools": 30, "Police": 10}, "experience": 8000}}, {"branch_id": "let_go", "description": "Отпустить (Fernando исчезает)", "consequences": {"world_state": {"killer_free": true, "justice_denied": true}, "reputation": {"Samba_Schools": 20, "Police": -20}, "experience": 3000}}]'::jsonb, '{"metadata": {"id": "canon-quest-sao-paulo-carnival", "title": "Сан-Паулу — Маски и секреты", "document_type": "canon", "category": "quest", "status": "approved", "version": "2.0.0", "last_updated": "2025-11-29T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "2025-11-11T15:50:30+00:00", "owners": [{"role": "narrative_team", "contact": "narrative@necp.game"}], "tags": ["sao_paulo", "carnival", "samba"], "topics": ["cultural-festivals", "mass-events", "nightlife"], "related_systems": ["detective-investigation-system", "alibi-verification-system", "dna-collection-system", "time-pressure-system", "carnival-crowd-navigation-system", "reputation-system", "moral-choice-system", "quest-engine"], "related_documents": [{"id": "canon-quest-sao-paulo-street-art", "relation": "complements"}, {"id": "github-issue-365", "title": "GitHub Issue", "link": "https://github.com/gc-lover/necpgame-monorepo/issues/365", "relation": "migrated_to", "migrated_at": "2025-11-22T21:10:00+00:00"}], "source": "shared/docs/knowledge/canon/lore/_03-lore/timeline-author/quests/america/sao-paulo/2020-2029/quest-006-carnival.md", "visibility": "internal", "audience": ["lore", "narrative", "quest-design"], "risk_level": "medium"}, "review": {"chain": [{"role": "narrative_lead", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Квест murder mystery во время карнавала требует детализации detective investigation mechanics, alibi verification, DNA evidence collection и time pressure.", "goal": "Создать полноценный контентный квест с детективными механиками, временным давлением (48 часов) и моральными выборами о правосудии vs милосердии.", "essence": "Игрок должен найти убийцу choreographer школы самбы Vai-Vai за 48 часов до конца карнавала: исследовать crime scene, опросить 5 suspects, проверить alibis, собрать DNA samples и принять решение о правосудии.", "key_points": ["Detective investigation system для сбора улик и опроса подозреваемых.", {"5 suspects": "rival choreographer, demoted dancer, bookie, ex-girlfriend, president."}, {"Time pressure": "48 часов до отъезда suspects."}, "DNA evidence collection скрытно на карнавале.", {"Моральный выбор": "арестовать сейчас/после performance/завтра/отпустить."}]}, "quest_definition": {"quest_type": "side", "level_min": 25, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "investigate_crime_scene", "text": "Исследовать crime scene (warehouse, удушение samba sash)", "type": "investigate", "target": "crime_scene_warehouse", "count": 1, "optional": false}, {"id": "interview_suspects", "text": "Опросить 5 suspects (rival choreographer, demoted dancer, bookie, ex-girlfriend, president)", "type": "interact", "target": "suspects_list", "count": 5, "optional": false}, {"id": "verify_alibis", "text": "Проверить alibis и найти inconsistencies", "type": "investigate", "target": "alibi_verification", "count": 5, "optional": false}, {"id": "collect_dna_samples", "text": "Собрать DNA samples скрытно на карнавале", "type": "collect", "target": "dna_evidence", "count": 5, "optional": false}, {"id": "identify_killer", "text": "Идентифицировать killer (президент Fernando Costa из любви к школе)", "type": "investigate", "target": "killer_identification", "count": 1, "optional": false}, {"id": "make_final_choice", "text": "Принять решение: арестовать сейчас/после performance/завтра/отпустить", "type": "choice", "target": "final_justice_choice", "count": 1, "optional": false, "time_limit": 172800}], "rewards": {"experience": 3000, "money": 0, "items": [{"item_id": "achievement_merciful_justice", "quantity": 1}], "reputation": {}, "unlocks": ["detective_quests", "carnival_events"]}, "branches": [{"branch_id": "arrest_now", "description": "Арестовать сейчас (карнавал испорчен)", "consequences": {"world_state": {"carnival_ruined": true, "killer_arrested": true}, "reputation": {"Samba_Schools": -30, "Police": 20}, "experience": 3000}}, {"branch_id": "arrest_after_performance", "description": "Арестовать после performance (баланс)", "consequences": {"world_state": {"carnival_completed": true, "killer_arrested": true}, "reputation": {"Samba_Schools": 10, "Police": 15}, "experience": 5000}}, {"branch_id": "arrest_tomorrow", "description": "Сдача завтра (лучший outcome)", "consequences": {"world_state": {"carnival_completed": true, "killer_arrested": true, "justice_delayed": true}, "reputation": {"Samba_Schools": 30, "Police": 10}, "experience": 8000}}, {"branch_id": "let_go", "description": "Отпустить (Fernando исчезает)", "consequences": {"world_state": {"killer_free": true, "justice_denied": true}, "reputation": {"Samba_Schools": 20, "Police": -20}, "experience": 3000}}]}, "content": {"sections": [{"id": "quest_profile", "title": "Параметры квеста", "body": "Тип: side quest (detective, murder mystery). Сложность: hard. Формат: solo. Длительность: 48 часов игрового времени.\\nНаграды: 3 000-8 000 XP (зависит от выбора), ачивка «Милосердное правосудие», репутация с Samba Schools и Police.\\n", "mechanics_links": [], "assets": []}, {"id": "stages", "title": "Этапы квеста", "body": "1. Исследовать crime scene: Rodrigo Mendes найден мертвым в warehouse, удушен samba sash. Сестра Carolina нанимает игрока.\\n2. Опросить 5 suspects: rival choreographer (конкуренция), demoted dancer (месть), bookie (долги), ex-girlfriend (ревность), president Fernando Costa (любовь к школе).\\n3. Проверить alibis и найти inconsistencies в показаниях.\\n4. Собрать DNA samples скрытно на карнавале (80,000 людей в масках).\\n5. Идентифицировать killer: президент Fernando Costa убил из любви к школе Vai-Vai.\\n6. Принять решение: арестовать сейчас (карнавал испорчен), после performance (баланс), завтра (лучший outcome), или отпустить (Fernando исчезает).\\n", "mechanics_links": [], "assets": []}, {"id": "systems_hooks", "title": "Системные крючки", "body": "detective-investigation-system обрабатывает сбор улик и опрос подозреваемых, alibi-verification-system проверяет показания, dna-collection-system управляет сбором образцов, time-pressure-system отслеживает 48-часовой лимит, carnival-crowd-navigation-system помогает перемещаться среди 80,000 людей в масках, reputation-system обновляет отношения с Samba_Schools/Police, moral-choice-system обрабатывает решения о правосудии vs милосердии.\\n", "mechanics_links": [], "assets": []}, {"id": "regional_details", "title": "Региональные детали", "body": "Carnaval de São Paulo — второй по величине в Бразилии. Sambódromo, samba schools, миллионы масок. Rodrigo Mendes, choreographer школы Vai-Vai, найден мертвым в warehouse, удушен samba sash. Полиция слишком занята карнавалом. Сестра Carolina нанимает тебя — 5 suspects, 48 часов до их отъезда. Президент Fernando Costa убил из любви к школе, чтобы защитить ее репутацию.\\n", "mechanics_links": [], "assets": []}, {"id": "suspects_details", "title": "Детали подозреваемых", "body": "Rival choreographer: конкуренция за позицию, но alibi подтвержден.\\nDemoted dancer: месть за увольнение, но не было доступа.\\nBookie: долги Rodrigo, но убийство не решает проблему.\\nEx-girlfriend: ревность, но alibi подтвержден.\\nPresident Fernando Costa: убил из любви к школе, чтобы защитить репутацию от скандала. Мотив: честь школы превыше всего.\\n", "mechanics_links": [], "assets": []}, {"id": "moral_choices", "title": "Моральные выборы и последствия", "body": "Арестовать сейчас: карнавал испорчен, но правосудие быстрое. Репутация: Samba Schools -30, Police +20. 3 000 XP.\\nАрестовать после performance: баланс между правосудием и уважением к традиции. Репутация: Samba Schools +10, Police +15. 5 000 XP.\\nСдача завтра: лучший outcome — карнавал завершен, правосудие отсрочено, но выполнено. Репутация: Samba Schools +30, Police +10. 8 000 XP.\\nОтпустить: Fernando исчезает, правосудие не свершилось, но школа защищена. Репутация: Samba Schools +20, Police -20. 3 000 XP.\\n", "mechanics_links": [], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Награды зависят от выбора: 3 000-8 000 XP, ачивка «Милосердное правосудие», репутация Samba Schools -30 до +30, Police -20 до +20.\\nWorld state изменяется: carnival_ruined/completed, killer_arrested/free, justice_delayed/denied в зависимости от выбора.\\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary": [], "references": [{"title": "Sambódromo do Anhembi Overview", "link": "https://www.prefeitura.sp.gov.br"}, {"title": "Blocos de Rua Statistics", "link": "https://www1.folha.uol.com.br"}], "decisions": []}, "implementation": {"github_issue": 249, "needs_task": false, "queue_reference": ["shared/trackers/queues/concept/queued.yaml#canon-quest-sao-paulo-carnival"], "blockers": []}, "history": [{"version": "2.0.0", "date": "2025-11-29", "author": "content_writer", "changes": "Добавлена полная структура quest_definition с objectives, rewards и branches. Детализирован контент согласно концепции \\"Маски и секреты\\". Добавлены detective investigation mechanics, alibi verification, DNA evidence collection, time pressure (48h) и моральные выборы о правосудии vs милосердии. Интеграция с системами детектива, времени и репутации."}, {"version": "0.1.0", "date": "2025-11-11", "author": "concept_director", "changes": "Конвертация квеста «Карнавал» в YAML и завершение цикла Concept Director."}, {"version": "0.1.0", "date": "2025-11-09", "author": "narrative_team", "changes": "Markdown-описание карнавала Сан-Паулу."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest