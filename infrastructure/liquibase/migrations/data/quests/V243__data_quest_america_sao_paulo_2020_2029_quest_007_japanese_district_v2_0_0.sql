-- Issue: #50
-- Import quest from: america\sao-paulo\2020-2029\quest-007-japanese-district.yaml
-- Generated: 2025-12-21T02:15:35.205884

BEGIN;

-- Quest: canon-quest-sao-paulo-japanese-district
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements,
                                        objectives, rewards, branches, content_data, version, is_active)
VALUES ('canon-quest-sao-paulo-japanese-district', 'Сан-Паулу — Между двумя мирами',
        'Игрок должен помочь семье Nakamura решить судьбу ресторана: принять предложение yakuza (500K за 40% ownership, но потеря чести), найти альтернативу (community fundraising, business pivot), или сохранить честь (но отец умирает от рака).',
        'side', 30, NULL,
        '{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb,
        '[{"id": "analyze_finances", "text": "Проанализировать финансы (долг 300K, revenue down 60%)", "type": "investigate", "target": "restaurant_finances", "count": 1, "optional": false}, {"id": "meet_yakuza_boss", "text": "Встретиться с yakuza boss Masato Sato", "type": "interact", "target": "masato_sato_npc", "count": 1, "optional": false}, {"id": "explore_alternatives", "text": "Исследовать альтернативы: community fundraising/business pivot/yakuza compromise/отказ", "type": "choice", "target": "alternative_analysis", "count": 1, "optional": false}, {"id": "make_final_decision", "text": "Принять решение о судьбе ресторана и семьи", "type": "choice", "target": "final_family_choice", "count": 1, "optional": false}]'::jsonb,
        '{"experience": 2000, "money": 0, "items": [{"item_id": "achievement_community_hero", "quantity": 1}, {"item_id": "achievement_unbreakable_honor", "quantity": 1}], "reputation": {}, "unlocks": ["japanese_diaspora_quests", "yakuza_relations"]}'::jsonb,
        '[{"branch_id": "community_fundraising", "description": "Community fundraising (50 businesses × 10K, очень сложный social challenge)", "consequences": {"world_state": {"father_saved": true, "honor_preserved": true, "community_united": true}, "reputation": {"Japanese_Community": 50, "Local_Businesses": 40}, "experience": 8000, "skill_requirement": {"social": 0.9}}}, {"branch_id": "business_pivot", "description": "Business pivot (fusion cuisine, delivery apps, модернизация)", "consequences": {"money": -100000, "world_state": {"restaurant_modernized": true, "father_saved": true, "honor_preserved": true}, "reputation": {"Entrepreneurs": 30, "Japanese_Community": 20}, "experience": 4000, "skill_requirement": {"business": 0.7}}}, {"branch_id": "yakuza_compromise", "description": "Yakuza compromise (25% ownership, строгие условия)", "consequences": {"money": 500000, "world_state": {"father_saved": true, "honor_compromised": true, "yakuza_influence": true}, "reputation": {"Yakuza": 20, "Japanese_Community": -10}, "experience": 3000}}, {"branch_id": "refuse_everything", "description": "Отказаться от всего (honour maintained, но отец умирает)", "consequences": {"world_state": {"father_died": true, "honor_preserved": true, "tragic_ending": true}, "reputation": {"Japanese_Community": 30, "Yakuza": -20}, "experience": 2000, "achievement": "unbreakable_honor"}}]'::jsonb,
        '{"metadata": {"id": "canon-quest-sao-paulo-japanese-district", "title": "Сан-Паулу — Между двумя мирами", "document_type": "canon", "category": "quest", "status": "approved", "version": "2.0.0", "last_updated": "2025-11-29T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "2025-11-11T15:51:00+00:00", "owners": [{"role": "narrative_team", "contact": "narrative@necp.game"}], "tags": ["sao_paulo", "diaspora", "cuisine"], "topics": ["cultural-districts", "community-life", "heritage"], "related_systems": ["financial-management-system", "yakuza-negotiation-system", "community-mobilization-system", "moral-dilemma-system", "reputation-system", "world-state-system", "skill-check-engine", "quest-engine"], "related_documents": [{"id": "canon-quest-sao-paulo-feijoada", "relation": "parallels"}, {"id": "github-issue-366", "title": "GitHub Issue", "link": "https://github.com/gc-lover/necpgame-monorepo/issues/366", "relation": "migrated_to", "migrated_at": "2025-11-22T21:30:00+00:00"}], "source": "shared/docs/knowledge/canon/lore/_03-lore/timeline-author/quests/america/sao-paulo/2020-2029/quest-007-japanese-district.md", "visibility": "internal", "audience": ["lore", "narrative", "quest-design"], "risk_level": "low"}, "review": {"chain": [{"role": "narrative_lead", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Квест семейной драмы вокруг Japanese-Brazilian ресторана требует детализации financial management, yakuza negotiation, community mobilization и моральных дилемм.", "goal": "Создать полноценный контентный квест с финансовыми механиками, переговорами с yakuza и выбором между честью и выживанием.", "essence": "Игрок должен помочь семье Nakamura решить судьбу ресторана: принять предложение yakuza (500K за 40% ownership, но потеря чести), найти альтернативу (community fundraising, business pivot), или сохранить честь (но отец умирает от рака).", "key_points": [{"Семейная драма": "дед Hiroshi (честь), отец Takeshi (рак, 200K лечение), внук Kenji (torn между традицией и прагматизмом)."}, {"Financial management": "долг 300K, revenue down 60%."}, {"Yakuza negotiation": "Sato-gumi предлагает 500K за 40% ownership."}, {"Community mobilization": "50 businesses × 10K (очень сложный social challenge)."}, {"Моральная дилемма": "отказаться — отец умрёт, принять — предать honour."}]}, "quest_definition": {"quest_type": "side", "level_min": 30, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "analyze_finances", "text": "Проанализировать финансы (долг 300K, revenue down 60%)", "type": "investigate", "target": "restaurant_finances", "count": 1, "optional": false}, {"id": "meet_yakuza_boss", "text": "Встретиться с yakuza boss Masato Sato", "type": "interact", "target": "masato_sato_npc", "count": 1, "optional": false}, {"id": "explore_alternatives", "text": "Исследовать альтернативы: community fundraising/business pivot/yakuza compromise/отказ", "type": "choice", "target": "alternative_analysis", "count": 1, "optional": false}, {"id": "make_final_decision", "text": "Принять решение о судьбе ресторана и семьи", "type": "choice", "target": "final_family_choice", "count": 1, "optional": false}], "rewards": {"experience": 2000, "money": 0, "items": [{"item_id": "achievement_community_hero", "quantity": 1}, {"item_id": "achievement_unbreakable_honor", "quantity": 1}], "reputation": {}, "unlocks": ["japanese_diaspora_quests", "yakuza_relations"]}, "branches": [{"branch_id": "community_fundraising", "description": "Community fundraising (50 businesses × 10K, очень сложный social challenge)", "consequences": {"world_state": {"father_saved": true, "honor_preserved": true, "community_united": true}, "reputation": {"Japanese_Community": 50, "Local_Businesses": 40}, "experience": 8000, "skill_requirement": {"social": 0.9}}}, {"branch_id": "business_pivot", "description": "Business pivot (fusion cuisine, delivery apps, модернизация)", "consequences": {"money": -100000, "world_state": {"restaurant_modernized": true, "father_saved": true, "honor_preserved": true}, "reputation": {"Entrepreneurs": 30, "Japanese_Community": 20}, "experience": 4000, "skill_requirement": {"business": 0.7}}}, {"branch_id": "yakuza_compromise", "description": "Yakuza compromise (25% ownership, строгие условия)", "consequences": {"money": 500000, "world_state": {"father_saved": true, "honor_compromised": true, "yakuza_influence": true}, "reputation": {"Yakuza": 20, "Japanese_Community": -10}, "experience": 3000}}, {"branch_id": "refuse_everything", "description": "Отказаться от всего (honour maintained, но отец умирает)", "consequences": {"world_state": {"father_died": true, "honor_preserved": true, "tragic_ending": true}, "reputation": {"Japanese_Community": 30, "Yakuza": -20}, "experience": 2000, "achievement": "unbreakable_honor"}}]}, "content": {"sections": [{"id": "quest_profile", "title": "Параметры квеста", "body": "Тип: side quest (family drama, moral dilemma). Сложность: extreme. Формат: solo. Длительность: 4-5 часов.\\nНаграды: 2 000-8 000 XP (зависит от выбора), ачивка «Герой сообщества» или «Несгибаемая честь», репутация с Japanese Community/Yakuza/Local Businesses.\\n", "mechanics_links": [], "assets": []}, {"id": "stages", "title": "Этапы квеста", "body": "1. Проанализировать финансы ресторана Nakamura: долг 300K, revenue down 60%, отец Takeshi умирает от рака (лечение 200K).\\n2. Встретиться с yakuza boss Masato Sato: предложение 500K за 40% ownership, превращение ресторана в money laundering front.\\n3. Исследовать альтернативы: community fundraising (50 businesses × 10K, social challenge 0.9), business pivot (fusion cuisine, delivery, модернизация), yakuza compromise (25% ownership), или отказаться (honour, но отец умирает).\\n4. Принять решение о судьбе ресторана и семьи, учитывая моральную дилемму между честью и выживанием.\\n", "mechanics_links": [], "assets": []}, {"id": "systems_hooks", "title": "Системные крючки", "body": "financial-management-system обрабатывает анализ долгов и доходов, yakuza-negotiation-system управляет переговорами с мафией, community-mobilization-system обрабатывает сбор средств (50 социальных проверок), moral-dilemma-system обрабатывает экстремально сложный выбор, reputation-system обновляет отношения с Japanese_Community/Yakuza/Local_Businesses, world-state-system фиксирует судьбу отца и чести семьи.\\n", "mechanics_links": [], "assets": []}, {"id": "regional_details", "title": "Региональные детали", "body": "Liberdade — крупнейшая Japanese diaspora вне Японии (1.5+ млн человек). Семья Nakamura: дед Hiroshi (первое поколение, честь превыше всего), отец Takeshi (рак, 200K реалов лечение), внук Kenji (torn между традицией и прагматизмом). Sato-gumi yakuza предлагает 500K за 40% ownership. Отказаться — отец умрёт. Принять — предать honour. Красные фонари, иероглифы, суши-бары, праздники. Аутентичная культура, но адаптированная к бразильскому темпераменту.\\n", "mechanics_links": [], "assets": []}, {"id": "family_drama", "title": "Семейная драма", "body": "Дед Hiroshi: \\"Честь превыше всего. Мы не станем частью yakuza.\\" (традиция, честь)\\nОтец Takeshi: \\"Я умру, если не получить лечение. 200K реалов.\\" (выживание)\\nВнук Kenji: \\"Мы должны найти способ сохранить и честь, и жизнь.\\" (компромисс)\\nИгрок должен помочь семье найти решение между честью и выживанием, либо принять трагическую судьбу.\\n", "mechanics_links": [], "assets": []}, {"id": "alternatives_details", "title": "Детали альтернатив", "body": "Community fundraising: 50 businesses × 10K = 500K. Очень сложный social challenge (skill 0.9). Сохраняет честь, спасает отца, объединяет community. 8 000 XP, репутация +50/+40.\\nBusiness pivot: Fusion cuisine, delivery apps, модернизация. Требует -100K инвестиций, business skill 0.7. Сохраняет честь и жизнь. 4 000 XP, репутация +30/+20.\\nYakuza compromise: 25% ownership вместо 40%, строгие условия. 500K денег, но честь скомпрометирована. Отец спасен. 3 000 XP, репутация +20/-10.\\nОтказаться: Honour maintained, но отец умирает. Трагический финал, но честь превыше всего. 2 000 XP, ачивка \\"Несгибаемая честь\\", репутация +30/-20.\\n", "mechanics_links": [], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Награды зависят от выбора: 2 000-8 000 XP, ачивка «Герой сообщества» (fundraising) или «Несгибаемая честь» (отказ), репутация Japanese Community +20 до +50, Yakuza -20 до +20.\\nWorld state изменяется: father_saved/died, honor_preserved/compromised, community_united, yakuza_influence, tragic_ending в зависимости от выбора.\\n", "mechanics_links": [], "assets": []}]}, "appendix": {"glossary": [], "references": [{"title": "Liberdade Neighborhood Guide", "link": "https://www.japaoemfoco.com"}, {"title": "Japanese Immigration Museum", "link": "https://www.bunkyo.org.br"}], "decisions": []}, "implementation": {"github_issue": 249, "needs_task": false, "queue_reference": ["shared/trackers/queues/concept/queued.yaml#canon-quest-sao-paulo-japanese-district"], "blockers": []}, "history": [{"version": "2.0.0", "date": "2025-11-29", "author": "content_writer", "changes": "Добавлена полная структура quest_definition с objectives, rewards и branches. Детализирован контент согласно концепции \\"Между двумя мирами\\". Добавлены financial management, yakuza negotiation, community mobilization (50 социальных проверок), моральная дилемма экстремальной сложности и множественные валидные окончания (включая трагическое). Интеграция с системами финансов, переговоров и world state."}, {"version": "0.1.0", "date": "2025-11-11", "author": "concept_director", "changes": "Конвертация квеста «Японский район» в YAML и завершение цикла Concept Director."}, {"version": "0.1.0", "date": "2025-11-09", "author": "narrative_team", "changes": "Markdown-описание района Liberdade."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb,
        1, true) ON CONFLICT (quest_id) DO
UPDATE
    SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest