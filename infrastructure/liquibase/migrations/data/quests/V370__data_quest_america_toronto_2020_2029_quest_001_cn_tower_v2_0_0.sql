-- Issue: #50
-- Import quest from: america\toronto\2020-2029\quest-001-cn-tower.yaml
-- Version: 2.0.0
-- Generated: 2025-12-07T01:14:46.606222

BEGIN;

-- Quest: canon-quest-toronto-2020-2029-cn-tower
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES ('canon-quest-toronto-2020-2029-cn-tower', 'Торонто 2020-2029 — «Башня CN Tower»', 'Игрок поднимается на CN Tower, испытывает стеклянный пол, посещает SkyPod и решает, готов ли выйти на EdgeWalk.', 'side', 3, NULL, '{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, '[{"id": "prepare_cn_tower_visit", "text": "Прибыть к CN Tower, забронировать билет, пройти охрану и изучить историю башни", "type": "interact", "target": "cn_tower_entrance", "count": 1, "optional": false}, {"id": "ride_main_elevator", "text": "Подняться на скоростном лифте до основной смотровой площадки (342 м)", "type": "interact", "target": "cn_tower_main_deck", "count": 1, "optional": false}, {"id": "experience_glass_floor", "text": "Испытать стеклянный пол и наблюдать панораму Торонто и озера Онтарио", "type": "interact", "target": "glass_floor_experience", "count": 1, "optional": false}, {"id": "visit_skypod", "text": "Подняться на SkyPod (447 м) и наблюдать расширенную панораму", "type": "interact", "target": "cn_tower_skypod", "count": 1, "optional": true}, {"id": "decide_edgewalk", "text": "Принять решение об участии в EdgeWalk (356 м над землёй, снаружи башни)", "type": "choice", "target": "edgewalk_decision", "count": 1, "optional": true}]'::jsonb, '{"experience": 1200, "money": -40, "items": [{"item_id": "achievement_cn_tower_conqueror", "quantity": 1}], "reputation": {}, "unlocks": ["tourism_quests", "cn_tower_access"]}'::jsonb, '[{"branch_id": "edgewalk_challenger", "description": "Стать покорителем EdgeWalk", "consequences": {"skills": {"courage": 35, "balance": 25}, "reputation": {"Toronto_Adventure_Community": 30}, "unlocks": ["exclusive_adventure_access"]}}]'::jsonb, '{"metadata": {"id": "canon-quest-toronto-2020-2029-cn-tower", "title": "Торонто 2020-2029 — «Башня CN Tower»", "document_type": "canon", "category": "timeline-author", "status": "content-ready", "version": "2.0.0", "last_updated": "2025-11-29T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}], "tags": ["toronto", "quest", "tourism", "architecture"], "topics": ["city_quests", "iconic_landmarks"], "related_systems": ["narrative-service", "gameplay-service", "quest-service", "character-service", "economy-service", "tourism-service", "exploration-service"], "related_documents": [{"id": "github-issue-1048", "title": "GitHub Issue", "link": "https://github.com/gc-lover/necpgame-monorepo/issues/1048", "relation": "migrated_to", "migrated_at": "2025-11-23T12:00:00+00:00"}], "source": "shared/docs/knowledge/canon/lore/timeline-author/quests/america/toronto/2020-2029/quest-001-cn-tower.md", "visibility": "internal", "audience": ["concept", "narrative", "liveops"], "risk_level": "low"}, "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Описание визита на CN Tower ограничивалось перечнем фактов и не давало игроку пережить аттракционы башни.", "goal": "Сформировать туристический квест с поэтапным прохождением смотровых площадок и экстремального EdgeWalk.", "essence": "Игрок поднимается на CN Tower, испытывает стеклянный пол, посещает SkyPod и решает, готов ли выйти на EdgeWalk.", "key_points": ["Высотный опыт и панорама озера Онтарио.", "Чёткая последовательность площадок и интерактивов.", "Выбор участвовать в EdgeWalk с бонусами за смелость."]}, "quest_definition": {"quest_type": "side", "level_min": 3, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "prepare_cn_tower_visit", "text": "Прибыть к CN Tower, забронировать билет, пройти охрану и изучить историю башни", "type": "interact", "target": "cn_tower_entrance", "count": 1, "optional": false}, {"id": "ride_main_elevator", "text": "Подняться на скоростном лифте до основной смотровой площадки (342 м)", "type": "interact", "target": "cn_tower_main_deck", "count": 1, "optional": false}, {"id": "experience_glass_floor", "text": "Испытать стеклянный пол и наблюдать панораму Торонто и озера Онтарио", "type": "interact", "target": "glass_floor_experience", "count": 1, "optional": false}, {"id": "visit_skypod", "text": "Подняться на SkyPod (447 м) и наблюдать расширенную панораму", "type": "interact", "target": "cn_tower_skypod", "count": 1, "optional": true}, {"id": "decide_edgewalk", "text": "Принять решение об участии в EdgeWalk (356 м над землёй, снаружи башни)", "type": "choice", "target": "edgewalk_decision", "count": 1, "optional": true}], "rewards": {"experience": 1200, "money": -40, "items": [{"item_id": "achievement_cn_tower_conqueror", "quantity": 1}], "reputation": {}, "unlocks": ["tourism_quests", "cn_tower_access"]}, "branches": [{"branch_id": "edgewalk_challenger", "description": "Стать покорителем EdgeWalk", "consequences": {"skills": {"courage": 35, "balance": 25}, "reputation": {"Toronto_Adventure_Community": 30}, "unlocks": ["exclusive_adventure_access"]}}]}, "content": {"sections": [{"id": "stages", "title": "Последовательность этапов", "body": "Этап 1: Подготовка к визиту\\nЛокация: Торонто, CN Tower, вход и билетная касса\\nОписание: Туристический совет Торонто приглашает игрока испытать ключевые аттракционы CN Tower. Необходимо забронировать билет, пройти охрану и подготовиться к высоте.\\nЦели:\\n  - Прибыть к CN Tower\\n  - Забронировать билет на экскурсию\\n  - Пройти охрану и проверку безопасности\\n  - Изучить историю CN Tower (высота 553 м, построена в 1976 году)\\n  - Подготовиться к высоте\\n  - Войти в башню\\n  - Проверка навыков: Planning 0.3+ для планирования, Awareness 0.3+ для изучения истории\\n\\nЭтап 2: Подъём на основную площадку\\nЛокация: CN Tower, скоростной лифт, основная смотровая площадка (342 м)\\nОписание: Подъём за 58 секунд открывает доступ к основной площадке (342 м) со стеклянным полом. Игрок фиксирует реакции NPC и собирает визуальные данные для туристического каталога.\\nЦели:\\n  - Подняться на скоростном лифте (58 секунд до 342 м)\\n  - Выйти на основную смотровую площадку\\n  - Испытать стеклянный пол (Glass Floor)\\n  - Наблюдать панораму Торонто и озера Онтарио\\n  - Фиксировать реакции NPC на высоту\\n  - Собирать визуальные данные для туристического каталога\\n  - Взаимодействовать с другими посетителями\\n  - Проверка навыков: Courage 0.3+ для преодоления страха высоты, Observation 0.3+ для наблюдений, Photography 0.3+ для фотографий\\n\\nЭтап 3: SkyPod (447 м)\\nЛокация: CN Tower, дополнительный лифт, SkyPod (447 м)\\nОписание: На высоте 447 м игрок получает дополнительные виды на озеро Онтарио. Это самая высокая смотровая площадка с расширенным обзором.\\nЦели:\\n  - Подняться на SkyPod (447 м)\\n  - Наблюдать панораму озера Онтарио и Торонто\\n  - Изучить достопримечательности с высоты\\n  - Сделать фотографии панорамы\\n  - Взаимодействовать с гидом или другими посетителями\\n  - Подготовиться к EdgeWalk (если выбран)\\n  - Проверка навыков: Observation 0.3+ для наблюдений, Photography 0.3+ для фотографий, Social 0.3+ для взаимодействия\\n\\nЭтап 4: EdgeWalk (критический выбор)\\nЛокация: CN Tower, EdgeWalk (356 м над землёй, снаружи башни)\\nОписание: EdgeWalk требует проверки смелости: страховочная система и выбор выполнить задания на высоте 356 м. Это экстремальный аттракцион, где игрок ходит по краю башни снаружи.\\nЦели:\\n  - Принять решение о участии в EdgeWalk\\n  - Пройти инструктаж по безопасности\\n  - Надеть страховочное оборудование\\n  - Выйти на EdgeWalk (356 м над землёй)\\n  - Выполнить задания на высоте (если выбрано)\\n  - Преодолеть страх высоты\\n  - Насладиться экстремальным опытом\\n  - Проверка навыков: Courage 0.4+ для преодоления страха, Balance 0.3+ для удержания равновесия, Choice 0.3+ для принятия решения\\n", "mechanics_links": ["mechanics/quests/quest-structure.yaml", "mechanics/exploration/route-planning.yaml", "mechanics/social/social-dialogue.yaml"], "assets": []}, {"id": "npc_dialogues", "title": "Диалоги с NPC", "body": "Билетный агент (Сара)\\nДиалог 1 (начальный):\\n  - Сара: \\"Welcome to CN Tower! Would you like to purchase a ticket?\\"\\n  - Игрок: \\"Yes, I''d like to visit the tower.\\"\\n  - Сара: \\"Great! We have several options: Main Deck, SkyPod, and EdgeWalk. The Main Deck is at 342 meters, SkyPod at 447 meters, and EdgeWalk is our extreme experience at 356 meters outside the tower.\\"\\n  - Игрок: \\"Tell me about EdgeWalk.\\"\\n  - Сара: \\"EdgeWalk is our most extreme experience. You''ll walk around the outside of the tower at 356 meters above ground, secured by a safety harness. It''s not for everyone, but it''s unforgettable!\\"\\n\\nГид (Майк)\\nДиалог 2 (на основной площадке):\\n  - Майк: \\"Welcome to the Main Deck! You''re now 342 meters above ground. CN Tower was completed in 1976 and was the world''s tallest freestanding structure for 34 years.\\"\\n  - Игрок: \\"Tell me about the Glass Floor.\\"\\n  - Майк: \\"The Glass Floor is our most popular feature. You can see straight down to the ground below. It''s both thrilling and terrifying! Many visitors find it challenging.\\"\\n  - Игрок: \\"What can I see from here?\\"\\n  - Майк: \\"On a clear day, you can see Lake Ontario, the Toronto Islands, and up to 160 kilometers away. It''s one of the best views in Toronto!\\"\\n\\nГид SkyPod (Эмили)\\nДиалог 3 (на SkyPod):\\n  - Эмили: \\"Welcome to SkyPod! You''re now at 447 meters — our highest observation deck. The views of Lake Ontario are spectacular from here.\\"\\n  - Игрок: \\"How much higher can we go?\\"\\n  - Эмили: \\"This is the highest enclosed observation area. But if you''re brave enough, you can try EdgeWalk — that''s 356 meters, but outside the tower. Are you interested?\\"\\n  - Игрок: \\"I''m considering it.\\"\\n  - Эмили: \\"EdgeWalk is an extreme experience. You''ll be secured by a safety harness and walk around the outside of the tower. It''s safe, but it requires courage!\\"\\n\\nИнструктор EdgeWalk (Джейк)\\nДиалог 4 (перед EdgeWalk):\\n  - Джейк: \\"So you want to try EdgeWalk? This is serious. You''ll be 356 meters above ground, walking around the outside of the tower.\\"\\n  - Игрок: \\"I''m ready.\\"\\n  - Джейк: \\"Good. We''ll secure you with a safety harness. You''ll be completely safe, but you need to overcome your fear. Are you sure you''re ready?\\"\\n  - Игрок: \\"Yes, I''m ready.\\"\\n  - Джейк: \\"Excellent! EdgeWalk is about pushing your limits. You''ll lean back over the edge, do some challenges, and experience something few people ever do. Let''s do this!\\"\\n", "mechanics_links": [], "assets": []}, {"id": "branches", "title": "Ветвления и выборы", "body": "Выбор 1: Тип билета\\nУсловие: При покупке билета\\nВарианты:\\n  - Базовый билет (Main Deck): 40 еддис, доступ к основной площадке (342 м), стеклянный пол\\n  - Расширенный билет (Main Deck + SkyPod): 60 еддис, доступ к основной площадке и SkyPod (447 м)\\n  - VIP билет (все уровни + EdgeWalk): 100 еддис, доступ ко всем площадкам и EdgeWalk (356 м), разблокируется путь к экстремальному опыту\\n\\nВыбор 2: Подход к стеклянному полу\\nУсловие: На основной площадке (342 м)\\nВарианты:\\n  - Смело пройти по стеклянному полу: преодолеть страх, разблокируется достижение \\"Смелый\\", бонус к Courage\\n  - Осторожно пройти по краю: избежать страха, стандартный опыт\\n  - Избежать стеклянного пола: пропустить опыт, но без негативных эффектов\\n\\nВыбор 3: Участие в EdgeWalk (критический выбор)\\nУсловие: На SkyPod или после инструктажа\\nВарианты:\\n  - Принять участие в EdgeWalk: экстремальный опыт, разблокируется достижение \\"Покоритель EdgeWalk\\", максимальный бафф \\"Адреналин CN\\" (+30 к иммунитету к высоте), +10 XP, доступ к VIP-миссиям\\n  - Отказаться от EdgeWalk: безопасный выбор, стандартный бафф \\"Адреналин CN\\" (+20 к иммунитету к высоте), базовая ачивка\\n\\nВыбор 4: Выполнение заданий на EdgeWalk\\nУсловие: Во время EdgeWalk (если выбран)\\nВарианты:\\n  - Выполнить все задания: максимальный опыт, разблокируется достижение \\"Мастер EdgeWalk\\", дополнительные награды, +15 XP\\n  - Выполнить базовые задания: стандартный опыт, стандартные награды, +10 XP\\n  - Минимальное участие: безопасный подход, базовые награды, +5 XP\\n", "mechanics_links": [], "assets": []}, {"id": "skill_checks", "title": "Проверки навыков", "body": "Проверка 1: Planning (Этап 1)\\nТребование: 0.3+\\nУспех: Игрок эффективно планирует визит, экономит время и деньги, разблокируется достижение \\"Планировщик\\"\\nПровал: Игрок планирует стандартно\\n\\nПроверка 1b: Awareness (Этап 1)\\nТребование: 0.3+\\nУспех: Игрок глубоко изучает историю CN Tower, разблокируется дополнительная информация о башне\\nПровал: Игрок получает только базовую информацию\\n\\nПроверка 2: Courage (Этап 2)\\nТребование: 0.3+\\nУспех: Игрок успешно преодолевает страх высоты на стеклянном полу, разблокируется достижение \\"Смелый\\" и +5 XP\\nПровал: Игрок испытывает страх, получает дебафф \\"Боязнь высоты\\" на 1 час\\n\\nПроверка 2b: Observation (Этап 2)\\nТребование: 0.3+\\nУспех: Игрок внимательно наблюдает за панорамой, разблокируется дополнительная информация о достопримечательностях и разблокируется достижение \\"Наблюдатель\\"\\nПровал: Игрок получает только общее впечатление\\n\\nПроверка 2c: Photography (Этап 2)\\nТребование: 0.3+\\nУспех: Игрок делает качественные фотографии, разблокируется достижение \\"Фотограф\\" и предмет \\"Фото CN Tower\\"\\nПровал: Игрок делает стандартные фотографии\\n\\nПроверка 3: Observation (Этап 3)\\nТребование: 0.3+\\nУспех: Игрок внимательно наблюдает за панорамой озера Онтарио, разблокируется дополнительная информация о географии и разблокируется достижение \\"Знаток географии\\"\\nПровал: Игрок получает только общее впечатление\\n\\nПроверка 3b: Photography (Этап 3)\\nТребование: 0.3+\\nУспех: Игрок делает качественные фотографии с SkyPod, разблокируется достижение \\"Фотограф SkyPod\\" и предмет \\"Фото с SkyPod\\"\\nПровал: Игрок делает стандартные фотографии\\n\\nПроверка 3c: Social (Этап 3)\\nТребование: 0.3+\\nУспех: Игрок успешно взаимодействует с гидом или посетителями, разблокируется дополнительная информация и разблокируется достижение \\"Общительный\\"\\nПровал: Игрок получает стандартное взаимодействие\\n\\nПроверка 4: Courage (Этап 4)\\nТребование: 0.4+\\nУспех: Игрок успешно преодолевает страх на EdgeWalk, разблокируется достижение \\"Храбрый\\" и максимальный бафф \\"Адреналин CN\\" (+30 к иммунитету к высоте) и +10 XP\\nПровал: Игрок испытывает сильный страх, получает дебафф \\"Паника\\" на 2 часа, базовый бафф \\"Адреналин CN\\" (+10 к иммунитету к высоте)\\n\\nПроверка 4b: Balance (Этап 4)\\nТребование: 0.3+\\nУспех: Игрок успешно удерживает равновесие на EdgeWalk, разблокируется достижение \\"Мастер баланса\\" и +5 XP\\nПровал: Игрок испытывает трудности с равновесием, увеличивается сложность заданий\\n\\nПроверка 4c: Choice (Этап 4)\\nТребование: 0.3+\\nУспех: Игрок делает правильный выбор об участии в EdgeWalk, получает максимальные бонусы и разблокируется достижение \\"Мудрый выбор\\"\\nПровал: Игрок получает стандартные бонусы\\n", "mechanics_links": [], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Базовые награды:\\n  - Опыт: 1 200 XP\\n  - Репутация Toronto Tourism Community: +15\\n  - Репутация Toronto Adventure Community: +10\\n  - Валюта: -40 до -100 еддис (в зависимости от типа билета)\\n  - Бафф \\"Адреналин CN\\": +20 к иммунитету к высоте на 24 часа (базовый)\\n  - Ачивка \\"Покоритель CN Tower\\" (базовая)\\n\\nНаграды в зависимости от участия в EdgeWalk:\\n  - Участие в EdgeWalk: достижение \\"Покоритель EdgeWalk\\", максимальный бафф \\"Адреналин CN\\" (+30 к иммунитету к высоте), +10 XP, доступ к VIP-наблюдательным миссиям\\n  - Отказ от EdgeWalk: базовый бафф \\"Адреналин CN\\" (+20 к иммунитету к высоте), стандартная ачивка\\n\\nНаграды за выполнение заданий на EdgeWalk:\\n  - Выполнить все задания: достижение \\"Мастер EdgeWalk\\", дополнительные награды, +15 XP\\n  - Выполнить базовые задания: стандартные награды, +10 XP\\n  - Минимальное участие: базовые награды, +5 XP\\n\\nДополнительные награды (при успешных проверках навыков):\\n  - Достижение \\"Планировщик\\" (при успешной проверке Planning)\\n  - Экономия времени и денег (при успешной проверке Planning)\\n  - Дополнительная информация о CN Tower (при успешной проверке Awareness)\\n  - Достижение \\"Смелый\\" (при успешной проверке Courage на этапе 2)\\n  - +5 XP (при успешной проверке Courage на этапе 2)\\n  - Достижение \\"Наблюдатель\\" (при успешной проверке Observation на этапе 2)\\n  - Дополнительная информация о достопримечательностях (при успешной проверке Observation на этапе 2)\\n  - Достижение \\"Фотограф\\" (при успешной проверке Photography на этапе 2)\\n  - Предмет \\"Фото CN Tower\\" (при успешной проверке Photography на этапе 2)\\n  - Достижение \\"Знаток географии\\" (при успешной проверке Observation на этапе 3)\\n  - Дополнительная информация о географии (при успешной проверке Observation на этапе 3)\\n  - Достижение \\"Фотограф SkyPod\\" (при успешной проверке Photography на этапе 3)\\n  - Предмет \\"Фото с SkyPod\\" (при успешной проверке Photography на этапе 3)\\n  - Достижение \\"Общительный\\" (при успешной проверке Social на этапе 3)\\n  - Дополнительная информация (при успешной проверке Social на этапе 3)\\n  - Достижение \\"Храбрый\\" (при успешной проверке Courage на этапе 4)\\n  - Максимальный бафф \\"Адреналин CN\\" (+30 к иммунитету к высоте) (при успешной проверке Courage на этапе 4)\\n  - +10 XP (при успешной проверке Courage на этапе 4)\\n  - Достижение \\"Мастер баланса\\" (при успешной проверке Balance)\\n  - +5 XP (при успешной проверке Balance)\\n  - Достижение \\"Мудрый выбор\\" (при успешной проверке Choice)\\n\\nНаграды за тип билета:\\n  - Базовый билет: 40 еддис, доступ к основной площадке\\n  - Расширенный билет: 60 еддис, доступ к основной площадке и SkyPod\\n  - VIP билет: 100 еддис, доступ ко всем площадкам и EdgeWalk\\n\\nНаграды за подход к стеклянному полу:\\n  - Смело пройти: достижение \\"Смелый\\", бонус к Courage\\n  - Осторожно пройти: стандартный опыт\\n  - Избежать: без негативных эффектов\\n\\nУникальные награды:\\n  - Бафф \\"Адреналин CN\\" (+20-30 к иммунитету к высоте на 24 часа, в зависимости от выбора)\\n  - Доступ к VIP-наблюдательным миссиям (при участии в EdgeWalk)\\n  - Визуальные данные для туристического каталога (при фотографиях)\\n  - Влияние на все последующие туристические квесты в Торонто\\n", "mechanics_links": ["mechanics/progression/progression-attributes-matrix.yaml"], "assets": []}]}, "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation": {"github_issue": 1048, "needs_task": false, "queue_reference": [], "blockers": []}, "history": [{"version": "0.1.0", "date": "2025-11-12", "author": "concept_team", "changes": "Конвертация квеста «Башня CN Tower» в формат знаний."}, {"version": "2.0.0", "date": "2025-11-29", "author": "content_writer", "changes": "Добавлена полная структура quest_definition с objectives, rewards и branches. Обновлена версия до 2.0.0."}, {"version": "1.0.0", "date": "2025-11-23", "author": "content_writer", "changes": "Добавлен детальный контент: этапы с локациями и целями (4 этапа: подготовка, подъём на основную площадку, SkyPod, EdgeWalk), диалоги с NPC (билетный агент, гиды, инструктор EdgeWalk), проверки навыков (Planning, Awareness, Courage, Observation, Photography, Social, Balance, Choice), ветвления и выборы, детальные награды с баффом \\"Адреналин CN\\" +20-30 к иммунитету к высоте."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest