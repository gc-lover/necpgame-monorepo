-- Issue: #50
-- Import quest from: america\toronto\2020-2029\quest-003-poutine-quest.yaml
-- Version: 2.0.0
-- Generated: 2025-12-07T01:14:46.627438

BEGIN;

-- Quest: canon-quest-toronto-2020-2029-poutine
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES ('canon-quest-toronto-2020-2029-poutine', 'Торонто 2020-2029 — «Квест путин»', 'Игрок путешествует по фуд-кортам и бистро, пробует классический и авторские варианты путин, расширяя гастрономический каталог.', 'side', 2, NULL, '{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, '[{"id": "meet_culinary_guide", "text": "Встретиться с гастрономическим гидом и получить чек-лист заведений с путин", "type": "interact", "target": "culinary_guide_toronto", "count": 1, "optional": false}, {"id": "try_classic_poutine", "text": "Попробовать классический путин в традиционном бистро", "type": "interact", "target": "classic_poutine_bistro", "count": 1, "optional": false}, {"id": "try_creative_poutine", "text": "Попробовать авторские варианты путин (pulled pork, бекон с острым соусом)", "type": "interact", "target": "creative_poutine_restaurants", "count": 1, "optional": false}, {"id": "choose_favorite_poutine", "text": "Выбрать любимую версию путин и зафиксировать в дневнике вкусов", "type": "choice", "target": "poutine_selection", "count": 1, "optional": false}]'::jsonb, '{"experience": 600, "money": -15, "items": [{"item_id": "achievement_poutine_guru", "quantity": 1}, {"item_id": "cheese_curds_collectible", "quantity": 1}], "reputation": {"Toronto_Culinary_Community": 15, "Toronto_Food_Lovers": 10}, "unlocks": ["festival_menu_access", "culinary_quests_toronto"]}'::jsonb, '[{"branch_id": "traditionalist_path", "description": "Выбрать классический путин как фаворит", "consequences": {"reputation": {"Traditional_Food_Fans": 10}}}, {"branch_id": "innovator_path", "description": "Выбрать авторский вариант как фаворит", "consequences": {"reputation": {"Food_Innovators": 10}}}]'::jsonb, '{"metadata": {"id": "canon-quest-toronto-2020-2029-poutine", "title": "Торонто 2020-2029 — «Квест путин»", "document_type": "canon", "category": "timeline-author", "status": "content-ready", "version": "2.0.0", "last_updated": "2025-11-29T00:00:00+00:00", "concept_approved": true, "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}], "tags": ["toronto", "quest", "cuisine", "comfort-food"], "topics": ["city_quests", "culinary_experience"], "related_systems": ["narrative-service", "gameplay-service", "quest-service", "character-service", "economy-service", "social-service", "culture-service"], "related_documents": [{"id": "github-issue-1050", "title": "GitHub Issue", "link": "https://github.com/gc-lover/necpgame-monorepo/issues/1050", "relation": "migrated_to", "migrated_at": "2025-11-23T12:00:00+00:00"}], "source": "shared/docs/knowledge/canon/lore/timeline-author/quests/america/toronto/2020-2029/quest-003-poutine-quest.md", "visibility": "internal", "audience": ["concept", "narrative", "liveops"], "risk_level": "low"}, "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Описание путин-тура ограничивалось перечислением ингредиентов и не давало выбора между локальными вариациями.", "goal": "Предложить игроку дегустационный маршрут по лучшим точкам Торонто с анализом происхождения блюда.", "essence": "Игрок путешествует по фуд-кортам и бистро, пробует классический и авторские варианты путин, расширяя гастрономический каталог.", "key_points": ["Сравнение квебекских корней и торонтских адаптаций.", "Сбор «скрипящих» сырных кубиков как коллекционного предмета.", "Решение, какой вариант попадёт в сетевые мероприятия."]}, "quest_definition": {"quest_type": "side", "level_min": 2, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "meet_culinary_guide", "text": "Встретиться с гастрономическим гидом и получить чек-лист заведений с путин", "type": "interact", "target": "culinary_guide_toronto", "count": 1, "optional": false}, {"id": "try_classic_poutine", "text": "Попробовать классический путин в традиционном бистро", "type": "interact", "target": "classic_poutine_bistro", "count": 1, "optional": false}, {"id": "try_creative_poutine", "text": "Попробовать авторские варианты путин (pulled pork, бекон с острым соусом)", "type": "interact", "target": "creative_poutine_restaurants", "count": 1, "optional": false}, {"id": "choose_favorite_poutine", "text": "Выбрать любимую версию путин и зафиксировать в дневнике вкусов", "type": "choice", "target": "poutine_selection", "count": 1, "optional": false}], "rewards": {"experience": 600, "money": -15, "items": [{"item_id": "achievement_poutine_guru", "quantity": 1}, {"item_id": "cheese_curds_collectible", "quantity": 1}], "reputation": {"Toronto_Culinary_Community": 15, "Toronto_Food_Lovers": 10}, "unlocks": ["festival_menu_access", "culinary_quests_toronto"]}, "branches": [{"branch_id": "traditionalist_path", "description": "Выбрать классический путин как фаворит", "consequences": {"reputation": {"Traditional_Food_Fans": 10}}}, {"branch_id": "innovator_path", "description": "Выбрать авторский вариант как фаворит", "consequences": {"reputation": {"Food_Innovators": 10}}}]}, "content": {"sections": [{"id": "stages", "title": "Последовательность этапов", "body": "Этап 1: Встреча с гастрономическим гидом\\nЛокация: Торонто, центр города, гастрономический тур\\nОписание: Гастрономический гид формирует для игрока чек-лист заведений. Необходимо пройти маршрут за один вечер и зафиксировать впечатления в дневнике вкусов.\\nЦели:\\n  - Встретиться с гастрономическим гидом\\n  - Получить чек-лист заведений с путин\\n  - Изучить историю путин (канадское блюдо из картофеля фри, коричневого соуса и cheese curds)\\n  - Узнать о квебекских корнях и торонтских адаптациях\\n  - Начать гастрономический маршрут\\n  - Проверка навыков: Planning 0.3+ для планирования маршрута, Awareness 0.3+ для изучения истории\\n\\nЭтап 2: Классический путин — первая остановка\\nЛокация: Торонто, классическое бистро или фуд-корт\\nОписание: Первая остановка предлагает традиционный рецепт: картофель фри, коричневый соус и cheese curds. Игрок оценивает текстуру и температуру, собирая данные для баланса блюд.\\nЦели:\\n  - Прибыть в первое заведение\\n  - Заказать классический путин (картофель фри, коричневый соус, cheese curds)\\n  - Попробовать классический вариант\\n  - Оценить текстуру и температуру блюда\\n  - Собрать данные о классическом рецепте\\n  - Записать впечатления в дневник вкусов\\n  - Собрать \\"скрипящие\\" сырные кубики (cheese curds) как коллекционный предмет\\n  - Проверка навыков: Culinary 0.3+ для оценки блюда, Appreciation 0.3+ для наслаждения едой\\n\\nЭтап 3: Авторские варианты — вторая и третья остановки\\nЛокация: Торонто, современные бистро и рестораны\\nОписание: Следующие заведения экспериментируют с pulled pork, беконом и острыми соусами. Игрок выбирает любимую версию, влияя на будущие поставки для внутриигровых фестивалей.\\nЦели:\\n  - Прибыть во второе заведение (авторский вариант с pulled pork)\\n  - Попробовать путин с pulled pork\\n  - Оценить авторский вариант\\n  - Прибыть в третье заведение (авторский вариант с беконом и острыми соусами)\\n  - Попробовать путин с беконом и острыми соусами\\n  - Оценить ещё один авторский вариант\\n  - Выбрать любимую версию (классический или один из авторских вариантов)\\n  - Зафиксировать выбор в дневнике вкусов\\n  - Проверка навыков: Culinary 0.4+ для оценки авторских вариантов, Choice 0.3+ для выбора любимой версии\\n\\nЭтап 4: Финал — дневник вкусов и решение о фестивале\\nЛокация: Торонто, финальное место сбора\\nОписание: Игрок завершает гастрономический маршрут, заполняет дневник вкусов и принимает решение о том, какой вариант путин попадёт в сетевые мероприятия и фестивали.\\nЦели:\\n  - Завершить гастрономический маршрут\\n  - Заполнить дневник вкусов с впечатлениями\\n  - Принять решение о том, какой вариант путин включить в фестиваль\\n  - Зафиксировать выбор для будущих сетевых мероприятий\\n  - Получить доступ к тайному меню фестиваля\\n  - Завершить квест\\n  - Проверка навыков: Writing 0.3+ для заполнения дневника, Choice 0.3+ для принятия решения\\n", "mechanics_links": ["mechanics/quests/quest-structure.yaml", "mechanics/world/events/live-events-system.yaml", "mechanics/social/social-dialogue.yaml"], "assets": []}, {"id": "npc_dialogues", "title": "Диалоги с NPC", "body": "Гастрономический гид (Сара)\\nДиалог 1 (начальный):\\n  - Сара: \\"Welcome to the Poutine Quest! Are you ready to discover the best poutine in Toronto?\\"\\n  - Игрок: \\"Yes, I''m excited!\\"\\n  - Сара: \\"Great! Poutine is a Canadian classic. It originated in Quebec, but Toronto has put its own twist on it. We''ll visit three places tonight: classic, pulled pork, and bacon with spicy sauce.\\"\\n  - Игрок: \\"Tell me about poutine.\\"\\n  - Сара: \\"Poutine is fries, brown gravy, and cheese curds. The key is the ''squeaky'' cheese curds — they should squeak when you bite into them! It''s comfort food at its finest.\\"\\n\\nШеф-повар классического бистро (Жан)\\nДиалог 2 (первая остановка):\\n  - Жан: \\"Bonjour! Welcome to our bistro! You want the classic poutine?\\"\\n  - Игрок: \\"Yes, please!\\"\\n  - Жан: \\"Perfect! Our poutine uses Quebec-style cheese curds. The secret is fresh curds — they must squeak! And the gravy must be hot enough to melt the cheese but not too hot to burn the fries.\\"\\n  - Игрок: \\"Why is it called poutine?\\"\\n  - Жан: \\"Poutine comes from Quebec. Some say it''s from ''pudding'', others say it''s slang. But it''s Canadian comfort food — simple, hearty, and delicious!\\"\\n\\nШеф-повар авторского бистро (Марк)\\nДиалог 3 (вторая остановка):\\n  - Марк: \\"Hey! You''re here for our pulled pork poutine?\\"\\n  - Игрок: \\"Yes, tell me about it.\\"\\n  - Марк: \\"We took the classic poutine and added pulled pork. It''s a Toronto twist — we like to experiment here. The pulled pork adds smokiness and depth.\\"\\n  - Игрок: \\"How is it different from the classic?\\"\\n  - Марк: \\"Classic poutine is simple and perfect. Our version adds pulled pork for extra flavor. It''s not better — it''s different. You''ll see which you prefer!\\"\\n\\nШеф-повар острого бистро (Мария)\\nДиалог 4 (третья остановка):\\n  - Мария: \\"Welcome! You want our bacon and spicy sauce poutine?\\"\\n  - Игрок: \\"Yes, I''m curious!\\"\\n  - Мария: \\"This is our most creative version! We add crispy bacon and a spicy chipotle sauce. It''s bold, it''s different, and it''s very Toronto.\\"\\n  - Игрок: \\"Which do you recommend?\\"\\n  - Мария: \\"I love all versions! The classic is traditional, the pulled pork is hearty, and ours is bold. Try them all and decide which one speaks to you!\\"\\n", "mechanics_links": [], "assets": []}, {"id": "branches", "title": "Ветвления и выборы", "body": "Выбор 1: Подход к гастрономическому маршруту\\nУсловие: При начале маршрута\\nВарианты:\\n  - Интенсивное изучение: детально изучать каждый вариант, больше времени, но больше информации, разблокируется дополнительная информация о рецептах\\n  - Быстрое изучение: быстро пробовать варианты, меньше времени, но стандартная информация\\n  - Сбалансированный подход: оптимальный баланс изучения и скорости\\n\\nВыбор 2: Оценка классического путин\\nУсловие: При дегустации классического путин\\nВарианты:\\n  - Высокая оценка: классический вариант — лучший, разблокируется путь к классическому варианту для фестиваля\\n  - Средняя оценка: классический вариант хорош, но есть альтернативы\\n  - Низкая оценка: классический вариант не впечатляет, искать альтернативы\\n\\nВыбор 3: Выбор любимой версии (критический выбор)\\nУсловие: После дегустации всех вариантов\\nВарианты:\\n  - Классический путин: традиционный рецепт (картофель фри, коричневый соус, cheese curds), разблокируется достижение \\"Традиционалист\\", классический вариант для фестиваля\\n  - Путин с pulled pork: авторский вариант с pulled pork, разблокируется достижение \\"Экспериментатор\\", авторский вариант для фестиваля\\n  - Путин с беконом и острым соусом: авторский вариант с беконом и острым соусом, разблокируется достижение \\"Смелый гурман\\", смелый вариант для фестиваля\\n\\nВыбор 4: Решение о фестивале\\nУсловие: При заполнении дневника вкусов\\nВарианты:\\n  - Классический вариант для фестиваля: традиционный рецепт, больше консервативных фанатов, стандартный успех\\n  - Авторский вариант для фестиваля: выбранный авторский вариант, больше любителей экспериментов, уникальный успех\\n  - Множественный вариант: все варианты для фестиваля, максимум разнообразия, максимальный успех\\n", "mechanics_links": [], "assets": []}, {"id": "skill_checks", "title": "Проверки навыков", "body": "Проверка 1: Planning (Этап 1)\\nТребование: 0.3+\\nУспех: Игрок эффективно планирует маршрут, экономит время и деньги, разблокируется достижение \\"Планировщик\\"\\nПровал: Игрок планирует стандартно\\n\\nПроверка 1b: Awareness (Этап 1)\\nТребование: 0.3+\\nУспех: Игрок глубоко изучает историю путин, разблокируется дополнительная информация о квебекских корнях и торонтских адаптациях\\nПровал: Игрок получает только базовую информацию\\n\\nПроверка 2: Culinary (Этап 2)\\nТребование: 0.3+\\nУспех: Игрок успешно оценивает классический путин, собирает детальные данные о текстуре и температуре, разблокируется достижение \\"Знаток путин\\"\\nПровал: Игрок получает только базовую оценку\\n\\nПроверка 2b: Appreciation (Этап 2)\\nТребование: 0.3+\\nУспех: Игрок глубоко наслаждается классическим путин, получает дополнительный бафф и разблокируется достижение \\"Ценитель комфортной еды\\"\\nПровал: Игрок получает стандартное впечатление\\n\\nПроверка 3: Culinary (Этап 3)\\nТребование: 0.4+\\nУспех: Игрок успешно оценивает авторские варианты, разблокируется дополнительная информация о рецептах и разблокируется достижение \\"Мастер дегустации\\" и +5 XP\\nПровал: Игрок получает только базовую оценку\\n\\nПроверка 3b: Choice (Этап 3)\\nТребование: 0.3+\\nУспех: Игрок делает правильный выбор любимой версии, получает максимальные бонусы и разблокируется достижение \\"Мудрый выбор\\"\\nПровал: Игрок получает стандартные бонусы\\n\\nПроверка 4: Writing (Этап 4)\\nТребование: 0.3+\\nУспех: Игрок создаёт качественный дневник вкусов, разблокируется дополнительная информация и разблокируется достижение \\"Писатель дневника\\"\\nПровал: Игрок создаёт стандартный дневник\\n\\nПроверка 4b: Choice (Этап 4)\\nТребование: 0.3+\\nУспех: Игрок делает правильное решение о фестивале, получает максимальные бонусы и разблокируется достижение \\"Организатор фестиваля\\"\\nПровал: Игрок получает стандартные бонусы\\n", "mechanics_links": [], "assets": []}, {"id": "rewards", "title": "Награды и последствия", "body": "Базовые награды:\\n  - Опыт: 600 XP\\n  - Репутация Toronto Culinary Community: +15\\n  - Репутация Toronto Food Lovers: +10\\n  - Валюта: -15 до -30 еддис (в зависимости от количества заведений)\\n  - Бафф \\"Comfort food\\": +30% HP на 8 часов\\n  - Ачивка \\"Путин-гуру\\" (базовая)\\n\\nНаграды в зависимости от выбора любимой версии:\\n  - Классический путин: достижение \\"Традиционалист\\", классический вариант для фестиваля, +5 репутация Traditional Food Fans\\n  - Путин с pulled pork: достижение \\"Экспериментатор\\", авторский вариант для фестиваля, +5 репутация Food Innovators\\n  - Путин с беконом и острым соусом: достижение \\"Смелый гурман\\", смелый вариант для фестиваля, +5 репутация Bold Food Lovers\\n\\nНаграды за решение о фестивале:\\n  - Классический вариант: стандартный успех фестиваля, больше консервативных фанатов\\n  - Авторский вариант: уникальный успех фестиваля, больше любителей экспериментов\\n  - Множественный вариант: максимальный успех фестиваля, максимум разнообразия, разблокируется достижение \\"Фестивальный мастер\\"\\n\\nДополнительные награды (при успешных проверках навыков):\\n  - Достижение \\"Планировщик\\" (при успешной проверке Planning)\\n  - Экономия времени и денег (при успешной проверке Planning)\\n  - Дополнительная информация о путин (при успешной проверке Awareness)\\n  - Достижение \\"Знаток путин\\" (при успешной проверке Culinary на этапе 2)\\n  - Детальные данные о текстуре и температуре (при успешной проверке Culinary на этапе 2)\\n  - Достижение \\"Ценитель комфортной еды\\" (при успешной проверке Appreciation)\\n  - Дополнительный бафф (при успешной проверке Appreciation)\\n  - Достижение \\"Мастер дегустации\\" (при успешной проверке Culinary на этапе 3)\\n  - Дополнительная информация о рецептах (при успешной проверке Culinary на этапе 3)\\n  - +5 XP (при успешной проверке Culinary на этапе 3)\\n  - Достижение \\"Мудрый выбор\\" (при успешной проверке Choice на этапе 3)\\n  - Достижение \\"Писатель дневника\\" (при успешной проверке Writing)\\n  - Дополнительная информация (при успешной проверке Writing)\\n  - Достижение \\"Организатор фестиваля\\" (при успешной проверке Choice на этапе 4)\\n  - Максимальные бонусы (при успешной проверке Choice на этапе 4)\\n\\nНаграды за подход к маршруту:\\n  - Интенсивное изучение: дополнительная информация о рецептах, достижение \\"Исследователь кухни\\"\\n  - Быстрое изучение: экономия времени\\n  - Сбалансированный подход: оптимальный баланс\\n\\nНаграды за оценку классического путин:\\n  - Высокая оценка: путь к классическому варианту для фестиваля\\n  - Средняя оценка: баланс вариантов\\n  - Низкая оценка: поиск альтернатив\\n\\nУникальные награды:\\n  - Коллекционный предмет \\"Скрипящие сырные кубики\\" (cheese curds) — собирается при дегустации классического путин\\n  - Доступ к тайному меню фестиваля (при завершении квеста)\\n  - Влияние на будущие сетевые мероприятия (в зависимости от выбора)\\n  - Расширение гастрономического каталога (при заполнении дневника вкусов)\\n  - Влияние на все последующие кулинарные квесты в Торонто\\n", "mechanics_links": ["mechanics/progression/progression-attributes-matrix.yaml"], "assets": []}]}, "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation": {"github_issue": 1050, "needs_task": false, "queue_reference": [], "blockers": []}, "history": [{"version": "0.1.0", "date": "2025-11-12", "author": "concept_team", "changes": "Конвертация квеста «Квест путин» в формат знаний."}, {"version": "2.0.0", "date": "2025-11-29", "author": "content_writer", "changes": "Добавлена полная структура quest_definition с objectives, rewards и branches. Обновлена версия до 2.0.0."}, {"version": "1.0.0", "date": "2025-11-23", "author": "content_writer", "changes": "Добавлен детальный контент: этапы с локациями и целями (4 этапа: встреча с гидом, классический путин, авторские варианты, финал), диалоги с NPC (гастрономический гид Сара, шеф-повара Жан, Марк, Мария), проверки навыков (Planning, Awareness, Culinary, Appreciation, Choice, Writing), ветвления и выборы, детальные награды с баффом Comfort food +30% HP на 8 часов и ачивкой Путин-гуру."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest