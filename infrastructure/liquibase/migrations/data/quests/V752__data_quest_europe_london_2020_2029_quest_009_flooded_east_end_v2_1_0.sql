-- Issue: #50
-- Import quest from: europe\london\2020-2029\quest-009-flooded-east-end.yaml
-- Version: 2.1.0
-- Generated: 2025-12-07T01:14:48.644399

BEGIN;

-- Quest: quest-london-2029-flooded-east-end
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES ('quest-london-2029-flooded-east-end', 'Лондон 2020-2029 — Затопленный Ист-Энд', 'Группа арендует транспорт, исследует руины Ист-Энда и пытается уйти с лутом, избегая потерь.', 'side', 5, NULL, '{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, '[{"id": "prepare_extraction", "text": "Арендовать лодку или мини-субмарину, закупить снаряжение и собрать сведения о погодных условиях", "type": "prepare", "target": "extraction_preparation_station", "count": 1, "optional": false}, {"id": "navigate_flooded_streets", "text": "Спланировать маршрут и навигировать по затопленным улицам, избегая обвалов и ловушек", "type": "explore", "target": "flooded_east_end_streets", "count": 1, "optional": false}, {"id": "search_for_valuables", "text": "Разобрать завалы, вскрыть сейфы и собрать случайный лут среди затопленных зданий", "type": "loot", "target": "flooded_buildings", "count": 5, "optional": false}, {"id": "deal_with_water_gangs", "text": "Столкнуться с водными бандами: договориться или вступить в бой", "type": "interact", "target": "water_gang_encounter", "count": 1, "optional": false}, {"id": "extract_safely", "text": "Добраться до эвакуационной точки до истечения таймера", "type": "perform", "target": "extraction_point", "count": 1, "optional": false}]'::jsonb, '{"experience": 1500, "currency": 0, "items": [], "reputation": {"london_survivors": 10}, "flags": ["flooded_east_end_extracted"]}'::jsonb, '[{"id": "successful_extraction_path", "unlock_condition": {"type": "objective_completion", "objective_id": "extract_safely", "min_count": 1}, "consequences": {"currency": 10000, "reputation": {"london_survivors": 15}, "flags": ["successful_extraction_unlocked", "flooded_zone_master_unlocked"], "unlocked_content": [{"quest_type": "side", "category": "extraction", "location": "london"}]}}, {"id": "failed_extraction_path", "unlock_condition": {"type": "quest_completion", "quest_id": "quest-london-2029-flooded-east-end"}, "consequences": {"currency": 0, "reputation": {"london_survivors": -5}, "flags": ["extraction_failed_unlocked"], "unlocked_content": []}}]'::jsonb, '{"metadata": {"id": "quest-london-2029-flooded-east-end", "title": "Лондон 2020-2029 — Затопленный Ист-Энд", "document_type": "canon", "category": "timeline-quest", "status": "draft", "version": "2.1.0", "last_updated": "2025-12-01T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}], "tags": ["london", "extraction", "flooded-zones"], "topics": ["risk_reward", "urban_survival"], "related_systems": ["exploration-service", "combat-service", "economy-service"], "related_documents": [], "source": "shared/docs/knowledge/canon/lore/timeline-author/quests/europe/london/2020-2029/quest-009-flooded-east-end.md", "visibility": "internal", "audience": ["concept", "narrative", "liveops"], "risk_level": "medium"}, "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Лондонской линии требовалась экстракт-зона в затопленном районе с кооперативом и риском.", "goal": "Провести рейд по затопленным улицам, добыть ценности и выбраться до прихода банд.", "essence": "Группа арендует транспорт, исследует руины Ист-Энда и пытается уйти с лутом, избегая потерь.", "key_points": ["Экстракция по правилам «Risk vs Reward».", "Водные банды используют гидродроны и засады.", "Возможна потеря всего прогресса при гибели."]}, "quest_definition": {"quest_type": "side", "level_min": 5, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "prepare_extraction", "text": "Арендовать лодку или мини-субмарину, закупить снаряжение и собрать сведения о погодных условиях", "type": "prepare", "target": "extraction_preparation_station", "count": 1, "optional": false}, {"id": "navigate_flooded_streets", "text": "Спланировать маршрут и навигировать по затопленным улицам, избегая обвалов и ловушек", "type": "explore", "target": "flooded_east_end_streets", "count": 1, "optional": false}, {"id": "search_for_valuables", "text": "Разобрать завалы, вскрыть сейфы и собрать случайный лут среди затопленных зданий", "type": "loot", "target": "flooded_buildings", "count": 5, "optional": false}, {"id": "deal_with_water_gangs", "text": "Столкнуться с водными бандами: договориться или вступить в бой", "type": "interact", "target": "water_gang_encounter", "count": 1, "optional": false}, {"id": "extract_safely", "text": "Добраться до эвакуационной точки до истечения таймера", "type": "perform", "target": "extraction_point", "count": 1, "optional": false}], "rewards": {"experience": 1500, "currency": 0, "items": [], "reputation": {"london_survivors": 10}, "flags": ["flooded_east_end_extracted"]}, "branches": [{"id": "successful_extraction_path", "unlock_condition": {"type": "objective_completion", "objective_id": "extract_safely", "min_count": 1}, "consequences": {"currency": 10000, "reputation": {"london_survivors": 15}, "flags": ["successful_extraction_unlocked", "flooded_zone_master_unlocked"], "unlocked_content": [{"quest_type": "side", "category": "extraction", "location": "london"}]}}, {"id": "failed_extraction_path", "unlock_condition": {"type": "quest_completion", "quest_id": "quest-london-2029-flooded-east-end"}, "consequences": {"currency": 0, "reputation": {"london_survivors": -5}, "flags": ["extraction_failed_unlocked"], "unlocked_content": []}}]}, "content": {"sections": [{"id": "prep", "title": "Подготовка и транспорт", "body": "Игроки арендуют лодку или мини-субмарину, закупают снаряжение и собирают сведения о погодных условиях.\\n", "mechanics_links": ["mechanics/economy/extraction-prep.yaml"], "assets": []}, {"id": "navigation", "title": "Навигация по затопленным улицам", "body": "Нужно планировать маршрут, избегать обвалов и ловушек на коридорах бывшего Ист-Энда.\\n", "mechanics_links": ["mechanics/exploration/flooded-navigation.yaml"], "assets": []}, {"id": "search", "title": "Поиск ценностей", "body": "Разбор завалов, вскрытие сейфов и сбор случайного лута среди затопленных зданий.\\n", "mechanics_links": ["mechanics/loot/randomized-drop-table.yaml"], "assets": []}, {"id": "encounter", "title": "Столкновение с водными бандами", "body": "Засады на лодках и гидродронах, возможность договориться или вступить в бой.\\n", "mechanics_links": ["mechanics/combat/ambush-encounter.yaml"], "assets": []}, {"id": "extraction", "title": "Экстракция", "body": "Нужно добраться до эвакуационной точки до истечения таймера. При провале лут теряется.\\n", "mechanics_links": ["mechanics/progression/extraction-timer.yaml"], "assets": []}, {"id": "rewards", "title": "Награды", "body": "- 1 500 XP, потенциал лута 5 000–20 000 еддис.\\n- Репутация выживших и доступ к новым маршрутам экстракции.\\n", "mechanics_links": ["mechanics/progression/risk-reward.yaml"], "assets": []}]}, "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation": {"github_issue": 657, "needs_task": false, "queue_reference": [], "blockers": []}, "history": [{"version": "2.1.0", "date": "2025-12-01", "author": "content_writer", "changes": "Добавлен Issue в начало файла. Исправлена структура branches (condition -> unlock_condition, убраны objectives из branches, добавлены правильные поля consequences). Структура quest_definition соответствует архитектуре системы квестов."}, {"version": "2.0.0", "date": "2025-11-29", "author": "content_writer", "changes": "Добавлена полная структура quest_definition с objectives, rewards и branches. Детализирован контент согласно концепции. Добавлены механики экстракции и риск-награда."}, {"version": "1.0.0", "date": "2025-11-13", "author": "concept_team", "changes": "Квест «Затопленный Ист-Энд» адаптирован под шаблон Concept Director."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest