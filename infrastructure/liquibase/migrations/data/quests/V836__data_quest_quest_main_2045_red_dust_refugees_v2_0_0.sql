-- Issue: #14
-- Source: quest-main-2045-red-dust-refugees.yaml
-- Version: 2.0.0
-- Generated: 2025-12-08T19:24:34.853100Z

BEGIN;

-- Quest: quest-main-2045-red-dust-refugees
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES ('quest-main-2045-red-dust-refugees', 'Архив — Основной квест: Беженцы Красной пыли (2045)', 'Игрок обеспечивает эвакуацию беженцев, балансируя между переговорами, боём и тактическим планированием.', 'main', 8, NULL, '{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, '[{"id": "meet_refugees", "text": "Встретиться с беженцами в Santo Domingo", "type": "interact", "target": "red-dust-refugees-group", "count": 1, "optional": false}, {"id": "ensure_route", "text": "Обеспечить безопасный маршрут эвакуации (TACTICS 14 для оптимального маршрута, PERCEPTION 14 для альтернативного пролаза)", "type": "perform", "target": "evacuation-route-planning", "count": 1, "optional": false}, {"id": "escort_refugees", "text": "Эскортировать беженцев из Santo Domingo в Watson (COOL 15 для переговоров с препятствиями, MEDICAL 13 для стабилизации раненых)", "type": "escort", "target": "refugees-escort-route", "count": 1, "optional": false}, {"id": "handle_encounters", "text": "Обработать события пути (escort_1-3): переговоры, бой, медицинская помощь", "type": "perform", "target": "escort-encounters", "count": 3, "optional": false}, {"id": "arrive_watson", "text": "Прибыть в Watson с беженцами", "type": "travel", "target": "watson-safe-zone", "count": 1, "optional": false}, {"id": "return_for_reward", "text": "Вернуться к контакту npc-marco-fix за наградой", "type": "interact", "target": "npc-marco-fix", "count": 1, "optional": false}]'::jsonb, '{"experience": 500, "currency": 600, "items": [{"item_id": "item-components-basic", "name": "Базовые компоненты", "quantity": 1}], "reputation": {"independent": 15}, "flags": ["red-dust-refugees-quest-completed", "evacuation-master-unlocked"]}'::jsonb, '[{"id": "cool_negotiation_path", "unlock_condition": {"type": "skill_check", "skill": "cool", "min_value": 15}, "consequences": {"experience": 100, "currency": 100, "reputation": {"independent": 5}, "flags": ["negotiation-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "social", "location": "global"}]}}, {"id": "medical_stabilization_path", "unlock_condition": {"type": "skill_check", "skill": "medical", "min_value": 13}, "consequences": {"experience": 100, "currency": 50, "reputation": {"independent": 3}, "flags": ["medical-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "medical", "location": "global"}]}}, {"id": "tactics_route_path", "unlock_condition": {"type": "skill_check", "skill": "tactics", "min_value": 14}, "consequences": {"experience": 100, "currency": 75, "reputation": {"independent": 4}, "flags": ["tactics-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "tactical", "location": "global"}]}}, {"id": "perception_alternative_path", "unlock_condition": {"type": "skill_check", "skill": "perception", "min_value": 14}, "consequences": {"experience": 100, "currency": 50, "reputation": {"independent": 3}, "flags": ["perception-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "exploration", "location": "global"}]}}]'::jsonb, '{"metadata": {"id": "quest-main-2045-red-dust-refugees", "title": "Архив — Основной квест: Беженцы Красной пыли (2045)", "document_type": "implementation", "category": "start-content", "status": "draft", "version": "2.0.0", "last_updated": "2025-12-01T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}], "tags": ["questline", "archive", "red-era"], "topics": ["quests", "escort"], "related_systems": ["gameplay-service", "quest-service", "narrative-service", "character-service", "economy-service"], "related_documents": [{"id": "quest-main-2040-red-dawn", "relation": "precedes"}], "source": "shared/docs/knowledge/implementation/start-content/quests/quest-main-2045-red-dust-refugees.md", "visibility": "internal", "audience": ["concept", "gameplay"], "risk_level": "low"}, "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Необходимо сохранить D&D-версию эвакуационного квеста после перехода на shooter.", "goal": "Структурировать цели, проверки и диалоговые ветки для архивного использования.", "essence": "Игрок обеспечивает эвакуацию беженцев, балансируя между переговорами, боём и тактическим планированием.", "key_points": ["Ветвления COOL 15, MEDICAL 13, TACTICS 14, PERCEPTION 14.", "Диалоговое дерево из 26 узлов с респаун сценарием.", "Базовые награды и API маппинг для исторического архива."]}, "quest_definition": {"quest_type": "main", "level_min": 8, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "meet_refugees", "text": "Встретиться с беженцами в Santo Domingo", "type": "interact", "target": "red-dust-refugees-group", "count": 1, "optional": false}, {"id": "ensure_route", "text": "Обеспечить безопасный маршрут эвакуации (TACTICS 14 для оптимального маршрута, PERCEPTION 14 для альтернативного пролаза)", "type": "perform", "target": "evacuation-route-planning", "count": 1, "optional": false}, {"id": "escort_refugees", "text": "Эскортировать беженцев из Santo Domingo в Watson (COOL 15 для переговоров с препятствиями, MEDICAL 13 для стабилизации раненых)", "type": "escort", "target": "refugees-escort-route", "count": 1, "optional": false}, {"id": "handle_encounters", "text": "Обработать события пути (escort_1-3): переговоры, бой, медицинская помощь", "type": "perform", "target": "escort-encounters", "count": 3, "optional": false}, {"id": "arrive_watson", "text": "Прибыть в Watson с беженцами", "type": "travel", "target": "watson-safe-zone", "count": 1, "optional": false}, {"id": "return_for_reward", "text": "Вернуться к контакту npc-marco-fix за наградой", "type": "interact", "target": "npc-marco-fix", "count": 1, "optional": false}], "rewards": {"experience": 500, "currency": 600, "items": [{"item_id": "item-components-basic", "name": "Базовые компоненты", "quantity": 1}], "reputation": {"independent": 15}, "flags": ["red-dust-refugees-quest-completed", "evacuation-master-unlocked"]}, "branches": [{"id": "cool_negotiation_path", "unlock_condition": {"type": "skill_check", "skill": "cool", "min_value": 15}, "consequences": {"experience": 100, "currency": 100, "reputation": {"independent": 5}, "flags": ["negotiation-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "social", "location": "global"}]}}, {"id": "medical_stabilization_path", "unlock_condition": {"type": "skill_check", "skill": "medical", "min_value": 13}, "consequences": {"experience": 100, "currency": 50, "reputation": {"independent": 3}, "flags": ["medical-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "medical", "location": "global"}]}}, {"id": "tactics_route_path", "unlock_condition": {"type": "skill_check", "skill": "tactics", "min_value": 14}, "consequences": {"experience": 100, "currency": 75, "reputation": {"independent": 4}, "flags": ["tactics-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "tactical", "location": "global"}]}}, {"id": "perception_alternative_path", "unlock_condition": {"type": "skill_check", "skill": "perception", "min_value": 14}, "consequences": {"experience": 100, "currency": 50, "reputation": {"independent": 3}, "flags": ["perception-master-unlocked"], "unlocked_content": [{"quest_type": "side", "category": "exploration", "location": "global"}]}}]}, "content": {"sections": [{"id": "synopsis", "title": "Синопсис", "body": "- ID: `quest-main-2045-red-dust-refugees`\\n- Контакт: `npc-marco-fix`\\n- Локации: Santo Domingo → Watson\\n- Тема: эвакуация, гуманизм, риски Red Era\\n", "mechanics_links": ["mechanics/quests/quest-system.yaml"]}, {"id": "objectives", "title": "Цели и ветвления", "body": "Основной маршрут: встреча с беженцами, обеспечение маршрута, эскорт, возврат за наградой.\\nВетви: COOL 15 (переговоры), MEDICAL 13 (стабилизация), TACTICS 14 (маршрут), PERCEPTION 14 (альтернативный пролаз).\\n", "mechanics_links": ["mechanics/combat/combat-shooter-core.yaml"]}, {"id": "parameters", "title": "D&D параметры", "body": "Инициатива d20 + REF, AC врагов 11–14, состояния подавление/кровотечение/радиационный ожог.\\n", "mechanics_links": ["mechanics/combat/combat-shooter-core.yaml"]}, {"id": "ux", "title": "UX экраны", "body": "Примеры интерфейсов: встреча с беженцами, выбор маршрута, прибытие в Watson.\\n", "mechanics_links": ["shared/docs/knowledge/implementation/ui/guild-contract-board.yaml"]}, {"id": "dialogue", "title": "Диалоговое дерево", "body": "Узлы `start`, `r_risks`, `r_arrive`, `r_med`, ветви проверки COOL/TACTICS/PERCEPTION, события пути `escort_1-3`, финал `complete`.\\n", "mechanics_links": ["mechanics/social/social-mechanics-overview.yaml"]}, {"id": "rewards", "title": "Награды и баланс", "body": "База: 500 XP, 600 eddies, `item-components-basic`, репутация independent +15.\\nБонусы за успешные проверки COOL, MEDICAL, TACTICS, PERCEPTION.\\n", "mechanics_links": ["mechanics/economy/stock-exchange/stock-analytics.yaml"]}, {"id": "interfaces", "title": "API маппинг", "body": "`POST /api/v1/quests/{id}/accept`, `/skill-check`, `/combat/start`, `/quests/{id}/complete`.\\nСоответствие JSON: `mvp-data-json/quests.json`.\\n", "mechanics_links": ["implementation/backend/quest-engine-backend.yaml"]}, {"id": "telemetry", "title": "Логи и QA", "body": "Логи проверок, боёв, эскорта; тесты: социальный, боевой, медицинский, тактический, провал/респаун.\\n", "mechanics_links": ["mechanics/quests/quest-system.yaml"]}]}, "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation": {"needs_task": false, "github_issue": 14, "queue_reference": ["shared/trackers/queues/concept/queued.yaml#quest-main-2045-red-dust-refugees"], "blockers": []}, "history": [{"version": "2.0.0", "date": "2025-12-01", "author": "content_writer", "changes": "Добавлен Issue в начало файла. Добавлена полная структура quest_definition с objectives, rewards и branches согласно архитектуре системы квестов. Создано 6 objectives на основе контента квеста (встретиться с беженцами, обеспечить маршрут, эскортировать, обработать события пути, прибыть в Watson, вернуться за наградой). Добавлены rewards: 500 XP, 600 currency, item-components-basic, репутация independent: 15, флаги для разблокировки контента. Добавлены 4 branches (cool_negotiation_path, medical_stabilization_path, tactics_route_path, perception_alternative_path) с правильной структурой unlock_condition и consequences, учитывающие проверки навыков COOL 15, MEDICAL 13, TACTICS 14, PERCEPTION 14."}, {"version": "1.0.0", "date": "2025-11-05", "author": "concept_team", "changes": "Исходная D&D спецификация квеста."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 1, true) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest
