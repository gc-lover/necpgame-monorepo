-- Issue: #50, #34
-- Import quest from: europe/berlin/2030-2039/quest-011-museum-island.yaml
-- Version: 2.1.0
-- Generated: 2025-12-12T00:49:14.638286

BEGIN;

-- Quest: quest-berlin-2039-museum-island
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES (
'quest-berlin-2039-museum-island', 
'Берлин 2030-2039 — Музейный остров', 
'Игрок покупает единый билет, активирует AR-реконструкции и завершает культурный рейд.', 
'side', 
3, 
NULL, 
'{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, 
'[{"id": "plan_museum_route", "text": "Выбрать порядок посещения музеев, забронировать временные слоты и получить цифровой путеводитель", "type": "interact", "target": "museum_island_route_planner", "count": 1, "optional": false}, {"id": "visit_pergamon_museum", "text": "Посетить Пергамский музей, активировать AR-восстановление Пергамского алтаря и ворот Иштар", "type": "explore", "target": "pergamon_museum", "count": 1, "optional": false}, {"id": "reconstruct_fragments", "text": "Пройти мини-игру по восстановлению фрагментов", "type": "interact", "target": "artifact_reconstruction_game", "count": 1, "optional": false}, {"id": "visit_neues_museum", "text": "Посетить Neues Museum, встретиться с бюстом Нефертити через AR и проанализировать реставрационные данные", "type": "investigate", "target": "neues_museum_nefertiti", "count": 1, "optional": false}, {"id": "visit_nationalgalerie", "text": "Посетить Alte Nationalgalerie и составить тематическую подборку картин", "type": "interact", "target": "alte_nationalgalerie_curation", "count": 1, "optional": false}, {"id": "visit_bode_museum", "text": "Посетить Bode Museum и изучить скульптурные коллекции", "type": "explore", "target": "bode_museum_sculptures", "count": 1, "optional": false}, {"id": "visit_altes_museum", "text": "Посетить Altes Museum и изучить античный зал", "type": "explore", "target": "altes_museum_antique_hall", "count": 1, "optional": false}, {"id": "create_cultural_report", "text": "Создать культурный отчёт с рекомендациями", "type": "create", "target": "cultural_report_creation", "count": 1, "optional": false}]'::jsonb, 
'{"experience": 5000, "currency": -50, "items": [{"item_id": "museum_island_expert_title", "name": "Титул «Знаток острова муз»", "quantity": 1}], "reputation": {"berlin_culture": 30}, "flags": ["museum_island_completed"]}'::jsonb, 
'[{"id": "art_focus", "unlock_condition": {"type": "skill_check", "skill": "art", "min_value": 0.6}, "consequences": {"reputation": {"berlin_culture": 5}, "flags": ["art_focus_bonus"], "unlocked_content": [{"quest_type": "side", "category": "art_collections", "location": "berlin"}]}}, {"id": "history_focus", "unlock_condition": {"type": "skill_check", "skill": "history", "min_value": 0.6}, "consequences": {"reputation": {"berlin_culture": 5}, "flags": ["history_focus_bonus"], "unlocked_content": [{"quest_type": "side", "category": "historical_artifacts", "location": "berlin"}]}}]'::jsonb, 
'{"metadata": {"id": "quest-berlin-2039-museum-island", "title": "Берлин 2030-2039 — Музейный остров", "document_type": "canon", "category": "timeline-quest", "status": "draft", "version": "2.1.0", "last_updated": "2025-12-01T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}], "tags": ["berlin", "museums", "unesco"], "topics": ["cultural_marathon", "world_heritage"], "related_systems": ["narrative-service", "exploration-service", "education-service"], "related_documents": [], "source": "shared/docs/knowledge/canon/lore/timeline-author/quests/europe/berlin/2030-2039/quest-011-museum-island.md", "visibility": "internal", "audience": ["concept", "narrative", "liveops"], "risk_level": "low"}, "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Линия Берлина требовала крупного культурного марафона по объекту UNESCO.", "goal": "Предложить игроку пройти все пять музеев острова и собрать коллекцию знаний.", "essence": "Игрок покупает единый билет, активирует AR-реконструкции и завершает культурный рейд.", "key_points": ["Охватывает ключевые экспонаты Пергама, Нефертити и византийского искусства.", "Использует AR-гиды и аудиоподкасты.", "Влияет на репутацию культурных фракций."]}, "quest_definition": {"quest_type": "side", "level_min": 3, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "plan_museum_route", "text": "Выбрать порядок посещения музеев, забронировать временные слоты и получить цифровой путеводитель", "type": "interact", "target": "museum_island_route_planner", "count": 1, "optional": false}, {"id": "visit_pergamon_museum", "text": "Посетить Пергамский музей, активировать AR-восстановление Пергамского алтаря и ворот Иштар", "type": "explore", "target": "pergamon_museum", "count": 1, "optional": false}, {"id": "reconstruct_fragments", "text": "Пройти мини-игру по восстановлению фрагментов", "type": "interact", "target": "artifact_reconstruction_game", "count": 1, "optional": false}, {"id": "visit_neues_museum", "text": "Посетить Neues Museum, встретиться с бюстом Нефертити через AR и проанализировать реставрационные данные", "type": "investigate", "target": "neues_museum_nefertiti", "count": 1, "optional": false}, {"id": "visit_nationalgalerie", "text": "Посетить Alte Nationalgalerie и составить тематическую подборку картин", "type": "interact", "target": "alte_nationalgalerie_curation", "count": 1, "optional": false}, {"id": "visit_bode_museum", "text": "Посетить Bode Museum и изучить скульптурные коллекции", "type": "explore", "target": "bode_museum_sculptures", "count": 1, "optional": false}, {"id": "visit_altes_museum", "text": "Посетить Altes Museum и изучить античный зал", "type": "explore", "target": "altes_museum_antique_hall", "count": 1, "optional": false}, {"id": "create_cultural_report", "text": "Создать культурный отчёт с рекомендациями", "type": "create", "target": "cultural_report_creation", "count": 1, "optional": false}], "rewards": {"experience": 5000, "currency": -50, "items": [{"item_id": "museum_island_expert_title", "name": "Титул «Знаток острова муз»", "quantity": 1}], "reputation": {"berlin_culture": 30}, "flags": ["museum_island_completed"]}, "branches": [{"id": "art_focus", "unlock_condition": {"type": "skill_check", "skill": "art", "min_value": 0.6}, "consequences": {"reputation": {"berlin_culture": 5}, "flags": ["art_focus_bonus"], "unlocked_content": [{"quest_type": "side", "category": "art_collections", "location": "berlin"}]}}, {"id": "history_focus", "unlock_condition": {"type": "skill_check", "skill": "history", "min_value": 0.6}, "consequences": {"reputation": {"berlin_culture": 5}, "flags": ["history_focus_bonus"], "unlocked_content": [{"quest_type": "side", "category": "historical_artifacts", "location": "berlin"}]}}]}, "content": {"sections": [{"id": "planning", "title": "Подготовка маршрута", "body": "Игрок выбирает порядок посещения музеев, бронирует временные слоты и получает цифровой путеводитель.\\n", "mechanics_links": ["mechanics/exploration/route-planner.yaml"], "assets": []}, {"id": "pergamon", "title": "Пергамский музей", "body": "AR-восстановление Пергамского алтаря и ворот Иштар. Мини-игра по восстановлению фрагментов.\\n", "mechanics_links": ["mechanics/education/artifact-reconstruction.yaml"], "assets": []}, {"id": "neues", "title": "Neues Museum", "body": "Встреча с бюстом Нефертити через расширенную реальность. Игрок анализирует реставрационные данные.\\n", "mechanics_links": ["mechanics/media/ar-analysis.yaml"], "assets": []}, {"id": "gallery", "title": "Alte Nationalgalerie", "body": "Необходимо составить тематическую подборку картин. Выбор жанра влияет на бонусы и реакцию кураторов.\\n", "mechanics_links": ["mechanics/social/curator-feedback.yaml"], "assets": []}, {"id": "finale", "title": "Финал в Bode и Altes", "body": "Игрок посещает скульптурные коллекции и античный зал. Итогом становится культурный отчёт с рекомендациями.\\n", "mechanics_links": ["mechanics/progression/report-creation.yaml"], "assets": []}, {"id": "rewards", "title": "Награды", "body": "- 5 000 XP, расходы 50 еддис, атрибут «Культура» +30.\\n- Титул «Знаток острова муз», доступ к международным выставкам liveops.\\n", "mechanics_links": ["mechanics/progression/title-unlock.yaml"], "assets": []}]}, "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation": {"github_issue": 719, "needs_task": false, "queue_reference": [], "blockers": []}, "history": [{"version": "2.1.0", "date": "2025-12-01", "author": "content_writer", "changes": "Добавлен Issue в начало файла. Исправлена структура branches: condition заменен на unlock_condition, удалены objectives из branches, добавлены consequences. Исправлена структура rewards.items: id заменен на item_id. Структура теперь полностью соответствует архитектуре."}, {"version": "2.0.0", "date": "2025-11-29", "author": "content_writer", "changes": "Добавлена полная структура quest_definition с objectives, rewards и branches. Детализирован контент согласно концепции. Добавлены механики культурного марафона и AR-реконструкций."}, {"version": "1.0.0", "date": "2025-11-13", "author": "concept_team", "changes": "Квест «Музейный остров» адаптирован под шаблон Concept Director."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 
1, 
true
) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest
