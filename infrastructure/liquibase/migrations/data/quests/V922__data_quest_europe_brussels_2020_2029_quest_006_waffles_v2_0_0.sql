-- Issue: #50, #34
-- Import quest from: europe/brussels/2020-2029/quest-006-waffles.yaml
-- Version: 2.0.0
-- Generated: 2025-12-12T00:49:14.748037

BEGIN;

-- Quest: quest-brussels-2029-waffles
INSERT INTO gameplay.quest_definitions (quest_id, title, description, quest_type, level_min, level_max, requirements, objectives, rewards, branches, content_data, version, is_active) VALUES (
'quest-brussels-2029-waffles', 
'Брюссель 2020-2029 — Бельгийские вафли', 
'Игрок ищет лучший киоск, выбирает стиль, настраивает топпинги и оценивает текстуру свежей выпечки.', 
'side', 
1, 
NULL, 
'{"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}'::jsonb, 
'[{"id": "find_waffle_stall", "text": "Найти вафельный киоск старой школы, ориентируясь по запахам и подсказкам местных жителей", "type": "travel", "target": "brussels_street_food_area", "count": 1, "optional": false}, {"id": "choose_waffle_style", "text": "Выбрать стиль вафли: лёгкие прямоугольные Brussels или карамелизированные округлые Liège", "type": "interact", "target": "waffle_stall_menu", "count": 1, "optional": false}, {"id": "play_topping_game", "text": "Пройти мини-игру по контролю температуры железа и последовательности добавления топпингов (шоколад, клубника, сливки)", "type": "perform", "target": "waffle_crafting_minigame", "count": 1, "optional": false}, {"id": "taste_and_review", "text": "Попробовать вафлю, записать впечатления для гастрономического блога и получить комментарии от NPC", "type": "interact", "target": "waffle_tasting_review", "count": 1, "optional": false}]'::jsonb, 
'{"experience": 600, "currency": -5, "items": [{"item_id": "sugar_rush_buff", "name": "Бафф «Сахарный прилив» (+15% Energy на 4 часа)", "quantity": 1}, {"item_id": "waffle_master_title", "name": "Титул «Вафельный мастер»", "quantity": 1}], "reputation": {"brussels_tourism": 10, "brussels_gastronomy": 10}, "flags": ["belgian_waffles_quest_completed", "waffle_week_liveops_unlocked"]}'::jsonb, 
'[{"id": "brussels_waffle_path", "unlock_condition": {"type": "choice_made", "choice_id": "waffle_style_choice", "value": "brussels"}, "consequences": {"currency": 0, "reputation": {"brussels_gastronomy": 5}, "flags": ["brussels_waffle_recipes_unlocked"], "unlocked_content": [{"quest_type": "side", "category": "gastronomy", "location": "brussels"}]}}, {"id": "liege_waffle_path", "unlock_condition": {"type": "choice_made", "choice_id": "waffle_style_choice", "value": "liege"}, "consequences": {"currency": 0, "reputation": {"brussels_gastronomy": 5}, "flags": ["liege_waffle_recipes_unlocked"], "unlocked_content": [{"quest_type": "side", "category": "gastronomy", "location": "brussels"}]}}]'::jsonb, 
'{"metadata": {"id": "quest-brussels-2029-waffles", "title": "Брюссель 2020-2029 — Бельгийские вафли", "document_type": "canon", "category": "timeline-quest", "status": "draft", "version": "2.0.0", "last_updated": "2025-12-01T00:00:00+00:00", "concept_approved": false, "concept_reviewed_at": "", "owners": [{"role": "concept_director", "contact": "concept@necp.game"}], "tags": ["brussels", "cuisine", "street-food"], "topics": ["culinary_tradition", "food_culture"], "related_systems": ["narrative-service", "gameplay-service", "quest-service", "character-service", "economy-service", "liveops-service", "social-service"], "related_documents": [], "source": "shared/docs/knowledge/canon/lore/timeline-author/quests/europe/brussels/2020-2029/quest-006-waffles.md", "visibility": "internal", "audience": ["concept", "narrative", "liveops"], "risk_level": "low"}, "review": {"chain": [{"role": "concept_director", "reviewer": "", "reviewed_at": "", "status": "pending"}], "next_actions": []}, "summary": {"problem": "Кулинарной линии Брюсселя требовался интерактивный разбор легендарных вафель двух стилей.", "goal": "Познакомить игрока с уличной культурой вафель и научить отличать Brussels от Liège рецептов.", "essence": "Игрок ищет лучший киоск, выбирает стиль, настраивает топпинги и оценивает текстуру свежей выпечки.", "key_points": ["Раскрывает историю двух школ вафель.", "Мини-игры по подбору топпингов и температур.", "Поддерживает liveops-акции гастрономических фестивалей."]}, "quest_definition": {"quest_type": "side", "level_min": 1, "level_max": null, "requirements": {"required_quests": [], "required_flags": [], "required_reputation": {}, "required_items": []}, "objectives": [{"id": "find_waffle_stall", "text": "Найти вафельный киоск старой школы, ориентируясь по запахам и подсказкам местных жителей", "type": "travel", "target": "brussels_street_food_area", "count": 1, "optional": false}, {"id": "choose_waffle_style", "text": "Выбрать стиль вафли: лёгкие прямоугольные Brussels или карамелизированные округлые Liège", "type": "interact", "target": "waffle_stall_menu", "count": 1, "optional": false}, {"id": "play_topping_game", "text": "Пройти мини-игру по контролю температуры железа и последовательности добавления топпингов (шоколад, клубника, сливки)", "type": "perform", "target": "waffle_crafting_minigame", "count": 1, "optional": false}, {"id": "taste_and_review", "text": "Попробовать вафлю, записать впечатления для гастрономического блога и получить комментарии от NPC", "type": "interact", "target": "waffle_tasting_review", "count": 1, "optional": false}], "rewards": {"experience": 600, "currency": -5, "items": [{"item_id": "sugar_rush_buff", "name": "Бафф «Сахарный прилив» (+15% Energy на 4 часа)", "quantity": 1}, {"item_id": "waffle_master_title", "name": "Титул «Вафельный мастер»", "quantity": 1}], "reputation": {"brussels_tourism": 10, "brussels_gastronomy": 10}, "flags": ["belgian_waffles_quest_completed", "waffle_week_liveops_unlocked"]}, "branches": [{"id": "brussels_waffle_path", "unlock_condition": {"type": "choice_made", "choice_id": "waffle_style_choice", "value": "brussels"}, "consequences": {"currency": 0, "reputation": {"brussels_gastronomy": 5}, "flags": ["brussels_waffle_recipes_unlocked"], "unlocked_content": [{"quest_type": "side", "category": "gastronomy", "location": "brussels"}]}}, {"id": "liege_waffle_path", "unlock_condition": {"type": "choice_made", "choice_id": "waffle_style_choice", "value": "liege"}, "consequences": {"currency": 0, "reputation": {"brussels_gastronomy": 5}, "flags": ["liege_waffle_recipes_unlocked"], "unlocked_content": [{"quest_type": "side", "category": "gastronomy", "location": "brussels"}]}}]}, "content": {"sections": [{"id": "hunt", "title": "Поиск вафельного киоска", "body": "Игрок ориентируется по запахам и подсказкам местных жителей, чтобы найти отмеченный в путеводителе киоск старой школы.\\n", "mechanics_links": ["mechanics/exploration/food-stall-hunt.yaml"], "assets": []}, {"id": "choice", "title": "Brussels или Liège", "body": "Нужно выбрать тесто: лёгкие прямоугольные Brussels или карамелизированные округлые Liège. От выбора зависит последующий бонус.\\n", "mechanics_links": ["mechanics/crafting/recipe-branch.yaml"], "assets": []}, {"id": "toppings", "title": "Топпинги и температура", "body": "Мини-игра контролирует температуру железа и последовательность добавления топпингов (шоколад, клубника, сливки). Ошибки меняют текстуру и очки вкуса.\\n", "mechanics_links": ["mechanics/crafting/dessert-customization.yaml"], "assets": []}, {"id": "tasting", "title": "Дегустация", "body": "Игрок записывает впечатления для гастрономического блога. Можно сравнить с американскими вафлями и получить комментарии от NPC.\\n", "mechanics_links": ["mechanics/social/food-review.yaml"], "assets": []}, {"id": "rewards", "title": "Награды", "body": "- 600 XP, расход 5 еддис, бафф «Сахарный прилив» (+15% Energy на 4 часа).\\n- Титул «Вафельный мастер» и доступ к liveops «Waffle Week».\\n", "mechanics_links": ["mechanics/progression/title-unlock.yaml"], "assets": []}]}, "appendix": {"glossary": [], "references": [], "decisions": []}, "implementation": {"github_issue": 688, "needs_task": false, "queue_reference": [], "blockers": []}, "history": [{"version": "2.0.0", "date": "2025-12-01", "author": "content_writer", "changes": "Добавлен Issue в начало файла. Добавлена полная структура quest_definition с objectives, rewards и branches согласно архитектуре системы квестов. Создано 4 objectives на основе контента квеста (найти киоск, выбрать стиль вафли, пройти мини-игру с топпингами, попробовать и оценить). Добавлены rewards: 600 XP, -5 currency, бафф \\"Сахарный прилив\\", титул \\"Вафельный мастер\\", репутация, флаги для разблокировки liveops. Добавлены 2 branches (brussels_waffle_path, liege_waffle_path) с правильной структурой unlock_condition и consequences."}, {"version": "1.0.0", "date": "2025-11-13", "author": "concept_team", "changes": "Квест «Бельгийские вафли» адаптирован под шаблон Concept Director."}], "validation": {"checksum": "", "schema_version": "1.0"}}'::jsonb, 
1, 
true
) ON CONFLICT (quest_id) DO UPDATE SET title = EXCLUDED.title, description = EXCLUDED.description, quest_type = EXCLUDED.quest_type, level_min = EXCLUDED.level_min, level_max = EXCLUDED.level_max, requirements = EXCLUDED.requirements, objectives = EXCLUDED.objectives, rewards = EXCLUDED.rewards, branches = EXCLUDED.branches, content_data = EXCLUDED.content_data, updated_at = CURRENT_TIMESTAMP;

COMMIT;

-- Total imported: 1 quest
