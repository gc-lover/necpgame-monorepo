# Issue: #142109960
# Adaptive Tick Rate Configuration
# Network Engineer - Configuration for adaptive tick rate system

adaptive_tickrate_config:
  version: "1.0.0"
  enabled: true
  
  general:
    adjustment_interval_seconds: 5
    min_tickrate: 20
    max_tickrate: 128
    smoothing_enabled: true
    smoothing_window_size: 3
  
  adjustment_factors:
    player_count:
      enabled: true
      weight: 0.6
      priority: "high"
      thresholds:
        - players_min: 0
          players_max: 50
          multiplier: 1.0
          description: "Мало игроков - полный тикрейт"
        - players_min: 50
          players_max: 100
          multiplier: 1.0
          description: "Среднее количество - полный тикрейт"
        - players_min: 100
          players_max: 200
          multiplier: 0.8
          description: "Много игроков - снижение на 20%"
        - players_min: 200
          players_max: 400
          multiplier: 0.6
          description: "Очень много - снижение на 40%"
        - players_min: 400
          players_max: 1000
          multiplier: 0.5
          description: "Много игроков - снижение на 50%"
        - players_min: 1000
          players_max: 9999
          multiplier: 0.4
          description: "Очень много - снижение на 60%"
    
    network_latency:
      enabled: true
      weight: 0.3
      priority: "high"
      measurement_method: "rtt_average"
      measurement_window_seconds: 10
      thresholds:
        - latency_ms_min: 0
          latency_ms_max: 50
          multiplier: 1.0
          description: "Отличная задержка - полный тикрейт"
        - latency_ms_min: 50
          latency_ms_max: 100
          multiplier: 0.9
          description: "Хорошая задержка - снижение на 10%"
        - latency_ms_min: 100
          latency_ms_max: 200
          multiplier: 0.7
          description: "Средняя задержка - снижение на 30%"
        - latency_ms_min: 200
          latency_ms_max: 500
          multiplier: 0.5
          description: "Высокая задержка - снижение на 50%"
        - latency_ms_min: 500
          latency_ms_max: 9999
          multiplier: 0.3
          description: "Очень высокая - снижение на 70%"
    
    cpu_usage:
      enabled: true
      weight: 0.1
      priority: "medium"
      measurement_method: "cpu_average"
      measurement_window_seconds: 10
      thresholds:
        - cpu_percent_min: 0
          cpu_percent_max: 50
          multiplier: 1.0
          description: "Низкая загрузка - полный тикрейт"
        - cpu_percent_min: 50
          cpu_percent_max: 70
          multiplier: 0.95
          description: "Средняя загрузка - снижение на 5%"
        - cpu_percent_min: 70
          cpu_percent_max: 85
          multiplier: 0.8
          description: "Высокая загрузка - снижение на 20%"
        - cpu_percent_max: 85
          cpu_percent_max: 95
          multiplier: 0.6
          description: "Очень высокая - снижение на 40%"
        - cpu_percent_min: 95
          cpu_percent_max: 100
          multiplier: 0.4
          description: "Критическая - снижение на 60%"
    
    memory_usage:
      enabled: false
      weight: 0.0
      priority: "low"
      measurement_method: "memory_percent"
      measurement_window_seconds: 10
      thresholds:
        - memory_percent_min: 0
          memory_percent_max: 70
          multiplier: 1.0
        - memory_percent_min: 70
          memory_percent_max: 85
          multiplier: 0.9
        - memory_percent_min: 85
          memory_percent_max: 95
          multiplier: 0.7
        - memory_percent_min: 95
          memory_percent_max: 100
          multiplier: 0.5
    
    bandwidth_usage:
      enabled: false
      weight: 0.0
      priority: "low"
      measurement_method: "bandwidth_percent"
      measurement_window_seconds: 10
      thresholds:
        - bandwidth_percent_min: 0
          bandwidth_percent_max: 70
          multiplier: 1.0
        - bandwidth_percent_min: 70
          bandwidth_percent_max: 85
          multiplier: 0.9
        - bandwidth_percent_min: 85
          bandwidth_percent_max: 95
          multiplier: 0.7
        - bandwidth_percent_min: 95
          bandwidth_percent_max: 100
          multiplier: 0.5

  priority_mechanics:
    enabled: true
    description: |
      Механики, которые не должны снижаться при адаптации тикрейта.
      Они критичны для игрового процесса.
    
    mechanics:
      - name: "combat"
        priority: "highest"
        min_tickrate_multiplier: 0.8
        description: "Боевые действия - критично для игрового процесса"
      
      - name: "movement"
        priority: "highest"
        min_tickrate_multiplier: 0.8
        description: "Движение - критично для отзывчивости"
      
      - name: "health"
        priority: "high"
        min_tickrate_multiplier: 0.9
        description: "Здоровье - важно для синхронизации"
      
      - name: "abilities"
        priority: "high"
        min_tickrate_multiplier: 0.9
        description: "Способности - важно для боевых действий"

  protected_mechanics:
    enabled: true
    description: |
      Механики, которые используют фиксированный тикрейт и не адаптируются.
      Они не критичны для realtime, но требуют стабильности.
    
    mechanics:
      - name: "inventory"
        tickrate: "event_based"
        description: "Инвентарь - event-based, не требует фиксированного тикрейта"
      
      - name: "trading"
        tickrate: "event_based"
        description: "Торговля - event-based, требует ACID транзакций"
      
      - name: "quests"
        tickrate: "event_based"
        description: "Квесты - event-based, не критично для realtime"
      
      - name: "chat"
        tickrate: "event_based"
        description: "Чат - event-based, eventual consistency"

  zone_specific_configs:
    pve_zones:
      adaptive_enabled: false
      reason: "PvE зоны используют фиксированный тикрейт для стабильности"
      fixed_tickrate: 30
    
    open_world_pve:
      adaptive_enabled: false
      reason: "PvE режим открытого мира использует фиксированный тикрейт"
      fixed_tickrate: 30
    
    open_world_pvp:
      adaptive_enabled: true
      base_tickrate: 60
      min_tickrate: 40
      max_tickrate: 80
      adjustment_factors:
        player_count:
          weight: 0.7
        network_latency:
          weight: 0.3
    
    pvp_small:
      adaptive_enabled: true
      base_tickrate: 128
      min_tickrate: 60
      max_tickrate: 128
      adjustment_factors:
        player_count:
          weight: 0.5
        network_latency:
          weight: 0.4
        cpu_usage:
          weight: 0.1
    
    gvg_200:
      adaptive_enabled: true
      base_tickrate: 80
      min_tickrate: 60
      max_tickrate: 80
      adjustment_factors:
        player_count:
          weight: 0.6
        network_latency:
          weight: 0.3
        cpu_usage:
          weight: 0.1
    
    gvg_400:
      adaptive_enabled: true
      base_tickrate: 60
      min_tickrate: 40
      max_tickrate: 60
      adjustment_factors:
        player_count:
          weight: 0.7
        network_latency:
          weight: 0.2
        cpu_usage:
          weight: 0.1
    
    massive_war:
      adaptive_enabled: true
      base_tickrate: 40
      min_tickrate: 20
      max_tickrate: 40
      adjustment_factors:
        player_count:
          weight: 0.8
        network_latency:
          weight: 0.15
        cpu_usage:
          weight: 0.05

  calculation_method:
    method: "weighted_average"
    formula: |
      adjusted_tickrate = base_tickrate * (
        player_count_multiplier * player_count_weight +
        network_latency_multiplier * network_latency_weight +
        cpu_usage_multiplier * cpu_usage_weight
      )
    
    smoothing:
      enabled: true
      method: "exponential_moving_average"
      alpha: 0.3
      description: "Сглаживание изменений для избежания резких скачков"

  limits_and_bounds:
    absolute_min_tickrate: 20
    absolute_max_tickrate: 128
    change_per_adjustment_percent: 10
    cooldown_after_change_seconds: 5
    
    bounds_by_zone_type:
      pve_zones:
        min: 20
        max: 30
      pvp_small:
        min: 60
        max: 128
      gvg_200:
        min: 60
        max: 80
      gvg_400:
        min: 40
        max: 60
      massive_war:
        min: 20
        max: 40

  monitoring:
    enabled: true
    metrics:
      - name: "tickrate_current"
        type: "gauge"
        description: "Текущий тикрейт"
      - name: "tickrate_target"
        type: "gauge"
        description: "Целевой тикрейт"
      - name: "tickrate_adjustment_factor"
        type: "gauge"
        description: "Коэффициент адаптации"
      - name: "tickrate_adjustments_total"
        type: "counter"
        description: "Общее количество корректировок"
      - name: "tickrate_change_duration_ms"
        type: "histogram"
        description: "Время изменения тикрейта"
    
    alerts:
      - name: "tickrate_too_low"
        condition: "tickrate_current < tickrate_target * 0.7"
        severity: "warning"
        description: "Тикрейт значительно ниже целевого"
      
      - name: "tickrate_too_high"
        condition: "tickrate_current > tickrate_target * 1.3"
        severity: "warning"
        description: "Тикрейт значительно выше целевого"
      
      - name: "tickrate_constant_adjustments"
        condition: "tickrate_adjustments_total > 10 в минуту"
        severity: "info"
        description: "Частые корректировки тикрейта"

  logging:
    enabled: true
    level: "info"
    log_adjustments: true
    log_factor_changes: false
    log_calculation_details: false

