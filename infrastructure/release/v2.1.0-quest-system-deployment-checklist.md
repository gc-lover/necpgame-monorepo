# NECPGAME v2.1.0 Quest System Deployment Checklist

**Release Date:** December 20, 2025
**Version:** v2.1.0
**Release Manager:** Release Agent
**Deployment Type:** Quest System Launch

## üìã Pre-Deployment Checklist

### OK Infrastructure Preparation
- [x] **Kubernetes Cluster Ready**
  - [x] Quest namespace created (`kubectl create namespace necpgame`)
  - [x] Resource quotas configured (`k8s/resource-quota.yaml`)
  - [x] Network policies applied (`k8s/networkpolicy-default.yaml`)

- [x] **Database Setup**
  - [x] PostgreSQL running with proper configuration
  - [x] Quest definitions table created (`V1_46__quest_definitions_tables.sql`)
  - [x] Quest data imported (`V1_47__import_miami_detroit_mexico_quests.sql`)
  - [x] Database indexes optimized for JSONB queries

- [x] **Monitoring Setup**
  - [x] Prometheus configured for quest services
  - [x] Grafana dashboard imported (`k8s/quest-monitoring-dashboard.yaml`)
  - [x] AlertManager configured for quest system alerts
  - [x] Loki and Promtail for log aggregation

### OK Security Validation
- [x] **SSL/TLS Certificates**
  - [x] Let's Encrypt certificates for api.necpgame.com and ws.necpgame.com
  - [x] Certificate renewal automation configured
  - [x] TLS 1.3 enabled on all ingress points

- [x] **Network Security**
  - [x] Rate limiting configured (100 req/min)
  - [x] Security headers applied (X-Frame-Options, X-Content-Type-Options)
  - [x] CORS configuration for WebSocket connections
  - [x] DDoS protection active

- [x] **Access Control**
  - [x] RBAC permissions for quest services
  - [x] Service accounts with minimal privileges
  - [x] Database credentials secured in Kubernetes secrets

### OK Application Deployment
- [x] **Service Images**
  - [x] gameplay-service-go:latest built and pushed
  - [x] quest-engine-websocket:latest built and pushed
  - [x] Images scanned for vulnerabilities
  - [x] Multi-architecture support (amd64/arm64)

- [x] **Configuration Files**
  - [x] Kubernetes manifests validated (`k8s/quest-service-ingress.yaml`)
  - [x] ConfigMaps created for application configuration
  - [x] Secrets populated with database and Redis credentials
  - [x] Environment variables configured for production

- [x] **CI/CD Pipeline**
  - [x] GitHub Actions workflow for quest system (`.github/workflows/ci-quest-system.yml`)
  - [x] Automated testing for quest content validation
  - [x] Database import testing completed
  - [x] Performance benchmarks passing

## üöÄ Deployment Execution

### Phase 1: Infrastructure Deployment (15 minutes)
```bash
# 1. Apply Kubernetes manifests
kubectl apply -f k8s/quest-service-ingress.yaml
kubectl apply -f k8s/quest-monitoring-dashboard.yaml

# 2. Verify namespace and resources
kubectl get all -n necpgame
kubectl get ingress -n necpgame

# 3. Check certificate status
kubectl get certificate -n necpgame
```

### Phase 2: Database Migration (10 minutes)
```bash
# 1. Run database migrations
kubectl exec -n necpgame deployment/necpgame-postgres -- \
  psql -U necpgame -d necpgame -f /migrations/V1_46__quest_definitions_tables.sql

# 2. Import quest data
kubectl exec -n necpgame deployment/necpgame-postgres -- \
  psql -U necpgame -d necpgame -f /migrations/V1_47__import_miami_detroit_mexico_quests.sql

# 3. Verify data integrity
kubectl exec -n necpgame deployment/necpgame-postgres -- \
  psql -U necpgame -d necpgame -c "SELECT COUNT(*) FROM gameplay.quest_definitions;"
```

### Phase 3: Service Deployment (20 minutes)
```bash
# 1. Deploy quest services
kubectl apply -f k8s/gameplay-service-go-deployment.yaml

# 2. Wait for rollout
kubectl rollout status deployment/gameplay-service-go -n necpgame

# 3. Deploy WebSocket service
kubectl apply -f k8s/quest-service-ingress.yaml

# 4. Verify service health
kubectl get pods -n necpgame
kubectl logs -f deployment/gameplay-service-go -n necpgame
```

### Phase 4: Traffic Migration (10 minutes)
```bash
# 1. Update ingress to route quest traffic
kubectl apply -f k8s/ingress.yaml

# 2. Verify ingress configuration
kubectl describe ingress necpgame-ingress -n necpgame

# 3. Test API endpoints
curl -k https://api.necpgame.com/health
curl -k https://api.necpgame.com/gameplay/quests
```

## üîç Post-Deployment Validation

### OK Functional Testing
- [ ] **API Endpoints**
  - [ ] Health check: `GET /health` ‚Üí 200 OK
  - [ ] Quest list: `GET /gameplay/quests` ‚Üí Returns quest data
  - [ ] Quest details: `GET /gameplay/quests/{id}` ‚Üí Returns specific quest
  - [ ] Quest reload: `POST /gameplay/quests/content/reload` ‚Üí Success

- [ ] **WebSocket Connections**
  - [ ] WebSocket upgrade: `ws://ws.necpgame.com/ws/quests/instance/123`
  - [ ] Message handling: Send/receive quest updates
  - [ ] Connection limits: Test 100+ concurrent connections
  - [ ] Reconnection logic: Test connection recovery

- [ ] **Database Operations**
  - [ ] Quest queries: Fast response times (< 50ms)
  - [ ] JSONB searches: Complex metadata queries working
  - [ ] Connection pooling: No connection exhaustion
  - [ ] Transaction integrity: ACID compliance verified

### OK Performance Validation
- [ ] **Latency Metrics**
  - [ ] P99 API latency < 50ms
  - [ ] WebSocket message latency < 100ms
  - [ ] Database query time < 10ms average

- [ ] **Resource Usage**
  - [ ] CPU usage < 70% per pod
  - [ ] Memory usage < 512Mi per pod
  - [ ] Network bandwidth < 10MB/s peak

- [ ] **Scalability Testing**
  - [ ] Horizontal scaling: HPA triggers at 70% CPU
  - [ ] Load balancing: Even traffic distribution
  - [ ] Connection limits: 2000+ concurrent WebSocket connections

### OK Security Validation
- [ ] **SSL/TLS**
  - [ ] Certificate valid and trusted
  - [ ] TLS 1.3 handshake successful
  - [ ] Certificate auto-renewal working

- [ ] **Access Control**
  - [ ] Rate limiting active (reject > 100 req/min)
  - [ ] Authentication required for protected endpoints
  - [ ] CORS headers present for WebSocket connections

- [ ] **Data Protection**
  - [ ] No sensitive data in logs
  - [ ] Database credentials encrypted
  - [ ] API keys properly secured

### OK Monitoring Validation
- [ ] **Metrics Collection**
  - [ ] Prometheus scraping quest services
  - [ ] Grafana dashboards showing data
  - [ ] Alert rules configured and active

- [ ] **Logging**
  - [ ] Structured JSON logs in Loki
  - [ ] Error logs properly aggregated
  - [ ] Performance logs captured

- [ ] **Health Checks**
  - [ ] Kubernetes probes passing
  - [ ] Custom health endpoints responding
  - [ ] Service dependencies healthy

## üîÑ Rollback Procedures

### Automatic Rollback (If performance degrades)
```bash
# Trigger conditions:
# - P99 latency > 100ms for 5 minutes
# - Error rate > 5% for 3 minutes
# - Memory usage > 85% for 10 minutes

# Automatic rollback:
kubectl rollout undo deployment/gameplay-service-go -n necpgame
kubectl rollout undo deployment/quest-engine-websocket -n necpgame
```

### Manual Rollback (Emergency)
```bash
# 1. Scale down new services
kubectl scale deployment gameplay-service-go --replicas=0 -n necpgame
kubectl scale deployment quest-engine-websocket --replicas=0 -n necpgame

# 2. Restore previous ingress
kubectl apply -f k8s/ingress-previous.yaml

# 3. Verify rollback
kubectl get pods -n necpgame
curl -k https://api.necpgame.com/health
```

### Database Rollback
```bash
# 1. Restore from backup
kubectl exec -n necpgame deployment/necpgame-postgres -- \
  pg_restore -U necpgame -d necpgame /backups/pre-quest-system.dump

# 2. Verify data integrity
kubectl exec -n necpgame deployment/necpgame-postgres -- \
  psql -U necpgame -d necpgame -c "SELECT COUNT(*) FROM gameplay.quest_definitions;"
```

## üìä Success Metrics

### Performance Targets (Must Meet)
- [ ] API P99 latency < 50ms
- [ ] WebSocket connection success rate > 99.9%
- [ ] Database query success rate > 99.95%
- [ ] Service uptime > 99.9%

### User Experience Targets
- [ ] Quest loading time < 2 seconds
- [ ] Real-time updates < 100ms latency
- [ ] No connection drops during gameplay
- [ ] All quest content accessible

### Operational Targets
- [ ] Monitoring coverage 100%
- [ ] Alert response time < 5 minutes
- [ ] Deployment time < 60 minutes
- [ ] Rollback time < 15 minutes

## üìû Emergency Contacts

### Technical Support
- **Release Manager:** Release Agent
- **DevOps Lead:** DevOps Agent
- **Database Admin:** Database Agent
- **Security Lead:** Security Agent

### External Resources
- **Monitoring Dashboard:** https://grafana.necpgame.com
- **Logs:** https://loki.necpgame.com
- **Alerts:** https://alertmanager.necpgame.com
- **Runbooks:** `/infrastructure/release/runbooks/`

## OK Final Sign-off

### Technical Sign-off
- [ ] **Performance:** All latency targets met
- [ ] **Security:** No security vulnerabilities
- [ ] **Operations:** Monitoring and alerting active
- [ ] **Quality:** All functional tests passing

### Business Sign-off
- [ ] **Product:** Quest system meets requirements
- [ ] **Engineering:** Code quality acceptable
- [ ] **Operations:** Infrastructure stable
- [ ] **Security:** System secure for production

---

**Deployment Checklist Created:** December 20, 2025
**Target Go-live:** December 20, 2025 18:00 UTC
**Rollback Window:** 24 hours
**Monitoring Period:** 72 hours
