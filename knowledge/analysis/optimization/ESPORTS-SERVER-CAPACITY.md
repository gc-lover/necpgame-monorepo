# Количество клиентов на инстанс в киберспортивных играх

## Стандартные форматы матчей

### Командные шутеры (Tactical FPS)
- **CS:GO / CS2**: 10 игроков на матч (5v5)
- **VALORANT**: 10 игроков на матч (5v5)
- **Rainbow Six Siege**: 10 игроков на матч (5v5)

### Командные шутеры (Hero-based)
- **Overwatch**: 12 игроков на матч (6v6)
- **Overwatch 2**: 10 игроков на матч (5v5)

### MOBA
- **Dota 2**: 10 игроков на матч (5v5)
- **League of Legends**: 10 игроков на матч (5v5)

### Battle Royale
- **Fortnite**: 100 игроков на матч
- **Apex Legends**: 60 игроков на матч
- **PUBG**: 100 игроков на матч

## Архитектура серверов

### Типичная архитектура киберспортивных игр

1. **Один игровой сервер = один матч**
   - Каждый матч запускается на отдельном инстансе игрового сервера
   - Игровой сервер обрабатывает логику матча и синхронизацию между игроками

2. **Gateway/Proxy сервер**
   - Обрабатывает WebSocket соединения от клиентов
   - Маршрутизирует сообщения между клиентами и игровыми серверами
   - Может обрабатывать несколько матчей одновременно

3. **Matchmaking сервер**
   - Управляет созданием матчей
   - Распределяет игроков по игровым серверам

## Анализ нашего решения

### Текущий лимит: 35 клиентов на Gateway инстанс

**Расчет для разных форматов:**

1. **5v5 матчи (CS:GO, VALORANT, Dota 2)**
   - 35 клиентов ÷ 10 игроков = **3-4 матча одновременно**
   - Это нормально для Gateway, который только маршрутизирует сообщения

2. **6v6 матчи (Overwatch)**
   - 35 клиентов ÷ 12 игроков = **2-3 матча одновременно**

3. **Battle Royale (100 игроков)**
   - 35 клиентов ÷ 100 игроков = **< 1 матча**
   - Недостаточно для Battle Royale

### Сравнение с индустрией

**Gateway/Proxy серверы обычно обрабатывают:**
- **Несколько матчей одновременно** (10-50+ матчей)
- **Сотни клиентов** (100-1000+ соединений)
- **Низкая задержка** (<50ms для киберспорта)

**Игровые серверы (Dedicated Game Servers):**
- **Один матч на инстанс** (10-12 игроков)
- **Высокая частота обновлений** (60-128 Hz)
- **Низкая задержка** (<20ms для киберспорта)

## Рекомендации

### Для нашего проекта

1. **Текущий лимит 35 клиентов достаточен для:**
   - Небольших турниров (3-4 матча одновременно)
   - Тестирования и разработки
   - MVP версии

2. **Для продакшена рекомендуется:**
   - **100-200 клиентов на Gateway инстанс** для поддержки 10-20 матчей одновременно
   - **Горизонтальное масштабирование** Gateway для больших нагрузок
   - **Load balancing** между несколькими Gateway инстансами

3. **Оптимизации для увеличения лимита:**
   - Worker pool (уже реализовано)
   - Connection pooling
   - Message batching (отклонено пользователем)
   - Spatial partitioning (для фильтрации GameState)
   - Network LOD (Level of Detail)

### Целевые метрики для продакшена

- **Gateway инстанс**: 100-200 клиентов (10-20 матчей 5v5)
- **Latency**: <50ms (competitive gaming standard)
- **Error rate**: <0.5% (competitive gaming standard)
- **Throughput**: 6000-12000 msg/s (100-200 клиентов × 60 Hz)

## Экшен MMORPG с 60+ Hz

### Особенности экшен MMORPG

Экшен MMORPG с элементами стрельбы и высокой динамикой требуют:
- **Высокую частоту обновлений**: 60+ Hz (16.6ms между обновлениями)
- **Низкую задержку**: <50ms для комфортной игры
- **Большое количество игроков**: десятки-сотни на одном инстансе

### Примеры из индустрии

#### MMOFPS (Massively Multiplayer Online FPS)

1. **PlanetSide 2**
   - **Игроков на континент**: до 450 игроков одновременно
   - **Tick rate**: 20-30 Hz (не 60 Hz из-за масштаба)
   - **Особенности**: Большие карты, рассредоточенные бои

2. **Battlefield 2042**
   - **Игроков на сервер**: 128 игроков (PS5/Xbox Series X/PC)
   - **Tick rate**: 60 Hz
   - **Особенности**: Высокая динамика, интенсивные бои

#### Экшен MMORPG

1. **Guild Wars 2 (World vs World)**
   - **Игроков на карту**: 100-200 игроков в WvW
   - **Tick rate**: ~30 Hz (не 60 Hz)
   - **Особенности**: Массовые PvP сражения

2. **Black Desert Online (Node Wars/Siege)**
   - **Игроков на инстанс**: 50-100 игроков в Node Wars
   - **Tick rate**: ~30 Hz
   - **Особенности**: Экшен-боевая система, массовые сражения

3. **New World**
   - **Игроков на сервер**: 2000-2500 игроков (весь сервер)
   - **Игроков в зоне**: 50-100 игроков в активных зонах
   - **Tick rate**: ~30 Hz (не 60 Hz для всего сервера)
   - **Особенности**: Экшен-боевая система, но с зонированием

### Выводы для экшен MMORPG с 60+ Hz

**Типичные лимиты:**
- **50-150 игроков на инстанс** при 60 Hz
- **100-300 игроков на инстанс** при 30-40 Hz
- **200-450 игроков на инстанс** при 20-30 Hz (PlanetSide 2)

**Факторы, влияющие на лимит:**
1. **Tick rate**: Чем выше частота, тем меньше игроков можно поддерживать
2. **Размер карты**: Большие карты позволяют рассредоточить игроков
3. **Сложность игрового мира**: Количество объектов, NPC, взаимодействий
4. **Оптимизация**: Эффективность кода и сетевой архитектуры

**Рекомендации для нашего проекта:**

1. **Для экшен MMORPG с 60 Hz:**
   - **Целевой лимит**: 100-150 клиентов на Gateway инстанс
   - **Это соответствует**: 10-15 активных зон/инстансов с 10-15 игроками в каждой

2. **Для масштабных сражений (WvW, Siege):**
   - **Целевой лимит**: 200-300 клиентов на Gateway инстанс
   - **Tick rate**: Можно снизить до 30-40 Hz для больших сражений
   - **Это соответствует**: 1-2 массовым сражениям с 100-150 игроками

3. **Оптимизации для увеличения лимита:**
   - Spatial partitioning (уже упоминалось)
   - Network LOD (Level of Detail)
   - Adaptive tick rate (снижение частоты при большом количестве игроков)
   - Зонирование мира (разделение на отдельные инстансы)

## Выводы

### Для киберспортивных игр (5v5, 6v6)

1. **Текущий лимит 35 клиентов** соответствует **3-4 матчам 5v5**, что достаточно для MVP и небольших турниров

2. **Для продакшена** рекомендуется увеличить лимит до **100-200 клиентов** для поддержки 10-20 матчей одновременно

3. **Игровые серверы (UE5)** остаются с лимитом **1 матч на инстанс** (10-12 игроков), что является стандартом для киберспортивных игр

### Для экшен MMORPG с 60+ Hz

1. **Текущий лимит 35 клиентов** недостаточен для экшен MMORPG

2. **Для экшен MMORPG рекомендуется:**
   - **100-150 клиентов** при 60 Hz (10-15 активных зон)
   - **200-300 клиентов** при 30-40 Hz (массовые сражения)

3. **Архитектура должна поддерживать:**
   - Горизонтальное масштабирование Gateway
   - Load balancing между инстансами
   - Мониторинг и автоматическое масштабирование
   - Spatial partitioning для оптимизации GameState
   - Network LOD для снижения нагрузки
   - Adaptive tick rate для баланса между производительностью и качеством

## Источники

- Стандартные форматы матчей из официальных источников игр
- Архитектура серверов на основе публичной информации от Riot Games, Valve, Blizzard
- Competitive gaming network standards (см. COMPETITIVE-GAMING-NETWORK-STANDARDS.md)

