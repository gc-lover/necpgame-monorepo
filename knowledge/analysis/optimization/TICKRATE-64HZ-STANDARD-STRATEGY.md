# Стратегия 64 Hz как стандарта для MMORPG FPS

## Issue: #142109960

**Дата создания:** 2025-11-30  
**Цель:** Определить стратегию использования 64 Hz как стандарта для всего мира или адаптивного тикрейта

---

## [TARGET] Решение: 64 Hz как стандарт + динамический тикрейт

### Основной принцип:

**64 Hz - базовый стандарт для всего мира с динамической адаптацией под активность**

---

## [SYMBOL] Текущая архитектура зон

### Типы зон в MMORPG FPS:

1. **Safe Zones (Безопасные зоны)** - города, торговые зоны
   - Протокол: WebSocket (TCP) - постоянно
   - PvP: отключен
   - Текущий тикрейт: 30 Hz

2. **Open World Zones (Открытый мир)** - PvE зоны с возможностью PvP
   - Протокол: WebSocket (TCP) по умолчанию
   - Протокол в бою: UDP (динамическое переключение)
   - PvP: возможен
   - Текущий тикрейт: 30 Hz (PvE), динамический (PvP)

3. **Dedicated PvP Zones (Выделенные PvP зоны)**
   - Small PvP (5-20 игроков): UDP, **было 128 Hz → 64 Hz** [OK]
   - GvG 200 (100v100): UDP, 60-80 Hz
   - GvG 400 (200v200): UDP, 40-60 Hz
   - Massive War (2000+): UDP, 20-40 Hz

---

## [OK] Рекомендуемая стратегия

### 1. **64 Hz - стандарт для FPS активности**

#### Для PvP Small (5-20 игроков):
- **Базовый тикрейт:** 64 Hz [OK]
- **Максимум:** 128 Hz (только для competitive турниров с 10 игроками)
- **Минимум:** 64 Hz (стабильный стандарт)

#### Для Open World PvP (открытый мир):
- **Базовый тикрейт:** 64 Hz [OK]
- **Динамическая адаптация:**
  - Нет боя (PvE): 30 Hz (WebSocket)
  - В бою (PvP): 64 Hz (UDP, при переключении протокола)
  - Много игроков (50+): 60 Hz (снижение)

---

### 2. **Динамический тикрейт для открытого мира**

**Почему нужен динамический тикрейт:**

1. **Разная активность в разных зонах:**
   - В некоторых зонах нет боя (PvE, исследование) → 30 Hz достаточно
   - В других зонах активный PvP → 64 Hz необходимо

2. **Разное количество игроков:**
   - 10 игроков в зоне: 64 Hz
   - 50+ игроков: 60 Hz (снижение)
   - 100+ игроков: 40-50 Hz (снижение)

3. **Переключение протокола:**
   - WebSocket (30 Hz) → UDP (64 Hz) при входе в бой
   - UDP (64 Hz) → WebSocket (30 Hz) при выходе из боя

---

## [SYMBOL] Таблица тикрейтов (обновленная)

| Тип зоны | Протокол | Базовый тикрейт | Динамический | Максимум | Минимум | Примечание |
|----------|----------|-----------------|--------------|----------|---------|------------|
| **Safe Zones** | WebSocket | 30 Hz | [ERROR] Нет | 30 Hz | 30 Hz | Нет PvP, стабильно |
| **Open World (PvE)** | WebSocket | 30 Hz | [ERROR] Нет | 30 Hz | 30 Hz | Нет боя, стабильно |
| **Open World (PvP)** | UDP | **64 Hz** | [OK] Да | 64 Hz | 40 Hz | В бою, динамический |
| **PvP Small (10-20)** | UDP | **64 Hz** | [OK] Да | 128 Hz | 64 Hz | Стандарт, максимум для competitive |
| **GvG 200** | UDP | 60 Hz | [OK] Да | 80 Hz | 40 Hz | Spatial partitioning |
| **GvG 400** | UDP | 60 Hz | [OK] Да | 60 Hz | 40 Hz | Spatial sharding |
| **Massive War** | UDP | 30-40 Hz | [OK] Да | 40 Hz | 20 Hz | Кластер, LOD |

---

## [SYMBOL] Алгоритм динамического тикрейта для открытого мира

### Условия адаптации:

1. **Переключение протокола (WebSocket ↔ UDP):**
   ```
   WebSocket (30 Hz) → UDP (64 Hz) при:
   - Вход в бой
   - Вход в PvP зону
   - Встреча с враждебным игроком
   
   UDP (64 Hz) → WebSocket (30 Hz) при:
   - Выход из боя
   - Выход из PvP зоны
   - Нет враждебных игроков 30+ секунд
   ```

2. **Адаптация тикрейта в пределах UDP (64 Hz):**
   ```
   64 Hz (базовый):
   - 5-20 игроков в зоне
   - Нормальная активность
   
   60 Hz (снижение):
   - 50+ игроков в зоне
   - Высокая CPU нагрузка (>70%)
   - Высокая network latency (>50ms)
   
   50-60 Hz (дальнейшее снижение):
   - 100+ игроков в зоне
   - Очень высокая CPU нагрузка (>85%)
   
   40-50 Hz (критичное снижение):
   - 150+ игроков в зоне
   - Критичная CPU нагрузка (>90%)
   ```

---

## [OK] Может ли быть 64 Hz стабильно для всего мира?

### Ответ: **НЕТ, нужен динамический тикрейт**

**Причины:**

1. **Разные типы зон требуют разных тикрейтов:**
   - Safe zones: 30 Hz достаточно (нет боя)
   - Open world PvE: 30 Hz достаточно (редкий бой)
   - Open world PvP: 64 Hz необходимо (активный бой)

2. **Экономическая эффективность:**
   - 64 Hz для всех = избыточная нагрузка на CPU/Network
   - 30 Hz для PvE = достаточно, экономит ресурсы
   - 64 Hz только при необходимости = оптимальный баланс

3. **Переключение протокола:**
   - WebSocket (TCP) для PvE = надежность
   - UDP для PvP = низкая latency
   - Переключение протокола = изменение тикрейта

4. **Масштабирование:**
   - Много зон с разной активностью
   - Некоторые зоны пустые (10 игроков) → 64 Hz
   - Некоторые зоны полные (100+ игроков) → 40-50 Hz

---

## [TARGET] Рекомендуемая стратегия

### 1. **64 Hz - стандарт для FPS активности** [OK]

**Где применять:**
- [OK] PvP Small (10-20 игроков): 64 Hz базовый
- [OK] Open World PvP (в бою): 64 Hz при переключении на UDP
- [OK] Выделенные PvP зоны: 64 Hz базовый

**Где НЕ применять:**
- [ERROR] Safe zones: 30 Hz (нет боя)
- [ERROR] Open World PvE: 30 Hz (редкий бой)

---

### 2. **Динамический тикрейт для открытого мира** [OK]

**Алгоритм:**

```
┌─────────────────────────────────────┐
│  Игрок в открытом мире              │
│  WebSocket (TCP), 30 Hz            │
└──────────────┬──────────────────────┘
               │
               │ Вход в бой / PvP зона
               ▼
┌─────────────────────────────────────┐
│  Переключение на UDP                │
│  Тикрейт: 64 Hz (базовый)          │
└──────────────┬──────────────────────┘
               │
               │ Мониторинг нагрузки
               ▼
┌─────────────────────────────────────┐
│  Адаптация тикрейта:                │
│  - 5-20 игроков: 64 Hz             │
│  - 50+ игроков: 60 Hz              │
│  - 100+ игроков: 50 Hz             │
│  - CPU >85%: снижение              │
└──────────────┬──────────────────────┘
               │
               │ Выход из боя / PvP зоны
               ▼
┌─────────────────────────────────────┐
│  Переключение на WebSocket          │
│  Тикрейт: 30 Hz                    │
└─────────────────────────────────────┘
```

---

### 3. **Приоритеты тикрейта**

| Приоритет | Сценарий | Тикрейт | Обоснование |
|-----------|----------|---------|-------------|
| **Highest** | PvP Small (10-20) | 64 Hz | Стандарт для FPS |
| **High** | Open World PvP (в бою) | 64 Hz | FPS активность |
| **Medium** | Open World PvE | 30 Hz | Редкий бой |
| **Medium** | Safe Zones | 30 Hz | Нет боя |
| **Low** | Massive War | 20-40 Hz | Масштаб требует снижения |

---

## [SYMBOL] Сравнение стратегий

### Вариант 1: **64 Hz стабильно для всего мира** [ERROR]

**Проблемы:**
- Избыточная нагрузка на CPU/Network в безопасных зонах
- Нет экономии ресурсов
- Неоптимально для разных типов активности

**Вывод:** [ERROR] Не рекомендуется

---

### Вариант 2: **Динамический тикрейт (рекомендуется)** [OK]

**Преимущества:**
- [OK] 64 Hz для FPS активности (PvP)
- [OK] 30 Hz для PvE (экономия ресурсов)
- [OK] Автоматическая адаптация под нагрузку
- [OK] Переключение протокола (WebSocket ↔ UDP)
- [OK] Оптимальный баланс качества и производительности

**Вывод:** [OK] Рекомендуется

---

## [TARGET] Итоговые рекомендации

### 1. **64 Hz - стандарт для FPS активности** [OK]

- PvP Small (10-20 игроков): **64 Hz базовый**, 128 Hz максимум (competitive)
- Open World PvP (в бою): **64 Hz** при переключении на UDP
- Выделенные PvP зоны: **64 Hz базовый**

### 2. **Динамический тикрейт для открытого мира** [OK]

- Safe zones: **30 Hz** (стабильно, WebSocket)
- Open World PvE: **30 Hz** (стабильно, WebSocket)
- Open World PvP: **64 Hz** (динамический, UDP при переключении)
- Адаптация: 64 Hz → 60 Hz → 50 Hz при росте нагрузки

### 3. **Переключение протокола** [OK]

- WebSocket (30 Hz) ↔ UDP (64 Hz)
- Автоматическое переключение при входе/выходе из боя
- Плавное изменение тикрейта

---

## [NOTE] Выводы

1. **64 Hz - стандарт для FPS активности, но НЕ для всего мира**
   - [OK] 64 Hz для PvP зон и активности
   - [ERROR] Нельзя 64 Hz стабильно для всего (неоптимально)

2. **Динамический тикрейт - необходимость для MMORPG FPS**
   - [OK] Разные зоны = разные тикрейты
   - [OK] Разная активность = адаптация тикрейта
   - [OK] Переключение протокола = изменение тикрейта

3. **Оптимальная стратегия:**
   - 30 Hz для PvE (экономия ресурсов)
   - 64 Hz для PvP (качество FPS)
   - Динамическая адаптация под нагрузку

---

**Последнее обновление:** 2025-11-30

