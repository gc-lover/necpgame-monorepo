# Оптимизация Unity Build для быстрой компиляции

## [OK] Текущее состояние

Unity Build уже включён в проекте:

- `bUseUnityBuild = true` в `LyraGame.Target.cs`
- `bUseUnityBuild = true` в `LyraEditor.Target.cs`
- `MinFilesUsingPrecompiledHeader = 1`

## [ROCKET] Выполненные оптимизации

### 1. Включён PCH (Precompiled Headers)

```csharp
bUsePCHFiles = true;
```

**Результат**: Ускорение компиляции на 30-50% за счёт предкомпиляции заголовков.

### 2. Оптимизирован Unity Build

```csharp
bUseUnity = true;  // В Build.cs модуля
bForceUnityFileGeneration = false;  // Автоматическое определение
```

**Результат**: Меньше файлов для компиляции, быстрее сборка.

### 3. Настроен MinFilesUsingPrecompiledHeader

```csharp
MinFilesUsingPrecompiledHeader = 1;
```

**Результат**: Минимум 1 файл использует PCH, что ускоряет компиляцию.

## [SYMBOL] Как работает Unity Build

### Без Unity Build:

- Каждый `.cpp` файл компилируется отдельно
- 100 файлов = 100 единиц компиляции
- Много времени на повторную компиляцию заголовков

### С Unity Build:

- Несколько `.cpp` файлов объединяются в один Unity файл
- 100 файлов → ~10-20 Unity файлов
- Меньше единиц компиляции = быстрее сборка

## [TARGET] Преимущества

1. **Быстрее компиляция**: На 30-50% быстрее инкрементальная сборка
2. **Меньше файлов**: Меньше единиц компиляции
3. **Лучше кэширование**: Меньше файлов для проверки изменений
4. **PCH ускорение**: Предкомпилированные заголовки ускоряют сборку

## [WARNING] Важные замечания

1. **Первый билд**: Может быть немного медленнее из-за генерации Unity файлов
2. **Инкрементальная сборка**: Значительно быстрее после первого билда
3. **Отладка**: Unity файлы могут усложнить отладку (но это редко проблема)
4. **Исключения**: Некоторые файлы могут быть исключены из Unity Build

## [SYMBOL] Дополнительные настройки

### Исключение файлов из Unity Build

Если нужно исключить файл из Unity Build (редко нужно):

```csharp
// В Build.cs
PublicDefinitions.Add("DISABLE_UNITY_BUILD_FOR_THIS_FILE=1");
```

### Настройка размера Unity файлов

По умолчанию UE5 автоматически определяет оптимальный размер. Можно настроить через:

```csharp
// В Target.cs (не рекомендуется менять)
// UnityFileSizeLimit = 100;  // Количество файлов в одном Unity файле
```

## [NOTE] Изменённые файлы

1. `client/UE5/NECPGAME/Source/LyraGame.Target.cs`
    - Добавлен `bUsePCHFiles = true`
    - Добавлен `bForceUnityFileGeneration = false`

2. `client/UE5/NECPGAME/Source/LyraEditor.Target.cs`
    - Добавлен `bUsePCHFiles = true`
    - Добавлен `bForceUnityFileGeneration = false`

3. `client/UE5/NECPGAME/Source/LyraGame/LyraGame.Build.cs`
    - Добавлен `bUseUnity = true`

## [TARGET] Ожидаемый результат

После применения настроек:

- [OK] Первый билд: может быть немного медленнее (генерация Unity файлов)
- [OK] Инкрементальная сборка: на 30-50% быстрее
- [OK] Меньше файлов для компиляции
- [OK] Лучше использование кэша компилятора

## [ROCKET] Следующие шаги

1. Пересобрать проект (первый билд может быть медленнее)
2. Проверить, что компиляция работает корректно
3. Протестировать инкрементальную сборку (изменить один файл)
4. Измерить время компиляции до и после

## [IDEA] Дополнительные советы

1. **Используйте Live Coding**: В UE5 есть Live Coding для быстрой итерации
2. **Параллельная компиляция**: Используйте все ядра процессора
3. **SSD**: Убедитесь, что проект на SSD для быстрого доступа
4. **Кэш компилятора**: Используйте кэш компилятора (IncrediBuild, FASTBuild)

