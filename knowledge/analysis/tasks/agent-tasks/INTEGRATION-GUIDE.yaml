metadata:
  id: agent-tasks-integration-guide
  title: "Руководство по интеграции существующих YAML задач с Cursor Background Agents"
  document_type: documentation
  category: tasks
  status: draft
  version: "1.0.0"
  last_updated: 2025-11-22T00:00:00Z
  owners:
    - role: tech_director
      contact: tech@necp.game
  tags:
    - agent-tasks
    - integration
    - cursor
    - yaml-tasks
  visibility: internal
  audience:
    - tech_director
    - developers
    - agents
summary:
  problem: Существует множество YAML файлов с задачами, квестами и механиками, которые нужно интегрировать с Cursor Background Agents
  goal: Объяснить, как существующие YAML файлы могут быть загружены и использованы агентами Cursor
  essence: Интеграция между существующей структурой задач (roadmap, active tasks) и новым форматом для агентов Cursor
  key_points:
    - Существующие YAML файлы уже содержат метаданные и структуру задач
    - Roadmap файлы содержат задачи с приоритетами и зависимостями
    - Контент и механики в YAML формате можно использовать для задач агентов
    - REST API система (workqueue-service) уже поддерживает работу с задачами
content:
  sections:
    - id: existing_structure
      title: Существующая структура YAML файлов
      body: |
        В проекте уже есть структурированные YAML файлы:
        
        **1. Roadmap задачи (knowledge/analysis/tasks/roadmap/):**
        - v0.1-tech-demo.yaml, v0.2-mvp-foundation.yaml и т.д.
        - Содержат секцию `tasks` с приоритетами (critical, high, medium, low)
        - Каждая задача имеет: id, title, description, priority, status, dependencies, estimated_effort, notes, related_documents, implementation_paths
        
        **2. Активные задачи (knowledge/analysis/tasks/active/):**
        - CURRENT-WORK/active/*.yaml
        - TODO.yaml
        - Содержат metadata, summary, content, review, implementation
        
        **3. Игровой контент (knowledge/content/):**
        - quests/*.yaml - квесты в структурированном формате
        - Каждый квест имеет metadata, stages, dialogues, encounters
        
        **4. Механики (knowledge/mechanics/):**
        - combat/*.yaml - описание боевых механик
        - economy/*.yaml - экономические системы
        - Каждая механика имеет metadata, summary, content
        
        **5. REST API система (knowledge/implementation/):**
        - agent-operating-manual.yaml - руководство по REST API
        - agent-scenarios.yaml - сценарии работы агентов
        - Поддерживает работу с очередями через workqueue-service
        
    - id: integration_approach
      title: Подход к интеграции
      body: |
        **Вариант 1: Прямое использование существующих YAML файлов**
        - Агенты Cursor могут читать существующие YAML файлы напрямую
        - Использовать metadata и структуру задач из roadmap файлов
        - Преобразовывать существующие задачи в формат для агентов на лету
        
        **Вариант 2: Создание адаптера**
        - Создать скрипт, который преобразует существующие задачи в формат для агентов
        - Использовать существующие YAML как источник данных
        - Генерировать файлы в knowledge/analysis/tasks/agent-tasks/ из roadmap
        
        **Вариант 3: Единая структура**
        - Использовать существующую структуру metadata как основу
        - Добавить специфичные для агентов поля в существующие файлы
        - Создать маппинг между существующими полями и полями для агентов
        
    - id: mapping_structure
      title: Маппинг существующих структур
      body: |
        **Roadmap задачи → Agent задачи:**
        
        ```yaml
        # Roadmap формат (v0.1-tech-demo.yaml)
        tasks:
          critical:
            - id: infra-001
              title: Настройка базовой инфраструктуры
              description: |
                Настроить Docker Compose...
              priority: critical
              status: completed
              dependencies: []
              related_documents: [...]
              implementation_paths: [...]
        
        # Agent формат (agent-tasks/*.yaml)
        metadata:
          id: infra-001
          title: Настройка базовой инфраструктуры
          priority: critical
          status: completed
        task:
          description: |
            Настроить Docker Compose...
        dependencies:
          tasks: []
          documents: [...]
        implementation:
  github_issue: 197
          steps:
            - step: 1
              files: [...]
              code_paths: [...]
        ```
        
        **Контент квесты → Agent задачи:**
        
        ```yaml
        # Контент формат (content/quests/*.yaml)
        metadata:
          id: content-quest-001
          title: Первый квест
        content:
          sections:
            - id: stages
              title: Стадии квеста
              body: |
                Описание стадий...
        
        # Agent формат для контента
        metadata:
          id: agent-task-quest-001
          title: Добавить квест "Первый квест"
        task:
          description: |
            Создать игровой контент для квеста...
        related_content:
          quests:
            - knowledge/content/quests/mq-001-first-steps.yaml
        ```
        
        **Механики → Agent задачи:**
        
        ```yaml
        # Механика формат (mechanics/combat/*.yaml)
        metadata:
          id: combat-inventory
          title: Система инвентаря
        summary:
          problem: Нужна система хранения предметов
          goal: Реализовать инвентарь
        
        # Agent формат для реализации
        metadata:
          id: agent-task-inventory-system
          title: Реализация системы инвентаря
        task:
          description: |
            Реализовать систему инвентаря...
        related_content:
          mechanics:
            - knowledge/mechanics/combat/combat-loadouts-system.yaml
        ```
        
    - id: loading_process
      title: Процесс загрузки задач
      body: |
        **1. Поиск задач в roadmap:**
        - Сканировать knowledge/analysis/tasks/roadmap/*.yaml
        - Извлекать задачи со статусом pending или in-progress
        - Фильтровать по приоритету (critical, high, medium, low)
        
        **2. Загрузка связанного контента:**
        - Читать related_documents из задачи
        - Загружать YAML файлы из knowledge/content/ и knowledge/mechanics/
        - Использовать metadata и content для контекста
        
        **3. Создание задач для агентов:**
        - Преобразовывать roadmap задачи в формат агентов
        - Добавлять инструкции для агентов из agent-tasks/template.yaml
        - Связывать с существующими документами
        
        **4. Интеграция с REST API (опционально):**
        - Использовать workqueue-service для управления задачами
        - Синхронизировать статусы между YAML файлами и REST API
        - Поддерживать workflow через agent-scenarios.yaml
        
    - id: agent_instructions
      title: Инструкции для агентов по работе с существующими файлами
      body: |
        Агенты должны:
        
        1. **Читать задачи из roadmap:**
           - Искать в knowledge/analysis/tasks/roadmap/*.yaml
           - Обрабатывать секцию `tasks` с приоритетами
           - Учитывать dependencies и related_documents
        
        2. **Загружать связанный контент:**
           - Читать YAML файлы из related_documents
           - Использовать knowledge/content/ для контентных задач
           - Использовать knowledge/mechanics/ для задач реализации механик
        
        3. **Следовать структуре:**
           - Использовать metadata для идентификации
           - Читать summary для понимания задачи
           - Использовать content/sections для деталей
        
        4. **Обновлять статусы:**
           - Обновлять status в roadmap файлах
           - Добавлять notes с результатами
           - Создавать коммиты с описанием изменений
        
        5. **Проверять по чеклистам:**
           - Использовать .cursor/rules/CODE-REVIEW-CHECKLIST.mdc
           - Следовать SOLID принципам из .cursor/rules/SOLID.mdc
           - Соблюдать стиль кода из .cursor/rules/UE5-CPP-STYLE.mdc
        
    - id: example_workflows
      title: Примеры workflow
      body: |
        **Workflow 1: Реализация задачи из roadmap**
        
        1. Агент читает v0.1-tech-demo.yaml
        2. Находит задачу со статусом pending
        3. Загружает related_documents для контекста
        4. Создает код в implementation_paths
        5. Проверяет по чеклистам
        6. Обновляет status в roadmap файле
        7. Создает коммит
        
        **Workflow 2: Добавление контента из квеста**
        
        1. Агент читает knowledge/content/quests/mq-001-first-steps.yaml
        2. Создает задачу для реализации квеста
        3. Использует структуру из квеста (stages, dialogues, encounters)
        4. Интегрирует с quest-service
        5. Создает тесты для квеста
        6. Обновляет документацию
        
        **Workflow 3: Реализация механики из описания**
        
        1. Агент читает knowledge/mechanics/combat/combat-inventory.yaml
        2. Создает задачу для реализации системы
        3. Использует summary и content для понимания требований
        4. Создает интерфейсы и классы в UE5
        5. Интегрирует с backend (Java микросервисы)
        6. Создает тесты и документацию
        
    - id: tools_and_scripts
      title: Инструменты и скрипты
      body: |
        **Скрипт для преобразования roadmap → agent tasks:**
        
        ```powershell
        # pipeline/scripts/convert-roadmap-to-agent-tasks.ps1
        # Преобразует задачи из roadmap в формат для агентов
        ```
        
        **Скрипт для загрузки связанного контента:**
        
        ```powershell
        # pipeline/scripts/load-related-content.ps1
        # Загружает YAML файлы из related_documents
        ```
        
        **Интеграция с REST API (workqueue-service):**
        
        - Использовать agent-task.ps1 для работы с REST API
        - Синхронизировать статусы между YAML и REST API
        - Поддерживать workflow через agent-scenarios.yaml
        
appendix:
  glossary:
    - term: roadmap task
      definition: Задача из файла knowledge/analysis/tasks/roadmap/*.yaml
    - term: agent task
      definition: Задача в формате для Cursor Background Agents
    - term: content task
      definition: Задача для работы с игровым контентом (квесты, диалоги)
    - term: mechanic task
      definition: Задача для реализации игровых механик
  references:
    - title: Agent Operating Manual
      link: knowledge/implementation/agent-operating-manual.yaml
    - title: Agent Scenarios
      link: knowledge/implementation/agent-scenarios.yaml
    - title: Roadmap README
      link: knowledge/analysis/tasks/roadmap/README.yaml
    - title: Agent Tasks Template
      link: knowledge/analysis/tasks/agent-tasks/template.yaml
  decisions:
    - decision: Использовать существующую структуру YAML как основу
      rationale: Уже есть структурированные задачи и контент, не нужно дублировать
      date: 2025-11-22
    - decision: Создать маппинг между существующими форматами и форматом агентов
      rationale: Позволяет использовать существующие файлы без изменений
      date: 2025-11-22
