metadata:
  id: player-feedback-system
  title: Система обратной связи от игроков - in-game форма для создания Issues
  document_type: analysis
  category: ideas
  status: in_progress
  version: '1.0.0'
  last_updated: 2025-11-23T12:00:00Z
  concept_approved: false
  concept_reviewed_at: ''
  processed_by: idea-writer
  processed_at: 2025-11-23T12:00:00Z
  github_issue_number: 1335
  owners:
    - role: idea_writer
      contact: idea-writer@necp.game
  tags:
    - player-feedback
    - in-game-ui
    - github-integration
    - community
    - workflow
  topics:
    - game-design
    - backend
    - client
    - automation
  related_systems:
    - character-service
    - session-service
    - notification-service
  related_documents:
    - id: github-issue-1335
      title: GitHub Issue #1335
      link: https://github.com/gc-lover/necpgame-monorepo/issues/1335
      relation: migrated_to
      migrated_at: 2025-11-23T12:00:00Z
  source: user_request
  visibility: internal
  audience:
    - game-design
    - backend
    - client
    - community
  risk_level: medium
review:
  chain:
    - role: idea_writer
      reviewer: ''
      reviewed_at: ''
      status: in_progress
  next_actions:
    - Передача Architect для проектирования архитектуры
    - Проработка детального UI/UX дизайна
    - Создание OpenAPI спецификации
summary:
  problem: |
    Игроки не имеют возможности напрямую из игры отправлять предложения, идеи и пожелания разработчикам.
    Вся обратная связь происходит через внешние каналы (Discord, форумы, email), что создает барьер для игроков
    и усложняет сбор и обработку обратной связи. Нет автоматизации процесса создания задач из обращений игроков.
  goal: |
    Создать интегрированную систему обратной связи, которая позволяет игрокам:
    - Отправлять предложения, идеи и пожелания прямо из игры
    - Видеть статус своих предложений
    - Получать уведомления о рассмотрении предложений
    - Автоматически создавать GitHub Issues для обработки предложений агентами
  essence: |
    Система состоит из трех основных компонентов:
    1. In-Game UI форма в стиле Cyberpunk для отправки обращений
    2. Бекенд сервис (Go) для приема данных и создания GitHub Issues
    3. Агент для обработки предложений и маршрутизации к соответствующим агентам
  key_points:
    - In-game форма с полями для типа обращения, категории, заголовка, описания
    - Автоматический сбор контекста игры (локация, уровень, активные квесты)
    - Бекенд сервис feedback-service для обработки обращений
    - Интеграция с GitHub API для автоматического создания Issues
    - Агент для классификации и маршрутизации обращений
    - Система уведомлений игрокам о статусе обращений
content:
  sections:
    - id: in-game-ui
      title: In-Game UI форма (UE5)
      body: |
        **Визуальный дизайн:**
        
        **Общий стиль:**
        - Cyberpunk эстетика с неоновыми элементами (синий, фиолетовый, розовый)
        - Полупрозрачный фон с эффектом размытия (blur)
        - Голографические границы элементов
        - Анимированные частицы при взаимодействии
        - Градиентные переходы цветов
        - Scanline эффект для создания атмосферы
        
        **Модальное окно:**
        - Размер: 80% экрана по ширине, 90% по высоте (центрировано)
        - Фон: темный с прозрачностью 0.9, размытие
        - Граница: неоновая рамка с пульсирующим эффектом
        - Заголовок: "КОРПОРАТИВНЫЙ КАНАЛ СВЯЗИ" в стиле киберпанк
        - Кнопка закрытия: X в правом верхнем углу с hover эффектом
        
        **Доступ:**
        - Горячая клавиша: F12 (настраиваемая)
        - Меню игры: раздел "Обратная связь"
        - Терминалы в игровом мире (опционально)
        
        **Поля формы:**
        
        **1. Тип обращения (обязательное):**
        - Радио-кнопки или выпадающий список
        - Варианты:
          * Предложение/Идея (feature request) - иконка лампочки
          * Баг репорт (bug report) - иконка жука
          * Пожелание (wishlist) - иконка звезды
          * Вопрос/Обратная связь (feedback) - иконка сообщения
        - Визуальная подсветка выбранного варианта
        
        **2. Категория (обязательное):**
        - Выпадающий список или кнопки
        - Варианты:
          * Геймплей (gameplay) - иконка контроллера
          * Баланс (balance) - иконка весов
          * Контент (content) - иконка документа
          * Техническое (technical) - иконка шестеренки
          * Лор/Сюжет (lore/narrative) - иконка книги
          * UI/UX - иконка интерфейса
          * Другое (other) - иконка многоточия
        
        **3. Заголовок (обязательное, до 100 символов):**
        - Текстовое поле с подсветкой границ
        - Счетчик символов в реальном времени
        - Placeholder: "Кратко опишите ваше обращение..."
        - Валидация: минимум 10 символов
        
        **4. Описание (обязательное, до 2000 символов):**
        - Многострочное текстовое поле
        - Минимальная высота: 150px
        - Счетчик символов
        - Placeholder: "Опишите детали вашего обращения..."
        - Валидация: минимум 50 символов
        - Поддержка форматирования (опционально)
        
        **5. Приоритет (опционально):**
        - Выпадающий список или кнопки
        - Варианты:
          * Низкий - зеленый цвет
          * Средний - желтый цвет
          * Высокий - оранжевый цвет
          * Критический - красный цвет
        - По умолчанию: Средний
        
        **6. Скриншоты/Видео (опционально, до 3 файлов):**
        - Кнопка "Добавить файл"
        - Drag & drop зона
        - Превью загруженных файлов
        - Кнопка удаления для каждого файла
        - Максимальный размер файла: 10MB
        - Поддерживаемые форматы: PNG, JPG, MP4
        
        **7. Контекст игры (автоматически, только для просмотра):**
        - Секция "Информация о сессии"
        - Отображается в свернутом виде по умолчанию
        - Поля:
          * Версия игры: [автоматически]
          * Локация: [текущая локация игрока]
          * Уровень персонажа: [текущий уровень]
          * Активные квесты: [список активных квестов]
          * Время в игре: [общее время сессии]
          * ID персонажа: [скрыто, только для сервера]
        
        **UX механики:**
        
        **Автосохранение:**
        - Автоматическое сохранение черновика каждые 30 секунд
        - Сохранение при закрытии формы
        - Восстановление черновика при повторном открытии
        - Индикатор "Черновик сохранен"
        
        **Валидация:**
        - Валидация в реальном времени
        - Подсветка невалидных полей красным
        - Сообщения об ошибках под полями
        - Кнопка отправки неактивна до валидации всех обязательных полей
        
        **Анимации:**
        - Плавное появление модального окна (fade in + scale)
        - Анимация отправки: прогресс бар с процентами
        - Эффект "передачи данных" при отправке
        - Успешная отправка: зеленый checkmark с анимацией
        - Ошибка: красный крестик с сообщением
        
        **Подтверждение:**
        - Модальное окно подтверждения после успешной отправки
        - Отображение ID обращения
        - Ссылка на GitHub Issue (если создан)
        - Кнопка "Закрыть" или "Отправить еще"
        
        **История обращений:**
        - Вкладка "Мои обращения" в форме
        - Список отправленных обращений с:
          * Заголовком
          * Статусом (цветовая индикация)
          * Дата отправки
          * Ссылка на Issue (если есть)
        - Фильтрация по статусу
        - Поиск по заголовку
      mechanics_links: []
      assets: []
    - id: backend-service
      title: Бекенд сервис (Go)
      body: |
        **Новый микросервис: `feedback-service`**
        
        **Основные функции:**
        - Прием данных от клиента через REST API
        - Валидация и санитизация данных
        - Сохранение обращений в БД
        - Интеграция с GitHub API для создания Issues
        - Управление статусами обращений
        - Уведомления игрокам о статусе
        - Rate limiting для предотвращения спама
        - Анонимизация данных игрока
        
        **API Endpoints:**
        
        **1. POST /api/v1/feedback/submit**
        - Отправка нового обращения
        - Требует аутентификации (сессия игрока)
        - Request body:
          ```json
          {
            "type": "feature_request|bug_report|wishlist|feedback",
            "category": "gameplay|balance|content|technical|lore|ui|other",
            "title": "string (max 100 chars)",
            "description": "string (max 2000 chars)",
            "priority": "low|medium|high|critical",
            "screenshots": ["base64_encoded_images"],
            "game_context": {
              "version": "string",
              "location": "string",
              "level": "int",
              "active_quests": ["string"],
              "playtime": "duration"
            }
          }
          ```
        - Response:
          ```json
          {
            "id": "uuid",
            "status": "pending",
            "github_issue_number": 1234,
            "github_issue_url": "https://github.com/...",
            "created_at": "timestamp"
          }
          ```
        - Rate limit: 5 обращений в час на игрока
        
        **2. GET /api/v1/feedback/{id}**
        - Получение статуса обращения по ID
        - Требует аутентификации
        - Response:
          ```json
          {
            "id": "uuid",
            "type": "string",
            "category": "string",
            "title": "string",
            "status": "pending|in_review|assigned|in_progress|resolved|rejected|duplicate",
            "github_issue_number": 1234,
            "github_issue_url": "https://github.com/...",
            "created_at": "timestamp",
            "updated_at": "timestamp"
          }
          ```
        
        **3. GET /api/v1/feedback/player/{player_id}**
        - История обращений игрока
        - Требует аутентификации (только свои обращения)
        - Query params:
          - `status` - фильтр по статусу
          - `type` - фильтр по типу
          - `limit` - количество результатов (default: 20)
          - `offset` - пагинация
        - Response:
          ```json
          {
            "items": [...],
            "total": 100,
            "limit": 20,
            "offset": 0
          }
          ```
        
        **4. POST /api/v1/feedback/{id}/update-status**
        - Обновление статуса обращения (только для агентов/админов)
        - Требует специальной аутентификации
        - Request body:
          ```json
          {
            "status": "string",
            "comment": "string (optional)"
          }
          ```
        
        **5. GET /api/v1/feedback/stats**
        - Статистика обращений (для админов)
        - Требует специальной аутентификации
        
        **Интеграция с GitHub:**
        - Использование GitHub API (REST или GraphQL)
        - GitHub App для аутентификации
        - Автоматическое создание Issue при отправке обращения
        - Шаблон Issue:
          ```markdown
          ## Обращение от игрока
          
          **Тип:** {type}
          **Категория:** {category}
          **Приоритет:** {priority}
          
          ### Описание
          {description}
          
          ### Контекст игры
          - Версия: {version}
          - Локация: {location}
          - Уровень: {level}
          - Активные квесты: {quests}
          
          ### Скриншоты
          {screenshots if any}
          
          ---
          *Обращение ID: {id}*
          *Создано: {created_at}*
          ```
        - Автоматическое добавление меток:
          - `player-feedback` - все обращения
          - `agent:idea-writer` - для feature_request
          - `agent:qa` - для bug_report
          - `priority-{priority}` - приоритет
          - `{category}` - категория
        
        **Безопасность:**
        - Rate limiting: 5 обращений/час на игрока
        - Валидация всех входных данных
        - Санитизация текста (защита от XSS)
        - Анонимизация player_id в Issues
        - Аутентификация через session token
        - Логирование всех операций
      mechanics_links: []
      assets: []
    - id: feedback-agent
      title: Агент для обработки предложений
      body: |
        **Новый агент или расширение Idea Writer: `agent:player-feedback`**
        
        **Ответственность:**
        - Мониторинг Issues с меткой `player-feedback`
        - Классификация обращений по типу и категории
        - Первичная обработка и структурирование
        - Проверка на дубликаты
        - Маршрутизация к соответствующим агентам
        - Обновление статусов обращений в БД
        - Уведомление игроков о рассмотрении
        - Отслеживание прогресса обработки
        
        **Workflow обработки:**
        
        **1. Обнаружение нового обращения:**
        - Агент периодически проверяет Issues с меткой `player-feedback` и статусом `open`
        - Использует GitHub API для получения списка Issues
        - Фильтрует по метке и дате создания (последние 24 часа)
        
        **2. Классификация:**
        - Анализирует тип обращения из Issue body
        - Определяет категорию
        - Извлекает приоритет
        - Проверяет контекст игры
        
        **3. Проверка на дубликаты:**
        - Поиск похожих Issues по заголовку и описанию
        - Использование семантического поиска
        - Если найден дубликат:
          * Добавляет метку `duplicate`
          * Комментирует Issue со ссылкой на оригинал
          * Обновляет статус в БД на `duplicate`
          * Уведомляет игрока
        
        **4. Структурирование:**
        - Форматирует Issue для лучшей читаемости
        - Добавляет структурированные секции
        - Выделяет ключевые моменты
        
        **5. Маршрутизация:**
        - **feature_request** → `agent:idea-writer` + `stage:idea`
        - **bug_report** → `agent:qa` + `stage:testing`
        - **wishlist** → `agent:idea-writer` + `stage:idea`
        - **feedback** → `agent:idea-writer` + `stage:idea`
        
        Дополнительная маршрутизация по категории:
        - **balance** → добавляет `agent:game-balance`
        - **technical** → добавляет `agent:backend` или `agent:ue5`
        - **content** → добавляет `agent:content-writer`
        - **lore** → добавляет `agent:content-writer`
        
        **6. Обновление меток:**
        - Удаляет метку `player-feedback` (или оставляет для отслеживания)
        - Добавляет метки соответствующего агента
        - Добавляет метку этапа разработки
        - Сохраняет приоритет
        
        **7. Обновление статуса:**
        - Обновляет статус в БД через API feedback-service
        - Статус меняется на `in_review` → `assigned` → `in_progress`
        
        **8. Уведомление игрока:**
        - Отправляет уведомление через notification-service
        - Тип уведомления: "Ваше обращение получено и передано на рассмотрение"
        - Включает ссылку на GitHub Issue
        
        **9. Отслеживание прогресса:**
        - Периодически проверяет статус Issue
        - При изменении статуса Issue обновляет БД
        - Уведомляет игрока о значимых изменениях
        
        **Правила обработки:**
        - Обработка в порядке приоритета (critical → high → medium → low)
        - Максимум 10 обращений в час (rate limiting агента)
        - Логирование всех действий
        - Обработка ошибок с retry механизмом
      mechanics_links: []
      assets: []
    - id: lore-integration
      title: Лор для системы
      body: |
        **В игровом мире:**
        Система обратной связи представлена как "Корпоративный канал связи" или "Система обращений к администрации".
        Игроки могут отправлять обращения через терминалы в игровом мире или через интерфейс персонажа.
        
        **Визуальный стиль:**
        - Неоновые элементы интерфейса
        - Голографические эффекты
        - Cyberpunk эстетика
        - Анимации передачи данных
        
        **Локации:**
        - Терминалы в основных хабах города
        - Интерфейс персонажа (меню)
        - Горячая клавиша для быстрого доступа
      mechanics_links: []
      assets: []
    - id: technical-details
      title: Технические детали
      body: |
        **БД схема (примерная):**
        - Таблица `player_feedback` с полями:
          - id (UUID)
          - player_id (UUID)
          - type (VARCHAR)
          - category (VARCHAR)
          - title (VARCHAR)
          - description (TEXT)
          - priority (VARCHAR)
          - game_context (JSONB)
          - screenshots (TEXT[])
          - github_issue_number (INT)
          - github_issue_url (TEXT)
          - status (VARCHAR)
          - created_at, updated_at (TIMESTAMP)
        
        **Безопасность:**
        
        **Rate Limiting:**
        - 5 обращений в час на игрока (настраиваемо)
        - 20 обращений в день на игрока
        - Глобальный лимит: 1000 обращений в час
        - Использование токенов (token bucket algorithm)
        - Возврат HTTP 429 при превышении лимита
        - Retry-After заголовок с временем ожидания
        
        **Валидация данных:**
        - Валидация на клиенте (UE5) перед отправкой
        - Строгая валидация на сервере (Go)
        - Проверка типов данных
        - Проверка длины строк
        - Валидация форматов файлов
        - Проверка размера файлов (макс 10MB)
        
        **Санитизация:**
        - Очистка HTML тегов из текста
        - Экранирование специальных символов
        - Защита от XSS атак
        - Защита от SQL injection (prepared statements)
        - Валидация URL в описаниях
        
        **Аутентификация:**
        - Аутентификация через session token
        - Проверка валидности сессии через session-service
        - Проверка прав доступа (только свои обращения)
        - JWT токены для API агентов
        
        **Анонимизация:**
        - Player ID не отображается в GitHub Issues
        - Использование анонимного ID для связи
        - Контекст игры без личных данных
        - Логирование с маскированием чувствительных данных
        
        **Мониторинг:**
        - Логирование всех операций
        - Метрики для rate limiting
        - Алерты при подозрительной активности
        - Аудит доступа к данным
        
        **Защита от злоупотреблений:**
        - Автоматическое обнаружение спама
        - Блокировка подозрительных аккаунтов
        - Модерация контента (опционально)
        - Система репутации игроков
        
        **Интеграции:**
        - GitHub API - создание Issues
        - Character Service - получение данных игрока
        - Session Service - валидация сессии
        - Notification Service - уведомления игрокам
      mechanics_links: []
      assets: []
    - id: workflow
      title: Workflow обработки
      body: |
        **Поток данных:**
        1. Игрок заполняет форму в игре
        2. Клиент отправляет данные на `feedback-service`
        3. Сервис валидирует и сохраняет в БД
        4. Сервис создает GitHub Issue через API
        5. Агент `player-feedback` мониторит новые Issues
        6. Агент классифицирует и маршрутизирует обращение
        7. Соответствующий агент обрабатывает обращение
        8. Статус обновляется в БД и уведомляется игрок
        
        **Статусы обращений:**
        - `pending` - ожидает обработки
        - `in_review` - рассматривается агентом
        - `assigned` - назначено агенту
        - `in_progress` - в работе
        - `resolved` - решено
        - `rejected` - отклонено
        - `duplicate` - дубликат
      mechanics_links: []
      assets: []
appendix:
  glossary:
    - term: player-feedback
      definition: Обращение от игрока через in-game форму
    - term: feedback-service
      definition: Микросервис для обработки обращений игроков
    - term: player-feedback-agent
      definition: Агент для классификации и маршрутизации обращений
  references:
    - title: GitHub Issue #1335
      link: https://github.com/gc-lover/necpgame-monorepo/issues/1335
    - title: AGENT_WORKFLOW.md
      link: .github/AGENT_WORKFLOW.md
  decisions:
    - date: 2025-11-23
      decision: Создать отдельный микросервис feedback-service вместо интеграции в существующие сервисы
      rationale: Изоляция функциональности, независимое масштабирование
implementation:
  github_issue: 1335
  needs_task: true
  queue_reference: []
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-23
    author: idea-writer
    changes: Создана детальная концепция системы обратной связи от игроков
validation:
  checksum: ''
  schema_version: '1.0'

