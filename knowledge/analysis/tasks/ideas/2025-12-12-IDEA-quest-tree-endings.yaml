# Issue: #1446
metadata:
  id: analysis-idea-quest-tree-endings
  title: Квестовое дерево с концовками
  document_type: analysis
  category: ideas
  status: draft
  version: '1.0.0'
  last_updated: 2025-12-12T00:00:00Z
  github_issue_number: 1446
  owners:
    - role: analysis_lead
      contact: brain@necp.game
  tags:
    - quests
    - branching
    - narrative
  topics:
    - endings
    - player_choice
  related_systems:
    - quest-service
    - choice-tracking
    - npc-service
  related_documents:
    - knowledge/analysis/tasks/ideas/quest-tree-endings-system-concept.md
  source: https://github.com/gc-lover/necpgame-monorepo/issues/1446
summary:
  problem: Нужно широкое дерево квестов с множественными концовками и влиянием выборов.
  goal: Описать структуру дерева, ветвление, метрики выбора и интеграцию с квест-киперами.
  essence: Разветвлённое дерево с влиянием флагов, репутации и таймеров на финалы.
  key_points:
    - Много концовок, завязанных на выборы и фракции.
    - Трекинг флагов/таймеров/репутации.
    - Сервис выбора обновляет доступные ветки.
    - Метрики по частоте финалов.
content:
  structure:
    layers:
      - act1_setup
      - act2_branching
      - act3_convergence_or_divergence
    endings:
      - pacifist_resolution
      - faction_takeover
      - betrayal_twist
      - fail_state_timer
  choice_signals:
    flags: [faction_trust, moral_choice, time_left]
    timers:
      soft_fail_sec: 900
      hard_fail_sec: 1800
  telemetry:
    events:
      - name: quest_branch_selected
        fields: [branch_id, signal]
      - name: quest_ending_reached
        fields: [ending_type]
    metrics:
      - ending_distribution
      - average_branches_visited
      - timer_fail_rate
risks:
  - взрыв сложности при росте веток
  - дисбаланс частот концовок без аналитики
  - несогласованность с квест-киперами по флагам

