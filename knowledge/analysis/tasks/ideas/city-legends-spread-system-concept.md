<!-- Issue: #1468 -->
# Система распространения легенд между NPC - Концепция

## Обзор

Система распространения легенд моделирует естественное распространение информации между NPC, создавая ощущение живого мира, где байки передаются из уст в уста. Информация искажается со временем, обрастая деталями и преувеличениями, превращая реальные события в настоящие городские легенды.

## Лор в мире Cyberpunk 2077

### Контекст распространения информации

В мире NECPGAME информация распространяется не мгновенно, а через социальные сети NPC. Каждый NPC имеет связи с другими NPC, и эти связи определяют, как быстро и в каком виде информация достигает разных частей города.

**Как работает распространение слухов:**
- Информация начинается с NPC-свидетелей событий
- Распространяется через социальные связи (друзья, коллеги, знакомые)
- Время и расстояние искажают информацию
- Фракции интерпретируют события по-своему
- Важные события распространяются быстрее

**Атмосфера:**
- Бармены, информаторы и фиксёры — основные источники слухов
- Уличные банды передают информацию через свои сети
- Корпорации контролируют информацию внутри своих структур
- Нейтральные NPC получают искажённую информацию
- Время превращает факты в мифы

## Источники легенд

### Прямые свидетели

**Лор:**
NPC, которые видели событие лично, становятся первичными источниками информации. Они знают точные детали, но их знания ограничены тем, что они видели.

**Механика:**
- NPC-свидетели получают информацию с точностью 100%
- Множество деталей о событии
- Информация актуальна сразу после события
- Свидетели могут быть разными типами NPC (бармены, охранники, прохожие)

**Примеры:**
- Бармен Afterlife видел, как легендарный игрок победил в бою
- Охранник корпорации видел конфликт с легендой
- Уличный информатор был свидетелем экономической сделки

**Визуальный стиль:**
- NPC-свидетели имеют особое поведение (взволнованы, рассказывают другим)
- Визуальные индикаторы присутствия свидетелей (опционально)
- Диалоги свидетелей содержат больше деталей

### Вторичные источники

**Лор:**
NPC, которые узнали от свидетелей, становятся вторичными источниками. Они знают основную информацию, но некоторые детали теряются или искажаются.

**Механика:**
- NPC получают информацию от свидетелей через социальные связи
- Точность информации: 70-90%
- Меньше деталей, чем у свидетелей
- Информация распространяется в течение 1-3 дней

**Примеры:**
- Друг бармена узнал от него про легенду
- Коллега охранника узнал про конфликт
- Знакомый информатора узнал про сделку

**Визуальный стиль:**
- NPC рассказывают информацию с меньшей уверенностью
- Меньше деталей в диалогах
- Возможны небольшие искажения

### Третичные источники и далее

**Лор:**
NPC, которые узнали от других (не свидетелей), становятся третичными источниками. Информация сильно искажается, обрастая деталями и преувеличениями.

**Механика:**
- NPC получают информацию через цепочку передач
- Точность информации: 30-60%
- Сильные искажения и преувеличения
- Информация распространяется в течение 3-7 дней

**Примеры:**
- NPC узнал от друга друга свидетеля
- Информация прошла через несколько NPC
- Детали сильно искажены

**Визуальный стиль:**
- NPC рассказывают информацию с большими искажениями
- Преувеличения в числах и деталях
- Эмоциональная окраска (страх, восхищение)

## Механизм распространения

### Социальные сети NPC

**Лор:**
Каждый NPC имеет связи с другими NPC. Эти связи определяют, как быстро и в каком виде информация распространяется. Типы связей влияют на вероятность передачи информации.

**Механика:**
- NPC имеют связи с другими NPC (друзья, коллеги, знакомые, враги)
- Связи определяют вероятность передачи информации (друзья: 80%, коллеги: 60%, знакомые: 40%, враги: 10%)
- Сильные связи ускоряют распространение
- Слабые связи замедляют распространение

**Типы связей:**
- **Друзья**: высокая вероятность передачи (80%), быстрая передача
- **Коллеги**: средняя вероятность (60%), средняя скорость
- **Знакомые**: низкая вероятность (40%), медленная передача
- **Враги**: очень низкая вероятность (10%), очень медленная передача

**Визуальный стиль:**
- Социальные сети визуально не отображаются (скрытая механика)
- Поведение NPC отражает их связи (друзья чаще общаются)

### Каналы распространения

**Лор:**
Информация распространяется через разные каналы: прямое общение, места скопления, фракционные каналы, случайные встречи.

**Механика:**
- **Прямое общение**: NPC встречаются и разговаривают (высокая точность)
- **Места скопления**: бары, рынки, общественные места (средняя точность, быстрое распространение)
- **Фракционные каналы**: информация внутри фракций (высокая точность внутри фракции, искажённая для других)
- **Случайные встречи**: случайные NPC делятся информацией (низкая точность, медленное распространение)

**Примеры:**
- Бар Afterlife: быстрое распространение боевых легенд
- Рынок: быстрое распространение экономических легенд
- Корпоративные офисы: быстрое распространение внутри корпорации
- Уличные банды: быстрое распространение внутри банды

**Визуальный стиль:**
- Места скопления визуально выделены (бары, рынки)
- NPC в этих местах чаще общаются
- Атмосферные эффекты (перешёптывания, разговоры)

### Скорость распространения

**Лор:**
Скорость распространения зависит от важности события, социальных связей и локации. Важные события распространяются быстрее, чем обычные.

**Механика:**
- **Критические события**: мгновенное распространение (все NPC знают в течение часа)
- **Важные события**: быстрое распространение (большинство NPC знают в течение дня)
- **Обычные события**: средняя скорость (часть NPC знают в течение недели)
- **Малозначимые события**: медленное распространение (немногие знают в течение месяца)

**Факторы скорости:**
- Важность события (критическое: x10, важное: x5, обычное: x1, малозначимое: x0.5)
- Социальные связи (сильные связи: x2, слабые связи: x0.5)
- Локация (городские центры: x2, пригороды: x1, отдалённые районы: x0.5)

**Визуальный стиль:**
- Визуальные индикаторы важности событий (опционально)
- Изменение поведения NPC при важных событиях

## Искажение информации

### Факторы искажения

**Лор:**
Со временем информация искажается, обрастая деталями и преувеличениями. Чем дальше от источника, тем больше искажений.

**Механика:**
```
distortion = base_distortion + (time_factor * time_passed) + 
             (distance_factor * hops) + (importance_factor * event_importance)

accuracy = 1.0 - min(1.0, distortion)
```

**Факторы:**
- **Время**: чем старше информация, тем больше искажений (0.1% в день)
- **Расстояние**: чем дальше от источника, тем больше искажений (5% за каждый уровень передачи)
- **Количество передач**: каждая передача добавляет искажения (3% за передачу)
- **Важность события**: важные события искажаются сильнее (x1.5 для важных, x2 для критических)

**Примеры:**
- Свежая информация (1 день): 95% точность
- Недавняя информация (1 неделя): 70% точность
- Старая информация (1 месяц): 40% точность
- Очень старая информация (3+ месяца): 20% точность

**Визуальный стиль:**
- Диалоги отражают точность информации (больше деталей = выше точность)
- Искажения визуально не отображаются (скрытая механика)

### Типы искажений

**Лор:**
Информация искажается разными способами: преувеличение чисел, добавление деталей, изменение контекста, эмоциональная окраска.

**Механика:**
- **Преувеличение**: числа увеличиваются (100 → 200 → 500 → 1000)
- **Добавление деталей**: появляются несуществующие детали (оружие, локация, участники)
- **Изменение контекста**: меняется локация, время, участники
- **Эмоциональная окраска**: добавляются эмоции (страх, восхищение, уважение)

**Примеры:**
- Оригинал: "Игрок убил 100 корпоратов"
- Через неделю: "Игрок убил 500 корпоратов"
- Через месяц: "Игрок в одиночку уничтожил тысячу корпоратов Arasaka"

**Визуальный стиль:**
- Диалоги отражают искажения (преувеличения, эмоции)
- Эмоциональная окраска в тоне NPC

## Временная модель

### Жизненный цикл легенды

**Лор:**
Легенды проходят жизненный цикл: рождение, распространение, пик популярности, затухание, забвение.

**Механика:**
- **Рождение** (0-1 день): событие происходит, свидетели знают
- **Распространение** (1-7 дней): информация распространяется, достигает большинства NPC
- **Пик популярности** (7-30 дней): максимальное распространение, все NPC знают
- **Затухание** (30+ дней): информация забывается, меньше NPC знают
- **Забвение** (90+ дней): легенда исчезает или становится мифом

**Примеры:**
- День 1: свидетели знают точные детали
- День 3: информация распространилась в соседние локации
- День 7: большинство NPC в городе знают версию события
- День 30: легенда стала частью городского фольклора с искажениями
- День 90: легенда забыта или стала мифом

**Визуальный стиль:**
- Визуальные индикаторы жизненного цикла (опционально)
- Изменение поведения NPC в зависимости от цикла

### Обновление легенд

**Лор:**
Новые события обновляют старые легенды. Противоречивая информация создаёт варианты легенд.

**Механика:**
- Новые события обновляют старые легенды (увеличивают актуальность)
- Противоречивая информация создаёт варианты легенд
- Подтверждение событий усиливает легенду (увеличивает точность)
- Опровержение событий ослабляет легенду (уменьшает точность)

**Примеры:**
- Новое событие легенды обновляет старую легенду
- Противоречивая информация создаёт два варианта легенды
- Подтверждение события усиливает легенду

**Визуальный стиль:**
- Диалоги отражают обновления легенд
- Варианты легенд в диалогах разных NPC

## Географическое распространение

### Локационные зоны

**Лор:**
Легенды начинаются в локации события и распространяются в соседние локации, достигая отдалённых локаций со временем.

**Механика:**
- Легенды начинаются в локации события
- Распространяются в соседние локации (1 день)
- Достигают отдалённых локаций (3-7 дней)
- Изолированные зоны получают информацию очень медленно или не получают

**Типы локаций:**
- **Городские центры**: быстрое распространение (x2 скорость)
- **Пригороды**: средняя скорость (x1 скорость)
- **Отдалённые районы**: медленное распространение (x0.5 скорость)
- **Изолированные зоны**: очень медленное или отсутствует (x0.1 скорость)

**Примеры:**
- Событие в центре города: быстрое распространение по всему городу
- Событие в пригороде: средняя скорость распространения
- Событие в отдалённом районе: медленное распространение

**Визуальный стиль:**
- Карта распространения (опционально)
- Визуальные индикаторы локаций с легендами

### Транспортные связи

**Лор:**
NPC путешествуют между локациями, ускоряя распространение информации. Торговые маршруты — основные каналы распространения.

**Механика:**
- NPC путешествуют между локациями (торговцы, курьеры, путешественники)
- Транспорт ускоряет распространение (x1.5 скорость)
- Торговые маршруты — основные каналы (x2 скорость)
- Случайные путешествия — медленные каналы (x0.5 скорость)

**Примеры:**
- Торговец распространяет информацию по торговому маршруту
- Курьер доставляет информацию между локациями
- Путешественник случайно распространяет информацию

**Визуальный стиль:**
- Визуальные индикаторы транспортных связей (опционально)
- NPC-путешественники визуально выделены

## Фракционное распространение

### Внутри фракций

**Лор:**
Информация быстро распространяется внутри фракции с высокой точностью. Фракционные NPC знают больше, чем нейтральные.

**Механика:**
- Информация быстро распространяется внутри фракции (x3 скорость)
- Высокая точность внутри фракции (90-100%)
- Фракционные NPC знают больше деталей
- Информация остаётся внутри фракции дольше

**Примеры:**
- Arasaka NPC быстро узнают про конфликты с корпорацией
- Уличные банды быстро узнают про боевые действия
- Нейтральные NPC узнают позже и с искажениями

**Визуальный стиль:**
- Фракционные NPC имеют больше деталей в диалогах
- Визуальные индикаторы фракционной принадлежности

### Между фракциями

**Лор:**
Враждебные фракции получают искажённую информацию. Союзные фракции делятся информацией. Нейтральные фракции получают нейтральную версию.

**Механика:**
- **Враждебные фракции**: получают искажённую информацию (50% точность, негативная окраска)
- **Союзные фракции**: делятся информацией (70% точность, позитивная окраска)
- **Нейтральные фракции**: получают нейтральную версию (60% точность, нейтральная окраска)

**Примеры:**
- Arasaka получает искажённую информацию о конфликтах от враждебных фракций
- Союзные фракции делятся точной информацией
- Нейтральные NPC получают нейтральную версию

**Визуальный стиль:**
- Диалоги отражают фракционную окраску
- Эмоциональная окраска в зависимости от фракции

### Фракционные фильтры

**Лор:**
Фракции интерпретируют события по-своему, добавляя свою эмоциональную окраску и подчёркивая выгодные детали.

**Механика:**
- Фракции интерпретируют события по-своему
- Добавляют свою эмоциональную окраску (позитивная/негативная)
- Подчёркивают выгодные детали
- Скрывают невыгодные детали

**Примеры:**
- Arasaka интерпретирует конфликт как угрозу безопасности
- Уличные банды интерпретируют конфликт как победу над корпорацией
- Нейтральные NPC интерпретируют конфликт как обычное событие

**Визуальный стиль:**
- Диалоги отражают фракционную интерпретацию
- Эмоциональная окраска в зависимости от фракции

## Система приоритетов

### Важность событий

**Лор:**
Важные события распространяются быстрее и достигают большего количества NPC. Критические события знают все NPC мгновенно.

**Механика:**
- **Критические**: распространяются мгновенно, все NPC знают (100% охват за 1 час)
- **Важные**: быстрое распространение, большинство NPC знают (80% охват за 1 день)
- **Обычные**: средняя скорость, часть NPC знают (50% охват за 1 неделю)
- **Малозначимые**: медленное распространение, немногие знают (20% охват за 1 месяц)

**Примеры:**
- Критическое событие: все NPC знают в течение часа
- Важное событие: большинство NPC знают в течение дня
- Обычное событие: часть NPC знают в течение недели
- Малозначимое событие: немногие знают в течение месяца

**Визуальный стиль:**
- Визуальные индикаторы важности событий (опционально)
- Изменение поведения NPC при важных событиях

### Релевантность для NPC

**Лор:**
NPC интересуются событиями, связанными с их фракцией, локацией или жизнью. Релевантные события распространяются быстрее среди заинтересованных NPC.

**Механика:**
- NPC интересуются событиями, связанными с их фракцией (x2 скорость)
- NPC интересуются событиями в их локации (x1.5 скорость)
- NPC интересуются событиями, влияющими на их жизнь (x1.5 скорость)
- Нерелевантные события распространяются медленнее (x0.5 скорость)

**Примеры:**
- Фракционные NPC быстро узнают про события своей фракции
- Локационные NPC быстро узнают про события в их локации
- Нерелевантные NPC узнают позже

**Визуальный стиль:**
- Диалоги отражают релевантность для NPC
- Поведение NPC отражает их интерес

## Интеграция с игровыми системами

### World Service
- Получение данных о локациях
- Интеграция с событиями мира
- Управление транспортными связями

### NPC Service
- Управление социальными связями NPC
- Интеграция с поведением NPC
- Обновление знаний NPC

### Social Service
- Получение данных о фракциях
- Интеграция с системой репутации
- Управление фракционными отношениями

### Legend Story Generator
- Получение новых легенд для распространения
- Обновление существующих легенд

## Критерии готовности

Концепция готова к передаче Architect когда:
- [x] Детальный лор в стиле Cyberpunk 2077 описан
- [x] Источники легенд детально описаны
- [x] Механизм распространения проработан
- [x] Система искажения информации определена
- [x] Временная модель проработана
- [x] Географическое распространение описано
- [x] Фракционное распространение определено
- [x] Система приоритетов проработана
- [x] Интеграции с игровыми системами описаны

## Следующие шаги

1. Передача концепции Architect для детализации технической реализации
2. Создание OpenAPI спецификаций для API Designer
3. Реализация бекенда для Backend Developer
4. Интеграция с NPC системой

