<!-- Issue: #1467 -->
# Система шаблонов и вариативности баек городских легенд - Концепция

## Обзор

Система шаблонов обеспечивает вариативность, естественность и контекстную адаптацию баек про городских легенд. Одно событие может породить множество вариантов байки, адаптированных под контекст, рассказчика и культурные особенности, создавая ощущение живого мира с разнообразными историями.

## Лор в мире Cyberpunk 2077

### Контекст шаблонов и вариативности

В мире NECPGAME байки про легендарных игроков передаются из уст в уста, и каждый рассказчик добавляет свои детали, эмоции и интерпретации. Одно и то же событие может звучать по-разному в зависимости от того, кто его рассказывает и в каком контексте.

**Как работают шаблоны в киберпанк-мире:**
- Бармены рассказывают истории с уважением и деталями
- Уличные информаторы преувеличивают и добавляют драматизм
- Корпоративные NPC интерпретируют события формально
- Уличные банды добавляют агрессию и восхищение
- Нейтральные NPC передают нейтральную версию

**Атмосфера:**
- Разные стили речи для разных типов NPC
- Эмоциональная окраска зависит от отношения к легенде
- Культурные особенности разных регионов и фракций
- Естественность языка, как в реальных разговорах

## Структура шаблона

### Базовые компоненты

**Лор:**
Шаблоны баек структурированы, но гибки. Они содержат переменные, которые заполняются данными о легенде, и правила подстановки, которые адаптируют текст под контекст.

**Механика:**
```
Template {
  id: unique_identifier
  type: legend_type (combat, social, economic, exploration)
  category: event_category
  base_template: "текст с {переменными}"
  variables: [variable_definitions]
  conditions: [activation_conditions]
  variants: [alternative_templates]
}
```

**Примеры:**
- Боевой шаблон: "Слышал про {player_name}? {action_verb} {number} {enemy_type} в {location}."
- Социальный шаблон: "{player_name} - тот, кто {action_verb} {number} {target_type}."
- Экономический шаблон: "Торговец {player_name} {action_verb}. {market_context}."

**Визуальный стиль:**
- Шаблоны не видны игроку (скрытая механика)
- Результат генерации выглядит естественно

### Типы переменных

**Лор:**
Переменные в шаблонах заменяются реальными данными о легенде, создавая уникальные истории для каждого игрока.

**Механика:**
- `{player_name}` - имя игрока (подставляется напрямую)
- `{action_verb}` - глагол действия (убил, победил, нашел, помог)
- `{enemy_type}` - тип врага (корпораты, бандиты, роботы, мутанты)
- `{location}` - локация события (Watson, Afterlife, Arasaka Tower)
- `{number}` - числовое значение (1000, 50, 3)
- `{time_context}` - временной контекст (вчера, на прошлой неделе, месяц назад)
- `{faction}` - название фракции (Arasaka, Militech, уличные банды)
- `{emotion}` - эмоциональная окраска (страх, восхищение, уважение, зависть)

**Правила подстановки:**
- Генерация вариантов глаголов по контексту (убил → вынес → уничтожил)
- Преобразование чисел в текстовый формат (1000 → тысячу)
- Адаптация временных контекстов (вчера → на прошлой неделе → месяц назад)
- Выбор эмоциональной окраски в зависимости от типа NPC

**Примеры:**
- Боевой: "убил 1000 корпоратов" → "вынес тысячу корпоратов Arasaka"
- Социальный: "помог 500 новичкам" → "спас пятьсот новичков от гибели"
- Экономический: "провел 1000 сделок" → "заключил тысячу честных сделок"

**Визуальный стиль:**
- Переменные заменяются естественно, без видимых артефактов
- Текст выглядит как написанный человеком

## Типы шаблонов

### Боевые шаблоны

**Лор:**
Боевые легенды рассказывают о подвигах игроков в бою. Бармены, уличные банды и корпоративные охранники рассказывают их по-разному.

**Механика:**
```yaml
- id: combat_solo_victory
  type: combat
  base_template: "Слышал про {player_name}? {action_verb} {number} {enemy_type} в {location}. {consequence}."
  variants:
    - "Говорят, {player_name} {action_verb} {number} {enemy_type} в {location}. {enemy_type} до сих пор {reaction}."
    - "{player_name}? Это тот, кто {action_verb} {number} {enemy_type} в {location}. {legendary_context}."
```

**Варианты для разных NPC:**
- Бармен: "Слышал про {name}? Вынес тысячу корпоратов Arasaka в Watson. Легенда!"
- Уличный бандит: "{name}? Этот чувак вынес тысячу корпоратов! Невероятно!"
- Корпоративный охранник: "{name} - опасный преступник. Уничтожил тысячу наших сотрудников."

**Визуальный стиль:**
- Боевые легенды имеют агрессивную окраску
- Эмоции: восхищение, страх, уважение

### Социальные шаблоны

**Лор:**
Социальные легенды рассказывают о помощи другим игрокам, создании сообществ и социальных достижениях. Информаторы, бармены и нейтральные NPC рассказывают их с разными акцентами.

**Механика:**
```yaml
- id: social_help_players
  type: social
  base_template: "{player_name} - тот, кто {action_verb} {number} {target_type}. {impact}."
  variants:
    - "{player_name} помог {number} {target_type}. {faction} {reaction}. {consequence}."
    - "Все знают {player_name}. Он {action_verb} {number} {target_type}. {legendary_context}."
```

**Варианты для разных NPC:**
- Информатор: "{name} - тот, кто помог пятистам новичкам выжить. Все его знают."
- Бармен: "Слышал про {name}? Помог пятистам новичкам. Настоящий герой."
- Нейтральный NPC: "{name} известен своей помощью новичкам. Уважаемый человек."

**Визуальный стиль:**
- Социальные легенды имеют позитивную окраску
- Эмоции: уважение, восхищение, благодарность

### Экономические шаблоны

**Лор:**
Экономические легенды рассказывают о торговых достижениях, честных сделках и экономическом влиянии. Торговцы, рынки и корпоративные NPC рассказывают их с разных точек зрения.

**Механика:**
```yaml
- id: economic_honest_trader
  type: economic
  base_template: "Торговец {player_name} {action_verb}. {market_context}. {reputation_effect}."
  variants:
    - "{player_name} - честный торговец. {action_verb} {number} сделок. {market_impact}."
    - "Все знают {player_name} на рынке. {action_verb} без обмана. {faction} {reaction}."
```

**Варианты для разных NPC:**
- Торговец: "{name} - честный торговец. Провел тысячу сделок без обмана."
- Рыночный NPC: "Все знают {name} на рынке. Его слово - закон."
- Корпоративный NPC: "{name} - уважаемый торговец. Его сделки всегда честны."

**Визуальный стиль:**
- Экономические легенды имеют нейтральную/позитивную окраску
- Эмоции: уважение, доверие, восхищение

### Исследовательские шаблоны

**Лор:**
Исследовательские легенды рассказывают о находках, открытиях и исследовании мира. Информаторы, ученые и исследователи рассказывают их с научным или мистическим акцентом.

**Механика:**
```yaml
- id: exploration_discovery
  type: exploration
  base_template: "{player_name} {action_verb} {discovery} в {location}. {lore_context}. {faction_reaction}."
  variants:
    - "Слышал про {player_name}? {action_verb} {discovery} в {location}. {legendary_context}."
    - "{player_name} нашел {discovery}. {lore_context}. {faction} {reaction}."
```

**Варианты для разных NPC:**
- Информатор: "Слышал про {name}? Нашел секретную лабораторию в Watson. Невероятно!"
- Ученый: "{name} обнаружил важную находку. Это может изменить всё."
- Исследователь: "{name} известен своими открытиями. Настоящий первооткрыватель."

**Визуальный стиль:**
- Исследовательские легенды имеют мистическую/научную окраску
- Эмоции: восхищение, уважение, любопытство

## Система вариативности

### Уровни вариативности

**Лор:**
Разные уровни вариативности создают разную глубину адаптации. Базовый уровень просто заменяет переменные, высокий уровень полностью переформулирует текст.

**Механика:**
- **Базовый**: Простая подстановка переменных (быстро, но менее естественно)
- **Средний**: Вариация формулировок и структуры (баланс скорости и естественности)
- **Высокий**: Полная переформулировка с сохранением смысла (медленно, но очень естественно)

**Примеры:**
- Базовый: "Слышал про Джона? Убил 1000 корпоратов в Watson."
- Средний: "Говорят, Джон вынес тысячу корпоратов Arasaka в районе Watson."
- Высокий: "Джон? Это тот легендарный боец, который в одиночку уничтожил тысячу корпоратов Arasaka в Watson. Говорят, он как призрак - появляется и исчезает."

**Визуальный стиль:**
- Высокий уровень вариативности выглядит более естественно
- Игрок не должен замечать шаблонность

### Вариация формулировок

**Лор:**
Разные NPC используют разные формулировки, создавая естественное разнообразие речи.

**Механика:**
- Синонимы для ключевых слов (убил → вынес → уничтожил → разгромил)
- Альтернативные структуры предложений (прямой порядок → обратный порядок)
- Разные стили речи (формальный → неформальный → сленг)

**Примеры:**
- Формальный: "Игрок {name} уничтожил тысячу корпоратов."
- Неформальный: "{name} вынес тысячу корпоратов."
- Сленг: "{name} разгромил тысячу корпоратов. Невероятно!"

**Визуальный стиль:**
- Формулировки соответствуют типу NPC
- Естественность речи

### Эмоциональная вариативность

**Лор:**
Эмоциональная окраска зависит от отношения NPC к легенде. Восхищение, страх, уважение, зависть - разные эмоции создают разные версии истории.

**Механика:**
- **Восхищение**: "Невероятный", "Легендарный", "Великий", "Невероятный боец"
- **Страх**: "Опасный", "Жуткий", "Неукротимый", "Страшный противник"
- **Уважение**: "Почтенный", "Достойный", "Честный", "Уважаемый человек"
- **Зависть**: "Удачливый", "Богатый", "Известный", "Повезло ему"

**Примеры:**
- Восхищение: "Невероятный {name}! Вынес тысячу корпоратов!"
- Страх: "Опасный {name}. Уничтожил тысячу наших сотрудников."
- Уважение: "Почтенный {name}. Помог пятистам новичкам."
- Зависть: "Удачливый {name}. Провел тысячу выгодных сделок."

**Визуальный стиль:**
- Эмоции отражаются в тоне диалогов
- Визуальные эффекты (опционально)

### Контекстная адаптация

**Лор:**
Байки адаптируются под контекст: локацию, фракцию, время суток, события мира. Это создаёт ощущение, что NPC действительно знают, о чём говорят.

**Механика:**
- Адаптация под фракцию рассказчика (корпорации → формальный стиль, банды → сленг)
- Адаптация под локацию (бар → неформальный стиль, офис → формальный стиль)
- Адаптация под время суток (ночь → таинственный стиль, день → открытый стиль)
- Адаптация под события мира (актуальные события → упоминание в байке)

**Примеры:**
- Фракция Arasaka: "Преступник {name} уничтожил наших сотрудников."
- Уличная банда: "{name} - крутой чувак! Вынес тысячу корпоратов!"
- Нейтральный NPC: "{name} известен своими боевыми подвигами."

**Визуальный стиль:**
- Адаптация визуально не заметна (скрытая механика)
- Результат выглядит естественно

## Культурная адаптация

### Региональные различия

**Лор:**
Разные регионы имеют разные культурные особенности, которые отражаются в речи NPC. Локальные сленговые выражения и культурные особенности создают уникальность каждого региона.

**Механика:**
- Разные формулировки для разных регионов (Night City → London → Tokyo)
- Локальные сленговые выражения (choom → mate → senpai)
- Культурные особенности речи (формальность, эмоциональность, структура)

**Примеры:**
- Night City: "Choombata {name} вынес тысячу корпоратов!"
- London: "Mate {name} took out a thousand corporates!"
- Tokyo: "{name}-san уничтожил тысячу корпоратов."

**Визуальный стиль:**
- Региональные различия отражаются в диалогах
- Культурная аутентичность

### Фракционные различия

**Лор:**
Фракции имеют свои стили речи, которые отражают их культуру и ценности. Корпорации говорят формально, банды используют сленг, нейтральные NPC говорят нейтрально.

**Механика:**
- Корпорации → формальный стиль, технические термины, официальный тон
- Уличные банды → сленг, грубость, эмоциональность
- Нейтральные NPC → нейтральный стиль, обычная речь

**Примеры:**
- Arasaka: "Преступник {name} представляет угрозу безопасности корпорации."
- Уличная банда: "{name} - крутой чувак! Вынес тысячу корпоратов!"
- Нейтральный NPC: "{name} известен своими боевыми подвигами."

**Визуальный стиль:**
- Фракционные различия отражаются в диалогах
- Стиль соответствует фракции

### Социальные слои

**Лор:**
Разные социальные слои используют разную речь. Высший класс говорит изысканно, средний класс - обычно, низший класс - просторечием и сленгом.

**Механика:**
- Высший класс → изысканная речь, формальность, утончённость
- Средний класс → обычная речь, нейтральность
- Низший класс → просторечие, сленг, грубость

**Примеры:**
- Высший класс: "Господин {name} продемонстрировал выдающиеся боевые способности."
- Средний класс: "{name} известен своими боевыми подвигами."
- Низший класс: "{name} - крутой чувак! Вынес тысячу корпоратов!"

**Визуальный стиль:**
- Социальные различия отражаются в диалогах
- Реалистичность речи

## Правила генерации

### Выбор шаблона

**Механика:**
1. Анализ типа события (боевое, социальное, экономическое, исследовательское)
2. Проверка условий активации (локация, фракция, время)
3. Выбор наиболее релевантного шаблона
4. Проверка доступности шаблона для типа NPC

**Примеры:**
- Боевое событие → боевой шаблон
- Социальное событие → социальный шаблон
- Экономическое событие → экономический шаблон

### Заполнение переменных

**Механика:**
1. Извлечение данных из события (имя игрока, действие, локация)
2. Преобразование в текстовый формат (числа → слова, даты → временные контексты)
3. Применение правил подстановки (синонимы, вариации)
4. Добавление эмоциональной окраски

**Примеры:**
- Данные: {player_name: "John", action: "killed", number: 1000, enemy_type: "corpos"}
- Результат: "Слышал про John? Вынес тысячу корпоратов Arasaka в Watson."

### Генерация вариантов

**Механика:**
1. Создание 3-5 вариантов из одного шаблона
2. Применение вариаций формулировок
3. Добавление эмоциональной окраски
4. Адаптация под контекст (локация, фракция, время)

**Примеры:**
- Вариант 1: "Слышал про John? Вынес тысячу корпоратов."
- Вариант 2: "Говорят, John уничтожил тысячу корпоратов Arasaka."
- Вариант 3: "John? Это тот, кто разгромил тысячу корпоратов."

### Валидация

**Механика:**
1. Проверка на дубликаты (не повторять недавние байки)
2. Проверка читаемости (грамматика, структура)
3. Проверка длины (оптимально 50-200 слов)
4. Проверка релевантности (соответствие контексту)

**Примеры:**
- Дубликат → генерация нового варианта
- Нечитаемо → исправление грамматики
- Слишком длинно → сокращение
- Не релевантно → выбор другого шаблона

## Система расширения шаблонов

### Добавление новых шаблонов

**Механика:**
1. Content Writer создаёт новый шаблон в YAML формате
2. Валидация структуры шаблона (проверка обязательных полей)
3. Тестирование генерации (проверка работы переменных)
4. Добавление в базу данных

**Примеры:**
- Новый боевой шаблон для массовых боёв
- Новый социальный шаблон для создания гильдий
- Новый экономический шаблон для крупных сделок

### Модификация существующих

**Механика:**
1. Обновление формулировок (улучшение естественности)
2. Добавление новых вариантов (увеличение разнообразия)
3. Улучшение правил подстановки (более точная адаптация)

**Примеры:**
- Обновление формулировок для более естественного звучания
- Добавление новых синонимов для глаголов
- Улучшение эмоциональной окраски

### Импорт/экспорт

**Механика:**
1. YAML формат для шаблонов (читаемость, версионирование)
2. Версионирование шаблонов (отслеживание изменений)
3. Миграция между версиями (обновление старых шаблонов)

**Примеры:**
- Экспорт шаблонов для редактирования
- Импорт обновлённых шаблонов
- Миграция старых шаблонов на новую версию

## Интеграция с игровыми системами

### Legend Story Generator
- Использование шаблонов для генерации баек
- Передача контекста для адаптации

### NPC Dialogue System
- Получение адаптированных баек
- Интеграция с диалогами NPC

### Content Management
- Управление шаблонами контент-райтерами
- Версионирование и обновление

## Критерии готовности

Концепция готова к передаче Architect когда:
- [x] Детальный лор в стиле Cyberpunk 2077 описан
- [x] Структура шаблонов детально описана
- [x] Типы шаблонов для всех категорий легенд определены
- [x] Система вариативности проработана
- [x] Правила генерации определены
- [x] Культурная адаптация описана
- [x] Система расширения шаблонов определена
- [x] Интеграции с игровыми системами описаны

## Следующие шаги

1. Передача концепции Architect для детализации технической реализации
2. Создание OpenAPI спецификаций для API Designer
3. Реализация бекенда для Backend Developer
4. Создание контента для Content Writer

