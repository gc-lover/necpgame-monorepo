# Issue: #1454

# Система реактивных глобальных событий с масштабированием

## Описание

Система реактивных глобальных событий позволяет действиям игроков, завершению квестов и накопленной активности вызывать глобальные события разных масштабов. В отличие от запланированных событий (Live Events System), реактивные события триггерятся действиями игроков и динамически реагируют на состояние игрового мира.

## Лор и атмосфера

В мире 2077 года каждое действие имеет последствия. Небольшая стычка в районе может перерасти в полномасштабную войну между корпорациями. Успешное выполнение квеста одним игроком может изменить баланс сил в городе, а коллективные усилия тысяч игроков способны изменить судьбу всей планеты.

Корпорации постоянно мониторят активность в сетях, а ИИ-системы анализируют каждое действие игроков, пытаясь предсказать и предотвратить потенциальные кризисы. Но даже самые совершенные системы не могут предвидеть все - хаос киберпанк-мира слишком непредсказуем.

## Масштабы событий

### 1. Локальный (District)
**Описание:** Район города, несколько кварталов (2-5 км²)

**Примеры районов:**
- Watson: Northside Industrial District
- Westbrook: Japantown District
- City Center: Corporate Plaza District

**Характеристики:**
- Затрагивает 100-500 игроков одновременно
- Длительность: 30 минут - 2 часа
- Частота активации: несколько раз в день

**Примеры событий:**
- Стычка между бандами
- Полицейский рейд
- Корпоративная зачистка
- Локальное отключение электроэнергии
- Взрыв в здании

**Триггеры:**
- 20+ завершенных квестов в районе за час
- 10+ PvP kill в зоне за 30 минут
- Репутация одной из фракций в районе падает на 50%
- Игроки уничтожают 5+ важных NPC за день

### 2. Городской (City)
**Описание:** Весь город (Night City, London, Tokyo и т.д.) (100-200 км²)

**Характеристики:**
- Затрагивает 1000-5000 игроков
- Длительность: 2-6 часов
- Частота активации: 1-2 раза в неделю

**Примеры событий:**
- Городская война между фракциями
- Корпоративный переворот
- Киберпсихо-эпидемия
- Массовые протесты
- Отключение городской сети
- Нападение AI из-за Blackwall

**Триггеры:**
- 100+ локальных событий за неделю
- Репутация игроков с одной корпорацией упала на 70% у 1000+ игроков
- Игроки завершили 500+ квестов против одной фракции за неделю
- Экономическая активность в городе упала на 30%

### 3. Региональный (Country/Region)
**Описание:** Страна или крупный регион (500-1000 км²)

**Примеры регионов:**
- North California State
- NUSA East Coast
- European Union Central
- Asian Pacific Zone

**Характеристики:**
- Затрагивает 5000-20000 игроков
- Длительность: 6-24 часа
- Частота активации: 1-2 раза в месяц

**Примеры событий:**
- Региональный экономический кризис
- Война между штатами/странами
- Вспышка кибервируса
- Массовый сбой инфраструктуры
- Политический переворот

**Триггеры:**
- 5+ городских событий за месяц
- Региональная экономика упала на 40%
- 10000+ игроков участвовали в конфликте фракций
- Игроки завершили 5000+ квестов, затрагивающих региональную политику

### 4. Континентальный (Continent)
**Описание:** Весь континент (Северная Америка, Европа, Азия) (5000-20000 км²)

**Характеристики:**
- Затрагивает 20000-100000 игроков
- Длительность: 24-72 часа (3 дня)
- Частота активации: 1 раз в 2-3 месяца

**Примеры событий:**
- Континентальная война
- Массовая миграция населения
- Глобальный сбой Blackwall на континенте
- Экономический коллапс
- Революция против корпораций

**Триггеры:**
- 10+ региональных событий за квартал
- Континентальная экономика упала на 50%
- 100000+ игроков участвовали в глобальном конфликте
- Игроки завершили 50000+ квестов, затрагивающих континентальную политику

### 5. Планетарный (Planetary)
**Описание:** Вся планета Земля

**Характеристики:**
- Затрагивает 100000+ игроков (весь сервер)
- Длительность: 3-7 дней
- Частота активации: 1-2 раза в год

**Примеры событий:**
- Глобальная война корпораций
- Второе падение Blackwall
- Планетарный экономический кризис
- Массовая кибератака на глобальную сеть
- Восстание AI

**Триггеры:**
- 5+ континентальных событий за год
- Глобальная экономика упала на 60%
- 500000+ игроков участвовали в глобальном конфликте
- Игроки завершили 500000+ квестов, затрагивающих планетарную политику

### 6. Межпланетарный (Interplanetary)
**Описание:** Другие планеты, колонии, космические станции

**Характеристики:**
- Затрагивает игроков на нескольких планетах
- Длительность: 7-14 дней
- Частота активации: 1 раз в 1-2 года (уникальные события)

**Примеры событий:**
- Межпланетная война
- Потеря связи с колонией
- Вторжение инопланетной угрозы (если применимо к лору)
- Глобальный кризис AI
- Восстание колоний против Земли

**Триггеры:**
- 2+ планетарных события за год
- Игроки завершили 1000000+ квестов, затрагивающих межпланетные отношения
- Экономика между планетами нарушена на 70%

## Механики накопления активности

### Система накопления Impact Points

**Impact Points (IP)** - абстрактная валюта, которая накапливается от действий игроков и триггерит события.

**Источники IP:**
- Завершенные квесты: 1-10 IP в зависимости от сложности
- PvP kills: 0.5 IP за kill
- Экономические операции: 0.1 IP за крупную сделку (>10000 credits)
- Социальные действия: 0.5 IP за влияние на репутацию фракции
- Разрушения: 1-5 IP за уничтожение важных объектов

**Модификаторы IP:**
- Количество игроков: +10% за каждые 100 игроков в зоне
- Время суток: +20% в прайм-тайм (18:00-22:00)
- День недели: +30% в выходные
- Критичность действий: +50% для действий против ключевых фракций

**Накопление по масштабам:**
- Локальный: 1000 IP за час → событие активируется
- Городской: 10000 IP за неделю → событие активируется
- Региональный: 100000 IP за месяц → событие активируется
- Континентальный: 1000000 IP за квартал → событие активируется
- Планетарный: 10000000 IP за год → событие активируется
- Межпланетарный: 100000000 IP за год → событие активируется

### Временные окна активации

**Cooldown между событиями:**
- Локальный: 1 час cooldown после события
- Городской: 24 часа cooldown
- Региональный: 7 дней cooldown
- Континентальный: 30 дней cooldown
- Планетарный: 90 дней cooldown
- Межпланетарный: 180 дней cooldown

**Приоритет активации:**
- Если накоплено достаточно IP для нескольких событий, выбирается событие с наивысшим масштабом
- Если cooldown не истек, IP продолжает накапливаться для следующего порога

### Каскадные эффекты

**Принцип каскадов:**
- Локальное событие может триггерить городское, если активировано 5+ локальных событий за короткий период
- Городское может триггерить региональное при 3+ городских событиях
- И так далее

**Механика каскада:**
1. Локальное событие завершается
2. Система проверяет количество локальных событий за период
3. Если порог достигнут, триггерится городское событие
4. Процесс повторяется для следующих масштабов

**Пример каскада:**
- 5 локальных стычек между бандами в разных районах Night City за 6 часов
- → Триггерится городская война между фракциями
- 3 городских войны в California за месяц
- → Триггерится региональный кризис в North California
- 10 региональных кризисов на континенте за квартал
- → Триггерится континентальная война

## Интеграция с существующими системами

### Player Impact System
- Использует существующие метрики влияния игроков
- Действия высокоимпактных игроков имеют больший вес
- Репутация фракций влияет на вероятность событий

### World Events System
- Реактивные события интегрируются с архитектурой мировых событий
- Используют те же механизмы для управления состоянием мира

### Quest System
- Квесты могут триггерить реактивные события
- События создают новые динамические квесты

### Economy Service
- Экономические метрики используются для расчета IP
- События влияют на экономику (цены, доступность товаров)

### Social Service
- Репутация фракций учитывается при расчете IP
- События влияют на социальные отношения

### Analytics Service
- Отслеживает активность игроков для расчета IP
- Сохраняет историю событий для анализа

## Примеры событий по масштабам

### Локальный пример: "Рейд Trauma Team"
**Триггер:** 15 игроков убито в Watson за 1 час

**Событие:**
- Trauma Team запускает рейд в районе
- Появляются боевые медики с тяжелым вооружением
- Игроки должны либо защищаться, либо сотрудничать
- Награды: медикаменты, опыт, репутация с Trauma Team

**Длительность:** 30 минут

### Городской пример: "Корпоративный переворот"
**Триггер:** 500 квестов против Arasaka завершено за неделю

**Событие:**
- Militech запускает атаку на объекты Arasaka в Night City
- Игроки выбирают сторону или остаются нейтральными
- Контроль над районами меняется
- Экономика города нарушена на 20%

**Длительность:** 6 часов

### Региональный пример: "Blackwall Breach"
**Триггер:** 10000 взломов через киберпространство за месяц

**Событие:**
- Blackwall прорывается в North California
- AI-угрозы появляются в сети
- Netrunners должны объединиться для закрытия бреша
- Все сетевые операции рискованны

**Длительность:** 24 часа

### Континентальный пример: "Корпоративная война"
**Триггер:** 50000 квестов, затрагивающих корпорации за квартал

**Событие:**
- Arasaka vs Militech на всем континенте
- Контроль над городами меняется
- Экономика нарушена на 50%
- Массовые PvP зоны

**Длительность:** 72 часа (3 дня)

### Планетарный пример: "Второе падение Blackwall"
**Триггер:** 500000 взломов глобальной сети за год

**Событие:**
- Blackwall падает на всей Земле
- AI-угрозы появляются везде
- Глобальная сеть частично отключается
- Игроки должны объединиться для восстановления

**Длительность:** 7 дней

### Межпланетарный пример: "Восстание колоний"
**Триггер:** 1000000 квестов, затрагивающих межпланетные отношения

**Событие:**
- Колонии на Марсе и других планетах восстают против Земли
- Межпланетная торговля прекращается
- Игроки выбирают сторону
- Глобальная экономика коллапсирует

**Длительность:** 14 дней

## Отображение в UI и уведомления

### Система уведомлений

**Preemptive warnings (за 1 час до события):**
- Notification: "Tension rising in Watson. Expect conflict soon."
- Visual: Мигающий индикатор на карте

**Event activation:**
- Notification: "ALERT: Trauma Team raid in Watson District!"
- Visual: Красная зона на карте, звуковой alert

**Event progress:**
- Real-time updates каждые 15 минут
- Показ текущих целей и прогресса

**Event conclusion:**
- Notification: "Event ended. Trauma Team retreating."
- Summary: Статистика события, награды

### UI элементы

**World Map:**
- Красные зоны для активных событий
- Оранжевые зоны для накапливающихся триггеров
- Иконки типа события

**Impact Meter:**
- Показатель накопления IP для следующего события
- Прогресс-бар для каждого масштаба
- Оценка времени до следующего события

**Event History:**
- Лог прошлых событий
- Статистика участия игрока
- Награды и достижения

## Влияние на экономику, фракции, NPC

### Экономические эффекты

**Локальный:**
- Цены в районе +10-20%
- Некоторые магазины закрываются
- Появляются новые торговцы (чёрный рынок)

**Городской:**
- Цены в городе +20-30%
- Изменение доступности товаров
- Новые экономические возможности

**Региональный:**
- Цены в регионе +30-50%
- Торговые маршруты нарушены
- Дефицит ресурсов

**Континентальный:**
- Глобальная инфляция +50-70%
- Критический дефицит
- Чёрный рынок процветает

**Планетарный:**
- Экономический коллапс +70-100%
- Бартер вместо валюты
- Survival mode активирован

### Влияние на фракции

**Изменение репутации:**
- Игроки, участвующие в событии, получают +/- репутацию с фракциями
- Фракции могут объединяться или враждовать

**Изменение контроля:**
- Фракции могут захватывать или терять районы
- Новые фракции могут появляться

**Динамические альянсы:**
- Фракции временно объединяются против общей угрозы
- После события отношения могут измениться

### Влияние на NPC

**Поведение NPC:**
- NPC реагируют на события (паника, агрессия, помощь)
- Важные NPC могут погибнуть (с consequences)

**Диалоги:**
- NPC обсуждают события
- Новые диалоговые опции появляются

**Квесты от NPC:**
- Динамические квесты, связанные с событием
- NPC просят о помощи

## Связанные системы

- `world-service` - управление состоянием мира и событий
- `quest-service` - триггеры от квестов и динамические квесты
- `economy-service` - экономические эффекты событий
- `social-service` - социальные последствия и репутация
- `analytics-service` - отслеживание активности и расчет IP
- `player-impact-system` - интеграция с системой влияния игроков
- `live-events-system` - интеграция с запланированными событиями
- `notification-service` - уведомления игроков о событиях

## Приоритет

P2 (Средний)

## Метки

game-design, events, world, player-impact






