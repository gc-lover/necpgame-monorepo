metadata:
  id: quest-saopaulo-traffic-002
  quest_code: SAO_2020_TRAF_002
  title: Гонка в пробке
  title_en: Race in Gridlock
  document_type: quest
  category: side_quest
  quest_type: side
  status: active
  version: "1.1.0"
  timeline: 2020-2029
  year: 2028
  season: autumn
  location:
    city: Sao Paulo
    region: Sao Paulo State
    country: Brazil
    coordinates:
      lat: -23.5505
      lon: -46.6333
  created_at: 2025-11-26T00:00:00Z
  owner:
    role: content-writer
  tags:
    - sao-paulo
    - traffic
    - chase
    - courier
    - time-critical
    - motorcycle
  github_issue: 1072
  related_documents:
    - id: quest-system-architecture
      relation: implements
    - id: quest-saopaulo-megacity-001
      relation: follows

summary:
  brief: |
    Триста километров пробок. Тридцать минут до смерти. Один шанс.

  description: |
    Сан-Паулу 2028, час пик. 18:00. Город замер. 300 километров пробок растянулись
    по артериям мегаполиса. 20 миллионов человек застряли в металлическом аду.
    Обычный вечер для Сан-Паулу.

    Но для тебя это не обычный вечер. В термоконтейнере за спиной - донорское сердце.
    Биотех-орган, напечатанный на 3D-принтере, но все еще требующий доставки за
    30 минут. Пациент на операционном столе в госпитале Сириу-Либанез на другом
    конце города. Расстояние - 23 километра. В нормальных условиях - 25 минут.
    В пробке - 3 часа. У тебя - 30 минут.

    Мотоцикл заведен. GPS рисует маршрут, который тает в реальном времени по мере
    роста пробок. Времени нет на ошибки. Кто-то умрет сегодня. От тебя зависит - кто.

  goal: |
    Доставить донорское сердце через пробки Сан-Паулу за 30 минут, используя
    любые средства - мотоцикл, метро, parkour, даже вертолет, если найдешь.

  essence: |
    Квест о гонке со временем в городе, который никуда не движется. Показывает
    знаменитые пробки Сан-Паулу как препятствие между жизнью и смертью. Chase
    sequence, навигация, принятие быстрых решений.

requirements:
  level_min: 15
  level_max: 30
  skill_requirements:
    - skill: driving_motorcycle
      min_value: 0.5
      description: Уверенное вождение мотоцикла
    - skill: quick_thinking
      min_value: 0.4
      description: Быстрые решения под давлением

story:
  background: |
    Сан-Паулу - чемпион мира по пробкам. В rush hour пробки достигают 300 км.
    Люди живут в машинах, едят в машинах, работают из машин. Город стоит.

    Но медицина не ждет. BioMed Corp разработала службу экстренной доставки
    донорских органов. Мотокурьеры, лучшие в городе, доставляют за 30 минут
    или бесплатно. Только "бесплатно" означает смерть пациента и конец карьеры.

    Ты работаешь в BioMed три года. 247 успешных доставок. Ноль провалов.
    Репутация идеальна. Но сегодня - самая сложная доставка. Час пик в пятницу.
    Авария на Маржинал Пиньейрус перекрыла главную артерию. Город парализован.

  opening: |
    Штаб BioMed, район Пинейрус. 18:03. Термоконтейнер в руках - холодный, тяжелый.
    Внутри - биотех-сердце. Таймер уже идет.

    Диспетчер Мария кричит в наушник: "Маршрут обновлен! Маржинал забит, берешь
    Авенида Паулиста, потом-"

    "Паулиста тоже стоит," - перебивает другой голос. Рафаэль, твой напарник,
    смотрит на мониторы. "Весь город красный. GPS показывает 2 часа 40 минут."

    Мария бледнеет. "У нас 28 минут. Пациенту 8 лет. Девочка. Без сердца она-"

    "Я знаю." Ты бросаешь термоконтейнер в рюкзак мотоцикла. "Найду путь."

    Yamaha MT-09, 900cc, идеально настроенный для городских пробок. Узкий, быстрый,
    маневренный. Твой лучший друг три года.

    Выезжаешь на улицу. Красное море машин до горизонта. Клаксоны, выхлопы,
    жара. Термометр показывает 35°C. Рюкзак с сердцем холодеет спину.

    27 минут.

  act_one: |
    **Первые 10 минут - Старт (Pinheiros → Paulista)**

    Между машинами помещается ровно ширина мотоцикла плюс 10 сантиметров. Ты
    летишь на 60 км/ч там, где машины стоят. Зеркала отбиты назад, колени
    почти касаются дверей.

    Авенида Паулиста впереди. Главная артерия города. 2.8 км престижных офисов
    и магазинов. Обычно - красиво. Сейчас - кошмар. Шесть полос, все забиты.

    **Выбор 1 - Маршрут:**
    - **Между машин:** Классика. Рискованно (узко), но прямо. +5 минут времени.
    - **По тротуару:** Незаконно, но пешеходы уступают мотоциклам. +3 минуты, но полиция может остановить.
    - **Через парк Трианон:** Off-road через зеленую зону. Быстрее, но сложнее технически. +7 минут, требует skill check.

    Выбираешь. Летишь вперед.

    17 минут.

  act_two: |
    **Средние 10 минут - Препятствие (Paulista → Consolação)**

    Авенида Консоласау. Спуск вниз, к центру. Но впереди - синие огни. Полиция
    перекрыла дорогу. Авария. Truck опрокинулся, разлил груз. Масло на дороге.

    Объезда нет. Пробка растет позади. Впереди - полицейская лента и двое копов.

    "Стоп! Дорога закрыта!"

    **Выбор 2 - Препятствие:**
    - **Показать разрешение BioMed:** У тебя есть корпоративное разрешение на экстренную доставку. Законно. Но требует объяснений, потеря времени. -3 минуты.
    - **Обман:** "Я с места аварии, срочно в больницу!" Bluff check. Если успех - пропустят, если провал - задержат. Рискованно.
    - **Объехать по метро:** Под дорогой - станция метро. Через платформу и другой выход можно выбраться за перекрытием. Нелегально, но быстро. +5 минут, требует athletics.

    Решаешь. Действуешь.

    12 минут. Половина времени. Меньше половины пути.

  act_three: |
    **Финальные 10 минут - Погоня (Consolação → Sírio-Libanês)**

    Что-то не так. Черный SUV следует за тобой три квартала. Тонированные стекла.
    Агрессивное вождение. Они знают, что ты везешь.

    Конкуренты. BioMed не единственная компания донорской логистики. Sabotage
    конкурентских доставок - темная сторона бизнеса. Если ты опоздаешь, их
    клиент получит другое сердце. Большие деньги на кону.

    SUV ускоряется. Пытается отрезать путь.

    **Выбор 3 - Погоня:**
    - **Агрессивная езда:** Максимальная скорость, риск аварии. Driving check, high difficulty. Быстро, но опасно.
    - **Узкие переулки:** Мотоцикл пролезет, SUV нет. Stealth approach, потеря преследователей. Безопаснее, но длиннее маршрут.
    - **Вызвать полицию:** У BioMed есть горячая линия. Полиция перехватит SUV. Но бюрократия, вопросы, задержка. -5 минут.

    Госпиталь Сириу-Либанез впереди. Белое здание. Вертолетная площадка на крыше.
    Врачи уже ждут у входа.

    5 минут. 2 километра.

    SUV делает финальную попытку - резко перестраивается. Пытается столкнуть тебя.

    Последний маневр. Резкий поворот руля. Мотоцикл на грани падения. Шина скрипит.
    Но ты проходишь.

    Госпиталь. Входная арка. Тормоз. Рюкзак с термоконтейнером в руки врачей.

    "3 минуты запаса," - говорит доктор, проверяя показатели. "Идеально. Спасибо."

    Через стекло видишь операционную. Девочку вкатывают на стол. Она будет жить.

    Мотоцикл под тобой тикает, остывая. Город все еще стоит в пробках. Но одна
    жизнь спасена. Сегодня ты выиграл гонку с городом и смертью.

objectives:
  - id: obj-001
    order: 1
    type: collect
    title: Получить термоконтейнер
    requirements:
      item: donor_heart_container
      location: BioMed_HQ
    reward_xp: 300
    optional: false

  - id: obj-002
    order: 2
    type: navigation
    title: Маршрут Pinheiros-Paulista
    requirements:
      route: route_segment_1
      time_limit: 10_minutes
    reward_xp: 600
    optional: false

  - id: obj-003
    order: 3
    type: obstacle
    title: Преодолеть перекрытие
    requirements:
      checkpoint: police_blockade
    reward_xp: 700
    optional: false

  - id: obj-004
    order: 4
    type: chase
    title: Уйти от преследователей
    requirements:
      enemy: rival_company_suv
    reward_xp: 900
    optional: false

  - id: obj-005
    order: 5
    type: delivery
    title: Доставить в госпиталь
    requirements:
      target: sirio_libanes_hospital
      time_limit: 30_minutes_total
    reward_xp: 1500
    optional: false

branches:
  main_branch:
    id: branch-main
    objectives: [obj-001, obj-002, obj-003, obj-004, obj-005]

  route_choices:
    - id: path-through-traffic
      title: Между машин
      trigger_choice: weave_traffic
      consequences:
        time_saved: 5_minutes
        risk_level: high
      skill_checks:
        - skill: driving
          difficulty: 0.7
          required: true
      rewards:
        xp: 800

    - id: path-sidewalk
      title: По тротуару
      trigger_choice: use_sidewalk
      consequences:
        time_saved: 3_minutes
        police_attention: possible
      rewards:
        xp: 600

    - id: path-park
      title: Через парк
      trigger_choice: offroad_park
      consequences:
        time_saved: 7_minutes
        difficulty: high
      skill_checks:
        - skill: driving
          difficulty: 0.8
        - skill: athletics
          difficulty: 0.5
      rewards:
        xp: 1200

  blockade_choices:
    - id: path-permit
      title: Показать разрешение
      trigger_choice: show_biomedpermit
      consequences:
        time_lost: 3_minutes
        legal: true
      rewards:
        xp: 400

    - id: path-bluff
      title: Обмануть полицию
      trigger_choice: bluff_cops
      skill_checks:
        - skill: deception
          difficulty: 0.6
          required: true
      rewards:
        xp: 700

    - id: path-metro
      title: Через метро
      trigger_choice: metro_bypass
      consequences:
        time_saved: 5_minutes
        illegal: true
      skill_checks:
        - skill: athletics
          difficulty: 0.6
        - skill: parkour
          difficulty: 0.5
      rewards:
        xp: 1000

  chase_choices:
    - id: path-aggressive
      title: Агрессивная езда
      trigger_choice: aggressive_driving
      consequences:
        time_saved: maximum
        risk: very_high
      skill_checks:
        - skill: driving
          difficulty: 0.9
          required: true
      rewards:
        xp: 1500

    - id: path-alleys
      title: Узкие переулки
      trigger_choice: narrow_alleys
      consequences:
        pursuers_lost: true
        route_longer: true
      skill_checks:
        - skill: navigation
          difficulty: 0.5
      rewards:
        xp: 1000

    - id: path-police
      title: Вызвать полицию
      trigger_choice: call_police
      consequences:
        time_lost: 5_minutes
        pursuit_ended: guaranteed
      rewards:
        xp: 600

rewards:
  base_rewards:
    xp: 5000
    money: 15000
    reputation:
      biomed_corp: 1000
      sao_paulo_couriers: 500

  completion_rewards:
    achievements:
      - id: life_saver
        name: Спаситель жизни
        description: Доставили донорское сердце вовремя
      - id: traffic_master
        name: Мастер пробок
        description: Победили легендарные пробки Сан-Паулу

  time_bonuses:
    under_25_minutes:
      bonus_xp: 2000
      bonus_money: 5000
    under_20_minutes:
      bonus_xp: 4000
      bonus_money: 10000
      bonus_reputation: 500

npcs:
  - id: npc-maria
    name: Мария
    role: dispatcher
    age: 35
    description: |
      Диспетчер BioMed. Координирует все экстренные доставки. Знает город как
      свои пять пальцев. Стрессоустойчивая, но переживает за каждого курьера.
    appearance: audio_only
    personality: [professional, caring, stressed]

  - id: npc-patient
    name: Девочка-пациент
    role: victim
    age: 8
    description: |
      Ребенок, ожидающий трансплантацию. Никогда не появляется напрямую, но её
      жизнь - ставка квеста.
    appearance: distant
    personality: [innocent, vulnerable]

locations:
  primary_location:
    id: loc-sao-paulo-traffic
    name: Пробки Сан-Паулу
    description: |
      300 км застывшего металла. Клаксоны, выхлопы, жара. Один из худших traffic
      nightmare в мире. Но между машинами - пространство для мотоцикла.
    atmosphere: claustrophobic_rush
    mood: tense_urgent

world_state_changes:
  immediate:
    - patient_saved: true
    - biomed_reputation_increased: true

themes:
  primary: [race_against_time, urban_navigation, life_or_death]
  secondary: [traffic_hell, corporate_competition, courier_life]

atmosphere:
  setting: gridlocked_megacity
  mood: high_tension
  visual_style: urban_chaos

difficulty:
  combat_difficulty: none
  driving_difficulty: very_high
  navigation_difficulty: high
  time_pressure: extreme
  overall_difficulty: hard

estimated_duration:
  first_playthrough: 40_minutes_realtime
  speed_run: 25_minutes

replayability:
  choice_variations: 9
  different_routes: 3_per_segment
  time_attack: true

quest_definition:
  quest_type: side
  level_min: 15
  level_max: 30
  requirements:
    required_quests: []
    required_flags: []
    required_reputation: {}
    required_items: []
    skill_requirements:
      - skill: driving_motorcycle
        min_value: 0.5
      - skill: quick_thinking
        min_value: 0.4
  objectives:
    - id: obj-001
      text: "Получить термоконтейнер с донорским сердцем в штабе BioMed"
      type: interact
      target: package_pickup
      optional: false
    - id: obj-002
      text: "Доставить сердце в госпиталь Сириу-Либанез за 30 минут через пробки"
      type: deliver
      target: hospital_delivery
      optional: false
  rewards:
    experience: 4000
    currency: 800
    reputation:
      sao_paulo: 15
      biomed_corp: 20
    unlocks:
      achievements:
        - "Гонщик пробок"
  branches: []

notes:
  design_notes: |
    Квест о легендарных пробках Сан-Паулу как препятствие. Реальный time pressure
    создает напряжение. Каждое решение влияет на оставшееся время. Chase sequence
    добавляет конфликт beyond просто навигации.

  balance_notes: |
    30 минут - tight, но реально если игрок делает правильные выборы. Каждый
    путь имеет trade-off: время vs риск vs skill requirement. Нет "легкого" пути.

  narrative_notes: |
    Эмоциональная ставка (жизнь ребенка) создает мотивацию beyond денег. Показывает
    курьеров как героев, спасающих жизни в хаосе мегаполиса.
