metadata:
  id: quest-saopaulo-carnival-006
  quest_code: SAO_2020_CARN_006
  title: Маски и тайны
  title_en: Masks and Secrets
  document_type: quest
  category: side_quest
  quest_type: side
  status: active
  version: "1.1.0"
  timeline: 2020-2029
  year: 2027
  season: spring
  location:
    city: Sao Paulo
    region: Sao Paulo State
    country: Brazil
    district: Sambadrome
  created_at: 2025-11-26T00:00:00Z
  owner:
    role: content-writer
  tags:
    - sao-paulo
    - carnival
    - samba
    - mystery
    - murder
    - investigation
  github_issue: 1076
  related_documents:
    - id: quest-system-architecture
      relation: implements

summary:
  brief: |
    Карнавал. Миллионы масок. Одна скрывает убийцу.
  
  description: |
    Carnaval de São Paulo - второй по величине в Бразилии после Рио. Sambódromo,
    80 тысяч зрителей, samba schools соревнуются за победу. Музыка, танцы, цвета,
    chaos, radость. Весь город празднует. Perfect time для преступления.
    
    Você não tem uma página de destino no portal. Segunda-feira перед карнавалом. Rodrigo Mendes, choreographer известной
    samba school Vai-Vai, найден мертвым в costume warehouse. Удушен samba sash.
    Полиция overwhelmed карнавалом - тысячи людей, сотни events. Недостаточно
    ресурсов для investigation.
    
    Carolina Mendes, сестра Rodrigo, нанимает тебя privately. "Полиция говорит
    'accident'. Bullshit. Кто-то убил его. У него были enemies - rival schools,
    jealous dancers, gambling debts. И карнавал starts в 3 дня. After carnival,
    все suspects уедут. Trail cold. Найди убийцу before карнавал ends."
    
    48 hours. 80 тысяч людей в костюмах и масках. Все dancing, drinking, chaotic.
    Impossible task? Maybe. But Carolina desperate, и justice не ждет.

  goal: |
    Investigate murder Rodrigo Mendes, identify killer, gather proof, deliver justice
    до окончания карнавала когда все suspects disappear.

  essence: |
    Murder mystery во время карнавала. Time pressure, chaos crowd, cultural celebration
    contrasting with dark investigation. Cyberpunk noir meets Brazilian carnival.

requirements:
  level_min: 14
  level_max: 30
  skill_requirements:
    - skill: investigation
      min_value: 0.6
      description: Solve murder mystery
    - skill: social
      min_value: 0.4
      description: Navigate carnival chaos

story:
  background: |
    Carnaval - самый важный festival в Бразилии. Неделя до Lent. Все ограничения
    сброшены. Music, dance, drinks, freedom. Samba schools тренируются год для
    one night performance в Sambódromo. Prestige, money, community pride - всё on line.
    
    Vai-Vai - one of oldest schools (1930). Working-class roots, fierce pride. Rodrigo
    Mendes choreographed их show 5 лет. Brilliant, demanding, controversial. Loved
    и hated equally. Perfect victim - много suspects.

  opening: |
    Понедельник утро. Costume warehouse Vai-Vai. Полиция tape, но только два officers.
    "Accident" report уже filed. Carolina ждет outside, eyes red от плача.
    
    "Спасибо что пришел. Они не хотят investigate. Too busy с карнавал security.
    Но Rodrigo... он был careful man. Never alone в warehouse late night. Someone
    lured him. И это," она показывает crime scene photo, "не accident."
    
    Body found в 6 AM воскресенье cleaning crew. Удушен samba sash - irony bitter.
    Time of death: Saturday между 10 PM - 2 AM. Warehouse locked from inside, но
    backdoor found cracked. Someone entered, killed, left через backdoor.
    
    Carolina дает список suspects:
    - **Diego Santos** - rival choreographer from Mocidade school. Public feud с Rodrigo.
    - **Alessandra Lima** - lead dancer. Rodrigo demoted her last month. Devastated.
    - **Paulo "Bicheiro" Cruz** - local bookie. Rodrigo owed 50K reals gambling debt.
    - **Marina Silva** - Rodrigo's ex-girlfriend. Messy breakup два месяца ago.
    - **Fernando Costa** - Vai-Vai president. Disagreed with Rodrigo's expensive costume choices.
    
    "Все они will be at карнавал. После - scattered. Найди truth. For Rodrigo."

  act_one: |
    **Investigation start - 48 hours countdown**
    
    **Monday (2 days before carnival):**
    
    Crime scene first. Warehouse full costumes, feathers, sequins, glitter. Beautiful
    и eerie. Blood trace hidden by red sequins. Struggle signs minimal - surprise
    attack. Sash used - crime of passion или message?
    
    Security camera outside: disabled Saturday 9 PM. Professional or lucky?
    
    Interviews begin:
    
    **Diego Santos:** Found at Mocidade rehearsal. Hostile. "Rodrigo? Glad he's dead.
    Stole my choreography ideas. But kill him? Please. I'm winning honestly now."
    Alibi: rehearsal 8 PM - midnight, 40 witnesses.
    
    **Alessandra Lima:** Devastated. "Rodrigo demoted me, yes. Hurt? Yes. But kill
    him? Never. He was harsh, но made us great." Crying, genuine. Alibi: home alone,
    no proof.
    
    **Paulo "Bicheiro" Cruz:** Dangerous man. Bookie operations, connections. "50K?
    Yeah, Rodrigo owed. But dead man doesn't pay. Bad business kill debtors. Scares
    others off." Logic sound, но criminals lie. Alibi: "I was working", vague.
    
    **Marina Silva:** Bitter. "Rodrigo dumped me for younger dancer. Humiliating.
    But murder? Too dramatic even for me." Sarcastic, defensive. Alibi: bar until
    1 AM, witnesses confirm.
    
    **Fernando Costa:** Politician-smooth. "Disagreements? Business. Rodrigo spent
    too much, но results good. Why kill golden goose?" Calm, controlled. Alibi:
    charity dinner until 11 PM, then home.
    
    All have motive. Some have weak alibis. Need more evidence.

  act_two: |
    **Tuesday (1 day before carnival) - deeper investigation**
    
    Carnival preparations intensify. Chaos growing. Time running out.
    
    Breakthrough: Forensics finds skin под Rodrigo's nails - he fought back. DNA
    test takes 24 hours. Race against time.
    
    Re-interview suspects with pressure:
    
    Discovery 1: Diego's "alibi witnesses" - paid dancers. Some crack under questioning,
    timeline inconsistent. Diego left rehearsal 10:30-11:30 PM. Enough time.
    
    Discovery 2: Alessandra's phone GPS - pinged near warehouse 11 PM Saturday. She
    lied about being home. Confronted, breaks: "Okay! I went there! But Rodrigo
    was already dead! I panicked, ran! Didn't report because looked guilty!"
    
    Discovery 3: Paulo's "working" - confirmed by associates. He was at illegal poker
    game 9 PM - 3 AM. Witnesses (criminals, but alibis check out). He's clear.
    
    Discovery 4: Marina's bar witnesses - yes, she was there until 1 AM. But CCTV
    shows her leaving 11:45, returning 12:30. 45 minutes unaccounted for.
    
    Discovery 5: Fernando's charity dinner - confirmed. But his driver called in
    sick Saturday. Fernando drove himself home. No witness для his whereabouts
    after 11 PM.
    
    Suspects narrow: Diego, Marina, Fernando. Alessandra - witness, not killer.
    
    Wednesday morning - DNA results: Male, no match в database. But can compare to
    suspects if you get samples. How?

  act_three: |
    **Wednesday - Carnival day, final resolution**
    
    Carnival begins. Sambódromo fills. 80K people. Music, energy, colors. Vai-Vai
    performs без Rodrigo - tribute to him. Emotional.
    
    You need DNA samples. Suspects all at carnival. Creative methods needed.
    
    Diego - bump into him, spill drink, collect glass. Marina - offer cigarette,
    collect butt. Fernando - shake hands, collect sweat. Stealth collection.
    
    Rush samples to friendly lab tech. Expedited testing (bribe 5K reals). 2 hours.
    
    Results: **Fernando Costa's DNA matches.**
    
    Confront Fernando backstage. He's watching Vai-Vai performance, tears in eyes.
    
    "You know." Not question, statement. He nods.
    
    "Rodrigo was bleeding school dry. 500K reals for costumes this year. We can't
    afford. I told him cut costs. He refused, threatened to leave, join rival school,
    take half our dancers. Vai-Vai would collapse. 90 years history gone."
    
    "I went to warehouse to reason with him. Argument escalated. He insulted my
    dead father, called me 'small man'. I... snapped. Grabbed sash, pulled. When
    I realized что я сделал - too late. I panicked. Disabled camera, left через
    backdoor, made it look like robbery gone wrong."
    
    "But I couldn't live with it. Every samba beat - I hear him dying. Look."
    He shows suicide note in pocket. "After Vai-Vai performs, I was going to end it.
    Could not face что я сделал."
    
    **Final choice:**
    
    **1. Arrest him now:** Call police, Fernando arrested during carnival. Justice
    served, но Vai-Vai scandal, community devastated, carnival ruined for school.
    
    **2. Let him watch, then arrest:** Let him see Vai-Vai perform, honor Rodrigo's
    work, then take him in после. Justice delayed 2 hours, но more humanity.
    
    **3. Negotiate surrender:** He turns himself in tomorrow, confesses everything.
    Tonight он lets Vai-Vai celebrate. Justice served, carnival не ruined, community
    gets closure properly. Trust required.
    
    **4. Let him go:** Walk away. Fernando's guilt destroying him anyway. Vai-Vai
    survives без scandal. Justice sacrificed for community. Morally darkest choice.

  resolution: |
    **If arrested immediately:** Fernando jailed, confesses. Media storm. Vai-Vai's
    performance overshadowed. Community divided. Justice served, joy destroyed.
    
    **If arrested after:** Vai-Vai wins second place. Beautiful performance. Then
    Fernando arrested. Tribute to Rodrigo preserved. Balanced approach.
    
    **If surrender tomorrow:** Fernando turns himself in Thursday. Full confession.
    Vai-Vai celebrated, then mourns properly. Community processes grief in order.
    Best for everyone.
    
    **If released:** Fernando disappears. Suicide suspected but body never found.
    Case remains "unsolved". Vai-Vai thrives. Carolina never knows truth. Heaviest
    burden on you.
    
    Carnival ends. Masks come off. Truth revealed or hidden. Justice или mercy.
    Your choice defines outcome.

objectives:
  - id: obj-001
    order: 1
    type: investigation
    title: Examine crime scene
    requirements:
      warehouse_examined: true
    reward_xp: 400
    optional: false

  - id: obj-002
    order: 2
    type: investigation
    title: Interview all suspects
    requirements:
      suspects_interviewed: 5
    reward_xp: 800
    optional: false

  - id: obj-003
    order: 3
    type: investigation
    title: Find inconsistencies
    requirements:
      alibis_checked: true
    reward_xp: 1000
    optional: false

  - id: obj-004
    order: 4
    type: evidence
    title: Collect DNA samples
    requirements:
      samples_collected: 3
    reward_xp: 600
    optional: false

  - id: obj-005
    order: 5
    type: confrontation
    title: Confront killer
    requirements:
      killer_identified: fernando
    reward_xp: 1200
    optional: false

  - id: obj-006
    order: 6
    type: choice
    title: Decide Fernando's fate
    requirements:
      final_choice: required
    reward_xp: 2000
    optional: false

branches:
  investigation_paths:
    collect_evidence:
      - crime_scene_analysis: +500xp
      - witness_interviews: +800xp
      - dna_collection: +600xp

  resolution_paths:
    - id: immediate_arrest
      consequences:
        justice: served
        community: devastated
        carnival: ruined
      rewards:
        xp: 4000
        reputation:
          police: 1000
          vai_vai: -1500
    
    - id: arrest_after_performance
      consequences:
        justice: served
        tribute_preserved: true
        community: mixed_feelings
      rewards:
        xp: 6000
        reputation:
          police: 800
          vai_vai: -500
    
    - id: surrender_tomorrow
      consequences:
        justice: served
        community: processes_properly
        carnival_unspoiled: true
      rewards:
        xp: 8000
        reputation:
          vai_vai: 1000
          carolina: 2000
        achievements:
          - id: merciful_justice
            name: Милосердное правосудие
    
    - id: let_go
      consequences:
        justice: denied
        fernando_disappears: true
        guilt_burden: on_player
      rewards:
        xp: 3000
        money: 20000
        reputation:
          vai_vai: 2000
          carolina: -3000

rewards:
  base_rewards:
    xp: 5000
    money: 15000

npcs:
  - id: npc-carolina
    name: Carolina Mendes
    role: quest_giver
    age: 38
    description: |
      Sister of victim. Grieving, determined. Needs closure more than revenge.
    personality: [grieving, determined, fair]

  - id: npc-fernando
    name: Fernando Costa
    role: killer
    age: 52
    description: |
      Vai-Vai president. Killed из desperate love for school. Consumed by guilt.
      Not evil, just tragic.
    personality: [guilty, traditional, tragic]

locations:
  primary_location:
    id: loc-sambodromo
    name: Sambódromo
    description: |
      Carnival stadium. 80K capacity. Heart of São Paulo carnival. Energy incredible.
    atmosphere: celebration_chaos

world_state_changes:
  conditional:
    scandal:
      - vai_vai_reputation: damaged
    mercy:
      - vai_vai_thrives: true

themes:
  primary: [murder_mystery, carnival, justice_vs_mercy, time_pressure]
  secondary: [cultural_celebration, guilt, community]

difficulty:
  combat_difficulty: none
  investigation_difficulty: very_high
  time_pressure: extreme
  moral_difficulty: very_high
  overall_difficulty: hard

estimated_duration:
  first_playthrough: 70_minutes

quest_definition:
  quest_type: side
  level_min: 14
  level_max: 30
  requirements:
    required_quests: []
    required_flags: []
    required_reputation: {}
    required_items: []
    skill_requirements:
      - skill: investigation
        min_value: 0.6
      - skill: social
        min_value: 0.4
  objectives:
    - id: obj-001
      text: "Встретиться с Каролиной Mendes и получить задание на расследование"
      type: dialogue
      target: carolina_meeting
      optional: false
    - id: obj-002
      text: "Исследовать место преступления и собрать улики"
      type: investigate
      target: crime_scene
      optional: false
    - id: obj-003
      text: "Интервьюировать подозреваемых во время карнавала"
      type: dialogue
      target: suspect_interviews
      optional: false
    - id: obj-004
      text: "Найти убийцу и собрать доказательства"
      type: investigate
      target: killer_identification
      optional: false
    - id: obj-005
      text: "Доставить правосудие до окончания карнавала"
      type: deliver
      target: justice_delivery
      optional: false
  rewards:
    experience: 4500
    currency: 1000
    reputation:
      sao_paulo: 20
    unlocks:
      achievements:
        - "Карнавальный детектив"
  branches: []

notes:
  design_notes: |
    Murder mystery in carnival chaos - unique setting. 48h time limit creates urgency.
    Fernando as sympathetic killer - not evil, desperate. Final choice - justice vs
    mercy vs community. No perfect answer. Carnaval де São Paulo setting rich cultural context.
