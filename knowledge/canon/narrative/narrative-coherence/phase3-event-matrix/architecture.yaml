metadata:
  id: narrative-coherence-event-matrix-architecture
  title: "Архитектура графа событий"
  document_type: canon
  category: narrative-coherence
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-13T00:00:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-06T23:29:00Z
  owners:
    - role: narrative_lead
      contact: narrative@necp.game
  tags:
    - event-matrix
    - quest-graph
    - world-state
  topics:
    - dynamic-content
    - narrative-systems
  related_systems:
    - gameplay-service
    - narrative-service
  related_documents:
    - id: narrative-coherence-quest-dependencies-graph
      relation: references
    - id: narrative-coherence-world-state-graph
      relation: references
  source: "shared/docs/knowledge/canon/narrative/narrative-coherence/phase3-event-matrix/architecture.md"
  visibility: internal
  audience:
    - concept
    - narrative
    - backend
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: "Нужно описать архитектуру графа событий для динамической генерации контента."
  goal: "Определить типы узлов, связи, вероятностные модели и интеграцию с мировым состоянием."
  essence: "Граф событий объединяет квесты, выборы и состояние мира, поддерживая динамическое наполнение AAA MMORPG."
  key_points:
    - "Четыре типа узлов: квесты, выборы, состояние мира и события."
    - "Связи REQUIRES, UNLOCKS, BLOCKS и INFLUENCES управляют прогрессией."
    - "Вероятностная и весовая системы регулируют генерацию контента."
    - "Глобальное состояние мира запускает триггеры и обновляет события."
content:
  sections:
    - id: overview
      title: "Краткое описание"
      body: |
        Архитектура определяет структуру графа событий, который управляет динамическими квестами и мирами. Модель поддерживает непредсказуемость контента и объединяет решения игроков и глобальные состояния.
      mechanics_links: []
      assets: []
    - id: node-types
      title: "Типы узлов графа"
      body: |
        ### Quest Node
        ```
        type: quest
        id: quest_id
        prerequisites: [quest_ids]
        unlocks: [quest_ids]
        blocks: [quest_ids]
        probability: 0.0-1.0
        ```

        ### Choice Node
        ```
        type: choice
        id: choice_id
        options: [option_ids]
        consequences: {option_id: [effects]}
        ```

        ### World State Node
        ```
        type: world_state
        id: state_id
        value: any
        triggers: [event_ids]
        ```

        ### Event Node
        ```
        type: event
        id: event_id
        conditions: [conditions]
        effects: [effects]
        probability: 0.0-1.0
        ```
      mechanics_links: []
      assets: []
    - id: edge-types
      title: "Типы связей"
      body: |
        • **REQUIRES** — доступ к узлу после выполнения зависимого узла.  
        • **UNLOCKS** — открывает новые ветви после завершения события.  
        • **BLOCKS** — блокирует узел навсегда или до выполнения условий.  
        • **INFLUENCES** — мягкое влияние на сложность, награды или диалоги.
      mechanics_links: []
      assets: []
    - id: dynamic-generation
      title: "Динамическая генерация"
      body: |
        ### Probability System
        ```
        event_pool:
          - event_id: random_ambush
            base_probability: 0.15
            modifiers:
              danger_zone: +0.10
              night_time: +0.05
              high_reputation_gangs: -0.10
            final_probability: calculated
        ```

        ### Weight System
        ```
        quest_selection:
          - quest_id: SQ-2020-001
            weight: 10
            conditions:
              level: 1-5
              class: Solo
            adjusted_weight: calculated
        ```
      mechanics_links: []
      assets: []
    - id: world-state
      title: "Интеграция мирового состояния"
      body: |
        ```
        world_state:
          blackwall_integrity: 0-100
          corporate_control: 0-100
          faction_wars_active: boolean
          player_chaos_score: 0-100

        triggers:
          - condition: blackwall_integrity < 50
            effect: unlock_blackwall_incident_quests
          - condition: corporate_control > 80
            effect: increase_revolution_quest_probability
        ```
        Глобальные значения обновляются событиями и играми игроков, запускают триггеры и переопределяют вероятности графа.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference: []
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-13
    author: concept_director
    changes: "Конвертация архитектуры графа событий из MD в YAML."
validation:
  checksum: ''
  schema_version: '1.0'

