metadata:
  id: narrative-coherence-event-matrix-export-scripts
  title: "YAML → JSON Export Scripts"
  document_type: canon
  category: narrative-coherence
  status: draft
  version: '1.0.0'
  last_updated: 2025-11-13T00:00:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: narrative_tools
      contact: tools@necp.game
  tags:
    - export
    - event-matrix
    - tooling
  topics:
    - pipelines
    - backend-integration
  related_systems:
    - narrative-service
    - backend-build
  related_documents:
    - id: narrative-coherence-event-matrix-architecture
      relation: references
    - id: narrative-coherence-quest-dependencies-graph
      relation: references
  source: "shared/docs/knowledge/canon/narrative/narrative-coherence/phase3-event-matrix/export/README.md"
  visibility: internal
  audience:
    - concept
    - narrative
    - backend
  risk_level: low
review:
  chain:
    - role: tools_lead
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: "Нужен единый процесс конвертации YAML графов событий в JSON для backend."
  goal: "Описать доступные скрипты, входные и выходные файлы и шаги проверки."
  essence: "Скрипты Python и Node.js генерируют JSON-артефакты графа событий для загрузки в сервисы."
  key_points:
    - "Рекомендуемый путь — Python с PyYAML."
    - "Поддерживается альтернативный Node.js конвертер."
    - "Конвертируются четыре основных YAML файла в JSON."
    - "Приведён формат JSON и шаги валидации."
content:
  sections:
    - id: scripts
      title: "Доступные скрипты"
      body: |
        ### Python (рекомендуется)
        ```bash
        pip install pyyaml
        python convert-quest-graph.py
        ```

        ### Node.js
        ```bash
        npm install js-yaml
        node convert-quest-graph.js
        ```
      mechanics_links: []
      assets: []
    - id: io-mapping
      title: "Входные и выходные файлы"
      body: |
        **Input YAML:**
        1. `phase2-narrative/connections/side-quests-matrix.yaml`
        2. `phase2-narrative/connections/quest-triggers.yaml`
        3. `phase2-narrative/connections/quest-blockers.yaml`
        4. `phase3-event-matrix/graph/quest-dependencies.yaml`

        **Output JSON:**
        1. `export/side-quests-matrix.json`
        2. `export/quest-triggers.json`
        3. `export/quest-blockers.json`
        4. `export/quest-dependencies-full.json`
      mechanics_links: []
      assets: []
    - id: output-format
      title: "Формат JSON"
      body: |
        ```
        {
          "metadata": {
            "version": "1.0.0",
            "total_quests": 550
          },
          "nodes": [
            {
              "id": "MQ-2020-001",
              "name": "Первые шаги",
              "era": "2020-2030",
              "type": "main"
            }
          ],
          "edges": [
            {
              "from": "MQ-2020-001",
              "to": "MQ-2020-002",
              "type": "unlocks",
              "timing": "immediate"
            }
          ],
          "statistics": {
            "total_nodes": 550,
            "total_edges": 1200
          }
        }
        ```
      mechanics_links: []
      assets: []
    - id: backend-integration
      title: "Интеграция с backend"
      body: |
        ```java
        @Service
        public class QuestGraphService {
            private QuestGraph graph;

            @PostConstruct
            public void init() {
                ObjectMapper mapper = new ObjectMapper();
                graph = mapper.readValue(
                    new File("quest-dependencies-full.json"),
                    QuestGraph.class
                );
            }
        }
        ```
        Сервис загружает JSON, рассчитывает доступные квесты и использует граф для выдачи веток игрокам.
      mechanics_links: []
      assets: []
    - id: validation
      title: "Проверка результатов"
      body: |
        ```bash
        ls -lh export/
        cat export/quest-dependencies-full.json | jq '.statistics'
        cat export/quest-dependencies-full.json | jq '.nodes | length'
        cat export/quest-dependencies-full.json | jq '.edges | length'
        ```
        Ожидаемые показатели: 4 файла, суммарный размер ~500KB–1MB, 550+ узлов и 1200+ связей.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  github_issue: 133
  needs_task: false
  queue_reference: []
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-13
    author: concept_director
    changes: "Конвертация руководства по экспортным скриптам из MD в YAML."
validation:
  checksum: ''
  schema_version: '1.0'

