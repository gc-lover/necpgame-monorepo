# Issue: #109
metadata:
  id: narrative-coherence-quest-template-extended
  title: 'Quest Template with Branching'
  document_type: canon
  category: narrative-coherence
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-13T00:00:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-07T00:02:00Z
  owners:
    - role: narrative_systems
      contact: narrative@necp.game
  tags:
    - quest-template
    - branching
    - documentation
  topics:
    - quest-authoring
    - dialogue-design
  related_systems:
    - quest-service
    - dialogue-service
  related_documents:
    - id: quest-system-overview
      relation: references
    - id: quest-system
      relation: references
    - id: content-quests-template-shooter
      relation: complements
  source: shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/templates/quest-template-extended.md
  visibility: internal
  audience:
    - narrative
    - quest-design
    - systems
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: 'Необходим расширенный шаблон квеста с ветвлением и структурой диалогов.'
  goal: 'Зафиксировать единый формат для авторов, описывающий метаданные, требования, структуру, награды и ветки.'
  essence: 'Документ предоставляет YAML-шаблоны блоков и чеклист для создания ветвящихся квестов.'
  key_points:
    - 'Метаданные квеста и требования оформлены в стандартизированном виде.'
    - 'Структура включает objectives, ветки, диалоговое дерево и world state impact.'
    - 'Чеклист покрывает стадии design → writing → integration → testing → publication.'
content:
  sections:
    - id: metadata-block
      title: 'Блок метаданных'
      body: |
        ```yaml
        quest_id: "SQ-YYYY-NNN"
        name: "[Quest Name]"
        description: "[2-3 предложения]"
        type: side
        era: "YYYY-YYYY"
        region: "[Region/City/District]"
        estimated_duration: 30
        author: "[Your name]"
        created: "YYYY-MM-DD"
        version: "1.0.0"
        ```
      mechanics_links: []
      assets: []
    - id: requirements
      title: 'Требования'
      body: |
        ```yaml
        requirements:
          min_level: 1
          max_level: null
          required_quests: []
          required_flags: []
          required_reputation: {}
          class_specific: null
          origin_specific: null
          required_items: []
        ```
      mechanics_links: []
      assets: []
    - id: structure
      title: 'Структура квеста'
      body: |
        ```yaml
        structure:
          has_branches: true
          total_branches: 3
          dialogue_tree_root: 1
          objectives:
            - id: 1
              text: "[Objective description]"
              type: talk
              target: npc_id
              count: 1
              optional: false
        ```
      mechanics_links: []
      assets: []
    - id: rewards
      title: 'Базовые награды'
      body: |
        ```yaml
        rewards:
          experience: 1000
          money: 5000
          items:
            - item_id: "weapon_001"
              quantity: 1
          reputation:
            Faction1: 15
            Faction2: -10
        ```
      mechanics_links: []
      assets: []
    - id: dialogue-tree
      title: 'Диалоговое дерево'
      body: |
        Документ содержит подробный шаблон `dialogue_tree`, включающий стартовые узлы, ветвления, skill checks и финалы. Пример оформлен в виде YAML-блоков с `choices`, `success/failure` и конвергенцией путей в `id: 100`.
      mechanics_links: []
      assets: []
    - id: branches
      title: 'Ветки и последствия'
      body: |
        ```yaml
        branches:
          - branch_id: "pathA"
            branch_name: "Aggressive Path"
            conditions:
              flags: ["aggressive_approach"]
            consequences:
              reputation_changes:
                Faction: -10
              unlocks_quests: ["SQ-NEXT-A"]
          - branch_id: "pathB"
            branch_name: "Diplomatic Path"
            conditions:
              flags: ["diplomatic_approach"]
            consequences:
              reputation_changes:
                Faction: +15
              unlocks_quests: ["SQ-NEXT-B"]
        ```
      mechanics_links: []
      assets: []
    - id: dependencies
      title: 'Зависимости и влияние'
      body: |
        ```yaml
        dependencies:
          unlocks:
            immediate: ["SQ-YYYY-NNN+1"]
          blocks:
            permanent: ["SQ-ENEMY-FACTION"]
          influences:
            - quest: "MQ-MAIN-QUEST"
              impact: "Makes easier"
              modifier: +0.2
        ```
      mechanics_links: []
      assets: []
    - id: world-state
      title: 'World State Impact'
      body: |
        ```yaml
        world_state_impact:
          changes:
            - key: "faction_power_Faction1"
              value_change: +10
              scope: server
          triggers:
            - event: "faction_war_start"
              condition: "faction_power_Faction1 > 80"
        ```
      mechanics_links: []
      assets: []
    - id: checklist
      title: 'Чеклист'
      body: |
        Раздел включает пошаговый контроль для стадий Design, Writing, Integration, Testing и Publication, помогая авторам убедиться, что все требования выполнены перед handoff.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  github_issue: 109
  needs_task: false
  queue_reference: []
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-07
    author: ai_brain_manager
    changes: 'Quest creation guide with branching template опубликован.'
validation:
  checksum: ''
  schema_version: '1.0'
