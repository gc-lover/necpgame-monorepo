# Issue: #141890018
metadata:
  id: idea-quest-tree-endings-system
  title: "Квестовое дерево с концовками"
  document_type: idea
  category: mechanics
  status: approved
  version: '1.0.0'
  last_updated: 2025-12-28T17:00:00.000000
  concept_approved: true
  concept_reviewed_at: '2025-12-28T17:00:00.000000'
  owners:
    - role: idea_writer
      contact: idea@necp.game
  tags:
    - quest
    - narrative
    - choice
    - ending
  topics:
    - quest-structure
    - player-choice
    - narrative-branching
  related_systems:
    - dynamic-quests-service
    - narrative-service
    - progression-service
  related_documents:
    - id: quest-structure
      relation: extends
    - id: narrative-arcs
      relation: integrates
  source: internal-ideas
  visibility: internal
  audience:
    - concept
    - design
    - narrative
  risk_level: medium
review:
  chain:
    - role: idea_writer
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: Линейные квесты не дают игрокам чувства влияния на историю и мир игры.
  goal: Создать систему ветвящихся квестов с множественными концовками, где выборы игроков влияют на исход заданий и развитие мира.
  essence: Квесты становятся живыми историями с ветвями развития, где каждый выбор ведет к уникальным исходам, наградам и последствиям для мира игры.
  key_points:
    - Квесты имеют древовидную структуру с ветвями и концовками
    - Выборы игроков влияют на исход и награды
    - Концовки влияют на мир и доступный контент
    - Система отслеживает "альтернативную историю"
    - Возможность переигрывания с другими выборами
content:
  sections:
    - id: quest-structure
      title: Структура квестового дерева
      body: |
        Древовидная структура:
        - Корневой квест (введение)
        - Основные ветви (главные сюжетные линии)
        - Побочные ветви (альтернативные пути)
        - Листы (различные концовки)
        - Соединения между ветвями

    - id: choice-system
      title: Система выборов
      body: |
        Типы выборов:
        - Диалоговые (разговор с NPC)
        - Действенные (что делать в ситуации)
        - Этические (моральные дилеммы)
        - Экономические (торговля и ресурсы)
        - Социальные (отношения с фракциями)

    - id: ending-types
      title: Типы концовок
      body: |
        Различные исходы:
        - Успешные (миссия выполнена)
        - Частичные (компромиссные решения)
        - Неудачные (миссия провалена)
        - Альтернативные (неожиданные повороты)
        - Множественные (несколько исходов одновременно)

    - id: consequence-system
      title: Система последствий
      body: |
        Влияние на мир:
        - Изменение отношений с NPC
        - Доступ к новым локациям
        - Изменение экономики региона
        - Влияние на фракции и корпорации
        - Разблокирование новых квестов

    - id: replayability
      title: Переигрываемость
      body: |
        Система повторного прохождения:
        - Сохранение альтернативных исходов
        - Разные награды за разные пути
        - Эффект "что, если" для исследования
        - Коллекционирование концовок
        - Социальное сравнение выборов

    - id: narrative-integration
      title: Интеграция с нарративом
      body: |
        Связь с историей:
        - Влияние на глобальный сюжет
        - Персональные истории персонажей
        - Мировые события и кризисы
        - Развитие отношений и альянсов
        - Создание легенд и мифов

  mechanics:
    - name: Choice Tracking
      description: Отслеживание выборов игрока в квестах
      implementation: dynamic-quests-service

    - name: Branch Resolution
      description: Система разрешения ветвей квестов
      implementation: narrative-service

    - name: Consequence Engine
      description: Движок расчета последствий выборов
      implementation: world-simulation-service

    - name: Ending Collection
      description: Система коллекционирования концовок
      implementation: progression-service

    - name: Alternative History
      description: Хранение альтернативных историй мира
      implementation: database-service

  gameplay_hooks:
    - "Обнаружить скрытую ветвь квеста через особый выбор"
    - "Получить уникальную концовку, изменившую фракцию"
    - "Переиграть квест для коллекционирования всех концовок"
    - "Встретить последствия старых выборов в новых квестах"
    - "Создать собственный квест с ветвящимися исходами"

  quest_opportunities:
    - "Этическая дилемма - выбор между прибылью и моралью"
    - "Социальный конфликт - влияние на отношения фракций"
    - "Экономическое решение - инвестиции с рисками"
    - "Личный выбор - влияние на развитие персонажа"
    - "Глобальный кризис - решение, влияющее на весь мир"

  technical_requirements:
    - "Графовая структура хранения квестов"
    - "Система отслеживания состояний мира"
    - "API для ветвления и разрешения квестов"
    - "База данных альтернативных историй"
    - "Система кэширования для производительности"

  risks:
    - "Сложность дизайна ветвящихся квестов"
    - "Перегрузка игроков количеством выборов"
    - "Баланс между ветвями и наградами"
    - "Техническая сложность реализации"

  success_metrics:
    - "Количество уникальных концовок, открытых игроками"
    - "Вовлеченность в повторное прохождение"
    - "Качество нарратива ветвящихся историй"
    - "Влияние выборов на игровой мир"
appendix:
  glossary:
    - term: Квестовое дерево
      definition: Структура квеста с ветвями и множественными концовками
    - term: Ветвь квеста
      definition: Альтернативный путь развития в квесте
    - term: Концовка квеста
      definition: Финальный исход квеста с уникальными последствиями
    - term: Альтернативная история
      definition: Параллельная версия событий мира на основе выборов игроков
  references:
    - title: Система квестов
      link: proto/openapi/narrative-domain/dynamic-quests-service.yaml
    - title: Нарративная система
      link: proto/openapi/narrative-domain/narrative-service.yaml
    - title: Мировая симуляция
      link: proto/openapi/world-domain/world-simulation-service.yaml
  decisions: []
implementation:
  github_issue: 141890018
  needs_task: false
  queue_reference: []
  blockers: []
history:
  - version: '0.1.0'
    date: 2025-11-27
    author: idea_writer
    changes: Создан документ идеи квестового дерева с концовками
  - version: "1.0.0"
    date: 2025-12-28
    author: idea_writer
    changes: Расширена структура с механиками, хуками и техническими требованиями
validation:
  checksum: ''
  schema_version: '1.0'
