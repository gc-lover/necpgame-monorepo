# Issue: #142072439
metadata:
  id: idea-urban-legends-npc-integration
  title: 'Интеграция баек городских легенд с NPC диалоговой системой'
  document_type: idea
  category: game-mechanics
  status: draft
  version: '1.0.0'
  last_updated: 2025-12-28T11:45:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: narrative-designer
      contact: narrative@necp.game
  tags:
    - urban-legends
    - npc-dialogue
    - dynamic-narrative
    - storytelling
    - immersion
  topics:
    - procedural-narrative
    - social-interaction
    - lore-distribution
    - player-agency
  related_systems:
    - narrative-service
    - social-service
    - worldbuilding-service
  related_documents:
    - id: idea-urban-legends-template-system
      relation: extends
    - id: idea-urban-legends-spreading-system
      relation: complements
    - id: idea-urban-legends-trigger-system
      relation: complements
  source: internal-narrative-design
  visibility: internal
  audience:
    - narrative-design
    - game-design
    - content-writers
  risk_level: medium
review:
  chain:
    - role: narrative-director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: Система баек городских легенд существует изолированно от NPC диалогов, что снижает иммерсивность и возможности для динамического повествования.
  goal: Интегрировать баки городских легенд в NPC диалоговую систему для создания живого, эволюционирующего нарратива через социальные взаимодействия.
  essence: NPC становятся носителями и распространителями легенд, а диалоги превращаются в механизм для обмена историями, влияющий на восприятие мира игроками.
  key_points:
    - NPC диалоги как основной канал распространения легенд
    - Динамическое изменение поведения NPC на основе известных им баек
    - Социальные последствия веры/неверия в легенды
    - Система репутации через обмен историями
content:
  sections:
    - id: system-overview
      title: "Обзор системы интеграции"
      body: |
        Система интеграции баек городских легенд с NPC диалоговой системой создает живую экосистему повествования,
        где NPC не просто обмениваются информацией, но активно участвуют в распространении и эволюции легенд.

        **Ключевые компоненты:**
        - **Диалоговая интеграция**: Легенды становятся частью естественных разговоров
        - **NPC поведение**: Реакции NPC зависят от известных им баек
        - **Социальные последствия**: Выбор игрока в диалогах влияет на отношения и репутацию
        - **Динамическая эволюция**: Легенды меняются через социальные взаимодействия

        **Цели интеграции:**
        - Создание иммерсивного мира с живым фольклором
        - Увеличение реиграбельности через уникальные нарративы
        - Развитие социальной глубины в NPC взаимодействиях
        - Формирование персонализированного опыта повествования
      mechanics_links:
        - system: dynamic-npc-dialogue
        - system: legend-propagation-mechanics
        - system: social-consequence-system
      assets:
        - integration-architecture-diagram
        - dialogue-flow-examples

    - id: dialogue-integration
      title: "Интеграция в диалоговую систему"
      body: |
        **Типы диалоговых интеграций:**

        **Естественное упоминание:**
        - NPC случайно упоминают легенды в повседневных разговорах
        - "Слышал байку про призрака в заброшенном метро..."
        - "Говорят, в старом здании Arasaka что-то происходит..."

        **Целенаправленный обмен:**
        - Игрок может инициировать разговор о легендах
        - NPC делятся историями в ответ на определенные триггеры
        - Диалоги развиваются в зависимости от отношения NPC к игроку

        **Групповые обсуждения:**
        - Несколько NPC обсуждают легенду в присутствии игрока
        - Создание "слухов" через overhearing механику
        - Динамическое распространение историй в барах и на улицах

        **Личное повествование:**
        - NPC рассказывают истории из своего прошлого
        - Связь легенд с личным опытом персонажа
        - Эмоциональная глубина через персональные нарративы
      mechanics_links:
        - system: contextual-dialogue-triggers
        - system: overhearing-mechanics
        - system: emotional-narrative-depth
      assets:
        - dialogue-integration-examples
        - conversation-flow-diagrams

    - id: npc-behavior-modification
      title: "Изменение поведения NPC"
      body: |
        **Влияние легенд на NPC:**

        **Страхи и фобии:**
        - NPC избегают мест, связанных с "проклятыми" легендами
        - Изменение маршрутов и привычек из-за веры в сверхъестественное
        - Реакции на присутствие игрока в "опасных" зонах

        **Вера и скептицизм:**
        - Верующие NPC более открыты к определенным историям
        - Скептики отвергают легенды, создавая контраргументы
        - Изменение отношения к игроку в зависимости от его позиции

        **Социальные связи:**
        - Группы NPC формируются вокруг общих верований
        - Конфликты между "верующими" и "скептиками"
        - Создание подпольных сообществ вокруг легенд

        **Ежедневные рутины:**
        - Изменение расписания из-за "предзнаменований"
        - Ритуалы и традиции, связанные с легендами
        - Влияние на работу и социальную жизнь
      mechanics_links:
        - system: npc-behavior-modification
        - system: belief-system-mechanics
        - system: social-group-formation
      assets:
        - npc-behavior-change-examples
        - routine-modification-diagrams

    - id: player-agency
      title: "Агентность игрока"
      body: |
        **Выбор в диалогах:**
        - Верить или не верить в рассказываемые легенды
        - Распространять или опровергать слухи
        - Использовать легенды для манипуляции NPC

        **Социальные последствия:**
        - Репутация среди разных групп NPC
        - Доступ к информации и союзникам
        - Влияние на квесты и возможности

        **Нарративные ветки:**
        - Разные концовки историй в зависимости от действий игрока
        - Создание персональных легенд о самом игроке
        - Влияние на глобальный нарратив игры

        **Мета-игры:**
        - Создание собственных легенд через действия игрока
        - Влияние на поведение других игроков через социальные сети
        - Долгосрочные последствия выборов в диалогах
      mechanics_links:
        - system: player-choice-consequences
        - system: reputation-system-integration
        - system: meta-narrative-creation
      assets:
        - player-choice-trees
        - consequence-flow-charts

    - id: legend-evolution
      title: "Эволюция легенд через диалоги"
      body: |
        **Распространение историй:**
        - Легенды мутируют при передаче от NPC к NPC
        - Добавление деталей из личного опыта рассказчика
        - Изменение тональности и акцентов в зависимости от аудитории

        **Валидация и опровержение:**
        - NPC могут подтверждать или опровергать части легенд
        - Создание конкурирующих версий одной истории
        - Развитие "официальных" и "народных" версий

        **Культурные изменения:**
        - Легенды адаптируются под культурный контекст региона
        - Влияние субкультур на интерпретацию историй
        - Создание новых легенд из реальных событий

        **Временная динамика:**
        - Легенды стареют и забываются со временем
        - Актуализация старых историй новыми событиями
        - Циклическое возрождение популярных нарративов
      mechanics_links:
        - system: legend-mutation-mechanics
        - system: cultural-adaptation-system
        - system: temporal-legend-dynamics
      assets:
        - legend-evolution-examples
        - mutation-process-diagrams

    - id: technical-implementation
      title: "Техническая реализация"
      body: |
        **Диалоговая система:**
        - Расширение dialogue tree с динамическими ветками
        - Интеграция legend database в NPC memory systems
        - Procedural generation диалогов на основе контекста

        **NPC AI:**
        - Belief systems для моделирования верований NPC
        - Social network simulation для распространения легенд
        - Behavior trees с учетом legend awareness

        **Data management:**
        - Legend propagation tracking через distributed systems
        - Player reputation database по типам легенд
        - Dynamic content generation для уникальных диалогов

        **Performance optimization:**
        - Efficient storage of legend states per NPC
        - Lazy loading для неактивных диалогов
        - Caching для часто используемых legend templates

        **Integration points:**
        - Narrative service для legend content management
        - Social service для inter-NPC communication
        - World service для location-based legend triggers
      mechanics_links:
        - system: dialogue-system-architecture
        - system: npc-ai-enhancements
        - system: distributed-legend-tracking
      assets:
        - technical-architecture-diagrams
        - data-flow-schemas

    - id: content-creation
      title: "Создание контента"
      body: |
        **Дизайн легенд:**
        - Шаблоны для создания новых баек
        - Баланс между ужасом, юмором и социальной сатирой
        - Интеграция с существующими локациями и персонажами

        **NPC characterization:**
        - Определение belief profiles для разных типов NPC
        - Создание backstory, влияющих на восприятие легенд
        - Дизайн personality traits, влияющих на storytelling style

        **Диалоговые сценарии:**
        - Написание branching dialogues с legend integration
        - Создание emotional arcs для legend-based conversations
        - Тестирование natural flow в диалогах

        **Тестирование и баланс:**
        - Playtesting legend propagation mechanics
        - Balancing social consequences для разных выборов
        - Iteration на основе player feedback

        **Локализация:**
        - Адаптация легенд под культурный контекст
        - Перевод диалогов с сохранением tone и nuance
        - Региональные вариации легенд
      mechanics_links:
        - system: legend-template-system
        - system: npc-characterization-tools
        - system: dialogue-authoring-workflow
      assets:
        - legend-design-templates
        - npc-belief-profiles
        - dialogue-script-examples

    - id: player-experience
      title: "Игровой опыт"
      body: |
        **Иммерсивность:**
        - Живой мир с эволюционирующими историями
        - Персонализированные взаимодействия с NPC
        - Чувство принадлежности к живой культуре

        **Реплеибилити:**
        - Разные нарративные пути через выборы в диалогах
        - Уникальные комбинации легенд для каждого прохождения
        - Социальные эксперименты с распространением историй

        **Социальная глубина:**
        - Сложные отношения с NPC через shared beliefs
        - Групповая динамика вокруг легенд
        - Возможность формирования сообществ

        **Эмоциональная вовлеченность:**
        - Эмпатическое понимание NPC через их страхи и верования
        - Моральные дилеммы в выборе веры/скептицизма
        - Создание эмоциональной связи с игровым миром

        **Образовательный аспект:**
        - Понимание социологии через игровые механики
        - Изучение фольклора и культурной антропологии
        - Развитие навыков социального взаимодействия
      mechanics_links:
        - system: immersive-world-building
        - system: replayability-mechanics
        - system: emotional-engagement-systems
      assets:
        - player-experience-showcase
        - user-feedback-analysis

    - id: metrics-and-analytics
      title: "Метрики и аналитика"
      body: |
        **Player engagement:**
        - Время, проведенное в диалогах с legend integration
        - Количество уникальных легенд, услышанных игроком
        - Глубина exploration социальной сети NPC

        **Legend propagation:**
        - Скорость распространения легенд через NPC сеть
        - Мутационные паттерны и evolution tracking
        - Популярность разных типов легенд

        **Social dynamics:**
        - Формирование групп вокруг общих верований
        - Конфликты между belief systems
        - Репутационные изменения через dialogue choices

        **Narrative impact:**
        - Влияние легенд на основные квестовые линии
        - Создание personalized story arcs
        - Long-term narrative consequences

        **Quality metrics:**
        - Player satisfaction с dialogue system
        - Naturalness of legend integration
        - Balance of social consequences
      mechanics_links:
        - system: engagement-tracking
        - system: social-analytics
        - system: narrative-impact-measurement
      assets:
        - analytics-dashboard-mockups
        - metric-tracking-diagrams

appendix:
  glossary:
    - term: Urban Legends
      definition: Городские легенды - фольклорные истории, передаваемые через социальные взаимодействия
    - term: Belief System
      definition: Система верований NPC, влияющая на их поведение и диалоги
    - term: Legend Propagation
      definition: Механика распространения легенд через сеть NPC взаимодействий
    - term: Social Consequences
      definition: Последствия социальных выборов игрока на отношения и возможности
    - term: Narrative Agency
      definition: Возможность игрока влиять на повествование через выборы и действия
  references:
    - title: 'Urban Legends Template System'
      link: knowledge/idea/urban-legends-template-system.yaml
    - title: 'Urban Legends Spreading System'
      link: knowledge/idea/urban-legends-spreading-system.yaml
    - title: 'Urban Legends Trigger System'
      link: knowledge/idea/urban-legends-trigger-system.yaml
    - title: 'Narrative Service API'
      link: proto/openapi/narrative-domain/main.yaml
  decisions: []
implementation:
  needs_task: true
  github_issue: 142072439
  queue_reference: []
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-12-28
    author: narrative-designer
    changes: Создан детальный дизайн интеграции баек городских легенд с NPC диалоговой системой, включая техническую архитектуру и игровые механики.
validation:
  checksum: ''
  schema_version: '1.0'
