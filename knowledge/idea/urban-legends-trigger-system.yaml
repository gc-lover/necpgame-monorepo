# Issue: #142072507
metadata:
  id: urban-legends-trigger-system
  title: "Система триггеров и контекстной активации баек"
  document_type: idea
  category: mechanics
  status: approved
  version: '1.0.0'
  last_updated: 2025-12-28T17:00:00.000000
  concept_approved: true
  concept_reviewed_at: '2025-12-28T17:00:00.000000'
  owners:
    - role: game_designer
      contact: gamedesign@necp.game
  tags:
    - urban-legends
    - triggers
    - contextual-activation
    - npc-behavior
    - dynamic-narrative
  topics:
    - npc-ai
    - contextual-storytelling
    - player-engagement
    - world-reactivity
    - narrative-timing
  related_systems:
    - narrative-service
    - npc-behavior-service
    - dialogue-system
    - world-state-service
  related_documents:
    - id: urban-legends-template-system
      relation: related
    - id: urban-legends-npc-spread-system
      relation: related
  source: internal-brainstorm
  visibility: internal
  audience:
    - game-design
    - narrative
    - ai-behavior
    - technical-design
  risk_level: medium

summary:
  problem: Городские легенды должны рассказываться в подходящие моменты, создавая органичное повествование, где контекст и обстоятельства определяют, какие истории NPC поделятся с игроками.
  goal: Создать умную систему триггеров, которая анализирует контекст и выбирает наиболее подходящие легенды для каждого момента взаимодействия.
  essence: "В мире NECPGAME истории оживают не тогда, когда мы их рассказываем, а тогда, когда мир готов их услышать. Каждая легенда — это ключ к пониманию момента."
  key_mechanics:
    - Contextual Analysis: Анализ текущей ситуации для выбора подходящих легенд
    - Emotional Resonance: Сопоставление эмоций NPC с тематикой легенд
    - Player State Awareness: Учет действий и состояния игрока
    - Dynamic Timing: Выбор оптимального момента для рассказа
    - Adaptive Relevance: Корректировка легенд под текущие события

core_mechanics:
  trigger_framework:
    description: "Базовая архитектура системы триггеров"
    components:
      - trigger_conditions:
          name: "Условия триггера"
          description: "Критерии, при которых легенда может быть активирована"
          types: "Локация, время, события, состояние NPC/игрока"
      - activation_priority:
          name: "Приоритет активации"
          description: "Определение, какая легенда рассказывается при конфликте"
          factors: "Релевантность, urgency, эмоциональная сила"
      - cooldown_system:
          name: "Система cooldown"
          description: "Предотвращение повторного рассказа одной легенды"
          mechanics: "Временные ограничения, контекстные исключения"
      - probability_weights:
          name: "Весовые вероятности"
          description: "Шансы активации различных легенд"
          calculation: "На основе релевантности и случайности"

  contextual_analysis:
    description: "Анализ контекста для выбора подходящих легенд"
    factors:
      - location_context:
          name: "Локационный контекст"
          description: "Связь легенды с текущим местоположением"
          examples: "Легенды о конкретных зданиях, районах, событиях"
      - temporal_context:
          name: "Временной контекст"
          description: "Связь с временем суток, сезоном, мировыми событиями"
          examples: "Ночные истории, сезонные легенды, актуальные события"
      - social_context:
          name: "Социальный контекст"
          description: "Отношения между NPC и игроком"
          factors: "Доверие, фракционная принадлежность, личная история"
      - emotional_context:
          name: "Эмоциональный контекст"
          description: "Эмоциональное состояние NPC"
          triggers: "Страх, гнев, радость, любопытство"

  player_state_awareness:
    description: "Учет состояния и действий игрока"
    awareness:
      - action_history:
          name: "История действий"
          description: "Недавние действия игрока влияют на выбор легенд"
          examples: "После боя — истории о насилии, после взлома — технические легенды"
      - player_progression:
          name: "Прогрессия игрока"
          description: "Уровень и навыки игрока определяют сложность легенд"
          adaptation: "От простых историй новичкам до глубоких — опытным"
      - inventory_state:
          name: "Состояние инвентаря"
          description: "Предметы у игрока могут триггерить связанные легенды"
          examples: "Антикварный предмет — история о его происхождении"
      - quest_status:
          name: "Статус квестов"
          description: "Текущие квесты игрока влияют на релевантные легенды"
          integration: "Легенды могут давать подсказки или предупреждения"

  npc_behavior_integration:
    description: "Интеграция с поведением NPC"
    aspects:
      - personality_traits:
          name: "Черты личности"
          description: "Личность NPC определяет стиль и выбор легенд"
          examples: "Параноик рассказывает страшные истории, оптимист — вдохновляющие"
      - relationship_dynamics:
          name: "Динамика отношений"
          description: "Отношения с игроком влияют на открытость NPC"
          progression: "От осторожных историй к личным откровениям"
      - daily_routines:
          name: "Ежедневные рутины"
          description: "Время суток и занятия NPC влияют на доступные легенды"
          examples: "Бармен вечером рассказывает пьяные байки"
      - faction_loyalty:
          name: "Фракционная лояльность"
          description: "Фракционная принадлежность фильтрует легенды"
          filtering: "Только дружественные или нейтральные истории"

  activation_mechanisms:
    description: "Механизмы активации легенд в диалогах"
    mechanisms:
      - conversational_triggers:
          name: "Диалоговые триггеры"
          description: "Ключевые слова и фразы активируют легенды"
          examples: "Упоминание Blackwall — история о цифровых призраках"
      - environmental_cues:
          name: "Окружные подсказки"
          description: "Элементы окружения запускают связанные легенды"
          examples: "Вид на заброшенное здание — история о его прошлом"
      - event_based:
          name: "Событийные триггеры"
          description: "Мировые события активируют релевантные легенды"
          examples: "Blackwall breach — истории о подобных инцидентах"
      - proactive_sharing:
          name: "Проактивное деление"
          description: "NPC сами предлагают легенды без запроса"
          conditions: "Высокое доверие, подходящий момент"

  dynamic_timing:
    description: "Выбор оптимального момента для рассказа"
    timing:
      - narrative_flow:
          name: "Нарративный поток"
          description: "Встраивание легенд в естественный ход разговора"
          integration: "Переходы от бытового к легендарному"
      - emotional_peaks:
          name: "Эмоциональные пики"
          description: "Рассказ в моменты высокой эмоциональной вовлеченности"
          timing: "После драматических событий или открытий"
      - attention_management:
          name: "Управление вниманием"
          description: "Выбор момента, когда игрок наиболее восприимчив"
          factors: "Уровень усталости, интерес к теме"
      - pacing_control:
          name: "Контроль темпа"
          description: "Распределение легенд для поддержания интереса"
          mechanics: "Cooldown между историями, постепенное раскрытие"

  adaptive_relevance:
    description: "Адаптация легенд под текущие обстоятельства"
    adaptation:
      - real_time_events:
          name: "События реального времени"
          description: "Легенды адаптируются под текущие мировые события"
          examples: "Недавний Blackwall инцидент — свежие интерпретации"
      - player_choices:
          name: "Выборы игрока"
          description: "Действия игрока влияют на интерпретацию легенд"
          consequences: "Разные концовки историй в зависимости от выборов"
      - world_state:
          name: "Состояние мира"
          description: "Глобальные изменения влияют на доступные легенды"
          examples: "Война фракций — истории о героях и предателях"
      - personal_experience:
          name: "Личный опыт"
          description: "Легенды NPC основаны на их личном опыте"
          evolution: "Истории меняются с опытом NPC"

  technical_implementation:
    description: "Технические аспекты реализации системы"
    components:
      - trigger_engine:
          name: "Движок триггеров"
          description: "Основной алгоритм анализа и активации"
          features: "Многоуровневая оценка, приоритизация"
      - context_analyzer:
          name: "Анализатор контекста"
          description: "Сбор и анализ contextual информации"
          inputs: "Положение игрока, состояние NPC, мировые события"
      - relevance_scorer:
          name: "Оценщик релевантности"
          description: "Расчет степени соответствия легенды ситуации"
          algorithm: "Взвешенные факторы, machine learning адаптация"
      - dialogue_integrator:
          name: "Интегратор диалогов"
          description: "Встраивание легенд в систему диалогов"
          features: "Seamless transitions, dynamic branching"

  player_feedback:
    description: "Обратная связь для игроков"
    feedback:
      - legend_indicators:
          name: "Индикаторы легенд"
          description: "Визуальные подсказки о доступных легендах"
          types: "Иконки над NPC, подсветка диалоговых опций"
      - context_tooltips:
          name: "Контекстные подсказки"
          description: "Объяснение, почему легенда активировалась"
          information: "Текущий контекст, факторы влияния"
      - legend_tracking:
          name: "Отслеживание легенд"
          description: "Журнал услышанных легенд и их последствий"
          features: "Карта распространения, связи с квестами"
      - engagement_metrics:
          name: "Метрики вовлеченности"
          description: "Статистика взаимодействия с системой легенд"
          data: "Количество легенд, успешность триггеров"

examples_scenarios:
  description: "Примеры сценариев работы системы"
  scenarios:
    - bar_encounter:
        context: "Игрок входит в бар после боя с Blackwall сущностью"
        trigger: "Бармен замечает состояние игрока, активирует легенду о 'Цифровых охотниках'"
        adaptation: "История адаптируется под недавний бой игрока"
        outcome: "Игрок получает подсказку о слабостях подобных существ"
    - street_conversation:
        context: "Игрок спрашивает прохожего о заброшенном здании"
        trigger: "Прохожий делится легендой о 'Призраке дата-центра'"
        adaptation: "Детали легенды соответствуют текущему состоянию здания"
        outcome: "Открывается побочный квест на исследование"
    - faction_meeting:
        context: "Игрок встречает члена фракции после выполнения задания"
        trigger: "NPC рассказывает легенду о 'Героях фракции' для укрепления лояльности"
        adaptation: "История включает элементы выполненного игроком задания"
        outcome: "Повышение репутации и новые возможности"

conclusion:
  design_philosophy: |
    Система триггеров — это мост между статичным лором и живым миром. Она превращает
    коллекцию историй в органичную часть игрового опыта, где каждая легенда находит
    свой идеальный момент для рассказа.

  player_experience: |
    Игроки будут ощущать мир как реагирующий на их действия, где NPC делятся
    релевантными историями в подходящие моменты. Это создаст ощущение глубокой
    связи с миром NECPGAME, где каждая легенда — это не просто история, а ключ
    к пониманию текущего момента.

appendix:
  glossary:
    - term: Trigger Framework
      definition: Архитектура условий активации легенд
    - term: Contextual Analysis
      definition: Анализ ситуации для выбора подходящих легенд
    - term: Dynamic Timing
      definition: Выбор оптимального момента для рассказа
    - term: Adaptive Relevance
      definition: Корректировка легенд под обстоятельства
  references: []
  decisions:
    - decision: Multi-factor trigger system
      rationale: Обеспечивает гибкость и точность активации
    - decision: Player state integration
      rationale: Создает персонализированный и релевантный опыт

implementation:
  github_issue: 142072507
  needs_task: false
  queue_reference: []
  blockers: []

history:
  - version: "1.0.0"
    date: 2025-12-28
    author: game_design_team
    changes: Создание детального описания системы триггеров и контекстной активации баек.