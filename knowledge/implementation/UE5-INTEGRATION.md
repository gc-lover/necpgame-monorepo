## UE5.6.1 — что используем и как интегрируем

Цель: минимальный по ресурсам, продакшн‑ориентированный сетевой стек для инстансов/рейдов, совместимый с внешним бэкендом.

### Используем сейчас
- Dedicated Server таргет (Windows, PC first).
- Репликация: ReplicationGraph (базовый каркас интерес‑менеджмента).
- OnlineSubsystem, OnlineSubsystemUtils (сессии/биконы, без EOS на старте).
- Базовые сетевые настройки: 60 TPS сервер, адаптивная частота обновления, таймауты соединений.

### План к подключению (по мере необходимости)
- Iris Replication (5.6): современная репликация, уменьшение трафика и HOL‑блокировок.
- Gameplay Ability System (GAS): способности/ресурсы/эффекты для боёвки.
- Mass Entity (ECS): симуляция толп/НПС в районах.
- Network Prediction: предикт/роллбек для движения/стрельбы.
- EOS (опционально): логин/сессии/античит (EAC) для быстрого старта.

### Что остаётся во внешнем бэкенде
- Экономика/инвентарь/заказы/фракции/крафт/социальные и романтические системы.
- Авторизация (Keycloak), матчмейкинг (наш Redis/Open Match), нотификации.
- Транспорт периметра: QUIC/UDP и WebSocket, аудит/метрики/логирование.

### Архитектура запуска
- Инстанс боя: UE Dedicated Server под оркестрацией (Agones/K8s или compose на дев‑стенде).
- Периметр: Envoy (HTTP/3), Keycloak, Redis, Postgres, Prometheus/Grafana, т.д.
- Связка: матчмейкер выдаёт endpoint инстанса; клиент подключается к UE серверу.

### Реализация в репозитории
- Проект UE: `client/UE5/necpg` (модуль `necpg`).
- Включены плагины: `ReplicationGraph`, `OnlineSubsystem`, `OnlineSubsystemUtils`.
- Таргеты: `necpg.Target.cs` (Game), `necpgServer.Target.cs` (Server).
- Сеть: `Config/DefaultEngine.ini` — IpNetDriver параметры, адаптивная репликация, 60 TPS.

### Следующие шаги
1) Каркас ReplicationGraph добавлен: `UMyReplicationGraph` + 2D Grid (AOI), биндинг в ini.
2) Minimal GameMode добавлен, карты используем стандартные (OpenWorld) до появления собственной сцены.
3) Iris включён (базово). Следующий шаг — метрики трафика на сцене 8–16 игроков.
4) Интеграция матчмейкинга: после аллокации инстанса сервер поднимает `necpgServer` и регистрируется в бэкенде. Если установленный UE не поддерживает Dedicated Server в дистрибутиве, используем Listen Server через `UnrealEditor.exe` для smoke, пока не соберём исходники UE.
5) При переходе к боёвке — подключить GAS и Network Prediction (минимальные профили).


