# Issue: #403
metadata:
  id: admin-moderation-core
  title: Архитектура системы администрирования и модерации - Основная структура
  document_type: architecture
  category: systems
  status: draft
  version: '1.1.0'
  last_updated: 2025-11-30T20:50:00Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - admin
    - moderation
    - backend
    - infrastructure
    - operations
  related_systems:
    - admin-api
    - character-service
    - economy-service-go
    - gameplay-service-go
    - social-service-go
    - analytics-service
  related_documents:
    - id: implementation-infrastructure-admin-moderation-tools
      relation: extends
    - id: admin-moderation-mechanics
      relation: extends
    - id: admin-moderation-data-flows
      relation: extends
    - id: admin-moderation-database
      relation: extends
    - id: admin-moderation-integrations
      relation: extends
    - id: admin-moderation-technical
      relation: extends
  github_issue: 403
  visibility: internal
  audience:
    - architect
    - backend
    - api-designer
    - operations

summary:
  problem: |
    Требуется спроектировать полную техническую архитектуру системы администрирования
    и модерации для управления игроками, экономикой, контентом и модерации через
    единую админ-панель с контролем доступа и аудитом действий.
  goal: |
    Создать архитектурную схему системы администрирования и модерации с определением:
    - Компонентов системы (микросервисы, модули)
    - API endpoints (высокоуровнево)
    - Потоков данных и интеграций
    - Системы ролей и доступов
    - Системы управления игроками
    - Системы управления экономикой
    - Системы управления контентом
    - Системы модерации
    - Системы аналитики
    - Системы аудита действий
    - Технического задания для реализации
  essence: |
    Инфраструктурная система администрирования и модерации для оперативного управления
    игроками, экономикой, контентом и модерации через единую админ-панель.

architecture:
  overview: |
    Система администрирования и модерации состоит из восьми основных компонентов:
    1. Admin Panel Service - основной сервис админ-панели
    2. Player Management Module - управление игроками
    3. Economy Management Module - управление экономикой
    4. Content Management Module - управление контентом
    5. Moderation Module - модерация
    6. Analytics Dashboard Module - аналитическая панель
    7. Role & Permission Manager - управление ролями и доступами
    8. Audit Log Manager - управление аудитом действий

  components:
    - name: Admin Panel Service
      location: admin-api (основной сервис)
      responsibility: |
        - Единая точка входа для админ-панели
        - Аутентификация и авторизация администраторов
        - Маршрутизация запросов к модулям
        - Управление сессиями администраторов
        - Интеграция с другими сервисами
      endpoints:
        - POST /api/v1/admin/auth/login - вход в админ-панель
        - POST /api/v1/admin/auth/logout - выход из админ-панели
        - GET /api/v1/admin/auth/me - информация о текущем администраторе
        - GET /api/v1/admin/dashboard - главная панель

    - name: Player Management Module
      location: admin-api (модуль player-management)
      responsibility: |
        - Управление профилями игроков
        - Просмотр истории входов
        - Просмотр истории транзакций
        - Редактирование параметров игроков
        - Выдача/отзыв санкций
        - Удаление учётных записей
        - Просмотр инвентаря игроков
        - Просмотр достижений игроков
      endpoints:
        - GET /api/v1/admin/players - список игроков
        - GET /api/v1/admin/players/{player_id} - профиль игрока
        - PUT /api/v1/admin/players/{player_id} - обновление профиля
        - DELETE /api/v1/admin/players/{player_id} - удаление игрока
        - GET /api/v1/admin/players/{player_id}/sessions - история сессий
        - GET /api/v1/admin/players/{player_id}/transactions - история транзакций
        - GET /api/v1/admin/players/{player_id}/inventory - инвентарь
        - GET /api/v1/admin/players/{player_id}/achievements - достижения
        - POST /api/v1/admin/players/{player_id}/sanctions - выдача санкции
        - DELETE /api/v1/admin/players/{player_id}/sanctions/{sanction_id} - отзыв санкции

    - name: Economy Management Module
      location: admin-api (модуль economy-management)
      responsibility: |
        - Управление балансом игроков
        - Управление инвентарём игроков
        - Отслеживание активности рынка
        - Мониторинг подозрительных операций
        - Формирование отчётов по RMT
        - Управление предметами
        - Управление валютами
      endpoints:
        - GET /api/v1/admin/economy/players/{player_id}/balance - баланс игрока
        - PUT /api/v1/admin/economy/players/{player_id}/balance - изменение баланса
        - GET /api/v1/admin/economy/market/activity - активность рынка
        - GET /api/v1/admin/economy/market/suspicious - подозрительные операции
        - GET /api/v1/admin/economy/reports/rmt - отчёты по RMT
        - GET /api/v1/admin/economy/items - список предметов
        - POST /api/v1/admin/economy/items - создание предмета
        - PUT /api/v1/admin/economy/items/{item_id} - обновление предмета
        - DELETE /api/v1/admin/economy/items/{item_id} - удаление предмета

    - name: Content Management Module
      location: admin-api (модуль content-management)
      responsibility: |
        - Управление достижениями
        - Управление ежедневными заданиями
        - Управление глобальными событиями
        - Горячие правки диалогов NPC
        - Управление квестами
        - Управление NPC
      endpoints:
        - GET /api/v1/admin/content/achievements - список достижений
        - POST /api/v1/admin/content/achievements - создание достижения
        - PUT /api/v1/admin/content/achievements/{achievement_id} - обновление достижения
        - DELETE /api/v1/admin/content/achievements/{achievement_id} - удаление достижения
        - GET /api/v1/admin/content/daily-quests - ежедневные задания
        - POST /api/v1/admin/content/daily-quests - создание ежедневного задания
        - PUT /api/v1/admin/content/daily-quests/{quest_id} - обновление задания
        - GET /api/v1/admin/content/events - глобальные события
        - POST /api/v1/admin/content/events - создание события
        - PUT /api/v1/admin/content/events/{event_id} - обновление события
        - GET /api/v1/admin/content/npcs/{npc_id}/dialogues - диалоги NPC
        - PUT /api/v1/admin/content/npcs/{npc_id}/dialogues/{dialogue_id} - обновление диалога

    - name: Moderation Module
      location: admin-api (модуль moderation)
      responsibility: |
        - Модерация чатов
        - Обработка репортов
        - Выдача временных санкций (до 7 дней)
        - Блокировка игроков
        - Разблокировка игроков
        - Управление банами
      endpoints:
        - GET /api/v1/admin/moderation/reports - список репортов
        - GET /api/v1/admin/moderation/reports/{report_id} - детали репорта
        - POST /api/v1/admin/moderation/reports/{report_id}/resolve - разрешение репорта
        - GET /api/v1/admin/moderation/chat/messages - сообщения чата
        - DELETE /api/v1/admin/moderation/chat/messages/{message_id} - удаление сообщения
        - POST /api/v1/admin/moderation/players/{player_id}/ban - бан игрока
        - DELETE /api/v1/admin/moderation/players/{player_id}/ban - разбан игрока
        - GET /api/v1/admin/moderation/bans - список банов

    - name: Analytics Dashboard Module
      location: admin-api (модуль analytics-dashboard)
      responsibility: |
        - Отображение онлайн игроков
        - Отображение активных матчей
        - Отображение операций торговли
        - Отображение нагрузки серверов
        - Отображение активности чатов
        - Выделение аномалий
        - Уведомления о проблемах
      endpoints:
        - GET /api/v1/admin/analytics/players/online - онлайн игроки
        - GET /api/v1/admin/analytics/matches/active - активные матчи
        - GET /api/v1/admin/analytics/trade/operations - операции торговли
        - GET /api/v1/admin/analytics/servers/load - нагрузка серверов
        - GET /api/v1/admin/analytics/chat/activity - активность чатов
        - GET /api/v1/admin/analytics/anomalies - аномалии
        - GET /api/v1/admin/analytics/notifications - уведомления

    - name: Role & Permission Manager
      location: admin-api (модуль role-permission)
      responsibility: |
        - Управление ролями (Super Admin, Admin, Moderator)
        - Управление правами доступа
        - Проверка прав доступа
        - Управление администраторами
      endpoints:
        - GET /api/v1/admin/roles - список ролей
        - GET /api/v1/admin/roles/{role_id}/permissions - права роли
        - GET /api/v1/admin/admins - список администраторов
        - POST /api/v1/admin/admins - создание администратора
        - PUT /api/v1/admin/admins/{admin_id} - обновление администратора
        - DELETE /api/v1/admin/admins/{admin_id} - удаление администратора

    - name: Audit Log Manager
      location: admin-api (модуль audit-log)
      responsibility: |
        - Логирование всех действий администраторов
        - Логирование всех действий модераторов
        - Хранение детальной информации о действиях
        - Поиск по логам
        - Экспорт логов
        - Анализ логов
      log_fields: |
        - Тип операции
        - Целевой пользователь
        - Детали операции
        - Причина операции
        - Время операции
        - IP адрес
        - User-Agent
      endpoints:
        - GET /api/v1/admin/audit/logs - список логов
        - GET /api/v1/admin/audit/logs/{log_id} - детали лога
        - GET /api/v1/admin/audit/logs/search - поиск по логам
        - GET /api/v1/admin/audit/logs/export - экспорт логов

