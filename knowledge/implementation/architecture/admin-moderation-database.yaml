# Issue: #403
metadata:
  id: admin-moderation-database
  title: Архитектура системы администрирования и модерации - База данных
  document_type: architecture
  category: systems
  status: draft
  version: '1.1.0'
  last_updated: 2025-11-30T20:50:00Z
  github_issue: 403
  related_documents:
    - id: admin-moderation-core
      relation: extends

database_schema:
  tables:
    - name: admin_users
      description: Администраторы и модераторы
      columns:
        - name: id
          type: UUID
          description: Уникальный идентификатор
        - name: username
          type: VARCHAR(100)
          description: Имя пользователя
        - name: email
          type: VARCHAR(255)
          description: Email
        - name: password_hash
          type: VARCHAR(255)
          description: Хеш пароля
        - name: role
          type: ENUM('SUPER_ADMIN', 'ADMIN', 'MODERATOR')
          description: Роль
        - name: is_active
          type: BOOLEAN
          description: Активен ли администратор
        - name: last_login_at
          type: TIMESTAMP
          description: Время последнего входа
        - name: created_at
          type: TIMESTAMP
          description: Время создания
        - name: updated_at
          type: TIMESTAMP
          description: Время обновления
      indexes:
        - columns: [ username ]
          unique: true
        - columns: [ email ]
          unique: true
        - columns: [ role ]

    - name: admin_actions_log
      description: Журнал действий администраторов
      columns:
        - name: id
          type: UUID
          description: Уникальный идентификатор
        - name: admin_id
          type: UUID
          description: ID администратора
          foreign_key: admin_users(id)
        - name: action_type
          type: VARCHAR(100)
          description: Тип действия
        - name: target_type
          type: VARCHAR(50)
          description: Тип цели (player, economy, content, moderation)
        - name: target_id
          type: UUID
          description: ID цели
        - name: details
          type: JSONB
          description: Детали действия
        - name: reason
          type: TEXT
          description: Причина действия
        - name: ip_address
          type: VARCHAR(45)
          description: IP адрес
        - name: user_agent
          type: TEXT
          description: User-Agent
        - name: created_at
          type: TIMESTAMP
          description: Время действия
      indexes:
        - columns: [ admin_id ]
        - columns: [ action_type ]
        - columns: [ target_type, target_id ]
        - columns: [ created_at ]

    - name: admin_sanctions
      description: Санкции, выданные администраторами
      columns:
        - name: id
          type: UUID
          description: Уникальный идентификатор
        - name: player_id
          type: UUID
          description: ID игрока
        - name: admin_id
          type: UUID
          description: ID администратора
          foreign_key: admin_users(id)
        - name: sanction_type
          type: ENUM('WARNING', 'TEMPORARY_BAN', 'PERMANENT_BAN', 'MUTE', 'KICK')
          description: Тип санкции
        - name: duration
          type: INTEGER
          description: Длительность в секундах (NULL для постоянных)
        - name: reason
          type: TEXT
          description: Причина санкции
        - name: is_active
          type: BOOLEAN
          description: Активна ли санкция
        - name: expires_at
          type: TIMESTAMP
          description: Время истечения (NULL для постоянных)
        - name: created_at
          type: TIMESTAMP
          description: Время создания
      indexes:
        - columns: [ player_id ]
        - columns: [ admin_id ]
        - columns: [ is_active ]
        - columns: [ expires_at ]

