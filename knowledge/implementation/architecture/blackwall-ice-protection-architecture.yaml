metadata:
  id: blackwall-ice-protection-architecture
  title: Архитектура Blackwall ICE Protection System
  document_type: architecture
  category: systems
  status: draft
  version: "1.0.0"
  last_updated: 2025-11-29T00:00:00Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - blackwall
    - ice
    - protection
    - adaptive
  related_documents:
    - id: blackwall-systems-architecture
      relation: extends
    - id: cyber-network-systems-architecture
      relation: references
  github_issues:
    - 1472
  visibility: internal
  audience:
    - architect
    - backend
    - gameplay

summary:
  problem: |
    Тип ICE "blackwall" присутствует в API, но не имеет детализированной механики в gameplay.
    Требуется реализация Blackwall ICE как уникальной адаптивной защиты, связанной с rogue AI
    и создающей психологическое давление.
  goal: |
    Спроектировать систему Blackwall ICE:
    - Адаптация к методам взлома в реальном времени
    - Связь с rogue AI за барьером
    - Психологическое воздействие через эффект зловещей долины
    - Интеграция с существующей системой ICE
    - Различные типы Blackwall ICE с уникальным поведением
  essence: |
    Blackwall ICE — это живая адаптивная защита, которая учится на атаках, использует тактики
    rogue AI и создаёт ощущение разумного противника в цифровом пространстве.

architecture:
  components:
    - name: blackwall-ice-manager
      location: blackwall-service (blackwall-ice-manager)
      responsibility: |
        Управление Blackwall ICE в зонах:
        - Распределение ICE по зонам барьера
        - Активация и деактивация ICE
        - Координация между ICE
        - Интеграция с rogue AI
      estimated_lines: 350
      dependencies:
        - hacking-service (ICE система)
        - world-service

    - name: ice-adaptation-engine
      location: blackwall-service (blackwall-ice-manager)
      responsibility: |
        Система адаптации ICE:
        - Обучение на методах взлома
        - Предиктивное поведение
        - Эскалация защиты
        - Передача знаний между ICE
      estimated_lines: 400
      dependencies:
        - blackwall-ice-manager
        - hacking-service

    - name: ice-deception-system
      location: blackwall-service (blackwall-ice-manager)
      responsibility: |
        Система обмана и психологического воздействия:
        - Генерация иллюзий
        - Эмоциональное манипулирование
        - Визуальные искажения
        - Интеграция с атмосферным движком
      estimated_lines: 300
      dependencies:
        - blackwall-atmosphere-engine
        - character-service

    - name: rogue-ai-coordinator
      location: blackwall-service (blackwall-ice-manager)
      responsibility: |
        Координация с rogue AI:
        - Получение "советов" от AI
        - Использование тактик AI
        - Эскалация при угрозе
        - Создание ощущения разума
      estimated_lines: 300
      dependencies:
        - world-service
        - blackwall-atmosphere-engine

  ice_types:
    guardian:
      base_stats:
        attack_speed: slow
        defense: high
        adaptation_rate: medium
        aggression: low
      behavior:
        - Reactive defense
        - Gradual escalation
        - Pattern learning
      visual: sharp_aggressive_forms
      estimated_lines: 250

    hunter:
      base_stats:
        attack_speed: medium
        defense: medium
        adaptation_rate: high
        aggression: high
      behavior:
        - Active pursuit
        - Long-term hunting
        - Tactical adaptation
      visual: predator_like_but_wrong
      estimated_lines: 300

    deception:
      base_stats:
        attack_speed: variable
        defense: very_high
        adaptation_rate: low
        aggression: low
      behavior:
        - Masquerade as normal ICE
        - Surprise attack
        - False safety signals
      visual: normal_ice_turns_horrible
      estimated_lines: 300

    corruption:
      base_stats:
        attack_speed: very_slow
        defense: medium
        adaptation_rate: medium
        aggression: low
      behavior:
        - Slow infiltration
        - Gradual corruption
        - Long-term effects
      visual: spreading_infection
      estimated_lines: 250

    collective:
      base_stats:
        attack_speed: fast
        defense: very_high
        adaptation_rate: very_high
        aggression: very_high
      behavior:
        - Swarm intelligence
        - Coordinated attacks
        - Function division
      visual: swarm_structure_organic
      estimated_lines: 350

  adaptation_mechanics:
    learning_system:
      memory_window: "Last 10 attack attempts"
      pattern_recognition: true
      countermeasure_development: true
      knowledge_sharing: true
    
    adaptation_stages:
      initial:
        defense_multiplier: 1.0
        attack_patterns: basic
        adaptation_level: 0
      
      learning:
        defense_multiplier: 1.1-1.3
        attack_patterns: adaptive
        adaptation_level: 1-3
      
      expert:
        defense_multiplier: 1.3-1.6
        attack_patterns: advanced
        adaptation_level: 4-6
      
      master:
        defense_multiplier: 1.6-2.0
        attack_patterns: expert
        adaptation_level: 7+

    predictive_behavior:
      pattern_analysis: true
      next_action_prediction: true
      trap_setting: true
      creates_feeling_of_intelligence: true

  api_endpoints:
    - path: GET /api/v1/blackwall/ice/zones/{zoneId}
      description: Получение информации о Blackwall ICE в зоне
      response:
        ice_instances: [ object ]
        adaptation_levels: object
        threat_assessment: object
        warnings: [ string ]

    - path: POST /api/v1/blackwall/ice/{iceId}/interact
      description: Взаимодействие с Blackwall ICE (обнаружение, анализ, обход)
      request:
        action: enum [detect, analyze, bypass, attack]
        character_id: UUID
        skill_check: object
      response:
        interaction_result: object
        ice_response: object
        adaptation_triggered: boolean
        consequences: object

    - path: POST /api/v1/blackwall/ice/{iceId}/adapt
      description: ICE адаптируется к атаке (автоматически, но может быть запрошено)
      response:
        new_stats: object
        new_behavior: object
        threat_level_increase: integer

    - path: GET /api/v1/blackwall/ice/{iceId}/analysis
      description: Анализ типа и характеристик Blackwall ICE
      request:
        character_id: UUID
        analysis_demon: UUID (optional)
      response:
        ice_type: enum
        level: enum [alpha, beta, gamma]
        stats: object
        weaknesses: [ string ]
        recommended_tactics: [ string ]

  database_schema:
    tables:
      - name: blackwall_ice_instances
        columns:
          - name: id
            type: UUID
            primary_key: true
          - name: zone_id
            type: UUID
            foreign_key: blackwall_zones.id
          - name: ice_type
            type: VARCHAR(20)
            values: [ guardian, hunter, deception, corruption, collective ]
          - name: level
            type: VARCHAR(10)
            values: [ alpha, beta, gamma ]
          - name: adaptation_level
            type: INTEGER
            range: 0-10
          - name: defense_multiplier
            type: FLOAT
            default: 1.0
          - name: stats
            type: JSONB
          - name: created_at
            type: TIMESTAMP
          - name: last_adaptation
            type: TIMESTAMP

      - name: blackwall_ice_adaptations
        columns:
          - name: id
            type: UUID
            primary_key: true
          - name: ice_id
            type: UUID
            foreign_key: blackwall_ice_instances.id
          - name: attack_method
            type: VARCHAR(100)
          - name: adaptation_applied
            type: JSONB
          - name: effectiveness
            type: INTEGER
            range: 0-100
          - name: learned_at
            type: TIMESTAMP

      - name: blackwall_ice_interactions
        columns:
          - name: id
            type: UUID
            primary_key: true
          - name: ice_id
            type: UUID
            foreign_key: blackwall_ice_instances.id
          - name: character_id
            type: UUID
            foreign_key: characters.id
          - name: interaction_type
            type: VARCHAR(50)
          - name: success
            type: BOOLEAN
          - name: ice_adapted
            type: BOOLEAN
          - name: consequences
            type: JSONB
          - name: interacted_at
            type: TIMESTAMP

  psychological_effects:
    visual_effects:
      - almost_organic_appearance
      - smooth_but_too_perfect_movements
      - familiar_but_wrong_forms
      - uncanny_valley_peak
    
    audio_effects:
      - almost_human_voice_with_digital_note
      - friendly_sounds_that_frighten
      - growing_hum_on_approach
      - whispers_in_native_language
    
    behavioral_patterns:
      - plays_with_victim
      - shows_enjoyment_of_hunt
      - adapts_to_fears
      - creates_feeling_of_intelligence

  integration_with_existing_ice:
    extends:
      - basic_ice
      - advanced_ice
      - military_ice
      - corporate_ice
    
    differences:
      - adaptation: "Blackwall ICE adapts, others are static"
      - intelligence: "Blackwall ICE shows signs of intelligence"
      - lethality: "Blackwall ICE is lethal, others are protective"
      - source: "Blackwall ICE connected to rogue AI"

  class_interaction:
    netrunner:
      special_demons: "Access to Blackwall-specific defense demons"
      adaptation_reset: "Can reset ICE adaptation (one-time)"
      analysis_bonus: "+20% to analysis success"
    
    techie:
      equipment_modifications: "Can modify equipment to counter adaptation"
      technical_solutions: "Alternative bypass methods"
    
    other_classes:
      vulnerability: "Very high vulnerability"
      limited_tools: "Basic gadgets only"
      requires_help: "Team coordination essential"

