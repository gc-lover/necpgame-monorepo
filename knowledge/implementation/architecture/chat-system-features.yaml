# Issue: #172
metadata:
  id: chat-system-features
  title: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —á–∞—Ç–∞
  document_type: architecture
  category: features
  status: draft
  version: '1.0.0'
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - chat
    - features
    - channels
    - moderation
summary:
  goal: –û–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–∞–Ω–∞–ª–æ–≤, –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
content:
  sections:
    - id: channel-system
      title: –°–∏—Å—Ç–µ–º–∞ –∫–∞–Ω–∞–ª–æ–≤
      body: |
        ## –¢–∏–ø—ã –∫–∞–Ω–∞–ª–æ–≤

        ### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
        - **GLOBAL**: –û–±—â–∏–π —á–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ (max 500 —Å–∏–º–≤–æ–ª–æ–≤, cooldown 5 —Å–µ–∫)
        - **TRADE**: –¢–æ—Ä–≥–æ–≤—ã–π —á–∞—Ç (max 300 —Å–∏–º–≤–æ–ª–æ–≤, cooldown 10 —Å–µ–∫)
        - **NEWBIE**: –ß–∞—Ç –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ (max 200 —Å–∏–º–≤–æ–ª–æ–≤, cooldown 3 —Å–µ–∫)

        ### –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
        - **LOCAL**: –ß–∞—Ç –∑–æ–Ω—ã (—Ä–∞–¥–∏—É—Å 100–º, max 200 —Å–∏–º–≤–æ–ª–æ–≤)
        - **INSTANCE**: –ß–∞—Ç –∏–Ω—Å—Ç–∞–Ω—Å–∞ (—Ç–µ–∫—É—â–∏–π –¥–∞–Ω–∂–æ–Ω/—Ä–µ–π–¥)
        - **AREA**: –ß–∞—Ç —Ä–∞–π–æ–Ω–∞ –≥–æ—Ä–æ–¥–∞

        ### –ì—Ä—É–ø–ø–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã
        - **PARTY**: –ì—Ä—É–ø–ø–∞ (2-5 –∏–≥—Ä–æ–∫–æ–≤)
        - **RAID**: –†–µ–π–¥ (6-40 –∏–≥—Ä–æ–∫–æ–≤)
        - **GUILD**: –ì–∏–ª—å–¥–∏—è (–¥–æ 100 –∏–≥—Ä–æ–∫–æ–≤)

        ### –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
        - **WHISPER**: –õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        - **SYSTEM**: –°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

        ### –ë–æ–µ–≤—ã–µ –∫–∞–Ω–∞–ª—ã
        - **COMBAT_LOG**: –õ–æ–≥ –±–æ—è
        - **RP_EMOTE**: –†–æ–ª–µ–≤—ã–µ —ç–º–æ—Ü–∏–∏

        ## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏
        ```json
        {
          "read": true,
          "write": true,
          "moderate": false,
          "invite": true,
          "kick": false
        }
        ```
      mechanics_links: []
      assets: []

    - id: moderation-system
      title: –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
      body: |
        ## –§–∏–ª—å—Ç—Ä—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞

        ### Profanity Filter
        - –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
        - Whitelist —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö URL
        - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞
        - –ó–∞–º–µ–Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–∏–º–≤–æ–ª–æ–≤

        ### Spam Detection
        - Rate limiting: max 10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É
        - Duplicate detection
        - Pattern recognition

        ## –°–∏—Å—Ç–µ–º–∞ –±–∞–Ω–æ–≤
        - **TEXT_MUTE**: –ó–∞–ø—Ä–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —á–∞—Ç
        - **CHANNEL_BAN**: –ë–∞–Ω –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∫–∞–Ω–∞–ª–µ
        - **GLOBAL_BAN**: –ü–æ–ª–Ω—ã–π –±–∞–Ω —á–∞—Ç–∞

        ## –ê–≤—Ç–æ-–±–∞–Ω—ã
        - 3 –Ω–∞—Ä—É—à–µ–Ω–∏—è ‚Üí 1 —á–∞—Å mute
        - 5 –Ω–∞—Ä—É—à–µ–Ω–∏–π ‚Üí 24 —á–∞—Å–∞ ban
        - 10 –Ω–∞—Ä—É—à–µ–Ω–∏–π ‚Üí permanent ban
      mechanics_links: []
      assets: []

    - id: formatting-system
      title: –°–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      body: |
        ## Rich Formatting
        ```
        **bold text** ‚Üí <strong>bold text</strong>
        *italic text* ‚Üí <em>italic text</em>
        `code` ‚Üí <code>code</code>
        :smile: ‚Üí üòÄ
        @username ‚Üí <span class="mention">@username</span>
        ```

        ## Slash-–∫–æ–º–∞–Ω–¥—ã
        ```
        /w username message    - –õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        /r message            - –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        /party message        - –°–æ–æ–±—â–µ–Ω–∏–µ –≥—Ä—É–ø–ø–µ
        /help                 - –°–ø—Ä–∞–≤–∫–∞
        /ignore username      - –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        /report username      - –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è
        ```
      mechanics_links: []
      assets: []

    - id: history-system
      title: –°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
      body: |
        ## –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        - **Redis**: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –∫–∞–Ω–∞–ª (TTL 24 —á–∞—Å–∞)
        - **PostgreSQL**: –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π)

        ## –ü–∞–≥–∏–Ω–∞—Ü–∏—è
        ```
        GET /api/v1/chat/history/{channelId}?before=msg_123&limit=50
        ```

        ## –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        - –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–π
        - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
      mechanics_links: []
      assets: []

    - id: data-flows
      title: –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
      body: |
        ## –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        1. –ö–ª–∏–µ–Ω—Ç ‚Üí chat-core-service
        2. –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ chat-moderation-service
        3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ chat-channel-service
        5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ chat-history-service
        6. –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WebSocket

        ## –ú–æ–¥–µ—Ä–∞—Ü–∏—è
        1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
        2. –ê–Ω–∞–ª–∏–∑ —Å–ø–∞–º–∞ —á–µ—Ä–µ–∑ Redis
        3. –ê–≤—Ç–æ-–±–∞–Ω –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö
        4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
      mechanics_links: []
      assets: []
implementation:
  github_issue: 172