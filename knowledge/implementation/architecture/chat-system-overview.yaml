# Issue: #172
metadata:
  id: chat-system-overview
  title: Chat System — Обзор и компоненты
  document_type: architecture
  category: systems
  status: draft
  version: "1.0.0"
  last_updated: 2025-12-14T15:00:00Z
  owners:
    - role: architect
      contact: architect@necp.game

summary:
  problem: |
    Требуется спроектировать полную архитектуру Chat System для текстовой коммуникации игроков,
    включая каналы, модерацию, форматирование и интеграцию с существующими социальными системами.
  goal: |
    Создать архитектурную схему Chat System с определением:
    - Компонентов и микросервисов
    - API контрактов (REST, WebSocket, Events)
    - Потоков данных и интеграций
    - Схемы базы данных
    - Систем каналов, модерации и форматирования
    - Технического задания для реализации
  essence: |
    Полная архитектура Chat System для управления коммуникациями в MMOFPS RPG,
    интегрирующая текстовый чат, голосовую связь и модерацию.

architecture:
  overview: |
    Chat System - это комплексная система коммуникации игроков, обеспечивающая
    текстовый чат, голосовую связь, модерацию контента и социальные взаимодействия.
    Система построена на принципах микросервисной архитектуры с real-time коммуникацией.

  system_components:
    - name: Chat Core Service
      type: microservice
      description: Основной сервис управления чатом
      responsibilities:
        - Обработка сообщений и каналов
        - Маршрутизация сообщений
        - Управление участниками каналов
        - Синхронизация состояния чата
      technologies:
        - Go (backend)
        - PostgreSQL (primary storage)
        - Redis (caching)
        - Kafka (events)

    - name: Chat Moderation Service
      type: microservice
      description: Сервис модерации контента
      responsibilities:
        - Фильтрация запрещенных выражений
        - Обнаружение спама
        - Управление банами
        - Обработка жалоб
      technologies:
        - Go (backend)
        - PostgreSQL (storage)
        - Redis (caching)

    - name: Chat Formatting Engine
      type: microservice
      description: Движок форматирования сообщений
      responsibilities:
        - Rich text formatting
        - Emoji и ссылок обработка
        - Slash-команды обработка
        - XSS защита
      technologies:
        - Go (backend)
        - Redis (caching)

    - name: Chat Voice Gateway
      type: microservice
      description: Шлюз голосовой связи
      responsibilities:
        - WebRTC сигнализация
        - Управление голосовыми каналами
        - Участников управление
        - Качество звука оптимизация
      technologies:
        - Go (backend)
        - WebRTC (protocol)
        - Redis Pub/Sub (messaging)

    - name: Chat Translation Service
      type: microservice
      description: Сервис переводов сообщений
      responsibilities:
        - Автоматическое определение языка
        - Перевод сообщений
        - Кеширование переводов
        - Управление языковыми настройками
      technologies:
        - Go (backend)
        - External translation APIs
        - Redis (caching)

    - name: Chat Analytics Service
      type: microservice
      description: Аналитика и статистика чата
      responsibilities:
        - Метрики использования каналов
        - Модерации отчеты
        - Пользовательской активности анализ
        - Производительности мониторинг
      technologies:
        - Go (backend)
        - PostgreSQL (storage)
        - Elasticsearch (analytics)
        - Grafana (visualization)

  microservices_architecture:
    chat_core_service:
      port: 8090
      database: social_db
      dependencies:
        - character-service (user validation)
        - moderation-service (content filtering)
        - formatting-service (message processing)

    chat_moderation_service:
      port: 8091
      dependencies:
        - chat-core-service (message interception)
        - security-service (ban enforcement)

    chat_formatting_engine:
      port: 8092
      dependencies:
        - chat-core-service (message preprocessing)

    chat_voice_gateway:
      port: 8093
      dependencies:
        - chat-core-service (channel management)
        - party-service (group channels)

    chat_translation_service:
      port: 8094
      dependencies:
        - chat-core-service (message routing)

    chat_analytics:
      port: 8095
      dependencies:
        - monitoring-service (metrics collection)

  integration_points:
    with_social_service:
      - Shared user profiles and relationships
      - Friend lists for private channels
      - Social reputation for moderation

    with_party_service:
      - Party channels creation
      - Group communication management
      - Raid coordination

    with_guild_service:
      - Guild channels and officer chats
      - Guild announcements
      - Leadership communication

    with_moderation_service:
      - Content filtering integration
      - Automated moderation rules
      - Admin tools access

    with_translation_service:
      - Real-time message translation
      - Language detection
      - Cultural adaptation
