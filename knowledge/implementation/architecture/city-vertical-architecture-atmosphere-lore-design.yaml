metadata:
  id: city-vertical-architecture-atmosphere-lore-design
  title: Вертикальная архитектура городов - Атмосфера, лор и визуальный дизайн
  document_type: architecture
  category: world
  status: draft
  version: "1.0.0"
  last_updated: 2025-12-27T20:26:30Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - world
    - city
    - vertical
    - atmosphere
    - lore
    - visual-design
    - narrative
    - immersion
  related_systems:
    - world-service
    - content-service
    - atmosphere-service
    - visual-service
  related_documents:
    - id: city-vertical-atmosphere-lore-visual
      relation: implements
  github_issue: 142071715
  visibility: internal
  audience:
    - architect
    - content-writer
    - ui-ux-designer
    - world-designer
    - narrative-designer

summary:
  problem: |
    Требуется спроектировать атмосферу, лор и визуальный дизайн вертикальных мегаполисов,
    включающие:
    - Атмосферу разных уровней города (от субтеррейна до верхних этажей)
    - Лор и историю вертикальной урбанизации
    - Визуальный дизайн архитектуры и окружения
    - Нарративные элементы и иммерсивные механики
    - Социально-психологические аспекты жизни в вертикальном городе
    - Тематические события и атмосферные эффекты
  goal: |
    Создать целостную атмосферу вертикального города с определением:
    - Атмосферных зон и их характеристик
    - Лора вертикальной урбанизации
    - Визуального языка и стиля
    - Нарративных механик
    - Иммерсивных элементов
    - Атмосферных эффектов и событий
  essence: |
    Полная иммерсивная атмосфера вертикальных мегаполисов с глубоким лором,
    визуальным стилем и нарративными механиками.

architecture:
  overview: |
    Архитектура атмосферы вертикального города состоит из следующих компонентов:
    1. Atmospheric Zone Manager - управление атмосферными зонами
    2. Narrative Engine - движок повествования
    3. Visual Style Coordinator - координатор визуального стиля
    4. Immersion Effect System - система эффектов иммерсии
    5. Lore Database - база данных лора
    6. Thematic Event Generator - генератор тематических событий
    7. Environmental Storytelling - экологическое повествование

  microservices:
    - name: atmosphere-service
      port: 8086
      responsibility: |
        Обработка атмосферы вертикального города:
        - Управление атмосферными зонами
        - Генерация повествования
        - Координация визуального стиля
        - Эффекты иммерсии
        - Управление лором
        - Тематические события
        - Экологическое повествование
      components:
        - atmospheric-zone-manager: управление зонами
        - narrative-engine: движок повествования
        - visual-style-coordinator: визуальный стиль
        - immersion-effect-system: эффекты иммерсии
        - lore-database: база лора
        - thematic-event-generator: тематические события
        - environmental-storytelling: экологическое повествование
      endpoints:
        - GET /api/v1/atmosphere/zones/{level} - атмосфера уровня
        - GET /api/v1/atmosphere/narrative/{characterId} - персональный нарратив
        - GET /api/v1/atmosphere/visual-style/{zone} - визуальный стиль зоны
        - POST /api/v1/atmosphere/immersion/trigger - триггер эффекта иммерсии
        - GET /api/v1/atmosphere/lore/{topic} - информация лора
        - GET /api/v1/atmosphere/events/active - активные события
        - POST /api/v1/atmosphere/storytelling/progress - прогресс повествования
      websocket_channels:
        - wss://api.necp.game/v1/atmosphere/zones/{level}/live - атмосфера уровня в реальном времени
        - wss://api.necp.game/v1/atmosphere/events/live - поток событий
      events_published:
        - atmosphere.zone-transition: переход между зонами
        - atmosphere.narrative-progress: прогресс повествования
        - atmosphere.immersion-trigger: триггер иммерсии
        - atmosphere.lore-discovery: открытие лора
        - atmosphere.thematic-event: тематическое событие
        - atmosphere.environmental-change: изменение окружающей среды

  atmospheric_zones:
    subterrain_levels:
      - name: undercity_depths
        level_range: "-50 to -21"
        atmosphere_theme: "forgotten_civilization"
        lighting: "emergency_red"
        sounds: "dripping_water, distant_machinery"
        hazards: "radiation, toxic_leaks"
        social_mood: "despair, survival"
        lore_elements: "Pre-Collapse society remnants"

      - name: maintenance_tunnels
        level_range: "-20 to -6"
        atmosphere_theme: "industrial_underbelly"
        lighting: "harsh_fluorescent"
        sounds: "humming_ventilation, tool_clanging"
        hazards: "live_wires, steam_bursts"
        social_mood: "resignation, routine"
        lore_elements: "Maintenance crew stories"

      - name: service_basements
        level_range: "-5 to -1"
        atmosphere_theme: "utilitarian_gloom"
        lighting: "functional_led"
        sounds: "elevator_hum, door_slam"
        hazards: "unstable_floors, falling_debris"
        social_mood: "indifference, fatigue"
        lore_elements: "Service worker lives"

    ground_levels:
      - name: street_level_chaos
        level_range: "1 to 5"
        atmosphere_theme: "urban_maelstrom"
        lighting: "neon_nightmare"
        sounds: "traffic_roar, vendor_calls"
        hazards: "crowd_crushing, vehicle_accidents"
        social_mood: "overwhelm, excitement"
        lore_elements: "Street culture origins"

      - name: commercial_bazaars
        level_range: "6 to 15"
        atmosphere_theme: "merchant_hustle"
        lighting: "commercial_bright"
        sounds: "bargaining, music_blaring"
        hazards: "pickpocketing, scams"
        social_mood: "greed, opportunity"
        lore_elements: "Merchant guild histories"

    mid_levels:
      - name: corporate_corridors
        level_range: "16 to 50"
        atmosphere_theme: "corporate_oppression"
        lighting: "sterile_white"
        sounds: "keyboard_clatter, phone_rings"
        hazards: "surveillance, bureaucracy"
        social_mood: "anxiety, ambition"
        lore_elements: "Corporate rise stories"

      - name: residential_blocks
        level_range: "51 to 100"
        atmosphere_theme: "claustrophobic_living"
        lighting: "dim_apartment"
        sounds: "neighbor_quarrels, tv_noise"
        hazards: "thin_walls, shared_utilities"
        social_mood: "isolation, community"
        lore_elements: "Family sagas"

    upper_levels:
      - name: executive_penthouses
        level_range: "101 to 150"
        atmosphere_theme: "elite_detachment"
        lighting: "luxury_ambient"
        sounds: "classical_music, champagne_pop"
        hazards: "conspiracy, betrayal"
        social_mood: "superiority, paranoia"
        lore_elements: "Elite family dynasties"

      - name: observation_decks
        level_range: "151 to 200"
        atmosphere_theme: "awe_inspiring_heights"
        lighting: "panoramic_cityscape"
        sounds: "wind_howl, distant_thunder"
        hazards: "vertigo, exposure"
        social_mood: "perspective, insignificance"
        lore_elements: "City founding myths"

    zenith_levels:
      - name: corporate_spires
        level_range: "201 to 300"
        atmosphere_theme: "divine_aspiration"
        lighting: "ethereal_glow"
        sounds: "wind_chimes, power_hum"
        hazards: "electromagnetic_fields, pressure_changes"
        social_mood: "transcendence, madness"
        lore_elements: "Corporate deity worship"

      - name: atmospheric_interface
        level_range: "301+"
        atmosphere_theme: "cosmic_indifference"
        lighting: "starlit_darkness"
        sounds: "atmospheric_crackle, ozone"
        hazards: "radiation, decompression"
        social_mood: "enlightenment, terror"
        lore_elements: "Forbidden knowledge"

  visual_design_system:
    architectural_styles:
      - name: neo_brutalist
        levels: "Ground to Mid"
        characteristics: "Raw concrete, exposed infrastructure"
        symbolism: "Corporate oppression, human cost"
        lighting_palette: "Harsh shadows, industrial glare"

      - name: corporate_glass
        levels: "Mid to Upper"
        characteristics: "Reflective surfaces, clean lines"
        symbolism: "Corporate transparency, surveillance"
        lighting_palette: "Cold blue, sterile white"

      - name: organic_fusion
        levels: "Upper to Zenith"
        characteristics: "Living architecture, bio-luminescence"
        symbolism: "Corporate evolution, transcendence"
        lighting_palette: "Organic glows, pulsing lights"

    environmental_effects:
      - name: pollution_haze
        levels: "All industrial zones"
        visual_effect: "Particulate scattering light"
        atmospheric_impact: "Reduced visibility"
        health_effect: "Respiratory damage"

      - name: electromagnetic_interference
        levels: "High-tech zones"
        visual_effect: "Digital artifacts, screen flicker"
        atmospheric_impact: "Reality distortion"
        health_effect: "Neural interference"

      - name: bio_luminescence
        levels: "Living architecture zones"
        visual_effect: "Pulsing organic lights"
        atmospheric_impact: "Healing aura"
        health_effect: "Mood enhancement"

  narrative_framework:
    vertical_lore_arcs:
      - name: ascent_myth
        theme: "Social mobility through corporate ladder"
        levels: "Ground to Executive"
        narrative_elements: "Rags to riches stories"
        conflict_drivers: "Class warfare, corporate intrigue"

      - name: descent_narrative
        theme: "Fall from grace and undercity survival"
        levels: "Executive to Subterrain"
        narrative_elements: "Tragic downfalls"
        conflict_drivers: "Betrayal, system failure"

      - name: cyclical_fate
        theme: "Inevitability of vertical society"
        levels: "All levels"
        narrative_elements: "Generational cycles"
        conflict_drivers: "Inherited destiny"

    character_archetypes:
      - name: street_rat_ascendant
        social_class: "Ground level native"
        motivation: "Rise through merit"
        conflicts: "Corporate gatekeeping"
        arc: "From hustler to executive"

      - name: fallen_executive
        social_class: "Former elite"
        motivation: "Redemption or revenge"
        conflicts: "Loss of status"
        arc: "From penthouse to gutter"

      - name: maintenance_revolutionary
        social_class: "Subterrain worker"
        motivation: "Systemic change"
        conflicts: "Corporate security"
        arc: "From repairman to revolutionary"

  immersion_mechanics:
    environmental_storytelling:
      - name: ambient_dialogue
        trigger: "Zone transition"
        content: "Overheard conversations reflecting zone atmosphere"
        delivery: "Spatial audio, visual subtitles"
        persistence: "Zone-specific"

      - name: environmental_clues
        trigger: "Exploration"
        content: "Lore objects, graffiti, data terminals"
        delivery: "Interactive discovery"
        persistence: "Permanent after discovery"

      - name: atmospheric_events
        trigger: "Time-based or random"
        content: "Zone-specific occurrences (power outages, protests)"
        delivery: "Real-time environmental changes"
        persistence: "Temporary impact"

    psychological_effects:
      - name: vertical_agoraphobia
        trigger: "High altitude zones"
        effect: "Dizziness, fear of falling"
        mitigation: "Implant upgrades, training"
        narrative_tie_in: "Social commentary on inequality"

      - name: subterrain_claustrophobia
        trigger: "Deep underground zones"
        effect: "Paranoia, spatial disorientation"
        mitigation: "Familiarity, light sources"
        narrative_tie_in: "Metaphors for social oppression"

      - name: corporate_derealization
        trigger: "Executive zones"
        effect: "Detachment from reality, identity crisis"
        mitigation: "Personal connections, rebellion"
        narrative_tie_in: "Critique of corporate culture"

  thematic_event_system:
    recurring_events:
      - name: elevator_sabotage
        frequency: "Weekly"
        zones: "All vertical transport"
        atmosphere: "Sudden isolation, social mixing"
        narrative_impact: "Cross-class interactions"

      - name: power_fluctuation
        frequency: "Daily"
        zones: "Random level"
        atmosphere: "Emergency lighting, backup systems"
        narrative_impact: "Vulnerability exposure"

      - name: protest_eruption
        frequency: "Monthly"
        zones: "Ground to Mid levels"
        atmosphere: "Crowd unrest, security response"
        narrative_impact: "Social tension release"

    seasonal_events:
      - name: vertical_migration
        season: "Economic cycles"
        zones: "All levels affected"
        atmosphere: "Population shifts, resource strain"
        narrative_impact: "Economic inequality stories"

      - name: atmospheric_anomaly
        season: "Weather patterns"
        zones: "Upper levels"
        atmosphere: "Extreme weather, structural stress"
        narrative_impact: "Human fragility themes"

  data_flows:
    atmosphere_generation_flow: |
      1. Atmospheric Zone Manager определяет текущую зону игрока
      2. Visual Style Coordinator загружает визуальные ассеты зоны
      3. Immersion Effect System активирует атмосферные эффекты
      4. Narrative Engine генерирует контекстные нарративы
      5. Thematic Event Generator проверяет активные события
      6. Environmental Storytelling добавляет ambient элементы
      7. Atmosphere Service синхронизирует все компоненты

    lore_discovery_flow: |
      1. Игрок взаимодействует с lore объектом
      2. Lore Database извлекает соответствующую информацию
      3. Narrative Engine контекстуализирует лор для персонажа
      4. Immersion Effect System создает эмоциональный отклик
      5. Atmosphere Service сохраняет прогресс открытия лора
      6. Realtime Gateway отправляет персонализированные обновления

  database_structure:
    tables:
      - name: atmospheric_zones
        description: Атмосферные зоны уровней
        columns:
          - id: UUID PRIMARY KEY
          - level_range: INT4RANGE
          - zone_name: VARCHAR(100)
          - atmosphere_theme: VARCHAR(100)
          - lighting_profile: JSONB
          - sound_profile: JSONB
          - hazard_profile: JSONB
          - mood_profile: JSONB
          - lore_density: DECIMAL(3,2)
          - created_at: TIMESTAMP

      - name: visual_styles
        description: Визуальные стили зон
        columns:
          - id: UUID PRIMARY KEY
          - zone_id: UUID FOREIGN KEY
          - style_name: VARCHAR(100)
          - color_palette: JSONB
          - lighting_scheme: JSONB
          - particle_effects: JSONB
          - post_processing: JSONB
          - transition_effects: JSONB

      - name: narrative_elements
        description: Нарративные элементы
        columns:
          - id: UUID PRIMARY KEY
          - zone_id: UUID FOREIGN KEY
          - element_type: VARCHAR(50)
          - content: TEXT
          - trigger_conditions: JSONB
          - character_context: JSONB
          - delivery_method: VARCHAR(50)
          - cooldown_minutes: INTEGER

      - name: lore_database
        description: База данных лора
        columns:
          - id: UUID PRIMARY KEY
          - topic: VARCHAR(255)
          - category: VARCHAR(100)
          - content: TEXT
          - discovery_requirements: JSONB
          - related_topics: JSONB
          - visual_assets: JSONB
          - audio_assets: JSONB

      - name: thematic_events
        description: Тематические события
        columns:
          - id: UUID PRIMARY KEY
          - event_name: VARCHAR(255)
          - event_type: VARCHAR(100)
          - trigger_conditions: JSONB
          - duration_minutes: INTEGER
          - affected_zones: JSONB
          - atmospheric_changes: JSONB
          - narrative_impacts: JSONB

      - name: character_atmosphere_state
        description: Состояние атмосферы для персонажа
        columns:
          - id: UUID PRIMARY KEY
          - character_id: UUID FOREIGN KEY
          - current_zone_id: UUID FOREIGN KEY
          - discovered_lore: JSONB
          - experienced_events: JSONB
          - psychological_effects: JSONB
          - narrative_progress: JSONB
          - last_update: TIMESTAMP

  success_metrics:
    immersion_metrics:
      - zone_transition_time: "Время адаптации к новой зоне"
      - lore_discovery_rate: "Количество открытого лора на сессию"
      - atmospheric_event_engagement: "Вовлеченность в события"
      - narrative_branching_usage: "Использование нарративных выборов"

    atmosphere_quality:
      - visual_consistency_score: "Визуальная согласованность зон"
      - audio_atmosphere_rating: "Качество звуковой атмосферы"
      - narrative_coherence: "Связность повествования"
      - emotional_impact_score: "Эмоциональное воздействие"

  integration_patterns:
    gameplay_integration:
      - quest_location_theming: "Квесты адаптируются к атмосфере зоны"
      - combat_atmospheric_modifiers: "Бой изменяется атмосферными эффектами"
      - social_interaction_flavor: "Диалоги отражают атмосферу зоны"

    technical_integration:
      - dynamic_lighting_systems: "Освещение адаптируется к атмосфере"
      - adaptive_audio_engine: "Звук изменяется по зонам"
      - procedural_content_generation: "Контент генерируется с учетом атмосферы"

# Issue: #142071715
