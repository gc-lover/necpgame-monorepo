quest_service: |
  - Триггеры квестов при стелс-прохождении
  - Проверка требований квестов для стелса
  - Интеграция с квестовыми целями

social_service: |
  - Расчет репутационных последствий
  - Применение бонусов/штрафов к репутации
  - Интеграция с фракциями

npc_service: |
  - Взаимодействие с NPC для маскировки
  - Проверка совместимости маскировок
  - Социальная инженерия

ability_service: |
  - Получение способностей для стелса
  - Интеграция способностей с обнаружением
  - Обработка стелс-атак

implant_service: |
  - Получение данных об имплантах для стелса
  - Расчет бонусов имплантов для обнаружения
  - Интеграция имплантов с маскировкой

progression_service: |
  - Получение данных о навыках стелса
  - Расчет бонусов навыков для обнаружения
  - Обновление навыков на основе стелса

analytics_service: |
  - Логирование всех действий стелса
  - Сбор метрик эффективности
  - Анализ паттернов стелса
  - Детект эксплойтов

realtime_gateway: |
  - Отправка realtime обновлений обнаружения
  - Синхронизация маскировки
  - Уведомления о тревогах

technical_specification:
  subtasks:
    - id: stealth-action-manager
      title: Реализация менеджера действий стелса
      description: |
        Реализация Stealth Action Manager с обработкой всех типов действий стелса,
        валидацией доступности и интеграцией с обнаружением.
      dependencies: [ ]
      estimated_effort: 4 days

    - id: detection-system
      title: Реализация системы обнаружения
      description: |
        Реализация Detection System с расчетом обнаружения по всем каналам,
        учетом элементов стелса и модификаторов.
      dependencies: [ ]
      estimated_effort: 5 days

    - id: disguise-manager
      title: Реализация менеджера маскировки
      description: |
        Реализация Disguise Manager с управлением маскировками, проверкой совместимости
        и интеграцией с фракциями.
      dependencies: [ ]
      estimated_effort: 4 days

    - id: network-hacking-integrator
      title: Реализация интегратора хак сетей
      description: |
        Реализация Network Hacking Integrator с интеграцией Combat Hacking Service,
        управлением сетевыми подписями и взломом камер.
      dependencies: [ ]
      estimated_effort: 4 days

    - id: threat-map-manager
      title: Реализация менеджера карты угроз
      description: |
        Реализация Threat Map Manager с сканированием окружения, определением угроз
        и обновлением карты угроз.
      dependencies: [ detection-system ]
      estimated_effort: 4 days

    - id: stealth-achievement-tracker
      title: Реализация трекера достижений
      description: |
        Реализация Stealth Achievement Tracker с отслеживанием качества стелса,
        проверкой критериев и начислением достижений.
      dependencies: [ stealth-action-manager ]
      estimated_effort: 3 days

    - id: reputation-impact-calculator
      title: Реализация калькулятора репутации
      description: |
        Реализация Reputation Impact Calculator с расчетом репутационных последствий,
        применением бонусов/штрафов и интеграцией с Social Service.
      dependencies: [ stealth-achievement-tracker ]
      estimated_effort: 3 days

    - id: stealth-telemetry-collector
      title: Реализация сборщика телеметрии
      description: |
        Реализация Stealth Telemetry Collector с логированием действий, сбором метрик
        и интеграцией с Analytics Service.
      dependencies: [ stealth-action-manager ]
      estimated_effort: 3 days

    - id: websocket-channels
      title: Реализация WebSocket каналов
      description: |
        Реализация WebSocket каналов для realtime обновлений обнаружения,
        маскировки и тревог.
      dependencies: [ detection-system, disguise-manager ]
      estimated_effort: 3 days

    - id: event-bus-integration
      title: Интеграция с Event Bus
      description: |
        Реализация публикации и подписки на события через Kafka
        для всех компонентов системы стелса.
      dependencies: [ stealth-action-manager, detection-system ]
      estimated_effort: 2 days

    - id: database-schema
      title: Создание схемы БД
      description: |
        Создание таблиц БД для действий, профилей, обнаружения, маскировок, сетевых узлов,
        достижений, репутации и карты угроз с миграциями Liquibase.
      dependencies: [ ]
      estimated_effort: 2 days

diagrams:
  component_diagram: |
    ```mermaid
    graph TB
        Client[UE5 Client] --> Gateway[API Gateway]
    
        Gateway --> GameplayService[Gameplay Service<br/>8083]
    
        GameplayService --> SAM[Stealth Action Manager]
        GameplayService --> DS[Detection System]
        GameplayService --> DM[Disguise Manager]
        GameplayService --> NHI[Network Hacking Integrator]
        GameplayService --> TMM[Threat Map Manager]
        GameplayService --> SAT[Stealth Achievement Tracker]
        GameplayService --> RIC[Reputation Impact Calculator]
        GameplayService --> STC[Stealth Telemetry Collector]
    
        SAM --> DS
        SAM --> DM
        DS --> TMM
        DM --> DS
    
        GameplayService --> CombatHacking[Combat Hacking Service]
        GameplayService --> QuestService[Quest Service]
        GameplayService --> SocialService[Social Service]
        GameplayService --> NPCService[NPC Service]
        GameplayService --> AbilityService[Ability Service]
        GameplayService --> ImplantService[Implant Service]
        GameplayService --> ProgressionService[Progression Service]
        GameplayService --> AnalyticsService[Analytics Service]
    
        GameplayService --> EventBus[Event Bus<br/>Kafka]
        EventBus --> RealtimeGateway[Realtime Gateway]
    
        GameplayService --> DB[(Gameplay DB)]
    
        Client --> WSStealth[WebSocket<br/>Stealth]
        WSStealth --> GameplayService
    ```

  detection_flow_diagram: |
    ```mermaid
    sequenceDiagram
        participant C as Client
        participant DS as Detection System
        participant SAM as Stealth Action Manager
        participant DM as Disguise Manager
        participant IS as Implant Service
        participant AS as Ability Service
        participant EB as Event Bus
    
        C->>SAM: Perform stealth action
        SAM->>DS: Recalculate detection
        DS->>DS: Check visual channel
        DS->>DS: Check audio channel
        DS->>DS: Check technological channel
        DS->>DS: Check network channel
        DS->>DM: Get disguise modifiers
        DM-->>DS: Disguise data
        DS->>IS: Get implant modifiers
        IS-->>DS: Implant data
        DS->>AS: Get ability modifiers
        AS-->>DS: Ability data
        DS->>DS: Calculate detection level
        DS->>DS: Determine detection stage
        DS->>EB: Publish combat.stealth.detection
        DS-->>C: Detection update
    ```

  disguise_activation_diagram: |
    ```mermaid
    sequenceDiagram
        participant C as Client
        participant DM as Disguise Manager
        participant SS as Social Service
        participant DS as Detection System
        participant EB as Event Bus
    
        C->>DM: Activate disguise
        DM->>DM: Check disguise requirements
        DM->>SS: Check faction compatibility
        SS-->>DM: Compatibility result
        DM->>DM: Apply disguise
        DM->>DS: Recalculate detection
        DS-->>DM: Updated detection
        DM->>EB: Publish combat.stealth.disguise
        DM-->>C: Disguise activated
    ```

