          - updated_at: TIMESTAMP
        constraints: |
          - UNIQUE(player_id, corporation_id)
        indexes:
          - player_id, corporation_id
          - corporation_id, reputation_level

technical_specification:
  backend_requirements:
    - Расширение gameplay-service-go модулями:
      - corporate-wars (управление корпоративными войнами)
      - corporate-loyalty (система лояльности)
      - corporate-recruitment (программы набора)
      - corporate-operations (военные операции)
      - corporate-contracts (корпоративные контракты)
      - corporate-reputation (корпоративная репутация)
    - Расширение economy-service-go модулем:
      - corporate-resources (управление ресурсами)
    - Интеграция с npc-integration-system для базовой функциональности NPC
    - Интеграция с clan-war-system для PvP механизмов
    - Интеграция с quest-engine для корпоративных квестов

  corporate_npc_specific_requirements:
    - NPC Джеймс Рид (Militech):
      - Квесты корпоративных войн
      - Программы набора Militech
      - Военные операции Militech
      - Доступ к военным ресурсам
      - Проверка лояльности игроков

  performance_requirements:
    - Поддержка до 10 активных корпоративных войн одновременно
    - Задержка обновления лояльности: <50 мс
    - Поддержка до 100 активных операций от корпораций
    - Поддержка до 50 активных программ набора
    - Поддержка до 200 активных контрактов

  scalability_requirements:
    - Горизонтальное масштабирование через пул инстансов
    - Кэширование состояния лояльности в Redis
    - Асинхронная обработка войн через event bus
    - Batch-обработка обновлений репутации

subtasks:
  - id: corporate-war-manager-module
    title: Реализация Corporate War Manager модуля
    description: |
      Управление корпоративными войнами:
      - Инициация корпоративных войн
      - Координация PvP/PvE конфликтов
      - Управление территориальным контролем
    priority: high
    estimated_time: 6-7 дней

  - id: corporate-loyalty-system-module
    title: Реализация Corporate Loyalty System модуля
    description: |
      Система лояльности корпорациям:
      - Отслеживание лояльности игроков
      - Управление уровнями лояльности
      - Детекция предательства
    priority: high
    estimated_time: 5-6 дней

  - id: corporate-recruitment-manager-module
    title: Реализация Corporate Recruitment Manager модуля
    description: |
      Управление программами набора:
      - Создание программ набора
      - Управление кандидатами
      - Процесс найма
    priority: high
    estimated_time: 5-6 дней

  - id: corporate-operations-coordinator-module
    title: Реализация Corporate Operations Coordinator модуля
    description: |
      Координация военных операций:
      - Создание военных операций
      - Координация участников
      - Управление целями операций
    priority: high
    estimated_time: 6-7 дней

  - id: corporate-resource-manager-module
    title: Реализация Corporate Resource Manager модуля
    description: |
      Управление военными ресурсами:
      - Управление доступом к ресурсам
      - Контроль распределения ресурсов
      - Интеграция с экономикой
    priority: high
    estimated_time: 5-6 дней

  - id: corporate-contract-system-module
    title: Реализация Corporate Contract System модуля
    description: |
      Система корпоративных контрактов:
      - Создание контрактов
      - Управление условиями контрактов
      - Отслеживание выполнения
    priority: high
    estimated_time: 5-6 дней

  - id: corporate-reputation-tracker-module
    title: Реализация Corporate Reputation Tracker модуля
    description: |
      Отслеживание корпоративной репутации:
      - Управление репутацией
      - Отслеживание истории взаимодействий
      - Интеграция с лояльностью
    priority: high
    estimated_time: 4-5 дней

  - id: database-schema-corporate-integration
    title: Создание схемы БД для корпоративной интеграции
    description: |
      Создание таблиц для корпоративной интеграции:
      - corporate_wars
      - corporate_loyalty
      - corporate_recruitment_programs
      - corporate_recruitment_candidates
      - corporate_operations
      - corporate_resources
      - corporate_contracts
      - corporate_reputation
    priority: high
    estimated_time: 3-4 дня

  - id: api-endpoints-corporate-integration
    title: Реализация REST API endpoints для корпоративной интеграции
    description: |
      Создание всех endpoints для корпоративной интеграции:
      - War endpoints
      - Loyalty endpoints
      - Recruitment endpoints
      - Operations endpoints
      - Resources endpoints
      - Contracts endpoints
      - Reputation endpoints
    priority: high
    estimated_time: 4-5 дней

  - id: integration-testing-corporate
    title: Интеграционное тестирование корпоративных систем
    description: |
      Тесты корпоративной интеграции:
      - Тесты корпоративных войн
      - Тесты системы лояльности
      - Тесты программ набора
      - Тесты военных операций
      - Тесты ресурсов и контрактов
      - Тесты репутации
    priority: high
    estimated_time: 6-7 дней

diagrams:
  component_diagram: |
    ```mermaid
    graph TB
        subgraph "Corporate NPC Integration System"
            CWM[Corporate War Manager]
            CLS[Corporate Loyalty System]
            CRM[Corporate Recruitment Manager]
            COC[Corporate Operations Coordinator]
            CRSM[Corporate Resource Manager]
            CCS[Corporate Contract System]
            CRT[Corporate Reputation Tracker]
        end

        subgraph "NPC Integration System"
            NQM[NPC Quest Manager]
            NRT[NPC Relationship Tracker]
            NDS[NPC Dialogue System]
        end

        subgraph "Game Services"
            CWS[Clan War System]
            QE[Quest Engine]
            ES[Economy Service]
            WS[World Service]
        end

        subgraph "Database"
            DB[(PostgreSQL<br/>corporate_wars<br/>corporate_loyalty<br/>corporate_recruitment_programs<br/>corporate_operations<br/>corporate_resources<br/>corporate_contracts<br/>corporate_reputation)]
        end

        subgraph "NPC"
            NPC[Джеймс Рид<br/>Militech Agent]
        end

        subgraph "Client"
            CL[UE5 Client]
        end

        CL -->|interact| NPC
        NPC --> NDS
        NDS --> NQM
        NDS --> CWM
        NDS --> CLS
        NDS --> CRM
        NDS --> COC
        NDS --> CRSM
        NDS --> CCS
        CWM --> CWS
        COC --> QE
        CRSM --> ES
        CRT --> NRT
        CWM --> DB
        CLS --> DB
        CRM --> DB
        COC --> DB
        CRSM --> DB
        CCS --> DB
        CRT --> DB
    ```

  corporate_war_flow_diagram: |
    ```mermaid
    sequenceDiagram
        participant C as Client
        participant NPC as Джеймс Рид
        participant NDS as NPC Dialogue System
        participant CWM as Corporate War Manager
        participant CWS as Clan War System
        participant CLS as Corporate Loyalty System

        C->>NPC: Interact
        NPC->>NDS: Show dialogue tree
        NDS->>C: Display "Initiate War" option
        C->>NDS: Select "Initiate War"
        NDS->>CWM: Request war initiation
        CWM->>CWS: Create corporate war
        CWS->>CWM: War created
        CWM->>C: Notify players
        C->>CWM: Join war (Militech side)
        CWM->>CLS: Update loyalty
        CWM->>C: War started
    ```

decisions:
  - id: adr-corporate-npc-integration-architecture
    summary: |
      Выбрана архитектура, расширяющая общую NPC интеграцию для корпоративных NPC
      с фокусом на корпоративные войны и лояльность.

  - id: adr-corporate-war-system
    summary: |
      Использована интеграция с clan-war-system для PvP механизмов корпоративных войн,
      обеспечивающая единообразие и переиспользование логики.

  - id: adr-corporate-loyalty-system
    summary: |
      Реализована отдельная система лояльности для корпораций с детекцией предательства
      и влиянием на доступность контента.

  - id: adr-corporate-recruitment
    summary: |
      Система набора корпораций обеспечивает структурированный процесс найма игроков
      с проверкой условий и управлением кандидатами.

  - id: adr-corporate-operations
    summary: |
      Координация военных операций через отдельный модуль обеспечивает гибкость
      в создании различных типов операций от корпораций.

validation:
  architecture_complete: true
  components_defined: true
  microservices_identified: true
  api_endpoints_described: true
  technical_specification_ready: true
  subtasks_defined: true

next_steps:
  - Передача задачи агенту API Designer для создания OpenAPI спецификации
  - Детализация схем данных для корпоративной интеграции
  - Определение формата корпоративных войн
  - Создание спецификации системы лояльности

history:
  - version: "1.0.0"
    date: 2025-11-23
    author: Architect Agent
    changes: |
      Создана полная архитектура интеграции корпоративных NPC с игровыми системами:
      - Определены компоненты (Corporate War Manager, Corporate Loyalty System, Corporate Recruitment Manager, Corporate Operations Coordinator, Corporate Resource Manager, Corporate Contract System, Corporate Reputation Tracker)
      - Описаны API endpoints (высокоуровнево)
      - Спроектированы потоки данных (corporate war flow, loyalty flow, recruitment flow, operation flow)
      - Определена структура БД (8 таблиц)
      - Спроектирована интеграция с игровыми системами (NPC integration, clan war system, quest engine, economy service, world service)
      - Создано техническое задание
      - Разбито на подзадачи (10 подзадач)

