# Issue: #104
metadata:
  id: game-mechanics-combat
  title: Архитектура систем игровых механик - Боевые системы
  document_type: architecture
  category: systems
  status: draft
  version: "1.0.0"
  last_updated: 2025-11-23T13:00:00Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - mechanics
    - gameplay
    - combat
  related_documents:
    - id: game-mechanics-core
      relation: extends
  github_issue: 104
  visibility: internal
  audience:
    - architect
    - backend
    - gameplay

architecture:
  microservices:
    - name: gameplay-service
      port: 8083
      responsibility: |
        Обработка боевых механик и игрового процесса:
        - Боевая система (стрельба, стелс, паркур, способности)
        - Импланты и киберпсихоз
        - PvP/PvE баланс
        - Экстракт-механики
        - Арена и лутинг
        - Интеграция с progression-service
      components:
        - combat-engine: обработка боевых действий
        - ability-system: система способностей
        - implant-manager: управление имплантами
        - stealth-system: стелс механики
        - freerun-system: паркур и мобильность
        - extract-zone-manager: управление экстракт-зонами
        - arena-manager: управление аренами
        - loot-generator: генерация лута в бою
      endpoints:
        - POST /api/v1/gameplay/combat/attack - атака
        - POST /api/v1/gameplay/combat/ability - использование способности
        - POST /api/v1/gameplay/combat/stealth - стелс действие
        - POST /api/v1/gameplay/combat/freerun - паркур действие
        - POST /api/v1/gameplay/extract/enter - вход в экстракт-зону
        - POST /api/v1/gameplay/extract/extract - экстракция
        - GET /api/v1/gameplay/combat/loadout - текущий лоадаут
        - POST /api/v1/gameplay/combat/loadout - изменение лоадаута
        - GET /api/v1/gameplay/implants/list - список имплантов
        - POST /api/v1/gameplay/implants/install - установка импланта
        - POST /api/v1/gameplay/implants/remove - удаление импланта
        - GET /api/v1/gameplay/arena/list - список арен
        - POST /api/v1/gameplay/arena/join - присоединение к арене

  data_flows:
    combat_flow: |
      1. Клиент отправляет действие (атака, способность)
      2. Gameplay Service обрабатывает действие через Combat Engine
      3. Combat Engine проверяет условия (выносливость, кулдауны)
      4. Combat Engine рассчитывает урон/эффект
      5. Combat Engine обновляет состояние боя
      6. Combat Engine публикует событие combat:action-executed
      7. Progression Service получает событие и обновляет опыт
      8. Economy Service получает событие и генерирует лут (если применимо)
      9. Realtime Gateway отправляет обновление клиентам

