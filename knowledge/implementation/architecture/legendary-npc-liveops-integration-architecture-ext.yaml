technical_specification:
  backend_requirements:
    - Расширение world-service-go модулями:
        - legendary-npc-events (события легендарных NPC)
        - seasonal-events (сезонные события)
        - live-ops-integration (интеграция с Live Ops)
        - legendary-npc-state (состояние легендарных NPC)
    - Расширение gameplay-service-go модулями:
        - sandevistan-integration (интеграция с Sandevistan)
        - cyberpsychosis-stories (сюжеты о киберпсихозе)
        - edgerunners-teams (Edgerunners команды)
    - Интеграция с npc-integration-system для базовой функциональности NPC
    - Интеграция с live-events-system для Live Ops
    - Интеграция с combat-system для механики Sandevistan

  legendary_npc_specific_requirements:
    - NPC Дэвид Мартинес:
        - Интеграция с механикой Sandevistan
        - Сюжеты о киберпсихозе
        - Участие в Edgerunners командах
        - Сезонные события
        - Live Ops кампании

  performance_requirements:
    - Поддержка до 50 активных событий с легендарными NPC
    - Задержка обновления состояния Sandevistan: <16 мс (60 Hz)
    - Поддержка до 100 активных Edgerunners команд
    - Поддержка до 10 активных сезонных событий
    - Поддержка до 20 легендарных NPC одновременно

  scalability_requirements:
    - Горизонтальное масштабирование через пул инстансов
    - Кэширование состояния легендарных NPC в Redis
    - Асинхронная обработка событий через event bus
    - Batch-обработка обновлений состояния

subtasks:
  - id: legendary-npc-event-manager-module
    title: Реализация Legendary NPC Event Manager модуля
    description: |
      Управление событиями легендарных NPC:
      - Создание событий с участием легендарных NPC
      - Координация появления NPC
      - Управление наградами
    priority: high
    estimated_time: 5-6 дней

  - id: sandevistan-integration-system-module
    title: Реализация Sandevistan Integration System модуля
    description: |
      Интеграция с механикой Sandevistan:
      - Управление Sandevistan способностями
      - Координация временного овердрайва
      - Управление рисками киберпсихоза
    priority: high
    estimated_time: 7-8 дней

  - id: cyberpsychosis-story-system-module
    title: Реализация Cyberpsychosis Story System модуля
    description: |
      Система сюжетов о киберпсихозе:
      - Управление сюжетами
      - Отслеживание прогресса
      - Управление последствиями
    priority: high
    estimated_time: 6-7 дней

  - id: edgerunners-team-manager-module
    title: Реализация Edgerunners Team Manager модуля
    description: |
      Управление Edgerunners командами:
      - Создание команд
      - Управление участниками
      - Координация операций
    priority: high
    estimated_time: 6-7 дней

  - id: seasonal-event-coordinator-module
    title: Реализация Seasonal Event Coordinator модуля
    description: |
      Координация сезонных событий:
      - Планирование событий
      - Координация участия NPC
      - Управление наградами
    priority: high
    estimated_time: 5-6 дней

  - id: legendary-npc-state-manager-module
    title: Реализация Legendary NPC State Manager модуля
    description: |
      Управление состоянием легендарных NPC:
      - Хранение состояния
      - Синхронизация между сервисами
      - Управление жизненным циклом
    priority: high
    estimated_time: 4-5 дней

  - id: live-ops-integration-system-module
    title: Реализация Live Ops Integration System модуля
    description: |
      Интеграция с Live Ops:
      - Синхронизация с событиями
      - Управление появлением NPC
      - Координация с кампаниями
    priority: high
    estimated_time: 5-6 дней

  - id: database-schema-legendary-npc
    title: Создание схемы БД для легендарных NPC
    description: |
      Создание таблиц для легендарных NPC:
      - legendary_npc_events
      - legendary_npc_sandevistan_state
      - cyberpsychosis_stories
      - edgerunners_teams
      - edgerunners_operations
      - seasonal_events
      - legendary_npc_state
    priority: high
    estimated_time: 3-4 дня

  - id: api-endpoints-legendary-npc
    title: Реализация REST API endpoints для легендарных NPC
    description: |
      Создание всех endpoints для легендарных NPC:
      - Event endpoints
      - Sandevistan endpoints
      - Cyberpsychosis endpoints
      - Edgerunners endpoints
      - Seasonal event endpoints
      - State endpoints
      - Live Ops endpoints
    priority: high
    estimated_time: 4-5 дней

  - id: integration-testing-legendary-npc
    title: Интеграционное тестирование систем легендарных NPC
    description: |
      Тесты интеграции легендарных NPC:
      - Тесты событий с легендарными NPC
      - Тесты интеграции с Sandevistan
      - Тесты сюжетов о киберпсихозе
      - Тесты Edgerunners команд
      - Тесты сезонных событий
      - Тесты Live Ops интеграции
    priority: high
    estimated_time: 6-7 дней

diagrams:
  component_diagram: |
    ```mermaid
    graph TB
        subgraph "Legendary NPC Integration System"
            LNEM[Legendary NPC Event Manager]
            SIS[Sandevistan Integration System]
            CSS[Cyberpsychosis Story System]
            ETM[Edgerunners Team Manager]
            SEC[Seasonal Event Coordinator]
            LNSM[Legendary NPC State Manager]
            LOIS[Live Ops Integration System]
        end

        subgraph "NPC Integration System"
            NQM[NPC Quest Manager]
            NRT[NPC Relationship Tracker]
            NDS[NPC Dialogue System]
        end

        subgraph "Game Services"
            LOS[Live Ops Service]
            CS[Combat Service]
            QE[Quest Engine]
            WS[World Service]
        end

        subgraph "Database"
            DB[(PostgreSQL<br/>legendary_npc_events<br/>legendary_npc_sandevistan_state<br/>cyberpsychosis_stories<br/>edgerunners_teams<br/>seasonal_events<br/>legendary_npc_state)]
        end

        subgraph "NPC"
            NPC[Дэвид Мартинес<br/>Legendary Edgerunner]
        end

        subgraph "Client"
            CL[UE5 Client]
        end

        CL -->|interact| NPC
        NPC --> NDS
        NDS --> NQM
        NDS --> LNEM
        NDS --> SIS
        NDS --> CSS
        NDS --> ETM
        LNEM --> SEC
        SEC --> LOIS
        SIS --> CS
        CSS --> QE
        ETM --> WS
        LOIS --> LOS
        LNSM --> WS
        LNEM --> DB
        SIS --> DB
        CSS --> DB
        ETM --> DB
        SEC --> DB
        LNSM --> DB
    ```

  sandevistan_activation_flow_diagram: |
    ```mermaid
    sequenceDiagram
        participant C as Client
        participant NPC as Дэвид Мартинес
        participant SIS as Sandevistan Integration System
        participant CS as Combat Service
        participant CSS as Cyberpsychosis Story System

        C->>NPC: Combat encounter
        NPC->>SIS: Activate Sandevistan
        SIS->>CS: Request Action Priority Budget
        CS->>SIS: Budget allocated
        SIS->>C: Local slow-mo effect
        SIS->>C: Perception drag for others
        NPC->>SIS: Execute actions
        SIS->>CSS: Check cyberpsychosis risk
        CSS->>SIS: Risk level updated
        SIS->>C: Sandevistan active
    ```

decisions:
  - id: adr-legendary-npc-integration-architecture
    summary: |
      Выбрана архитектура, расширяющая общую NPC интеграцию для легендарных NPC
      с фокусом на Live Ops и специальные механики.

  - id: adr-sandevistan-integration
    summary: |
      Интеграция с механикой Sandevistan обеспечивает реалистичное использование
      временного овердрайва легендарными NPC с управлением рисками киберпсихоза.

  - id: adr-cyberpsychosis-stories
    summary: |
      Система сюжетов о киберпсихозе обеспечивает динамические нарративные события
      с возможностью вмешательства игроков и влиянием на состояние NPC.

  - id: adr-edgerunners-teams
    summary: |
      Управление Edgerunners командами обеспечивает кооперативный контент
      с участием легендарных NPC в специальных операциях.

  - id: adr-live-ops-integration
    summary: |
      Интеграция с Live Ops обеспечивает динамическое появление легендарных NPC
      в сезонных событиях и кампаниях с синхронизацией состояния.

validation:
  architecture_complete: true
  components_defined: true
  microservices_identified: true
  api_endpoints_described: true
  technical_specification_ready: true
  subtasks_defined: true

next_steps:
  - Передача задачи агенту API Designer для создания OpenAPI спецификации
  - Детализация схем данных для легендарных NPC
  - Определение формата событий Sandevistan
  - Создание спецификации системы киберпсихоза

history:
  - version: "1.0.0"
    date: 2025-11-23
    author: Architect Agent
    changes: |
      Создана полная архитектура интеграции легендарных NPC с игровыми системами:
      - Определены компоненты (Legendary NPC Event Manager, Sandevistan Integration System, Cyberpsychosis Story System, Edgerunners Team Manager, Seasonal Event Coordinator, Legendary NPC State Manager, Live Ops Integration System)
      - Описаны API endpoints (высокоуровнево)
      - Спроектированы потоки данных (live ops event flow, sandevistan activation flow, cyberpsychosis story flow, edgerunners team flow)
      - Определена структура БД (7 таблиц)
      - Спроектирована интеграция с игровыми системами (NPC integration, Live Ops, combat system, quest engine, world service)
      - Создано техническое задание
      - Разбито на подзадачи (10 подзадач)

