# Issue: #316
metadata:
  id: maintenance-mode-core
  title: Архитектура системы режима обслуживания - Основная структура
  document_type: architecture
  category: systems
  status: draft
  version: "1.1.0"
  last_updated: 2025-11-30T20:55:00Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - infrastructure
    - operations
    - maintenance
  related_systems:
    - infrastructure-service
    - social-service
    - gameplay-service
    - notification-service
    - api-gateway
  related_documents:
    - id: backend-maintenance-mode-system
      relation: implements
    - id: maintenance-mode-mechanics
      relation: extends
    - id: maintenance-mode-data-flows
      relation: extends
    - id: maintenance-mode-database
      relation: extends
    - id: maintenance-mode-integrations
      relation: extends
    - id: maintenance-mode-technical
      relation: extends
  github_issue: 316
  visibility: internal
  audience:
    - architect
    - backend
    - infrastructure
    - api-designer

summary:
  problem: |
    Требуется спроектировать полную архитектуру системы режима обслуживания, включающую:
    - Управление плановым обслуживанием
    - Управление экстренным обслуживанием
    - Систему graceful shutdown
    - Систему уведомлений игроков
    - Блокировку новых соединений
    - Интеграции с инфраструктурой
  goal: |
    Создать архитектурную схему системы режима обслуживания с определением:
    - Компонентов для управления обслуживанием
    - REST, WebSocket и Event Bus контрактов
    - Интеграций с другими системами
    - Структуры БД
    - Технического задания для реализации
  essence: |
    Полная архитектура системы режима обслуживания с поддержкой планового и экстренного обслуживания,
    graceful shutdown и уведомлений.

architecture:
  overview: |
    Архитектура системы режима обслуживания состоит из следующих компонентов:
    1. Maintenance Manager - управление системой обслуживания
    2. Maintenance Window Manager - управление окнами обслуживания
    3. Maintenance Status Manager - управление статусом обслуживания
    4. Scheduled Maintenance Manager - управление плановым обслуживанием
    5. Emergency Maintenance Manager - управление экстренным обслуживанием
    6. Graceful Shutdown Manager - управление graceful shutdown
    7. Connection Blocker - блокировка новых соединений
    8. Maintenance Notification Manager - управление уведомлениями
    9. Maintenance Analytics Collector - сбор аналитики
    10. Maintenance Telemetry Collector - сбор телеметрии

  microservices:
    - name: infrastructure-service
      port: 8093
      responsibility: |
        Обработка системы режима обслуживания:
        - Управление системой обслуживания
        - Управление окнами обслуживания
        - Управление статусом обслуживания
        - Управление плановым обслуживанием
        - Управление экстренным обслуживанием
        - Управление graceful shutdown
        - Блокировка новых соединений
        - Управление уведомлениями
        - Сбор аналитики
        - Сбор телеметрии
      components:
        - maintenance-manager: управление системой обслуживания
        - maintenance-window-manager: управление окнами обслуживания
        - maintenance-status-manager: управление статусом обслуживания
        - scheduled-maintenance-manager: управление плановым обслуживанием
        - emergency-maintenance-manager: управление экстренным обслуживанием
        - graceful-shutdown-manager: управление graceful shutdown
        - connection-blocker: блокировка новых соединений
        - maintenance-notification-manager: управление уведомлениями
        - maintenance-analytics-collector: сбор аналитики
        - maintenance-telemetry-collector: сбор телеметрии
      endpoints:
        - GET /api/v1/maintenance/status - текущий статус обслуживания
        - GET /api/v1/maintenance/windows - список окон обслуживания
        - GET /api/v1/maintenance/windows/{windowId} - информация об окне обслуживания
        - POST /api/v1/maintenance/windows - создание окна обслуживания
        - PUT /api/v1/maintenance/windows/{windowId} - обновление окна обслуживания
        - DELETE /api/v1/maintenance/windows/{windowId} - удаление окна обслуживания
        - POST /api/v1/maintenance/emergency - запуск экстренного обслуживания
        - POST /api/v1/maintenance/start - начало обслуживания
        - POST /api/v1/maintenance/end - завершение обслуживания
        - GET /api/v1/maintenance/notifications - список уведомлений
        - POST /api/v1/maintenance/notifications - создание уведомления
      websocket_channels:
        - wss://api.necp.game/v1/maintenance/status - поток обновлений статуса обслуживания
      events_published:
        - maintenance.window-created: создано окно обслуживания
        - maintenance.window-updated: обновлено окно обслуживания
        - maintenance.window-deleted: удалено окно обслуживания
        - maintenance.started: начато обслуживание
        - maintenance.ended: завершено обслуживание
        - maintenance.emergency-started: начато экстренное обслуживание
        - maintenance.graceful-shutdown-started: начат graceful shutdown
        - maintenance.graceful-shutdown-completed: завершен graceful shutdown
        - maintenance.notification-sent: отправлено уведомление
      events_subscribed:
        - infrastructure.health-check-failed: проверка здоровья не прошла
        - deployment.started: начат деплой
        - deployment.completed: завершен деплой
        - infrastructure.alert: инфраструктурная тревога

