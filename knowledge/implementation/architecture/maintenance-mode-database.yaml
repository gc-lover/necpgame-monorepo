# Issue: #316
metadata:
  id: maintenance-mode-database
  title: Архитектура системы режима обслуживания - База данных
  document_type: architecture
  category: systems
  status: draft
  version: "1.1.0"
  last_updated: 2025-11-30T20:55:00Z
  github_issue: 316
  related_documents:
    - id: maintenance-mode-core
      relation: extends

database_structure:
  tables:
    - name: maintenance_windows
      description: Окна обслуживания
      columns:
        - id: UUID PRIMARY KEY
        - type: ENUM (scheduled, emergency, hot_fix, rollback, upgrade)
        - status: ENUM (planned, starting, in_progress, ending, completed, cancelled)
        - scheduled_start: TIMESTAMP
        - scheduled_end: TIMESTAMP
        - actual_start: TIMESTAMP
        - actual_end: TIMESTAMP
        - estimated_duration: INTEGER
        - reason: TEXT
        - impact: TEXT
        - affected_services: JSONB
        - created_by: UUID FOREIGN KEY
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP

    - name: maintenance_status
      description: Текущий статус обслуживания
      columns:
        - id: UUID PRIMARY KEY
        - is_maintenance_mode: BOOLEAN
        - current_window_id: UUID FOREIGN KEY
        - connection_blocking_enabled: BOOLEAN
        - graceful_shutdown_in_progress: BOOLEAN
        - last_updated: TIMESTAMP

    - name: maintenance_notifications
      description: Уведомления об обслуживании
      columns:
        - id: UUID PRIMARY KEY
        - window_id: UUID FOREIGN KEY
        - notification_type: ENUM (advance_24h, advance_1h, immediate, completion)
        - channel: ENUM (in_game, email, push, social_media)
        - content: JSONB
        - sent_at: TIMESTAMP
        - created_at: TIMESTAMP

    - name: maintenance_telemetry
      description: Телеметрия обслуживания
      columns:
        - id: UUID PRIMARY KEY
        - event_type: VARCHAR(50)
        - window_id: UUID FOREIGN KEY
        - event_data: JSONB
        - created_at: TIMESTAMP

