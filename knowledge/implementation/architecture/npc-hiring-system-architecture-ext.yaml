          - started_at: TIMESTAMP
          - completed_at: TIMESTAMP
          - resources: JSONB

      - name: npc_hiring_performance
        description: Эффективность нанятых NPC
        columns:
          - id: UUID PRIMARY KEY
          - contract_id: UUID FOREIGN KEY
          - npc_id: UUID FOREIGN KEY
          - skill_level: INTEGER
          - relationship_level: INTEGER
          - efficiency_score: DECIMAL(5,2)
          - tasks_completed: INTEGER
          - tasks_failed: INTEGER
          - loyalty_score: DECIMAL(5,2)
          - last_update: TIMESTAMP

      - name: npc_hiring_economy
        description: Экономика найма NPC
        columns:
          - id: UUID PRIMARY KEY
          - contract_id: UUID FOREIGN KEY
          - character_id: UUID FOREIGN KEY
          - payment_type: ENUM (salary, one-time, profit-share)
          - amount: DECIMAL(10,2)
          - payment_date: TIMESTAMP
          - status: ENUM (pending, paid, failed)
          - transaction_id: UUID

      - name: npc_hiring_limits
        description: Лимиты найма для персонажей
        columns:
          - id: UUID PRIMARY KEY
          - character_id: UUID FOREIGN KEY
          - hiring_type: VARCHAR(50)
          - current_count: INTEGER
          - max_count: INTEGER
          - scaling_factors: JSONB
          - last_update: TIMESTAMP

      - name: npc_hiring_chains
        description: Цепочки найма
        columns:
          - id: UUID PRIMARY KEY
          - character_id: UUID FOREIGN KEY
          - chain_name: VARCHAR(100)
          - npc_ids: UUID[]
          - chain_type: VARCHAR(50)
          - efficiency_bonus: DECIMAL(5,2)
          - created_at: TIMESTAMP

      - name: npc_hiring_groups
        description: Групповые контракты
        columns:
          - id: UUID PRIMARY KEY
          - character_id: UUID FOREIGN KEY
          - group_name: VARCHAR(100)
          - contract_ids: UUID[]
          - shared_bonuses: JSONB
          - created_at: TIMESTAMP

      - name: npc_hiring_automation
        description: Настройки автоматизации
        columns:
          - id: UUID PRIMARY KEY
          - character_id: UUID FOREIGN KEY
          - automation_type: VARCHAR(50)
          - configuration: JSONB
          - enabled: BOOLEAN
          - created_at: TIMESTAMP
          - updated_at: TIMESTAMP

  integrations:
    npc_service: |
      - Получение информации о NPC
      - Проверка доступности NPC
      - Обновление статуса NPC
      - Взаимодействие с NPC

    economy_service: |
      - Проверка баланса игрока
      - Обработка выплат зарплат
      - Расчет доходов от NPC
      - Интеграция с налоговой системой

    world_service: |
      - Проверка доступа к территориям
      - Триггеры событий на основе найма
      - Влияние найма на мир

    quest_service: |
      - Интеграция с квестами NPC
      - Назначение квестов нанятым NPC
      - Оценка выполнения квестов

    reputation_service: |
      - Проверка репутации для найма
      - Влияние найма на репутацию
      - Обновление репутации на основе работы NPC

    gameplay_service: |
      - Получение событий игрового процесса
      - Интеграция с системой прогрессии
      - Модификация эффективности на основе навыков

    analytics_service: |
      - Логирование всех операций найма
      - Сбор метрик эффективности
      - Анализ паттернов найма

    realtime_gateway: |
      - Отправка realtime обновлений найма
      - Синхронизация задач
      - Уведомления о событиях найма

technical_specification:
  subtasks:
    - id: npc-hiring-manager
      title: Реализация менеджера найма NPC
      description: |
        Реализация NPC Hiring Manager с управлением наймом NPC,
        контрактами и интеграцией с другими компонентами.
      dependencies: []
      estimated_effort: 5 days

    - id: npc-discovery-service
      title: Реализация сервиса поиска кандидатов
      description: |
        Реализация NPC Discovery Service с поиском кандидатов,
        фильтрацией и рекомендациями.
      dependencies: [npc-hiring-manager]
      estimated_effort: 4 days

    - id: contract-negotiation-manager
      title: Реализация менеджера переговоров
      description: |
        Реализация Contract Negotiation Manager с обработкой переговоров,
        созданием контрактов и управлением условиями.
      dependencies: [npc-hiring-manager]
      estimated_effort: 4 days

    - id: workforce-manager
      title: Реализация менеджера персонала
      description: |
        Реализация Workforce Manager с управлением нанятым персоналом,
        статусами и взаимодействием.
      dependencies: [npc-hiring-manager]
      estimated_effort: 4 days

    - id: task-assignment-manager
      title: Реализация менеджера назначения задач
      description: |
        Реализация Task Assignment Manager с назначением задач,
        управлением приоритетами и ресурсами.
      dependencies: [workforce-manager]
      estimated_effort: 4 days

    - id: performance-monitor
      title: Реализация монитора эффективности
      description: |
        Реализация Performance Monitor с отслеживанием эффективности,
        расчетом метрик и анализом производительности.
      dependencies: [workforce-manager]
      estimated_effort: 4 days

    - id: economy-manager
      title: Реализация менеджера экономики найма
      description: |
        Реализация Economy Manager с расчетом зарплат,
        обработкой выплат и интеграцией с Economy Service.
      dependencies: [npc-hiring-manager]
      estimated_effort: 4 days

    - id: limit-validator
      title: Реализация валидатора лимитов
      description: |
        Реализация Limit Validator с проверкой ограничений найма,
        расчетом лимитов и валидацией требований.
      dependencies: [npc-hiring-manager]
      estimated_effort: 3 days

    - id: advanced-mechanics-manager
      title: Реализация менеджера продвинутых механик
      description: |
        Реализация Advanced Mechanics Manager с поддержкой цепочек найма,
        групповых контрактов и автоматизации.
      dependencies: [npc-hiring-manager, workforce-manager]
      estimated_effort: 5 days

    - id: npc-hiring-telemetry-collector
      title: Реализация сборщика телеметрии
      description: |
        Реализация NPC Hiring Telemetry Collector с логированием операций,
        сбором метрик и интеграцией с Analytics Service.
      dependencies: [npc-hiring-manager]
      estimated_effort: 3 days

    - id: websocket-channels
      title: Реализация WebSocket каналов
      description: |
        Реализация WebSocket каналов для realtime обновлений найма,
        задач и эффективности.
      dependencies: [npc-hiring-manager, workforce-manager]
      estimated_effort: 3 days

    - id: event-bus-integration
      title: Интеграция с Event Bus
      description: |
        Реализация публикации и подписки на события через Kafka
        для всех компонентов системы найма NPC.
      dependencies: [npc-hiring-manager]
      estimated_effort: 2 days

    - id: database-schema
      title: Создание схемы БД
      description: |
        Создание таблиц БД для контрактов, задач, эффективности, экономики,
        лимитов, цепочек, групп и автоматизации с миграциями Liquibase.
      dependencies: []
      estimated_effort: 3 days

diagrams:
  component_diagram: |
    ```mermaid
    graph TB
        Client[UE5 Client] --> Gateway[API Gateway]
        
        Gateway --> SocialService[Social Service<br/>8084]
        
        SocialService --> NHM[NPC Hiring Manager]
        SocialService --> NDS[NPC Discovery Service]
        SocialService --> CNM[Contract Negotiation Manager]
        SocialService --> WM[Workforce Manager]
        SocialService --> TAM[Task Assignment Manager]
        SocialService --> PM[Performance Monitor]
        SocialService --> EM[Economy Manager]
        SocialService --> LV[Limit Validator]
        SocialService --> AMM[Advanced Mechanics Manager]
        SocialService --> NHTC[NPC Hiring Telemetry Collector]
        
        NHM --> NDS
        NHM --> CNM
        NHM --> WM
        WM --> TAM
        WM --> PM
        NHM --> EM
        NHM --> LV
        NHM --> AMM
        
        SocialService --> NPCService[NPC Service]
        SocialService --> EconomyService[Economy Service]
        SocialService --> WorldService[World Service]
        SocialService --> QuestService[Quest Service]
        SocialService --> ReputationService[Reputation Service]
        SocialService --> GameplayService[Gameplay Service]
        SocialService --> AnalyticsService[Analytics Service]
        
        SocialService --> EventBus[Event Bus<br/>Kafka]
        EventBus --> RealtimeGateway[Realtime Gateway]
        
        SocialService --> DB[(Social DB)]
        
        Client --> WSNPC[WebSocket<br/>NPC Hiring]
        WSNPC --> SocialService
    ```

  hiring_flow_diagram: |
    ```mermaid
    sequenceDiagram
        participant P as Player
        participant NDS as NPC Discovery Service
        participant CNM as Contract Negotiation Manager
        participant NHM as NPC Hiring Manager
        participant WM as Workforce Manager
        participant EB as Event Bus
        
        P->>NDS: Search candidates
        NDS->>NDS: Find candidates
        NDS->>P: Return candidates
        P->>CNM: Start negotiation
        CNM->>CNM: Process negotiation
        CNM->>P: Negotiation result
        P->>CNM: Accept contract
        CNM->>NHM: Create contract
        NHM->>WM: Add to workforce
        WM->>EB: Publish social.npc-hiring.npc-hired
    ```

  task_assignment_diagram: |
    ```mermaid
    sequenceDiagram
        participant P as Player
        participant TAM as Task Assignment Manager
        participant WM as Workforce Manager
        participant PM as Performance Monitor
        participant EB as Event Bus
        
        P->>TAM: Assign task
        TAM->>TAM: Check availability
        TAM->>TAM: Check skills
        TAM->>WM: Assign task
        WM->>PM: Update performance
        WM->>EB: Publish social.npc-hiring.task-assigned
    ```

