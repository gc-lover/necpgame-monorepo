# Issue: #305
metadata:
  id: player-orders-core
  title: Архитектура системы заказов от игроков - Основная структура
  document_type: architecture
  category: systems
  status: draft
  version: "1.0.0"
  last_updated: 2025-11-23T23:55:00Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - social
    - player-orders
    - economy
  related_systems:
    - social-service
    - economy-service
    - world-service
    - gameplay-service
    - quest-service
    - reputation-service
  related_documents:
    - id: player-orders-mechanics
      relation: extends
    - id: player-orders-rating
      relation: extends
    - id: player-orders-economy
      relation: extends
    - id: player-orders-database
      relation: extends
    - id: player-orders-integrations
      relation: extends
    - id: player-orders-technical
      relation: extends
  github_issue: 305
  visibility: internal
  audience:
    - architect
    - backend
    - social
    - api-designer

summary:
  problem: |
    Требуется спроектировать архитектуру системы заказов от игроков, включающую:
    - Базовые механики (создание, выполнение, рейтинги, репутация)
    - Продвинутые механики (мульти-исполнители, аукционы, опционы, арбитраж, страхование)
    - Типы заказов (боевые, хакерские, торговые, политические, исследовательские, социальные)
    - Экономику заказов (модели оплаты, комиссии, депозиты, бонусы, штрафы)
    - Интеграции с другими системами
  goal: |
    Создать архитектурную схему системы заказов с определением:
    - Компонентов для управления заказами
    - REST, WebSocket и Event Bus контрактов
    - Интеграций с другими системами
    - Структуры БД
    - Технического задания для реализации
  essence: |
    Полная архитектура системы заказов от игроков с поддержкой базовых и продвинутых механик,
    экономики, репутации и интеграций с мировыми системами.

architecture:
  overview: |
    Архитектура системы заказов состоит из следующих компонентов:
    1. Order Manager - управление заказами
    2. Order Creation Manager - создание заказов
    3. Order Execution Manager - выполнение заказов
    4. Multi-Executor Manager - управление мульти-исполнительными заказами
    5. Auction Manager - управление аукционами
    6. Options Manager - управление опционами
    7. Arbitration Manager - управление арбитражем
    8. Insurance Manager - управление страхованием
    9. Order Rating Manager - управление рейтингами
    10. Order Reputation Manager - управление репутацией
    11. Order Economy Manager - управление экономикой заказов
    12. Order Telemetry Collector - сбор телеметрии

  microservices:
    - name: social-service
      port: 8084
      responsibility: |
        Обработка заказов от игроков:
        - Управление заказами
        - Создание заказов
        - Выполнение заказов
        - Управление мульти-исполнительными заказами
        - Управление аукционами
        - Управление опционами
        - Управление арбитражем
        - Управление страхованием
        - Управление рейтингами
        - Управление репутацией
        - Управление экономикой заказов
        - Сбор телеметрии
      components:
        - order-manager: управление заказами
        - order-creation-manager: создание заказов
        - order-execution-manager: выполнение заказов
        - multi-executor-manager: управление мульти-исполнительными заказами
        - auction-manager: управление аукционами
        - options-manager: управление опционами
        - arbitration-manager: управление арбитражем
        - insurance-manager: управление страхованием
        - order-rating-manager: управление рейтингами
        - order-reputation-manager: управление репутацией
        - order-economy-manager: управление экономикой заказов
        - order-telemetry-collector: сбор телеметрии
      endpoints:
        - POST /api/v1/social/orders/create - создание заказа
        - GET /api/v1/social/orders - список заказов
        - GET /api/v1/social/orders/{orderId} - информация о заказе
        - POST /api/v1/social/orders/{orderId}/accept - принятие заказа
        - POST /api/v1/social/orders/{orderId}/start - начало выполнения
        - POST /api/v1/social/orders/{orderId}/complete - завершение заказа
        - POST /api/v1/social/orders/{orderId}/cancel - отмена заказа
        - POST /api/v1/social/orders/{orderId}/review - отзыв о заказе
        - GET /api/v1/social/orders/multi-executor/create - создание мульти-исполнительного заказа
        - POST /api/v1/social/orders/{orderId}/executors/invite - приглашение исполнителя
        - POST /api/v1/social/orders/{orderId}/executors/join - присоединение к заказу
        - GET /api/v1/social/orders/auctions - список аукционов
        - POST /api/v1/social/orders/auctions/create - создание аукциона
        - POST /api/v1/social/orders/auctions/{auctionId}/bid - ставка на аукционе
        - GET /api/v1/social/orders/auctions/{auctionId} - информация об аукционе
        - POST /api/v1/social/orders/{orderId}/options/buy - покупка опциона
        - POST /api/v1/social/orders/{orderId}/options/exercise - использование опциона
        - POST /api/v1/social/orders/{orderId}/arbitration/request - запрос арбитража
        - GET /api/v1/social/orders/arbitration/{caseId} - информация об арбитраже
        - POST /api/v1/social/orders/{orderId}/insurance/buy - покупка страховки
        - GET /api/v1/social/orders/{orderId}/insurance - информация о страховке
        - GET /api/v1/social/orders/ratings/{characterId} - рейтинги персонажа
        - GET /api/v1/social/orders/reputation/{characterId} - репутация персонажа
        - GET /api/v1/social/orders/economy/pricing - расчет стоимости заказа
      websocket_channels:
        - wss://api.necp.game/v1/social/orders/{characterId} - поток обновлений заказов персонажа
        - wss://api.necp.game/v1/social/orders/auctions/{auctionId} - поток обновлений аукциона
      events_published:
        - social.player-order.created: создан заказ
        - social.player-order.accepted: заказ принят
        - social.player-order.started: заказ начат
        - social.player-order.completed: заказ завершен
        - social.player-order.cancelled: заказ отменен
        - social.player-order.reviewed: оставлен отзыв
        - social.player-order.multi-executor.created: создан мульти-исполнительный заказ
        - social.player-order.executor.joined: исполнитель присоединился
        - social.player-order.auction.created: создан аукцион
        - social.player-order.auction.bid-placed: сделана ставка
        - social.player-order.auction.closed: аукцион закрыт
        - social.player-order.option.purchased: куплен опцион
        - social.player-order.option.exercised: использован опцион
        - social.player-order.arbitration.requested: запрошен арбитраж
        - social.player-order.arbitration.resolved: арбитраж разрешен
        - social.player-order.insurance.purchased: куплена страховка
        - social.player-order.insurance.claimed: заявлена страховка
        - social.player-order.rating.updated: обновлен рейтинг
        - social.player-order.reputation.updated: обновлена репутация
      events_subscribed:
        - quest.completed: завершение квеста
        - character.level-up: повышение уровня
        - reputation.changed: изменение репутации
        - economy.transaction: транзакция в экономике
        - world.event: событие мира
        - npc.interaction: взаимодействие с NPC

  order_types:
    - name: combat
      description: "Боевые заказы - устранение целей, защита, рейды, захват, эскорт"
      risk_level: high
      requirements:
        - combat_skills: required
        - team_size: 1-5
      rewards:
        - base_multiplier: 1.5
        - risk_bonus: 0.3

    - name: hacking
      description: "Хакерские заказы - взлом, сбор информации, саботаж"
      risk_level: high
      requirements:
        - hacking_skills: required
        - stealth_skills: recommended
      rewards:
        - base_multiplier: 1.3
        - risk_bonus: 0.2

    - name: trade
      description: "Торговые заказы - поставки, транспортировка, сделки, контрабанда"
      risk_level: medium
      requirements:
        - trader_skills: required
        - logistics_skills: recommended
      rewards:
        - base_multiplier: 1.0
        - risk_bonus: 0.1

    - name: political
      description: "Политические заказы - влияние, дипломатия, пропаганда, урегулирование"
      risk_level: medium
      requirements:
        - social_skills: required
        - reputation: high
      rewards:
        - base_multiplier: 1.2
        - risk_bonus: 0.15

    - name: research
      description: "Исследовательские заказы - исследование, разработка, тестирование"
      risk_level: low
      requirements:
        - technology_skills: required
        - research_skills: recommended
      rewards:
        - base_multiplier: 0.9
        - risk_bonus: 0.05

    - name: social
      description: "Социальные заказы - взаимодействие, организация, координация"
      risk_level: low
      requirements:
        - social_skills: required
      rewards:
        - base_multiplier: 0.8
        - risk_bonus: 0.05

  order_lifecycle:
    creation: |
      - Создание заказа заказчиком
      - Настройка параметров (тип, сложность, награда, сроки)
      - Выбор формата (публичный, отборный, закрытый, аукцион)
      - Публикация заказа

    selection: |
      - Просмотр заказов исполнителями
      - Подача заявок или ставок
      - Отбор исполнителей заказчиком
      - Принятие заказа исполнителем

    execution: |
      - Начало выполнения заказа
      - Отслеживание прогресса
      - Выполнение задач
      - Сдача результатов

    completion: |
      - Проверка выполнения
      - Расчет наград
      - Распределение наград
      - Обновление репутации
      - Отзывы

