metadata:
  id: player-orders-system-architecture
  title: Архитектура системы заказов от игроков
  document_type: architecture
  category: systems
  status: draft
  version: "1.0.0"
  last_updated: 2025-11-23T23:55:00Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - social
    - player-orders
    - economy
  related_systems:
    - social-service
    - economy-service
    - world-service
    - gameplay-service
    - quest-service
    - reputation-service
  related_documents:
    - id: player-orders-system-detailed
      relation: implements
    - id: player-orders-advanced
      relation: implements
  github_issue: 305
  visibility: internal
  audience:
    - architect
    - backend
    - social
    - api-designer

summary:
  problem: |
    Требуется спроектировать архитектуру системы заказов от игроков, включающую:
    - Базовые механики (создание, выполнение, рейтинги, репутация)
    - Продвинутые механики (мульти-исполнители, аукционы, опционы, арбитраж, страхование)
    - Типы заказов (боевые, хакерские, торговые, политические, исследовательские, социальные)
    - Экономику заказов (модели оплаты, комиссии, депозиты, бонусы, штрафы)
    - Интеграции с другими системами
  goal: |
    Создать архитектурную схему системы заказов с определением:
    - Компонентов для управления заказами
    - REST, WebSocket и Event Bus контрактов
    - Интеграций с другими системами
    - Структуры БД
    - Технического задания для реализации
  essence: |
    Полная архитектура системы заказов от игроков с поддержкой базовых и продвинутых механик,
    экономики, репутации и интеграций с мировыми системами.

architecture:
  overview: |
    Архитектура системы заказов состоит из следующих компонентов:
    1. Order Manager - управление заказами
    2. Order Creation Manager - создание заказов
    3. Order Execution Manager - выполнение заказов
    4. Multi-Executor Manager - управление мульти-исполнительными заказами
    5. Auction Manager - управление аукционами
    6. Options Manager - управление опционами
    7. Arbitration Manager - управление арбитражем
    8. Insurance Manager - управление страхованием
    9. Order Rating Manager - управление рейтингами
    10. Order Reputation Manager - управление репутацией
    11. Order Economy Manager - управление экономикой заказов
    12. Order Telemetry Collector - сбор телеметрии

  microservices:
    - name: social-service
      port: 8084
      responsibility: |
        Обработка заказов от игроков:
        - Управление заказами
        - Создание заказов
        - Выполнение заказов
        - Управление мульти-исполнительными заказами
        - Управление аукционами
        - Управление опционами
        - Управление арбитражем
        - Управление страхованием
        - Управление рейтингами
        - Управление репутацией
        - Управление экономикой заказов
        - Сбор телеметрии
      components:
        - order-manager: управление заказами
        - order-creation-manager: создание заказов
        - order-execution-manager: выполнение заказов
        - multi-executor-manager: управление мульти-исполнительными заказами
        - auction-manager: управление аукционами
        - options-manager: управление опционами
        - arbitration-manager: управление арбитражем
        - insurance-manager: управление страхованием
        - order-rating-manager: управление рейтингами
        - order-reputation-manager: управление репутацией
        - order-economy-manager: управление экономикой заказов
        - order-telemetry-collector: сбор телеметрии
      endpoints:
        - POST /api/v1/social/orders/create - создание заказа
        - GET /api/v1/social/orders - список заказов
        - GET /api/v1/social/orders/{orderId} - информация о заказе
        - POST /api/v1/social/orders/{orderId}/accept - принятие заказа
        - POST /api/v1/social/orders/{orderId}/start - начало выполнения
        - POST /api/v1/social/orders/{orderId}/complete - завершение заказа
        - POST /api/v1/social/orders/{orderId}/cancel - отмена заказа
        - POST /api/v1/social/orders/{orderId}/review - отзыв о заказе
        - GET /api/v1/social/orders/multi-executor/create - создание мульти-исполнительного заказа
        - POST /api/v1/social/orders/{orderId}/executors/invite - приглашение исполнителя
        - POST /api/v1/social/orders/{orderId}/executors/join - присоединение к заказу
        - GET /api/v1/social/orders/auctions - список аукционов
        - POST /api/v1/social/orders/auctions/create - создание аукциона
        - POST /api/v1/social/orders/auctions/{auctionId}/bid - ставка на аукционе
        - GET /api/v1/social/orders/auctions/{auctionId} - информация об аукционе
        - POST /api/v1/social/orders/{orderId}/options/buy - покупка опциона
        - POST /api/v1/social/orders/{orderId}/options/exercise - использование опциона
        - POST /api/v1/social/orders/{orderId}/arbitration/request - запрос арбитража
        - GET /api/v1/social/orders/arbitration/{caseId} - информация об арбитраже
        - POST /api/v1/social/orders/{orderId}/insurance/buy - покупка страховки
        - GET /api/v1/social/orders/{orderId}/insurance - информация о страховке
        - GET /api/v1/social/orders/ratings/{characterId} - рейтинги персонажа
        - GET /api/v1/social/orders/reputation/{characterId} - репутация персонажа
        - GET /api/v1/social/orders/economy/pricing - расчет стоимости заказа
      websocket_channels:
        - wss://api.necp.game/v1/social/orders/{characterId} - поток обновлений заказов персонажа
        - wss://api.necp.game/v1/social/orders/auctions/{auctionId} - поток обновлений аукциона
      events_published:
        - social.player-order.created: создан заказ
        - social.player-order.accepted: заказ принят
        - social.player-order.started: заказ начат
        - social.player-order.completed: заказ завершен
        - social.player-order.cancelled: заказ отменен
        - social.player-order.reviewed: оставлен отзыв
        - social.player-order.multi-executor.created: создан мульти-исполнительный заказ
        - social.player-order.executor.joined: исполнитель присоединился
        - social.player-order.auction.created: создан аукцион
        - social.player-order.auction.bid-placed: сделана ставка
        - social.player-order.auction.closed: аукцион закрыт
        - social.player-order.option.purchased: куплен опцион
        - social.player-order.option.exercised: использован опцион
        - social.player-order.arbitration.requested: запрошен арбитраж
        - social.player-order.arbitration.resolved: арбитраж разрешен
        - social.player-order.insurance.purchased: куплена страховка
        - social.player-order.insurance.claimed: заявлена страховка
        - social.player-order.rating.updated: обновлен рейтинг
        - social.player-order.reputation.updated: обновлена репутация
      events_subscribed:
        - quest.completed: завершение квеста
        - character.level-up: повышение уровня
        - reputation.changed: изменение репутации
        - economy.transaction: транзакция в экономике
        - world.event: событие мира
        - npc.interaction: взаимодействие с NPC

  order_types:
    - name: combat
      description: "Боевые заказы - устранение целей, защита, рейды, захват, эскорт"
      risk_level: high
      requirements:
        - combat_skills: required
        - team_size: 1-5
      rewards:
        - base_multiplier: 1.5
        - risk_bonus: 0.3

    - name: hacking
      description: "Хакерские заказы - взлом, сбор информации, саботаж"
      risk_level: high
      requirements:
        - hacking_skills: required
        - stealth_skills: recommended
      rewards:
        - base_multiplier: 1.3
        - risk_bonus: 0.2

    - name: trade
      description: "Торговые заказы - поставки, транспортировка, сделки, контрабанда"
      risk_level: medium
      requirements:
        - trader_skills: required
        - logistics_skills: recommended
      rewards:
        - base_multiplier: 1.0
        - risk_bonus: 0.1

    - name: political
      description: "Политические заказы - влияние, дипломатия, пропаганда, урегулирование"
      risk_level: medium
      requirements:
        - social_skills: required
        - reputation: high
      rewards:
        - base_multiplier: 1.2
        - risk_bonus: 0.15

    - name: research
      description: "Исследовательские заказы - исследование, разработка, тестирование"
      risk_level: low
      requirements:
        - technology_skills: required
        - research_skills: recommended
      rewards:
        - base_multiplier: 0.9
        - risk_bonus: 0.05

    - name: social
      description: "Социальные заказы - взаимодействие, организация, координация"
      risk_level: low
      requirements:
        - social_skills: required
      rewards:
        - base_multiplier: 0.8
        - risk_bonus: 0.05

  order_lifecycle:
    creation: |
      - Создание заказа заказчиком
      - Настройка параметров (тип, сложность, награда, сроки)
      - Выбор формата (публичный, отборный, закрытый, аукцион)
      - Публикация заказа

    selection: |
      - Просмотр заказов исполнителями
      - Подача заявок или ставок
      - Отбор исполнителей заказчиком
      - Принятие заказа исполнителем

    execution: |
      - Начало выполнения заказа
      - Отслеживание прогресса
      - Выполнение задач
      - Сдача результатов

    completion: |
      - Проверка выполнения
      - Расчет наград
      - Распределение наград
      - Обновление репутации
      - Отзывы

  multi_executor_mechanics:
    roles:
      - name: team_leader
        description: "Лидер команды - создает заказ и приглашает исполнителей"
        bonus: 0.1
        responsibilities:
          - order_creation
          - team_coordination
          - reward_distribution

      - name: specialist
        description: "Специалист - выполняет конкретную роль"
        bonus: 0.15
        responsibilities:
          - role_execution
          - task_completion

      - name: support
        description: "Поддержка - обеспечивает логистику, разведку, прикрытие"
        bonus: 0.05
        responsibilities:
          - logistics
          - reconnaissance
          - cover

    reward_distribution:
      factors:
        - contribution_percentage: "процент выполнения задач"
        - role_complexity: "сложность роли"
        - reputation: "репутация исполнителя"
        - risk: "риск операции"
      formula: |
        reward = base_reward * (contribution_percentage * role_complexity * (1 + reputation_bonus) * (1 + risk_bonus))

  auction_mechanics:
    types:
      - name: ascending
        description: "Прямой аукцион - ставки растут"
        mechanics: |
          - Ставки увеличиваются
          - Победитель - самая высокая ставка или лучшие условия
          - Таймер на каждую ставку

      - name: descending
        description: "Голландский аукцион - цена снижается"
        mechanics: |
          - Цена начинается высокой
          - Постепенно снижается
          - Первый согласившийся получает контракт

      - name: sealed
        description: "Закрытый аукцион - все ставки одновременно"
        mechanics: |
          - Все ставки подаются одновременно
          - Победитель определяется по лучшему соотношению цена/качество
          - Результаты объявляются после закрытия

    fees:
      - organizer_commission: "5-10% от суммы контракта"
      - deposit: "гарантийный депозит"
      - registration_fee: "плата за участие"

  options_mechanics:
    types:
      - name: customer_cancellation
        description: "Опцион на отмену заказчиком"
        protection: "защищает исполнителя от отмены заказа заказчиком"
        compensation: "часть вознаграждения"

      - name: executor_cancellation
        description: "Опцион на отмену исполнителем"
        protection: "позволяет исполнителю отменить заказ с минимальными потерями"
        compensation: "возврат части депозита"

      - name: mutual_cancellation
        description: "Взаимный опцион"
        protection: "защищает обе стороны от отмены"
        compensation: "компенсация обеим сторонам"

    pricing_factors:
      - order_amount: "сумма заказа"
      - customer_reputation: "репутация заказчика"
      - order_complexity: "сложность заказа"
      - cancellation_history: "история отмен"

  arbitration_mechanics:
    triggers:
      - order_violation: "нарушение условий заказа"
      - quality_dispute: "споры о качестве выполнения"
      - deadline_violation: "нарушение сроков"
      - fraud: "обман или мошенничество"

    process:
      - complaint_filing: "подача жалобы"
      - evidence_collection: "сбор доказательств"
      - analysis: "анализ арбитражной палатой"
      - decision: "вынесение решения"
      - enforcement: "исполнение решения"

    decisions:
      - compensation: "выплата пострадавшей стороне"
      - penalty: "наказание для нарушителя"
      - reputation_change: "обновление репутации"
      - ban: "временный запрет на создание/принятие заказов"

  insurance_mechanics:
    types:
      - name: mission_failure
        description: "Страхование провала миссии"
        coverage: "убытки при неудачном выполнении"

      - name: cargo
        description: "Страхование груза"
        coverage: "утрата или повреждение груза"

      - name: delay
        description: "Страхование задержек"
        coverage: "убытки от просрочки"

      - name: comprehensive
        description: "Комплексная страховка"
        coverage: "все риски"

    premium_calculation:
      factors:
        - order_complexity: "сложность заказа"
        - executor_reputation: "репутация исполнителя"
        - failure_statistics: "статистика провалов"
        - world_stability: "текущая обстановка в городе"
        - order_amount: "сумма заказа"

  rating_system:
    factors:
      - completion_rate: "процент успешных выполнений"
      - quality_score: "оценка качества"
      - timeliness: "своевременность"
      - communication: "коммуникация"
      - cooperation: "кооперация"

    badges:
      - reliable: "надежный исполнитель"
      - expert: "эксперт в области"
      - fast: "быстрое выполнение"
      - cooperative: "отличная кооперация"

  reputation_system:
    factors:
      - order_history: "история заказов"
      - rating_average: "средний рейтинг"
      - completion_rate: "процент успешных выполнений"
      - arbitration_cases: "случаи арбитража"
      - insurance_claims: "страховые случаи"

    effects:
      - access_control: "контроль доступа к заказам"
      - pricing_modifier: "модификатор цены"
      - trust_level: "уровень доверия"

  economy_models:
    payment_types:
      - fixed: "фиксированная сумма"
      - hourly: "почасовая оплата"
      - percentage: "процент от результата"
      - hybrid: "гибридная модель"

    fees:
      - platform_commission: "комиссия платформы"
      - broker_commission: "комиссия брокера"
      - npc_commission: "комиссия NPC"
      - arbitration_fee: "плата за арбитраж"

    deposits:
      - customer_deposit: "депозит заказчика"
      - executor_deposit: "депозит исполнителя"
      - escrow: "условное депонирование"

  data_flows:
    order_creation_flow: |
      1. Заказчик создает заказ через Order Creation Manager
      2. Order Creation Manager проверяет требования и баланс
      3. Order Creation Manager создает заказ в БД
      4. Order Manager публикует заказ
      5. Social Service публикует событие social.player-order.created
      6. Realtime Gateway отправляет уведомление потенциальным исполнителям

    order_execution_flow: |
      1. Исполнитель принимает заказ
      2. Order Execution Manager проверяет требования
      3. Order Execution Manager блокирует депозиты через Economy Service
      4. Заказ начинается
      5. Order Execution Manager отслеживает прогресс
      6. Заказ завершается
      7. Order Execution Manager проверяет выполнение
      8. Order Economy Manager распределяет награды
      9. Order Reputation Manager обновляет репутацию
      10. Social Service публикует событие social.player-order.completed
      11. Realtime Gateway отправляет обновление клиентам

    auction_flow: |
      1. Заказчик создает аукцион через Auction Manager
      2. Auction Manager публикует аукцион
      3. Исполнители делают ставки
      4. Auction Manager обрабатывает ставки
      5. Аукцион закрывается
      6. Auction Manager определяет победителя
      7. Order Manager создает заказ для победителя
      8. Social Service публикует событие social.player-order.auction.closed
      9. Realtime Gateway отправляет обновление клиентам

    arbitration_flow: |
      1. Одна из сторон подает запрос на арбитраж через Arbitration Manager
      2. Arbitration Manager собирает доказательства (логи, подтверждения NPC)
      3. Arbitration Manager анализирует доказательства
      4. Arbitration Manager выносит решение
      5. Order Economy Manager исполняет решение (компенсации, штрафы)
      6. Order Reputation Manager обновляет репутацию
      7. Social Service публикует событие social.player-order.arbitration.resolved
      8. Realtime Gateway отправляет обновление клиентам

  database_structure:
    tables:
      - name: player_orders
        description: Заказы от игроков
        columns:
          - id: UUID PRIMARY KEY
          - customer_id: UUID FOREIGN KEY
          - executor_id: UUID FOREIGN KEY
          - order_type: ENUM (combat, hacking, trade, political, research, social)
          - title: VARCHAR(255)
          - description: TEXT
          - complexity: INTEGER
          - risk_level: ENUM (low, medium, high)
          - reward_amount: DECIMAL(10,2)
          - payment_model: ENUM (fixed, hourly, percentage, hybrid)
          - deadline: TIMESTAMP
          - status: ENUM (created, published, accepted, in-progress, completed, cancelled, failed)
          - format: ENUM (public, selective, private, auction)
          - created_at: TIMESTAMP
          - updated_at: TIMESTAMP

      - name: multi_executor_orders
        description: Мульти-исполнительные заказы
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - team_leader_id: UUID FOREIGN KEY
          - required_roles: JSONB
          - executor_ids: UUID[]
          - role_assignments: JSONB
          - reward_distribution: JSONB
          - created_at: TIMESTAMP
          - updated_at: TIMESTAMP

      - name: order_auctions
        description: Аукционы заказов
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - auction_type: ENUM (ascending, descending, sealed)
          - start_price: DECIMAL(10,2)
          - current_price: DECIMAL(10,2)
          - reserve_price: DECIMAL(10,2)
          - start_time: TIMESTAMP
          - end_time: TIMESTAMP
          - status: ENUM (open, closed, cancelled)
          - winner_id: UUID FOREIGN KEY
          - created_at: TIMESTAMP
          - updated_at: TIMESTAMP

      - name: auction_bids
        description: Ставки на аукционах
        columns:
          - id: UUID PRIMARY KEY
          - auction_id: UUID FOREIGN KEY
          - bidder_id: UUID FOREIGN KEY
          - bid_amount: DECIMAL(10,2)
          - bid_conditions: JSONB
          - bid_time: TIMESTAMP
          - status: ENUM (active, outbid, winning, lost)

      - name: order_options
        description: Опционы на заказы
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - option_type: ENUM (customer_cancellation, executor_cancellation, mutual_cancellation)
          - buyer_id: UUID FOREIGN KEY
          - premium: DECIMAL(10,2)
          - compensation_amount: DECIMAL(10,2)
          - purchased_at: TIMESTAMP
          - exercised_at: TIMESTAMP
          - status: ENUM (active, exercised, expired)

      - name: order_arbitration
        description: Арбитраж заказов
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - complainant_id: UUID FOREIGN KEY
          - defendant_id: UUID FOREIGN KEY
          - reason: TEXT
          - evidence: JSONB
          - status: ENUM (pending, in-review, resolved, dismissed)
          - decision: JSONB
          - resolved_at: TIMESTAMP
          - created_at: TIMESTAMP

      - name: order_insurance
        description: Страхование заказов
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - insurance_type: ENUM (mission_failure, cargo, delay, comprehensive)
          - buyer_id: UUID FOREIGN KEY
          - premium: DECIMAL(10,2)
          - coverage_amount: DECIMAL(10,2)
          - purchased_at: TIMESTAMP
          - claimed_at: TIMESTAMP
          - status: ENUM (active, claimed, expired)

      - name: order_ratings
        description: Рейтинги заказов
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - rater_id: UUID FOREIGN KEY
          - rated_id: UUID FOREIGN KEY
          - rating_type: ENUM (customer, executor)
          - completion_rate: DECIMAL(3,2)
          - quality_score: DECIMAL(3,2)
          - timeliness: DECIMAL(3,2)
          - communication: DECIMAL(3,2)
          - cooperation: DECIMAL(3,2)
          - overall_rating: DECIMAL(3,2)
          - review_text: TEXT
          - created_at: TIMESTAMP

      - name: order_reputation
        description: Репутация в заказах
        columns:
          - id: UUID PRIMARY KEY
          - character_id: UUID FOREIGN KEY
          - reputation_type: ENUM (customer, executor)
          - order_count: INTEGER
          - completion_rate: DECIMAL(5,4)
          - average_rating: DECIMAL(3,2)
          - arbitration_cases: INTEGER
          - insurance_claims: INTEGER
          - trust_level: DECIMAL(3,2)
          - last_update: TIMESTAMP

      - name: order_economy
        description: Экономика заказов
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - transaction_type: ENUM (deposit, payment, commission, refund, penalty)
          - amount: DECIMAL(10,2)
          - from_id: UUID FOREIGN KEY
          - to_id: UUID FOREIGN KEY
          - transaction_date: TIMESTAMP

      - name: order_telemetry
        description: Телеметрия заказов
        columns:
          - id: UUID PRIMARY KEY
          - order_id: UUID FOREIGN KEY
          - event_type: VARCHAR(50)
          - event_data: JSONB
          - created_at: TIMESTAMP

  integrations:
    economy_service: |
      - Проверка баланса перед созданием заказа
      - Блокировка депозитов
      - Обработка платежей
      - Расчет комиссий
      - Выплата наград
      - Обработка страховых выплат

    reputation_service: |
      - Получение репутации для доступа к заказам
      - Обновление репутации после выполнения
      - Влияние репутации на цены и доступ

    quest_service: |
      - Интеграция с квестами на основе заказов
      - Триггеры квестов при выполнении заказов
      - Обновление прогресса квестов

    world_service: |
      - Влияние заказов на мир
      - Триггеры событий на основе заказов
      - Обновление влияния фракций

    gameplay_service: |
      - Получение событий игрового процесса
      - Интеграция с системой прогрессии
      - Модификация опыта за заказы

    npc_service: |
      - Получение информации о NPC-брокерах
      - Интеграция с NPC-заказчиками
      - Проверка доступности NPC

    analytics_service: |
      - Логирование всех операций заказов
      - Сбор метрик эффективности
      - Анализ паттернов заказов
      - Мониторинг экономики заказов

    realtime_gateway: |
      - Отправка realtime обновлений заказов
      - Синхронизация аукционов
      - Уведомления о событиях

  tickrate_and_network_requirements:
    order_management:
      tickrate: Event-based (on-demand)
      network_load: |
        - Создание заказа: event-based, ~0.1-0.5 events/sec
        - Принятие заказа: event-based, ~0.1-0.3 events/sec
        - Обновление прогресса: event-based, ~0.5-1 events/sec
        - Общий трафик: ~0.3-0.8 KB/sec на игрока
      sync_strategy: Strong Consistency (ACID транзакции)

    order_auctions:
      tickrate: Event-based (on-demand)
      network_load: |
        - Создание аукциона: event-based, ~0.05-0.1 events/sec
        - Ставки: event-based, ~0.1-0.5 events/sec (пиковая)
        - Обновления аукциона: event-based, ~0.2-0.5 events/sec
        - Общий трафик: ~0.2-0.6 KB/sec на игрока
      sync_strategy: Strong Consistency

    order_execution:
      tickrate: Event-based (on-demand)
      network_load: |
        - Отслеживание прогресса: event-based, ~0.5-1 events/sec
        - Завершение заказа: event-based, ~0.1-0.3 events/sec
        - Общий трафик: ~0.2-0.5 KB/sec на игрока
      sync_strategy: Strong Consistency

    order_economy:
      tickrate: Event-based (on-demand)
      network_load: |
        - Платежи: event-based, ~0.1-0.3 events/sec
        - Комиссии: event-based, ~0.05-0.1 events/sec
        - Общий трафик: ~0.1-0.3 KB/sec на игрока
      sync_strategy: Strong Consistency (Saga Pattern для распределенных транзакций)

technical_specification:
  subtasks:
    - id: order-manager
      title: Реализация менеджера заказов
      description: |
        Реализация Order Manager с управлением заказами,
        жизненным циклом и интеграцией с другими компонентами.
      dependencies: []
      estimated_effort: 5 days

    - id: order-creation-manager
      title: Реализация менеджера создания заказов
      description: |
        Реализация Order Creation Manager с созданием заказов,
        проверкой требований и публикацией.
      dependencies: [order-manager]
      estimated_effort: 4 days

    - id: order-execution-manager
      title: Реализация менеджера выполнения заказов
      description: |
        Реализация Order Execution Manager с отслеживанием прогресса,
        проверкой выполнения и завершением заказов.
      dependencies: [order-manager]
      estimated_effort: 4 days

    - id: multi-executor-manager
      title: Реализация менеджера мульти-исполнительных заказов
      description: |
        Реализация Multi-Executor Manager с управлением командами,
        распределением ролей и наград.
      dependencies: [order-manager]
      estimated_effort: 5 days

    - id: auction-manager
      title: Реализация менеджера аукционов
      description: |
        Реализация Auction Manager с поддержкой типов аукционов,
        обработкой ставок и определением победителей.
      dependencies: [order-manager]
      estimated_effort: 5 days

    - id: options-manager
      title: Реализация менеджера опционов
      description: |
        Реализация Options Manager с покупкой опционов,
        расчетом премий и использованием опционов.
      dependencies: [order-manager]
      estimated_effort: 4 days

    - id: arbitration-manager
      title: Реализация менеджера арбитража
      description: |
        Реализация Arbitration Manager с обработкой жалоб,
        сбором доказательств и вынесением решений.
      dependencies: [order-manager]
      estimated_effort: 5 days

    - id: insurance-manager
      title: Реализация менеджера страхования
      description: |
        Реализация Insurance Manager с покупкой страховки,
        расчетом премий и обработкой страховых случаев.
      dependencies: [order-manager]
      estimated_effort: 4 days

    - id: order-rating-manager
      title: Реализация менеджера рейтингов
      description: |
        Реализация Order Rating Manager с управлением рейтингами,
        расчетом средних оценок и выдачей бейджей.
      dependencies: [order-manager]
      estimated_effort: 3 days

    - id: order-reputation-manager
      title: Реализация менеджера репутации
      description: |
        Реализация Order Reputation Manager с управлением репутацией,
        расчетом уровня доверия и влиянием на доступ.
      dependencies: [order-manager]
      estimated_effort: 4 days

    - id: order-economy-manager
      title: Реализация менеджера экономики заказов
      description: |
        Реализация Order Economy Manager с расчетом стоимости,
        обработкой платежей и комиссий.
      dependencies: [order-manager]
      estimated_effort: 4 days

    - id: order-telemetry-collector
      title: Реализация сборщика телеметрии
      description: |
        Реализация Order Telemetry Collector с логированием операций,
        сбором метрик и интеграцией с Analytics Service.
      dependencies: [order-manager]
      estimated_effort: 3 days

    - id: websocket-channels
      title: Реализация WebSocket каналов
      description: |
        Реализация WebSocket каналов для realtime обновлений заказов,
        аукционов и уведомлений.
      dependencies: [order-manager, auction-manager]
      estimated_effort: 3 days

    - id: event-bus-integration
      title: Интеграция с Event Bus
      description: |
        Реализация публикации и подписки на события через Kafka
        для всех компонентов системы заказов.
      dependencies: [order-manager]
      estimated_effort: 2 days

    - id: database-schema
      title: Создание схемы БД
      description: |
        Создание таблиц БД для заказов, мульти-исполнителей, аукционов,
        опционов, арбитража, страхования, рейтингов, репутации, экономики
        и телеметрии с миграциями Liquibase.
      dependencies: []
      estimated_effort: 4 days

diagrams:
  component_diagram: |
    ```mermaid
    graph TB
        Client[UE5 Client] --> Gateway[API Gateway]
        
        Gateway --> SocialService[Social Service<br/>8084]
        
        SocialService --> OM[Order Manager]
        SocialService --> OCM[Order Creation Manager]
        SocialService --> OEM[Order Execution Manager]
        SocialService --> MEM[Multi-Executor Manager]
        SocialService --> AM[Auction Manager]
        SocialService --> OPM[Options Manager]
        SocialService --> ARM[Arbitration Manager]
        SocialService --> IM[Insurance Manager]
        SocialService --> ORM[Order Rating Manager]
        SocialService --> ORPM[Order Reputation Manager]
        SocialService --> OEM2[Order Economy Manager]
        SocialService --> OTC[Order Telemetry Collector]
        
        OM --> OCM
        OM --> OEM
        OM --> MEM
        OM --> AM
        OM --> OPM
        OM --> ARM
        OM --> IM
        OM --> ORM
        OM --> ORPM
        OM --> OEM2
        
        SocialService --> EconomyService[Economy Service]
        SocialService --> ReputationService[Reputation Service]
        SocialService --> QuestService[Quest Service]
        SocialService --> WorldService[World Service]
        SocialService --> GameplayService[Gameplay Service]
        SocialService --> NPCService[NPC Service]
        SocialService --> AnalyticsService[Analytics Service]
        
        SocialService --> EventBus[Event Bus<br/>Kafka]
        EventBus --> RealtimeGateway[Realtime Gateway]
        
        SocialService --> DB[(Social DB)]
        
        Client --> WSOrders[WebSocket<br/>Orders]
        WSOrders --> SocialService
    ```

  order_lifecycle_diagram: |
    ```mermaid
    sequenceDiagram
        participant C as Customer
        participant OCM as Order Creation Manager
        participant OM as Order Manager
        participant E as Executor
        participant OEM as Order Execution Manager
        participant EB as Event Bus
        
        C->>OCM: Create order
        OCM->>OCM: Validate requirements
        OCM->>OM: Publish order
        OM->>EB: Publish social.player-order.created
        E->>OM: Accept order
        OM->>OEM: Start execution
        OEM->>OEM: Track progress
        OEM->>OEM: Complete order
        OEM->>EB: Publish social.player-order.completed
    ```

  auction_flow_diagram: |
    ```mermaid
    sequenceDiagram
        participant C as Customer
        participant AM as Auction Manager
        participant B1 as Bidder 1
        participant B2 as Bidder 2
        participant EB as Event Bus
        
        C->>AM: Create auction
        AM->>AM: Publish auction
        B1->>AM: Place bid
        AM->>EB: Publish social.player-order.auction.bid-placed
        B2->>AM: Place bid
        AM->>EB: Publish social.player-order.auction.bid-placed
        AM->>AM: Close auction
        AM->>EB: Publish social.player-order.auction.closed
    ```

