# Issue: #390
metadata:
  id: realtime-gateway-core
  title: Архитектура Realtime Gateway System - Основная структура
  document_type: architecture
  category: systems
  status: draft
  version: "1.0.0"
  last_updated: 2025-11-30T20:50:00Z
  owners:
    - role: architect
      contact: architect@necp.game
  tags:
    - architecture
    - realtime
    - infrastructure
    - networking
  related_systems:
    - realtime-gateway-service
    - world-service
    - gameplay-service
    - social-service
  related_documents:
    - id: backend-realtime-server-overview
      relation: references
    - id: backend-realtime-server-part1-architecture-zones
      relation: references
    - id: backend-realtime-server-part2-protocol-optimization
      relation: references
    - id: backend-realtime-server-part3-performance-profiles
      relation: references
    - id: realtime-gateway-mechanics
      relation: extends
    - id: realtime-gateway-data-flows
      relation: extends
    - id: realtime-gateway-database
      relation: extends
    - id: realtime-gateway-integrations
      relation: extends
    - id: realtime-gateway-technical
      relation: extends
  github_issue: 390
  visibility: internal
  audience:
    - architect
    - backend
    - infrastructure
    - networking
    - api-designer

summary:
  problem: |
    Требуется спроектировать полную техническую архитектуру Realtime Gateway System
    для обеспечения realtime коммуникации через WebSocket, синхронизации состояния игры
    и push-уведомлений с поддержкой зон, оптимизации протокола и профилей производительности.
  goal: |
    Создать архитектурную схему Realtime Gateway System с определением:
    - Компонентов системы (микросервисы, модули)
    - API endpoints (высокоуровнево)
    - Потоков данных и интеграций
    - Системы зон (zones)
    - Оптимизации протокола
    - Профилей производительности
    - Технического задания для реализации
  essence: |
    Полная архитектура Realtime Gateway System с поддержкой WebSocket коммуникации,
    синхронизации состояния игры, управления зонами, оптимизации протокола и профилей производительности.

architecture:
  overview: |
    Архитектура Realtime Gateway System состоит из следующих компонентов:
    1. Realtime Gateway Manager - управление системой realtime коммуникации
    2. Zone Manager - управление зонами и распределение нагрузки
    3. Connection Manager - управление WebSocket соединениями
    4. Message Router - маршрутизация сообщений по топикам
    5. State Synchronizer - синхронизация состояния игры
    6. Protocol Optimizer - оптимизация протокола и компрессия
    7. Performance Profile Manager - управление профилями производительности
    8. Interest Manager - управление областью интереса (interest management)
    9. Realtime Analytics Collector - сбор аналитики
    10. Realtime Telemetry Collector - сбор телеметрии

  microservices:
    - name: realtime-gateway-service
      port: 8086
      responsibility: |
        Обработка realtime коммуникации:
        - Управление системой realtime коммуникации
        - Управление зонами и распределение нагрузки
        - Управление WebSocket соединениями
        - Маршрутизация сообщений по топикам
        - Синхронизация состояния игры
        - Оптимизация протокола и компрессия
        - Управление профилями производительности
        - Управление областью интереса
        - Сбор аналитики
        - Сбор телеметрии
      components:
        - realtime-gateway-manager: управление системой realtime коммуникации
        - zone-manager: управление зонами и распределение нагрузки
        - connection-manager: управление WebSocket соединениями
        - message-router: маршрутизация сообщений по топикам
        - state-synchronizer: синхронизация состояния игры
        - protocol-optimizer: оптимизация протокола и компрессия
        - performance-profile-manager: управление профилями производительности
        - interest-manager: управление областью интереса
        - realtime-analytics-collector: сбор аналитики
        - realtime-telemetry-collector: сбор телеметрии
      endpoints:
        - WS /ws/game - основной WebSocket endpoint для игровых событий
        - WS /ws/zone/{zoneId}/players - WebSocket для обновлений игроков в зоне
        - WS /ws/character/{characterId}/combat - WebSocket для боевых событий персонажа
        - WS /ws/zone/{zoneId}/chat - WebSocket для чата в зоне
        - WS /ws/world/events - WebSocket для мировых событий
        - GET /api/v1/realtime/zones - список зон
        - GET /api/v1/realtime/zones/{zoneId} - информация о зоне
        - GET /api/v1/realtime/connections - статистика соединений
        - GET /api/v1/realtime/performance - метрики производительности
      websocket_channels:
        - wss://api.necp.game/ws/game - основной канал для игровых событий
        - wss://api.necp.game/ws/zone/{zoneId}/players - обновления игроков в зоне
        - wss://api.necp.game/ws/character/{characterId}/combat - боевые события персонажа
        - wss://api.necp.game/ws/zone/{zoneId}/chat - чат в зоне
        - wss://api.necp.game/ws/world/events - мировые события
      events_published:
        - realtime.connection.opened: открыто соединение
        - realtime.connection.closed: закрыто соединение
        - realtime.zone.joined: присоединение к зоне
        - realtime.zone.left: выход из зоны
        - realtime.state.synchronized: синхронизировано состояние
        - realtime.message.routed: маршрутизировано сообщение
      events_subscribed:
        - character.position-updated: обновлена позиция персонажа
        - combat.action-performed: выполнено боевое действие
        - chat.message-sent: отправлено сообщение в чат
        - world.event-occurred: произошло мировое событие

