# Issue: #334
metadata:
  id: support-ticket-database
  title: Архитектура системы тикетов поддержки - База данных
  document_type: architecture
  category: systems
  status: draft
  version: "1.1.0"
  last_updated: 2025-11-30T20:35:00Z
  github_issue: 334
  related_documents:
    - id: support-ticket-core
      relation: extends

database_structure:
  tables:
    - name: support_tickets
      description: Тикеты поддержки
      columns:
        - id: UUID PRIMARY KEY
        - ticket_number: VARCHAR(20) UNIQUE
        - character_id: UUID FOREIGN KEY
        - category: ENUM (technical, account, payment, gameplay, social, report, suggestion, other)
        - priority: ENUM (low, medium, high, critical)
        - status: ENUM (open, assigned, in_progress, waiting_for_player, resolved, closed)
        - assigned_agent_id: UUID FOREIGN KEY
        - subject: VARCHAR(255)
        - description: TEXT
        - attachments: JSONB
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP
        - first_response_at: TIMESTAMP
        - resolved_at: TIMESTAMP
        - closed_at: TIMESTAMP
        - sla_response_deadline: TIMESTAMP
        - sla_resolution_deadline: TIMESTAMP
        - rating: INTEGER
        - rating_comment: TEXT

    - name: ticket_responses
      description: Ответы на тикеты
      columns:
        - id: UUID PRIMARY KEY
        - ticket_id: UUID FOREIGN KEY
        - author_id: UUID FOREIGN KEY
        - author_type: ENUM (player, agent)
        - content: TEXT
        - attachments: JSONB
        - is_internal: BOOLEAN
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP

    - name: agent_queues
      description: Очереди агентов
      columns:
        - id: UUID PRIMARY KEY
        - agent_id: UUID FOREIGN KEY
        - queue_type: ENUM (round_robin, least_busy, skill_based, priority_based)
        - active_tickets_count: INTEGER
        - max_tickets: INTEGER
        - skills: JSONB
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP

    - name: ticket_sla_metrics
      description: Метрики SLA тикетов
      columns:
        - id: UUID PRIMARY KEY
        - ticket_id: UUID FOREIGN KEY
        - metric_type: VARCHAR(50)
        - metric_value: INTEGER
        - threshold_warning: INTEGER
        - threshold_breach: INTEGER
        - status: ENUM (ok, warning, breach)
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP

    - name: support_telemetry
      description: Телеметрия поддержки
      columns:
        - id: UUID PRIMARY KEY
        - event_type: VARCHAR(50)
        - ticket_id: UUID FOREIGN KEY
        - agent_id: UUID FOREIGN KEY
        - character_id: UUID FOREIGN KEY
        - event_data: JSONB
        - created_at: TIMESTAMP

