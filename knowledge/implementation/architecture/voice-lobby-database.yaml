# Issue: #338
metadata:
  id: voice-lobby-database
  title: Архитектура системы голосовых лобби - База данных
  document_type: architecture
  category: systems
  status: draft
  version: "1.1.0"
  last_updated: 2025-11-30T20:40:00Z
  github_issue: 338
  related_documents:
    - id: voice-lobby-core
      relation: extends

database_structure:
  tables:
    - name: voice_lobbies
      description: Голосовые лобби
      columns:
        - id: UUID PRIMARY KEY
        - type: ENUM (activity, clan, guild, raid, tournament)
        - name: VARCHAR(255)
        - description: TEXT
        - owner_id: UUID FOREIGN KEY
        - party_id: UUID FOREIGN KEY
        - guild_id: UUID FOREIGN KEY
        - clan_id: UUID FOREIGN KEY
        - voice_provider_room_id: VARCHAR(255)
        - max_participants: INTEGER
        - max_subchannels: INTEGER
        - region: VARCHAR(50)
        - language: VARCHAR(10)
        - is_public: BOOLEAN
        - is_active: BOOLEAN
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP
        - closed_at: TIMESTAMP

    - name: lobby_participants
      description: Участники лобби
      columns:
        - id: UUID PRIMARY KEY
        - lobby_id: UUID FOREIGN KEY
        - character_id: UUID FOREIGN KEY
        - role: ENUM (leader, commander, party_leader, officer, member)
        - subchannel_id: UUID FOREIGN KEY
        - is_muted: BOOLEAN
        - is_deafened: BOOLEAN
        - joined_at: TIMESTAMP
        - left_at: TIMESTAMP

    - name: lobby_subchannels
      description: Подканалы лобби
      columns:
        - id: UUID PRIMARY KEY
        - lobby_id: UUID FOREIGN KEY
        - name: VARCHAR(255)
        - type: ENUM (main, role_based, commander, party)
        - voice_provider_channel_id: VARCHAR(255)
        - max_participants: INTEGER
        - role_restrictions: JSONB
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP

    - name: party_finder_searches
      description: Поиски групп
      columns:
        - id: UUID PRIMARY KEY
        - character_id: UUID FOREIGN KEY
        - role: VARCHAR(50)
        - rating: INTEGER
        - activity: VARCHAR(50)
        - region: VARCHAR(50)
        - language: VARCHAR(10)
        - min_level: INTEGER
        - max_level: INTEGER
        - status: ENUM (searching, found, cancelled, timeout)
        - created_at: TIMESTAMP
        - updated_at: TIMESTAMP
        - found_at: TIMESTAMP

    - name: lobby_telemetry
      description: Телеметрия лобби
      columns:
        - id: UUID PRIMARY KEY
        - event_type: VARCHAR(50)
        - lobby_id: UUID FOREIGN KEY
        - character_id: UUID FOREIGN KEY
        - event_data: JSONB
        - created_at: TIMESTAMP

