metadata:
  id: backend-announcement-system
  title: 'Announcement System — Система объявлений'
  document_type: implementation
  category: backend
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-07T23:25:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-07T02:30:00Z
  owners:
    - role: liveops_lead
      contact: operations@necp.game
  tags:
    - announcements
    - live-ops
    - communications
  topics:
    - player-engagement
    - messaging
  related_systems:
    - admin-api
    - notification-service
    - player-service
  related_documents:
    - id: backend-admin-tools-core
      relation: aligns
  source: shared/docs/knowledge/implementation/backend/announcement/announcement-system.md
  visibility: internal
  audience:
    - live-ops
    - backend
    - communications
  risk_level: medium
review:
  chain:
    - role: liveops_lead
      reviewer: ''
      reviewed_at: 2025-11-07T02:30:00Z
      status: approved
  next_actions: []
summary:
  problem: Требовалось описать единую платформу объявлений для новостей, патчноутов и событий, доступную всем игрокам.
  goal: Сформировать архитектуру хранения, таргетинга и много канальной доставки объявлений.
  essence: Документ описывает модель данных, сервисы публикации, каналы доставки и учёт прочтений.
  key_points:
    - Таблицы `announcements` и `player_announcement_reads` управляют контентом и статусами прочтения.
    - Поддерживаются типы объявлений и приоритеты, влияющие на способ отображения.
    - Delivery Service обеспечивает popup, push, email и новостную ленту с таргетингом.
    - Patch Notes оформляются отдельным сервисом с вложениями и модальными окнами.
content:
  sections:
    - id: system_overview
      title: Архитектура и поток публикации
      body: |
        Админ создаёт объявление, выбирает расписание публикации и каналы доставки. Сервис фиксирует статус и публикацию, а
        система учёта прочтений отслеживает взаимодействия игроков.
      mechanics_links: []
      assets: []
    - id: data_model
      title: Схемы данных
      body: |
        Таблица `announcements` хранит контент, таргетинг, приоритет, медиа и расписание публикации. `player_announcement_reads`
        учитывает прочтения, скрытие, клики и используется для аналитики и повторной доставки.
      mechanics_links: []
      assets: []
    - id: types_priority
      title: Типы и приоритеты
      body: |
        Система поддерживает типы (GAME_NEWS, PATCH_NOTES, MAINTENANCE, EVENT, PROMOTION, COMMUNITY, EMERGENCY) и приоритеты от
        LOW до CRITICAL. DisplayStyle задаёт способ отображения: NEWS_FEED, POPUP, MODAL, BANNER или TOAST.
      mechanics_links: []
      assets: []
    - id: publish_workflow
      title: Публикация и планирование
      body: |
        Сервис публикаций формирует статусы DRAFT, SCHEDULED или PUBLISHED, сохраняет расписание и при необходимости запускает
        немедленную доставку. Все действия логируются и доступны для аудита.
      mechanics_links: []
      assets: []
    - id: delivery_channels
      title: Каналы доставки
      body: |
        Delivery Service выбирает аудиторию и доставляет объявления через in-game popup, email, push-уведомления и новостную ленту.
        Для срочных сообщений автоматически активируются push и email каналы.
      mechanics_links: []
      assets: []
    - id: patch_notes
      title: Patch Notes и новостная лента
      body: |
        PatchNotesService формирует модальные объявления с версиями, списками улучшений и известных проблем. JSON-пример описывает
        структуру новостной ленты и поля, используемые фронтендом.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml#backend-announcement-system
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-07
    author: ai_brain_manager
    changes: Описана серверная система объявлений, модель данных, каналы доставки и патчноуты.
validation:
  checksum: ''
  schema_version: '1.0'

