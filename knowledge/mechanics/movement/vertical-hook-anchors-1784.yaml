# Issue: #1784
metadata:
  id: movement-vertical-hook-anchors-1784
  title: "Вертикалка: крюк-линии/якоря (STR/AGI/END/INT/TECH)"
  document_type: mechanics
  category: movement
  status: balanced
  version: "2.0.0"
  last_updated: 2026-01-12T18:15:00Z
  concept_approved: true
  concept_reviewed_at: "2026-01-12T18:15:00Z"
  owners:
    - role: movement_designer
      contact: movement@necp.game
  tags:
    - movement
    - traversal
    - grappling
  topics:
    - strength
    - agility
    - endurance
    - tech
    - intelligence
  related_systems:
    - gameplay-service
    - physics-engine
    - analytics-service
  visibility: internal
  audience:
    - gameplay
    - movement
    - analytics
  risk_level: medium
summary:
  problem: "Нужен крюк-якорь: дальность от STR, скорость подтягивания от AGI, шанс обрыва падает с END, жизнь якоря продлевают INT/TECH."
  goal: "Определить формулы дальности/скорости/обрыва/TTL, боезапас/кд и риски."
  essence: "Граппл: STR даёт бросок, AGI — подтягивание, END снижает обрыв, INT/TECH продлевают TTL; шум и риск падения."
content:
  sections:
    - id: parameters
      title: "Параметры"
      body: |
        • Дальность броска: base 12 м + STR*0.5 м (кап 25 м).  
        • Скорость подтягивания: base 7 м/с + AGI*0.15 м/с (кап 13 м/с).  
        • TTL якоря: base 6с + (INT+TECH)*0.35с (кап 12с).  
        • Шанс обрыва под нагрузкой: base 18% – END*1.4% (кап 4%).  
        • Боезапас 3–4, кд 10–14с, шумовой импульс на броске.
      mechanics_links: [ ]
      assets: [ ]
    - id: risks
      title: "Риски и ограничения"
      body: |
        • Обрыв под огнём/перегрузкой → падение (END снижает урон).  
        • Шум привлекает патрули; высокий угол/бросок в металл повышает шанс рикошета (обрыв +5%).  
        • Нельзя цепляться за нестабильные поверхности (glass/fragile).
      mechanics_links: [ ]
      assets: [ ]
    - id: ux
      title: "UX"
      body: |
        • Превью дуги/дальности, индикатор прочности.  
        • Быстрый ресет якоря (отмена) с кд.  
        • Подсказка по усталости троса при многократном использовании.
      mechanics_links: [ ]
      assets: [ ]
    - id: telemetry
      title: "Телеметрия"
      body: |
        • grapples_thrown, avg_distance, break_events, fall_damage_events.  
        • ttl_used, noise_alerts, cancel_rate.  
        • Цели: break_events <8% mid-tier, avg_distance ~16–18 м.
      mechanics_links: [ ]
      assets: [ ]
    - id: core_mechanics
      title: "Основная механика hook-anchors"
      body: |
        ### Концепция:
        Hook-Anchor system - это grappling hook механика, позволяющая игрокам бросать якорь в окружающую среду
        и подтягиваться к нему. Механика масштабируется с пятью основными статами: STR влияет на дальность броска,
        AGI на скорость подтягивания, END на устойчивость якоря, INT и TECH на время жизни якоря.

        ### Как работает:
        - Игрок целится и бросает якорь в поверхность
        - При успешном захвате якорь фиксируется и игрок начинает подтягиваться
        - Якорь имеет ограниченное время жизни и может оборваться под нагрузкой
        - Механика сочетает вертикальную мобильность с рисками и тактическими решениями

        ### Стратегические применения:
        - **Вертикальная мобильность**: Быстрое преодоление высоты и расстояний
        - **Тактическое преимущество**: Неожиданные маневры и позиционирование
        - **Экстренное спасение**: Выход из опасных ситуаций
        - **Командная синергия**: Помощь союзникам в достижении позиций
      mechanics_links:
        - mechanics/movement/traversal-system.yaml
        - mechanics/combat/mobility-mechanics.yaml
      assets: []

    - id: stat_scaling_formulas
      title: "Формулы масштабирования статов"
      body: |
        ### STR (Сила) - Дальность броска:
        ```
        base_throw_distance = 12.0  # метров базовой дальности
        str_distance_mult = 0.5      # метры на единицу STR
        max_throw_distance = 25.0    # максимальная дальность

        throw_distance = min(base_throw_distance + (STR * str_distance_mult), max_throw_distance)
        ```

        ### AGI (Ловкость) - Скорость подтягивания:
        ```
        base_reel_speed = 7.0     # м/с базовой скорости
        agi_speed_mult = 0.15     # м/с на единицу AGI
        max_reel_speed = 13.0     # максимальная скорость

        reel_speed = min(base_reel_speed + (AGI * agi_speed_mult), max_reel_speed)
        ```

        ### END (Выносливость) - Устойчивость якоря:
        ```
        base_break_chance = 18.0  # % базовый шанс обрыва
        end_break_reduction = 1.4 # % снижения на единицу END
        min_break_chance = 4.0   # минимальный шанс

        break_chance = max(base_break_chance - (END * end_break_reduction), min_break_chance)
        ```

        ```
        fall_damage_reduction = END * 1.8  # % снижения урона падения
        max_damage_reduction = 65.0        # максимальное снижение

        damage_reduction = min(fall_damage_reduction, max_damage_reduction)
        ```

        ### INT (Интеллект) и TECH (Технологии) - Время жизни якоря:
        ```
        base_anchor_lifetime = 6.0        # секунд базового времени
        int_tech_lifetime_mult = 0.35     # секунды на единицу (INT+TECH)
        max_anchor_lifetime = 12.0        # максимальное время

        anchor_lifetime = min(base_anchor_lifetime + ((INT + TECH) * int_tech_lifetime_mult), max_anchor_lifetime)
        ```

        ```
        cooldown = 12.0       # секунд базового кд
        int_tech_cd_reduction = 0.25  # секунды на единицу (INT+TECH)
        min_cooldown = 6.0   # минимальный кд

        cooldown = max(cooldown - ((INT + TECH) * int_tech_cd_reduction), min_cooldown)
        ```

        ### Примеры расчета:
        - **Новичок** (STR:10, AGI:10, END:10, INT:10, TECH:10): 17м дальность, 8.5м/с скорость, 16% обрыв, 9.5с TTL
        - **Средний** (STR:20, AGI:20, END:20, INT:20, TECH:20): 22м дальность, 10м/с скорость, 10% обрыв, 13с TTL
        - **Продвинутый** (STR:30, AGI:30, END:30, INT:30, TECH:30): 27м дальность, 11.5м/с скорость, 4% обрыв, 16.5с TTL
        - **Максимум** (STR:40, AGI:40, END:40, INT:40, TECH:40): 32м дальность, 13м/с скорость, 4% обрыв, 20с TTL
      mechanics_links:
        - mechanics/stats/scaling-formulas.yaml
        - mechanics/movement/balance-calculations.yaml
      assets: []

    - id: grappling_physics
      title: "Физика и взаимодействие grappling hook"
      body: |
        ### Физическая модель:
        - **Баллистическая траектория**: Реалистическая дуга полета якоря
        - **Динамическое крепление**: Автоматическое определение точек крепления
        - **Реактивное движение**: Физическая реакция на подтягивание игрока
        - **Материальные свойства**: Различная устойчивость разных поверхностей

        ### Взаимодействие с окружением:
        - **Поверхности крепления**: Стены, потолки, выступы, конструкции
        - **Материальные модификаторы**: Металл vs дерево vs бетон
        - **Динамические объекты**: Возможность цепляться за движущиеся объекты
        - **Экстремальные условия**: Влияние погоды на траекторию и устойчивость

        ### Игровые взаимодействия:
        - **PvP элементы**: Возможность саботажа чужих якорей
        - **Командная координация**: Синхронизированные подтягивания
        - **Предметы и способности**: Комбинация с другими механиками передвижения
        - **Экономические аспекты**: Стоимость боеприпасов и ремонта

        ### Безопасность и ограничения:
        - **Максимальная нагрузка**: Ограничение скорости и веса игрока
        - **Высотные ограничения**: Предотвращение выхода за пределы карты
        - **Энергетические барьеры**: Защита от спама в ограниченных пространствах
        - **Временные ограничения**: TTL предотвращает перманентные структуры
      mechanics_links:
        - mechanics/physics/grappling-physics.yaml
        - mechanics/environment/interaction-system.yaml
      assets: []

    - id: risk_management_system
      title: "Система рисков и последствий"
      body: |
        ### Механизмы риска:
        - **Накопление нагрузки**: Увеличение шанса обрыва при длительном использовании
        - **Внешние воздействия**: Огонь противника, взрывы, повреждения окружающей среды
        - **Материальные факторы**: Слабые поверхности, нестабильные конструкции
        - **Человеческий фактор**: Усталость, неправильное использование

        ### Физические последствия:
        - **Падение при обрыве**: Урон от высоты с модификаторами от END
        - **Травматические повреждения**: Дополнительный урон от скорости падения
        - **Оглушение**: Временная дезориентация при критических обрывах
        - **Моральный урон**: Психологическое воздействие на игрока

        ### Стратегические последствия:
        - **Потеря преимущества**: Упущенные тактические возможности
        - **Временные штрафы**: Увеличенный кд после обрыва
        - **Репутационные потери**: Неудачи влияют на командный рейтинг
        - **Экономические затраты**: Потеря боеприпасов и ремонт

        ### Меры предотвращения:
        - **Мониторинг состояния**: Индикаторы прочности якоря и поверхности
        - **Аварийное отключение**: Возможность прервать подтягивание
        - **Защитные модификации**: Улучшения снижающие риск обрыва
        - **Тренировочные режимы**: Безопасное обучение в тренировочных зонах
      mechanics_links:
        - mechanics/combat/risk-assessment.yaml
        - mechanics/movement/safety-mechanics.yaml
      assets: []

    - id: user_interface_design
      title: "Пользовательский интерфейс"
      body: |
        ### Основные индикаторы:
        - **Статус якоря**: Прочность, время жизни, нагрузка
        - **Зона захвата**: Предиктивное отображение возможных точек крепления
        - **Параметры броска**: Дальность, траектория, точность
        - **Предупреждения**: Уведомления о рисках и приближающемся обрыве

        ### Визуальные эффекты:
        - **Траектория броска**: Полупрозрачная дуга показывающая путь якоря
        - **Состояние якоря**: Цветовые индикаторы прочности и времени жизни
        - **Эффекты подтягивания**: Частицы и анимации движения
        - **Звуковые сигналы**: Аудио обратная связь для действий

        ### Аудио сопровождение:
        - **Звуки броска**: Характерный звук запуска якоря
        - **Звуки крепления**: Подтверждение успешного захвата поверхности
        - **Звуки подтягивания**: Реалистичные звуки движения по тросу
        - **Предупреждающие сигналы**: Звуки при приближении к обрыву

        ### Настройки интерфейса:
        - **Кастомизация**: Возможность настройки внешнего вида индикаторов
        - **Уровень детализации**: Настройка количества отображаемой информации
        - **Акселерометрия**: Вибрация для тактильной обратной связи
        - **Доступность**: Настройки для игроков с ограниченными возможностями
      mechanics_links:
        - mechanics/ui/grappling-interface.yaml
        - mechanics/ui/visual-effects.yaml
      assets: []

    - id: balance_considerations
      title: "Балансовые соображения"
      body: |
        ### Риск-вознаграждение баланс:
        - **Высокая мобильность**: Значительное преимущество в вертикальном перемещении
        - **Ограниченные ресурсы**: Высокая стоимость боеприпасов ограничивает использование
        - **Риск обрыва**: Возможность временной потери контроля добавляет напряжение
        - **Зависимость от статов**: Требует инвестиций в STR/AGI для эффективности

        ### Прогрессия и развитие:
        - **Обучение механике**: Постепенное введение сложности через уровни
        - **Улучшение якоря**: Модификации снижающие риски и улучшающие параметры
        - **Навык игрока**: Улучшение контроля через опыт использования
        - **Специализация**: Разные билды фокусирующиеся на разных аспектах

        ### Метагейм факторы:
        - **Мап дизайн**: Размещение точек крепления влияет на стратегию
        - **Баланс классов**: Влияние на эффективность разных специализаций
        - **Экономика**: Стоимость боеприпасов влияет на частоту использования
        - **Контент дизайн**: Интеграция в квесты и миссии

        ### Социальные аспекты:
        - **Командная игра**: Возможность помощи союзникам в сложных ситуациях
        - **Конкуренция**: PvP применение для тактических преимуществ
        - **Показательность**: Визуальные эффекты демонстрирующие мастерство
        - **Сообщество**: Обмен техниками и стратегиями использования
      mechanics_links:
        - mechanics/balance/risk-reward-analysis.yaml
        - mechanics/gameplay/progression-systems.yaml
      assets: []

    - id: telemetry_analytics
      title: "Телеметрия и аналитика"
      body: |
        ### Метрики использования:
        - **anchors_thrown**: Количество бросков якорей в сессии/матче
        - **successful_hooks**: Процент успешных захватов поверхности
        - **average_lifetime**: Среднее время жизни активных якорей
        - **break_events**: Количество обрывов и их причины

        ### Метрики производительности:
        - **reel_distance**: Средняя дистанция подтягивания
        - **reel_speed_achieved**: Достигнутая скорость подтягивания
        - **fall_damage_prevented**: Предотвращенный урон от падений
        - **surface_type_distribution**: Распределение по типам поверхностей

        ### Метрики вовлеченности:
        - **session_usage**: Время использования grappling в сессии
        - **learning_curve**: Скорость освоения механики новыми игроками
        - **strategic_usage**: Применение в составе тактических комбинаций
        - **replay_value**: Мотивация к повторному прохождению контента

        ### Метрики баланса:
        - **stat_distribution**: Распределение игроков по уровням статов
        - **usage_frequency**: Как часто используется в разных типах контента
        - **situational_effectiveness**: Эффективность в разных сценариях
        - **player_satisfaction**: Удовлетворенность механикой

        ### Аналитические цели:
        - Оптимизация формул для лучшего баланса между рисками и преимуществами
        - Выявление проблемных ситуаций и багов в физике grappling
        - Улучшение UX на основе данных об обрывах и использовании
        - Поддержание справедливой конкуренции в PvP сценариях
      mechanics_links:
        - mechanics/analytics/grappling-telemetry.yaml
        - mechanics/analytics/balance-metrics.yaml
      assets: []

    - id: integration_implementation
      title: "Интеграция и реализация"
      body: |
        ### Системные интеграции:
        - **Физический движок**: Реализация баллистической траектории и крепления
        - **Движение система**: Интеграция с системой передвижения игрока
        - **Повреждения система**: Обработка падений и травм от обрывов
        - **Инвентарь система**: Управление боеприпасами и апгрейдами

        ### Технические требования:
        - **Производительность**: Минимальное влияние на FPS при активном использовании
        - **Сетевая синхронизация**: Корректная репликация якорей для всех игроков
        - **Физическая точность**: Реалистичное поведение бросков и подтягиваний
        - **Масштабируемость**: Поддержка множественных одновременных якорей

        ### Тестирование и валидация:
        - **Физическое тестирование**: Проверка реалистичности траекторий бросков
        - **Балансовое тестирование**: Валидация формул и рисков обрыва
        - **Интеграционное тестирование**: Проверка совместимости с другими системами
        - **Стресс-тестирование**: Производительность при множественных бросках

        ### Мониторинг и поддержка:
        - **Реал-тайм метрики**: Отслеживание использования и проблем
        - **Игрок обратная связь**: Сбор отзывов о балансе и UX
        - **Балансовые патчи**: Регулярные корректировки на основе данных
        - **Техническая поддержка**: Помощь с проблемами grappling hook
      mechanics_links:
        - mechanics/systems/grappling-integration.yaml
        - mechanics/testing/hook-anchor-validation.yaml
      assets: []
appendix:
  glossary:
    - term: "Hook-Anchor System"
      definition: "Система grappling hook для вертикального передвижения, позволяющая бросать якорь и подтягиваться к поверхностям"
    - term: "Anchor Break Chance"
      definition: "Вероятность обрыва якоря под нагрузкой, снижается со статом END"
    - term: "Reel Speed"
      definition: "Скорость подтягивания к якорю, масштабируется со статом AGI"
    - term: "Anchor Lifetime"
      definition: "Время жизни зафиксированного якоря, продлевается статами INT и TECH"
    - term: "Throw Distance"
      definition: "Максимальная дальность броска якоря, зависит от стата STR"
  references:
    - id: mechanics/movement/traversal-system
      title: "Система передвижения и преодоления препятствий"
      type: document
    - id: mechanics/combat/mobility-mechanics
      title: "Механики мобильности в бою"
      type: document
    - id: mechanics/stats/scaling-formulas
      title: "Формулы масштабирования характеристик"
      type: document
    - id: mechanics/physics/grappling-physics
      title: "Физическая модель grappling hook"
      type: document
    - id: mechanics/analytics/grappling-telemetry
      title: "Телеметрия систем grappling"
      type: document
  decisions:
    - rationale: "Hook-anchor добавляет вертикальность и риск в мобильность"
      impact: "Увеличивает стратегическую глубину, поощряет осторожное планирование маршрутов"
    - rationale: "Многостатовая система предотвращает доминирование одного билда"
      impact: "Поощряет разнообразие специализаций и сбалансированное развитие персонажа"
    - rationale: "Риски обрыва добавляют напряжение и тактическую глубину"
      impact: "Балансирует мощную мобильность с потенциальными последствиями"
implementation:
  github_issue: 1784
  needs_task: false
  queue_reference: [ ]
  blockers: [ ]
history:
  - version: "1.0.0"
    date: 2025-12-12
    author: movement_team
    changes: "Крюк-якорь: формулы STR/AGI/END/INT/TECH, риски, UX и телеметрия."
validation:
  checksum: ""
  schema_version: "1.0"

