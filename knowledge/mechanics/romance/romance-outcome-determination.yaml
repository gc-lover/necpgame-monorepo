metadata:
  id: romance-outcome-determination
  title: Определение исходов романтических отношений NECPGAME
  document_type: mechanics
  category: romance
  status: draft
  version: '1.0.0'
  last_updated: 2025-12-20T07:05:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - romance
    - outcomes
    - determination
    - social
  topics:
    - relationship-mechanics
    - outcome-calculation
  related_systems:
    - romance-service
    - analytics-service
    - character-service
  related_documents:
    - id: romance-relationship-progression
      relation: references
    - id: romance-narrative-branching
      relation: complements
  source: shared/docs/knowledge/mechanics/romance/romance-outcome-determination.md
  visibility: internal
  audience:
    - concept
    - narrative
    - systems
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: [ ]
summary:
  problem: Исходы романтических отношений определялись субъективно без формализованных критериев и вероятностей.
  goal: Создать алгоритмическую систему определения исходов отношений на основе RP, событий и контекста.
  essence: Исход отношений рассчитывается через взвешенные факторы с учетом вероятностей и случайных элементов.
  key_points:
    - Многофакторный алгоритм определения исхода
    - Система вероятностей с модификаторами
    - Учет долгосрочных и краткосрочных факторов
    - Баланс между предсказуемостью и неожиданностью
content:
  sections:
    - id: outcome_calculation_overview
      title: Обзор расчета исходов
      body: |
        Определение исхода отношений использует комплексный алгоритм:

        **Основные компоненты:**
        - RP (Relationship Points) - базовый показатель
        - История взаимодействий - паттерны поведения
        - Внешние факторы - события и контекст
        - Случайные элементы - для непредсказуемости

        **Процесс расчета:**
        1. Сбор всех релевантных данных
        2. Применение весовых коэффициентов
        3. Расчет базовой вероятности
        4. Применение модификаторов
        5. Определение финального исхода

        **Частота расчета:**
        - При достижении критических порогов RP
        - После значимых событий
        - По запросу игрока (проверка совместимости)
        - В ключевые сюжетные моменты
      mechanics_links:
        - mechanics/social/reputation-formulas.yaml
      assets: [ ]

    - id: base_probability_formula
      title: Базовая формула вероятности
      body: |
        Базовая вероятность исхода рассчитывается по шкале 0-100:

        **Для положительных исходов:**
        ```
        positiveOutcomeProb = min(100, max(0, (currentRP + 2000) / 40))
        ```

        **Для нейтральных исходов:**
        ```
        neutralOutcomeProb = min(100, max(0, 50 + (currentRP / 20)))
        ```

        **Для отрицательных исходов:**
        ```
        negativeOutcomeProb = min(100, max(0, (-currentRP + 1000) / 15))
        ```

        **Нормализация вероятностей:**
        ```
        totalProb = positiveProb + neutralProb + negativeProb
        normalizedProb = eachProb / totalProb * 100
        ```

        **Факторы, влияющие на базовую вероятность:**
        - Текущий уровень RP
        - Стадия отношений
        - Время существования отношений
        - Количество разрешенных конфликтов
      mechanics_links:
        - mechanics/romance/romance-relationship-progression.yaml
      assets: [ ]

    - id: historical_factors
      title: Исторические факторы
      body: |
        Прошлое отношений значительно влияет на возможные исходы:

        **Положительные исторические факторы:**
        - Количество совместно пережитых кризисов (+10-30%)
        - Регулярные положительные взаимодействия (+5-20%)
        - Выполненные обещания и обязательства (+15-40%)
        - Совместные достижения и успехи (+10-25%)

        **Отрицательные исторические факторы:**
        - История предательств (-20-60%)
        - Не разрешенные конфликты (-10-35%)
        - Нарушенные обещания (-15-45%)
        - Длительные периоды без взаимодействия (-5-25%)

        **Нейтральные исторические факторы:**
        - Общее время знакомства (±5-15%)
        - Количество проведенного времени вместе (±5-20%)
        - Стабильность паттернов взаимодействия (±10-30%)

        **Расчет исторического модификатора:**
        ```
        historicalModifier = sum(weighted_factors) / total_interactions
        ```
      mechanics_links:
        - mechanics/social/reputation-decay-recovery.yaml
      assets: [ ]

    - id: contextual_modifiers
      title: Контекстуальные модификаторы
      body: |
        Текущие обстоятельства влияют на вероятность исходов:

        **Временные модификаторы:**
        - Недавние положительные события (+20-50%)
        - Недавние конфликты (-30-70%)
        - Текущая эмоциональная атмосфера (±10-40%)
        - Время суток и локация (±5-15%)

        **Ситуационные модификаторы:**
        - Наличие внешних угроз (+15-35% к сплочению)
        - Экономическая стабильность (±10-25%)
        - Здоровье и безопасность (±5-20%)
        - Социальный статус (±10-30%)

        **Персональные модификаторы:**
        - Уровень стресса персонажей (-10-40%)
        - Доступность ресурсов (±5-15%)
        - Личные цели и приоритеты (±10-25%)
        - Внешнее давление (±15-35%)

        **Расчет контекстуального модификатора:**
        ```
        contextModifier = average(contextual_factors) * time_decay_factor
        ```
      mechanics_links:
        - mechanics/world/dynamic-events-system.yaml
      assets: [ ]

    - id: personality_compatibility
      title: Совместимость личностей
      body: |
        Личностные черты определяют долгосрочную совместимость:

        **Совместимые комбинации:**
        - Экстраверт + Экстраверт: +15% к положительным исходам
        - Доброжелательный + Доброжелательный: +20% к гармонии
        - Стабильный + Стабильный: +25% к долговечности
        - Открытый + Любопытный: +10% к развитию

        **Проблемные комбинации:**
        - Импульсивный + Консервативный: -15% к стабильности
        - Агрессивный + Пассивный: -20% к гармонии
        - Нейротик + Стабильный: -10% к эмоциональной связи
        - Конфликтный + Конфликтный: -25% к мирному разрешению

        **Киберпанк-специфические факторы:**
        - Совместимые импланты: +10-30%
        - Противоположные модификации: -15-40%
        - Общие технологические предпочтения: +5-20%
        - Разные уровни хрома: ±5-25%
      mechanics_links:
        - mechanics/romance/romance-attraction-algorithms.yaml
      assets: [ ]

    - id: external_influences
      title: Внешние влияния
      body: |
        Факторы мира Night City влияют на романтические исходы:

        **Корпоративные влияния:**
        - Корпоративные интриги (-20-50% к стабильности)
        - Карьерные конфликты (-10-30% к гармонии)
        - Экономические кризисы (-15-40% к долговечности)
        - Корпоративные традиции (±10-25%)

        **Уличные влияния:**
        - Бандитские войны (+10-30% к страсти, -20-40% к безопасности)
        - Уличные традиции (+5-20% к уникальности)
        - Социальные нормы (±5-15% к принятию)
        - Экономическая нестабильность (-10-35% к планированию)

        **Технологические влияния:**
        - Новые импланты (±15-40% к изменениям)
        - Кибернетические сбои (-20-60% к стабильности)
        - Виртуальная реальность (±10-30% к близости)
        - Хакерские атаки (-30-70% к доверию)

        **Расчет внешнего влияния:**
        ```
        externalInfluence = sum(active_external_factors) * intensity_modifier
        ```
      mechanics_links:
        - mechanics/world/locations-night-city.yaml
      assets: [ ]

    - id: random_elements
      title: Случайные элементы
      body: |
        Непредсказуемость добавляет глубину и переигрываемость:

        **Типы случайных элементов:**
        - **Критические события:** Редкие, но значимые повороты (±50-200% влияния)
        - **Случайные встречи:** Неожиданные взаимодействия (±10-30% влияния)
        - **Внешние вмешательства:** Третьи стороны (±15-45% влияния)
        - **Личные откровения:** Случайные раскрытия (±20-60% влияния)

        **Распределение вероятностей:**
        - 70% - малые случайные события (±5-15%)
        - 25% - средние события (±15-35%)
        - 5% - критические события (±35-100%)

        **Баланс предсказуемости:**
        - Базовые исходы определяются детерминированно
        - Случайные элементы добавляют вариативность
        - Игрок может влиять на вероятность через выборы
        - Система логирует все случайные события

        **Механика случайности:**
        ```
        randomFactor = random(0, 100) * player_luck_modifier
        if randomFactor > threshold then apply_random_event()
        ```
      mechanics_links:
        - mechanics/meta/procedural-generation-algorithms.yaml
      assets: [ ]

    - id: outcome_types_and_consequences
      title: Типы исходов и их последствия
      body: |
        Возможные исходы отношений с детальными последствиями:

        **Положительные исходы (30-70% вероятность):**
        - **Гармоничный союз:** +1000 RP, совместные бонусы, сюжетные преимущества
        - **Страстная любовь:** +800 RP, повышенная эмоциональность, уникальные события
        - **Надежное партнерство:** +600 RP, практические бонусы, стабильность
        - **Легендарная история:** +1200 RP, влияние на город, эпические последствия

        **Нейтральные исходы (20-40% вероятность):**
        - **Стабильная дружба:** 0 RP, социальные бонусы, без романтики
        - **Профессиональное сотрудничество:** -200 RP, рабочие преимущества
        - **Воспоминания:** -500 RP, эмоциональное завершение, новые возможности

        **Отрицательные исходы (10-30% вероятность):**
        - **Болезненный разрыв:** -1000 RP, эмоциональные дебаффы, социальные последствия
        - **Вражда:** -1500 RP, конфликтные взаимодействия, фракционные изменения
        - **Трагедия:** -2000 RP, долгосрочные последствия, сюжетные изменения

        **Долгосрочные последствия:**
        - Изменение репутации в социальных кругах
        - Доступ к новым/потеря старых контактов
        - Влияние на основной сюжет и побочные квесты
        - Психологические эффекты на персонажа игрока
      mechanics_links:
        - mechanics/romance/romance-narrative-branching.yaml
      assets: [ ]

    - id: outcome_timing_and_triggers
      title: Тайминг и триггеры определения исходов
      body: |
        Когда и как определяются исходы отношений:

        **Автоматические триггеры:**
        - RP достигает критических значений (±2000, ±4000)
        - Проходит значительное время без взаимодействия (30+ дней)
        - Происходят ключевые жизненные события
        - Изменяются фундаментальные обстоятельства

        **Ручные проверки:**
        - Игрок может запросить "проверку совместимости"
        - Регулярные автоматические оценки (еженедельно)
        - Перед важными решениями влияющими на отношения

        **Временные рамки:**
        - Краткосрочные исходы: немедленное определение
        - Среднесрочные: в течение 24 часов игрового времени
        - Долгосрочные: в течение 3-7 дней игрового времени

        **Отмена и пересмотр:**
        - Возможность оспорить отрицательные исходы
        - Система апелляций через специальные квесты
        - Возможность изменения через значимые действия
        - Временные "испытательные сроки" для сомнительных исходов
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
      assets: [ ]

    - id: implementation_and_balance
      title: Реализация и баланс
      body: |
        Технические аспекты системы определения исходов:

        **Архитектура реализации:**
        - Romance Service отвечает за расчеты
        - Analytics Service предоставляет исторические данные
        - Character Service управляет личностными факторами
        - Notification Service обрабатывает оповещения

        **Баланс и тестирование:**
        - A/B тестирование вероятностей на разных группах игроков
        - Анализ retention после различных исходов
        - Мониторинг эмоционального отклика игроков
        - Регулярная корректировка весовых коэффициентов

        **Производительность:**
        - Кэширование расчетов на 1-24 часа
        - Асинхронная обработка сложных определений
        - Оптимизация запросов к историческим данным
        - Масштабируемость для тысяч активных отношений

        **Мониторинг и аналитика:**
        - Отслеживание распределения исходов
        - Анализ влияния на вовлеченность игроков
        - Метрики удовлетворенности отношениями
        - Корреляция с общими метриками игры
      mechanics_links:
        - mechanics/social/social-service-architecture.yaml
      assets: [ ]
appendix:
  glossary:
    - term: "RP (Relationship Points)"
      definition: "Очки отношений, основной фактор определения исхода"
    - term: "Contextual Modifiers"
      definition: "Модификаторы на основе текущих обстоятельств и ситуации"
    - term: "Historical Factors"
      definition: "Факторы на основе истории отношений и взаимодействий"
  references:
    - "Relationship Outcome Prediction Models"
    - "Game Design Patterns for Romance Systems"
  decisions:
    - date: 2025-12-20
      decision: "Многофакторная модель с 30-40% случайным элементом"
      rationale: "Баланс между предсказуемостью и неожиданностью для лучшего игрового опыта"
  implementation:
    needs_task: true
    github_issue: 82
    queue_reference:
      - shared/trackers/queues/concept/queued.yaml
    blockers: [ ]
history:
  - version: '1.0.0'
    date: 2025-12-20
    author: Idea Writer Agent
    changes: Создана система определения исходов романтических отношений с многофакторным алгоритмом и балансом случайности
validation:
  checksum: ''
  schema_version: '1.0'

