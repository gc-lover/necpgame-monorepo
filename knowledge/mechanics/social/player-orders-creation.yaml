# Issue: #65
metadata:
  id: player-orders-creation
  title: 'Система заказов — Создание заказа'
  document_type: mechanics
  category: social
  status: ready
  version: '2.0.0'
  last_updated: 2025-12-27T16:40:00Z
  concept_approved: true
  concept_reviewed_at: 2025-12-27T16:40:00Z
  concept_reviewed_at: ''
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - player-orders
    - social
    - contracts
  topics:
    - player-orders
    - order-lifecycle
  related_systems:
    - social-service
  related_documents:
    - id: player-orders-system-detailed
      relation: references
    - id: player-orders-advanced
      relation: related
  source: shared/docs/knowledge/mechanics/social/player-orders-creation.md
  visibility: internal
  audience:
    - concept
    - design
    - systems
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: [ ]
summary:
  problem: Нужно формализовать процесс создания заказов игроками для социальных взаимодействий и сервисов.
  goal: Описать параметры, этапы и зависимости создания заказов, чтобы подготовить данные для API и UX.
  essence: Документ фиксирует входные данные и последовательность шагов при создании заказа внутри социальной системы.
  key_points:
    - Определены обязательные параметры заказа и их влияние на оценку.
    - Зафиксированы этапы от постановки задачи до выбора исполнителя.
    - Указаны интеграции с аналитикой сложности и публичностью заказов.
content:
  sections:
    - id: world_lore
      title: "Мир и лор: Создание заказа — искусство выживания"
      body: |
        В Night City, где каждый контракт — это сделка с дьяволом, создание заказа — это не просто процесс, это искусство выживания. В мире, где корпорации контролируют всё, а банды правят улицами, каждый заказ определяет не просто задачу, он определяет судьбу. От постановки задачи до выбора исполнителя — каждый этап требует точности, стратегии и готовности к рискам. Это игра в долгую, где каждый созданный заказ становится частью сложной паутины экономических и социальных отношений, которая определяет судьбу города.
        
        **Параметры заказа:** В киберпанк-мире тип, цели, сроки, бюджет, ограничения и режим видимости — это не просто параметры, это инструменты контроля. Каждый параметр влияет на подбор исполнителей, проверку соответствия и расчёт награды. В Night City параметры заказа — это не просто данные, это способ определить условия, способ контролировать процесс, способ защитить свои интересы.
        
        **Оценка сложности:** В мире, где каждый риск может стать смертельным, оценка сложности — это не просто расчёт, это предсказание судьбы. Каждый заказ анализируется через сервисы экономики и прогноза риска, определяя не просто награду, но и вероятность успеха. В Night City оценка сложности — это не просто число, это способ понять риски, способ подготовиться, способ выжить.
        
        **Публикация:** В киберпанк-мире публичная или адресная публикация — это не просто выбор, это стратегия. Публичные заказы доступны всем, но несут риски конкуренции. Адресные заказы направлены конкретным исполнителям, но требуют доверия. В Night City публикация — это не просто действие, это способ найти исполнителя, способ контролировать процесс, способ защитить свои интересы.
        
        **Блокировка вознаграждения:** В мире, где каждый кредит на счету, блокировка вознаграждения — это не просто гарантия, это защита. Каждый заказ фиксируется, вознаграждение блокируется до выбора исполнителя, обеспечивая выполнение условий. В Night City блокировка — это не просто механизм, это способ гарантировать исполнение, способ защитить интересы, способ выжить в мире, где доверие — роскошь.
    - id: creation_context
      title: Контекст и назначение
      body: |
        Создание заказа открывает цепочку взаимодействий между игроками и организациями в социальной системе NECPGAME. Этап определяет базовые параметры, которые затем учитываются при оценке сложности, расчёте вознаграждения и маршрутизации заявок.
      mechanics_links:
        - mechanics/social/player-orders-system-детально.md
      assets: [ ]
    - id: creation_parameters
      title: Параметры заказа
      body: |
        При создании игрок задаёт тип, цели, сроки, бюджет, ограничения и режим видимости заказа. Эти параметры влияют на подбор исполнителей, проверку соответствия и расчёт награды через сервисы экономики и прогноза риска.
      mechanics_links:
        - mechanics/social/player-orders-advanced.yaml
      assets: [ ]
    - id: creation_workflow
      title: Этапы процесса
      body: |
        Последовательность создания включает формирование задачи, оценку сложности и бюджета, публикацию (публичную или адресную) и приём заявок. Завершение этапа приводит к фиксированию заказа и блокировке вознаграждения до выбора исполнителя.
      mechanics_links:
        - mechanics/social/player-orders-system-детально.md
      assets: [ ]
    - id: pipeline
      title: Конвейер создания
      body: |
        Процесс включает подготовку брифа, валидацию, оценку сложности, настройку публикации, выбор
        гарантий и публикацию. Социальный сервис оркестрирует взаимодействие с экономикой и NPC.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: prerequisites
      title: Предусловия
      body: |
        Требуются минимальный рейтинг (Bronze), отсутствие санкций, покрытие депозита, подтверждение
        фракций для корпоративных заказов. Проверки выполняют economy и factions сервисы.
      mechanics_links:
        - mechanics/social/player-orders-reputation-детально.yaml
    - id: templates
      title: Шаблоны заказов
      body: |
        Боевые, хакерские, экономические, социальные и исследовательские шаблоны задают предзаполненные
        поля и подсказки. Параметр `orderTemplate` управляет конфигурацией мастера.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: brief-parameters
      title: Параметры брифа
      body: |
        Цели, сроки, бюджет, риски, требования к команде, приватность и вложения. Информация хранится
        в social-service и content-service.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: complexity
      title: Оценка сложности
      body: |
        Сложность вычисляется на основе зон, целей, навыков и риска, используя данные world и factions
        сервисов. Результат влияет на бюджет и требования к рейтингу исполнителей.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: budget
      title: Расчёт бюджета
      body: |
        BaseReward = ComplexityScore × RiskModifier × MarketIndex × TimeModifier.
        Escrow и комиссия рассчитываются от базовой суммы, сравниваются с медианой. Приведена JSON схема
        `player-order-budget.schema.json`.
      mechanics_links:
        - mechanics/social/player-orders-economy.yaml
    - id: publication
      title: Режимы публикации
      body: |
        Публичный, пригласительный и закрытый режимы. Адресные публикации требуют доверия из
        relationships-system.
      mechanics_links:
        - mechanics/social/relationships-system-детально.md
    - id: validation
      title: Валидации и проверки
      body: |
        Проверка полноты полей, юридических ограничений, бюджета, токсичности формулировок и санкций.
        Ошибки логируются в telemetry-service.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: guarantees
      title: Гарантии и страхование
      body: |
        Настраиваются уровни страховки, escrow и комиссии. Дополнительные гарантии повышают рейтинг
        заказчика и доступны арбитражу.
      mechanics_links:
        - mechanics/social/player-orders-reputation-детально.yaml
    - id: ux-flow
      title: UX-поток
      body: |
        Многошаговый мастер (Overview → Details → Budget → Publication → Review) с подсказками, симуляцией
        бюджета и черновиками. Макеты утверждены (PR `FW-PO-CREATION-021`).
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: integrations
      title: Интеграции
      body: |
        Связи с документами по репутации, отношениям и найму NPC обеспечивают адресные приглашения,
        влияние на рейтинги и подключение NPC-исполнителей.
      mechanics_links:
        - mechanics/social/player-orders-reputation-детально.yaml
        - mechanics/social/npc-hiring-system-детально.yaml
    - id: rest
      title: REST API
      body: |
        POST `/social/player-orders` (создание), `/estimate`, `/validate`, `/publish`, `/draft`. JSON
        схемы описаны для каждого запроса.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: kafka
      title: Kafka события
      body: |
        `social.player-orders.draft.saved`, `social.player-orders.validation.failed`, `social.player-orders.published`,
        `economy.player-orders.escrow.locked` и подписчики telemetry, monitoring, factions и quest сервисов.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
appendix:
  glossary: [ ]
  references:
    - title: JSON схема бюджета заказа
      link: schemas/social/player-order-budget.schema.json
    - title: Мастер создания заказов (Figma)
      link: figma://ui/player-orders/create-wizard
  decisions: [ ]
implementation:
  github_issue: 140894828
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml#player-orders-creation
  blockers: [ ]
  backend_services:
    - social-service (основная логика создания заказов)
    - economy-service (расчет бюджета и escrow)
    - world-service (оценка сложности и зон)
    - factions-service (проверки для корпоративных заказов)
  database_tables:
    - player_orders_drafts (черновики заказов)
    - player_orders_validation (результаты валидации)
    - player_orders_budget_calculation (расчеты бюджета)
  api_endpoints:
    - POST /social/player-orders (создание заказа)
    - POST /social/player-orders/estimate (оценка бюджета)
    - POST /social/player-orders/validate (валидация заказа)
    - POST /social/player-orders/publish (публикация заказа)
    - POST /social/player-orders/draft (сохранение черновика)
history:
  - version: '2.0.0'
    date: 2025-12-27
    author: content-writer
    changes: Добавлены детальные разделы по конвейеру, предусловиям, шаблонам, бюджету, API и интеграциям. Утверждена концепция.
  - version: '1.1.0'
    date: 2025-12-06
    author: idea-writer
    changes: Добавлен лор и атмосферные описания в стиле Cyberpunk 2077, расширены описания создания заказов с контекстом киберпанк-мира.
  - version: '1.0.0'
    date: 2025-11-03
    author: concept_director
    changes: Выделен процесс создания заказов из общего описания системы.
validation:
  checksum: ''
  schema_version: '1.0'

