global_rules:
  principles:
    - "API First: идеи → OpenAPI → backend → frontend."
    - "Все изменения и статусы фиксируются в репозитории с осмысленной историей коммитов."
    - "Файлы ≤ 400 строк; при необходимости разбивай на серии с ссылками между частями."
    - "Не хардкодь данные в коде — используй БД и миграции."
    - "Инструкции ссылаются на источники вместо дублирования правил."
    - "Монорепозиторий: работай через git worktree или короткоживущие ветки, избегай долгих feature-веток."
    - "GitFlow-light: main защищена, develop — интеграция, feature/hotfix/release ветки живут краткосрочно."
  game_context:
    setting: "MMORPG/экстракт-шутер в киберпанк-сеттинге (NECPGAME): мегаполис, фракции, рисковая экономика."
    pillars:
      - "Комбинация боёв, прогрессии и социального взаимодействия."
      - "Опасность ↔ награда: каждое действие несёт риск потери ресурсов."
      - "Фракции и сезонные события определяют сюжетные арки."
    reference_docs:
      - "shared/docs/knowledge/concept-canon.yaml"
      - "shared/docs/knowledge/concept-lore-glossary.yaml"
  architecture_patterns:
    - "DDD + ограниченные контексты: knowledge → API → backend → frontend."
    - "Чистая/шестигранная архитектура сервисов (порты/адаптеры, application/service/domain)."
    - "Event-driven и асинхронные очереди для интеграций между доменами."
    - "Набор конвенций по README модулей, тестам и миграциям (см. shared/docs/knowledge/structure-guidelines.yaml)."
  documentation_hierarchy:
    - "shared/docs/knowledge/ — канон, механики, контент и исследования в формате YAML."
    - "shared/trackers/ — очереди и статусные трекеры."
    - "GLOBAL-RULES.yaml — основы проекта и ограничения."
    - "process/*.yaml — последовательность этапов и статусы."
    - "agents-yaml/*.yaml — структурированные инструкции по ролям и workflow."
    - "checklists/*.yaml — проверки перед передачей задачи дальше."
    - "templates/*.yaml — формы задач, трекеров, отчётов."
    - "trackers/*.yaml — актуальные записи о ходе работ."
  agent_requirements:
    - "Перед стартом сверяйся с зависимостями (статусы предыдущих стадий)."
    - "Приступая к работе, обновляй трекер (например, status: in_progress, отметка времени)."
    - "Завершая работу, выполняй чеклист, фиксируй результаты, обновляй статусы."
    - "Заполняй записи в trackers/activity-log.yaml через автоматизацию: `generate-tasks-from-queue.ps1` и `complete-task.ps1`; ручное редактирование допускается только если автоматизация недоступна."
    - "Любые изменения попадают в main только через Pull Request (merge commit)."
    - "Используй pipeline/scripts/generate-tasks-from-queue.ps1 (с указанием префикса, например -Prefix API/BE/FE/QA/REL, и параметра -Actor <роль>) для создания карточек задач в pipeline/tasks; если id отсутствует, скрипт присвоит номер и обновит очередь."
    - "Держи `pipeline/tasks/index.yaml` в актуальном состоянии: скрипт обновляет его автоматически, а для проверки синхронизации очереди и task-файлов используй `-ValidateSync` или `-ValidateSyncOnly`."
    - "Для закрытия работ пользуйся `pipeline/scripts/complete-task.ps1`: перенос карточек, архивация YAML и запись в Activity Log выполняются автоматически."
  quality_management:
    - "Перед коммитом запускай валидаторы и линтеры (OpenAPI, Java, TypeScript и т.д.)."
    - "Для знаний выполняй pipeline/scripts/check-knowledge-schema.ps1; для очередей — pipeline/scripts/check-queue-yaml.ps1."
    - "Изменения в API сопровождай bump версии и уведомлением зависимых команд."
    - "Спорные решения фиксируй через process/DECISION-LOG.yaml."
    - "Перед push используй pipeline/scripts/run-precommit.ps1 (или эквивалентный pre-commit hook)."
    - "Установи hook через pipeline/scripts/install-precommit.ps1, чтобы run-precommit запускался автоматически."
    - "run-precommit обязательно содержит проверку `pipeline/scripts/check-activity-log.ps1` в режиме `-UseIndex`; коммит без актуальной записи в Activity Log запрещён."
    - "Для контроля знаний используй `pipeline/scripts/watch-knowledge.ps1` (автокарточки) и `pipeline/scripts/knowledge-diff.ps1` (summary по изменениям)."
    - "Создавая новые знания, применяй `pipeline/scripts/new-knowledge.ps1`; для обзора статуса запускай `pipeline/scripts/status-dashboard.ps1` и при передаче стадий формируй сводку `pipeline/scripts/handoff-summary.ps1`."
  git_practices:
    - "Автоматизированные скрипты (check-knowledge-schema/complete-task) подготавливают стандартные git add/commit — перед пушем оцени diff и дополни сообщение при необходимости."
    - "Коммиты атомарны: один тип изменения (знание, очередь, лог) → одно сообщение вида `feat|fix|chore(scope): summary`."
    - "Не смешивай несвязанные изменения; при необходимости дели работу на несколько задач."
    - "Используй `git status` перед завершением шага, чтобы убедиться в чистоте рабочей директории."
  maintenance:
    - "Назначай ответственных за роли и трекеры в trackers/owners.yaml."
    - "Проводить ревизию инструкций и чеклистов не реже раза в неделю."
    - "При крупных обновлениях используй templates/CHANGE-PACK.yaml для пошагового внедрения."
    - "Тяжёлые артефакты (медиа, LFS) держи в отдельных хранилищах либо подключай git LFS."
  version_control:
    - "Ветки: main (релиз), develop (интеграция), feature/*, release/*, hotfix/*."
    - "feature/* ветки создаются от develop и мержатся через PR с checklist соответствующего агента."
    - "release/* ветки формируются при подготовке релиза, после проверки мержатся в main и develop."
    - "hotfix/* создаются от main, после устранения проблемы мержятся в main и develop."
    - "Direct push в main/master запрещён (контролируется workflow enforce-pr-merges)."


