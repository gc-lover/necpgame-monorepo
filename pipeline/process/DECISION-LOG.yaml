decision_log:
  purpose: "Фиксировать архитектурные и процессные решения, влияющие на нескольких агентов."
  entry_template:
    id: "DEC-YYYY-XXX"
    date: "YYYY-MM-DD HH:MM"
    author: "<agent>"
    summary: "<краткое описание>"
    context: "<предпосылки>"
    decision:
      - "<пункт решения>"
    consequences:
      short_term:
        - "<краткосрочные последствия>"
      long_term:
        - "<долгосрочные последствия>"
    status: "proposed|accepted|rejected|deprecated"
    related:
      - process/PIPELINE-OVERVIEW.yaml
      - trackers/implementation-tracker.yaml
  rules:
    - "Каждая запись имеет уникальный id."
    - "date фиксируется в формате YYYY-MM-DD HH:MM с системным временем."
    - "status обновляется при смене решения."
    - "related содержит файлы, требующие пересмотра."
  responsibilities:
    - "Vision Manager создаёт запись."
    - "API Task Architect и OpenAPI Executor подтверждают или отклоняют изменения, влияющие на API."
    - "Backend и Frontend агенты обновляют руководства при статусе accepted."
  revisions:
    - "Еженедельно Readiness Reviewer проверяет выполнение последствий."
    - "При устаревании решения статус меняется на deprecated с ссылкой на заменяющий документ."
  entries:
    - id: "DEC-2025-001"
      date: "2025-11-09 22:20"
      author: "refactor-agent"
      summary: "Переход на монорепозиторий с shared/docs, shared/trackers, services/* и обновлёнными агентскими инструкциями."
      context: >
        Исторически знания, трекеры и код лежали в отдельных репозиториях (.BRAIN, API-SWAGGER, BACK-GO, FRONT-WEB).
        Для упрощения работы агентов и автоматизации валидаций принято решение объединить структуру в одном репозитории.
      decision:
        - "Вся концептуальная документация переезжает в shared/docs/knowledge в формате YAML."
        - "Очереди и трекеры хранятся в shared/trackers с единым валидатором."
        - "Агентские инструкции, шаблоны и скрипты поддерживаются в pipeline/."
        - "Исходный код и генераторы размещаются в services/openapi, services/backend, services/frontend."
        - "Добавлен скрипт pipeline/scripts/check-knowledge-schema.ps1 для проверки знаний."
      consequences:
        short_term:
          - "Необходимо обновить все агентские инструкции и чеклисты на новые пути."
          - "Добавить записи в changelog знаний и синхронизировать activity log."
        long_term:
          - "Упрощение CI/CD и единая точка входа для всех агентов."
          - "Возможность последовательного удаления TO_REFACTOR/* после переноса кода."
      status: "accepted"
      related:
        - "shared/docs/knowledge/index.yaml"
        - "shared/docs/knowledge/changelog.yaml"
        - "pipeline/agents/"
        - "pipeline/scripts/check-knowledge-schema.ps1"
    - id: "DEC-2025-002"
      date: "2025-11-09 23:45"
      author: "refactor-agent"
      summary: "Автоматизация очередей, pre-commit и CI с path-фильтрами."
      context: >
        После миграции в монорепозиторий ручное редактирование YAML-очередей и отсутствие единых проверок приводили к риску рассинхронизации.
        Для поддержки Digital Factory требуется автоматизировать управление очередями и запуск ключевых валидаторов.
      decision:
        - "Добавлен скрипт pipeline/scripts/queue-manager.ps1 для операций add/move/remove без правки YAML вручную."
        - "Подготовлен кроссплатформенный CLI pipeline/scripts/queue_manager.py (PyYAML) в дополнение к PowerShell-версии."
        - "Создан набор проверок pipeline/scripts/run-precommit.ps1 (архитектура, очереди, знания, OpenAPI)."
        - "Разработан инсталлятор hook'а pipeline/scripts/install-precommit.ps1."
        - "Введены проверки check-knowledge-review.ps1 и check-knowledge-markdown.ps1 для контроля знаний."
        - "Создан workflow .github/workflows/ci.yml с path-фильтрами для structure/backend/frontend/openapi."
      consequences:
        short_term:
          - "Агентам необходимо обновить свои процессы: использовать queue-manager и запускать run-precommit перед push."
          - "Refactor Agent актуализирует инструкции, `.cursor/rules` и подключает pre-commit hook."
          - "Команды ставят PyYAML (при использовании Python-CLI) и проверяют совместимость на Windows/Linux."
        long_term:
          - "Снижается риск порчи трекеров, улучшена прозрачность ревью."
          - "CI выполняет только релевантные проверки, ускоряя цикл."
      status: "accepted"
      related:
        - ".github/workflows/ci.yml"
        - "pipeline/scripts/queue-manager.ps1"
        - "pipeline/scripts/queue_manager.py"
        - "pipeline/scripts/run-precommit.ps1"
        - "pipeline/scripts/install-precommit.ps1"
        - "pipeline/agents/refactor-agent.yaml"
        - "pipeline/templates/agent-briefs/refactor-agent-brief.yaml"
    - id: "DEC-2025-003"
      date: "2025-11-10 00:30"
      author: "refactor-agent"
      summary: "Внедрение GitFlow-стратегии и запрет прямых push в main/master."
      context: >
        После миграции в монорепозиторий direct push в основную ветку привёл бы к обходу чеклистов и CI.
        Для синхронной работы агентов нужен единый стандарт ветвления и обязательные Merge Requests.
      decision:
        - "Введена стратегия GitFlow: main (release), develop (integration), feature/*, release/*, hotfix/*."
        - "Добавлен workflow .github/workflows/enforce-pr-merges.yml, который блокирует прямые push в main/master."
        - "README и GLOBAL-RULES дополнены разделами про защиту веток и требования к Pull Request."
        - "Workflow .github/workflows/ci.yml расширен job pr-main-validation с запуском run-precommit и дополнительных проверок."
      consequences:
        short_term:
          - "Настроить branch protection для main/master и develop в GitHub."
          - "Создать и опубликовать ветку develop, обновить локальные рабочие процессы."
          - "Добавить обязательные статусы (structure, openapi, backend, frontend, pr-main-validation) к правилам защиты веток."
        long_term:
          - "Стабильный релизный поток через Merge Requests, меньший риск пропуска чеклистов."
          - "Возможность масштабировать работу агентов без конфликтов из-за прямых push."
      status: "accepted"
      related:
        - ".github/workflows/enforce-pr-merges.yml"
        - ".github/workflows/ci.yml"
        - "README.md"
        - "pipeline/GLOBAL-RULES.yaml"
        - "pipeline/agents/refactor-agent.yaml"
        - "pipeline/templates/agent-briefs/refactor-agent-brief.yaml"


