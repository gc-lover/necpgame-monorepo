decision_log:
  purpose: "Фиксировать архитектурные и процессные решения, влияющие на нескольких агентов."
  entry_template:
    id: "DEC-YYYY-XXX"
    date: "YYYY-MM-DD HH:MM"
    author: "<agent>"
    summary: "<краткое описание>"
    context: "<предпосылки>"
    decision:
      - "<пункт решения>"
    consequences:
      short_term:
        - "<краткосрочные последствия>"
      long_term:
        - "<долгосрочные последствия>"
    status: "proposed|accepted|rejected|deprecated"
    related:
      - process/PIPELINE-OVERVIEW.yaml
      - trackers/implementation-tracker.yaml
  rules:
    - "Каждая запись имеет уникальный id."
    - "date фиксируется в формате YYYY-MM-DD HH:MM с системным временем."
    - "status обновляется при смене решения."
    - "related содержит файлы, требующие пересмотра."
  responsibilities:
    - "Vision Manager создаёт запись."
    - "API Task Architect и OpenAPI Executor подтверждают или отклоняют изменения, влияющие на API."
    - "Backend и Frontend агенты обновляют руководства при статусе accepted."
  revisions:
    - "Еженедельно Readiness Reviewer проверяет выполнение последствий."
    - "При устаревании решения статус меняется на deprecated с ссылкой на заменяющий документ."
  entries:
    - id: "DEC-2025-001"
      date: "2025-11-09 22:20"
      author: "refactor-agent"
      summary: "Переход на монорепозиторий с shared/docs, shared/trackers, services/* и обновлёнными агентскими инструкциями."
      context: >
        Исторически знания, трекеры и код лежали в отдельных репозиториях (.BRAIN, API-SWAGGER, BACK-GO, FRONT-WEB).
        Для упрощения работы агентов и автоматизации валидаций принято решение объединить структуру в одном репозитории.
      decision:
        - "Вся концептуальная документация переезжает в shared/docs/knowledge в формате YAML."
        - "Очереди и трекеры хранятся в shared/trackers с единым валидатором."
        - "Агентские инструкции, шаблоны и скрипты поддерживаются в pipeline/."
        - "Исходный код и генераторы размещаются в services/openapi, services/backend, services/frontend."
        - "Добавлен скрипт pipeline/scripts/check-knowledge-schema.ps1 для проверки знаний."
      consequences:
        short_term:
          - "Необходимо обновить все агентские инструкции и чеклисты на новые пути."
          - "Добавить записи в changelog знаний и синхронизировать activity log."
        long_term:
          - "Упрощение CI/CD и единая точка входа для всех агентов."
          - "Возможность последовательного удаления TO_REFACTOR/* после переноса кода."
      status: "accepted"
      related:
        - "shared/docs/knowledge/index.yaml"
        - "shared/docs/knowledge/changelog.yaml"
        - "pipeline/agents/"
        - "pipeline/scripts/check-knowledge-schema.ps1"
    - id: "DEC-2025-002"
      date: "2025-11-09 23:45"
      author: "refactor-agent"
      summary: "Автоматизация очередей, pre-commit и CI с path-фильтрами."
      context: >
        После миграции в монорепозиторий ручное редактирование YAML-очередей и отсутствие единых проверок приводили к риску рассинхронизации.
        Для поддержки Digital Factory требуется автоматизировать управление очередями и запуск ключевых валидаторов.
      decision:
        - "Вместо ручных CLI закреплён единый стек: `generate-tasks-from-queue.ps1` + `complete-task.ps1`, опирающиеся на модуль `Pipeline.Automation` (очереди/Activity Log обновляются автоматически)."
        - "Сохраняем pre-commit стек: pipeline/scripts/run-precommit.ps1 (архитектура, очереди, знания, OpenAPI) и установщик hook'а pipeline/scripts/install-precommit.ps1."
        - "Контроль знаний выполняют check-knowledge-review.ps1 и check-knowledge-markdown.ps1; очереди валидируются check-queue-yaml.ps1."
        - "Workflow .github/workflows/ci.yml использует path-фильтры для structure/backend/frontend/openapi и требует run-precommit."
      consequences:
        short_term:
          - "Агентам необходимо обновить процессы: использовать `generate-tasks-from-queue.ps1` / `complete-task.ps1`, запускать run-precommit перед push."
          - "Refactor Agent актуализирует инструкции, `.cursor/rules` и подключает pre-commit hook."
          - "Команды проверяют совместимость скриптов на Windows/Linux и поддерживают модуль Pipeline.Automation."
        long_term:
          - "Снижается риск порчи трекеров, улучшена прозрачность ревью."
          - "CI выполняет только релевантные проверки, ускоряя цикл."
      status: "accepted"
      related:
        - ".github/workflows/ci.yml"
        - "pipeline/scripts/generate-tasks-from-queue.ps1"
        - "pipeline/scripts/complete-task.ps1"
        - "pipeline/scripts/run-precommit.ps1"
        - "pipeline/scripts/install-precommit.ps1"
        - "pipeline/agents/refactor-agent.yaml"
        - "pipeline/templates/agent-briefs/refactor-agent-brief.yaml"
    - id: "DEC-2025-003"
      date: "2025-11-10 00:30"
      author: "refactor-agent"
      summary: "Внедрение GitFlow-стратегии и запрет прямых push в main/master."
      context: >
        После миграции в монорепозиторий direct push в основную ветку привёл бы к обходу чеклистов и CI.
        Для синхронной работы агентов нужен единый стандарт ветвления и обязательные Merge Requests.
      decision:
        - "Введена стратегия GitFlow: main (release), develop (integration), feature/*, release/*, hotfix/*."
        - "Добавлен workflow .github/workflows/enforce-pr-merges.yml, который блокирует прямые push в main/master."
        - "README и GLOBAL-RULES дополнены разделами про защиту веток и требования к Pull Request."
        - "Workflow .github/workflows/ci.yml расширен job pr-main-validation с запуском run-precommit и дополнительных проверок."
      consequences:
        short_term:
          - "Настроить branch protection для main/master и develop в GitHub."
          - "Создать и опубликовать ветку develop, обновить локальные рабочие процессы."
          - "Добавить обязательные статусы (structure, openapi, backend, frontend, pr-main-validation) к правилам защиты веток."
        long_term:
          - "Стабильный релизный поток через Merge Requests, меньший риск пропуска чеклистов."
          - "Возможность масштабировать работу агентов без конфликтов из-за прямых push."
      status: "accepted"
      related:
        - ".github/workflows/enforce-pr-merges.yml"
        - ".github/workflows/ci.yml"
        - "README.md"
        - "pipeline/GLOBAL-RULES.yaml"
        - "pipeline/agents/refactor-agent.yaml"
        - "pipeline/templates/agent-briefs/refactor-agent-brief.yaml"
    - id: "DEC-2025-004"
      date: "2025-11-10 00:42"
      author: "refactor-agent"
      summary: "Автоматическая генерация файлов задач из очередей"
      context: >
        Карточки в shared/trackers/queues приходилось вручную копировать в pipeline/tasks, что приводило к расхождениям
        и тратило время Vision/API/Backend/QA/DevOps агентов.
      decision:
        - "Создан скрипт pipeline/scripts/generate-tasks-from-queue.ps1 с поддержкой DryRun, Force, префиксов и автогенерации идентификаторов/slug (ID + название)."
        - "Добавлен шаблон pipeline/templates/task-from-queue-template.yaml и обновлены README/GLOBAL-RULES/VALIDATION-SUMMARY."
        - "Инструкции и брифы Vision/API/OpenAPI/Backend/Frontend/QA/DevOps рабочих ролей используют генератор вместо ручного копирования."
        - "В Activity Log автоматически добавляется запись о созданных задачах."
      consequences:
        short_term:
          - "Агентам нужно запускать скрипт при взятии задач из очередей и указывать идентификатор карточки."
          - "Refactor Agent должен следить за актуальностью шаблонов и путей в инструкциях."
        long_term:
          - "Снижается риск рассинхронизации между shared/trackers/queues и pipeline/tasks."
          - "Упрощается аналитика статусов и подготовка сводных отчётов."
      status: "accepted"
      related:
        - "pipeline/scripts/generate-tasks-from-queue.ps1"
        - "pipeline/templates/task-from-queue-template.yaml"
        - "README.md"
        - "pipeline/GLOBAL-RULES.yaml"
        - "pipeline/scripts/VALIDATION-SUMMARY.yaml"
        - "pipeline/agents/backend-implementer.yaml"
        - "pipeline/agents/vision-manager.yaml"
        - "pipeline/agents/api-task-architect.yaml"
        - "pipeline/agents/openapi-executor.yaml"
        - "pipeline/agents/frontend-implementer.yaml"
        - "pipeline/agents/qa-agent.yaml"
        - "pipeline/agents/devops-agent.yaml"


