agent: Refactor Agent
tasks_source:
  description: Архитектурные аудиты и замечания из журналов
locations:
  - "shared/trackers/activity-log.yaml"
  - "shared/trackers/blockers.yaml"
supporting_files:
  - "pipeline/agents/REFACTOR-AGENT-PLAYBOOK.yaml"
work_instructions:
  - "Выполни базовые проверки (структура каталогов, лимиты, безопасность)."
  - "Сформируй технические задачи и план рефакторинга."
  - "Используй `pipeline/scripts/generate-tasks-from-queue.ps1 -QueueFile shared/trackers/queues/refactor/queued.yaml -TargetDirectory pipeline/tasks/01_refactor_agent -Prefix RFA -Actor \"Refactor Agent\" [-Id <task_id>]` для развёртывания карточек; Activity Log и очередь обновятся автоматически."
  - "Закрывая задачи, переводи их через `pipeline/scripts/complete-task.ps1 -TaskFile pipeline/tasks/01_refactor_agent/<task-file.yaml> -TargetQueueFile shared/trackers/queues/refactor/completed.yaml -Actor \"Refactor Agent\"`."
  - "Установи pre-commit hook (`pwsh -File pipeline/scripts/install-precommit.ps1`) и проверь его работу на целевых ОС."
  - "Поддерживай GitFlow: контролируй ветки main/develop, обновляй инструкции и проверяй наличие branch protection."
  - "Проверь, что workflow `.github/workflows/ci.yml` содержит актуальные проверки (structure/openapi/backend/frontend/pr-main-validation)."
validation_scripts:
  - "pwsh -File pipeline/scripts/check-architecture-health.ps1 -RootPath C:\\NECPGAME"
  - "pwsh -File pipeline/scripts/check-directory-structure.ps1 -ApiRoot services/openapi/api/v1"
  - "pwsh -File pipeline/scripts/check-file-limits.ps1 -Path <list>"
  - "pwsh -File pipeline/scripts/check-knowledge-schema.ps1 -KnowledgeRoot shared/docs/knowledge"
  - "pwsh -File pipeline/scripts/run-precommit.ps1"
completion_actions:
  - "Обнови Activity Log (предпочитай автоматические записи), Decision Log и соответствующие очереди/трекеры."
  - "Передай задачи ответственным агентам и контролируй выполнение."
  - "Убедись, что `.cursor/rules/*.mdc` отражают актуальную структуру и пути."
  - "Задокументируй выявленные кроссплатформенные изменения и обнови соответствующие инструкции."
  - "Проверь, что workflow `.github/workflows/enforce-pr-merges.yml` и branch protection соответствуют принятым правилам."

