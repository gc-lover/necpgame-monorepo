{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://necpgame.com/schemas/kafka/economy-trade-events.json",
  "title": "Economy Trade Events",
  "description": "Trading and marketplace events. Memory-optimized for high-throughput financial operations. Atomic transaction guarantees required.",
  "type": "object",
  "allOf": [
    { "$ref": "../core/base-event.json" },
    {
      "properties": {
        "event_type": {
          "enum": [
            "economy.trade.listing.create",
            "economy.trade.listing.update",
            "economy.trade.listing.cancel",
            "economy.trade.listing.expire",
            "economy.trade.execute",
            "economy.trade.cancel",
            "economy.market.price.update"
          ]
        },
        "data": {
          "oneOf": [
            { "$ref": "#/definitions/TradeListingCreateData" },
            { "$ref": "#/definitions/TradeListingUpdateData" },
            { "$ref": "#/definitions/TradeListingCancelData" },
            { "$ref": "#/definitions/TradeListingExpireData" },
            { "$ref": "#/definitions/TradeExecuteData" },
            { "$ref": "#/definitions/TradeCancelData" },
            { "$ref": "#/definitions/MarketPriceUpdateData" }
          ]
        }
      }
    }
  ],
  "definitions": {
    "TradeListingCreateData": {
      "type": "object",
      "required": ["listing_id", "seller_id", "item_id", "item_type", "quantity", "price", "currency"],
      "properties": {
        "listing_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique trade listing identifier"
        },
        "seller_id": {
          "type": "string",
          "format": "uuid",
          "description": "Seller player ID"
        },
        "item_id": {
          "type": "string",
          "format": "uuid",
          "description": "Item instance ID being sold"
        },
        "item_type": {
          "type": "string",
          "enum": ["weapon", "armor", "consumable", "material", "cyberware", "vehicle"],
          "description": "Type of item"
        },
        "item_name": {
          "type": "string",
          "description": "Display name of item",
          "examples": ["Militech M-10AF Lexington"]
        },
        "quantity": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000,
          "description": "Quantity available for sale",
          "examples": [1]
        },
        "price": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000000000,
          "description": "Price per unit in currency",
          "examples": [25000]
        },
        "currency": {
          "type": "string",
          "enum": ["eurodollars", "bitcoin", "corporation_script"],
          "description": "Currency type",
          "examples": ["eurodollars"]
        },
        "listing_type": {
          "type": "string",
          "enum": ["instant_buy", "auction", "offer_only"],
          "description": "Type of listing",
          "default": "instant_buy"
        },
        "expires_at": {
          "type": "string",
          "format": "date-time",
          "description": "Listing expiration timestamp",
          "examples": ["2025-12-27T14:30:00Z"]
        },
        "minimum_price": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum acceptable price (for auctions)",
          "examples": [20000]
        },
        "location": {
          "type": "string",
          "description": "Market location/zone",
          "examples": ["night_city_market", "badlands_trading_post"]
        },
        "rarity": {
          "type": "string",
          "enum": ["common", "uncommon", "rare", "epic", "legendary"],
          "description": "Item rarity tier"
        },
        "condition": {
          "type": "string",
          "enum": ["mint", "excellent", "good", "fair", "poor", "damaged"],
          "description": "Item condition",
          "default": "good"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Listing creation timestamp"
        }
      }
    },
    "TradeListingUpdateData": {
      "type": "object",
      "required": ["listing_id", "updates"],
      "properties": {
        "listing_id": {
          "type": "string",
          "format": "uuid",
          "description": "Trade listing identifier"
        },
        "updates": {
          "type": "object",
          "description": "Fields being updated",
          "properties": {
            "price": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000000000,
              "description": "New price per unit"
            },
            "quantity": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000,
              "description": "New quantity available"
            },
            "expires_at": {
              "type": "string",
              "format": "date-time",
              "description": "New expiration timestamp"
            }
          }
        },
        "updated_by": {
          "type": "string",
          "format": "uuid",
          "description": "Player who made the update"
        }
      }
    },
    "TradeListingCancelData": {
      "type": "object",
      "required": ["listing_id", "cancel_reason"],
      "properties": {
        "listing_id": {
          "type": "string",
          "format": "uuid",
          "description": "Trade listing identifier"
        },
        "cancel_reason": {
          "type": "string",
          "enum": ["user_cancelled", "item_not_available", "fraud_detected", "system_cancel"],
          "description": "Reason for cancellation"
        },
        "cancelled_by": {
          "type": "string",
          "format": "uuid",
          "description": "Player/system that cancelled the listing"
        },
        "refund_amount": {
          "type": "integer",
          "minimum": 0,
          "description": "Amount refunded if applicable",
          "examples": [0]
        }
      }
    },
    "TradeListingExpireData": {
      "type": "object",
      "required": ["listing_id"],
      "properties": {
        "listing_id": {
          "type": "string",
          "format": "uuid",
          "description": "Trade listing identifier"
        },
        "expired_at": {
          "type": "string",
          "format": "date-time",
          "description": "Actual expiration timestamp"
        }
      }
    },
    "TradeExecuteData": {
      "type": "object",
      "required": ["trade_id", "listing_id", "buyer_id", "seller_id", "item_id", "quantity", "price", "currency"],
      "properties": {
        "trade_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique trade transaction identifier"
        },
        "listing_id": {
          "type": "string",
          "format": "uuid",
          "description": "Original listing identifier"
        },
        "buyer_id": {
          "type": "string",
          "format": "uuid",
          "description": "Buyer player ID"
        },
        "seller_id": {
          "type": "string",
          "format": "uuid",
          "description": "Seller player ID"
        },
        "item_id": {
          "type": "string",
          "format": "uuid",
          "description": "Item instance ID"
        },
        "item_type": {
          "type": "string",
          "enum": ["weapon", "armor", "consumable", "material", "cyberware", "vehicle"],
          "description": "Type of item traded"
        },
        "quantity": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000,
          "description": "Quantity traded",
          "examples": [1]
        },
        "price": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000000000,
          "description": "Final price per unit",
          "examples": [25000]
        },
        "currency": {
          "type": "string",
          "enum": ["eurodollars", "bitcoin", "corporation_script"],
          "description": "Currency used",
          "examples": ["eurodollars"]
        },
        "total_amount": {
          "type": "integer",
          "minimum": 1,
          "description": "Total transaction amount (price * quantity)",
          "examples": [25000]
        },
        "fee_amount": {
          "type": "integer",
          "minimum": 0,
          "description": "Trading fee deducted",
          "examples": [1250]
        },
        "executed_at": {
          "type": "string",
          "format": "date-time",
          "description": "Trade execution timestamp"
        },
        "location": {
          "type": "string",
          "description": "Trade location/zone",
          "examples": ["night_city_market"]
        },
        "payment_method": {
          "type": "string",
          "enum": ["instant", "escrow", "auction"],
          "description": "Payment settlement method",
          "default": "instant"
        }
      }
    },
    "TradeCancelData": {
      "type": "object",
      "required": ["trade_id", "cancel_reason"],
      "properties": {
        "trade_id": {
          "type": "string",
          "format": "uuid",
          "description": "Trade transaction identifier"
        },
        "cancel_reason": {
          "type": "string",
          "enum": ["buyer_cancelled", "seller_cancelled", "payment_failed", "item_unavailable", "fraud_detected"],
          "description": "Reason for trade cancellation"
        },
        "cancelled_by": {
          "type": "string",
          "format": "uuid",
          "description": "Player/system that cancelled the trade"
        },
        "refund_amount": {
          "type": "integer",
          "minimum": 0,
          "description": "Amount refunded",
          "examples": [25000]
        },
        "penalty_amount": {
          "type": "integer",
          "minimum": 0,
          "description": "Penalty amount if applicable",
          "examples": [0]
        }
      }
    },
    "MarketPriceUpdateData": {
      "type": "object",
      "required": ["item_type", "location", "average_price", "volume"],
      "properties": {
        "item_type": {
          "type": "string",
          "description": "Item type/category",
          "examples": ["weapon.pistol", "armor.heavy"]
        },
        "location": {
          "type": "string",
          "description": "Market location/zone",
          "examples": ["night_city_market"]
        },
        "average_price": {
          "type": "integer",
          "minimum": 1,
          "description": "Average price per unit",
          "examples": [25000]
        },
        "currency": {
          "type": "string",
          "enum": ["eurodollars", "bitcoin", "corporation_script"],
          "description": "Currency used",
          "default": "eurodollars"
        },
        "volume": {
          "type": "integer",
          "minimum": 0,
          "description": "Trading volume (units) in last period",
          "examples": [150]
        },
        "price_change_percent": {
          "type": "number",
          "description": "Price change percentage from previous period",
          "examples": [5.2, -2.1]
        },
        "period": {
          "type": "string",
          "enum": ["1h", "6h", "24h", "7d"],
          "description": "Time period for this update",
          "default": "1h"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Price update timestamp"
        }
      }
    }
  }
}
