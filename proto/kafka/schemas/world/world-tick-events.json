{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://necpgame.com/schemas/kafka/world-tick-events.json",
  "title": "World Tick Events",
  "description": "Event-driven simulation tick events for world simulation infrastructure. Memory-optimized for scheduled tick operations. Issue: #2281 - Event-Driven Simulation Tick Infrastructure.",
  "type": "object",
  "allOf": [
    {
      "$ref": "../core/base-event.json"
    },
    {
      "properties": {
        "event_type": {
          "enum": [
            "world.tick.hourly",
            "world.tick.daily",
            "world.tick.game_hour",
            "world.tick.game_day"
          ]
        },
        "data": {
          "oneOf": [
            {
              "$ref": "#/definitions/HourlyTickData"
            },
            {
              "$ref": "#/definitions/DailyTickData"
            }
          ]
        }
      }
    }
  ],
  "definitions": {
    "HourlyTickData": {
      "type": "object",
      "required": [
        "tick_id",
        "tick_type",
        "game_hour",
        "game_time",
        "tick_timestamp"
      ],
      "properties": {
        "tick_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique tick identifier for idempotency and deduplication",
          "examples": [
            "550e8400-e29b-41d4-a716-446655440100"
          ]
        },
        "tick_type": {
          "type": "string",
          "enum": [
            "hourly",
            "game_hour"
          ],
          "description": "Type of tick event - hourly triggers economy market clearing",
          "examples": [
            "hourly"
          ]
        },
        "game_hour": {
          "type": "integer",
          "minimum": 0,
          "maximum": 23,
          "description": "Game hour (0-23) in the simulation day",
          "examples": [
            14
          ]
        },
        "game_time": {
          "type": "string",
          "format": "date-time",
          "description": "Current game time in the simulation (RFC3339 format)",
          "examples": [
            "2027-12-21T14:00:00Z"
          ]
        },
        "tick_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Actual timestamp when tick was generated by Ticker Service",
          "examples": [
            "2025-12-20T14:00:00Z"
          ]
        },
        "triggered_by": {
          "type": "string",
          "enum": [
            "scheduler",
            "manual",
            "system"
          ],
          "description": "What triggered this tick event",
          "default": "scheduler",
          "examples": [
            "scheduler"
          ]
        },
        "consumers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Expected service consumers for this tick (for monitoring and validation)",
          "examples": [
            [
              "economy-service",
              "analytics-service"
            ]
          ]
        },
        "metadata": {
          "type": "object",
          "description": "Additional tick metadata",
          "properties": {
            "simulation_day": {
              "type": "integer",
              "minimum": 1,
              "description": "Simulation day number since world start",
              "examples": [
                127
              ]
            },
            "simulation_week": {
              "type": "integer",
              "minimum": 1,
              "description": "Simulation week number",
              "examples": [
                18
              ]
            },
            "simulation_month": {
              "type": "integer",
              "minimum": 1,
              "description": "Simulation month number",
              "examples": [
                4
              ]
            }
          }
        }
      },
      "description": "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%. Hourly tick optimized for economy Market.Clear() operations."
    },
    "DailyTickData": {
      "type": "object",
      "required": [
        "tick_id",
        "tick_type",
        "game_day",
        "game_time",
        "tick_timestamp"
      ],
      "properties": {
        "tick_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique tick identifier for idempotency and deduplication",
          "examples": [
            "550e8400-e29b-41d4-a716-446655440200"
          ]
        },
        "tick_type": {
          "type": "string",
          "enum": [
            "daily",
            "game_day"
          ],
          "description": "Type of tick event - daily triggers diplomacy evaluation",
          "examples": [
            "daily"
          ]
        },
        "game_day": {
          "type": "integer",
          "minimum": 1,
          "description": "Game day number in the simulation",
          "examples": [
            127
          ]
        },
        "game_time": {
          "type": "string",
          "format": "date-time",
          "description": "Current game time in the simulation (RFC3339 format) - start of new day",
          "examples": [
            "2027-12-21T00:00:00Z"
          ]
        },
        "tick_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Actual timestamp when tick was generated by Ticker Service",
          "examples": [
            "2025-12-20T00:00:00Z"
          ]
        },
        "triggered_by": {
          "type": "string",
          "enum": [
            "scheduler",
            "manual",
            "system"
          ],
          "description": "What triggered this tick event",
          "default": "scheduler",
          "examples": [
            "scheduler"
          ]
        },
        "consumers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Expected service consumers for this tick (for monitoring and validation)",
          "examples": [
            [
              "world-simulation-python",
              "social-service",
              "analytics-service"
            ]
          ]
        },
        "metadata": {
          "type": "object",
          "description": "Additional tick metadata",
          "properties": {
            "simulation_week": {
              "type": "integer",
              "minimum": 1,
              "description": "Simulation week number",
              "examples": [
                18
              ]
            },
            "simulation_month": {
              "type": "integer",
              "minimum": 1,
              "description": "Simulation month number",
              "examples": [
                4
              ]
            },
            "simulation_year": {
              "type": "integer",
              "minimum": 2020,
              "maximum": 2099,
              "description": "Simulation year",
              "examples": [
                2027
              ]
            },
            "season": {
              "type": "string",
              "enum": [
                "spring",
                "summer",
                "autumn",
                "winter"
              ],
              "description": "Simulation season (if applicable)",
              "examples": [
                "winter"
              ]
            }
          }
        }
      },
      "description": "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%. Daily tick optimized for Diplomacy.Evaluate() operations in world-simulation-python."
    }
  }
}