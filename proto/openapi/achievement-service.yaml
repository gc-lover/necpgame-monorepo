openapi: 3.0.3
info:
  title: Achievement Service API
  description: API для системы достижений: отслеживание прогресса, разблокировка, лидерборды
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8085/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

tags:
  - name: Achievements
    description: Управление достижениями
  - name: Player Achievements
    description: Прогресс игроков по достижениям
  - name: Leaderboards
    description: Лидерборды достижений
  - name: Statistics
    description: Статистика достижений

paths:
  /achievements:
    get:
      tags:
        - Achievements
      summary: Получить список достижений
      operationId: getAchievements
      parameters:
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/AchievementCategory'
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/AchievementType'
        - name: rarity
          in: query
          schema:
            $ref: '#/components/schemas/AchievementRarity'
        - name: is_hidden
          in: query
          schema:
            type: boolean
        - name: is_seasonal
          in: query
          schema:
            type: boolean
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Список достижений
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AchievementListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /achievements/{achievementId}:
    get:
      tags:
        - Achievements
      summary: Получить достижение
      operationId: getAchievement
      parameters:
        - name: achievementId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Достижение
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Achievement'
        '404':
          $ref: '#/components/responses/NotFound'

  /achievements/{achievementId}/stats:
    get:
      tags:
        - Statistics
      summary: Получить статистику достижения
      operationId: getAchievementStats
      parameters:
        - name: achievementId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Статистика достижения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AchievementStatsResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /players/{playerId}/achievements:
    get:
      tags:
        - Player Achievements
      summary: Получить прогресс игрока по достижениям
      operationId: getPlayerAchievements
      parameters:
        - name: playerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/AchievementStatus'
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/AchievementCategory'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Прогресс игрока
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerAchievementResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /players/{playerId}/progress:
    get:
      tags:
        - Player Achievements
      summary: Получить прогресс игрока по достижениям
      operationId: getPlayerProgress
      parameters:
        - name: playerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/AchievementCategory'
      responses:
        '200':
          description: Прогресс игрока
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerProgressResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /players/{playerId}/unlocked:
    get:
      tags:
        - Player Achievements
      summary: Получить разблокированные достижения игрока
      operationId: getPlayerUnlocked
      parameters:
        - name: playerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/AchievementCategory'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Разблокированные достижения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerUnlockedResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /players/{playerId}/titles:
    get:
      tags:
        - Player Achievements
      summary: Получить титулы игрока
      operationId: getPlayerTitles
      parameters:
        - name: playerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Титулы игрока
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerTitlesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /players/{playerId}/titles/{titleId}/equip:
    post:
      tags:
        - Player Achievements
      summary: Экипировать титул
      operationId: equipTitle
      parameters:
        - name: playerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: titleId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Титул экипирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EquipTitleResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /achievements/leaderboard:
    get:
      tags:
        - Leaderboards
      summary: Получить лидерборд достижений
      operationId: getLeaderboard
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [all_time, weekly, monthly, season]
            default: all_time
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/AchievementCategory'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Лидерборд
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeaderboardResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Achievement:
      type: object
      properties:
        id:
          type: string
          format: uuid
        code:
          type: string
          description: Уникальный код достижения
        type:
          $ref: '#/components/schemas/AchievementType'
        category:
          $ref: '#/components/schemas/AchievementCategory'
        rarity:
          $ref: '#/components/schemas/AchievementRarity'
        title:
          type: string
          maxLength: 200
        description:
          type: string
        points:
          type: integer
          minimum: 0
          description: Очки за достижение
        conditions:
          type: object
          additionalProperties: true
          description: Условия для разблокировки (JSON)
        rewards:
          type: object
          additionalProperties: true
          description: Награды за достижение (JSON)
        is_hidden:
          type: boolean
          default: false
        is_seasonal:
          type: boolean
          default: false
        season_id:
          type: string
          format: uuid
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AchievementType:
      type: string
      enum: [one_time, progressive, hidden, seasonal, meta]
      description: Тип достижения

    AchievementCategory:
      type: string
      enum: [combat, quest, social, economy, exploration, skills, collections, special]
      description: Категория достижения

    AchievementRarity:
      type: string
      enum: [common, uncommon, rare, epic, legendary]
      description: Редкость достижения

    AchievementStatus:
      type: string
      enum: [locked, progress, unlocked]
      description: Статус достижения у игрока

    PlayerAchievement:
      type: object
      properties:
        id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        achievement_id:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/AchievementStatus'
        progress:
          type: integer
          minimum: 0
        progress_max:
          type: integer
          minimum: 1
        progress_data:
          type: object
          additionalProperties: true
          description: Дополнительные данные прогресса (JSON)
        unlocked_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AchievementListResponse:
      type: object
      properties:
        achievements:
          type: array
          items:
            $ref: '#/components/schemas/Achievement'
        total:
          type: integer
        categories:
          type: object
          additionalProperties:
            type: integer
          description: Количество достижений по категориям

    PlayerAchievementResponse:
      type: object
      properties:
        achievements:
          type: array
          items:
            $ref: '#/components/schemas/PlayerAchievement'
        total:
          type: integer
        unlocked:
          type: integer
          description: Количество разблокированных достижений
        near_completion:
          type: array
          items:
            $ref: '#/components/schemas/PlayerAchievement'
          description: Достижения близкие к завершению
        recent_unlocks:
          type: array
          items:
            $ref: '#/components/schemas/PlayerAchievement'
          description: Недавно разблокированные достижения

    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
          minimum: 1
        player_id:
          type: string
          format: uuid
        player_name:
          type: string
        points:
          type: integer
          minimum: 0
        unlocked:
          type: integer
          minimum: 0

    LeaderboardResponse:
      type: object
      properties:
        entries:
          type: array
          items:
            $ref: '#/components/schemas/LeaderboardEntry'
        total:
          type: integer
        period:
          type: string
          enum: [all_time, weekly, monthly, season]

    AchievementStatsResponse:
      type: object
      properties:
        achievement_id:
          type: string
          format: uuid
        total_unlocks:
          type: integer
          minimum: 0
        unlock_percent:
          type: number
          format: float
          minimum: 0
          maximum: 100
        average_time:
          type: number
          format: float
          nullable: true
          description: Среднее время до разблокировки в секундах
        first_player_id:
          type: string
          format: uuid
          nullable: true
        first_player_name:
          type: string
          nullable: true
        first_unlocked_at:
          type: string
          format: date-time
          nullable: true

    Error:
      type: object
      properties:
        error:
          type: string

  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

security:
  - BearerAuth: []

