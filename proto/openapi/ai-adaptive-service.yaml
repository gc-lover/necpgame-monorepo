openapi: 3.0.3
info:
  title: AI Adaptive Service API
  description: |
    API для системы адаптивного AI.
    
    **Основные возможности:**
    - Анализ тактик игроков в реальном времени
    - Адаптация поведения AI врагов
    - Применение контр-стратегий
    - Обучение моделей машинного обучения
    - Мониторинг статуса моделей
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8090/api/v1/ai
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1/ai
    description: Продакшен сервер

tags:
  - name: Tactics Analysis
    description: Анализ тактик игроков
  - name: Adaptations
    description: Адаптации AI
  - name: Training
    description: Обучение моделей
  - name: Models
    description: Управление моделями

paths:
  /analyze/tactics:
    post:
      tags:
        - Tactics Analysis
      summary: Анализировать тактики команды
      description: |
        Анализирует тактики игроков в реальном времени и определяет слабые места команды.
        Результаты используются для адаптации поведения AI врагов.
      operationId: analyzeTactics
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeTacticsRequest'
            example:
              encounter_id: "aa0e8400-e29b-41d4-a716-446655440000"
              team_players:
                - player_id: "bb0e8400-e29b-41d4-a716-446655440000"
                  position_data:
                    preferred_positions:
                      - x: 10.5
                        y: 2.0
                        z: 15.3
                  ability_usage:
                    most_used_abilities:
                      - ability_id: "cc0e8400-e29b-41d4-a716-446655440000"
                        usage_count: 25
                  pattern_data:
                    attack_patterns:
                      - pattern_type: "combo_sequence"
                        frequency: 0.75
                        effectiveness: 0.82
      responses:
        '200':
          description: Результаты анализа тактик
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeTacticsResponse'
              example:
                encounter_id: "aa0e8400-e29b-41d4-a716-446655440000"
                analysis_id: "dd0e8400-e29b-41d4-a716-446655440000"
                tactics_patterns:
                  - pattern_type: "combo_sequence"
                    frequency: 0.75
                    effectiveness: 0.82
                weaknesses:
                  - weakness_type: "coordination"
                    severity: "high"
                    description: "Team lacks coordination in ability usage"
                    affected_players:
                      - "bb0e8400-e29b-41d4-a716-446655440000"
                recommendations:
                  - adaptation_type: "counter_strategy"
                    description: "Focus on interrupting combo sequences"
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /adaptations/{encounterId}:
    get:
      tags:
        - Adaptations
      summary: Получить текущие адаптации AI
      description: |
        Возвращает список всех активных адаптаций AI для указанной встречи.
        Включает информацию о типе адаптации, примененных изменениях и эффективности.
      operationId: getAdaptations
      security:
        - BearerAuth: []
      parameters:
        - name: encounterId
          in: path
          required: true
          description: ID встречи
          schema:
            type: string
            format: uuid
            example: "aa0e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Список адаптаций AI
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdaptationsResponse'
              example:
                encounter_id: "aa0e8400-e29b-41d4-a716-446655440000"
                adaptations:
                  - adaptation_id: "ee0e8400-e29b-41d4-a716-446655440000"
                    enemy_id: "ff0e8400-e29b-41d4-a716-446655440000"
                    adaptation_type: "attack_pattern"
                    adaptation_data:
                      target_priority: "weakest_player"
                      attack_frequency: 0.8
                    applied_at: "2025-12-01T10:00:00Z"
                    effectiveness: 0.75
                total: 5
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /training/data:
    post:
      tags:
        - Training
      summary: Отправить данные для обучения
      description: |
        Отправляет данные о тактиках и адаптациях для обучения моделей машинного обучения.
        Данные используются для улучшения алгоритмов адаптации AI.
      operationId: submitTrainingData
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitTrainingDataRequest'
            example:
              encounter_id: "aa0e8400-e29b-41d4-a716-446655440000"
              tactics_data:
                team_composition:
                  - "bb0e8400-e29b-41d4-a716-446655440000"
                tactics_patterns:
                  - pattern_type: "combo_sequence"
                    frequency: 0.75
                    effectiveness: 0.82
                weaknesses:
                  - weakness_type: "coordination"
                    severity: "high"
                    description: "Team lacks coordination"
              adaptation_data:
                adaptations_applied:
                  - adaptation_id: "cc0e8400-e29b-41d4-a716-446655440000"
                    adaptation_type: "counter_strategy"
                strategy_changes: 3
              effectiveness: 0.75
              timestamp: "2025-12-01T10:00:00Z"
      responses:
        '200':
          description: Данные приняты для обучения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitTrainingDataResponse'
              example:
                training_data_id: "gg0e8400-e29b-41d4-a716-446655440000"
                status: "accepted"
                message: "Training data accepted for processing"
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /models/status:
    get:
      tags:
        - Models
      summary: Получить статус моделей
      description: |
        Возвращает статус всех моделей машинного обучения, используемых для адаптивного AI.
        Включает информацию о версиях, точности и последнем обучении.
      operationId: getModelsStatus
      security:
        - BearerAuth: []
      parameters:
        - name: model_name
          in: query
          required: false
          description: Фильтр по названию модели
          schema:
            type: string
            example: "tactics_analyzer"
      responses:
        '200':
          description: Статус моделей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelsStatusResponse'
              example:
                models:
                  - model_id: "hh0e8400-e29b-41d4-a716-446655440000"
                    model_name: "tactics_analyzer_v1"
                    status: "deployed"
                    version: "1.2.0"
                    last_trained: "2025-12-01T08:00:00Z"
                    accuracy: 0.88
                    training_samples: 100000
                total: 3
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      $ref: 'common.yaml#/components/securitySchemes/BearerAuth'

  schemas:
    AnalyzeTacticsRequest:
      type: object
      required:
        - encounter_id
        - team_players
      properties:
        encounter_id:
          type: string
          format: uuid
          example: "aa0e8400-e29b-41d4-a716-446655440000"
        team_players:
          type: array
          description: Данные о тактиках игроков команды
          items:
            $ref: 'ai-adaptive-schemas.yaml#/components/schemas/PlayerTacticsData'
          minItems: 1

    AnalyzeTacticsResponse:
      type: object
      required:
        - encounter_id
        - analysis_id
        - tactics_patterns
        - weaknesses
      properties:
        encounter_id:
          type: string
          format: uuid
          example: "aa0e8400-e29b-41d4-a716-446655440000"
        analysis_id:
          type: string
          format: uuid
          example: "dd0e8400-e29b-41d4-a716-446655440000"
        tactics_patterns:
          type: array
          description: Выявленные паттерны тактик
          items:
            $ref: 'ai-adaptive-schemas.yaml#/components/schemas/TacticsPattern'
        weaknesses:
          type: array
          description: Выявленные слабые места команды
          items:
            $ref: 'ai-adaptive-schemas.yaml#/components/schemas/TeamWeakness'
        recommendations:
          type: array
          description: Рекомендации по адаптации
          items:
            type: object
            properties:
              adaptation_type:
                $ref: 'ai-adaptive-schemas.yaml#/components/schemas/AdaptationType'
              description:
                type: string
                example: "Focus on interrupting combo sequences"

    AdaptationsResponse:
      type: object
      required:
        - encounter_id
        - adaptations
        - total
      properties:
        encounter_id:
          type: string
          format: uuid
          example: "aa0e8400-e29b-41d4-a716-446655440000"
        adaptations:
          type: array
          description: Список адаптаций AI
          items:
            $ref: 'ai-adaptive-schemas.yaml#/components/schemas/AIAdaptation'
        total:
          type: integer
          description: Общее количество адаптаций
          minimum: 0
          example: 5

    SubmitTrainingDataRequest:
      type: object
      required:
        - encounter_id
        - tactics_data
        - adaptation_data
        - effectiveness
        - timestamp
      properties:
        encounter_id:
          type: string
          format: uuid
          example: "aa0e8400-e29b-41d4-a716-446655440000"
        tactics_data:
          type: object
          description: Данные о тактиках команды
          properties:
            team_composition:
              type: array
              items:
                type: string
                format: uuid
            tactics_patterns:
              type: array
              items:
                $ref: 'ai-adaptive-schemas.yaml#/components/schemas/TacticsPattern'
            weaknesses:
              type: array
              items:
                $ref: 'ai-adaptive-schemas.yaml#/components/schemas/TeamWeakness'
        adaptation_data:
          type: object
          description: Данные об адаптациях AI
          properties:
            adaptations_applied:
              type: array
              items:
                $ref: 'ai-adaptive-schemas.yaml#/components/schemas/AIAdaptation'
            strategy_changes:
              type: integer
              minimum: 0
        effectiveness:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          example: 0.75
        timestamp:
          type: string
          format: date-time
          example: "2025-12-01T10:00:00Z"

    SubmitTrainingDataResponse:
      type: object
      required:
        - training_data_id
        - status
        - message
      properties:
        training_data_id:
          type: string
          format: uuid
          example: "gg0e8400-e29b-41d4-a716-446655440000"
        status:
          type: string
          enum: [accepted, processing, completed, failed]
          description: Статус обработки данных
          example: "accepted"
        message:
          type: string
          description: Сообщение о статусе
          example: "Training data accepted for processing"

    ModelsStatusResponse:
      type: object
      required:
        - models
        - total
      properties:
        models:
          type: array
          description: Список моделей
          items:
            $ref: 'ai-adaptive-schemas.yaml#/components/schemas/ModelStatus'
        total:
          type: integer
          description: Общее количество моделей
          minimum: 0
          example: 3

  responses:
    BadRequest:
      $ref: 'common.yaml#/components/responses/BadRequest'
    Unauthorized:
      $ref: 'common.yaml#/components/responses/Unauthorized'
    NotFound:
      $ref: 'common.yaml#/components/responses/NotFound'
    InternalServerError:
      $ref: 'common.yaml#/components/responses/InternalServerError'
