openapi: 3.0.3
info:
  title: Announcement Publisher Service API
  description: API для публикации и планирования объявлений
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8096/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

tags:
  - name: Announcement Publisher
    description: Публикация объявлений
  - name: Announcement Scheduler
    description: Планирование публикаций

paths:
  /liveops/announcements/{announcement_id}/publish:
    post:
      tags:
        - Announcement Publisher
      summary: Опубликовать объявление
      description: Опубликовать объявление немедленно (требуются права администратора)
      operationId: publishAnnouncement
      security:
        - BearerAuth: []
      parameters:
        - name: announcement_id
          in: path
          required: true
          description: ID объявления
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Объявление опубликовано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Announcement'
              examples:
                example1:
                  value:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    status: "PUBLISHED"
                    published_at: "2025-11-27T10:00:00Z"
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '403':
          description: Недостаточно прав
          content:
            application/json:
              schema:
                $ref: 'common.yaml#/components/schemas/Error'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /liveops/announcements/{announcement_id}/schedule:
    post:
      tags:
        - Announcement Publisher
        - Announcement Scheduler
      summary: Запланировать публикацию объявления
      description: Запланировать публикацию объявления на определенное время (требуются права администратора)
      operationId: scheduleAnnouncement
      security:
        - BearerAuth: []
      parameters:
        - name: announcement_id
          in: path
          required: true
          description: ID объявления
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        description: Данные для планирования публикации
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleAnnouncementRequest'
            examples:
              example1:
                value:
                  scheduled_publish_at: "2025-11-28T10:00:00Z"
      responses:
        '200':
          description: Публикация запланирована
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Announcement'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '403':
          description: Недостаточно прав
          content:
            application/json:
              schema:
                $ref: 'common.yaml#/components/schemas/Error'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /liveops/announcements/{announcement_id}/archive:
    post:
      tags:
        - Announcement Publisher
      summary: Архивировать объявление
      description: Архивировать объявление (требуются права администратора)
      operationId: archiveAnnouncement
      security:
        - BearerAuth: []
      parameters:
        - name: announcement_id
          in: path
          required: true
          description: ID объявления
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Объявление архивировано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Announcement'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '403':
          description: Недостаточно прав
          content:
            application/json:
              schema:
                $ref: 'common.yaml#/components/schemas/Error'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /liveops/announcements/scheduled:
    get:
      tags:
        - Announcement Scheduler
      summary: Получить запланированные объявления
      description: Получить список запланированных к публикации объявлений (требуются права администратора)
      operationId: getScheduledAnnouncements
      security:
        - BearerAuth: []
      parameters:
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список запланированных объявлений
          content:
            application/json:
              schema:
                type: object
                properties:
                  announcements:
                    type: array
                    items:
                      $ref: '#/components/schemas/Announcement'
                  total:
                    type: integer
                    description: Общее количество запланированных объявлений
                  limit:
                    type: integer
                  offset:
                    type: integer
              examples:
                example1:
                  value:
                    announcements:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        status: "SCHEDULED"
                        scheduled_publish_at: "2025-11-28T10:00:00Z"
                    total: 1
                    limit: 20
                    offset: 0
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

components:
  schemas:
    Announcement:
      type: object
      description: Объявление
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор объявления
        announcement_type:
          type: string
          enum:
            - GAME_NEWS
            - PATCH_NOTES
            - MAINTENANCE
            - EVENT
            - PROMOTION
            - COMMUNITY
            - EMERGENCY
          description: Тип объявления
        priority:
          type: string
          enum:
            - LOW
            - NORMAL
            - HIGH
            - CRITICAL
          description: Приоритет объявления
        display_style:
          type: string
          enum:
            - NEWS_FEED
            - POPUP
            - MODAL
            - BANNER
            - TOAST
          description: Стиль отображения
        status:
          type: string
          enum:
            - DRAFT
            - SCHEDULED
            - PUBLISHED
            - ARCHIVED
          description: Статус объявления
        title:
          type: string
          description: Заголовок объявления
          maxLength: 255
        content:
          type: string
          description: Содержание объявления
        scheduled_publish_at:
          type: string
          format: date-time
          nullable: true
          description: Запланированное время публикации
        published_at:
          type: string
          format: date-time
          nullable: true
          description: Время публикации
        archived_at:
          type: string
          format: date-time
          nullable: true
          description: Время архивирования
        targeting:
          type: object
          additionalProperties: true
          nullable: true
          description: Критерии таргетинга
        delivery_channels:
          type: array
          items:
            type: string
            enum:
              - IN_GAME_POPUP
              - PUSH_NOTIFICATION
              - EMAIL
              - NEWS_FEED
          description: Каналы доставки
        media:
          type: object
          additionalProperties: true
          nullable: true
          description: Медиа файлы
        created_by:
          type: string
          format: uuid
          description: ID создателя
        created_at:
          type: string
          format: date-time
          description: Время создания
        updated_at:
          type: string
          format: date-time
          description: Время последнего обновления

    ScheduleAnnouncementRequest:
      type: object
      required:
        - scheduled_publish_at
      description: Запрос на планирование публикации
      properties:
        scheduled_publish_at:
          type: string
          format: date-time
          description: Запланированное время публикации
          example: "2025-11-28T10:00:00Z"

