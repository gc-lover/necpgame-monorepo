openapi: 3.0.3
info:
  title: Anti-Cheat Service API
  description: |
    API для обнаружения и предотвращения читерства через серверные проверки скорости,
    позиции, частоты действий и reconciliation.
    
    **Основные возможности:**
    - Speed Hack Detector - обнаружение speed hack
    - Position Validator - валидация позиции
    - Action Rate Limiter - контроль частоты действий
    - Reconciliation Engine - reconciliation клиент-сервер
    - Violation Logger - логирование нарушений
    - Anti-Cheat Monitor - мониторинг нарушений
    - Penalty Manager - управление наказаниями
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com

servers:
  - url: http://localhost:8080/api/v1
    description: Realtime Gateway (локальная разработка)
  - url: https://api.necpgame.com/api/v1
    description: Realtime Gateway (продакшн)

tags:
  - name: Speed Validation
    description: Валидация скорости движения
  - name: Position Validation
    description: Валидация позиции игрока
  - name: Action Rate Validation
    description: Валидация частоты действий
  - name: Reconciliation
    description: Reconciliation клиент-сервер
  - name: Violations
    description: Управление нарушениями
  - name: Monitoring
    description: Мониторинг нарушений
  - name: Penalties
    description: Управление наказаниями

paths:
  /anti-cheat/speed/validate:
    post:
      tags:
        - Speed Validation
      summary: Валидация скорости движения
      description: |
        Проверяет скорость движения игрока на наличие speed hack.
        Рассчитывает скорость на основе расстояния и времени.
      operationId: validateSpeed
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/SpeedValidationRequest'
      responses:
        '200':
          description: Валидация выполнена
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/SpeedValidationResult'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/speed/violations/{player_id}:
    get:
      tags:
        - Speed Validation
      summary: Получить нарушения скорости игрока
      description: |
        Возвращает список нарушений скорости для указанного игрока.
      operationId: getSpeedViolations
      parameters:
        - $ref: 'common.yaml#/components/parameters/PlayerId'
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список нарушений скорости
          content:
            application/json:
              schema:
                type: object
                properties:
                  violations:
                    type: array
                    items:
                      $ref: 'anti-cheat-schemas.yaml#/components/schemas/SpeedViolation'
                  total:
                    type: integer
                    description: Общее количество нарушений
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/position/validate:
    post:
      tags:
        - Position Validation
      summary: Валидация позиции игрока
      description: |
        Проверяет позицию игрока на наличие телепортации или прохождения через стены.
      operationId: validatePosition
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/PositionValidationRequest'
      responses:
        '200':
          description: Валидация выполнена
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/PositionValidationResult'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/position/violations/{player_id}:
    get:
      tags:
        - Position Validation
      summary: Получить нарушения позиции игрока
      description: |
        Возвращает список нарушений позиции для указанного игрока.
      operationId: getPositionViolations
      parameters:
        - $ref: 'common.yaml#/components/parameters/PlayerId'
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список нарушений позиции
          content:
            application/json:
              schema:
                type: object
                properties:
                  violations:
                    type: array
                    items:
                      $ref: 'anti-cheat-schemas.yaml#/components/schemas/PositionViolation'
                  total:
                    type: integer
                    description: Общее количество нарушений
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/action-rate/validate:
    post:
      tags:
        - Action Rate Validation
      summary: Валидация частоты действий
      description: |
        Проверяет частоту действий игрока на наличие макросов или автоматических действий.
      operationId: validateActionRate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/ActionRateValidationRequest'
      responses:
        '200':
          description: Валидация выполнена
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/ActionRateValidationResult'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/action-rate/violations/{player_id}:
    get:
      tags:
        - Action Rate Validation
      summary: Получить нарушения частоты действий игрока
      description: |
        Возвращает список нарушений частоты действий для указанного игрока.
      operationId: getActionRateViolations
      parameters:
        - $ref: 'common.yaml#/components/parameters/PlayerId'
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список нарушений частоты действий
          content:
            application/json:
              schema:
                type: object
                properties:
                  violations:
                    type: array
                    items:
                      $ref: 'anti-cheat-schemas.yaml#/components/schemas/ActionRateViolation'
                  total:
                    type: integer
                    description: Общее количество нарушений
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/reconciliation/compare:
    post:
      tags:
        - Reconciliation
      summary: Сравнение состояний клиент-сервер
      description: |
        Сравнивает клиентское и серверное состояние для reconciliation.
      operationId: compareStates
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/ReconciliationCompareRequest'
      responses:
        '200':
          description: Сравнение выполнено
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/ReconciliationCompareResult'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/reconciliation/resolve:
    post:
      tags:
        - Reconciliation
      summary: Разрешение конфликтов reconciliation
      description: |
        Разрешает конфликты между клиентским и серверным состоянием.
      operationId: resolveReconciliation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/ReconciliationResolveRequest'
      responses:
        '200':
          description: Конфликт разрешён
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/ReconciliationResolveResult'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/violations/log:
    post:
      tags:
        - Violations
      summary: Логирование нарушения
      description: |
        Логирует нарушение античита в систему.
      operationId: logViolation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/ViolationLogRequest'
      responses:
        '200':
          description: Нарушение залогировано
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/ViolationLogResult'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/violations/{player_id}:
    get:
      tags:
        - Violations
      summary: Получить историю нарушений игрока
      description: |
        Возвращает полную историю нарушений для указанного игрока.
      operationId: getPlayerViolations
      parameters:
        - $ref: 'common.yaml#/components/parameters/PlayerId'
        - name: violation_type
          in: query
          required: false
          schema:
            type: string
            enum:
              - SPEED_HACK
              - POSITION_HACK
              - ACTION_RATE_HACK
              - RECONCILIATION_FAILURE
            description: Фильтр по типу нарушения
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: История нарушений
          content:
            application/json:
              schema:
                type: object
                properties:
                  violations:
                    type: array
                    items:
                      $ref: 'anti-cheat-schemas.yaml#/components/schemas/Violation'
                  total:
                    type: integer
                    description: Общее количество нарушений
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/monitoring/stats:
    get:
      tags:
        - Monitoring
      summary: Получить статистику нарушений
      description: |
        Возвращает агрегированную статистику нарушений античита.
      operationId: getMonitoringStats
      parameters:
        - name: time_range
          in: query
          required: false
          schema:
            type: string
            enum:
              - hour
              - day
              - week
              - month
            description: Временной диапазон для статистики
            default: day
      responses:
        '200':
          description: Статистика нарушений
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/MonitoringStats'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/monitoring/alerts:
    get:
      tags:
        - Monitoring
      summary: Получить активные алерты
      description: |
        Возвращает список активных алертов о нарушениях античита.
      operationId: getMonitoringAlerts
      parameters:
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список активных алертов
          content:
            application/json:
              schema:
                type: object
                properties:
                  alerts:
                    type: array
                    items:
                      $ref: 'anti-cheat-schemas.yaml#/components/schemas/MonitoringAlert'
                  total:
                    type: integer
                    description: Общее количество алертов
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/penalties/apply:
    post:
      tags:
        - Penalties
      summary: Применить наказание
      description: |
        Применяет наказание к игроку за нарушения античита.
      operationId: applyPenalty
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/ApplyPenaltyRequest'
      responses:
        '200':
          description: Наказание применено
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/Penalty'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'common.yaml#/components/responses/Forbidden'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/penalties/{player_id}:
    get:
      tags:
        - Penalties
      summary: Получить наказания игрока
      description: |
        Возвращает список наказаний для указанного игрока.
      operationId: getPlayerPenalties
      parameters:
        - $ref: 'common.yaml#/components/parameters/PlayerId'
        - name: active_only
          in: query
          required: false
          schema:
            type: boolean
            description: Только активные наказания
            default: false
      responses:
        '200':
          description: Список наказаний
          content:
            application/json:
              schema:
                type: object
                properties:
                  penalties:
                    type: array
                    items:
                      $ref: 'anti-cheat-schemas.yaml#/components/schemas/Penalty'
                  total:
                    type: integer
                    description: Общее количество наказаний
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /anti-cheat/penalties/revoke:
    post:
      tags:
        - Penalties
      summary: Отменить наказание
      description: |
        Отменяет наказание игрока. Только для администраторов.
      operationId: revokePenalty
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: 'anti-cheat-schemas.yaml#/components/schemas/RevokePenaltyRequest'
      responses:
        '200':
          description: Наказание отменено
          content:
            application/json:
              schema:
                $ref: 'anti-cheat-schemas.yaml#/components/schemas/Penalty'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'common.yaml#/components/responses/Forbidden'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      $ref: "common.yaml#/components/securitySchemes/BearerAuth"

  responses:
    BadRequest:
      $ref: 'common.yaml#/components/responses/BadRequest'
    Unauthorized:
      $ref: 'common.yaml#/components/responses/Unauthorized'
    Forbidden:
      $ref: 'common.yaml#/components/responses/Forbidden'
    NotFound:
      $ref: 'common.yaml#/components/responses/NotFound'
    InternalServerError:
      $ref: 'common.yaml#/components/responses/InternalServerError'

security:
  - BearerAuth: []

