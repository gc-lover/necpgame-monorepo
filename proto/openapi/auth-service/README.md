# Auth Service - Enterprise-Grade Authentication & Authorization

## üìã **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

Auth Service –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã NECPGAME. –°–µ—Ä–≤–∏—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö SOLID/DRY —Å domain inheritance –æ—Ç infrastructure entities.

## üéØ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- **Email/Password**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
- **OAuth Integration**: Google, Discord, Steam –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- **Multi-Factor Authentication**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TOTP –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Email Verification**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ—Å—Å–∏—è–º–∏**
- **JWT Tokens**: Access –∏ refresh —Ç–æ–∫–µ–Ω—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–µ–π
- **Session Monitoring**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Device Management**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–∞ —Å–µ—Å—Å–∏–π —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **Security Audit**: –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- **Rate Limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç brute force –∞—Ç–∞–∫
- **Account Lockout**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö
- **Password Policies**: –°—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª–µ–π
- **Audit Trail**: –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**

```
auth-service/
‚îú‚îÄ‚îÄ main.yaml              # Enterprise-grade —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å domain inheritance
‚îî‚îÄ‚îÄ README.md              # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîó **Domain Inheritance - Infrastructure Entities**

### **–ù–∞—Å–ª–µ–¥—É–µ–º—ã–µ –°—É—â–Ω–æ—Å—Ç–∏**

#### **UserAccountEntity** ‚Üí UserAccount
```yaml
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å–ª–µ–¥—É–µ—Ç 15+ –ø–æ–ª–µ–π:
- id, created_at, updated_at, version
- username, email, password_hash
- account_status, registration_method
- last_login_at, login_count
- two_factor_enabled, recovery_email

# –î–æ–±–∞–≤–ª—è–µ—Ç auth-specific –ø–æ–ª—è:
- auth_provider_data (OAuth IDs)
- last_password_change
- password_reset_tokens
```

#### **SessionEntity** ‚Üí Session
```yaml
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å–ª–µ–¥—É–µ—Ç 10+ –ø–æ–ª–µ–π:
- id, created_at, updated_at, version
- user_id, session_token, ip_address
- user_agent, expires_at, is_active
- security_level, session_metadata

# –î–æ–±–∞–≤–ª—è–µ—Ç auth-specific –ø–æ–ª—è:
- oauth_provider
- mfa_verified
```

#### **AuditLogEntity** ‚Üí AuthAuditLog
```yaml
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å–ª–µ–¥—É–µ—Ç 15+ –ø–æ–ª–µ–π:
- id, created_at, updated_at, version
- event_type, actor_id, resource_type
- action, severity, ip_address
- success, error_message, metadata

# –î–æ–±–∞–≤–ª—è–µ—Ç auth-specific –ø–æ–ª—è:
- user_id
- operation_type (login, logout, register, etc.)
```

## üöÄ **API Endpoints**

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- `POST /auth/login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `POST /auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /auth/verify-email` - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
- `POST /auth/logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `POST /auth/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

### **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–∞—Ä–æ–ª—è**
- `POST /auth/forgot-password` - –ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
- `POST /auth/reset-password` - –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ—Å—Å–∏—è–º–∏**
- `GET /sessions` - –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- `POST /sessions/{id}/revoke` - –û—Ç–∑—ã–≤ —Å–µ—Å—Å–∏–∏

### **OAuth –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- `GET /oauth/{provider}/authorize` - –ò–Ω–∏—Ü–∏–∞—Ü–∏—è OAuth
- `GET/POST /oauth/{provider}/callback` - OAuth callback

## üìä **Performance**

- **P99 Latency**: <50ms –¥–ª—è –≤—Å–µ—Ö endpoints
- **Memory per Instance**: <50KB baseline
- **Concurrent Users**: 10,000+ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **Rate Limiting**: 100 req/min per IP
- **Session Management**: Redis —Å 5min TTL

## üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- **JWT RS256** —Å —Ä–æ—Ç–∞—Ü–∏–µ–π refresh —Ç–æ–∫–µ–Ω–æ–≤
- **bcrypt** —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **Progressive delay** –Ω–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö
- **Account lockout** –ø–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á

### **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
- **Role-Based Access Control** (RBAC)
- **OAuth 2.0** —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã
- **MFA Support** –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Session Security** —Å device fingerprinting

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- **Failed Login Tracking** —Å IP –∏ user agent
- **Audit Logging** –≤—Å–µ—Ö security events
- **Rate Limiting** –Ω–∞ –≤—Å–µ—Ö endpoints
- **Suspicious Activity Detection**

## üß™ **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **Pre-Commit Checks**
```bash
# Lint —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
npx @redocly/cli lint main.yaml

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Go –∫–æ–¥–∞
ogen --target /tmp/codegen --package api --clean main.yaml

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
go test ./...
```

### **Enterprise Requirements**
- [x] **Domain Inheritance**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç infrastructure-entities
- [x] **Zero Duplication**: –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –ø–æ–ª–µ–π
- [x] **Strict Security**: JWT, bcrypt, rate limiting
- [x] **Audit Trail**: –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- [x] **Health Endpoints**: 4 —Ç–∏–ø–∞ health –ø—Ä–æ–≤–µ—Ä–æ–∫
- [x] **Error Handling**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
- [x] **Documentation**: OpenAPI 3.0 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

## üîó **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**

### **–í–Ω–µ—à–Ω–∏–µ –°–µ—Ä–≤–∏—Å—ã**
- **Email Service**: –û—Ç–ø—Ä–∞–≤–∫–∞ verification emails
- **Redis**: Session storage –∏ caching
- **PostgreSQL**: User accounts –∏ audit logs

### **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –°–µ—Ä–≤–∏—Å—ã**
- **User Profile Service**: Extended user data
- **Notification Service**: Security alerts
- **Audit Service**: Centralized audit logging

## üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

### **–ú–µ—Ç—Ä–∏–∫–∏**
- `auth_login_attempts_total` - –û–±—â–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- `auth_login_success_rate` - –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤
- `auth_active_sessions` - –ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- `auth_failed_attempts` - –ù–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- `auth_oauth_usage` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### **Alerts**
- Login failure rate > 5%
- P95 latency > 100ms
- Active sessions > 50,000
- Memory usage > 80%

## üöÄ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**

### **–í–∞–ª–∏–¥–∞—Ü–∏—è**
```bash
npx @redocly/cli lint proto/openapi/auth-service/main.yaml
```

### **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Go –∫–æ–¥–∞**
```bash
ogen --target ../../services/auth-service-go/pkg/api \
  --package api --clean proto/openapi/auth-service/main.yaml
```

### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
```bash
npx @redocly/cli build-docs proto/openapi/auth-service/main.yaml \
  -o docs/index.html
```

## üìû **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**

- **Security Team**: security@necpgame.com
- **DevOps**: devops@necpgame.com
- **Architecture**: architecture@necpgame.com

**–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ Auth Service –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –≤ #auth-service Slack –∫–∞–Ω–∞–ª**

---

*Auth Service –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç enterprise-grade –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –º–∏–ª–ª–∏–æ–Ω–∞+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π NECPGAME*