openapi: 3.0.3
components:
  schemas:
    Avatar:
      description: Complete avatar entity with infrastructure domain inheritance
      type: object
      required:
      - id
      - user_id
      - avatar_type
      - original_filename
      - file_size_bytes
      - content_type
      - storage_path
      - cdn_urls
      - created_at
      - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: Avatar unique identifier
        user_id:
          type: string
          format: uuid
          description: Owner user ID
        avatar_type:
          type: string
          enum:
          - profile
          - character
          - guild
          - custom
          description: Type of avatar
        title:
          type: string
          maxLength: 100
          description: Avatar title
        description:
          type: string
          maxLength: 500
          description: Avatar description
        original_filename:
          type: string
          maxLength: 255
          description: Original uploaded filename
        file_size_bytes:
          type: integer
          minimum: 0
          description: File size in bytes
        content_type:
          type: string
          pattern: ^image/(jpeg|png|gif|webp)$
          description: MIME content type
        dimensions:
          type: object
          required:
          - width
          - height
          properties:
            width:
              type: integer
              minimum: 1
              description: Image width in pixels
            height:
              type: integer
              minimum: 1
              description: Image height in pixels
        storage_path:
          type: string
          description: Internal storage path
        cdn_urls:
          type: object
          description: CDN URLs for different sizes
          properties:
            original:
              type: string
              format: uri
              description: Original size URL
            large:
              type: string
              format: uri
              description: Large size URL (512x512)
            medium:
              type: string
              format: uri
              description: Medium size URL (256x256)
            small:
              type: string
              format: uri
              description: Small size URL (128x128)
            thumbnail:
              type: string
              format: uri
              description: Thumbnail URL (64x64)
        processing_status:
          type: string
          enum:
          - pending
          - processing
          - completed
          - failed
          default: pending
          description: Image processing status
        processing_metadata:
          type: object
          description: Processing results and metadata
          properties:
            processing_time_ms:
              type: integer
              description: Time taken to process image
            compression_ratio:
              type: number
              minimum: 0
              maximum: 1
              description: Compression achieved
            dominant_colors:
              type: array
              items:
                type: string
                pattern: ^#[0-9A-Fa-f]{6}$
              description: Dominant colors in image
            face_detection:
              type: object
              properties:
                faces_detected:
                  type: integer
                  minimum: 0
                  description: Number of faces detected
                face_coordinates:
                  type: array
                  items:
                    type: object
                    properties:
                      x:
                        type: integer
                      y:
                        type: integer
                      width:
                        type: integer
                      height:
                        type: integer
        is_private:
          type: boolean
          default: false
          description: Whether avatar is private
        tags:
          type: array
          items:
            type: string
            maxLength: 50
          description: Avatar tags for organization
        usage_count:
          type: integer
          minimum: 0
          default: 0
          description: Number of times avatar was accessed
        last_accessed_at:
          type: string
          format: date-time
          description: Last access timestamp
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
        version:
          type: integer
          minimum: 1
          default: 1
          description: Optimistic locking version
    AvatarSummary:
      description: Avatar summary for list operations
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Avatar ID
        avatar_type:
          type: string
          enum:
          - profile
          - character
          - guild
          - custom
          description: Avatar type
        title:
          type: string
          description: Avatar title
        thumbnail_url:
          type: string
          format: uri
          description: Thumbnail URL
        file_size_bytes:
          type: integer
          description: File size
        is_private:
          type: boolean
          description: Privacy status
        usage_count:
          type: integer
          description: Usage count
        created_at:
          type: string
          format: date-time
          description: Creation date
    UserAvatarStatistics:
      description: User avatar usage statistics
      type: object
      properties:
        total_avatars:
          type: integer
          description: Total number of avatars
        active_avatars:
          type: integer
          description: Number of active avatars
        total_storage_bytes:
          type: integer
          description: Total storage used
        total_usage_count:
          type: integer
          description: Total usage across all avatars
        avatar_types_breakdown:
          type: object
          additionalProperties:
            type: integer
          description: Count by avatar type
        last_upload_at:
          type: string
          format: date-time
          description: Last avatar upload timestamp
    AvatarUsageAnalytics:
      description: Comprehensive avatar usage analytics
      type: object
      properties:
        time_range:
          type: object
          properties:
            start_date:
              type: string
              format: date-time
            end_date:
              type: string
              format: date-time
        total_uploads:
          type: integer
          description: Total avatar uploads
        total_storage_bytes:
          type: integer
          description: Total storage used
        average_file_size_bytes:
          type: integer
          description: Average file size
        popular_formats:
          type: object
          additionalProperties:
            type: integer
          description: Usage count by image format
        avatar_types_distribution:
          type: object
          additionalProperties:
            type: integer
          description: Distribution by avatar type
        geographic_usage:
          type: array
          items:
            type: object
            properties:
              country:
                type: string
              upload_count:
                type: integer
              storage_bytes:
                type: integer
        performance_metrics:
          type: object
          properties:
            average_upload_time_ms:
              type: number
              description: Average upload processing time
            average_processing_time_ms:
              type: number
              description: Average image processing time
            cdn_hit_rate:
              type: number
              minimum: 0
              maximum: 1
              description: CDN cache hit rate
    StorageCleanupResult:
      description: Result of storage cleanup operation
      type: object
      properties:
        files_processed:
          type: integer
          description: Total files processed
        files_deleted:
          type: integer
          description: Files successfully deleted
        storage_freed_bytes:
          type: integer
          description: Storage space freed
        errors_encountered:
          type: integer
          description: Number of errors during cleanup
        duration_ms:
          type: integer
          description: Operation duration in milliseconds
    BatchOperationResult:
      description: Result of batch operations
      type: object
      properties:
        total_requested:
          type: integer
          description: Total items requested for operation
        successful:
          type: integer
          description: Successfully processed items
        failed:
          type: integer
          description: Failed items
        errors:
          type: array
          items:
            type: object
            properties:
              item_id:
                type: string
                format: uuid
              error_message:
                type: string
          description: Details of failed operations
    UpdateAvatarRequest:
      description: Request payload for updating avatar metadata
      type: object
      properties:
        title:
          type: string
          maxLength: 100
          description: New avatar title
        description:
          type: string
          maxLength: 500
          description: New avatar description
        is_private:
          type: boolean
          description: New privacy setting
        tags:
          type: array
          items:
            type: string
            maxLength: 50
          description: New tags
        version:
          type: integer
          minimum: 1
          description: Current version for optimistic locking
    TransformAvatarRequest:
      description: Request payload for avatar transformation
      type: object
      required:
      - transformations
      properties:
        transformations:
          type: array
          items:
            type: object
            required:
            - type
            properties:
              type:
                type: string
                enum:
                - resize
                - crop
                - rotate
                - filter
                - format_convert
                - quality_adjust
                description: Transformation type
              parameters:
                type: object
                description: Transformation-specific parameters
                additionalProperties: true
          description: List of transformations to apply
        create_new_version:
          type: boolean
          default: true
          description: Whether to create new avatar version
    DuplicateAvatarRequest:
      description: Request payload for avatar duplication
      type: object
      properties:
        new_title:
          type: string
          maxLength: 100
          description: Title for duplicated avatar
        new_description:
          type: string
          maxLength: 500
          description: Description for duplicated avatar
        avatar_type:
          type: string
          enum:
          - profile
          - character
          - guild
          - custom
          description: Type for duplicated avatar
        is_private:
          type: boolean
          description: Privacy setting for duplicate
    BatchDeleteAvatarsRequest:
      description: Request payload for batch avatar deletion
      type: object
      required:
      - avatar_ids
      properties:
        avatar_ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          maxItems: 100
          description: Avatar IDs to delete
        permanent_delete:
          type: boolean
          default: false
          description: Whether to permanently delete (no recovery)
    StorageCleanupRequest:
      description: Request payload for storage cleanup
      type: object
      properties:
        dry_run:
          type: boolean
          default: true
          description: Whether to perform dry run (no actual deletion)
        older_than_days:
          type: integer
          minimum: 1
          default: 30
          description: Delete files older than this many days
        max_files_to_process:
          type: integer
          minimum: 1
          maximum: 10000
          default: 1000
          description: Maximum files to process in one operation
