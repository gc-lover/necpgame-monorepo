openapi: 3.0.3
info:
  title: Clan War Service API
  description: "API для системы клановых войн: объявление войн, управление территориями, бои и награды"
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8092/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

tags:
  - name: War Manager
    description: Управление клановыми войнами
  - name: War Phase Controller
    description: Управление фазами войны
  - name: Territory Manager
    description: Управление территориями
  - name: Battle Manager
    description: Управление сражениями
  - name: Score Calculator
    description: Расчёт очков
  - name: Reward Distributor
    description: Распределение наград
  - name: Alliance Manager
    description: Управление союзами
  - name: War Events
    description: События войны

paths:
  /world/clan-war/declare:
    post:
      tags:
        - War Manager
      summary: Объявить клановую войну
      operationId: declareWar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeclareWarRequest'
      responses:
        '201':
          description: Война объявлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClanWar'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/active:
    get:
      tags:
        - War Manager
      summary: Получить активные войны
      operationId: getActiveWars
      security:
        - BearerAuth: []
      parameters:
        - name: guild_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Активные войны
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActiveWarsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}:
    get:
      tags:
        - War Manager
      summary: Получить информацию о войне
      operationId: getWar
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о войне
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClanWar'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/wars/{war_id}/battles:
    post:
      tags:
        - Battle Manager
      summary: Создать битву за территорию
      operationId: createBattle
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBattleRequest'
      responses:
        '201':
          description: Битва создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarBattle'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags:
        - Battle Manager
      summary: Получить битвы войны
      operationId: getWarBattles
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum:
              - scheduled
              - active
              - completed
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Список битв
          content:
            application/json:
              schema:
                type: object
                properties:
                  battles:
                    type: array
                    items:
                      $ref: '#/components/schemas/WarBattle'
                  total:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/battles/{battle_id}:
    get:
      tags:
        - Battle Manager
      summary: Получить информацию о битве
      operationId: getBattle
      parameters:
        - name: battle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о битве
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarBattle'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Battle Manager
      summary: Запустить битву
      operationId: startBattle
      parameters:
        - name: battle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Битва запущена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarBattle'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/battles/{battle_id}/score:
    post:
      tags:
        - Battle Manager
      summary: Обновить счет битвы
      operationId: updateBattleScore
      parameters:
        - name: battle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBattleScoreRequest'
      responses:
        '200':
          description: Счет обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarBattle'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/wars/{war_id}/resolve:
    post:
      tags:
        - War Manager
      summary: Завершить войну и определить победителя
      operationId: resolveWar
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Война завершена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarResolution'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/territories:
    get:
      tags:
        - Territory Manager
      summary: Получить список территорий
      operationId: getTerritories
      parameters:
        - name: owner_guild_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Список территорий
          content:
            application/json:
              schema:
                type: object
                properties:
                  territories:
                    type: array
                    items:
                      $ref: '#/components/schemas/Territory'
                  total:
                    type: integer
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/territories/{territory_id}:
    get:
      tags:
        - Territory Manager
      summary: Получить информацию о территории
      operationId: getTerritory
      parameters:
        - name: territory_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о территории
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Territory'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/cancel:
    post:
      tags:
        - War Manager
      summary: Отменить войну
      operationId: cancelWar
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelWarRequest'
      responses:
        '200':
          description: Война отменена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClanWar'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/phase:
    get:
      tags:
        - War Phase Controller
      summary: Получить текущую фазу войны
      operationId: getWarPhase
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Фаза войны
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarPhaseResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/phase/transition:
    post:
      tags:
        - War Phase Controller
      summary: Перейти на следующую фазу войны (admin)
      operationId: transitionWarPhase
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitionPhaseRequest'
      responses:
        '200':
          description: Фаза изменена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarPhaseResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/territories/{territory_id}/transfer:
    post:
      tags:
        - Territory Manager
      summary: Передать территорию другому клану
      operationId: transferTerritory
      security:
        - BearerAuth: []
      parameters:
        - name: territory_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferTerritoryRequest'
      responses:
        '200':
          description: Территория передана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Territory'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/battles/create:
    post:
      tags:
        - Battle Manager
      summary: Создать битву за территорию
      operationId: createBattle
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBattleRequest'
      responses:
        '201':
          description: Битва создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarBattle'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/battles/{battle_id}/start:
    post:
      tags:
        - Battle Manager
      summary: Запустить битву
      operationId: startBattle
      security:
        - BearerAuth: []
      parameters:
        - name: battle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartBattleRequest'
      responses:
        '200':
          description: Битва запущена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarBattle'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/battles/active:
    get:
      tags:
        - Battle Manager
      summary: Получить активные битвы
      operationId: getActiveBattles
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: query
          schema:
            type: string
            format: uuid
        - name: territory_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Активные битвы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActiveBattlesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/battles/{battle_id}/end:
    post:
      tags:
        - Battle Manager
      summary: Завершить битву
      operationId: endBattle
      security:
        - BearerAuth: []
      parameters:
        - name: battle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EndBattleRequest'
      responses:
        '200':
          description: Битва завершена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarBattle'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/scores:
    get:
      tags:
        - Score Calculator
      summary: Получить очки войны
      operationId: getWarScores
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Очки войны
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarScoresResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/scores/add:
    post:
      tags:
        - Score Calculator
      summary: Начислить очки за действие
      operationId: addWarScore
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddScoreRequest'
      responses:
        '200':
          description: Очки начислены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddScoreResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/winner:
    get:
      tags:
        - Score Calculator
      summary: Получить победителя войны
      operationId: getWarWinner
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Победитель войны
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarWinnerResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/rewards/distribute:
    post:
      tags:
        - Reward Distributor
      summary: Распределить награды за войну
      operationId: distributeWarRewards
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DistributeRewardsRequest'
      responses:
        '200':
          description: Награды распределены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistributeRewardsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/rewards:
    get:
      tags:
        - Reward Distributor
      summary: Получить награды войны
      operationId: getWarRewards
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Награды войны
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarRewardsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/alliance/invite:
    post:
      tags:
        - Alliance Manager
      summary: Пригласить союзника в войну
      operationId: inviteAlliance
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteAllianceRequest'
      responses:
        '200':
          description: Союзник приглашён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AllianceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/alliance:
    get:
      tags:
        - Alliance Manager
      summary: Получить союзников войны
      operationId: getAlliance
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Союзники войны
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AllianceResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/{war_id}/alliance/remove:
    post:
      tags:
        - Alliance Manager
      summary: Удалить союзника из войны
      operationId: removeAlliance
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RemoveAllianceRequest'
      responses:
        '200':
          description: Союзник удалён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AllianceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/clan-war/events/{war_id}:
    get:
      tags:
        - War Events
      summary: Получить события войны
      operationId: getWarEvents
      security:
        - BearerAuth: []
      parameters:
        - name: war_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: event_type
          in: query
          schema:
            type: string
            enum:
              - clan-war:declared
              - clan-war:phase-changed
              - clan-war:battle-started
              - clan-war:battle-ended
              - clan-war:territory-captured
              - clan-war:ended
              - clan-war:rewards-distributed
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: События войны
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarEventsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    DeclareWarRequest:
      type: object
      required:
        - attacker_clan_id
        - defender_clan_id
      properties:
        attacker_clan_id:
          type: string
          format: uuid
        defender_clan_id:
          type: string
          format: uuid
        ally_guild_ids:
          type: array
          items:
            type: string
            format: uuid

    ClanWar:
      type: object
      properties:
        id:
          type: string
          format: uuid
        attacker_clan_id:
          type: string
          format: uuid
        defender_clan_id:
          type: string
          format: uuid
        ally_guild_ids:
          type: array
          items:
            type: string
            format: uuid
        status:
          type: string
          enum:
            - DECLARED
            - PREPARATION
            - ACTIVE
            - ENDING
            - ENDED
        phase:
          type: string
          enum:
            - PREPARATION
            - ACTIVE
            - ENDING
          nullable: true
        attacker_score:
          type: integer
          default: 0
        defender_score:
          type: integer
          default: 0
        winner_clan_id:
          type: string
          format: uuid
          nullable: true
        allies_attacker:
          type: array
          items:
            type: string
            format: uuid
        allies_defender:
          type: array
          items:
            type: string
            format: uuid
        declared_at:
          type: string
          format: date-time
        preparation_started_at:
          type: string
          format: date-time
          nullable: true
        active_started_at:
          type: string
          format: date-time
          nullable: true
        ended_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateBattleRequest:
      type: object
      required:
        - territory_id
        - battle_type
      properties:
        territory_id:
          type: string
          format: uuid
        war_id:
          type: string
          format: uuid
        battle_type:
          type: string
          enum:
            - TERRITORY_BATTLE
            - SIEGE
            - OPEN_WORLD_PVP
        scheduled_time:
          type: string
          format: date-time
          nullable: true

    WarBattle:
      type: object
      properties:
        id:
          type: string
          format: uuid
        war_id:
          type: string
          format: uuid
        territory_id:
          type: string
          format: uuid
        battle_type:
          type: string
          enum:
            - TERRITORY_BATTLE
            - SIEGE
            - OPEN_WORLD_PVP
        status:
          type: string
          enum:
            - CREATED
            - ACTIVE
            - ENDED
        attacker_score:
          type: integer
          default: 0
        defender_score:
          type: integer
          default: 0
        scheduled_time:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true

    UpdateBattleScoreRequest:
      type: object
      required:
        - side
        - points
      properties:
        side:
          type: string
          enum:
            - attacker
            - defender
        points:
          type: integer
          minimum: 1

    WarResolution:
      type: object
      properties:
        war_id:
          type: string
          format: uuid
        winner_guild_id:
          type: string
          format: uuid
        attacker_score:
          type: integer
        defender_score:
          type: integer
        territories_transferred:
          type: array
          items:
            type: string
            format: uuid
        rewards:
          type: object
          properties:
            winner:
              type: object
              additionalProperties: true
            loser:
              type: object
              additionalProperties: true
        resolved_at:
          type: string
          format: date-time

    Territory:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        owner_clan_id:
          type: string
          format: uuid
          nullable: true
        resource_type:
          type: string
          enum:
            - ORE
            - ENERGY
            - DATA
            - MIXED
        resource_amount:
          type: integer
          default: 0
        defense_level:
          type: integer
          default: 1
        siege_difficulty:
          type: integer
          default: 1
        location_x:
          type: number
          format: float
        location_y:
          type: number
          format: float
        location_z:
          type: number
          format: float
        is_active:
          type: boolean
          default: true
        created_at:
          type: string
          format: date-time
        captured_at:
          type: string
          format: date-time
          nullable: true

    CancelWarRequest:
      type: object
      required:
        - clan_id
      properties:
        clan_id:
          type: string
          format: uuid

    WarPhaseResponse:
      type: object
      properties:
        war_id:
          type: string
          format: uuid
        phase:
          type: string
          enum:
            - PREPARATION
            - ACTIVE
            - ENDING
        phase_started_at:
          type: string
          format: date-time
        next_phase_at:
          type: string
          format: date-time
          nullable: true

    TransitionPhaseRequest:
      type: object
      required:
        - new_phase
      properties:
        new_phase:
          type: string
          enum:
            - PREPARATION
            - ACTIVE
            - ENDING

    TransferTerritoryRequest:
      type: object
      required:
        - new_owner_clan_id
      properties:
        new_owner_clan_id:
          type: string
          format: uuid

    StartBattleRequest:
      type: object
      required:
        - war_id
      properties:
        war_id:
          type: string
          format: uuid

    EndBattleRequest:
      type: object
      required:
        - war_id
      properties:
        war_id:
          type: string
          format: uuid
        winner_clan_id:
          type: string
          format: uuid
          nullable: true

    ActiveWarsResponse:
      type: object
      properties:
        wars:
          type: array
          items:
            $ref: '#/components/schemas/ClanWar'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    ActiveBattlesResponse:
      type: object
      properties:
        battles:
          type: array
          items:
            $ref: '#/components/schemas/WarBattle'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    WarScoresResponse:
      type: object
      properties:
        war_id:
          type: string
          format: uuid
        attacker_score:
          type: integer
        defender_score:
          type: integer
        score_breakdown:
          type: object
          properties:
            territory_battles:
              type: integer
            siege_events:
              type: integer
            kill_score:
              type: integer
            territory_control:
              type: integer

    AddScoreRequest:
      type: object
      required:
        - war_id
        - clan_id
        - score_type
        - score_amount
      properties:
        war_id:
          type: string
          format: uuid
        battle_id:
          type: string
          format: uuid
          nullable: true
        clan_id:
          type: string
          format: uuid
        score_type:
          type: string
          enum:
            - TERRITORY_BATTLE
            - SIEGE_EVENT
            - KILL_SCORE
            - TERRITORY_CONTROL
        score_amount:
          type: integer

    AddScoreResponse:
      type: object
      properties:
        success:
          type: boolean
        war_id:
          type: string
          format: uuid
        clan_id:
          type: string
          format: uuid
        new_score:
          type: integer

    WarWinnerResponse:
      type: object
      properties:
        war_id:
          type: string
          format: uuid
        winner_clan_id:
          type: string
          format: uuid
          nullable: true
        attacker_score:
          type: integer
        defender_score:
          type: integer
        is_draw:
          type: boolean

    DistributeRewardsRequest:
      type: object
      required:
        - war_id
      properties:
        war_id:
          type: string
          format: uuid

    DistributeRewardsResponse:
      type: object
      properties:
        success:
          type: boolean
        war_id:
          type: string
          format: uuid
        rewards_distributed:
          type: array
          items:
            $ref: '#/components/schemas/WarReward'

    WarReward:
      type: object
      properties:
        clan_id:
          type: string
          format: uuid
        reward_type:
          type: string
          enum:
            - WINNER_REWARD
            - LOSER_REWARD
            - PARTICIPATION_REWARD
        reward_amount:
          type: integer
          format: int64
        currency_type:
          type: string

    WarRewardsResponse:
      type: object
      properties:
        war_id:
          type: string
          format: uuid
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/WarReward'

    InviteAllianceRequest:
      type: object
      required:
        - clan_id
        - ally_clan_id
        - role
      properties:
        clan_id:
          type: string
          format: uuid
        ally_clan_id:
          type: string
          format: uuid
        role:
          type: string
          enum:
            - ALLY_ATTACKER
            - ALLY_DEFENDER

    RemoveAllianceRequest:
      type: object
      required:
        - clan_id
        - ally_clan_id
      properties:
        clan_id:
          type: string
          format: uuid
        ally_clan_id:
          type: string
          format: uuid

    AllianceResponse:
      type: object
      properties:
        war_id:
          type: string
          format: uuid
        allies_attacker:
          type: array
          items:
            type: string
            format: uuid
        allies_defender:
          type: array
          items:
            type: string
            format: uuid

    WarEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        war_id:
          type: string
          format: uuid
        event_type:
          type: string
          enum:
            - clan-war:declared
            - clan-war:phase-changed
            - clan-war:battle-started
            - clan-war:battle-ended
            - clan-war:territory-captured
            - clan-war:ended
            - clan-war:rewards-distributed
        event_data:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    WarEventsResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/WarEvent'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    Error:
      type: object
      properties:
        error:
          type: string

  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Forbidden:
      description: Недостаточно прав доступа
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

security:
  - BearerAuth: []

