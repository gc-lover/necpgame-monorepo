openapi: 3.0.3
info:
  title: Combat Acrobatics Advanced Service API
  description: |
    API для продвинутых элементов акробатики (Air Dash, Wall Kick, Vault).
    
    **Основные возможности:**
    - Управление Air Dash (воздушный рывок)
    - Управление Wall Kick (отталкивание от стены)
    - Управление Vault (перепрыгивание через препятствия)
    - Получение состояний продвинутых элементов
    - Определение доступных препятствий для Vault
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8083/api/v1/gameplay/combat/acrobatics
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1/gameplay/combat/acrobatics
    description: Продакшен сервер

tags:
  - name: Air Dash
    description: Воздушный рывок
  - name: Wall Kick
    description: Отталкивание от стены
  - name: Vault
    description: Перепрыгивание через препятствия
  - name: Advanced State
    description: Состояние продвинутых элементов

paths:
  /air-dash:
    post:
      tags:
        - Air Dash
      summary: Выполнить Air Dash
      description: |
        Выполняет воздушный рывок в воздухе. Проверяет доступность
        (заряды, выносливость, кулдаун) и применяет импульс.
      operationId: executeAirDash
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AirDashRequest'
            example:
              direction:
                x: 1.0
                y: 0.5
                z: 0.0
      responses:
        '200':
          description: Air Dash выполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AirDashResponse'
              example:
                dash_id: "aa0e8400-e29b-41d4-a716-446655440000"
                current_charges: 0
                max_charges: 1
                cooldown_until: "2025-12-01T10:00:02Z"
                direction:
                  x: 1.0
                  y: 0.5
                  z: 0.0
                stamina_consumed: 12
                timestamp: "2025-12-01T10:00:00Z"
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /air-dash/available:
    get:
      tags:
        - Air Dash
      summary: Проверить доступность Air Dash
      description: |
        Проверяет, доступен ли Air Dash (в воздухе, есть заряды,
        нет кулдауна, есть выносливость).
      operationId: checkAirDashAvailable
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Статус доступности Air Dash
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AirDashAvailableResponse'
              example:
                is_available: true
                is_in_air: true
                current_charges: 1
                max_charges: 1
                cooldown_active: false
                has_stamina: true
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /air-dash/charges:
    get:
      tags:
        - Air Dash
      summary: Получить количество зарядов Air Dash
      description: |
        Возвращает текущее количество зарядов Air Dash,
        максимальное количество и информацию о кулдауне.
      operationId: getAirDashCharges
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Информация о зарядах Air Dash
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AirDashChargesResponse'
              example:
                current_charges: 1
                max_charges: 1
                cooldown_until: null
                cooldown_remaining: 0
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /wall-kick:
    post:
      tags:
        - Wall Kick
      summary: Выполнить Wall Kick
      description: |
        Выполняет отталкивание от стены во время Wall Run.
        Изменяет направление движения и применяет импульс.
        Может использоваться для цепочки wall runs.
      operationId: executeWallKick
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WallKickRequest'
            example:
              direction:
                x: 0.0
                y: 1.0
                z: 0.5
      responses:
        '200':
          description: Wall Kick выполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WallKickResponse'
              example:
                kick_id: "bb0e8400-e29b-41d4-a716-446655440000"
                chain_count: 1
                max_chain_count: 3
                new_direction:
                  x: 0.0
                  y: 1.0
                  z: 0.5
                stamina_consumed: 8
                timestamp: "2025-12-01T10:00:00Z"
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /wall-kick/available:
    get:
      tags:
        - Wall Kick
      summary: Проверить доступность Wall Kick
      description: |
        Проверяет, доступен ли Wall Kick (активен Wall Run,
        есть выносливость, не превышен лимит цепочек).
      operationId: checkWallKickAvailable
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Статус доступности Wall Kick
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WallKickAvailableResponse'
              example:
                is_available: true
                is_in_wall_run: true
                chain_count: 0
                max_chain_count: 3
                has_stamina: true
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /vault:
    post:
      tags:
        - Vault
      summary: Выполнить Vault
      description: |
        Выполняет перепрыгивание через препятствие. Автоматически
        определяет препятствие или использует указанное.
        Сохраняет инерцию движения и разрешает стрельбу.
      operationId: executeVault
      security:
        - BearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VaultRequest'
            example:
              obstacle_id: "cc0e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Vault выполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VaultResponse'
              example:
                vault_id: "dd0e8400-e29b-41d4-a716-446655440000"
                obstacle_id: "cc0e8400-e29b-41d4-a716-446655440000"
                start_position:
                  x: 10.0
                  y: 0.0
                  z: 20.0
                end_position:
                  x: 12.0
                  y: 0.0
                  z: 20.0
                direction:
                  x: 1.0
                  y: 0.0
                  z: 0.0
                stamina_consumed: 5
                timestamp: "2025-12-01T10:00:00Z"
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /vault/obstacles:
    get:
      tags:
        - Vault
      summary: Получить доступные препятствия для Vault
      description: |
        Возвращает список доступных препятствий для Vault
        в текущей области персонажа.
      operationId: getVaultObstacles
      security:
        - BearerAuth: []
      parameters:
        - name: radius
          in: query
          required: false
          description: Радиус поиска препятствий
          schema:
            type: number
            format: float
            minimum: 0
            default: 10.0
      responses:
        '200':
          description: Список доступных препятствий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObstaclesResponse'
              example:
                obstacles:
                  - obstacle_id: "cc0e8400-e29b-41d4-a716-446655440000"
                    obstacle_type: "barrier"
                    position:
                      x: 10.0
                      y: 0.0
                      z: 20.0
                    dimensions:
                      width: 2.0
                      height: 1.5
                      depth: 0.5
                    material: "metal"
                    is_suitable: true
                total: 1
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /advanced/state:
    get:
      tags:
        - Advanced State
      summary: Получить текущее состояние продвинутых элементов
      description: |
        Возвращает текущее состояние всех продвинутых элементов акробатики:
        Air Dash, Wall Kick, Vault.
      operationId: getAdvancedAcrobaticsState
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Текущее состояние продвинутых элементов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdvancedAcrobaticsStateResponse'
              example:
                air_dash:
                  current_charges: 1
                  max_charges: 1
                  cooldown_until: null
                wall_kick:
                  is_available: false
                  chain_count: 0
                  max_chain_count: 3
                vault:
                  is_active: false
                  was_used: false
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      $ref: 'common.yaml#/components/securitySchemes/BearerAuth'

  schemas:
    AirDashRequest:
      type: object
      required:
        - direction
      properties:
        direction:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Direction3D'

    AirDashResponse:
      type: object
      required:
        - dash_id
        - current_charges
        - max_charges
        - direction
        - stamina_consumed
        - timestamp
      properties:
        dash_id:
          type: string
          format: uuid
          example: "aa0e8400-e29b-41d4-a716-446655440000"
        current_charges:
          type: integer
          description: Текущее количество зарядов
          minimum: 0
          example: 0
        max_charges:
          type: integer
          description: Максимальное количество зарядов
          minimum: 1
          example: 1
        cooldown_until:
          type: string
          format: date-time
          nullable: true
          description: Время окончания кулдауна
          example: "2025-12-01T10:00:02Z"
        direction:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Direction3D'
        stamina_consumed:
          type: integer
          minimum: 0
          example: 12
        timestamp:
          type: string
          format: date-time
          example: "2025-12-01T10:00:00Z"

    AirDashAvailableResponse:
      type: object
      required:
        - is_available
        - is_in_air
        - current_charges
        - max_charges
        - cooldown_active
        - has_stamina
      properties:
        is_available:
          type: boolean
          example: true
        is_in_air:
          type: boolean
          example: true
        current_charges:
          type: integer
          minimum: 0
          example: 1
        max_charges:
          type: integer
          minimum: 1
          example: 1
        cooldown_active:
          type: boolean
          example: false
        has_stamina:
          type: boolean
          example: true

    AirDashChargesResponse:
      type: object
      required:
        - current_charges
        - max_charges
        - cooldown_remaining
      properties:
        current_charges:
          type: integer
          minimum: 0
          example: 1
        max_charges:
          type: integer
          minimum: 1
          example: 1
        cooldown_until:
          type: string
          format: date-time
          nullable: true
          example: null
        cooldown_remaining:
          type: integer
          description: Оставшееся время кулдауна в секундах
          minimum: 0
          example: 0

    WallKickRequest:
      type: object
      required:
        - direction
      properties:
        direction:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Direction3D'

    WallKickResponse:
      type: object
      required:
        - kick_id
        - chain_count
        - max_chain_count
        - new_direction
        - stamina_consumed
        - timestamp
      properties:
        kick_id:
          type: string
          format: uuid
          example: "bb0e8400-e29b-41d4-a716-446655440000"
        chain_count:
          type: integer
          description: Текущее количество цепочек
          minimum: 0
          example: 1
        max_chain_count:
          type: integer
          description: Максимальное количество цепочек
          minimum: 1
          example: 3
        new_direction:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Direction3D'
        stamina_consumed:
          type: integer
          minimum: 0
          example: 8
        timestamp:
          type: string
          format: date-time
          example: "2025-12-01T10:00:00Z"

    WallKickAvailableResponse:
      type: object
      required:
        - is_available
        - is_in_wall_run
        - chain_count
        - max_chain_count
        - has_stamina
      properties:
        is_available:
          type: boolean
          example: true
        is_in_wall_run:
          type: boolean
          example: true
        chain_count:
          type: integer
          minimum: 0
          example: 0
        max_chain_count:
          type: integer
          minimum: 1
          example: 3
        has_stamina:
          type: boolean
          example: true

    VaultRequest:
      type: object
      properties:
        obstacle_id:
          type: string
          format: uuid
          description: ID препятствия (если не указан, определяется автоматически)
          nullable: true
          example: "cc0e8400-e29b-41d4-a716-446655440000"

    VaultResponse:
      type: object
      required:
        - vault_id
        - obstacle_id
        - start_position
        - end_position
        - direction
        - stamina_consumed
        - timestamp
      properties:
        vault_id:
          type: string
          format: uuid
          example: "dd0e8400-e29b-41d4-a716-446655440000"
        obstacle_id:
          type: string
          format: uuid
          example: "cc0e8400-e29b-41d4-a716-446655440000"
        start_position:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Position3D'
        end_position:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Position3D'
        direction:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Direction3D'
        stamina_consumed:
          type: integer
          minimum: 0
          example: 5
        timestamp:
          type: string
          format: date-time
          example: "2025-12-01T10:00:00Z"

    ObstaclesResponse:
      type: object
      required:
        - obstacles
        - total
      properties:
        obstacles:
          type: array
          items:
            $ref: '#/components/schemas/Obstacle'
        total:
          type: integer
          minimum: 0
          example: 1

    Obstacle:
      type: object
      required:
        - obstacle_id
        - obstacle_type
        - position
        - dimensions
        - material
        - is_suitable
      properties:
        obstacle_id:
          type: string
          format: uuid
          example: "cc0e8400-e29b-41d4-a716-446655440000"
        obstacle_type:
          type: string
          enum: [barrier, fence, wall, crate]
          example: "barrier"
        position:
          $ref: 'combat-acrobatics-basic-service.yaml#/components/schemas/Position3D'
        dimensions:
          $ref: '#/components/schemas/Dimensions3D'
        material:
          type: string
          example: "metal"
        is_suitable:
          type: boolean
          example: true

    Dimensions3D:
      type: object
      required:
        - width
        - height
        - depth
      properties:
        width:
          type: number
          format: float
          minimum: 0
          example: 2.0
        height:
          type: number
          format: float
          minimum: 0
          example: 1.5
        depth:
          type: number
          format: float
          minimum: 0
          example: 0.5

    AdvancedAcrobaticsStateResponse:
      type: object
      required:
        - air_dash
        - wall_kick
        - vault
      properties:
        air_dash:
          $ref: '#/components/schemas/AirDashState'
        wall_kick:
          $ref: '#/components/schemas/WallKickState'
        vault:
          $ref: '#/components/schemas/VaultState'

    AirDashState:
      type: object
      required:
        - current_charges
        - max_charges
      properties:
        current_charges:
          type: integer
          minimum: 0
          example: 1
        max_charges:
          type: integer
          minimum: 1
          example: 1
        cooldown_until:
          type: string
          format: date-time
          nullable: true
          example: null

    WallKickState:
      type: object
      required:
        - is_available
        - chain_count
        - max_chain_count
      properties:
        is_available:
          type: boolean
          example: false
        chain_count:
          type: integer
          minimum: 0
          example: 0
        max_chain_count:
          type: integer
          minimum: 1
          example: 3

    VaultState:
      type: object
      required:
        - is_active
        - was_used
      properties:
        is_active:
          type: boolean
          example: false
        was_used:
          type: boolean
          example: false

  responses:
    BadRequest:
      $ref: 'common.yaml#/components/responses/BadRequest'
    Unauthorized:
      $ref: 'common.yaml#/components/responses/Unauthorized'
    InternalServerError:
      $ref: 'common.yaml#/components/responses/InternalServerError'

