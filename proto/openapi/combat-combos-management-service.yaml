openapi: 3.0.3
info:
  title: Combat Combos Management Service API
  description: |
    API для управления лоадаутами комбо, scoring и аналитики.

    **Основные возможности:**
    - Управление лоадаутами комбо
    - Отправка результатов scoring
    - Получение аналитики эффективности
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8083/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

tags:
  - name: Combo Loadouts
    description: Управление лоадаутами комбо
  - name: Combo Scoring
    description: Система scoring комбо
  - name: Combo Analytics
    description: Аналитика эффективности комбо

paths:
  /gameplay/combat/combos/loadout:
    get:
      tags:
        - Combo Loadouts
      summary: Получить лоадаут комбо персонажа
      description: |
        Возвращает текущий лоадаут комбо для персонажа,
        включая активные комбо и настройки.
      operationId: getComboLoadout
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: ID персонажа
          example: "550e8400-e29b-41d4-a716-446655440003"
      responses:
        "200":
          description: Лоадаут комбо
          content:
            application/json:
              schema:
                $ref: "combat-combos-schemas.yaml#/components/schemas/ComboLoadout"
              example:
                id: "550e8400-e29b-41d4-a716-446655440006"
                character_id: "550e8400-e29b-41d4-a716-446655440003"
                active_combos:
                  - "550e8400-e29b-41d4-a716-446655440000"
                  - "550e8400-e29b-41d4-a716-446655440007"
                preferences:
                  auto_activate: false
                  priority_order:
                    - "550e8400-e29b-41d4-a716-446655440000"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          description: Лоадаут не найден
          content:
            application/json:
              schema:
                $ref: "common.yaml#/components/schemas/Error"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

    post:
      tags:
        - Combo Loadouts
      summary: Обновить лоадаут комбо
      description: |
        Обновляет лоадаут комбо для персонажа.
        Устанавливает активные комбо и настройки.
      operationId: updateComboLoadout
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "combat-combos-schemas.yaml#/components/schemas/UpdateLoadoutRequest"
            example:
              character_id: "550e8400-e29b-41d4-a716-446655440003"
              active_combos:
                - "550e8400-e29b-41d4-a716-446655440000"
                - "550e8400-e29b-41d4-a716-446655440007"
              preferences:
                auto_activate: false
                priority_order:
                  - "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: Лоадаут обновлен
          content:
            application/json:
              schema:
                $ref: "combat-combos-schemas.yaml#/components/schemas/ComboLoadout"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /gameplay/combat/combos/score:
    post:
      tags:
        - Combo Scoring
      summary: Отправить результаты scoring комбо
      description: |
        Отправляет результаты scoring для активированного комбо.
        Система рассчитывает общий score и определяет категорию (Bronze/Silver/Gold/Platinum/Legendary).
        Может выдать награды на основе score.
      operationId: submitComboScore
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "combat-combos-schemas.yaml#/components/schemas/SubmitScoreRequest"
            example:
              activation_id: "550e8400-e29b-41d4-a716-446655440005"
              execution_difficulty: 85
              damage_output: 5000
              visual_impact: 90
              team_coordination: 75
      responses:
        "200":
          description: Score отправлен
          content:
            application/json:
              schema:
                $ref: "combat-combos-schemas.yaml#/components/schemas/ScoreSubmissionResponse"
              example:
                success: true
                score:
                  activation_id: "550e8400-e29b-41d4-a716-446655440005"
                  execution_difficulty: 85
                  damage_output: 5000
                  visual_impact: 90
                  team_coordination: 75
                  total_score: 7500
                  category: "Gold"
                rewards:
                  experience: 500
                  currency: 100
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          description: Активация не найдена
          content:
            application/json:
              schema:
                $ref: "common.yaml#/components/schemas/Error"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /gameplay/combat/combos/analytics:
    get:
      tags:
        - Combo Analytics
      summary: Получить аналитику эффективности комбо
      description: |
        Возвращает аналитику эффективности комбо за указанный период.
        Включает статистику активаций, успешность, средний score, используемые синергии.
      operationId: getComboAnalytics
      security:
        - BearerAuth: []
      parameters:
        - name: combo_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по ID комбо
        - name: character_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по ID персонажа
        - name: period_start
          in: query
          schema:
            type: string
            format: date-time
          description: Начало периода
        - name: period_end
          in: query
          schema:
            type: string
            format: date-time
          description: Конец периода
        - $ref: "common.yaml#/components/parameters/Limit"
        - $ref: "common.yaml#/components/parameters/Offset"
      responses:
        "200":
          description: Аналитика комбо
          content:
            application/json:
              schema:
                $ref: "combat-combos-schemas.yaml#/components/schemas/AnalyticsResponse"
              example:
                analytics:
                  - combo_id: "550e8400-e29b-41d4-a716-446655440000"
                    total_activations: 1250
                    success_rate: 0.85
                    average_score: 6500
                    average_category: "Gold"
                    most_used_synergies:
                      - synergy_id: "550e8400-e29b-41d4-a716-446655440002"
                        synergy_type: "ability"
                        usage_count: 800
                    chain_combo_count: 150
                period_start: "2025-11-01T00:00:00Z"
                period_end: "2025-11-29T23:59:59Z"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

components:
  securitySchemes:
    BearerAuth:
      $ref: "common.yaml#/components/securitySchemes/BearerAuth"

security:
  - BearerAuth: []
