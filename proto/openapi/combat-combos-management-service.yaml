openapi: 3.0.3
info:
  title: Combat Combos Management Service API
  description: API для управления лоадаутами комбо, scoring и аналитики
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8083
    description: Локальный сервер разработки
  - url: https://api.necp.game
    description: Продакшен сервер

tags:
  - name: Combo Loadout
    description: Лоадауты комбо
  - name: Combo Scoring
    description: Scoring и оценка комбо
  - name: Combo Analytics
    description: Аналитика комбо

paths:
  /api/v1/gameplay/combat/combos/loadout:
    get:
      tags:
        - Combo Loadout
      summary: Получить лоадаут комбо
      description: Возвращает текущий лоадаут комбо персонажа
      operationId: getComboLoadout
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: ID персонажа
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
      responses:
        "200":
          description: Лоадаут комбо
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComboLoadout"
              examples:
                loadout:
                  summary: Пример лоадаута
                  value:
                    character_id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                    active_combos:
                      - combo_id: "b2c3d4e5-f6a7-8901-2345-678901bcdef0"
                        slot: 1
                        auto_activate: true
                      - combo_id: "c3d4e5f6-a7b8-9012-3456-789012cdef01"
                        slot: 2
                        auto_activate: false
                    preferences:
                      notification_enabled: true
                      chain_priority: "damage"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "common.yaml#/components/responses/NotFound"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

    post:
      tags:
        - Combo Loadout
      summary: Обновить лоадаут комбо
      description: Обновляет настройки лоадаута комбо персонажа
      operationId: updateComboLoadout
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateComboLoadoutRequest"
            examples:
              update_combos:
                summary: Обновление активных комбо
                value:
                  character_id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                  active_combos:
                    - combo_id: "d4e5f6a7-b8c9-0123-4567-890123def012"
                      slot: 1
                      auto_activate: true
                    - combo_id: "e5f6a7b8-c9d0-1234-5678-901234ef0123"
                      slot: 2
                      auto_activate: false
              update_preferences:
                summary: Обновление настроек
                value:
                  character_id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                  preferences:
                    notification_enabled: false
                    chain_priority: "speed"
      responses:
        "200":
          description: Лоадаут обновлен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateComboLoadoutResponse"
              examples:
                success:
                  summary: Успешное обновление
                  value:
                    success: true
                    updated_loadout:
                      character_id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                      active_combos:
                        - combo_id: "d4e5f6a7-b8c9-0123-4567-890123def012"
                          slot: 1
                          auto_activate: true
                    message: "Loadout updated successfully"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "common.yaml#/components/responses/NotFound"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /api/v1/gameplay/combat/combos/score:
    post:
      tags:
        - Combo Scoring
      summary: Отправить результаты scoring
      description: Отправляет результаты scoring для оценки выполненного комбо
      operationId: submitComboScore
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ComboScoreSubmissionRequest"
            examples:
              high_score:
                summary: Высокий score
                value:
                  activation_id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                  character_id: "b2c3d4e5-f6a7-8901-2345-678901bcdef0"
                  execution_difficulty: 85
                  damage_output: 5000
                  visual_impact: 90
                  team_coordination: 75
              low_score:
                summary: Низкий score
                value:
                  activation_id: "c3d4e5f6-a7b8-9012-3456-789012cdef01"
                  character_id: "d4e5f6a7-b8c9-0123-4567-890123def012"
                  execution_difficulty: 45
                  damage_output: 1200
                  visual_impact: 50
                  team_coordination: 0
      responses:
        "200":
          description: Score принят
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComboScoreResponse"
              examples:
                platinum:
                  summary: Platinum категория
                  value:
                    success: true
                    total_score: 8750
                    category: "Platinum"
                    rewards:
                      experience: 500
                      currency: 100
                    message: "Outstanding performance!"
                silver:
                  summary: Silver категория
                  value:
                    success: true
                    total_score: 2950
                    category: "Silver"
                    rewards:
                      experience: 150
                      currency: 25
                    message: "Good job!"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "common.yaml#/components/responses/NotFound"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /api/v1/gameplay/combat/combos/analytics:
    get:
      tags:
        - Combo Analytics
      summary: Получить метрики эффективности
      description: Возвращает аналитические метрики по комбо персонажа
      operationId: getComboAnalytics
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: ID персонажа
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
        - name: from_time
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Начало периода (ISO 8601)
          example: "2025-11-01T00:00:00Z"
        - name: to_time
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Конец периода (ISO 8601)
          example: "2025-11-30T23:59:59Z"
        - name: combo_type
          in: query
          required: false
          schema:
            type: string
            enum:
              - solo
              - team
              - legendary
          description: Фильтр по типу комбо
      responses:
        "200":
          description: Аналитические данные
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComboAnalyticsResponse"
              examples:
                analytics:
                  summary: Пример аналитики
                  value:
                    character_id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                    period:
                      from: "2025-11-01T00:00:00Z"
                      to: "2025-11-30T23:59:59Z"
                    total_activations: 142
                    successful_activations: 128
                    success_rate: 90.14
                    average_score: 4250
                    top_combos:
                      - combo_id: "b2c3d4e5-f6a7-8901-2345-678901bcdef0"
                        name: "Aerial Devastation"
                        activation_count: 35
                        average_score: 5200
                      - combo_id: "c3d4e5f6-a7b8-9012-3456-789012cdef01"
                        name: "Shadow Strike"
                        activation_count: 28
                        average_score: 4800
                    synergy_stats:
                      ability_synergies: 42
                      equipment_synergies: 18
                      team_synergies: 15
                    chain_combos: 24
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "common.yaml#/components/responses/NotFound"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

components:
  securitySchemes:
    BearerAuth:
      $ref: "common.yaml#/components/securitySchemes/BearerAuth"

  schemas:
    ComboLoadout:
      type: object
      required:
        - character_id
        - active_combos
      properties:
        character_id:
          type: string
          format: uuid
          description: ID персонажа
        active_combos:
          type: array
          items:
            $ref: "#/components/schemas/ActiveCombo"
          description: Активные комбо в лоадауте
        preferences:
          type: object
          description: Настройки лоадаута
          properties:
            notification_enabled:
              type: boolean
              default: true
            chain_priority:
              type: string
              enum:
                - damage
                - speed
                - control
              default: damage

    ActiveCombo:
      type: object
      required:
        - combo_id
        - slot
      properties:
        combo_id:
          type: string
          format: uuid
          description: ID комбо
        slot:
          type: integer
          minimum: 1
          maximum: 10
          description: Слот в лоадауте
        auto_activate:
          type: boolean
          default: false
          description: Автоматическая активация

    UpdateComboLoadoutRequest:
      type: object
      required:
        - character_id
      properties:
        character_id:
          type: string
          format: uuid
          description: ID персонажа
        active_combos:
          type: array
          items:
            $ref: "#/components/schemas/ActiveCombo"
          description: Новые активные комбо
        preferences:
          type: object
          description: Новые настройки
          properties:
            notification_enabled:
              type: boolean
            chain_priority:
              type: string
              enum:
                - damage
                - speed
                - control

    UpdateComboLoadoutResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Успешность обновления
        updated_loadout:
          $ref: "#/components/schemas/ComboLoadout"
        message:
          type: string
          description: Дополнительное сообщение

    ComboScoreSubmissionRequest:
      type: object
      required:
        - activation_id
        - character_id
        - execution_difficulty
        - damage_output
        - visual_impact
      properties:
        activation_id:
          type: string
          format: uuid
          description: ID активации комбо
        character_id:
          type: string
          format: uuid
          description: ID персонажа
        execution_difficulty:
          type: integer
          minimum: 0
          maximum: 100
          description: Сложность исполнения (0-100)
        damage_output:
          type: integer
          minimum: 0
          description: Выданный урон
        visual_impact:
          type: integer
          minimum: 0
          maximum: 100
          description: Визуальный эффект (0-100)
        team_coordination:
          type: integer
          minimum: 0
          maximum: 100
          default: 0
          description: Координация команды (0-100)

    ComboScoreResponse:
      type: object
      required:
        - success
        - total_score
        - category
      properties:
        success:
          type: boolean
          description: Успешность оценки
        total_score:
          type: integer
          minimum: 0
          description: Общий score
        category:
          type: string
          enum:
            - Bronze
            - Silver
            - Gold
            - Platinum
            - Legendary
          description: Категория score
        rewards:
          type: object
          description: Награды за комбо
          properties:
            experience:
              type: integer
              minimum: 0
            currency:
              type: integer
              minimum: 0
        message:
          type: string
          description: Дополнительное сообщение

    ComboAnalyticsResponse:
      type: object
      required:
        - character_id
        - total_activations
        - successful_activations
        - success_rate
      properties:
        character_id:
          type: string
          format: uuid
          description: ID персонажа
        period:
          type: object
          description: Период аналитики
          properties:
            from:
              type: string
              format: date-time
            to:
              type: string
              format: date-time
        total_activations:
          type: integer
          minimum: 0
          description: Всего активаций
        successful_activations:
          type: integer
          minimum: 0
          description: Успешных активаций
        success_rate:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: Процент успешности
        average_score:
          type: integer
          minimum: 0
          description: Средний score
        top_combos:
          type: array
          items:
            $ref: "#/components/schemas/TopComboStat"
          description: Топ комбо
        synergy_stats:
          type: object
          description: Статистика синергий
          properties:
            ability_synergies:
              type: integer
              minimum: 0
            equipment_synergies:
              type: integer
              minimum: 0
            team_synergies:
              type: integer
              minimum: 0
            implant_synergies:
              type: integer
              minimum: 0
            timing_synergies:
              type: integer
              minimum: 0
        chain_combos:
          type: integer
          minimum: 0
          description: Количество chain-комбо

    TopComboStat:
      type: object
      required:
        - combo_id
        - name
        - activation_count
      properties:
        combo_id:
          type: string
          format: uuid
          description: ID комбо
        name:
          type: string
          description: Название комбо
        activation_count:
          type: integer
          minimum: 0
          description: Количество активаций
        average_score:
          type: integer
          minimum: 0
          description: Средний score

security:
  - BearerAuth: []



