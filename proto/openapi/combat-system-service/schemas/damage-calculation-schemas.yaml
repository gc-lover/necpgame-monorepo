# Damage Calculation Schemas - Domain Separation
# Handles damage calculation and resolution logic
# Issue: #2231

openapi: 3.0.3
info:
  title: Damage Calculation Schemas
  version: 1.0.0
  description: Domain-separated schemas for damage calculation engine

components:
  schemas:

    DamageCalculationRequest:
      type: object
      required: [attacker_id, defender_id, weapon_id, hit_location]
      properties:
        attacker_id:
          type: string
          format: uuid
          description: Attacking entity identifier
        defender_id:
          type: string
          format: uuid
          description: Defending entity identifier
        weapon_id:
          type: string
          description: Weapon or ability identifier
        hit_location:
          type: string
          enum: [head, torso, left_arm, right_arm, left_leg, right_leg]
          description: Body part hit location
        base_damage:
          type: integer
          minimum: 0
          maximum: 10000
          description: Base weapon damage before modifiers
        attacker_stats:
          $ref: '#/components/schemas/EntityStats'
        defender_stats:
          $ref: '#/components/schemas/EntityStats'
        environmental_factors:
          $ref: '#/components/schemas/EnvironmentalFactors'
        modifiers:
          type: array
          items:
            $ref: '#/components/schemas/DamageModifier'
          description: Additional damage modifiers to apply

    EntityStats:
      type: object
      required: [level, strength, defense, armor_rating]
      properties:
        level:
          type: integer
          minimum: 1
          maximum: 100
        strength:
          type: integer
          minimum: 0
          maximum: 1000
        defense:
          type: integer
          minimum: 0
          maximum: 1000
        armor_rating:
          type: integer
          minimum: 0
          maximum: 1000
        critical_chance:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          default: 0.05
        critical_multiplier:
          type: number
          format: float
          minimum: 1.0
          maximum: 3.0
          default: 1.5

    EnvironmentalFactors:
      type: object
      properties:
        weather_condition:
          type: string
          enum: [clear, rain, snow, fog, storm]
          description: Current weather affecting damage
        time_of_day:
          type: string
          enum: [dawn, day, dusk, night]
          description: Time of day affecting visibility and damage
        terrain_type:
          type: string
          enum: [open, urban, forest, mountain, water]
          description: Terrain type affecting positioning
        cover_type:
          type: string
          enum: [none, light, medium, heavy]
          description: Cover type affecting damage reduction

    DamageModifier:
      type: object
      required: [type, value]
      properties:
        type:
          type: string
          enum: [additive, multiplicative, percentage, fixed]
          description: How the modifier is applied
        value:
          type: number
          format: float
          description: Modifier value
        source:
          type: string
          enum: [weapon, ability, implant, environmental, status_effect]
          description: Source of the modifier
        description:
          type: string
          description: Human-readable description of the modifier

    DamageCalculationResponse:
      type: object
      required: [total_damage, final_damage, critical_hit, modifiers_applied]
      properties:
        total_damage:
          type: integer
          minimum: 0
          description: Total calculated damage before armor
        final_damage:
          type: integer
          minimum: 0
          description: Final damage after all reductions
        critical_hit:
          type: boolean
          description: Whether this was a critical hit
        modifiers_applied:
          type: array
          items:
            $ref: '#/components/schemas/AppliedModifier'
          description: List of all modifiers that were applied
        damage_breakdown:
          type: object
          properties:
            base_damage:
              type: integer
              description: Base weapon damage
            critical_multiplier:
              type: number
              format: float
              description: Critical hit multiplier applied
            armor_reduction:
              type: integer
              description: Damage reduced by armor
            environmental_modifier:
              type: number
              format: float
              description: Environmental damage modifier
        calculation_metadata:
          type: object
          properties:
            processing_time_ms:
              type: integer
              description: Time taken to calculate damage
            rules_version:
              type: integer
              description: Combat rules version used
            calculation_id:
              type: string
              format: uuid
              description: Unique calculation identifier

    AppliedModifier:
      type: object
      required: [modifier, value_change]
      properties:
        modifier:
          $ref: '#/components/schemas/DamageModifier'
        value_change:
          type: number
          format: float
          description: How much this modifier changed the damage
        order:
          type: integer
          description: Order in which modifier was applied