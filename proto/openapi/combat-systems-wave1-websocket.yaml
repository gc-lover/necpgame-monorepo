# Issue: #169
openapi: 3.0.3
info:
  title: Combat Systems Wave 1 WebSocket API
  version: 1.0.0
  description: |
    WebSocket API for real-time combat interactions in MMOFPS RPG.

    ## WebSocket Channels

    ### Session Channels
    - `/ws/combat/session/{session_id}` - Session state updates
    - `/ws/combat/session/{session_id}/players` - Player state broadcasts
    - `/ws/combat/session/{session_id}/ai` - AI state updates

    ### Ability Channels
    - `/ws/combat/abilities/{character_id}` - Ability activation events
    - `/ws/combat/abilities/{character_id}/cooldowns` - Cooldown updates

    ### Shooting Channels
    - `/ws/combat/shooting/{session_id}` - Hit validation and damage
    - `/ws/combat/shooting/{session_id}/ballistics` - Trajectory updates

    ### Combo Channels
    - `/ws/combat/combos/{character_id}` - Combo progress and synergies

    ### Freerun Channels
    - `/ws/combat/freerun/{character_id}` - Movement state updates

    ### Hacking Channels
    - `/ws/combat/hacking/{character_id}` - Hack progress and results

    ### Stealth Channels
    - `/ws/combat/stealth/{character_id}` - Visibility and detection updates

    ### Extraction Channels
    - `/ws/combat/extraction/{session_id}` - Extraction progress

    ### Arena Channels
    - `/ws/combat/arena/{match_id}` - Match state and scores

    ### Cyberspace Channels
    - `/ws/combat/cyberspace/{character_id}` - Digital realm interactions

    ## Performance Requirements
    - Sub-100ms latency for critical updates
    - 1000+ concurrent connections per server
    - Efficient binary message encoding
    - Connection pooling and load balancing

servers:
  - url: ws://localhost:8101
    description: Local development WebSocket
  - url: wss://ws.necpgame.com
    description: Production WebSocket

tags:
  - name: sessions
    description: Session state synchronization
  - name: abilities
    description: Real-time ability updates
  - name: shooting
    description: Shooting and damage events
  - name: combos
    description: Combo execution updates
  - name: freerun
    description: Movement synchronization
  - name: hacking
    description: Hacking progress updates
  - name: stealth
    description: Stealth state updates
  - name: extraction
    description: Extraction events
  - name: arena
    description: Arena match updates
  - name: cyberspace
    description: Cyberspace interactions

paths:
  /ws/combat/session/{session_id}:
    get:
      tags: [sessions]
      summary: Session state WebSocket channel
      operationId: connectSessionChannel
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                session_update:
                  summary: Session state update
                  value:
                    type: "session.update"
                    data:
                      session_id: "123e4567-e89b-12d3-a456-426614174000"
                      status: "active"
                      player_count: 4
                      score: 15420
                player_joined:
                  summary: Player joined session
                  value:
                    type: "player.joined"
                    data:
                      player_id: "123e4567-e89b-12d3-a456-426614174001"
                      character_name: "V"
                      position: {x: 100.5, y: 200.3, z: 50.0}

  /ws/combat/session/{session_id}/ai:
    get:
      tags: [sessions]
      summary: AI state updates channel
      operationId: connectAISessionChannel
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: AI WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                ai_spawned:
                  summary: AI enemy spawned
                  value:
                    type: "ai.spawned"
                    data:
                      ai_id: "123e4567-e89b-12d3-a456-426614174002"
                      profile_type: "turret"
                      position: {x: 150.0, y: 175.5, z: 25.0}
                      health: 100
                ai_damaged:
                  summary: AI took damage
                  value:
                    type: "ai.damaged"
                    data:
                      ai_id: "123e4567-e89b-12d3-a456-426614174002"
                      damage: 25
                      health_remaining: 75
                      attacker_id: "123e4567-e89b-12d3-a456-426614174001"

  /ws/combat/abilities/{character_id}:
    get:
      tags: [abilities]
      summary: Ability activation channel
      operationId: connectAbilityChannel
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Ability WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                ability_activated:
                  summary: Ability activated
                  value:
                    type: "ability.activated"
                    data:
                      ability_id: "123e4567-e89b-12d3-a456-426614174003"
                      ability_name: "Sandevistan"
                      duration: 8.0
                      cooldown: 30.0
                ability_cooldown:
                  summary: Ability cooldown update
                  value:
                    type: "ability.cooldown"
                    data:
                      ability_id: "123e4567-e89b-12d3-a456-426614174003"
                      remaining: 15.5

  /ws/combat/shooting/{session_id}:
    get:
      tags: [shooting]
      summary: Shooting events channel
      operationId: connectShootingChannel
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Shooting WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                hit_validated:
                  summary: Hit validation result
                  value:
                    type: "shooting.hit_validated"
                    data:
                      shooter_id: "123e4567-e89b-12d3-a456-426614174001"
                      target_id: "123e4567-e89b-12d3-a456-426614174002"
                      weapon_id: "123e4567-e89b-12d3-a456-426614174004"
                      damage: 85
                      hit_type: "headshot"
                      critical: true
                ballistic_trajectory:
                  summary: Ballistic calculation result
                  value:
                    type: "shooting.ballistic_trajectory"
                    data:
                      weapon_id: "123e4567-e89b-12d3-a456-426614174004"
                      start_position: {x: 100.0, y: 200.0, z: 10.0}
                      end_position: {x: 150.0, y: 180.0, z: 15.0}
                      ricochet: true
                      penetration: false

  /ws/combat/combos/{character_id}:
    get:
      tags: [combos]
      summary: Combo execution channel
      operationId: connectComboChannel
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Combo WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                combo_progress:
                  summary: Combo sequence progress
                  value:
                    type: "combo.progress"
                    data:
                      combo_id: "123e4567-e89b-12d3-a456-426614174005"
                      sequence: ["light_attack", "light_attack", "heavy_attack"]
                      current_step: 2
                      success: true
                      damage_multiplier: 1.8
                synergy_activated:
                  summary: Combo synergy triggered
                  value:
                    type: "combo.synergy_activated"
                    data:
                      combo_id: "123e4567-e89b-12d3-a456-426614174005"
                      synergy_type: "berserk_boost"
                      bonus_damage: 50
                      duration: 5.0

  /ws/combat/freerun/{character_id}:
    get:
      tags: [freerun]
      summary: Freerun movement channel
      operationId: connectFreerunChannel
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Freerun WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                movement_update:
                  summary: Freerun movement update
                  value:
                    type: "freerun.movement"
                    data:
                      character_id: "123e4567-e89b-12d3-a456-426614174001"
                      move_type: "wall_run"
                      start_position: {x: 100.0, y: 200.0, z: 5.0}
                      end_position: {x: 120.0, y: 200.0, z: 15.0}
                      momentum: 25.5
                      stamina_cost: 10
                air_dash_executed:
                  summary: Air dash executed
                  value:
                    type: "freerun.air_dash"
                    data:
                      character_id: "123e4567-e89b-12d3-a456-426614174001"
                      direction: {x: 0.7, y: 0.3, z: 0.2}
                      distance: 15.0
                      cooldown: 3.0

  /ws/combat/hacking/{character_id}:
    get:
      tags: [hacking]
      summary: Hacking progress channel
      operationId: connectHackingChannel
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Hacking WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                hack_started:
                  summary: Hack attempt started
                  value:
                    type: "hacking.started"
                    data:
                      target_id: "123e4567-e89b-12d3-a456-426614174006"
                      hack_type: "quickhack"
                      target_system: "turret"
                      duration: 2.5
                hack_completed:
                  summary: Hack completed successfully
                  value:
                    type: "hacking.completed"
                    data:
                      target_id: "123e4567-e89b-12d3-a456-426614174006"
                      success: true
                      effects: ["stunned", "disabled"]
                      detection_risk: 0.15

  /ws/combat/stealth/{character_id}:
    get:
      tags: [stealth]
      summary: Stealth state channel
      operationId: connectStealthChannel
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Stealth WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                visibility_changed:
                  summary: Stealth visibility changed
                  value:
                    type: "stealth.visibility_changed"
                    data:
                      character_id: "123e4567-e89b-12d3-a456-426614174001"
                      visibility_level: 0.3
                      detection_risk: 0.1
                      reason: "crouched_behind_cover"
                detected:
                  summary: Character detected
                  value:
                    type: "stealth.detected"
                    data:
                      character_id: "123e4567-e89b-12d3-a456-426614174001"
                      detector_id: "123e4567-e89b-12d3-a456-426614174002"
                      detection_type: "camera"
                      alert_level: "high"

  /ws/combat/extraction/{session_id}:
    get:
      tags: [extraction]
      summary: Extraction progress channel
      operationId: connectExtractionChannel
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Extraction WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                extraction_started:
                  summary: Extraction attempt started
                  value:
                    type: "extraction.started"
                    data:
                      session_id: "123e4567-e89b-12d3-a456-426614174000"
                      extraction_point: "alpha"
                      team_members: ["123e4567-e89b-12d3-a456-426614174001"]
                      time_limit: 180
                extraction_progress:
                  summary: Extraction progress update
                  value:
                    type: "extraction.progress"
                    data:
                      session_id: "123e4567-e89b-12d3-a456-426614174000"
                      progress: 0.75
                      enemies_remaining: 2
                      time_remaining: 45

  /ws/combat/arena/{match_id}:
    get:
      tags: [arena]
      summary: Arena match channel
      operationId: connectArenaChannel
      parameters:
        - name: match_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Arena WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                match_started:
                  summary: Arena match started
                  value:
                    type: "arena.match_started"
                    data:
                      match_id: "123e4567-e89b-12d3-a456-426614174007"
                      players: ["p1", "p2", "p3", "p4"]
                      arena_type: "deathmatch"
                      time_limit: 600
                score_update:
                  summary: Score update
                  value:
                    type: "arena.score_update"
                    data:
                      match_id: "123e4567-e89b-12d3-a456-426614174007"
                      scores:
                        p1: 5
                        p2: 3
                        p3: 7
                        p4: 2

  /ws/combat/cyberspace/{character_id}:
    get:
      tags: [cyberspace]
      summary: Cyberspace interaction channel
      operationId: connectCyberspaceChannel
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "101":
          description: Cyberspace WebSocket connection established
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebSocketMessage"
              examples:
                cyberspace_entered:
                  summary: Entered cyberspace
                  value:
                    type: "cyberspace.entered"
                    data:
                      character_id: "123e4567-e89b-12d3-a456-426614174001"
                      node_id: "netrunner_hub"
                      connection_strength: 0.95
                      time_remaining: 120
                hack_executed:
                  summary: Cyberspace hack executed
                  value:
                    type: "cyberspace.hack_executed"
                    data:
                      character_id: "123e4567-e89b-12d3-a456-426614174001"
                      target_system: "corporate_firewall"
                      success: true
                      data_stolen: 50000

components:
  schemas:
    WebSocketMessage:
      type: object
      required: [type, timestamp, data]
      properties:
        type:
          type: string
          description: Message type identifier
          examples:
            - "session.update"
            - "player.joined"
            - "ai.spawned"
            - "ability.activated"
            - "shooting.hit_validated"
            - "combo.synergy_activated"
            - "freerun.air_dash"
            - "hacking.completed"
            - "stealth.detected"
            - "extraction.progress"
            - "arena.score_update"
            - "cyberspace.hack_executed"
        timestamp:
          type: string
          format: date-time
          description: Message timestamp
        data:
          type: object
          description: Message payload (varies by type)
          additionalProperties: true

    Vector3:
      type: object
      required: [x, y, z]
      properties:
        x:
          type: number
        y:
          type: number
        z:
          type: number