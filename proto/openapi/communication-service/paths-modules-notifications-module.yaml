# Notifications Module - Social Domain
# This module handles user notifications, alerts, and communication

tags:
  - name: Notifications
    description: User notification management and delivery

paths:
  /notifications:
    get:
      summary: Get user notifications
      operationId: getNotifications
      tags:
        - Notifications
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [ system, guild, party, friend, quest, combat, social ]
        - name: read
          in: query
          schema:
            type: boolean
        - name: priority
          in: query
          schema:
            type: string
            enum: [ low, medium, high, critical ]
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of notifications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationsListResponse'

    post:
      summary: Send notification
      operationId: sendNotification
      tags:
        - Notifications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendNotificationRequest'
      responses:
        '201':
          description: Notification sent successfully

  /notifications/{notification_id}:
    parameters:
      - name: notification_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      summary: Get specific notification
      operationId: getNotification
      tags:
        - Notifications
      responses:
        '200':
          description: Notification details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'

    put:
      summary: Mark notification as read/unread
      operationId: updateNotification
      tags:
        - Notifications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                read:
                  type: boolean
      responses:
        '200':
          description: Notification updated successfully

    delete:
      summary: Delete notification
      operationId: deleteNotification
      tags:
        - Notifications
      responses:
        '204':
          description: Notification deleted successfully

  /notifications/bulk/mark-read:
    post:
      summary: Mark multiple notifications as read
      operationId: bulkMarkRead
      tags:
        - Notifications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                notification_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Notifications marked as read

  /notifications/settings:
    get:
      summary: Get notification settings
      operationId: getNotificationSettings
      tags:
        - Notifications
      responses:
        '200':
          description: User notification settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettings'

    put:
      summary: Update notification settings
      operationId: updateNotificationSettings
      tags:
        - Notifications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationSettings'
      responses:
        '200':
          description: Settings updated successfully

  /notifications/stats:
    get:
      summary: Get notification statistics
      operationId: getNotificationStats
      tags:
        - Notifications
      responses:
        '200':
          description: Notification statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationStatsResponse'

components:
  schemas:
    Notification:
      type: object
      required:
        - id
        - type
        - title
        - message
        - created_at
        - priority
      properties:
        id:
          type: string
          format: uuid
          description: Notification unique identifier
        type:
          type: string
          enum:
            - system
            - guild
            - party
            - friend
            - quest
            - combat
            - social
          description: Type of notification
          example: guild
        title:
          type: string
          maxLength: 200
          description: Notification title
          example: Guild Invitation
        message:
          type: string
          maxLength: 1000
          description: Notification message content
          example: You have been invited to join the Shadow Hunters guild
        priority:
          type: string
          enum: [ low, medium, high, critical ]
          description: Notification priority level
          example: medium
        read:
          type: boolean
          description: Whether notification has been read
          example: false
        read_at:
          type: string
          format: date-time
          description: When notification was read
        created_at:
          type: string
          format: date-time
          description: Notification creation timestamp
          example: '2025-12-20T10:00:00Z'
        expires_at:
          type: string
          format: date-time
          description: When notification expires
        sender_id:
          type: string
          format: uuid
          description: ID of the sender (user or system)
        recipient_id:
          type: string
          format: uuid
          description: ID of the recipient
        metadata:
          type: object
          description: Additional notification data
          additionalProperties: true
        actions:
          type: array
          items:
            type: object
            properties:
              label:
                type: string
              action:
                type: string
              url:
                type: string

    SendNotificationRequest:
      type: object
      required:
        - recipient_id
        - type
        - title
        - message
      properties:
        recipient_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [ system, guild, party, friend, quest, combat, social ]
        title:
          type: string
          maxLength: 200
        message:
          type: string
          maxLength: 1000
        priority:
          type: string
          enum: [ low, medium, high, critical ]
          default: medium
        expires_at:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
        actions:
          type: array
          items:
            type: object
            properties:
              label:
                type: string
              action:
                type: string
              url:
                type: string

    NotificationResponse:
      type: object
      properties:
        notification:
          $ref: '#/components/schemas/Notification'

    NotificationsListResponse:
      type: object
      properties:
        notifications:
          type: array
          items:
            $ref: '#/components/schemas/Notification'
        pagination:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            total:
              type: integer
            total_pages:
              type: integer
        unread_count:
          type: integer
          description: Total unread notifications count

    NotificationSettings:
      type: object
      properties:
        email_enabled:
          type: boolean
          default: true
        push_enabled:
          type: boolean
          default: true
        in_game_enabled:
          type: boolean
          default: true
        notification_types:
          type: object
          properties:
            system:
              type: object
              properties:
                enabled:
                  type: boolean
                  default: true
                priority_threshold:
                  type: string
                  enum: [ low, medium, high, critical ]
                  default: medium
            guild:
              type: object
              properties:
                enabled:
                  type: boolean
                  default: true
                priority_threshold:
                  type: string
                  enum: [ low, medium, high, critical ]
                  default: low
            party:
              type: object
              properties:
                enabled:
                  type: boolean
                  default: true
                priority_threshold:
                  type: string
                  enum: [ low, medium, high, critical ]
                  default: medium
            friend:
              type: object
              properties:
                enabled:
                  type: boolean
                  default: true
                priority_threshold:
                  type: string
                  enum: [ low, medium, high, critical ]
                  default: low
            quest:
              type: object
              properties:
                enabled:
                  type: boolean
                  default: true
                priority_threshold:
                  type: string
                  enum: [ low, medium, high, critical ]
                  default: medium
            combat:
              type: object
              properties:
                enabled:
                  type: boolean
                  default: true
                priority_threshold:
                  type: string
                  enum: [ low, medium, high, critical ]
                  default: high
            social:
              type: object
              properties:
                enabled:
                  type: boolean
                  default: true
                priority_threshold:
                  type: string
                  enum: [ low, medium, high, critical ]
                  default: low

    NotificationStatsResponse:
      type: object
      properties:
        total_sent:
          type: integer
        total_delivered:
          type: integer
        total_read:
          type: integer
        delivery_rate:
          type: number
          minimum: 0
          maximum: 1
        read_rate:
          type: number
          minimum: 0
          maximum: 1
        by_type:
          type: object
          additionalProperties:
            type: object
            properties:
              sent:
                type: integer
              delivered:
                type: integer
              read:
                type: integer
