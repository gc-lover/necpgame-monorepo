openapi: 3.0.3
info:
  title: Companion Service API
  description: API для системы компаньонов: боевые дроны, утилитарные помощники, питомцы
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8091/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

paths:
  /gameplay/companions/available:
    get:
      tags:
        - Companion Manager
      summary: Получить доступные компаньоны
      operationId: getAvailableCompanions
      security:
        - BearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
            enum:
              - COMBAT_DRONE
              - UTILITY
              - SOCIAL_PET
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Список доступных компаньонов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvailableCompanionsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/purchase:
    post:
      tags:
        - Companion Manager
      summary: Купить компаньона
      operationId: purchaseCompanion
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurchaseCompanionRequest'
      responses:
        '200':
          description: Компаньон куплен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/owned/{player_id}:
    get:
      tags:
        - Companion Manager
      summary: Получить компаньонов игрока
      operationId: getOwnedCompanions
      security:
        - BearerAuth: []
      parameters:
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: category
          in: query
          schema:
            type: string
            enum:
              - COMBAT_DRONE
              - UTILITY
              - SOCIAL_PET
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Компаньоны игрока
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OwnedCompanionsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}:
    get:
      tags:
        - Companion Manager
      summary: Получить информацию о компаньоне
      operationId: getCompanion
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о компаньоне
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/summon:
    post:
      tags:
        - Companion Summon
      summary: Призвать компаньона
      operationId: summonCompanion
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SummonCompanionRequest'
      responses:
        '200':
          description: Компаньон призван
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/dismiss:
    post:
      tags:
        - Companion Summon
      summary: Отозвать компаньона
      operationId: dismissCompanion
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DismissCompanionRequest'
      responses:
        '200':
          description: Компаньон отозван
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/active/{player_id}:
    get:
      tags:
        - Companion Summon
      summary: Получить активного компаньона игрока
      operationId: getActiveCompanion
      security:
        - BearerAuth: []
      parameters:
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Активный компаньон
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
          nullable: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/add-xp:
    post:
      tags:
        - Companion Progression
      summary: Добавить опыт компаньону
      operationId: addCompanionXP
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddXPRequest'
      responses:
        '200':
          description: Опыт добавлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/progression:
    get:
      tags:
        - Companion Progression
      summary: Получить прогрессию компаньона
      operationId: getCompanionProgression
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Прогрессия компаньона
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanionProgressionResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/abilities:
    get:
      tags:
        - Companion Abilities
      summary: Получить способности компаньона
      operationId: getCompanionAbilities
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: ability_type
          in: query
          schema:
            type: string
            enum:
              - ACTIVE
              - PASSIVE
      responses:
        '200':
          description: Способности компаньона
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanionAbilitiesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/abilities/{ability_id}/use:
    post:
      tags:
        - Companion Abilities
      summary: Использовать способность компаньона
      operationId: useCompanionAbility
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: ability_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UseAbilityRequest'
      responses:
        '200':
          description: Способность использована
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilityUsageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/rename:
    post:
      tags:
        - Companion Customization
      summary: Переименовать компаньона
      operationId: renameCompanion
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RenameCompanionRequest'
      responses:
        '200':
          description: Компаньон переименован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/equip:
    post:
      tags:
        - Companion Customization
      summary: Экипировать предмет компаньону
      operationId: equipCompanionItem
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EquipCompanionItemRequest'
      responses:
        '200':
          description: Предмет экипирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/customize:
    post:
      tags:
        - Companion Customization
      summary: Кастомизировать компаньона
      operationId: customizeCompanion
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomizeCompanionRequest'
      responses:
        '200':
          description: Компаньон кастомизирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/combat/attack:
    post:
      tags:
        - Companion Combat
      summary: Команда атаки компаньона
      operationId: companionAttack
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanionAttackRequest'
      responses:
        '200':
          description: Атака выполнена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanionAttackResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/{companion_id}/combat/defend:
    post:
      tags:
        - Companion Combat
      summary: Команда защиты компаньона
      operationId: companionDefend
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanionDefendRequest'
      responses:
        '200':
          description: Защита активирована
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanionDefendResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/shop/catalog:
    get:
      tags:
        - Companion Shop
      summary: Получить каталог магазина компаньонов
      operationId: getCompanionShopCatalog
      security:
        - BearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
            enum:
              - COMBAT_DRONE
              - UTILITY
              - SOCIAL_PET
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Каталог магазина
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanionShopCatalogResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/shop/{companion_id}:
    get:
      tags:
        - Companion Shop
      summary: Получить детали компаньона в магазине
      operationId: getCompanionShopDetails
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Детали компаньона
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanionType'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/shop/purchase:
    post:
      tags:
        - Companion Shop
      summary: Купить компаньона из магазина
      operationId: purchaseCompanionFromShop
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurchaseCompanionRequest'
      responses:
        '200':
          description: Компаньон куплен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCompanion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gameplay/companions/events/{companion_id}:
    get:
      tags:
        - Companion Events
      summary: Получить события компаньона
      operationId: getCompanionEvents
      security:
        - BearerAuth: []
      parameters:
        - name: companion_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: event_type
          in: query
          schema:
            type: string
            enum:
              - companion:purchased
              - companion:summoned
              - companion:dismissed
              - companion:level-up
              - companion:ability-used
              - companion:customized
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: События компаньона
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanionEventsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    CompanionType:
      type: object
      properties:
        id:
          type: string
          format: uuid
        code:
          type: string
          maxLength: 50
        name:
          type: string
          maxLength: 255
        category:
          type: string
          enum:
            - COMBAT_DRONE
            - UTILITY
            - SOCIAL_PET
        subcategory:
          type: string
          maxLength: 100
        description:
          type: string
        base_health:
          type: integer
        base_damage:
          type: integer
        base_xp:
          type: integer
        max_level:
          type: integer
          default: 50
        abilities:
          type: array
          items:
            $ref: '#/components/schemas/CompanionAbility'
        stats:
          type: object
          additionalProperties: true
        cost:
          type: integer
          format: int64
        is_active:
          type: boolean
          default: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CompanionAbility:
      type: object
      properties:
        id:
          type: string
          format: uuid
        companion_type_id:
          type: string
          format: uuid
        ability_type:
          type: string
          enum:
            - ACTIVE
            - PASSIVE
        code:
          type: string
          maxLength: 50
        name:
          type: string
          maxLength: 255
        description:
          type: string
        cooldown_seconds:
          type: integer
          nullable: true
        effects:
          type: object
          additionalProperties: true
        is_active:
          type: boolean
          default: true

    PlayerCompanion:
      type: object
      properties:
        id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        companion_type_id:
          type: string
          format: uuid
        companion_type:
          $ref: '#/components/schemas/CompanionType'
        name:
          type: string
          maxLength: 255
        level:
          type: integer
          minimum: 1
          maximum: 50
          default: 1
        experience:
          type: integer
          minimum: 0
          default: 0
        experience_to_next_level:
          type: integer
          minimum: 0
        health:
          type: integer
        damage:
          type: integer
        is_summoned:
          type: boolean
          default: false
        summoned_at:
          type: string
          format: date-time
          nullable: true
        equipment:
          type: object
          additionalProperties: true
          nullable: true
        customization:
          type: object
          additionalProperties: true
          nullable: true
        purchased_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PurchaseCompanionRequest:
      type: object
      required:
        - player_id
        - companion_type_id
      properties:
        player_id:
          type: string
          format: uuid
        companion_type_id:
          type: string
          format: uuid

    SummonCompanionRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    DismissCompanionRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    AddXPRequest:
      type: object
      required:
        - player_id
        - amount
        - source
      properties:
        player_id:
          type: string
          format: uuid
        amount:
          type: integer
          minimum: 1
        source:
          type: string
          maxLength: 100
          enum:
            - enemy_killed
            - combat_assistance
            - loot_collected
            - hack_completed
            - craft_completed

    UseAbilityRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid
        target_id:
          type: string
          format: uuid
          nullable: true

    RenameCompanionRequest:
      type: object
      required:
        - player_id
        - name
      properties:
        player_id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
          maxLength: 255

    EquipCompanionItemRequest:
      type: object
      required:
        - player_id
        - item_id
      properties:
        player_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        slot:
          type: string

    CustomizeCompanionRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid
        customization:
          type: object
          additionalProperties: true

    CompanionAttackRequest:
      type: object
      required:
        - player_id
        - target_id
      properties:
        player_id:
          type: string
          format: uuid
        target_id:
          type: string
          format: uuid

    CompanionDefendRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    AvailableCompanionsResponse:
      type: object
      properties:
        companions:
          type: array
          items:
            $ref: '#/components/schemas/CompanionType'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    OwnedCompanionsResponse:
      type: object
      properties:
        player_id:
          type: string
          format: uuid
        companions:
          type: array
          items:
            $ref: '#/components/schemas/PlayerCompanion'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    CompanionProgressionResponse:
      type: object
      properties:
        companion_id:
          type: string
          format: uuid
        level:
          type: integer
        experience:
          type: integer
        experience_to_next_level:
          type: integer
        health:
          type: integer
        damage:
          type: integer
        leveled_up:
          type: boolean

    CompanionAbilitiesResponse:
      type: object
      properties:
        companion_id:
          type: string
          format: uuid
        abilities:
          type: array
          items:
            $ref: '#/components/schemas/CompanionAbility'

    AbilityUsageResponse:
      type: object
      properties:
        success:
          type: boolean
        ability_id:
          type: string
          format: uuid
        cooldown_until:
          type: string
          format: date-time
          nullable: true
        effects_applied:
          type: object
          additionalProperties: true

    CompanionAttackResponse:
      type: object
      properties:
        success:
          type: boolean
        damage_dealt:
          type: integer
        target_id:
          type: string
          format: uuid

    CompanionDefendResponse:
      type: object
      properties:
        success:
          type: boolean
        defense_active:
          type: boolean
        defense_duration_seconds:
          type: integer

    CompanionShopCatalogResponse:
      type: object
      properties:
        companions:
          type: array
          items:
            $ref: '#/components/schemas/CompanionType'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    CompanionEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        companion_id:
          type: string
          format: uuid
        event_type:
          type: string
          enum:
            - companion:purchased
            - companion:summoned
            - companion:dismissed
            - companion:level-up
            - companion:ability-used
            - companion:customized
        event_data:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    CompanionEventsResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/CompanionEvent'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    Error:
      type: object
      properties:
        error:
          type: string

  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

security:
  - BearerAuth: []

