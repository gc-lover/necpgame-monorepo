objective_updates:
  type: array
  items:
    type: object
    required:
      - objective_id
      - current_value
    properties:
      objective_id:
        type: string
        format: uuid
      current_value:
        type: integer
        minimum: 0
branch_choice:
  type: string
  format: uuid
  description: ID выбранной ветви сценария
responses:
  '200':
    description: Прогресс обновлен
    content:
      application/json:
        schema:
          $ref: 'narrative-player-schemas.yaml#/components/schemas/PlayerScenarioProgress'
  '400':
    $ref: 'common.yaml#/components/responses/BadRequest'
  '404':
    $ref: 'common.yaml#/components/responses/NotFound'

/scenarios/{scenario_id}/complete:
  post:
    tags:
      - Scenarios
    summary: Завершить сценарий
    operationId: completeScenario
    security:
      - BearerAuth: [ ]
    parameters:
      - name: scenario_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                default: true
              completion_notes:
                type: string
                maxLength: 1000
    responses:
      '200':
        description: Сценарий завершен
        content:
          application/json:
            schema:
              type: object
              properties:
                rewards:
                  $ref: 'narrative-player-schemas.yaml#/components/schemas/ScenarioRewards'
                completion_time:
                  type: string
                  format: date-time
      '400':
        $ref: 'common.yaml#/components/responses/BadRequest'
      '404':
        $ref: 'common.yaml#/components/responses/NotFound'

# === СОБЫТИЯ ===

/events/active:
  get:
    tags:
      - Events
    summary: Получение активных narrative событий
    operationId: getActiveEvents
    parameters:
      - name: type
        in: query
        schema:
          type: string
          enum: [ world_event, character_event, faction_event, random_event, time_based ]
      - name: location
        in: query
        schema:
          type: string
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 20
          default: 10
    responses:
      '200':
        description: Активные события
        content:
          application/json:
            schema:
              type: object
              properties:
                events:
                  type: array
                  items:
                    $ref: 'narrative-player-schemas.yaml#/components/schemas/NarrativeEvent'
                total:
                  type: integer

/events/{event_id}:
  get:
    tags:
      - Events
    summary: Получение деталей события
    operationId: getEvent
    parameters:
      - name: event_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Детали события
        content:
          application/json:
            schema:
              $ref: 'narrative-player-schemas.yaml#/components/schemas/NarrativeEvent'
      '404':
        $ref: 'common.yaml#/components/responses/NotFound'

/events/{event_id}/interact:
  post:
    tags:
      - Events
    summary: Взаимодействовать с событием
    operationId: interactWithEvent
    security:
      - BearerAuth: [ ]
    parameters:
      - name: event_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - interaction_type
            properties:
              interaction_type:
                type: string
                enum: [ investigate, participate, ignore, resolve ]
              parameters:
                type: object
                additionalProperties: true
    responses:
      '200':
        description: Результат взаимодействия
        content:
          application/json:
            schema:
              type: object
              properties:
                effects:
                  type: array
                  items:
                    $ref: 'narrative-player-schemas.yaml#/components/schemas/EventEffect'
                new_events:
                  type: array
                  items:
                    type: string
                    format: uuid
                updated_scenario:
                  type: string
                  format: uuid
      '400':
        $ref: 'common.yaml#/components/responses/BadRequest'
      '404':
        $ref: 'common.yaml#/components/responses/NotFound'

# === ПРОГРЕСС ИГРОКА ===

/progress:
  get:
    tags:
      - Progress
    summary: Получение narrative прогресса игрока
    operationId: getPlayerProgress
    security:
      - BearerAuth: [ ]
    responses:
      '200':
        description: Прогресс игрока
        content:
          application/json:
            schema:
              $ref: 'narrative-player-schemas.yaml#/components/schemas/PlayerNarrativeProgress'
      '401':
        $ref: 'common.yaml#/components/responses/Unauthorized'

  put:
    tags:
      - Progress
    summary: Обновление предпочтений игрока
    operationId: updatePlayerPreferences
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              preferred_difficulty:
                type: string
                enum: [ easy, medium, hard ]
              story_tags:
                type: array
                items:
                  type: string
              timeline_focus:
                type: integer
                minimum: 2020
                maximum: 2093
    responses:
      '200':
        description: Предпочтения обновлены
        content:
          application/json:
            schema:
              $ref: 'narrative-player-schemas.yaml#/components/schemas/PlayerNarrativeProgress'
      '400':
        $ref: 'common.yaml#/components/responses/BadRequest'
      '401':
        $ref: 'common.yaml#/components/responses/Unauthorized'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
