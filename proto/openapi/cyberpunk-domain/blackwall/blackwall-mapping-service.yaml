openapi: 3.0.3
info:
  title: Blackwall Mapping Service API
  description: 'API для системы картографии слабых зон Blackwall.

    **Основные возможности:**

    - Активное сканирование барьера Blackwall

    - Обнаружение аномалий и разломов

    - Генерация динамических карт с ложными данными

    - Атмосфера исследования с эффектом зловещей долины

    **Уровни риска:**

    - Surface (поверхностное) - смертность 2-5%

    - Deep (глубокое) - смертность 10-25%

    - Critical (критическое) - смертность 40-60%

    **Классы:**

    - Netrunner - полный доступ, сниженные риски

    - Techie - ограниченный доступ, требуется модификация оборудования

    - Другие классы - минимальный доступ, высокий риск

    '
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necpgame.com
servers:
  - url: http://localhost:8083
    description: Gameplay Service (локальная разработка)
  - url: https://gameplay.necpgame.com
    description: Gameplay Service (продакшн)
tags:
  - name: Mapping
    description: Картография Blackwall
  - name: Scanning
    description: Сканирование барьера
  - name: Maps
    description: Управление картами
paths:
  /api/v1/blackwall/mapping/start:
    post:
      tags:
        - Mapping
      summary: Начало сканирования
      description: 'Начинает сессию активного сканирования барьера Blackwall для картографии слабых зон.

        **Типы сканирования:**

        - surface - Поверхностное (низкий риск, базовые данные)

        - deep - Глубокое (средний риск, детальные данные)

        - critical - Критическое (высокий риск, координаты разломов)

        **Риски:**

        - Обнаружение NetWatch (10-30%)

        - Контакт с rogue AI (5-20%)

        - Цифровое заражение (10-25%)

        - Ложные данные в карте (15-40%)

        '
      operationId: startMappingSession
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartMappingRequest'
            example:
              location_id: 550e8400-e29b-41d4-a716-446655440000
              scan_type: deep
              equipment_ids:
                - 550e8400-e29b-41d4-a716-446655440001
                - 550e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Сессия сканирования начата
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MappingSession'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '403':
          $ref: ../../common-schemas.yaml#/components/responses/Forbidden
  /api/v1/blackwall/mapping/{session_id}/status:
    get:
      tags:
        - Scanning
      summary: Статус сканирования
      description: 'Возвращает текущий статус активной сессии сканирования.

        Включает прогресс, обнаруженные аномалии, уровень стресса и предупреждения.

        '
      operationId: getMappingStatus
      security:
        - BearerAuth: [ ]
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID сессии сканирования
      responses:
        '200':
          description: Статус сессии сканирования
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MappingStatus'
        '404':
          $ref: ../../common-schemas.yaml#/components/responses/NotFound
  /api/v1/blackwall/mapping/{session_id}/analyze-signal:
    post:
      tags:
        - Scanning
      summary: Анализ сигнала
      description: 'Анализирует обнаруженный сигнал (мини-игра).

        Позволяет определить, является ли сигнал реальной аномалией или ложным сигналом.

        **Методы анализа:**

        - basic - Базовый (высокая вероятность ошибки)

        - advanced - Продвинутый (средняя вероятность ошибки)

        - expert - Экспертный (низкая вероятность ошибки)

        '
      operationId: analyzeSignal
      security:
        - BearerAuth: [ ]
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeSignalRequest'
      responses:
        '200':
          description: Результат анализа
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignalAnalysis'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
  /api/v1/blackwall/mapping/{session_id}/complete:
    post:
      tags:
        - Mapping
      summary: Завершение сканирования
      description: 'Завершает сессию сканирования и генерирует карту Blackwall.

        Карта содержит зоны разной опасности и может включать ложные сигналы,

        которые обнаруживаются только при использовании.

        '
      operationId: completeMapping
      security:
        - BearerAuth: [ ]
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Карта создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MappingResult'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
  /api/v1/blackwall/mapping/{session_id}/abort:
    post:
      tags:
        - Mapping
      summary: Прерывание сканирования
      description: 'Экстренное прерывание сканирования (откат).

        Сохраняет частичные данные, но применяет последствия преждевременного прерывания.

        '
      operationId: abortMapping
      security:
        - BearerAuth: [ ]
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Сканирование прервано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbortResult'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '404':
          $ref: ../../common-schemas.yaml#/components/responses/NotFound
  /api/v1/blackwall/maps/{map_id}:
    get:
      tags:
        - Maps
      summary: Получение карты
      description: 'Возвращает сохранённую карту Blackwall.

        Карты устаревают со временем, так как Blackwall адаптируется.

        '
      operationId: getMap
      security:
        - BearerAuth: [ ]
      parameters:
        - name: map_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID карты
      responses:
        '200':
          description: Карта Blackwall
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BlackwallMap'
        '404':
          $ref: ../../common-schemas.yaml#/components/responses/NotFound
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    StartMappingRequest:
      type: object
      required:
        - location_id
        - scan_type
      properties:
        location_id:
          type: string
          format: uuid
          description: ID локации для сканирования
        scan_type:
          type: string
          enum:
            - surface
            - deep
            - critical
          description: Тип сканирования
        equipment_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Список ID оборудования для сканирования
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    MappingSession:
      type: object
      required:
        - session_id
        - status
        - risk_level
      properties:
        session_id:
          type: string
          format: uuid
          description: ID сессии сканирования
        status:
          type: string
          enum:
            - active
          description: Статус сессии
        risk_level:
          type: string
          enum:
            - low
            - medium
            - high
            - extreme
          description: Уровень риска
        warnings:
          type: array
          items:
            type: string
          description: Предупреждения о рисках
          example:
            - High risk of NetWatch detection
            - Possible AI contact detected
        estimated_duration:
          type: integer
          format: int64
          description: Ожидаемая длительность в секундах
          example: 300
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    MappingStatus:
      type: object
      required:
        - progress
        - stress_level
      properties:
        current_zone_type:
          type: string
          enum:
            - safe
            - weak
            - anomaly
            - critical
            - unknown
          description: Тип текущей зоны
        warnings:
          type: array
          items:
            type: string
          description: Активные предупреждения
        progress:
          type: integer
          minimum: 0
          maximum: 100
          description: Прогресс сканирования (0-100%)
        anomalies_detected:
          type: integer
          description: Количество обнаруженных аномалий
        false_signals_detected:
          type: integer
          description: Количество обнаруженных ложных сигналов
        stress_level:
          type: integer
          minimum: 0
          maximum: 100
          description: Уровень стресса (0-100)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AnalyzeSignalRequest:
      type: object
      required:
        - signal_id
        - analysis_method
      properties:
        signal_id:
          type: string
          format: uuid
          description: ID обнаруженного сигнала
        analysis_method:
          type: string
          enum:
            - basic
            - advanced
            - expert
          description: Метод анализа
        skill_check:
          $ref: '#/components/schemas/SkillCheck'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SkillCheck:
      type: object
      required:
        - skill_name
        - skill_value
        - difficulty_class
      properties:
        skill_name:
          type: string
          description: Название навыка
          example: NETRUN
        skill_value:
          type: integer
          description: Значение навыка
          example: 45
        difficulty_class:
          type: integer
          description: Класс сложности
          example: 24
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SignalAnalysis:
      type: object
      required:
        - signal_type
        - confidence
      properties:
        signal_type:
          type: string
          enum:
            - real
            - false_signal
            - trap
          description: Тип сигнала
        zone_info:
          $ref: '#/components/schemas/ZoneInfo'
        confidence:
          type: integer
          minimum: 0
          maximum: 100
          description: Уверенность в результате (0-100%)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ZoneInfo:
      type: object
      properties:
        zone_type:
          type: string
          enum:
            - safe
            - weak
            - anomaly
            - critical
            - unknown
        coordinates:
          type: object
          description: Координаты зоны в киберпространстве
        risk_level:
          type: integer
          minimum: 0
          maximum: 100
        stability:
          type: integer
          minimum: 0
          maximum: 100
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    MappingResult:
      type: object
      required:
        - map_id
        - accuracy
        - zones_detected
      properties:
        map_id:
          type: string
          format: uuid
          description: ID созданной карты
        map_item:
          $ref: '#/components/schemas/MapItem'
        consequences:
          $ref: '#/components/schemas/MappingConsequences'
        accuracy:
          type: integer
          minimum: 0
          maximum: 100
          description: Точность карты (0-100%)
          example: 75
        zones_detected:
          type: integer
          description: Количество обнаруженных зон
        false_zones:
          type: integer
          description: Количество ложных зон (обнаружится при использовании)
        experience_reward:
          type: integer
          description: Начисленный опыт
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    MapItem:
      type: object
      properties:
        item_id:
          type: string
          format: uuid
        rarity:
          type: string
          enum:
            - common
            - uncommon
            - rare
            - epic
            - legendary
        accuracy:
          type: integer
          minimum: 0
          maximum: 100
        zones_revealed:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    MappingConsequences:
      type: object
      properties:
        reputation_changes:
          type: object
          description: Изменения репутации
          additionalProperties:
            type: integer
          example:
            netwatch: -50
            voodoo_boys: 25
        netwatch_detection:
          type: boolean
          description: Было ли обнаружение NetWatch
        ai_contact:
          type: boolean
          description: Был ли контакт с rogue AI
        digital_infection:
          type: boolean
          description: Получено ли цифровое заражение
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbortResult:
      type: object
      properties:
        partial_data:
          type: object
          description: Частичные данные сканирования
        consequences:
          $ref: '#/components/schemas/MappingConsequences'
        experience_partial:
          type: integer
          description: Частичный опыт за прерванное сканирование
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    BlackwallMap:
      type: object
      required:
        - map_id
        - accuracy
        - zones
      properties:
        map_id:
          type: string
          format: uuid
        zones:
          type: array
          items:
            $ref: '#/components/schemas/Zone'
        warnings:
          type: array
          items:
            type: string
          description: Предупреждения об использовании карты
        age:
          type: integer
          format: int64
          description: Возраст карты в секундах
        accuracy:
          type: integer
          minimum: 0
          maximum: 100
        outdated:
          type: boolean
          description: Устарела ли карта
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Zone:
      type: object
      required:
        - zone_id
        - zone_type
        - risk_level
      properties:
        zone_id:
          type: string
          format: uuid
        zone_type:
          type: string
          enum:
            - safe
            - weak
            - anomaly
            - critical
            - unknown
        coordinates:
          type: object
        stability:
          type: integer
          minimum: 0
          maximum: 100
        risk_level:
          type: integer
          minimum: 0
          maximum: 100
        is_false_signal:
          type: boolean
          description: Является ли зона ложным сигналом (определяется при использовании)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
