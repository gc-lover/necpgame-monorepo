# Issue: #171
openapi: 3.0.3
info:
  title: Economy Core Service API
  version: 1.0.0
  description: |
    Economy Core API for MMOFPS RPG - Inventory and P2P Trade Systems.

    ## Core Components
    - Inventory System: Item storage, equipment, transfer operations
    - Trade System: P2P trading sessions with anti-fraud validation
    - Stash System: Extended storage with organization features

    ## Architecture Overview
    - Server-authoritative economy with validation
    - Event-driven architecture with Kafka
    - Anti-fraud checks and audit logging
    - Real-time inventory synchronization

    ## Performance Requirements
    - Inventory operations: 2000+ RPS with P99 <100ms
    - Trade operations: 500+ RPS with P99 <200ms
    - Memory optimized with field alignment
    - Context timeouts for all operations

servers:
  - url: http://localhost:8200
    description: Local development
  - url: https://api.necpgame.com/v1
    description: Production API

tags:
  - name: inventory
    description: Inventory management operations
  - name: equipment
    description: Character equipment system
  - name: stash
    description: Extended storage system
  - name: trade
    description: P2P trading operations
  - name: transfer
    description: Item transfer operations

security:
  - BearerAuth: []

paths:
  # ============================================================================
  # INVENTORY SYSTEM
  # ============================================================================

  /gameplay/economy/inventory/{character_id}/slots:
    get:
      tags: [inventory]
      summary: Get character inventory slots
      operationId: getInventorySlots
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: include_items
          in: query
          schema:
            type: boolean
            default: true
        - $ref: common.yaml#/components/parameters/Limit
      responses:
        "200":
          description: Inventory slots
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/InventorySlot"
        "404":
          $ref: common.yaml#/components/responses/NotFound

    post:
      tags: [inventory]
      summary: Add item to inventory
      operationId: addItemToInventory
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddItemRequest"
      responses:
        "201":
          description: Item added
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InventorySlot"
        "400":
          description: Invalid item or inventory full
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error
        "409":
          description: Item conflicts
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error

  /gameplay/economy/inventory/{character_id}/slots/{slot_id}:
    get:
      tags: [inventory]
      summary: Get specific inventory slot
      operationId: getInventorySlot
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: slot_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Inventory slot details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InventorySlot"
        "404":
          $ref: common.yaml#/components/responses/NotFound

    put:
      tags: [inventory]
      summary: Update inventory slot
      operationId: updateInventorySlot
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: slot_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSlotRequest"
      responses:
        "200":
          description: Slot updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InventorySlot"
        "400":
          $ref: common.yaml#/components/responses/BadRequest

    delete:
      tags: [inventory]
      summary: Remove item from slot
      operationId: removeItemFromSlot
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: slot_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Item removed
        "404":
          $ref: common.yaml#/components/responses/NotFound

  /gameplay/economy/inventory/{character_id}/transfer:
    post:
      tags: [transfer]
      summary: Transfer item between slots
      operationId: transferItem
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransferRequest"
      responses:
        "200":
          description: Transfer completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferResult"
        "400":
          description: Invalid transfer
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error

  # ============================================================================
  # EQUIPMENT SYSTEM
  # ============================================================================

  /gameplay/economy/equipment/{character_id}/slots:
    get:
      tags: [equipment]
      summary: Get character equipment slots
      operationId: getEquipmentSlots
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Equipment slots
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/EquipmentSlot"

  /gameplay/economy/equipment/{character_id}/slots/{slot_type}:
    post:
      tags: [equipment]
      summary: Equip item to slot
      operationId: equipItem
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: slot_type
          in: path
          required: true
          schema:
            type: string
            enum:
              [
                head,
                torso,
                arms,
                legs,
                weapon_primary,
                weapon_secondary,
                cyberware,
              ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EquipRequest"
      responses:
        "200":
          description: Item equipped
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EquipmentSlot"
        "400":
          description: Cannot equip item
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error

    delete:
      tags: [equipment]
      summary: Unequip item from slot
      operationId: unequipItem
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: slot_type
          in: path
          required: true
          schema:
            type: string
            enum:
              [
                head,
                torso,
                arms,
                legs,
                weapon_primary,
                weapon_secondary,
                cyberware,
              ]
      responses:
        "200":
          description: Item unequipped
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnequipResult"

  # ============================================================================
  # STASH SYSTEM
  # ============================================================================

  /gameplay/economy/stash/{character_id}/pages:
    get:
      tags: [stash]
      summary: Get stash pages
      operationId: getStashPages
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - $ref: common.yaml#/components/parameters/Limit
      responses:
        "200":
          description: Stash pages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/StashPage"

  /gameplay/economy/stash/{character_id}/transfer:
    post:
      tags: [stash]
      summary: Transfer item to/from stash
      operationId: stashTransfer
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StashTransferRequest"
      responses:
        "200":
          description: Transfer completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StashTransferResult"

