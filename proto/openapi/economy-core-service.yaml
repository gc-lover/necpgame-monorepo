# Issue: #60
openapi: 3.0.3
info:
  title: Economy Core Service API
  description: |
    API для базовых экономических механик в NECPGAME.
    
    **Основные возможности:**
    - Обзор экономической системы
    - Базовая P2P торговля между игроками
    - Торговые гильдии
    - Управление валютами и ресурсами
    - Влияние экономики на игровой мир
    
    **Валюты:**
    - Eurodollars (ED) - основная валюта
    - PvP Tokens - награды за PvP
    - PvE Credits - награды за PvE
    - Faction Currency - фракционные единицы
    - Regional Currencies - региональные валюты
    
    **Ресурсы:**
    - Базовые материалы
    - Редкие компоненты
    - Крафт-ресурсы
    - Ресурсы для имплантов
    - Информационные ресурсы
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8085/api/v1
    description: Economy Service (локальная разработка)
  - url: https://api.necp.game/api/v1
    description: Economy Service (продакшн)

tags:
  - name: Economy Overview
    description: Обзор экономики
  - name: Currencies
    description: Валюты
  - name: Resources
    description: Ресурсы
  - name: Trading
    description: Базовая торговля
  - name: Trading Guilds
    description: Торговые гильдии
  - name: World Impact
    description: Влияние на мир

paths:
  /economy/overview:
    get:
      tags:
        - Economy Overview
      summary: Получить обзор экономики
      description: |
        Возвращает обзор экономической системы: общий объём торговли, инфляция, курсы валют.
      operationId: getEconomyOverview
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Обзор экономики
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EconomyOverview'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/model:
    get:
      tags:
        - Economy Overview
      summary: Получить информацию о типе экономической модели
      description: Возвращает информацию о типе экономической модели: структура рынков, управление, ценообразование.
      operationId: getEconomyModel
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Информация о типе экономической модели
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EconomyModel'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/currencies:
    get:
      tags:
        - Currencies
      summary: Получить список валют
      description: |
        Возвращает список всех доступных валют в системе.
      operationId: getCurrencies
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Список валют
          content:
            application/json:
              schema:
                type: object
                properties:
                  currencies:
                    type: array
                    items:
                      $ref: '#/components/schemas/Currency'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/currencies/{currency_id}/balance:
    get:
      tags:
        - Currencies
      summary: Получить баланс валюты
      description: |
        Возвращает баланс указанной валюты для персонажа.
      operationId: getCurrencyBalance
      security:
        - BearerAuth: []
      parameters:
        - name: currency_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор валюты
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
      responses:
        '200':
          description: Баланс валюты
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrencyBalance'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/resources:
    get:
      tags:
        - Resources
      summary: Получить каталог ресурсов
      description: |
        Возвращает каталог ресурсов с возможностью фильтрации по типу.
      operationId: getResources
      security:
        - BearerAuth: []
      parameters:
        - name: resource_type
          in: query
          schema:
            type: string
            enum: [basic, rare, craft, implant, information]
          description: Фильтр по типу ресурса
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Каталог ресурсов
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Resource'
                  total:
                    type: integer
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/resources/{resource_id}:
    get:
      tags:
        - Resources
      summary: Получить информацию о ресурсе
      description: |
        Возвращает детальную информацию о ресурсе по его ID.
      operationId: getResourceById
      security:
        - BearerAuth: []
      parameters:
        - name: resource_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор ресурса
      responses:
        '200':
          description: Информация о ресурсе
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Resource'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/resources/category/{category}:
    get:
      tags:
        - Resources
      summary: Получить ресурсы по категории
      description: Возвращает список ресурсов, отфильтрованных по категории (raw_materials, electronics, bio_chem, data_assets).
      operationId: getResourcesByCategory
      security:
        - BearerAuth: []
      parameters:
        - name: category
          in: path
          required: true
          schema:
            type: string
            enum: [raw_materials, electronics, bio_chem, data_assets]
          description: Категория ресурсов
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список ресурсов по категории
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Resource'
                  total:
                    type: integer
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/resources/tier/{tier}:
    get:
      tags:
        - Resources
      summary: Получить ресурсы по tier
      description: Возвращает список ресурсов, отфильтрованных по tier (1-5).
      operationId: getResourcesByTier
      security:
        - BearerAuth: []
      parameters:
        - name: tier
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 5
          description: Tier ресурсов (1-5)
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список ресурсов по tier
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Resource'
                  total:
                    type: integer
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/resources/{resource_id}/price:
    get:
      tags:
        - Resources
      summary: Получить текущую цену ресурса
      description: Возвращает текущую рыночную цену ресурса с историей изменений (опционально).
      operationId: getResourcePrice
      security:
        - BearerAuth: []
      parameters:
        - name: resource_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор ресурса
        - name: include_history
          in: query
          schema:
            type: boolean
            default: false
          description: Включить историю изменений цены
        - name: history_days
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 30
            default: 7
          description: Количество дней истории
      responses:
        '200':
          description: Текущая цена ресурса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourcePrice'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /economy/trade/initiate:
    $ref: 'economy-core-trading-paths.yaml#/paths/~1economy~1trade~1initiate'

  /economy/trade/{trade_id}/accept:
    $ref: 'economy-core-trading-paths.yaml#/paths/~1economy~1trade~1{trade_id}~1accept'

  /economy/trade/{trade_id}/cancel:
    $ref: 'economy-core-trading-paths.yaml#/paths/~1economy~1trade~1{trade_id}~1cancel'

  /economy/guilds:
    $ref: 'economy-core-trading-paths.yaml#/paths/~1economy~1guilds'

  /economy/guilds/create:
    $ref: 'economy-core-trading-paths.yaml#/paths/~1economy~1guilds~1create'

  /economy/guilds/{guild_id}/join:
    $ref: 'economy-core-trading-paths.yaml#/paths/~1economy~1guilds~1{guild_id}~1join'

  /economy/world-impact:
    get:
      tags:
        - World Impact
      summary: Получить влияние экономики на мир
      description: |
        Возвращает информацию о влиянии экономических операций на игровой мир.
      operationId: getWorldImpact
      security:
        - BearerAuth: []
      parameters:
        - name: region_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по региону
      responses:
        '200':
          description: Влияние на мир
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorldImpact'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      $ref: 'common.yaml#/components/securitySchemes/BearerAuth'

  schemas:
    EconomyOverview:
      $ref: 'economy-core-schemas.yaml#/components/schemas/EconomyOverview'
    EconomyModel:
      $ref: 'economy-core-schemas.yaml#/components/schemas/EconomyModel'
    Currency:
      $ref: 'economy-core-schemas.yaml#/components/schemas/Currency'
    CurrencyBalance:
      $ref: 'economy-core-schemas.yaml#/components/schemas/CurrencyBalance'
    Resource:
      $ref: 'economy-core-schemas.yaml#/components/schemas/Resource'
    ResourcePrice:
      $ref: 'economy-core-schemas.yaml#/components/schemas/ResourcePrice'
    PriceHistoryPoint:
      $ref: 'economy-core-schemas.yaml#/components/schemas/PriceHistoryPoint'
    InitiateTradeRequest:
      $ref: 'economy-core-schemas.yaml#/components/schemas/InitiateTradeRequest'
    TradeSession:
      $ref: 'economy-core-schemas.yaml#/components/schemas/TradeSession'
    TradingGuild:
      $ref: 'economy-core-schemas.yaml#/components/schemas/TradingGuild'
    CreateGuildRequest:
      $ref: 'economy-core-schemas.yaml#/components/schemas/CreateGuildRequest'
    WorldImpact:
      $ref: 'economy-core-schemas.yaml#/components/schemas/WorldImpact'

security:
  - BearerAuth: []

