openapi: 3.0.3
info:
  title: Economy Core Service API
  description: |
    Базовые endpoints экономической системы NECPGAME.
    
    **Основные возможности:**
    - Управление валютами (региональные валюты, Eurodollars, PvP/PvE награды)
    - Обмен валют через биржу
    - Каталог ресурсов
    - Торговые маршруты
    - Статус экономики
    
    **Валюты:**
    - Eurodollars (ED) - основная валюта
    - PvP Tokens - PvP награды
    - PvE Credits - PvE награды
    - Faction Currency - фракционные единицы
    - Regional Currencies - региональные валюты
    
    **Ресурсы:**
    - Базовые материалы
    - Редкие компоненты
    - Крафт-ресурсы
    - Ресурсы для имплантов
    - Информационные ресурсы (данные, программы, лицензии, чипы)
    
    **Торговые каналы:**
    - Player Market (рынок игроков)
    - Auction House (аукцион)
    - Direct Trade (прямая торговля)
    
    **Торговые маршруты:**
    - Локальные - внутри региона
    - Региональные - между регионами
    - Фракционные - фракционные коридоры
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com

servers:
  - url: http://localhost:8084
    description: Economy Service (локальная разработка)
  - url: https://economy.necpgame.com
    description: Economy Service (продакшн)

tags:
  - name: Currencies
    description: Валюты
  - name: Exchange
    description: Обмен валют
  - name: Resources
    description: Ресурсы
  - name: Trade Routes
    description: Торговые маршруты
  - name: Status
    description: Статус экономики

paths:
  /api/v1/economy/currencies:
    get:
      tags:
        - Currencies
      summary: Список валют
      description: |
        Возвращает список всех валют в игре.
        
        **Типы валют:**
        - Main (основная) - Eurodollars
        - PvP - PvP Tokens
        - PvE - PvE Credits
        - Faction - фракционные валюты
        - Regional - региональные валюты
      operationId: getCurrencies
      responses:
        "200":
          description: Список валют
          content:
            application/json:
              schema:
                type: object
                properties:
                  currencies:
                    type: array
                    items:
                      $ref: "#/components/schemas/Currency"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

  /api/v1/economy/currencies/balance:
    get:
      tags:
        - Currencies
      summary: Баланс валют
      description: Возвращает баланс всех валют игрока
      operationId: getCurrencyBalance
      responses:
        "200":
          description: Баланс
          content:
            application/json:
              schema:
                type: object
                properties:
                  balances:
                    type: array
                    items:
                      $ref: "#/components/schemas/CurrencyBalance"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

  /api/v1/economy/exchange:
    post:
      tags:
        - Exchange
      summary: Обмен валют
      description: |
        Обменивает одну валюту на другую через биржу.
        
        **Динамическое ценообразование:**
        - Курсы зависят от региона
        - Спрос и предложение влияют на курс
        - Комиссия биржи
      operationId: exchangeCurrency
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExchangeRequest"
      responses:
        "200":
          description: Обмен выполнен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExchangeResult"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

  /api/v1/economy/exchange/rates:
    get:
      tags:
        - Exchange
      summary: Курсы валют
      description: Возвращает текущие курсы валют
      operationId: getExchangeRates
      responses:
        "200":
          description: Курсы валют
          content:
            application/json:
              schema:
                type: object
                properties:
                  rates:
                    type: array
                    items:
                      $ref: "#/components/schemas/ExchangeRate"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

  /api/v1/economy/resources:
    get:
      tags:
        - Resources
      summary: Каталог ресурсов
      description: |
        Возвращает каталог ресурсов.
        
        **Категории:**
        - Basic - базовые материалы
        - Rare - редкие компоненты
        - Craft - крафт-ресурсы
        - Implants - ресурсы для имплантов
        - Info - информационные ресурсы (данные, программы, лицензии)
      operationId: getResources
      parameters:
        - name: category
          in: query
          schema:
            type: string
            enum: [basic, rare, craft, implants, info]
      responses:
        "200":
          description: Каталог ресурсов
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      $ref: "#/components/schemas/Resource"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

  /api/v1/economy/resources/{resource_id}:
    get:
      tags:
        - Resources
      summary: Детали ресурса
      description: Возвращает детальную информацию о ресурсе
      operationId: getResource
      parameters:
        - name: resource_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Детали ресурса
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceDetailed"
        "404":
          $ref: "common.yaml#/components/responses/NotFound"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

  /api/v1/economy/trade/routes:
    get:
      tags:
        - Trade Routes
      summary: Торговые маршруты
      description: |
        Возвращает список торговых маршрутов.
        
        **Типы:**
        - Local - локальные (внутри региона)
        - Regional - региональные (между регионами)
        - Faction - фракционные коридоры
      operationId: getTradeRoutes
      responses:
        "200":
          description: Торговые маршруты
          content:
            application/json:
              schema:
                type: object
                properties:
                  routes:
                    type: array
                    items:
                      $ref: "#/components/schemas/TradeRoute"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

  /api/v1/economy/status:
    get:
      tags:
        - Status
      summary: Статус экономики
      description: |
        Возвращает общий статус экономики.
        
        **Метрики:**
        - Объём торговли
        - Инфляция
        - Самые торгуемые товары
        - Курсы валют
      operationId: getEconomyStatus
      responses:
        "200":
          description: Статус экономики
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EconomyStatus"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
      security:
        - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      $ref: "common.yaml#/components/securitySchemes/BearerAuth"

  schemas:
    Currency:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        code:
          type: string
        type:
          type: string
          enum: [main, pvp, pve, faction, regional]
        region:
          type: string

    CurrencyBalance:
      type: object
      properties:
        currency_id:
          type: string
          format: uuid
        currency_code:
          type: string
        balance:
          type: number

    ExchangeRequest:
      type: object
      required:
        - from_currency
        - to_currency
        - amount
      properties:
        from_currency:
          type: string
          format: uuid
        to_currency:
          type: string
          format: uuid
        amount:
          type: number

    ExchangeResult:
      type: object
      properties:
        from_amount:
          type: number
        to_amount:
          type: number
        rate:
          type: number
        commission:
          type: number

    ExchangeRate:
      type: object
      properties:
        from_currency:
          type: string
        to_currency:
          type: string
        rate:
          type: number
        last_updated:
          type: string
          format: date-time

    Resource:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        category:
          type: string
          enum: [basic, rare, craft, implants, info]
        rarity:
          type: string
        usage:
          type: array
          items:
            type: string

    ResourceDetailed:
      allOf:
        - $ref: "#/components/schemas/Resource"
        - type: object
          properties:
            description:
              type: string
            acquisition_methods:
              type: array
              items:
                type: string
            market_price:
              type: number

    TradeRoute:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [local, regional, faction]
        from_region:
          type: string
        to_region:
          type: string
        risk_level:
          type: string
        profit_margin:
          type: number

    EconomyStatus:
      type: object
      properties:
        trade_volume:
          type: number
        inflation_rate:
          type: number
        top_traded_items:
          type: array
          items:
            type: object
        currency_rates:
          type: object



