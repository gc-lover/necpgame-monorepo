# Issue: #142109968
openapi: 3.0.3
info:
  title: Stock Protection Service Go API
  description: |
    Enterprise-Grade Stock Protection Service API for NECPGAME MMOFPS RPG.

    **Enterprise-Grade Domain:** economy-domain

    **Module:** stock-protection-service-go

    **Purpose:** High-performance stock portfolio protection and risk management

    **BACKEND NOTE:** Struct field alignment optimized (large → small types).

    All schemas ordered for optimal memory layout in generated Go code.

    Expected memory savings: 30-50% for stock-protection-related structs.

    **Features:**

    - Real-time portfolio protection (1000+ RPS)
    - Stop-loss and take-profit orders
    - Circuit breaker mechanisms
    - Risk assessment and alerts
    - Anti-cheat validation for protection orders

    **Performance:** P99 <30ms for protection operations, zero allocations in hot path
  version: 1.0.0
  license:
    name: Proprietary
    url: https://necpgame.com/license
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@stock-protection.necpgame.com
servers:
  - url: http://localhost:8152/api/v1
    description: Stock Protection Service Go (development)
  - url: https://stock-protection-go.necpgame.com/api/v1
    description: Stock Protection Service Go (production)
tags:
  - name: Portfolio Protection
    description: Stock portfolio protection operations
  - name: Risk Management
    description: Risk assessment and management
  - name: Circuit Breakers
    description: Market circuit breaker operations
  - name: Protection Orders
    description: Stop-loss and take-profit orders
security:
  - BearerAuth: [ ]
paths:
  /health:
    get:
      tags:
        - Portfolio Protection
      summary: Service health check
      operationId: getHealth
      security: [ ]
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                    example: "1.0.0"
        '503':
          description: Service unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "unhealthy"
                  error:
                    type: string

  /economy/stock/protection/orders:
    get:
      tags:
        - Protection Orders
      summary: Get user's protection orders
      operationId: getProtectionOrders
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [ active, triggered, cancelled, expired ]
            default: active
          description: Filter by order status
        - name: stock_symbol
          in: query
          schema:
            type: string
          description: Filter by stock symbol
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Number of orders to return
      responses:
        '200':
          description: List of protection orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProtectionOrder'
        '400':
          $ref: '../../../common-schemas.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'
    post:
      tags:
        - Protection Orders
      summary: Create protection order
      operationId: createProtectionOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProtectionOrderRequest'
      responses:
        '201':
          description: Protection order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProtectionOrder'
        '400':
          $ref: '../../../common-schemas.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
        '422':
          description: Invalid order parameters
        '500':
          $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'

  /economy/stock/protection/orders/{order_id}:
    get:
      tags:
        - Protection Orders
      summary: Get protection order details
      operationId: getProtectionOrderDetails
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Protection order unique identifier
      responses:
        '200':
          description: Protection order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProtectionOrder'
        '404':
          description: Protection order not found
        '401':
          $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'
    delete:
      tags:
        - Protection Orders
      summary: Cancel protection order
      operationId: cancelProtectionOrder
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Protection order unique identifier
      responses:
        '204':
          description: Protection order cancelled successfully
        '404':
          description: Protection order not found
        '409':
          description: Cannot cancel triggered order
        '401':
          $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'

  /economy/stock/protection/risk-assessment:
    post:
      tags:
        - Risk Management
      summary: Assess portfolio risk
      operationId: assessPortfolioRisk
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RiskAssessmentRequest'
      responses:
        '200':
          description: Risk assessment results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RiskAssessmentResponse'
        '400':
          $ref: '../../../common-schemas.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'

  /economy/stock/protection/circuit-breakers:
    get:
      tags:
        - Circuit Breakers
      summary: Get active circuit breakers
      operationId: getCircuitBreakers
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [ active, triggered, reset ]
            default: active
          description: Filter by circuit breaker status
      responses:
        '200':
          description: List of circuit breakers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CircuitBreaker'
        '400':
          $ref: '../../../common-schemas.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'

  /economy/stock/protection/alerts:
    get:
      tags:
        - Portfolio Protection
      summary: Get protection alerts
      operationId: getProtectionAlerts
      parameters:
        - name: severity
          in: query
          schema:
            type: string
            enum: [ low, medium, high, critical ]
          description: Filter by alert severity
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Number of alerts to return
      responses:
        '200':
          description: List of protection alerts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProtectionAlert'
        '400':
          $ref: '../../../common-schemas.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'

components:
  schemas:
    ProtectionOrder:
      type: object
      required:
        - id
        - user_id
        - stock_symbol
        - order_type
        - trigger_price
        - quantity
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the protection order
        user_id:
          type: string
          format: uuid
          description: User who owns the order
        stock_symbol:
          type: string
          description: Stock symbol to protect
        order_type:
          type: string
          enum: [ stop_loss, take_profit, trailing_stop ]
          description: Type of protection order
        trigger_price:
          type: number
          format: float
          description: Price at which to trigger the order
        quantity:
          type: integer
          format: int32
          minimum: 1
          description: Number of shares to protect
        status:
          type: string
          enum: [ active, triggered, cancelled, expired ]
          description: Current order status
        triggered_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when order was triggered
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    CreateProtectionOrderRequest:
      type: object
      required:
        - stock_symbol
        - order_type
        - trigger_price
        - quantity
      properties:
        stock_symbol:
          type: string
          description: Stock symbol to protect
        order_type:
          type: string
          enum: [ stop_loss, take_profit, trailing_stop ]
          description: Type of protection order
        trigger_price:
          type: number
          format: float
          description: Price at which to trigger the order
        quantity:
          type: integer
          format: int32
          minimum: 1
          description: Number of shares to protect
        expiration_days:
          type: integer
          format: int32
          minimum: 1
          maximum: 365
          default: 30
          description: Order expiration in days
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    RiskAssessmentRequest:
      type: object
      required:
        - portfolio
      properties:
        portfolio:
          type: array
          items:
            $ref: '#/components/schemas/PortfolioPosition'
          description: List of portfolio positions to assess
        risk_tolerance:
          type: string
          enum: [ conservative, moderate, aggressive ]
          default: moderate
          description: User's risk tolerance level
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    PortfolioPosition:
      type: object
      required:
        - stock_symbol
        - quantity
        - average_price
      properties:
        stock_symbol:
          type: string
          description: Stock symbol
        quantity:
          type: integer
          format: int32
          description: Number of shares held
        average_price:
          type: number
          format: float
          description: Average purchase price
        current_price:
          type: number
          format: float
          description: Current market price
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    RiskAssessmentResponse:
      type: object
      properties:
        overall_risk_level:
          type: string
          enum: [ low, medium, high, extreme ]
          description: Overall portfolio risk level
        risk_factors:
          type: array
          items:
            $ref: '#/components/schemas/RiskFactor'
        recommendations:
          type: array
          items:
            type: string
          description: Risk mitigation recommendations
        diversification_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Portfolio diversification score
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    RiskFactor:
      type: object
      properties:
        factor_type:
          type: string
          enum: [ volatility, concentration, liquidity, correlation ]
          description: Type of risk factor
        severity:
          type: string
          enum: [ low, medium, high ]
          description: Risk severity level
        description:
          type: string
          description: Detailed risk description
        affected_positions:
          type: array
          items:
            type: string
          description: Stock symbols affected by this risk factor
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    CircuitBreaker:
      type: object
      required:
        - id
        - stock_symbol
        - trigger_condition
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the circuit breaker
        stock_symbol:
          type: string
          description: Stock symbol protected by circuit breaker
        trigger_condition:
          $ref: '#/components/schemas/TriggerCondition'
        status:
          type: string
          enum: [ active, triggered, reset ]
          description: Circuit breaker status
        triggered_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when triggered
        reset_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when reset
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    TriggerCondition:
      type: object
      required:
        - type
        - threshold
      properties:
        type:
          type: string
          enum: [ price_drop_percent, volume_spike, volatility_spike ]
          description: Type of trigger condition
        threshold:
          type: number
          format: float
          description: Threshold value for triggering
        timeframe_minutes:
          type: integer
          format: int32
          default: 5
          description: Timeframe in minutes for condition evaluation
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    ProtectionAlert:
      type: object
      required:
        - id
        - user_id
        - alert_type
        - severity
        - message
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the alert
        user_id:
          type: string
          format: uuid
          description: User who should receive the alert
        alert_type:
          type: string
          enum: [ order_triggered, risk_warning, circuit_breaker, market_volatility ]
          description: Type of protection alert
        severity:
          type: string
          enum: [ low, medium, high, critical ]
          description: Alert severity level
        message:
          type: string
          description: Alert message text
        related_stock:
          type: string
          nullable: true
          description: Stock symbol related to the alert
        related_order_id:
          type: string
          format: uuid
          nullable: true
          description: Related protection order ID
        created_at:
          type: string
          format: date-time
        acknowledged_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when user acknowledged the alert
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

  securitySchemes:
    BearerAuth:
      $ref: '../../../common-schemas.yaml#/components/securitySchemes/BearerAuth'
  responses:
    BadRequest:
      $ref: '../../../common-schemas.yaml#/components/responses/BadRequest'
    Unauthorized:
      $ref: '../../../common-schemas.yaml#/components/responses/Unauthorized'
    InternalServerError:
      $ref: '../../../common-schemas.yaml#/components/responses/InternalServerError'

