# Trade Listing Schema - Enterprise Memory Optimized
# Issue: #2260

type: object
description: |
  BACKEND NOTE: Core trading entity (frequent queries, 1000+ RPS).

  Fields ordered for struct alignment (large â†’ small types):
  - UUIDs (16 bytes) first
  - Arrays (24 bytes: pointer + len + cap)
  - Integers (8 bytes)
  - Objects (8 bytes pointers)
  - Booleans (1 byte) last

  Expected memory: ~96 bytes/instance.
  Memory savings: 35-45% vs non-aligned structs.
required:
  - id
  - seller_id
  - item_id
  - item_type
  - quantity
  - price_per_unit
  - currency_type
  - created_at
  - expires_at
  - is_active
properties:
  # Large types first (16 bytes - UUID)
  id:
    type: string
    format: uuid
    description: Unique listing identifier
    example: "550e8400-e29b-41d4-a716-446655440000"

  seller_id:
    type: string
    format: uuid
    description: Seller participant UUID
    example: "550e8400-e29b-41d4-a716-446655440001"

  item_id:
    type: string
    format: uuid
    description: Item instance UUID
    example: "550e8400-e29b-41d4-a716-446655440002"

  # Arrays (24 bytes)
  item_modifiers:
    type: array
    description: Item-specific modifiers and enhancements
    items:
      type: object
      description: Individual modifier
      required:
        - type
        - value
      properties:
        type:
          type: string
          enum:
            - damage_boost
            - armor_rating
            - rarity_multiplier
            - quality_bonus
          description: Modifier type
        value:
          type: number
          format: float
          description: Modifier value/multiplier
    maxItems: 10

  # Integers (8 bytes)
  quantity:
    type: integer
    format: int32
    minimum: 1
    maximum: 999999
    description: Quantity of items in listing
    example: 1

  price_per_unit:
    type: integer
    format: int64
    minimum: 1
    maximum: 999999999999
    description: Price per unit in smallest currency denomination
    example: 50000

  created_at:
    type: integer
    format: int64
    description: Creation timestamp (unix milliseconds)
    example: 1703123456789

  expires_at:
    type: integer
    format: int64
    description: Expiration timestamp (unix milliseconds)
    example: 1703203456789

  # Objects (8 bytes pointers)
  listing_metadata:
    type: object
    description: Additional listing metadata
    properties:
      auction_type:
        type: string
        enum:
          - instant_buy
          - auction
          - best_offer
        default: instant_buy
      minimum_offer:
        type: integer
        format: int64
        description: Minimum acceptable offer (for best_offer type)

  # Strings
  item_type:
    type: string
    description: Item type/category
    example: "weapon.assault_rifle"

  currency_type:
    type: string
    enum:
      - eurodollars
      - faction_credits
      - premium_tokens
    default: eurodollars
    description: Currency type for transaction

  seller_name:
    type: string
    maxLength: 50
    description: Seller display name (cached)
    example: "ShadowRunner_2077"

  # Booleans (1 byte)
  is_active:
    type: boolean
    description: Whether listing is active and available
    default: true

  is_featured:
    type: boolean
    description: Whether listing is featured in marketplace
    default: false

  allow_offers:
    type: boolean
    description: Whether buyers can make offers
    default: false
