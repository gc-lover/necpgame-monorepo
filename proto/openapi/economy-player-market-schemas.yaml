# Issue: #61
# Schemas for Economy Player Market Service API
openapi: 3.0.3

components:
  schemas:
    CreateListingRequest:
      type: object
      description: |
        BACKEND NOTE: Struct alignment optimized (large → small).
        Expected memory: ~56 bytes/instance.
      required:
        - character_id
        - item_id
        - price
        - city_id
      properties:
        # UUID fields first (16 bytes each)
        character_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        city_id:
          type: string
          format: uuid
          description: Город размещения объявления
        
        # String fields (16 bytes)
        description:
          type: string
          description: Описание объявления
        
        # Float fields (4 bytes)
        price:
          type: number
          format: float
          minimum: 0
          description: Цена продажи

    MarketListing:
      type: object
      description: |
        BACKEND NOTE: Player market listings (10k+ active listings).
        Fields ordered for struct alignment. Expected memory: ~176 bytes/instance.
        Hot endpoint for browse/search queries.
      required:
        - id
        - seller_id
        - item_id
        - price
        - status
        - created_at
      properties:
        # UUID fields first (16 bytes each)
        id:
          type: string
          format: uuid
        seller_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        city_id:
          type: string
          format: uuid
        
        # String fields (16 bytes each)
        seller_name:
          type: string
        item_name:
          type: string
        item_category:
          type: string
        item_quality:
          type: string
          enum: [common, uncommon, rare, epic, legendary, artifact]
        city_name:
          type: string
        status:
          type: string
          enum: [active, sold, cancelled, expired]
        description:
          type: string
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        
        # Float fields grouped (4 bytes each)
        price:
          type: number
          format: float
        commission:
          type: number
          format: float
          description: Комиссия с продажи
        
        # Integer fields grouped (4 bytes each)
        item_level:
          type: integer
          format: int32
        views:
          type: integer
          format: int32
          description: Количество просмотров

    UpdateListingRequest:
      type: object
      properties:
        price:
          type: number
          format: float
          minimum: 0
        description:
          type: string

    PurchaseRequest:
      type: object
      required:
        - listing_id
        - buyer_id
      properties:
        listing_id:
          type: string
          format: uuid
        buyer_id:
          type: string
          format: uuid

    PurchaseResult:
      type: object
      description: |
        BACKEND NOTE: Hot path response (purchase confirmations).
        Struct alignment optimized. Expected memory: ~56 bytes/instance.
      required:
        - purchase_id
        - success
      properties:
        # UUID fields first (16 bytes each)
        purchase_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        
        # String fields (16 bytes)
        purchased_at:
          type: string
          format: date-time
        
        # Float fields (4 bytes)
        price_paid:
          type: number
          format: float
        
        # Boolean last (1 byte)
        success:
          type: boolean

    PurchaseHistory:
      type: object
      description: |
        BACKEND NOTE: Purchase history (frequent queries for player history).
        Fields ordered for struct alignment. Expected memory: ~80 bytes/instance.
      required:
        - purchase_id
        - listing_id
        - item_id
        - price_paid
        - purchased_at
      properties:
        # UUID fields first (16 bytes each)
        purchase_id:
          type: string
          format: uuid
        listing_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        item_name:
          type: string
        seller_id:
          type: string
          format: uuid
        seller_name:
          type: string
        price_paid:
          type: number
          format: float
        purchased_at:
          type: string
          format: date-time

    SaleHistory:
      type: object
      description: |
        BACKEND NOTE: Sale history records (frequent queries).
        Fields ordered for struct alignment. Expected memory: ~96 bytes/instance.
      required:
        - sale_id
        - listing_id
        - item_id
        - price_received
        - sold_at
      properties:
        # UUID fields first (16 bytes each)
        sale_id:
          type: string
          format: uuid
        listing_id:
          type: string
          format: uuid
        item_id:
          type: string
          format: uuid
        buyer_id:
          type: string
          format: uuid
        
        # String fields (16 bytes each)
        item_name:
          type: string
        buyer_name:
          type: string
        sold_at:
          type: string
          format: date-time
        
        # Float fields grouped (4 bytes each)
        price_received:
          type: number
          format: float
          description: Цена после вычета комиссии
        commission:
          type: number
          format: float

    SellerProfile:
      type: object
      description: |
        BACKEND NOTE: Seller profiles (cached frequently).
        Fields ordered for struct alignment. Expected memory: ~72 bytes/instance.
      required:
        - seller_id
        - rating
        - total_sales
      properties:
        # UUID fields first (16 bytes)
        seller_id:
          type: string
          format: uuid
        
        # String fields (16 bytes each)
        seller_name:
          type: string
        joined_at:
          type: string
          format: date-time
        
        # Float fields grouped (4 bytes each)
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 5
        total_revenue:
          type: number
          format: float
        
        # Integer fields grouped (4 bytes each)
        total_sales:
          type: integer
        positive_reviews:
          type: integer
        negative_reviews:
          type: integer

    CreateReviewRequest:
      type: object
      required:
        - purchase_id
        - seller_id
        - rating
      properties:
        purchase_id:
          type: string
          format: uuid
        seller_id:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string

    SellerReview:
      type: object
      description: |
        BACKEND NOTE: Review records (display in seller profiles).
        Fields ordered for struct alignment. Expected memory: ~88 bytes/instance.
      required:
        - id
        - purchase_id
        - seller_id
        - buyer_id
        - rating
        - created_at
      properties:
        # UUID fields first (16 bytes each)
        id:
          type: string
          format: uuid
        purchase_id:
          type: string
          format: uuid
        seller_id:
          type: string
          format: uuid
        buyer_id:
          type: string
          format: uuid
        
        # String fields (16 bytes each)
        buyer_name:
          type: string
        comment:
          type: string
        created_at:
          type: string
          format: date-time
        
        # Integer fields last (4 bytes)
        rating:
          type: integer
          minimum: 1
          maximum: 5

