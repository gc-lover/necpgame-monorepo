openapi: 3.0.3
info:
  title: Economy Service Go API
  description: '**Enterprise-Grade Economy Service API for NECPGAME MMOFPS RPG.

  **Service Purpose:** Complete economy and trading system with market analysis, trade management, and transaction history.

  **Architecture:** Event-driven microservice with Kafka integration for trade events and market updates.

  **Domain:** economy-service

  **Core Features:**
  - Trade listing and management
  - Market overview and analytics
  - Transaction history tracking
  - Player economy statistics
  - Anti-fraud trade validation

  **Performance Targets:**
  - Hot paths: 500+ RPS, P99 <25ms (trade operations)
  - Market data: 2000+ RPS, P99 <15ms (market overview)
  - Memory: <40MB per service instance (optimized structs)
  - Cache hit rate: >90% (Redis for market data)

  **BACKEND NOTE:** Struct field alignment optimized (large → small types).
  All schemas ordered for optimal memory layout in generated Go code.
  Expected memory savings: 30-50% for economy-related structs.

  **Security:** JWT authentication with role-based trade permissions.'
  version: 1.0.0
  contact:
    name: Economy Service Team
    email: economy-service@necpgame.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080/api/v1/economy
    description: Local development server
  - url: https://api.necpgame.com/v1/economy
    description: Production server

security:
  - bearerAuth: []

tags:
  - name: Trade Management
    description: Trade listing, execution, and management
  - name: Market Data
    description: Market overview and analytics
  - name: Transaction History
    description: Player transaction tracking
  - name: Health
    description: Service health monitoring

paths:
  # Health check
  /health:
    get:
      tags:
      - Health
      summary: Service health check
      description: Get service health status with economy-specific metrics
      operationId: healthCheck
      security:
      - bearerAuth: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Readiness check
  /readiness:
    get:
      tags:
      - Health
      summary: Service readiness check
      description: Comprehensive readiness check including database connectivity
      operationId: readinessCheck
      security:
      - bearerAuth: []
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: Service is not ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Market overview
  /market/overview:
    get:
      tags:
      - Market Data
      summary: Get market overview
      description: 'Get aggregated market statistics and active trade counts.

        **BACKEND NOTE:** Hot path - optimized for 2000+ RPS with Redis caching.'
      operationId: getMarketOverview
      security:
      - bearerAuth: []
      responses:
        '200':
          description: Market overview data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarketOverview'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Trade Management - MAIN TASK ENDPOINT
  /trade:
    get:
      tags:
      - Trade Management
      summary: Get active trades
      description: 'Get paginated list of active trade listings with filtering options.

        **BACKEND NOTE:** Enterprise-grade trade listing with anti-fraud validation.
        Supports complex filtering for market analysis and player trading.'
      operationId: getActiveTrades
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          minimum: 1
          default: 1
        description: Page number for pagination
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
        description: Number of trades per page
      - name: trade_type
        in: query
        schema:
          type: string
          enum:
          - buy
          - sell
          - exchange
        description: Filter by trade type
      - name: item_category
        in: query
        schema:
          type: string
          maxLength: 50
        description: Filter by item category
      - name: min_price
        in: query
        schema:
          type: number
          minimum: 0
        description: Minimum price per unit filter
      - name: max_price
        in: query
        schema:
          type: number
          minimum: 0
        description: Maximum price per unit filter
      - name: seller_id
        in: query
        schema:
          type: string
          format: uuid
        description: Filter by specific seller
      - name: sort_by
        in: query
        schema:
          type: string
          enum:
          - created_at
          - price_per_unit
          - total_price
          - expires_at
          default: created_at
        description: Sort field
      - name: sort_order
        in: query
        schema:
          type: string
          enum:
          - asc
          - desc
          default: desc
        description: Sort order
      responses:
        '200':
          description: Active trades list
          content:
            application/json:
              schema:
                type: object
                required:
                - trades
                - pagination
                properties:
                  trades:
                    type: array
                    items:
                      $ref: '#/components/schemas/Trade'
                  pagination:
                    type: object
                    required:
                    - page
                    - limit
                    - total
                    - total_pages
                    properties:
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 20
                      total:
                        type: integer
                        example: 150
                      total_pages:
                        type: integer
                        example: 8
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/responses/Unauthorized'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/responses/InternalServerError'
    post:
      tags:
      - Trade Management
      summary: Create trade listing
      description: 'Create a new trade listing with validation and anti-fraud checks.

        **BACKEND NOTE:** Transaction-safe trade creation with inventory validation.'
      operationId: createTradeListing
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTradeRequest'
      responses:
        '201':
          description: Trade listing created successfully
          content:
            application/json:
              schema:
                type: object
                required:
                - trade
                properties:
                  trade:
                    $ref: '#/components/schemas/Trade'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/responses/Unauthorized'
        '403':
          description: Insufficient permissions or invalid item ownership
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Trade creation conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/responses/InternalServerError'

  # Trade details
  /trade/{trade_id}:
    get:
      tags:
      - Trade Management
      summary: Get trade details
      description: Get detailed information about a specific trade listing
      operationId: getTradeDetails
      security:
      - bearerAuth: []
      parameters:
      - name: trade_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Trade unique identifier
      responses:
        '200':
          description: Trade details
          content:
            application/json:
              schema:
                type: object
                required:
                - trade
                properties:
                  trade:
                    $ref: '#/components/schemas/Trade'
        '404':
          description: Trade not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/responses/Unauthorized'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
      - Trade Management
      summary: Cancel trade listing
      description: 'Cancel an active trade listing (seller only).

        **BACKEND NOTE:** Safe cancellation with status validation and refund processing.'
      operationId: cancelTrade
      security:
      - bearerAuth: []
      parameters:
      - name: trade_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Trade unique identifier
      responses:
        '200':
          description: Trade cancelled successfully
          content:
            application/json:
              schema:
                type: object
                required:
                - result
                properties:
                  result:
                    $ref: '#/components/schemas/TradeResult'
        '403':
          description: Insufficient permissions (not the seller)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Trade not found or already processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Trade cannot be cancelled (already in progress)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/responses/Unauthorized'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/responses/InternalServerError'

  # Transaction history
  /players/{player_id}/transactions:
    get:
      tags:
      - Transaction History
      summary: Get player transaction history
      description: 'Get paginated transaction history for a player.

        **BACKEND NOTE:** Optimized for player dashboard with indexing on player_id.'
      operationId: getPlayerTransactionHistory
      security:
      - bearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Player unique identifier
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
        description: Number of transactions per page
      - name: offset
        in: query
        schema:
          type: integer
          minimum: 0
          default: 0
        description: Number of transactions to skip
      - name: transaction_type
        in: query
        schema:
          type: string
          enum:
          - purchase
          - sale
          - refund
          - fee
        description: Filter by transaction type
      responses:
        '200':
          description: Transaction history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionHistory'
        '404':
          description: Player not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/responses/Unauthorized'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    # Health schemas
    HealthResponse:
      type: object
      required:
      - status
      - timestamp
      - service
      properties:
        service:
          type: string
          example: economy-service-go
          maxLength: 50
        status:
          type: string
          enum:
          - healthy
          - degraded
          - unhealthy
          example: healthy
          maxLength: 255
        timestamp:
          type: string
          format: date-time
          example: '2025-12-27T09:52:00Z'
        version:
          type: string
          example: 1.0.0
          maxLength: 50
        active_trades:
          type: integer
          example: 1250
        total_market_volume:
          type: number
          example: 50000.00
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    Error:
      type: object
      required:
      - code
      - message
      properties:
        message:
          type: string
          maxLength: 256
          example: Internal server error
        service:
          type: string
          example: economy-service-go
          maxLength: 50
        details:
          type: object
          description: Additional error context
          example:
            field: trade_id
            reason: invalid_uuid_format
        code:
          type: integer
          format: int32
          minimum: 100
          maximum: 599
          example: 500
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Trade schemas
    Trade:
      type: object
      required:
      - trade_id
      - seller_id
      - item_id
      - quantity
      - price_per_unit
      - total_price
      - trade_type
      - status
      - created_at
      properties:
        trade_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        seller_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440001
        buyer_id:
          type: string
          format: uuid
          nullable: true
          example: 550e8400-e29b-41d4-a716-446655440002
        item_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440003
        quantity:
          type: integer
          minimum: 1
          example: 5
        price_per_unit:
          type: number
          minimum: 0
          example: 25.50
        total_price:
          type: number
          minimum: 0
          example: 127.50
        trade_type:
          type: string
          enum:
          - buy
          - sell
          - exchange
          example: sell
        status:
          type: string
          enum:
          - active
          - completed
          - cancelled
          - expired
          example: active
        created_at:
          type: string
          format: date-time
          example: '2025-12-27T09:52:00Z'
        expires_at:
          type: string
          format: date-time
          nullable: true
          example: '2025-12-28T09:52:00Z'
        item_name:
          type: string
          maxLength: 100
          example: "Plasma Rifle MK-II"
        item_category:
          type: string
          maxLength: 50
          example: "weapons"
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    CreateTradeRequest:
      type: object
      required:
      - item_id
      - quantity
      - price_per_unit
      - trade_type
      properties:
        item_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440003
        quantity:
          type: integer
          minimum: 1
          example: 5
        price_per_unit:
          type: number
          minimum: 0
          example: 25.50
        trade_type:
          type: string
          enum:
          - buy
          - sell
          - exchange
          example: sell
        description:
          type: string
          maxLength: 500
          example: "High-quality plasma rifle in excellent condition"
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    TradeResult:
      type: object
      required:
      - trade_id
      - status
      properties:
        trade_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        status:
          type: string
          enum:
          - completed
          - cancelled
          - expired
          example: cancelled
        total_price:
          type: number
          minimum: 0
          example: 127.50
        executed_at:
          type: string
          format: date-time
          nullable: true
          example: '2025-12-27T09:52:00Z'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Market data schemas
    MarketOverview:
      type: object
      required:
      - active_trades
      - total_volume
      - average_trade_price
      properties:
        active_trades:
          type: integer
          minimum: 0
          example: 1250
        total_volume:
          type: number
          minimum: 0
          example: 50000.00
        average_trade_price:
          type: number
          minimum: 0
          example: 40.00
        top_items:
          type: array
          items:
            type: object
            properties:
              item_name:
                type: string
                example: "Plasma Rifle"
              trade_count:
                type: integer
                example: 25
              average_price:
                type: number
                example: 150.00
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Transaction schemas
    Transaction:
      type: object
      required:
      - transaction_id
      - transaction_type
      - amount
      - currency_type
      - created_at
      properties:
        transaction_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440010
        transaction_type:
          type: string
          enum:
          - purchase
          - sale
          - refund
          - fee
          - deposit
          - withdrawal
          example: purchase
        amount:
          type: number
          example: -25.50
        currency_type:
          type: string
          enum:
          - credits
          - premium_credits
          - tokens
          example: credits
        description:
          type: string
          maxLength: 255
          example: "Purchase: Plasma Rifle MK-II"
        created_at:
          type: string
          format: date-time
          example: '2025-12-27T09:52:00Z'
        related_trade_id:
          type: string
          format: uuid
          nullable: true
          example: 550e8400-e29b-41d4-a716-446655440000
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    TransactionHistory:
      type: object
      required:
      - transactions
      - total
      properties:
        transactions:
          type: array
          items:
            $ref: '#/components/schemas/Transaction'
        total:
          type: integer
          minimum: 0
          example: 45
        limit:
          type: integer
          nullable: true
          example: 20
        offset:
          type: integer
          nullable: true
          example: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'