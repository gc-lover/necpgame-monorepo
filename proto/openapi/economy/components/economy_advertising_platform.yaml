# Issue: #64
openapi: 3.0.3
info:
  title: Economy Advertising Platform Service API
  description: |
    API для внутриигровой рекламной платформы в NECPGAME.
    
    **Основные возможности:**
    - Управление рекламными поверхностями (слоты)
    - Создание и управление кампаниями
    - Аукционы и подписки на рекламные слоты
    - Модерация контента
    - Метрики и аналитика кампаний
    - Интеграция с UGC и Live Ops
    
    **Интеграции:**
    - economy-service - основная логика платформы
    - world-service - зоны влияния и события
    - ugc-service - пользовательский контент
    - content-service - модерация
    - safety-service - безопасность
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8085/api/v1
    description: Economy Service (локальная разработка)
  - url: https://api.necp.game/api/v1
    description: Economy Service (продакшн)

tags:
  - name: Advertising Surfaces
    description: Рекламные поверхности и слоты
  - name: Campaigns
    description: Рекламные кампании
  - name: Auctions
    description: Аукционы слотов
  - name: Moderation
    description: Модерация контента
  - name: Analytics
    description: Метрики и аналитика

paths:
  /economy/advertising/surfaces:
    get:
      tags:
        - Advertising Surfaces
      summary: Получить список рекламных поверхностей
      description: |
        Возвращает список доступных рекламных поверхностей с фильтрацией.
      operationId: getAdvertisingSurfaces
      security:
        - BearerAuth: [ ]
      parameters:
        - name: zone_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по зоне
        - name: surface_type
          in: query
          schema:
            type: string
            enum: [ billboard, ar_layer, broadcast, hub_screen, private_interior ]
          description: Фильтр по типу поверхности
        - name: faction_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по фракции
        - name: available_only
          in: query
          schema:
            type: boolean
          description: Только доступные слоты
        - $ref: "../../common-schemas.yaml#/components/parameters/Limit"
        - $ref: "../../common-schemas.yaml#/components/parameters/Offset"
      responses:
        "200":
          description: Список рекламных поверхностей
          content:
            application/json:
              schema:
                type: object
                properties:
                  surfaces:
                    type: array
                    items:
                      $ref: "#/components/schemas/AdvertisingSurface"
                  total:
                    type: integer
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

  /economy/advertising/surfaces/{surface_id}:
    get:
      tags:
        - Advertising Surfaces
      summary: Получить информацию о поверхности
      description: |
        Возвращает детальную информацию о рекламной поверхности.
      operationId: getAdvertisingSurfaceById
      security:
        - BearerAuth: [ ]
      parameters:
        - name: surface_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор поверхности
      responses:
        "200":
          description: Информация о поверхности
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdvertisingSurfaceDetailed"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "../../common-schemas.yaml#/components/responses/NotFound"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

  /economy/advertising/campaigns:
    get:
      tags:
        - Campaigns
      summary: Получить список кампаний
      description: |
        Возвращает список рекламных кампаний с фильтрацией.
      operationId: getCampaigns
      security:
        - BearerAuth: [ ]
      parameters:
        - name: creator_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по создателю
        - name: status
          in: query
          schema:
            type: string
            enum: [ draft, pending_moderation, approved, active, paused, completed, rejected ]
          description: Фильтр по статусу
        - $ref: "../../common-schemas.yaml#/components/parameters/Limit"
        - $ref: "../../common-schemas.yaml#/components/parameters/Offset"
      responses:
        "200":
          description: Список кампаний
          content:
            application/json:
              schema:
                type: object
                properties:
                  campaigns:
                    type: array
                    items:
                      $ref: "#/components/schemas/Campaign"
                  total:
                    type: integer
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

    post:
      tags:
        - Campaigns
      summary: Создать кампанию
      description: |
        Создает новую рекламную кампанию.
      operationId: createCampaign
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCampaignRequest"
      responses:
        "201":
          description: Кампания создана
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Campaign"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

  /economy/advertising/campaigns/{campaign_id}:
    get:
      tags:
        - Campaigns
      summary: Получить информацию о кампании
      description: |
        Возвращает детальную информацию о рекламной кампании.
      operationId: getCampaignById
      security:
        - BearerAuth: [ ]
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор кампании
      responses:
        "200":
          description: Информация о кампании
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CampaignDetailed"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "../../common-schemas.yaml#/components/responses/NotFound"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

    put:
      tags:
        - Campaigns
      summary: Обновить кампанию
      description: |
        Обновляет существующую кампанию (только в статусе draft).
      operationId: updateCampaign
      security:
        - BearerAuth: [ ]
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор кампании
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateCampaignRequest"
      responses:
        "200":
          description: Кампания обновлена
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Campaign"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "../../common-schemas.yaml#/components/responses/Forbidden"
        "404":
          $ref: "../../common-schemas.yaml#/components/responses/NotFound"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

    delete:
      tags:
        - Campaigns
      summary: Удалить кампанию
      description: |
        Удаляет кампанию (только в статусе draft или rejected).
      operationId: deleteCampaign
      security:
        - BearerAuth: [ ]
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор кампании
      responses:
        "200":
          description: Кампания удалена
          content:
            application/json:
              schema:
                $ref: "../../common-schemas.yaml#/components/schemas/StatusResponse"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "../../common-schemas.yaml#/components/responses/Forbidden"
        "404":
          $ref: "../../common-schemas.yaml#/components/responses/NotFound"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

  /economy/advertising/campaigns/{campaign_id}/submit:
    post:
      tags:
        - Campaigns
      summary: Отправить кампанию на модерацию
      description: |
        Отправляет кампанию на модерацию.
      operationId: submitCampaignForModeration
      security:
        - BearerAuth: [ ]
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор кампании
      responses:
        "200":
          description: Кампания отправлена на модерацию
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Campaign"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "../../common-schemas.yaml#/components/responses/NotFound"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

  /economy/advertising/auctions:
    get:
      tags:
        - Auctions
      summary: Получить список аукционов
      description: |
        Возвращает список активных аукционов рекламных слотов.
      operationId: getAuctions
      security:
        - BearerAuth: [ ]
      parameters:
        - name: surface_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по поверхности
        - name: status
          in: query
          schema:
            type: string
            enum: [ active, ended, cancelled ]
          description: Фильтр по статусу
        - $ref: "../../common-schemas.yaml#/components/parameters/Limit"
        - $ref: "../../common-schemas.yaml#/components/parameters/Offset"
      responses:
        "200":
          description: Список аукционов
          content:
            application/json:
              schema:
                type: object
                properties:
                  auctions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Auction"
                  total:
                    type: integer
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

  /economy/advertising/auctions/{auction_id}/bid:
    post:
      tags:
        - Auctions
      summary: Разместить ставку
      description: |
        Размещает ставку на аукционе рекламного слота.
      operationId: placeBid
      security:
        - BearerAuth: [ ]
      parameters:
        - name: auction_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор аукциона
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlaceBidRequest"
      responses:
        "200":
          description: Ставка размещена
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Bid"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "../../common-schemas.yaml#/components/responses/NotFound"
        "409":
          description: Ставка слишком низкая или аукцион завершен
          content:
            application/json:
              schema:
                $ref: "../../common-schemas.yaml#/components/schemas/Error"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

  /economy/advertising/campaigns/{campaign_id}/analytics:
    get:
      tags:
        - Analytics
      summary: Получить аналитику кампании
      description: |
        Возвращает метрики и аналитику рекламной кампании.
      operationId: getCampaignAnalytics
      security:
        - BearerAuth: [ ]
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор кампании
        - name: period
          in: query
          schema:
            type: string
            enum: [ day, week, month, all ]
          description: Период аналитики
      responses:
        "200":
          description: Аналитика кампании
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CampaignAnalytics"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "../../common-schemas.yaml#/components/responses/NotFound"
        "500":
          $ref: "../../common-schemas.yaml#/components/responses/InternalServerError"

components:
  securitySchemes:
    BearerAuth:
      $ref: "../../common-schemas.yaml#/components/securitySchemes/BearerAuth"

  schemas:
    AdvertisingSurface:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/AdvertisingSurface'
    AdvertisingSurfaceDetailed:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/AdvertisingSurfaceDetailed'
    CreateCampaignRequest:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/CreateCampaignRequest'
    Campaign:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/Campaign'
    CampaignDetailed:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/CampaignDetailed'
    UpdateCampaignRequest:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/UpdateCampaignRequest'
    Auction:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/Auction'
    PlaceBidRequest:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/PlaceBidRequest'
    Bid:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/Bid'
    CampaignAnalytics:
      $ref: 'economy-advertising-platform-schemas.yaml#/components/schemas/CampaignAnalytics'

security:
  - BearerAuth: [ ]

