openapi: 3.0.3
components:
  schemas:
    CharacterEntity:
      $ref: ../common/schemas/game-entities.yaml#/components/schemas/CharacterEntity
    BaseEntity:
      $ref: ../common/schemas/game-entities.yaml#/components/schemas/BaseEntity
    OptimisticLock:
      $ref: ../common/schemas/game-entities.yaml#/components/schemas/OptimisticLock
    ErrorResponse:
      $ref: ../common/schemas/infrastructure-entities.yaml#/components/schemas/ErrorResponse
    HealthResponse:
      $ref: ../common/schemas/infrastructure-entities.yaml#/components/schemas/HealthResponse
    HealthBatchRequest:
      $ref: ../common/schemas/infrastructure-entities.yaml#/components/schemas/HealthBatchRequest
    HealthBatchResponse:
      $ref: ../common/schemas/infrastructure-entities.yaml#/components/schemas/HealthBatchResponse
    ExperienceEntity:
      type: object
      description: '  '
      allOf:
      - $ref: '#/components/schemas/BaseEntity'
      - type: object
        required:
        - playerId
        - totalExperience
        - currentLevel
        properties:
          playerId:
            type: string
            description: 'ID '
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
          totalExperience:
            type: integer
            description: ' '
            minimum: 0
            example: 15420
          currentLevel:
            type: integer
            description: ' '
            minimum: 1
            example: 15
          experienceToNextLevel:
            type: integer
            description: '   '
            minimum: 0
            example: 580
          levelProgressPercent:
            type: number
            description: '   '
            minimum: 0
            maximum: 100
            example: 75.5
          experienceSources:
            type: object
            description: '  '
            properties:
              combat:
                type: integer
                minimum: 0
                example: 8500
              crafting:
                type: integer
                minimum: 0
                example: 3200
              social:
                type: integer
                minimum: 0
                example: 1200
              exploration:
                type: integer
                minimum: 0
                example: 2520
          activeMultipliers:
            type: array
            description: ' '
            items:
              $ref: '#/components/schemas/ExperienceMultiplierEntity'
          lastAwardedAt:
            type: string
            description: '  '
            format: date-time
          $ref: '#/components/schemas/OptimisticLock'
    ExperienceMultiplierEntity:
      type: object
      description: '  '
      required:
      - type
      - multiplier
      - duration
      properties:
        type:
          type: string
          description: ' '
          enum:
          - event
          - item
          - guild
          - subscription
          - achievement
          example: event
        multiplier:
          type: number
          description: ' '
          minimum: 1.0
          example: 2.0
        duration:
          type: integer
          description: '  '
          minimum: 1
          example: 120
        expiresAt:
          type: string
          description: ' '
          format: date-time
        source:
          type: string
          description: ' '
          example: Holiday Event
    LevelRewardEntity:
      type: object
      description: '   '
      required:
      - level
      - rewards
      properties:
        level:
          type: integer
          description: ''
          minimum: 1
          example: 10
        rewards:
          type: array
          description: ''
          items:
            type: object
            properties:
              type:
                type: string
                enum:
                - currency
                - item
                - title
                - cosmetic
                example: currency
              amount:
                type: integer
                minimum: 1
                example: 1000
              itemId:
                type: string
                description: 'ID '
                format: uuid
        claimedBy:
          type: array
          description: '  '
          items:
            type: string
            format: uuid
    AwardExperienceRequest:
      type: object
      required:
      - playerId
      - amount
      - source
      properties:
        playerId:
          type: string
          format: uuid
        amount:
          type: integer
          description: ' '
          minimum: 1
          maximum: 10000
          example: 250
        source:
          type: string
          description: ' '
          enum:
          - combat
          - crafting
          - social
          - exploration
          - quest
          - achievement
          example: combat
        reason:
          type: string
          description: ' '
          maxLength: 200
          example: Defeated enemy boss
        metadata:
          type: object
          description: ' '
          additionalProperties: true
    AwardExperienceResponse:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        experienceGained:
          type: integer
          minimum: 0
        totalExperience:
          type: integer
          minimum: 0
        levelBefore:
          type: integer
          minimum: 1
        levelAfter:
          type: integer
          minimum: 1
        leveledUp:
          type: boolean
        multiplierApplied:
          type: number
          minimum: 1.0
        awardedAt:
          type: string
          format: date-time
    BatchAwardExperienceRequest:
      type: object
      required:
      - awards
      properties:
        awards:
          type: array
          description: '  '
          items:
            $ref: '#/components/schemas/AwardExperienceRequest'
          minItems: 1
          maxItems: 100
    BatchAwardExperienceResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/AwardExperienceResponse'
        totalProcessed:
          type: integer
          minimum: 0
        errors:
          type: array
          items:
            type: object
            properties:
              playerId:
                type: string
                format: uuid
              error:
                type: string
    PlayerExperienceResponse:
      type: object
      properties:
        experience:
          $ref: '#/components/schemas/ExperienceEntity'
        recentAwards:
          type: array
          description: ' '
          items:
            type: object
            properties:
              amount:
                type: integer
              source:
                type: string
              awardedAt:
                type: string
                format: date-time
          maxItems: 10
    ExperienceHistoryResponse:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        history:
          type: array
          items:
            type: object
            properties:
              amount:
                type: integer
              source:
                type: string
              reason:
                type: string
              awardedAt:
                type: string
                format: date-time
              multiplier:
                type: number
        pagination:
          type: object
          properties:
            total:
              type: integer
              minimum: 0
            limit:
              type: integer
              minimum: 1
              maximum: 100
            offset:
              type: integer
              minimum: 0
            hasNext:
              type: boolean
    LevelUpRequest:
      type: object
      required:
      - playerId
      properties:
        playerId:
          type: string
          format: uuid
    LevelUpResponse:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        oldLevel:
          type: integer
          minimum: 1
        newLevel:
          type: integer
          minimum: 1
        experienceUsed:
          type: integer
          minimum: 0
        rewardsGranted:
          type: array
          items:
            $ref: '#/components/schemas/LevelRewardEntity'
        leveledUpAt:
          type: string
          format: date-time
    PlayerLevelResponse:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        currentLevel:
          type: integer
          minimum: 1
        totalExperience:
          type: integer
          minimum: 0
        experienceToNextLevel:
          type: integer
          minimum: 0
        progressPercent:
          type: number
          minimum: 0
          maximum: 100
        nextLevelRewards:
          type: array
          items:
            $ref: '#/components/schemas/LevelRewardEntity'
    ExperienceMultipliersResponse:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        multipliers:
          type: array
          items:
            $ref: '#/components/schemas/ExperienceMultiplierEntity'
        totalMultiplier:
          type: number
          minimum: 1.0
    ApplyMultiplierRequest:
      type: object
      required:
      - playerId
      - multiplier
      properties:
        playerId:
          type: string
          format: uuid
        multiplier:
          $ref: '#/components/schemas/ExperienceMultiplierEntity'
    ApplyMultiplierResponse:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        multiplier:
          $ref: '#/components/schemas/ExperienceMultiplierEntity'
        appliedAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
    ClaimRewardsRequest:
      type: object
      required:
      - playerId
      - level
      properties:
        playerId:
          type: string
          format: uuid
        level:
          type: integer
          minimum: 1
    ClaimRewardsResponse:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        level:
          type: integer
          minimum: 1
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/LevelRewardEntity'
        claimedAt:
          type: string
          format: date-time
    ExperienceLeaderboardResponse:
      type: object
      properties:
        period:
          type: string
          enum:
          - daily
          - weekly
          - monthly
          - alltime
        entries:
          type: array
          items:
            type: object
            properties:
              playerId:
                type: string
                format: uuid
              displayName:
                type: string
              level:
                type: integer
                minimum: 1
              totalExperience:
                type: integer
                minimum: 0
              rank:
                type: integer
                minimum: 1
              lastUpdated:
                type: string
                format: date-time
    ProgressionAnalyticsResponse:
      type: object
      properties:
        period:
          type: string
          enum:
          - daily
          - weekly
          - monthly
          - yearly
        totalPlayers:
          type: integer
          minimum: 0
        averageLevel:
          type: number
          minimum: 0
        levelDistribution:
          type: object
          additionalProperties:
            type: integer
            minimum: 0
        experienceGained:
          type: integer
          minimum: 0
        topExperienceSources:
          type: array
          items:
            type: object
            properties:
              source:
                type: string
              totalExperience:
                type: integer
                minimum: 0
              percentage:
                type: number
                minimum: 0
                maximum: 100
    LevelScalingConfigResponse:
      type: object
      properties:
        maxLevel:
          type: integer
          minimum: 1
          example: 100
        baseExperiencePerLevel:
          type: integer
          minimum: 1
          example: 1000
        scalingFactor:
          type: number
          minimum: 1.0
          example: 1.15
        experienceFormula:
          type: string
          example: base * pow(scaling, level - 1)
        levelCaps:
          type: object
          additionalProperties:
            type: integer
            minimum: 1
    UpdateLevelScalingRequest:
      type: object
      properties:
        maxLevel:
          type: integer
          minimum: 1
        baseExperiencePerLevel:
          type: integer
          minimum: 1
        scalingFactor:
          type: number
          minimum: 1.0
        experienceFormula:
          type: string
