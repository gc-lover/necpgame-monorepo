openapi: 3.0.3
info:
  title: Feedback Core Service API
  description: API для основных операций с обратной связью
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8090/api/v1/feedback
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1/feedback
    description: Продакшен сервер
tags:
  - name: Feedback Core
    description: Основные операции с обратной связью
paths:
  /submit:
    post:
      tags:
        - Feedback Core
      summary: Создание нового обращения
      description: 'Создание нового обращения от игрока.


        **Требует:** Аутентификация (session token).


        **Rate limiting:** 5 обращений в час на игрока.


        **Валидация:**

        - title: обязательное, до 100 символов

        - description: обязательное, до 2000 символов

        - screenshots: до 3 файлов

        '
      operationId: submitFeedback
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitFeedbackRequest'
      responses:
        '201':
          description: Обращение создано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitFeedbackResponse'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '429':
          $ref: common.yaml#/components/responses/TooManyRequests
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
  /{id}:
    get:
      tags:
        - Feedback Core
      summary: Получить обращение
      operationId: getFeedback
      security:
        - BearerAuth: [ ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Обращение
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Feedback'
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '429':
          $ref: common.yaml#/components/responses/TooManyRequests
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
  /player/{player_id}:
    get:
      tags:
        - Feedback Core
      summary: Получить обращения игрока
      operationId: getPlayerFeedback
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: common.yaml#/components/parameters/PlayerId
        - name: status
          in: query
          schema:
            type: string
            enum:
              - pending_moderation
              - pending
              - in_review
              - assigned
              - in_progress
              - resolved
              - rejected
              - duplicate
              - merged
        - $ref: common.yaml#/components/parameters/Limit
        - $ref: common.yaml#/components/parameters/Offset
      responses:
        '200':
          description: Список обращений
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeedbackListResponse'
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
  /{id}/update-status:
    post:
      tags:
        - Feedback Core
      summary: Обновить статус обращения
      description: 'Обновление статуса обращения.


        **Требует:** Специальная аутентификация (агенты/админы).


        **Статусы:**

        - pending_moderation - ожидает модерации

        - pending - ожидает обработки

        - in_review - на рассмотрении

        - assigned - назначено агенту

        - in_progress - в работе

        - resolved - решено

        - rejected - отклонено

        - duplicate - дубликат

        - merged - объединено с другим обращением

        '
      operationId: updateFeedbackStatus
      security:
        - BearerAuth: [ ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateStatusRequest'
      responses:
        '200':
          description: Статус обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Feedback'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '403':
          $ref: common.yaml#/components/responses/Forbidden
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    SubmitFeedbackRequest:
      type: object
      required:
        - type
        - category
        - title
        - description
      properties:
        title:
          type: string
          maxLength: 100
        description:
          type: string
          maxLength: 2000
        type:
          type: string
          enum:
            - feature_request
            - bug_report
            - wishlist
            - feedback
        category:
          type: string
          enum:
            - gameplay
            - balance
            - content
            - technical
            - lore
            - ui_ux
            - other
        priority:
          type: string
          enum:
            - low
            - medium
            - high
            - critical
        game_context:
          $ref: '#/components/schemas/GameContext'
        screenshots:
          type: array
          maxItems: 3
          items:
            type: string
            format: uri
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SubmitFeedbackResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - pending_moderation
            - pending
            - in_review
            - assigned
            - in_progress
            - resolved
            - rejected
            - duplicate
            - merged
        github_issue_url:
          type: string
          format: uri
          nullable: true
        created_at:
          type: string
          format: date-time
        github_issue_number:
          type: integer
          nullable: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Feedback:
      type: object
      properties:
        id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        type:
          type: string
          enum:
            - feature_request
            - bug_report
            - wishlist
            - feedback
        category:
          type: string
          enum:
            - gameplay
            - balance
            - content
            - technical
            - lore
            - ui_ux
            - other
        status:
          type: string
          enum:
            - pending_moderation
            - pending
            - in_review
            - assigned
            - in_progress
            - resolved
            - rejected
            - duplicate
            - merged
        github_issue_url:
          type: string
          format: uri
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        github_issue_number:
          type: integer
          nullable: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    FeedbackListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Feedback'
        total:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdateStatusRequest:
      type: object
      required:
        - status
      properties:
        comment:
          type: string
        status:
          type: string
          enum:
            - pending_moderation
            - pending
            - in_review
            - assigned
            - in_progress
            - resolved
            - rejected
            - duplicate
            - merged
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    GameContext:
      type: object
      description: 'Контекст игры (JSONB).


        **Поля:**

        - character_id - ID персонажа

        - location - локация игрока

        - game_version - версия игры

        - level - уровень персонажа (опционально)

        - active_quests - активные квесты (опционально)

        - playtime - время в игре (опционально)



        BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
      properties:
        character_id:
          type: string
          format: uuid
        location:
          type: string
        game_version:
          type: string
        active_quests:
          type: array
          items:
            type: string
        level:
          type: integer
          minimum: 1
        playtime:
          type: integer
          description: Время в игре в секундах
          minimum: 0
security:
  - BearerAuth: [ ]
