synergyPreferences:
  type: object
  description: Предпочтения синергий
  additionalProperties:
    type: boolean
createdAt:
  type: string
  format: date-time
updatedAt:
  type: string
  format: date-time
required:
  - characterId
  - activeCombos

ComboLoadoutUpdate:
  type: object
  description: Обновление лоадаута комбо
  properties:
    characterId:
      type: string
      format: uuid
      description: ID персонажа
    activeCombos:
      type: array
      items:
        type: string
        format: uuid
      description: ID активных комбо
      maxItems: 10
    preferences:
      type: object
      description: Настройки предпочтений
      properties:
        autoActivate:
          type: boolean
          description: Автоматическая активация
        priorityCombos:
          type: array
          items:
            type: string
            format: uuid
          description: Приоритетные комбо
          maxItems: 5
        synergyPreferences:
          type: object
          description: Предпочтения синергий
          additionalProperties:
            type: boolean
  required:
    - characterId

Reward:
  type: object
  description: Награда за комбо
  properties:
    type:
      type: string
      enum: [ experience, currency, item, title, achievement ]
      description: Тип награды
    value:
      oneOf:
        - type: integer
          description: Числовое значение
        - type: string
          description: Строковое значение
        - type: object
          description: Сложное значение
    description:
      type: string
      description: Описание награды
  required:
    - type
    - value

PaginationInfo:
  type: object
  description: Информация о пагинации
  properties:
    limit:
      type: integer
      description: Размер страницы
    offset:
      type: integer
      description: Смещение
    hasNext:
      type: boolean
      description: Есть следующая страница
    hasPrev:
      type: boolean
      description: Есть предыдущая страница
  required:
    - limit
    - offset
    - hasNext
    - hasPrev

Error:
  type: object
  description: Описание ошибки
  properties:
    code:
      type: string
      description: Код ошибки
    message:
      type: string
      description: Сообщение об ошибке
    details:
      type: object
      description: Дополнительные детали ошибки
      additionalProperties: true
  required:
    - code
    - message

# Переиспользуемые ответы
responses:
  BadRequest:
    description: Неверный запрос
    content:
      application/json:
        schema:
          $ref: "#/components/schemas/Error"

  Unauthorized:
    description: Не авторизован
    content:
      application/json:
        schema:
          $ref: "#/components/schemas/Error"

  NotFound:
    description: Ресурс не найден
    content:
      application/json:
        schema:
          $ref: "#/components/schemas/Error"

  InternalServerError:
    description: Внутренняя ошибка сервера
    content:
      application/json:
        schema:
          $ref: "#/components/schemas/Error"

# Схемы безопасности
securitySchemes:
  BearerAuth:
    type: http
    scheme: bearer
    bearerFormat: JWT
    description: JWT токен авторизации

  ApiKeyAuth:
    type: apiKey
    in: header
    name: X-API-Key
    description: API ключ для сервер-сервер коммуникации

# WebSocket спецификации (документация)
x-websockets:
  combo-session-stream:
    url: wss://api.necp.game/v1/gameplay/combat/combos/{sessionId}
    description: |
      WebSocket поток для сессии комбо. Отправляет обновления о активированных комбо в реальном времени.
    parameters:
      sessionId:
        type: string
        format: uuid
        description: ID игровой сессии
    messages:
      combo-activated:
        type: object
        properties:
          type:
            type: string
            enum: [ combo_activated ]
          data:
            type: object
            properties:
              activationId:
                type: string
                format: uuid
              comboId:
                type: string
                format: uuid
              characterId:
                type: string
                format: uuid
              participants:
                type: array
                items:
                  type: string
                  format: uuid
              synergies:
                type: array
                items:
                  $ref: "#/components/schemas/SynergyEffect"
              score:
                $ref: "#/components/schemas/ComboScore"

  combo-player-notifications:
    url: wss://api.necp.game/v1/gameplay/combat/combos/player/{characterId}
    description: |
      Персональные уведомления о комбо для игрока. Отправляет уведомления о доступных синергиях,
      chain-комбо возможностях и достижениях.
    parameters:
      characterId:
        type: string
        format: uuid
        description: ID персонажа
    messages:
      synergy-available:
        type: object
        properties:
          type:
            type: string
            enum: [ synergy_available ]
          data:
            type: object
            properties:
              synergyType:
                type: string
                enum: [ ability, team, equipment, implant, timing ]
              bonuses:
                type: object
                additionalProperties:
                  type: number

      chain-opportunity:
        type: object
        properties:
          type:
            type: string
            enum: [ chain_opportunity ]
          data:
            type: object
            properties:
              windowTime:
                type: integer
                description: Время окна в секундах
              compatibleCombos:
                type: array
                items:
                  type: string
                  format: uuid

      achievement-unlocked:
        type: object
        properties:
          type:
            type: string
            enum: [ achievement_unlocked ]
          data:
            type: object
            properties:
              comboId:
                type: string
                format: uuid
              category:
                type: string
                enum: [ Bronze, Silver, Gold, Platinum, Legendary ]
              rewards:
                type: array
                items:
                  $ref: "#/components/schemas/Reward"

# Event Bus спецификации (документация)
x-event-bus:
  events:
    combat.combo.activated:
      description: Событие активации комбо
      payload:
        type: object
        properties:
          activationId:
            type: string
            format: uuid
          comboId:
            type: string
            format: uuid
          characterId:
            type: string
            format: uuid
          participants:
            type: array
            items:
              type: string
              format: uuid
          synergies:
            type: array
            items:
              $ref: "#/components/schemas/SynergyEffect"
          score:
            $ref: "#/components/schemas/ComboScore"
        required:
          - activationId
          - comboId
          - characterId

    combat.combo.synergy:
      description: Событие применения синергии
      payload:
        type: object
        properties:
          comboActivationId:
            type: string
            format: uuid
          synergyEffects:
            type: array
            items:
              $ref: "#/components/schemas/SynergyEffect"
        required:
          - comboActivationId
          - synergyEffects

    combat.combo.score:
      description: Событие завершения scoring комбо
      payload:
        type: object
        properties:
          activationId:
            type: string
            format: uuid
          score:
            $ref: "#/components/schemas/ComboScore"
          rewards:
            type: array
            items:
              $ref: "#/components/schemas/Reward"
        required:
          - activationId
          - score

    combat.combo.chain:
      description: Событие срабатывания chain-комбо
      payload:
        type: object
        properties:
          firstComboId:
            type: string
            format: uuid
          secondComboId:
            type: string
            format: uuid
          bonuses:
            type: object
            additionalProperties:
              type: number
          cooldownReduction:
            type: integer
        required:
          - firstComboId
          - secondComboId
# Issue: #158
