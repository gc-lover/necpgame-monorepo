openapi: 3.0.3
info:
  title: Gameplay Time Trials Weekly Service API
  description: |
    API для управления еженедельными временными испытаниями: текущие испытания, история, условия и награды.
    
    Еженедельные испытания предоставляют уникальные вызовы с ограниченным временем и специальными условиями.
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8083/api/v1/gameplay
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1/gameplay
    description: Продакшен сервер

tags:
  - name: Weekly Time Trials
    description: Еженедельные временные испытания

paths:
  /time-trials/weekly/current:
    get:
      tags:
        - Weekly Time Trials
      summary: Получить текущее еженедельное испытание
      description: |
        Возвращает информацию о текущем активном еженедельном испытании.
        Если испытание не активно, возвращает null.
      operationId: getCurrentWeeklyChallenge
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Текущее еженедельное испытание
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeeklyTimeChallenge'
              example:
                id: 'bb0e8400-e29b-41d4-a716-446655440000'
                week_start: '2025-12-01T00:00:00Z'
                week_end: '2025-12-08T00:00:00Z'
                challenge_type: solo_challenge
                content_id: '660e8400-e29b-41d4-a716-446655440000'
                time_limit_ms: 1800000
                conditions:
                  solo_only: true
                  class_restriction: null
                  no_deaths: false
                rewards:
                  unique_items:
                    - item_id: 'cc0e8400-e29b-41d4-a716-446655440000'
                      name: Weekly Champion Badge
                  seasonal_currency: 500
                  cosmetics:
                    - cosmetic_id: 'dd0e8400-e29b-41d4-a716-446655440000'
                      name: Speed Demon Title
                created_at: '2025-12-01T00:00:00Z'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /time-trials/weekly/history:
    get:
      tags:
        - Weekly Time Trials
      summary: Получить историю еженедельных испытаний
      description: |
        Возвращает историю еженедельных испытаний с пагинацией.
        Позволяет просмотреть прошлые испытания и их результаты.
      operationId: getWeeklyChallengeHistory
      security:
        - BearerAuth: []
      parameters:
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
        - name: weeks_back
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 52
            default: 4
          description: Количество недель назад для получения истории
      responses:
        '200':
          description: История еженедельных испытаний
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeeklyChallengeHistoryResponse'
              example:
                items:
                  - id: 'bb0e8400-e29b-41d4-a716-446655440000'
                    week_start: '2025-12-01T00:00:00Z'
                    week_end: '2025-12-08T00:00:00Z'
                    challenge_type: solo_challenge
                    content_id: '660e8400-e29b-41d4-a716-446655440000'
                    created_at: '2025-12-01T00:00:00Z'
                total: 52
                limit: 20
                offset: 0
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      $ref: 'common.yaml#/components/securitySchemes/BearerAuth'

  schemas:
    WeeklyTimeChallenge:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ID испытания
        week_start:
          type: string
          format: date-time
          description: Начало недели
        week_end:
          type: string
          format: date-time
          description: Конец недели
        challenge_type:
          type: string
          enum: [solo_challenge, team_challenge, class_challenge]
          description: Тип испытания
        content_id:
          type: string
          format: uuid
          description: ID контента
        time_limit_ms:
          type: integer
          minimum: 0
          description: Ограничение времени в миллисекундах
        conditions:
          type: object
          description: Условия испытания
          properties:
            solo_only:
              type: boolean
              description: Только одиночное прохождение
            class_restriction:
              type: string
              nullable: true
              description: Ограничение по классу
            no_deaths:
              type: boolean
              description: Запрет смертей
          additionalProperties: true
        rewards:
          type: object
          description: Награды за прохождение
          properties:
            unique_items:
              type: array
              items:
                type: object
                properties:
                  item_id:
                    type: string
                    format: uuid
                  name:
                    type: string
            seasonal_currency:
              type: integer
              minimum: 0
            cosmetics:
              type: array
              items:
                type: object
                properties:
                  cosmetic_id:
                    type: string
                    format: uuid
                  name:
                    type: string
          additionalProperties: true
        created_at:
          type: string
          format: date-time
          description: Дата создания

    WeeklyChallengeHistoryResponse:
      allOf:
        - $ref: 'common.yaml#/components/schemas/PaginationResponse'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/WeeklyChallengeSummary'

    WeeklyChallengeSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        week_start:
          type: string
          format: date-time
        week_end:
          type: string
          format: date-time
        challenge_type:
          type: string
          enum: [solo_challenge, team_challenge, class_challenge]
        content_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time


