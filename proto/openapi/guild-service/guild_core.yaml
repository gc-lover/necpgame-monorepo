openapi: 3.0.3
info:
  title: Guild Core Service API
  description: Core guild management operations
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
paths:
  /api/v1/social-domain/guilds/health:
    get:
      summary: Guild service health check
      operationId: guildHealthCheck
      tags:
        - Guild Management
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /api/v1/social-domain/guilds:
    post:
      tags:
        - Guild Management
      summary: Create new guild
      description: 'Creates a new guild with specified parameters.

        **BACKEND NOTE:** This operation requires validation of:

        - Guild name uniqueness (case-insensitive)

        - Player level requirements

        - Player doesn''t already own a guild

        - Guild creation cooldowns

        '
      operationId: createGuild
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGuildRequest'
      responses:
        '201':
          description: Guild created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Conflict - guild name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
        - Guild Management
      summary: List guilds
      description: 'Returns paginated list of guilds with filtering options.

        **BACKEND NOTE:** Optimized for large datasets with:

        - Database indexes on commonly filtered fields

        - Cursor-based pagination for performance

        - Cached results for popular queries

        '
      operationId: listGuilds
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: search
          in: query
          description: Search by guild name
          schema:
            type: string
            maxLength: 100
        - name: min_level
          in: query
          description: Minimum guild level
          schema:
            type: integer
            minimum: 1
            maximum: 100
        - name: max_level
          in: query
          description: Maximum guild level
          schema:
            type: integer
            minimum: 1
            maximum: 100
        - name: recruiting
          in: query
          description: Filter by recruiting status
          schema:
            type: boolean
        - name: tags
          in: query
          description: Filter by tags (comma-separated)
          schema:
            type: string
        - name: sort_by
          in: query
          description: Sort field
          schema:
            type: string
            enum:
              - name
              - level
              - member_count
              - reputation
              - created_at
            default: reputation
        - name: sort_order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
      responses:
        '200':
          description: Guilds list
          content:
            application/json:
              schema:
                type: object
                properties:
                  guilds:
                    type: array
                    items:
                      $ref: '#/components/schemas/GuildSummary'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 20
                      total:
                        type: integer
                        example: 150
                      total_pages:
                        type: integer
                        example: 8
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/v1/social-domain/guilds/{guildId}:
    get:
      tags:
        - Guild Management
      summary: Get guild details
      description: 'Returns detailed information about a specific guild.

        **BACKEND NOTE:** Includes member list and statistics.

        Heavy operation - consider caching for frequently accessed guilds.

        '
      operationId: getGuild
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/GuildId'
      responses:
        '200':
          description: Guild details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - Guild Management
      summary: Update guild
      description: 'Updates guild information. Only guild leader and officers can modify.

        **BACKEND NOTE:** Requires permission validation.

        Updates audit log for transparency.

        '
      operationId: updateGuild
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/GuildId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGuildRequest'
      responses:
        '200':
          description: Guild updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Guild Management
      summary: Disband guild
      description: 'Disbands the guild. Only guild leader can perform this action.

        **BACKEND NOTE:** Complex operation involving:

        - Member notifications

        - Resource redistribution

        - Territory release

        - Database cleanup

        - Audit logging

        '
      operationId: disbandGuild
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/GuildId'
      responses:
        '204':
          description: Guild disbanded successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Cannot disband - guild has active territories or wars
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    GuildId:
      name: guildId
      in: path
      required: true
      description: Guild unique identifier
      schema:
        type: string
        format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000
    Page:
      name: page
      in: query
      description: Page number for pagination
      schema:
        type: integer
        minimum: 1
        default: 1
    Limit:
      name: limit
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
  schemas:
    CreateGuildRequest:
      $ref: ./guild-service/schemas/guild-core-schemas.yaml#/components/schemas/CreateGuildRequest
    UpdateGuildRequest:
      $ref: ./guild-service/schemas/guild-core-schemas.yaml#/components/schemas/UpdateGuildRequest
    GuildResponse:
      $ref: ./guild-service/schemas/guild-core-schemas.yaml#/components/schemas/GuildResponse
    GuildSummary:
      $ref: ./guild-service/schemas/guild-core-schemas.yaml#/components/schemas/GuildSummary
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: VALIDATION_ERROR
        message:
          type: string
          example: Invalid guild name
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    HealthResponse:
      type: object
      properties:
        version:
          type: string
          example: 1.0.0
        status:
          type: string
          enum:
            - ok
            - degraded
            - down
          example: ok
        timestamp:
          type: string
          format: date-time
          example: '2024-01-01T12:00:00Z'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    TooManyRequests:
      description: Rate limit exceeded
      headers:
        Retry-After:
          schema:
            type: integer
            example: 60
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
