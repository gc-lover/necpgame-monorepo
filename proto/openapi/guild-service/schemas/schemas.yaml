# Guild Service Schemas
# Issue: #1852

# Основные сущности
Guild:
  type: object
  description: Гильдия с полной информацией
  properties:
    id:
      type: string
      format: uuid
      description: Уникальный идентификатор гильдии
    name:
      type: string
      maxLength: 50
      description: Название гильдии
    tag:
      type: string
      maxLength: 10
      description: Тег гильдии (короткий идентификатор)
    type:
      $ref: "#/GuildType"
    description:
      type: string
      maxLength: 500
      description: Описание гильдии
    motto:
      type: string
      maxLength: 200
      description: Девиз гильдии
    leader_id:
      type: string
      format: uuid
      description: ID лидера гильдии
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time
    member_count:
      type: integer
      minimum: 1
      maximum: 100
    max_members:
      type: integer
      minimum: 10
      maximum: 100
      default: 50
    level:
      type: integer
      minimum: 1
      default: 1
    experience:
      type: integer
      minimum: 0
      default: 0
    reputation:
      type: integer
      minimum: -1000
      maximum: 1000
      default: 0
    treasury:
      type: integer
      minimum: 0
      description: Казна гильдии (в эдди)
    settings:
      $ref: "#/GuildSettings"
    stats:
      $ref: "#/GuildStats"
  required:
    - id
    - name
    - tag
    - type
    - leader_id
    - created_at
    - updated_at

GuildType:
  type: string
  enum: [MERCENARY, CORPORATE, STREET, TECH, NOMAD]
  description: Тип гильдии

GuildSettings:
  type: object
  properties:
    is_recruiting:
      type: boolean
      default: true
      description: Принимает ли новых членов
    min_level:
      type: integer
      minimum: 1
      maximum: 100
      default: 1
      description: Минимальный уровень для вступления
    application_required:
      type: boolean
      default: false
      description: Требуется ли заявка на вступление
    auto_accept:
      type: boolean
      default: false
      description: Автоматическое принятие заявок
    chat_enabled:
      type: boolean
      default: true
      description: Включен ли гильдейский чат
    events_enabled:
      type: boolean
      default: true
      description: Включены ли гильдейские события
  required:
    - is_recruiting

GuildStats:
  type: object
  properties:
    total_missions_completed:
      type: integer
      minimum: 0
    total_earnings:
      type: integer
      minimum: 0
      description: Общий заработок (в эдди)
    average_member_level:
      type: number
      minimum: 1
    win_rate:
      type: number
      minimum: 0
      maximum: 100
      description: Процент побед в миссиях
    ranking_position:
      type: integer
      minimum: 0
      description: Позиция в рейтинге
  required:
    - total_missions_completed
    - total_earnings

GuildMember:
  type: object
  description: Член гильдии
  properties:
    user_id:
      type: string
      format: uuid
    guild_id:
      type: string
      format: uuid
    role:
      $ref: "#/GuildRole"
    joined_at:
      type: string
      format: date-time
    last_active_at:
      type: string
      format: date-time
    contributions:
      type: integer
      minimum: 0
      description: Вклад в гильдию (очки)
    is_online:
      type: boolean
  required:
    - user_id
    - guild_id
    - role
    - joined_at

GuildRole:
  type: string
  enum: [LEADER, OFFICER, MEMBER, RECRUIT]
  description: Роль в гильдии

GuildApplication:
  type: object
  description: Заявка на вступление в гильдию
  properties:
    id:
      type: string
      format: uuid
    user_id:
      type: string
      format: uuid
    guild_id:
      type: string
      format: uuid
    message:
      type: string
      maxLength: 500
      description: Сообщение от кандидата
    status:
      $ref: "#/ApplicationStatus"
    created_at:
      type: string
      format: date-time
    reviewed_at:
      type: string
      format: date-time
      nullable: true
    reviewed_by:
      type: string
      format: uuid
      nullable: true
  required:
    - id
    - user_id
    - guild_id
    - status
    - created_at

ApplicationStatus:
  type: string
  enum: [PENDING, ACCEPTED, REJECTED, WITHDRAWN]
  description: Статус заявки

# Запросы
CreateGuildRequest:
  type: object
  properties:
    name:
      type: string
      maxLength: 50
    tag:
      type: string
      maxLength: 10
    type:
      $ref: "#/GuildType"
    description:
      type: string
      maxLength: 500
    motto:
      type: string
      maxLength: 200
    max_members:
      type: integer
      minimum: 10
      maximum: 100
      default: 50
  required:
    - name
    - tag
    - type

UpdateGuildRequest:
  type: object
  properties:
    name:
      type: string
      maxLength: 50
    tag:
      type: string
      maxLength: 10
    description:
      type: string
      maxLength: 500
    motto:
      type: string
      maxLength: 200
    max_members:
      type: integer
      minimum: 10
      maximum: 100
    settings:
      $ref: "#/GuildSettings"

ApplyToGuildRequest:
  type: object
  properties:
    message:
      type: string
      maxLength: 500
  required: []

InviteToGuildRequest:
  type: object
  properties:
    user_id:
      type: string
      format: uuid
    message:
      type: string
      maxLength: 200
  required:
    - user_id

# Ответы
GuildListResponse:
  type: object
  properties:
    guilds:
      type: array
      items:
        $ref: "#/Guild"
    pagination:
      $ref: "../../common.yaml#/components/schemas/PaginationResponse"
  required:
    - guilds

GuildMembersResponse:
  type: object
  properties:
    members:
      type: array
      items:
        $ref: "#/GuildMember"
    total_count:
      type: integer
  required:
    - members
    - total_count

GuildApplicationsResponse:
  type: object
  properties:
    applications:
      type: array
      items:
        $ref: "#/GuildApplication"
    total_count:
      type: integer
  required:
    - applications
    - total_count