properties:
  invitationId:
    type: string
    format: uuid
    description: ID приглашения
  warId:
    type: string
    format: uuid
    description: ID войны
  allyClanId:
    type: string
    format: uuid
    description: ID союзника
  side:
    type: string
    enum: [ ATTACKER, DEFENDER ]
    description: Сторона союзника
  expiresAt:
    type: string
    format: date-time
    description: Время истечения приглашения
required:
  - invitationId
  - warId
  - allyClanId
  - side
  - expiresAt
"400":
  $ref: "#/components/responses/BadRequest"
"403":
  description: Недостаточно прав для приглашения союзников
  content:
    application/json:
      schema:
        $ref: "#/components/schemas/Error"
"404":
  description: Война или клан не найдены
  content:
    application/json:
      schema:
        $ref: "#/components/schemas/Error"
"409":
  description: Клан уже участвует в войне или приглашение уже отправлено
  content:
    application/json:
      schema:
        $ref: "#/components/schemas/Error"
"500":
  $ref: "#/components/responses/InternalServerError"

/world/clan-war/{warId}/alliance:
  get:
    summary: Получить союзников войны
    description: Возвращает список союзников клановой войны
    operationId: getWarAlliances
    tags:
      - Alliances
    parameters:
      - name: warId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: ID войны
    responses:
      "200":
        description: Успешный ответ с союзниками войны
        content:
          application/json:
            schema:
              type: object
              properties:
                warId:
                  type: string
                  format: uuid
                  description: ID войны
                alliances:
                  type: array
                  items:
                    type: object
                    properties:
                      clanId:
                        type: string
                        format: uuid
                        description: ID союзного клана
                      clanName:
                        type: string
                        description: Название клана
                      side:
                        type: string
                        enum: [ ATTACKER, DEFENDER ]
                        description: Сторона союзника
                      joinedAt:
                        type: string
                        format: date-time
                        description: Время присоединения
                      kills:
                        type: integer
                        description: Убийства союзника
                      scoreContribution:
                        type: integer
                        description: Вклад в очки
                    required:
                      - clanId
                      - clanName
                      - side
                      - joinedAt
                      - kills
                      - scoreContribution
                  description: Список союзников
                totalAllies:
                  type: integer
                  description: Общее количество союзников
              required:
                - warId
                - alliances
                - totalAllies
      "404":
        $ref: "#/components/responses/NotFound"
      "500":
        $ref: "#/components/responses/InternalServerError"

  post:
    summary: Удалить союзника
    description: |
      Удаляет клан из списка союзников войны.
      Доступно только участникам войны.
    operationId: removeAlliance
    tags:
      - Alliances
    parameters:
      - name: warId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: ID войны
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - allyClanId
            properties:
              allyClanId:
                type: string
                format: uuid
                description: ID союзного клана для удаления
              reason:
                type: string
                maxLength: 255
                description: Причина удаления
    responses:
      "204":
        description: Союзник удален
      "403":
        description: Недостаточно прав для удаления союзника
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Война или союзник не найдены
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "409":
        description: Союзника нельзя удалить в текущей фазе войны
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "500":
        $ref: "#/components/responses/InternalServerError"

# События войны
/world/clan-war/events/{warId}:
  get:
    summary: Получить события войны
    description: |
      Возвращает последние события клановой войны.
      Полезно для отладки и мониторинга.
    operationId: getWarEvents
    tags:
      - Events
    parameters:
      - name: warId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: ID войны
      - name: eventType
        in: query
        schema:
          type: string
          enum:
            [
              declared,
              phase-changed,
              battle-started,
              battle-ended,
              territory-captured,
              ended,
              rewards-distributed,
            ]
        description: Фильтр по типу события
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 50
        description: Количество событий
      - name: since
        in: query
        schema:
          type: string
          format: date-time
        description: События начиная с указанного времени
    responses:
      "200":
        description: События войны получены
        content:
          application/json:
            schema:
              type: object
              properties:
                warId:
                  type: string
                  format: uuid
                  description: ID войны
                events:
                  type: array
                  items:
                    $ref: "#/components/schemas/WarEvent"
                  description: Список событий
                total:
                  type: integer
                  description: Общее количество событий
              required:
                - warId
                - events
      "404":
        $ref: "#/components/responses/NotFound"
      "500":
        $ref: "#/components/responses/InternalServerError"

components:
  schemas:
    # Основные сущности
    ClanWar:
      type: object
      description: Клановая война
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный ID войны
        status:
          type: string
          enum: [ DECLARED, PREPARATION, ACTIVE, ENDING, ENDED ]
          description: Статус войны
        phase:
          type: string
          enum: [ PREPARATION, ACTIVE, ENDING ]
          description: Текущая фаза
        attackerClanId:
          type: string
          format: uuid
          description: ID атакующего клана
        defenderClanId:
          type: string
          format: uuid
          description: ID защищающегося клана
        winnerClanId:
          type: string
          format: uuid
          description: ID победившего клана
        attackerScore:
          type: integer
          description: Очки атакующего
        defenderScore:
          type: integer
          description: Очки защищающегося
        alliesAttacker:
          type: array
          items:
            type: string
            format: uuid
          description: Союзники атакующего
        alliesDefender:
          type: array
          items:
            type: string
            format: uuid
          description: Союзники защищающегося
        declaredAt:
          type: string
          format: date-time
          description: Время объявления
        preparationStartedAt:
          type: string
          format: date-time
          description: Начало фазы подготовки
        activeStartedAt:
          type: string
          format: date-time
          description: Начало активной фазы
        endedAt:
          type: string
          format: date-time
          description: Время окончания
        createdAt:
          type: string
          format: date-time
          description: Время создания
        updatedAt:
          type: string
          format: date-time
          description: Время обновления
      required:
        - id
        - status
        - attackerClanId
        - defenderClanId
        - declaredAt
        - createdAt

    Territory:
      type: object
      description: Территория
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный ID территории
        name:
          type: string
          description: Название территории
        ownerClanId:
          type: string
          format: uuid
          description: ID владельца
        resourceType:
          type: string
          enum: [ ORE, ENERGY, DATA, MIXED ]
          description: Тип ресурсов
        resourceAmount:
          type: integer
          description: Количество ресурсов
        defenseLevel:
          type: integer
          description: Уровень защиты
        siegeDifficulty:
          type: integer
          description: Сложность осады
        locationX:
          type: number
          format: float
          description: Координата X
        locationY:
          type: number
          format: float
          description: Координата Y
        locationZ:
          type: number
          format: float
          description: Координата Z
        isActive:
          type: boolean
          description: Активна ли территория
        capturedAt:
          type: string
          format: date-time
          description: Время захвата
        createdAt:
          type: string
          format: date-time
          description: Время создания
        updatedAt:
          type: string
          format: date-time
          description: Время обновления
      required:
        - id
        - name
        - resourceType
        - resourceAmount
        - defenseLevel
        - siegeDifficulty
        - isActive
        - createdAt
