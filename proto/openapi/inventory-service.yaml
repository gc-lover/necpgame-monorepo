openapi: 3.0.3
info:
  title: Inventory Service API
  description: API для управления инвентарем персонажей в NECPGAME
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
- url: http://localhost:8084/api/v1
  description: Локальный сервер разработки
- url: https://api.necp.game/api/v1
  description: Продакшен сервер
tags:
- name: Inventory
  description: Управление инвентарем персонажей
- name: Items
  description: Управление предметами
- name: Equipment
  description: Экипировка предметов
- name: Transfer
  description: Передача предметов
- name: Bank
  description: Банк персонажа
paths:
  # Получение инвентаря персонажа
  /characters/{characterId}/inventory:
    get:
      tags:
      - Inventory
      summary: Получить инвентарь персонажа
      operationId: getCharacterInventory
      parameters:
      - name: characterId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: includeBank
        in: query
        schema:
          type: boolean
          default: false
      responses:
        '200':
          description: Инвентарь персонажа
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterInventoryResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Добавление предмета в инвентарь
  /characters/{characterId}/inventory/items:
    post:
      tags:
      - Items
      summary: Добавить предмет в инвентарь
      operationId: addItemToInventory
      parameters:
      - name: characterId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddItemRequest'
      responses:
        '201':
          description: Предмет добавлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventoryItemResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Недостаточно места в инвентаре
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Получение предмета по ID
  /inventory/items/{itemId}:
    get:
      tags:
      - Items
      summary: Получить информацию о предмете
      operationId: getInventoryItem
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Информация о предмете
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventoryItemResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Обновление предмета
  /inventory/items/{itemId}:
    put:
      tags:
      - Items
      summary: Обновить предмет
      operationId: updateInventoryItem
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateItemRequest'
      responses:
        '200':
          description: Предмет обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventoryItemResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Удаление предмета
  /inventory/items/{itemId}:
    delete:
      tags:
      - Items
      summary: Удалить предмет из инвентаря
      operationId: removeInventoryItem
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RemoveItemRequest'
      responses:
        '200':
          description: Предмет удален
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Предмет нельзя удалить (связан с экипировкой)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Перемещение предмета
  /inventory/items/{itemId}/move:
    post:
      tags:
      - Items
      summary: Переместить предмет в другой слот
      operationId: moveInventoryItem
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveItemRequest'
      responses:
        '200':
          description: Предмет перемещен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventoryItemResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Слот занят или недоступен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Экипировка предмета
  /characters/{characterId}/equipment:
    post:
      tags:
      - Equipment
      summary: Экипировать предмет
      operationId: equipItem
      parameters:
      - name: characterId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EquipItemRequest'
      responses:
        '200':
          description: Предмет экипирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EquipmentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Предмет нельзя экипировать (требования не соблюдены)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Снятие предмета
  /characters/{characterId}/equipment/{slot}:
    delete:
      tags:
      - Equipment
      summary: Снять предмет с экипировки
      operationId: unequipItem
      parameters:
      - name: characterId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: slot
        in: path
        required: true
        schema:
          type: string
          enum: [head, chest, arms, legs, feet, weapon_primary, weapon_secondary, cyberware_1, cyberware_2, cyberware_3]
      responses:
        '200':
          description: Предмет снят
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Получение экипировки персонажа
  /characters/{characterId}/equipment:
    get:
      tags:
      - Equipment
      summary: Получить экипировку персонажа
      operationId: getCharacterEquipment
      parameters:
      - name: characterId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Экипировка персонажа
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterEquipmentResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Передача предмета
  /inventory/items/{itemId}/transfer:
    post:
      tags:
      - Transfer
      summary: Передать предмет другому персонажу
      operationId: transferItem
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferItemRequest'
      responses:
        '200':
          description: Предмет передан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          description: Передача запрещена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Недостаточно места у получателя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Объединение стеков предметов
  /inventory/items/stack:
    post:
      tags:
      - Items
      summary: Объединить стеки предметов
      operationId: stackItems
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StackItemsRequest'
      responses:
        '200':
          description: Предметы объединены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StackItemsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Предметы нельзя объединить
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Разделение стека предметов
  /inventory/items/{itemId}/split:
    post:
      tags:
      - Items
      summary: Разделить стек предметов
      operationId: splitItemStack
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SplitItemRequest'
      responses:
        '200':
          description: Стек разделен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SplitItemResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Стек нельзя разделить
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Поиск предметов
  /characters/{characterId}/inventory/search:
    get:
      tags:
      - Inventory
      summary: Поиск предметов в инвентаре
      operationId: searchInventory
      parameters:
      - name: characterId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: query
        in: query
        schema:
          type: string
          description: Поисковый запрос
      - name: category
        in: query
        schema:
          type: string
          enum: [weapon, armor, consumable, cyberware, miscellaneous]
      - name: rarity
        in: query
        schema:
          type: string
          enum: [common, uncommon, rare, epic, legendary]
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 50
      responses:
        '200':
          description: Результаты поиска
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResultsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Банк персонажа
  /characters/{characterId}/bank:
    get:
      tags:
      - Bank
      summary: Получить содержимое банка персонажа
      operationId: getCharacterBank
      parameters:
      - name: characterId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Содержимое банка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterBankResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Перемещение в банк
  /inventory/items/{itemId}/to-bank:
    post:
      tags:
      - Bank
      summary: Переместить предмет в банк
      operationId: moveItemToBank
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Предмет перемещен в банк
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Недостаточно места в банке
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Перемещение из банка
  /bank/items/{itemId}/to-inventory:
    post:
      tags:
      - Bank
      summary: Переместить предмет из банка в инвентарь
      operationId: moveItemFromBank
      parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Предмет перемещен в инвентарь
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Недостаточно места в инвентаре
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Запросы
    AddItemRequest:
      type: object
      required:
      - itemTemplateId
      - quantity
      properties:
        itemTemplateId:
          type: string
          format: uuid
          description: ID шаблона предмета
        quantity:
          type: integer
          minimum: 1
          description: Количество предметов
        durability:
          type: integer
          minimum: 0
          maximum: 100
          description: Прочность предмета (для брони/оружия)
        modifiers:
          type: object
          description: Модификаторы предмета
        boundToCharacter:
          type: boolean
          default: false
          description: Привязан ли предмет к персонажу

    UpdateItemRequest:
      type: object
      properties:
        quantity:
          type: integer
          minimum: 1
          description: Новое количество
        durability:
          type: integer
          minimum: 0
          maximum: 100
          description: Новая прочность
        modifiers:
          type: object
          description: Новые модификаторы

    RemoveItemRequest:
      type: object
      required:
      - quantity
      properties:
        quantity:
          type: integer
          minimum: 1
          description: Количество для удаления

    MoveItemRequest:
      type: object
      required:
      - targetSlot
      properties:
        targetSlot:
          type: integer
          minimum: 0
          maximum: 49
          description: Целевой слот (0-49 для инвентаря)

    EquipItemRequest:
      type: object
      required:
      - itemId
      - slot
      properties:
        itemId:
          type: string
          format: uuid
          description: ID предмета для экипировки
        slot:
          type: string
          enum: [head, chest, arms, legs, feet, weapon_primary, weapon_secondary, cyberware_1, cyberware_2, cyberware_3]
          description: Слот экипировки

    TransferItemRequest:
      type: object
      required:
      - targetCharacterId
      - quantity
      properties:
        targetCharacterId:
          type: string
          format: uuid
          description: ID персонажа-получателя
        quantity:
          type: integer
          minimum: 1
          description: Количество для передачи

    StackItemsRequest:
      type: object
      required:
      - sourceItemId
      - targetItemId
      properties:
        sourceItemId:
          type: string
          format: uuid
          description: ID исходного предмета
        targetItemId:
          type: string
          format: uuid
          description: ID целевого предмета

    SplitItemRequest:
      type: object
      required:
      - quantity
      properties:
        quantity:
          type: integer
          minimum: 1
          description: Количество для отделения

    # Ответы
    CharacterInventoryResponse:
      type: object
      properties:
        characterId:
          type: string
          format: uuid
        inventory:
          $ref: '#/components/schemas/Inventory'
        equipment:
          $ref: '#/components/schemas/Equipment'
        bank:
          $ref: '#/components/schemas/Bank'
        totalWeight:
          type: number
          description: Общий вес инвентаря
        maxWeight:
          type: number
          description: Максимальный вес

    InventoryItemResponse:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/InventoryItem'

    EquipmentResponse:
      type: object
      properties:
        characterId:
          type: string
          format: uuid
        slot:
          type: string
        equippedItem:
          $ref: '#/components/schemas/InventoryItem'

    CharacterEquipmentResponse:
      type: object
      properties:
        characterId:
          type: string
          format: uuid
        equipment:
          $ref: '#/components/schemas/Equipment'

    CharacterBankResponse:
      type: object
      properties:
        characterId:
          type: string
          format: uuid
        bank:
          $ref: '#/components/schemas/Bank'

    StackItemsResponse:
      type: object
      properties:
        sourceItem:
          $ref: '#/components/schemas/InventoryItem'
        targetItem:
          $ref: '#/components/schemas/InventoryItem'
        mergedQuantity:
          type: integer

    SplitItemResponse:
      type: object
      properties:
        originalItem:
          $ref: '#/components/schemas/InventoryItem'
        newItem:
          $ref: '#/components/schemas/InventoryItem'

    SearchResultsResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/InventoryItem'
        totalCount:
          type: integer
        query:
          type: string

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          default: true
        message:
          type: string

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        code:
          type: string
        details:
          type: object

    # Основные сущности
    Inventory:
      type: object
      properties:
        slots:
          type: array
          items:
            type: object
            properties:
              slotId:
                type: integer
                minimum: 0
                maximum: 49
              item:
                $ref: '#/components/schemas/InventoryItem'

    Equipment:
      type: object
      properties:
        head:
          $ref: '#/components/schemas/InventoryItem'
        chest:
          $ref: '#/components/schemas/InventoryItem'
        arms:
          $ref: '#/components/schemas/InventoryItem'
        legs:
          $ref: '#/components/schemas/InventoryItem'
        feet:
          $ref: '#/components/schemas/InventoryItem'
        weapon_primary:
          $ref: '#/components/schemas/InventoryItem'
        weapon_secondary:
          $ref: '#/components/schemas/InventoryItem'
        cyberware_1:
          $ref: '#/components/schemas/InventoryItem'
        cyberware_2:
          $ref: '#/components/schemas/InventoryItem'
        cyberware_3:
          $ref: '#/components/schemas/InventoryItem'

    Bank:
      type: object
      properties:
        slots:
          type: array
          items:
            type: object
            properties:
              slotId:
                type: integer
              item:
                $ref: '#/components/schemas/InventoryItem'

    InventoryItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        itemTemplateId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [weapon, armor, consumable, cyberware, miscellaneous]
        rarity:
          type: string
          enum: [common, uncommon, rare, epic, legendary]
        quantity:
          type: integer
          minimum: 1
        maxStackSize:
          type: integer
          minimum: 1
        durability:
          type: integer
          minimum: 0
          maximum: 100
        weight:
          type: number
          minimum: 0
        value:
          type: integer
          minimum: 0
        modifiers:
          type: object
          description: Модификаторы предмета
        boundToCharacter:
          type: boolean
        slot:
          type: integer
          description: Номер слота в инвентаре
        equipped:
          type: boolean
          default: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: Не авторизован
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Forbidden:
      description: Доступ запрещен
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Conflict:
      description: Конфликт данных
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    TooManyRequests:
      description: Слишком много запросов
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'