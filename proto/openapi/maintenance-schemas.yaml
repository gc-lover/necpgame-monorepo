# Issue: #316
openapi: 3.0.3
info:
  title: Maintenance Service Schemas
  description: Схемы данных для Maintenance Service API
  version: 1.0.0

components:
  schemas:
    CreateMaintenanceWindowRequest:
      type: object
      required:
        - maintenance_type
        - scheduled_start
        - scheduled_end
        - title
      properties:
        maintenance_type:
          type: string
          enum:
            - SCHEDULED
            - EMERGENCY
            - HOT_FIX
            - ROLLBACK
            - UPGRADE
        scheduled_start:
          type: string
          format: date-time
        scheduled_end:
          type: string
          format: date-time
        title:
          type: string
          maxLength: 255
        description:
          type: string
        impact:
          type: string
          maxLength: 100
        affected_services:
          type: array
          items:
            type: string

    UpdateMaintenanceWindowRequest:
      type: object
      properties:
        scheduled_start:
          type: string
          format: date-time
        scheduled_end:
          type: string
          format: date-time
        title:
          type: string
          maxLength: 255
        description:
          type: string
        impact:
          type: string
          maxLength: 100
        affected_services:
          type: array
          items:
            type: string
        status:
          type: string
          enum:
            - PLANNED
            - NOTIFIED
            - STARTING
            - ACTIVE
            - COMPLETING
            - COMPLETED
            - CANCELLED

    MaintenanceWindow:
      type: object
      properties:
        id:
          type: string
          format: uuid
        maintenance_type:
          type: string
          enum:
            - SCHEDULED
            - EMERGENCY
            - HOT_FIX
            - ROLLBACK
            - UPGRADE
        status:
          type: string
          enum:
            - PLANNED
            - NOTIFIED
            - STARTING
            - ACTIVE
            - COMPLETING
            - COMPLETED
            - CANCELLED
        scheduled_start:
          type: string
          format: date-time
        scheduled_end:
          type: string
          format: date-time
        actual_start:
          type: string
          format: date-time
          nullable: true
        actual_end:
          type: string
          format: date-time
          nullable: true
        title:
          type: string
        description:
          type: string
        impact:
          type: string
        affected_services:
          type: array
          items:
            type: string
        created_by:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MaintenanceWindowsResponse:
      type: object
      properties:
        windows:
          type: array
          items:
            $ref: '#/components/schemas/MaintenanceWindow'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    MaintenanceStatus:
      type: object
      properties:
        is_maintenance_mode:
          type: boolean
        current_window_id:
          type: string
          format: uuid
          nullable: true
        block_new_connections:
          type: boolean
        allow_admin_access:
          type: boolean
        maintenance_message:
          type: string
          nullable: true
        updated_at:
          type: string
          format: date-time

    UpdateMaintenanceStatusRequest:
      type: object
      properties:
        is_maintenance_mode:
          type: boolean
        block_new_connections:
          type: boolean
        allow_admin_access:
          type: boolean
        maintenance_message:
          type: string

    ScheduleMaintenanceRequest:
      type: object
      required:
        - window_id
      properties:
        window_id:
          type: string
          format: uuid

    StartGracefulShutdownRequest:
      type: object
      required:
        - window_id
      properties:
        window_id:
          type: string
          format: uuid
        timeout_seconds:
          type: integer
          default: 300
          description: Таймаут для graceful shutdown в секундах

    GracefulShutdownStatus:
      type: object
      properties:
        is_shutting_down:
          type: boolean
        window_id:
          type: string
          format: uuid
          nullable: true
        started_at:
          type: string
          format: date-time
          nullable: true
        services_notified:
          type: integer
        services_shutdown:
          type: integer
        total_services:
          type: integer
        estimated_completion:
          type: string
          format: date-time
          nullable: true

    SendMaintenanceNotificationRequest:
      type: object
      required:
        - window_id
        - notification_type
      properties:
        window_id:
          type: string
          format: uuid
        notification_type:
          type: string
          enum:
            - SCHEDULED_24H
            - SCHEDULED_1H
            - STARTING
            - STARTED
            - COMPLETED

    MaintenanceNotification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        maintenance_window_id:
          type: string
          format: uuid
        notification_type:
          type: string
          enum:
            - SCHEDULED_24H
            - SCHEDULED_1H
            - STARTING
            - STARTED
            - COMPLETED
        sent_at:
          type: string
          format: date-time
        recipients_count:
          type: integer

    MaintenanceNotificationsResponse:
      type: object
      properties:
        notifications:
          type: array
          items:
            $ref: '#/components/schemas/MaintenanceNotification'
        total:
          type: integer

    MaintenanceEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        maintenance_window_id:
          type: string
          format: uuid
        event_type:
          type: string
          enum:
            - window-created
            - window-scheduled
            - window-starting
            - window-started
            - window-completing
            - window-completed
            - window-cancelled
        event_data:
          type: object
        created_at:
          type: string
          format: date-time

    MaintenanceEventsResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/MaintenanceEvent'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    AdminStartMaintenanceRequest:
      type: object
      required:
        - window_id
      properties:
        window_id:
          type: string
          format: uuid
        force:
          type: boolean
          default: false
          description: Принудительный запуск без graceful shutdown

    AdminStopMaintenanceRequest:
      type: object
      required:
        - window_id
      properties:
        window_id:
          type: string
          format: uuid
        force:
          type: boolean
          default: false
          description: Принудительная остановка

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string

