- Exchanges
summary: Create a new exchange
operationId: createExchange
security:
  - BearerAuth: [ ]
requestBody:
  required: true
  content:
    application/json:
      schema:
        $ref: '#/components/schemas/CreateExchangeRequest'
responses:
  '201':
    description: Exchange created
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/CreateExchangeResponse'
  '400':
    description: Invalid request data
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/Error'
  '401':
    description: Unauthorized
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/Error'
  '409':
    description: Exchange already exists
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/Error'

/mq/consumers:
  get:
    tags:
      - Consumers
    summary: List active consumers
    operationId: listConsumers
    security:
      - BearerAuth: [ ]
    parameters:
      - name: queue_name
        in: query
        schema:
          type: string
      - name: status
        in: query
        schema:
          type: string
          enum: [ active, inactive, error ]
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
    responses:
      '200':
        description: List of consumers
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListConsumersResponse'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

  post:
    tags:
      - Consumers
    summary: Register a new consumer
    operationId: registerConsumer
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RegisterConsumerRequest'
    responses:
      '201':
        description: Consumer registered
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterConsumerResponse'
      '400':
        description: Invalid request data
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
      '404':
        description: Queue not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

/mq/events/publish:
  post:
    tags:
      - Events
    summary: Publish an event to an exchange
    operationId: publishEvent
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PublishEventRequest'
    responses:
      '200':
        description: Event published
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublishEventResponse'
      '400':
        description: Invalid request data
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
      '404':
        description: Exchange not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

/mq/bindings:
  post:
    tags:
      - Exchanges
    summary: Create a binding between exchange and queue
    operationId: createBinding
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateBindingRequest'
    responses:
      '201':
        description: Binding created
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBindingResponse'
      '400':
        description: Invalid request data
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
      '404':
        description: Exchange or queue not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
      '409':
        description: Binding already exists
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Error schema
    Error:
      type: object
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string
        details:
          type: string
      required:
        - code
        - message

    # Queue schemas
    Queue:
      type: object
      properties:
        name:
          type: string
        durable:
          type: boolean
        auto_delete:
          type: boolean
        exclusive:
          type: boolean
        arguments:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [ active, paused, dead ]
        message_count:
          type: integer
        consumer_count:
          type: integer
        created_at:
          type: integer
          format: int64
        last_activity:
          type: integer
          format: int64
      required:
        - name
        - durable
        - status
        - message_count
        - consumer_count

    CreateQueueRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          pattern: '^[a-zA-Z0-9._-]+$'
        durable:
          type: boolean
          default: true
        auto_delete:
          type: boolean
          default: false
        exclusive:
          type: boolean
          default: false
        arguments:
          type: object
          additionalProperties: true
          description: Additional queue arguments
      required:
        - name

    CreateQueueResponse:
      type: object
      properties:
        name:
          type: string
        status:
          type: string
        created_at:
          type: integer
          format: int64
      required:
        - name
        - status
        - created_at

    ListQueuesResponse:
      type: object
      properties:
        queues:
          type: array
          items:
            $ref: '#/components/schemas/Queue'
        total_count:
          type: integer
      required:
        - queues
        - total_count

    GetQueueResponse:
      type: object
      properties:
        queue:
          $ref: '#/components/schemas/Queue'
        stats:
          $ref: '#/components/schemas/QueueStats'
      required:
        - queue
        - stats

    QueueStats:
      type: object
      properties:
        messages_ready:
          type: integer
        messages_unacked:
          type: integer
        consumers:
          type: integer
        publish_rate:
          type: number
          format: float
        deliver_rate:
          type: number
          format: float
        ack_rate:
          type: number
          format: float
        nack_rate:
          type: number
          format: float
      required:
        - messages_ready
        - messages_unacked
        - consumers

    UpdateQueueRequest:
      type: object
      properties:
        durable:
          type: boolean
        arguments:
          type: object
          additionalProperties: true

    UpdateQueueResponse:
      type: object
      properties:
        name:
          type: string
        updated_at:
          type: integer
          format: int64
      required:
        - name
        - updated_at

    # Message schemas
    Message:
      type: object
      properties:
        message_id:
          type: string
          format: uuid
        routing_key:
          type: string
        body:
          type: string
        content_type:
          type: string
        headers:
          type: object
          additionalProperties: true
        delivery_mode:
          type: integer
          enum: [ 1, 2 ]  # 1=transient, 2=persistent
        priority:
          type: integer
          minimum: 0
          maximum: 255
        timestamp:
          type: integer
          format: int64
        expiration:
          type: string
        user_id:
          type: string
        app_id:
