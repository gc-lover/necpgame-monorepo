# Issue: #1850
openapi: 3.0.3
info:
  title: Party System Service API
  description: |
    Полная API спецификация для системы управления группами игроков.
    Поддерживает создание групп, приглашения, распределение лута и совместные задания.

    **Ключевые возможности:**
    - Управление группами до 5 игроков
    - Система приглашений с таймаутами
    - Распределение лута (4 режима)
    - Координация совместных заданий
    - Realtime синхронизация состояния
  version: 2.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com

servers:
  - url: http://localhost:8084/api/v1
    description: Party System Service (локальная разработка)
  - url: https://party.necpgame.com/api/v1
    description: Party System Service (продакшен)

tags:
  - name: Party Management
    description: Управление группами и их состоянием
  - name: Member Management
    description: Управление участниками групп
  - name: Invitations
    description: Система приглашений
  - name: Loot Distribution
    description: Распределение лута
  - name: Quest Coordination
    description: Координация совместных заданий
  - name: Monitoring
    description: Мониторинг и статистика

paths:
  # Party Management
  /social/party:
    post:
      tags:
        - Party Management
      summary: Создать новую группу
      description: |
        Создаёт новую группу с текущим игроком в качестве лидера.
        Максимальный размер группы: 5 игроков.
      operationId: createParty
      security:
        - BearerAuth: [ ]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePartyRequest"
      responses:
        "200":
          description: Группа создана успешно
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Party"
        "400":
          $ref: common.yaml#/components/responses/BadRequest
        "409":
          description: Игрок уже состоит в группе
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RateLimitError"

  /social/party/my:
    get:
      tags:
        - Party Management
      summary: Получить текущую группу игрока
      description: Возвращает информацию о группе, в которой состоит текущий игрок
      operationId: getMyParty
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Информация о группе
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Party"
        "404":
          description: Игрок не состоит в группе
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error

  /social/party/{partyId}:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: ID группы

    get:
      tags:
        - Party Management
      summary: Получить информацию о группе
      description: Возвращает полную информацию о группе по её ID
      operationId: getParty
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Информация о группе
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Party"
        "403":
          $ref: common.yaml#/components/responses/Forbidden
        "404":
          $ref: common.yaml#/components/responses/NotFound

    put:
      tags:
        - Party Management
      summary: Обновить настройки группы
      description: Обновляет настройки группы (только лидер)
      operationId: updateParty
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePartyRequest"
      responses:
        "200":
          description: Настройки обновлены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Party"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

    delete:
      tags:
        - Party Management
      summary: Распустить группу
      description: Распускает группу (только лидер)
      operationId: disbandParty
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Группа распущена
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

  # Member Management
  /social/party/{partyId}/members:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    post:
      tags:
        - Member Management
      summary: Добавить участника в группу
      description: Добавляет игрока в группу (только лидер)
      operationId: addPartyMember
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddMemberRequest"
      responses:
        "200":
          description: Участник добавлен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartyMember"
        "400":
          $ref: common.yaml#/components/responses/BadRequest
        "403":
          $ref: common.yaml#/components/responses/Forbidden
        "409":
          description: Группа полная или игрок уже в группе
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error

  /social/party/{partyId}/members/{accountId}:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: accountId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    put:
      tags:
        - Member Management
      summary: Изменить роль участника
      description: Изменяет роль участника группы (только лидер)
      operationId: updateMemberRole
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRoleRequest"
      responses:
        "200":
          description: Роль обновлена
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartyMember"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

    delete:
      tags:
        - Member Management
      summary: Удалить участника из группы
      description: Удаляет участника из группы (лидер или сам участник)
      operationId: removePartyMember
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Участник удалён
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

  /social/party/{partyId}/leave:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    post:
      tags:
        - Member Management
      summary: Покинуть группу
      description: Позволяет участнику покинуть группу
      operationId: leaveParty
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Игрок покинул группу
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"

  # Invitations
  /social/party/{partyId}/invitations:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    post:
      tags:
        - Invitations
      summary: Пригласить игрока в группу
      description: Отправляет приглашение игроку присоединиться к группе
      operationId: sendPartyInvitation
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SendInvitationRequest"
      responses:
        "200":
          description: Приглашение отправлено
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartyInvitation"
        "400":
          $ref: common.yaml#/components/responses/BadRequest
        "403":
          $ref: common.yaml#/components/responses/Forbidden
        "404":
          description: Игрок не найден
          content:
            application/json:
              schema:
                $ref: common.yaml#/components/schemas/Error

  /social/party/invitations/my:
    get:
      tags:
        - Invitations
      summary: Получить мои приглашения
      description: Возвращает список активных приглашений для текущего игрока
      operationId: getMyInvitations
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Список приглашений
          content:
            application/json:
              schema:
                type: object
                properties:
                  invitations:
                    type: array
                    items:
                      $ref: "#/components/schemas/PartyInvitation"

  /social/party/invitations/{invitationId}/accept:
    parameters:
      - name: invitationId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    post:
      tags:
        - Invitations
      summary: Принять приглашение
      description: Принимает приглашение в группу
      operationId: acceptInvitation
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Приглашение принято
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Party"
        "400":
          $ref: common.yaml#/components/responses/BadRequest
        "404":
          $ref: common.yaml#/components/responses/NotFound
        "410":
          description: Приглашение истекло
          content:
            application/json:
              schema:
