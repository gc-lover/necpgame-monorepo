                $ref: common.yaml#/components/schemas/Error

  /social/party/invitations/{invitationId}/decline:
    parameters:
      - name: invitationId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    post:
      tags:
        - Invitations
      summary: Отклонить приглашение
      description: Отклоняет приглашение в группу
      operationId: declineInvitation
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Приглашение отклонено
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"
        "404":
          $ref: common.yaml#/components/responses/NotFound

  # Loot Distribution
  /social/party/{partyId}/loot-mode:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    get:
      tags:
        - Loot Distribution
      summary: Получить режим распределения лута
      description: Возвращает текущий режим распределения лута группы
      operationId: getLootMode
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Режим распределения лута
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LootModeResponse"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

    put:
      tags:
        - Loot Distribution
      summary: Изменить режим распределения лута
      description: Изменяет режим распределения лута группы (только лидер)
      operationId: setLootMode
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetLootModeRequest"
      responses:
        "200":
          description: Режим изменён
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LootModeResponse"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

  /social/party/{partyId}/loot/distribute:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    post:
      tags:
        - Loot Distribution
      summary: Распределить лут
      description: Распределяет предметы между участниками группы согласно выбранному режиму
      operationId: distributeLoot
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DistributeLootRequest"
      responses:
        "200":
          description: Лут распределён
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LootDistributionResult"
        "400":
          $ref: common.yaml#/components/responses/BadRequest
        "403":
          $ref: common.yaml#/components/responses/Forbidden

  # Quest Coordination
  /social/party/{partyId}/quests:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    get:
      tags:
        - Quest Coordination
      summary: Получить задания группы
      description: Возвращает список активных заданий группы
      operationId: getPartyQuests
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Задания группы
          content:
            application/json:
              schema:
                type: object
                properties:
                  quests:
                    type: array
                    items:
                      $ref: "#/components/schemas/PartyQuest"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

  /social/party/{partyId}/quests/{questId}/sync:
    parameters:
      - name: partyId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: questId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    post:
      tags:
        - Quest Coordination
      summary: Синхронизировать прогресс задания
      description: Синхронизирует прогресс задания между участниками группы
      operationId: syncQuestProgress
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SyncQuestRequest"
      responses:
        "200":
          description: Прогресс синхронизирован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuestSyncResult"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

  # Monitoring
  /social/party/stats:
    get:
      tags:
        - Monitoring
      summary: Получить статистику групп
      description: Возвращает общую статистику системы групп
      operationId: getPartyStats
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Статистика групп
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartyStats"
        "403":
          $ref: common.yaml#/components/responses/Forbidden

components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth

  schemas:
    # Party Management
    CreatePartyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 50
          description: Название группы (опционально)
        loot_mode:
          $ref: "#/components/schemas/LootMode"
        settings:
          type: object
          description: Дополнительные настройки группы
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    UpdatePartyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 50
        loot_mode:
          $ref: "#/components/schemas/LootMode"
        settings:
          type: object
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    Party:
      type: object
      properties:
        id:
          type: string
          format: uuid
        leader_id:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        loot_mode:
          $ref: "#/components/schemas/LootMode"
        status:
          $ref: "#/components/schemas/PartyStatus"
        max_members:
          type: integer
          default: 5
        current_members:
          type: integer
        members:
          type: array
          items:
            $ref: "#/components/schemas/PartyMember"
        settings:
          type: object
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    PartyStatus:
      type: string
      enum: [active, disbanded]
      description: Статус группы

    PartyMember:
      type: object
      properties:
        account_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
          nullable: true
        role:
          $ref: "#/components/schemas/MemberRole"
        joined_at:
          type: string
          format: date-time
        last_active_at:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    MemberRole:
      type: string
      enum: [leader, member]
      description: Роль участника в группе

    # Invitations
    SendInvitationRequest:
      type: object
      required:
        - account_id
      properties:
        account_id:
          type: string
          format: uuid
          description: ID приглашаемого игрока
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    PartyInvitation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        party_id:
          type: string
          format: uuid
        inviter_id:
          type: string
          format: uuid
        invitee_id:
          type: string
          format: uuid
        status:
          $ref: "#/components/schemas/InvitationStatus"
        expires_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    InvitationStatus:
      type: string
      enum: [pending, accepted, declined, expired]

    # Member Management
    AddMemberRequest:
      type: object
      required:
        - account_id
      properties:
        account_id:
          type: string
          format: uuid
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    UpdateRoleRequest:
      type: object
      required:
        - role
      properties:
        role:
          $ref: "#/components/schemas/MemberRole"
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    # Loot Distribution
    LootMode:
      type: string
      enum: [free_for_all, need_before_greed, master_looter, round_robin]
      description: Режим распределения лута

    LootModeResponse:
      type: object
      properties:
        loot_mode:
          $ref: "#/components/schemas/LootMode"
        set_by:
          type: string
          format: uuid
          description: ID игрока, установившего режим
        set_at:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    SetLootModeRequest:
      type: object
      required:
        - loot_mode
      properties:
        loot_mode:
          $ref: "#/components/schemas/LootMode"
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    DistributeLootRequest:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/LootItem"
        source:
          type: string
          enum: [combat, quest, container]
          description: Источник лута
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    LootItem:
      type: object
      required:
        - item_id
      properties:
        item_id:
          type: string
          format: uuid
        quantity:
          type: integer
          minimum: 1
        quality:
          type: string
          enum: [common, uncommon, rare, epic, legendary]
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    LootDistributionResult:
      type: object
      properties:
        distributions:
          type: array
          items:
            $ref: "#/components/schemas/ItemDistribution"
        mode_used:
          $ref: "#/components/schemas/LootMode"
        completed_at:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    ItemDistribution:
      type: object
      properties:
        item_id:
          type: string
          format: uuid
        distributed_to:
          type: string
          format: uuid
        quantity:
          type: integer
        method:
          type: string
          enum: [assigned, rolled, traded]
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    # Quest Coordination
    PartyQuest:
      type: object
      properties:
        quest_id:
          type: string
          format: uuid
        title:
          type: string
        progress:
          type: object
          description: Прогресс выполнения задания
        participants:
          type: array
          items:
            type: string
            format: uuid
          description: Участники, работающие над заданием
        started_at:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    SyncQuestRequest:
      type: object
      required:
        - progress_data
      properties:
        progress_data:
          type: object
          description: Данные прогресса для синхронизации
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    QuestSyncResult:
      type: object
      properties:
        quest_id:
          type: string
          format: uuid
        synced_progress:
          type: object
        synced_at:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    # Monitoring
    PartyStats:
      type: object
      properties:
        total_parties:
          type: integer
        active_parties:
          type: integer
        disbanded_parties_today:
          type: integer
        average_party_size:
          type: number
          format: float
        loot_distributions_today:
          type: integer
        invitations_sent_today:
          type: integer
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    # Common
    StatusResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        message:
          type: string
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    RateLimitError:
      allOf:
        - $ref: common.yaml#/components/schemas/Error
        - type: object
          properties:
            retry_after_seconds:
              type: integer
            limit:
              type: integer
            remaining:
              type: integer
            reset_at:
              type: string
              format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

security:
  - BearerAuth: []
