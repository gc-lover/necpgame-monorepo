openapi: 3.0.3
info:
  title: Progression Service API
  description: API для системы прогрессии персонажей в NECPGAME
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8083/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

security:
  - BearerAuth: []

tags:
  - name: Progression
    description: Управление прогрессией персонажей
  - name: Experience
    description: Начисление и расчет опыта
  - name: Skills
    description: Управление навыками и умениями
  - name: Attributes
    description: Управление атрибутами персонажа
  - name: Levels
    description: Управление уровнями и повышением
paths:
  # Получение информации о прогрессии персонажа
  /gameplay/progression/characters/{characterId}:
    get:
      tags:
        - Progression
      summary: Получить информацию о прогрессии персонажа
      operationId: progressionGetCharacterProgression
      parameters:
        - name: characterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Информация о прогрессии
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CharacterProgressionResponse"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Начисление опыта персонажу
  /gameplay/progression/characters/{characterId}/experience:
    post:
      tags:
        - Experience
      summary: Начислить опыт персонажу
      operationId: progressionGrantExperience
      parameters:
        - name: characterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GrantExperienceRequest"
      responses:
        "200":
          description: Опыт начислен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExperienceGrantedResponse"
        "400":
          $ref: "../main.yaml#/components/responses/BadRequest"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Повышение уровня персонажа
  /gameplay/progression/characters/{characterId}/level-up:
    post:
      tags:
        - Levels
      summary: Повысить уровень персонажа
      operationId: progressionLevelUpCharacter
      parameters:
        - name: characterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Уровень повышен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LevelUpResponse"
        "400":
          description: Недостаточно опыта для повышения уровня
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "409":
          description: Персонаж уже максимального уровня
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Распределение очков атрибутов
  /gameplay/progression/characters/{characterId}/attributes:
    post:
      tags:
        - Attributes
      summary: Распределить очки атрибутов
      operationId: progressionAllocateAttributePoints
      parameters:
        - name: characterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AllocateAttributesRequest"
      responses:
        "200":
          description: Атрибуты распределены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AttributesAllocatedResponse"
        "400":
          $ref: "../main.yaml#/components/responses/BadRequest"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "409":
          description: Недостаточно очков атрибутов
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Повышение навыка
  /gameplay/progression/characters/{characterId}/skills/{skillId}:
    post:
      tags:
        - Skills
      summary: Повысить уровень навыка
      operationId: progressionUpgradeSkill
      parameters:
        - name: characterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: skillId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpgradeSkillRequest"
      responses:
        "200":
          description: Навык повышен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SkillUpgradedResponse"
        "400":
          $ref: "../main.yaml#/components/responses/BadRequest"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "409":
          description: Недостаточно очков навыков или навык максимального уровня
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Получение списка навыков персонажа
  /gameplay/progression/characters/{characterId}/skills:
    get:
      tags:
        - Skills
      summary: Получить навыки персонажа
      operationId: progressionGetCharacterSkills
      parameters:
        - name: characterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Список навыков
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CharacterSkillsResponse"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Пересчет статов персонажа
  /gameplay/progression/characters/{characterId}/recalculate:
    post:
      tags:
        - Progression
      summary: Пересчитать все статистики персонажа
      operationId: progressionRecalculateCharacterStats
      parameters:
        - name: characterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Статистики пересчитаны
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecalculateStatsResponse"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Получение требований к следующему уровню
  /gameplay/progression/levels/{level}/requirements:
    get:
      tags:
        - Levels
      summary: Получить требования к уровню
      operationId: progressionGetLevelRequirements
      parameters:
        - name: level
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 100
      responses:
        "200":
          description: Требования к уровню
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LevelRequirementsResponse"
        "400":
          $ref: "../main.yaml#/components/responses/BadRequest"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

  # Получение информации о навыке
  /gameplay/progression/skills/{skillId}:
    get:
      tags:
        - Skills
      summary: Получить информацию о навыке
      operationId: progressionGetSkillInfo
      parameters:
        - name: skillId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Информация о навыке
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SkillInfoResponse"
        "404":
          $ref: "../main.yaml#/components/responses/NotFound"
        "500":
          $ref: "../main.yaml#/components/responses/InternalServerError"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Запросы
    GrantExperienceRequest:
      type: object
      required:
        - amount
        - source
      properties:
        amount:
          type: integer
          minimum: 1
          description: Количество опыта для начисления
        source:
          type: string
          enum: [ combat, quest, achievement, daily, event ]
          description: Источник опыта
        sourceId:
          type: string
          description: ID источника (quest_id, enemy_id и т.д.)
        multiplier:
          type: number
          minimum: 0.1
          maximum: 5.0
          default: 1.0
          description: Множитель опыта (бонусы, баффы)

    AllocateAttributesRequest:
      type: object
      required:
        - attributes
      properties:
        attributes:
          type: object
          properties:
            intelligence:
              type: integer
              minimum: 0
              maximum: 10
            reflexes:
              type: integer
              minimum: 0
              maximum: 10
            dexterity:
              type: integer
              minimum: 0
              maximum: 10
            technology:
              type: integer
              minimum: 0
              maximum: 10
            cool:
              type: integer
              minimum: 0
              maximum: 10
            willpower:
              type: integer
              minimum: 0
              maximum: 10
            luck:
              type: integer
              minimum: 0
              maximum: 10
            movement:
              type: integer
              minimum: 0
              maximum: 10
            body:
              type: integer
              minimum: 0
              maximum: 10
            empathy:
              type: integer
              minimum: 0
              maximum: 10

    UpgradeSkillRequest:
      type: object
      required:
        - levels
      properties:
        levels:
          type: integer
          minimum: 1
          maximum: 10
          description: Количество уровней для повышения навыка

    # Response schemas
    CharacterProgressionResponse:
      type: object
      required:
        - character_id
        - level
        - experience
        - experience_to_next
      properties:
        character_id:
          type: string
          format: uuid
          description: ID персонажа
        level:
          type: integer
          format: int32
          description: Текущий уровень персонажа
        experience:
          type: integer
          format: int32
          description: Текущий опыт персонажа
        experience_to_next:
          type: integer
          format: int32
          description: Опыт до следующего уровня
        attributes:
          type: object
          properties:
            intelligence:
              type: integer
              format: int32
            reflexes:
              type: integer
              format: int32
            dexterity:
              type: integer
              format: int32
            technology:
              type: integer
              format: int32
            cool:
              type: integer
              format: int32
            willpower:
              type: integer
              format: int32
            luck:
              type: integer
              format: int32
            movement:
              type: integer
              format: int32
            body:
              type: integer
              format: int32
            empathy:
              type: integer
              format: int32
        skills:
          type: array
          items:
            type: object
            properties:
              skill_id:
                type: string
                format: uuid
              name:
                type: string
              level:
                type: integer
                format: int32
              experience:
                type: integer
                format: int32

    ExperienceGrantedResponse:
      type: object
      required:
        - success
        - experience_granted
        - total_experience
      properties:
        success:
          type: boolean
          description: Успешность операции
        experience_granted:
          type: integer
          format: int32
          description: Начисленный опыт
        total_experience:
          type: integer
          format: int32
          description: Общий опыт персонажа после начисления
        leveled_up:
          type: boolean
          description: Повысился ли уровень персонажа

    LevelUpResponse:
      type: object
      required:
        - success
        - new_level
        - attribute_points_gained
      properties:
        success:
          type: boolean
          description: Успешность повышения уровня
        new_level:
          type: integer
          format: int32
          description: Новый уровень персонажа
        attribute_points_gained:
          type: integer
          format: int32
          description: Полученные очки атрибутов
        skill_points_gained:
          type: integer
          format: int32
          description: Полученные очки навыков

    AttributesAllocatedResponse:
      type: object
      required:
        - success
        - allocated_attributes
      properties:
        success:
          type: boolean
          description: Успешность распределения
        allocated_attributes:
          type: object
          description: Распределенные атрибуты
          properties:
            intelligence:
              type: integer
              format: int32
            reflexes:
              type: integer
              format: int32
            dexterity:
              type: integer
              format: int32
            technology:
              type: integer
              format: int32
            cool:
              type: integer
              format: int32
            willpower:
              type: integer
              format: int32
            luck:
              type: integer
              format: int32
            movement:
              type: integer
              format: int32
            body:
              type: integer
              format: int32
            empathy:
              type: integer
              format: int32

    SkillUpgradedResponse:
      type: object
      required:
        - success
        - skill_id
        - new_level
        - experience_spent
      properties:
        success:
          type: boolean
          description: Успешность повышения навыка
        skill_id:
          type: string
          format: uuid
          description: ID навыка
        new_level:
          type: integer
          format: int32
          description: Новый уровень навыка
        experience_spent:
          type: integer
          format: int32
          description: Потраченный опыт

    CharacterSkillsResponse:
      type: object
      required:
        - character_id
        - skills
      properties:
        character_id:
          type: string
          format: uuid
          description: ID персонажа
        skills:
          type: array
          items:
            type: object
            properties:
              skill_id:
                type: string
                format: uuid
              name:
                type: string
              level:
                type: integer
                format: int32
              experience:
                type: integer
                format: int32
              max_level:
                type: integer
                format: int32

    RecalculateStatsResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: Успешность пересчета
        message:
          type: string
          description: Сообщение о результате
        updated_stats:
          type: object
          description: Пересчитанные статы

    LevelRequirementsResponse:
      type: object
      required:
        - level
        - experience_required
        - total_experience_required
      properties:
        level:
          type: integer
          format: int32
          description: Уровень
        experience_required:
          type: integer
          format: int32
          description: Опыт, необходимый для достижения уровня
        total_experience_required:
          type: integer
          format: int32
          description: Общий опыт, необходимый для достижения уровня
        attribute_points_rewarded:
          type: integer
          format: int32
          description: Очки атрибутов за уровень
        skill_points_rewarded:
          type: integer
          format: int32
          description: Очки навыков за уровень

    SkillInfoResponse:
      type: object
      required:
        - skill_id
        - name
        - description
        - max_level
      properties:
        skill_id:
          type: string
          format: uuid
          description: ID навыка
        name:
          type: string
          description: Название навыка
        description:
          type: string
          description: Описание навыка
        max_level:
          type: integer
          format: int32
          description: Максимальный уровень навыка
        category:
          type: string
          enum: [combat, social, technical, physical]
          description: Категория навыка

    Error:
      type: object
      required:
        - message
        - code
      properties:
        message:
          type: string
          description: Сообщение об ошибке
        code:
          type: integer
          format: int32
          description: Код ошибки
