$ref: '#/components/schemas/ErrorResponse'
TooManyRequests:
  description: Слишком много запросов
  content:
    application/json:
      schema:
        $ref: '#/components/responses/Error'
      headers:
        Retry-After:
          description: Время ожидания в секундах
          schema:
            type: integer
InternalServerError:
  description: Внутренняя ошибка сервера
  content:
    application/json:
      schema:
        $ref: '#/components/schemas/ErrorResponse'

schemas:
  ErrorResponse:
    type: object
    required:
      - error
      - message
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      error: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        description: Код ошибки
        example: "VALIDATION_ERROR"
      message: # string → 16 bytes
        type: string
        description: Описание ошибки
        example: "Invalid quest parameters"
      details: # object → 12 bytes
        type: object
        description: Дополнительные детали ошибки
      code: # integer → 8 bytes (МАЛЕНЬКОЕ)
        type: integer
        format: int32
        description: HTTP код ошибки

  StartQuestRequest:
    type: object
    required:
      - quest_definition_id
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quest_definition_id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        format: uuid
        description: ID определения квеста
      parameters: # object → 12 bytes
        type: object
        description: Параметры запуска квеста

  StartQuestResponse:
    type: object
    required:
      - quest_instance
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quest_instance: # object → 12 bytes (БОЛЬШОЕ)
        $ref: '#/components/schemas/QuestInstance'
      dialogue: # object → 12 bytes
        $ref: '#/components/schemas/DialogueNode'

  QuestInstance:
    type: object
    required:
      - id
      - quest_id
      - player_id
      - state
      - started_at
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        format: uuid
        description: ID инстанса квеста
      quest_id: # string → 16 bytes
        type: string
        format: uuid
        description: ID определения квеста
      player_id: # string → 16 bytes
        type: string
        format: uuid
        description: ID игрока
      state: # string → 16 bytes
        type: string
        enum: [ IN_PROGRESS, COMPLETED, FAILED, CANCELLED, PAUSED ]
        description: Статус квеста
      progress_data: # object → 12 bytes
        $ref: '#/components/schemas/QuestProgressData'
      started_at: # string → 16 bytes
        type: string
        format: date-time
        description: Время начала
      updated_at: # string → 16 bytes
        type: string
        format: date-time
        description: Время последнего обновления
      completed_at: # string → 16 bytes
        type: string
        format: date-time
        description: Время завершения
      current_objective:# integer → 8 bytes (МАЛЕНЬКОЕ)
      type: integer
      minimum: 0
      description: Текущий objective

  QuestProgressData:
    type: object
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      objectives_progress: # object → 12 bytes (БОЛЬШОЕ)
        type: object
        description: Прогресс по objectives
        additionalProperties:
          type: integer
      variables: # object → 12 bytes
        type: object
        description: Переменные состояния квеста
        additionalProperties: true
      dialogue_state: # object → 12 bytes
        type: object
        description: Состояние диалогов

  DialogueNode:
    type: object
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      node_id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        description: ID узла диалога
      text: # string → 16 bytes
        type: string
        description: Текст диалога
      speaker: # string → 16 bytes
        type: string
        description: Говорящий
      options: # array → 24 bytes
        type: array
        items:
          $ref: '#/components/schemas/DialogueOption'
      conditions: # array → 24 bytes
        type: array
        items:
          type: string
          description: Условия отображения

  DialogueOption:
    type: object
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      option_id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        description: ID опции
      text: # string → 16 bytes
        type: string
        description: Текст опции
      next_node: # string → 16 bytes
        type: string
        description: Следующий узел
      conditions: # array → 24 bytes
        type: array
        items:
          type: string
      actions: # array → 24 bytes
        type: array
        items:
          type: string

  GetPlayerQuestsResponse:
    type: object
    required:
      - quests
      - total
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quests: # array → 24 bytes (БОЛЬШОЕ)
        type: array
        items:
          $ref: '#/components/schemas/QuestInstance'
      total: # integer → 8 bytes (МАЛЕНЬКОЕ)
        type: integer
        minimum: 0
        description: Общее количество
      page: # integer → 8 bytes
        type: integer
        minimum: 1
        description: Текущая страница
      limit: # integer → 8 bytes
        type: integer
        minimum: 1
        maximum: 100
        description: Элементов на странице

  GetQuestResponse:
    type: object
    required:
      - quest_instance
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quest_instance: # object → 12 bytes (БОЛЬШОЕ)
        $ref: '#/components/schemas/QuestInstance'
      available_actions:# array → 24 bytes
      type: array
      items:
        $ref: '#/components/schemas/QuestAction'

  QuestAction:
    type: object
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      action_id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        description: ID действия
      action_type: # string → 16 bytes
        type: string
        enum: [ COMPLETE_OBJECTIVE, CHOOSE_OPTION, INTERACT ]
        description: Тип действия
      description: # string → 16 bytes
        type: string
        description: Описание действия
      parameters: # object → 12 bytes
        type: object
        description: Параметры действия
      conditions: # array → 24 bytes
        type: array
        items:
          type: string
          description: Условия доступности

  UpdateQuestProgressRequest:
    type: object
    required:
      - action_type
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      action_type: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        enum: [ COMPLETE_OBJECTIVE, CHOOSE_DIALOGUE_OPTION, INTERACT_WITH_NPC, VISIT_LOCATION ]
        description: Тип действия
      parameters: # object → 12 bytes
        type: object
        description: Параметры действия
      player_id: # string → 16 bytes
        type: string
        format: uuid
        description: ID игрока (для валидации)

  UpdateQuestProgressResponse:
    type: object
    required:
      - quest_instance
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quest_instance: # object → 12 bytes (БОЛЬШОЕ)
        $ref: '#/components/schemas/QuestInstance'
      new_dialogue: # object → 12 bytes
        $ref: '#/components/schemas/DialogueNode'
      rewards: # array → 24 bytes
        type: array
        items:
          $ref: '#/components/schemas/QuestReward'
      completed: # boolean → 1 byte (МАЛЕНЬКОЕ)
        type: boolean
        description: Квест завершен

  QuestReward:
    type: object
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      reward_type: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        enum: [ EXPERIENCE, CURRENCY, ITEM, TITLE, ACHIEVEMENT ]
        description: Тип награды
      reward_id: # string → 16 bytes
        type: string
        description: ID награды
      amount: # integer → 8 bytes (МАЛЕНЬКОЕ)
        type: integer
        minimum: 1
        description: Количество

  CompleteQuestRequest:
    type: object
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      player_id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        format: uuid
        description: ID игрока (для валидации)

  CompleteQuestResponse:
    type: object
    required:
      - quest_instance
      - rewards
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quest_instance: # object → 12 bytes (БОЛЬШОЕ)
        $ref: '#/components/schemas/QuestInstance'
      rewards: # array → 24 bytes
        type: array
        items:
          $ref: '#/components/schemas/QuestReward'
      experience_gained:# integer → 8 bytes (МАЛЕНЬКОЕ)
      type: integer
      minimum: 0
      description: Полученный опыт
      completion_time: # string → 16 bytes
        type: string
        format: date-time
        description: Время завершения

  ImportQuestRequest:
    type: object
    required:
      - yaml_content
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quest_id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        description: ID квеста (опционально, генерируется из YAML)
      yaml_content: # string → 16 bytes
        type: string
        description: YAML определение квеста

  ImportQuestResponse:
    type: object
    required:
      - quest_id
      - message
    # BACKEND NOTE: Struct field alignment optimized (large → small)
    properties:
      quest_id: # string → 16 bytes (БОЛЬШОЕ)
        type: string
        description: ID импортированного квеста
      message: # string → 16 bytes
        type: string
        description: Сообщение о результате
      created: # boolean → 1 byte (МАЛЕНЬКОЕ)
        type: boolean
        description: Создан новый квест
      updated: # boolean → 1 byte
        type: boolean
        description: Обновлен существующий квест
