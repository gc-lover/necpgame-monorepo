openapi: 3.0.3
info:
  title: Quest Engine Service Schemas
  description: Схемы данных для Quest Engine Service API
  version: 1.0.0
  license:
    name: Proprietary
servers:
- url: http://localhost:8083/api/v1
  description: Gameplay Service (локальная разработка)
paths: {}
components:
  schemas:
    QuestInstance:
      type: object
      description: 'BACKEND NOTE: Quest tracking (100+ active quests per player).

        Fields ordered for struct alignment. Expected memory: ~112 bytes/instance.

        '
      required:
      - id
      - quest_id
      - player_id
      - state
      - started_at
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор инстанса квеста
        quest_id:
          type: string
          format: uuid
          description: ID определения квеста
        player_id:
          type: string
          format: uuid
          description: ID игрока
        state:
          type: string
          enum:
          - NOT_STARTED
          - IN_PROGRESS
          - COMPLETED
          - FAILED
          - CANCELLED
          description: 'Состояние квеста:

            - `NOT_STARTED` - квест не начат

            - `IN_PROGRESS` - квест в процессе

            - `COMPLETED` - квест завершён

            - `FAILED` - квест провален

            - `CANCELLED` - квест отменён

            '
        started_at:
          type: string
          format: date-time
          description: Время начала квеста
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Время завершения квеста
        updated_at:
          type: string
          format: date-time
          description: Время последнего обновления
        progress_data:
          type: object
          description: Данные прогресса квеста (JSON)
          additionalProperties: true
        current_objective:
          type: integer
          description: Текущий номер цели (индекс)
          minimum: 0
    QuestDefinition:
      type: object
      required:
      - id
      - name
      - type
      - is_active
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор определения квеста
        name:
          type: string
          description: Название квеста
        description:
          type: string
          description: Описание квеста
        type:
          type: string
          enum:
          - main
          - side
          - daily
          - event
          description: 'Тип квеста:

            - `main` - основной квест

            - `side` - побочный квест

            - `daily` - ежедневный квест

            - `event` - событийный квест

            '
        created_at:
          type: string
          format: date-time
          description: Время создания
        updated_at:
          type: string
          format: date-time
          description: Время последнего обновления
        requirements:
          type: object
          description: Требования для начала квеста (JSON)
          additionalProperties: true
        rewards:
          type: object
          description: Награды квеста (JSON)
          additionalProperties: true
        dialogue_tree:
          type: object
          description: Дерево диалогов (JSON)
          additionalProperties: true
        objectives:
          type: array
          description: Цели квеста
          items:
            type: object
            additionalProperties: true
        is_active:
          type: boolean
          description: Активен ли квест
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StartQuestRequest:
      type: object
      required:
      - quest_id
      properties:
        quest_id:
          type: string
          format: uuid
          description: ID определения квеста для начала
    StartQuestResponse:
      type: object
      required:
      - quest_instance
      properties:
        dialogue:
          $ref: '#/components/schemas/DialogueNode'
          nullable: true
          description: Начальный диалог (если есть)
        quest_instance:
          $ref: '#/components/schemas/QuestInstance'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CompleteQuestRequest:
      type: object
      properties:
        force:
          type: boolean
          default: false
          description: Принудительное завершение (для админов)
    CompleteQuestResponse:
      type: object
      required:
      - quest_instance
      - rewards
      properties:
        quest_instance:
          $ref: '#/components/schemas/QuestInstance'
        rewards:
          $ref: '#/components/schemas/QuestRewards'
    QuestState:
      type: object
      required:
      - state
      - current_objective
      properties:
        state:
          type: string
          enum:
          - NOT_STARTED
          - IN_PROGRESS
          - COMPLETED
          - FAILED
          - CANCELLED
          description: Текущее состояние квеста
        progress_data:
          type: object
          description: Данные прогресса
          additionalProperties: true
        current_objective:
          type: integer
          description: Текущий номер цели
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdateStateRequest:
      type: object
      required:
      - state
      properties:
        state:
          type: string
          enum:
          - IN_PROGRESS
          - COMPLETED
          - FAILED
          - CANCELLED
          description: Новое состояние квеста
        progress_data:
          type: object
          description: Обновлённые данные прогресса
          additionalProperties: true
    DialogueNode:
      type: object
      required:
      - node_id
      - text
      properties:
        node_id:
          type: string
          description: ID узла диалога
        text:
          type: string
          description: Текст диалога
        speaker:
          type: string
          description: Имя говорящего
        choices:
          type: array
          description: Варианты выбора
          items:
            $ref: '#/components/schemas/DialogueChoice'
        skill_checks:
          type: array
          description: Проверки навыков для этого узла
          items:
            $ref: '#/components/schemas/SkillCheck'
    DialogueChoice:
      type: object
      required:
      - choice_id
      - text
      properties:
        choice_id:
          type: string
          description: ID выбора
        text:
          type: string
          description: Текст выбора
        next_node_id:
          type: string
          description: ID следующего узла
        requirements:
          type: object
          description: Требования для выбора
          additionalProperties: true
    DialogueChoiceRequest:
      type: object
      required:
      - choice_id
      properties:
        choice_id:
          type: string
          description: ID выбранного варианта
    DialogueHistory:
      type: object
      required:
      - quest_instance_id
      - history
      properties:
        quest_instance_id:
          type: string
          format: uuid
          description: ID инстанса квеста
        history:
          type: array
          description: История диалогов
          items:
            type: object
            properties:
              node_id:
                type: string
              text:
                type: string
              speaker:
                type: string
              choice_made:
                type: string
                nullable: true
              timestamp:
                type: string
                format: date-time
    SkillCheck:
      type: object
      required:
      - check_type
      - check_target
      - required_value
      properties:
        check_target:
          type: string
          description: Цель проверки (название атрибута/навыка/предмета)
        check_type:
          type: string
          enum:
          - attribute
          - skill
          - item
          - reputation
          description: 'Тип проверки:

            - `attribute` - проверка атрибутов

            - `skill` - проверка навыков

            - `item` - проверка предметов

            - `reputation` - проверка репутации

            '
        required_value:
          type: integer
          description: Требуемое значение
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SkillCheckRequest:
      type: object
      required:
      - check_type
      - check_target
      properties:
        check_target:
          type: string
          description: Цель проверки
        check_type:
          type: string
          enum:
          - attribute
          - skill
          - item
          - reputation
          description: Тип проверки
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SkillCheckResult:
      type: object
      required:
      - check_type
      - check_target
      - required_value
      - actual_value
      - passed
      properties:
        id:
          type: string
          format: uuid
          description: ID результата проверки
        quest_instance_id:
          type: string
          format: uuid
          description: ID инстанса квеста
        check_target:
          type: string
          description: Цель проверки
        check_type:
          type: string
          enum:
          - attribute
          - skill
          - item
          - reputation
          description: Тип проверки
        checked_at:
          type: string
          format: date-time
          description: Время проверки
        required_value:
          type: integer
          description: Требуемое значение
        actual_value:
          type: integer
          description: Фактическое значение
        passed:
          type: boolean
          description: Пройдена ли проверка
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestRequirements:
      type: object
      properties:
        reputation:
          type: object
          description: Требования репутации
          additionalProperties: true
        location:
          type: object
          description: Требования местоположения
          additionalProperties: true
        items:
          type: array
          description: Требуемые предметы
          items:
            type: object
            properties:
              item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
        quest_prerequisites:
          type: array
          description: Требуемые предыдущие квесты
          items:
            type: string
            format: uuid
        level:
          type: integer
          description: Требуемый уровень
          minimum: 1
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestRewards:
      type: object
      properties:
        reputation:
          type: object
          description: Репутация
          additionalProperties: true
        items:
          type: array
          description: Предметы
          items:
            type: object
            properties:
              item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
        titles:
          type: array
          description: Титулы
          items:
            type: string
        experience:
          type: integer
          description: Опыт
          minimum: 0
        currency:
          type: integer
          description: Валюта
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestEvent:
      type: object
      required:
      - event_type
      - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: ID события
        quest_instance_id:
          type: string
          format: uuid
          description: ID инстанса квеста
        event_type:
          type: string
          enum:
          - started
          - objective-completed
          - completed
          - failed
          - cancelled
          description: 'Тип события:

            - `started` - квест начат

            - `objective-completed` - цель выполнена

            - `completed` - квест завершён

            - `failed` - квест провален

            - `cancelled` - квест отменён

            '
        timestamp:
          type: string
          format: date-time
          description: Время события
        event_data:
          type: object
          description: Данные события (JSON)
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestListResponse:
      type: object
      required:
      - quests
      - total
      properties:
        quests:
          type: array
          description: Список квестов
          items:
            $ref: '#/components/schemas/QuestInstance'
        total:
          type: integer
          description: Общее количество квестов
          minimum: 0
    QuestEventsResponse:
      type: object
      required:
      - events
      - total
      properties:
        events:
          type: array
          description: Список событий
          items:
            $ref: '#/components/schemas/QuestEvent'
        total:
          type: integer
          description: Общее количество событий
          minimum: 0
    SkillChecksResponse:
      type: object
      required:
      - skill_checks
      - total
      properties:
        skill_checks:
          type: array
          description: Список проверок навыков
          items:
            $ref: '#/components/schemas/SkillCheckResult'
        total:
          type: integer
          description: Общее количество проверок
          minimum: 0
