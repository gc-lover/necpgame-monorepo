openapi: 3.0.3
info:
  title: Realtime Service - Schemas
  description: Схемы данных для Realtime Service
  version: 1.0.0
components:
  schemas:
    Connection:
      type: object
      properties:
        id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
          nullable: true
        zone_id:
          type: string
          format: uuid
          nullable: true
        instance_id:
          type: string
          format: uuid
          nullable: true
        connection_state:
          type: string
          enum:
          - connected
          - disconnected
          - reconnecting
        last_heartbeat:
          type: string
          format: date-time
        connected_at:
          type: string
          format: date-time
        disconnected_at:
          type: string
          format: date-time
          nullable: true
        cell_x:
          type: integer
          nullable: true
        cell_y:
          type: integer
          nullable: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SubscribeRequest:
      type: object
      required:
      - topic
      properties:
        topic:
          type: string
          enum:
          - zone
          - character
          - world
          - combat
          - chat
          - social
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UnsubscribeRequest:
      type: object
      required:
      - topic
      properties:
        topic:
          type: string
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Zone:
      type: object
      properties:
        id:
          type: string
          format: uuid
        instance_id:
          type: string
          format: uuid
          nullable: true
        name:
          type: string
        zone_type:
          type: string
        status:
          type: string
          enum:
          - active
          - maintenance
          - full
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        min_x:
          type: number
        min_y:
          type: number
        max_x:
          type: number
        max_y:
          type: number
        max_players:
          type: integer
        current_players:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ZonePlayer:
      type: object
      properties:
        character_id:
          type: string
          format: uuid
        character_name:
          type: string
        connected_at:
          type: string
          format: date-time
        position:
          $ref: '#/components/schemas/Position'
        cell_x:
          type: integer
        cell_y:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    JoinZoneRequest:
      type: object
      required:
      - character_id
      properties:
        character_id:
          type: string
          format: uuid
        position:
          $ref: '#/components/schemas/Position'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Position:
      type: object
      properties:
        x:
          type: number
        y:
          type: number
        z:
          type: number
        rotation:
          type: number
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    GameLoopStats:
      type: object
      properties:
        instance_id:
          type: string
          format: uuid
        performance_warnings:
          type: array
          items:
            type: string
        avg_tick_time_ms:
          type: number
        max_tick_time_ms:
          type: number
        tick_rate:
          type: integer
        current_tick:
          type: integer
        players_count:
          type: integer
        zones_count:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdateInterestRequest:
      type: object
      required:
      - character_id
      - position
      properties:
        character_id:
          type: string
          format: uuid
        position:
          $ref: '#/components/schemas/Position'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CharacterState:
      type: object
      properties:
        character_id:
          type: string
          format: uuid
        state:
          type: string
          enum:
          - idle
          - moving
          - combat
        last_updated:
          type: string
          format: date-time
        velocity:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
            z:
              type: number
        position:
          $ref: '#/components/schemas/Position'
        health:
          type: integer
        max_health:
          type: integer
        sync_frequency:
          type: integer
          description: Частота синхронизации в Hz
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SyncStateRequest:
      type: object
      required:
      - position
      properties:
        velocity:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
            z:
              type: number
        input:
          type: object
          additionalProperties: true
        position:
          $ref: '#/components/schemas/Position'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ProtocolStats:
      type: object
      properties:
        instance_id:
          type: string
          format: uuid
        messages_per_second:
          type: number
        bandwidth_used:
          type: number
          description: В байтах в секунду
        bandwidth_saved:
          type: number
          description: В байтах в секунду (благодаря оптимизации)
        compression_ratio:
          type: number
        avg_message_size:
          type: number
        total_messages:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    OptimizeProtocolRequest:
      type: object
      properties:
        instance_id:
          type: string
          format: uuid
        batch_size:
          type: integer
        enable_delta_compression:
          type: boolean
        enable_batching:
          type: boolean
        enable_fec:
          type: boolean
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PerformanceProfile:
      type: object
      properties:
        id:
          type: string
        description:
          type: string
        name:
          type: string
          enum:
          - esports
          - siege
          - extraction
          - open_world
          - raids
          - massive_warfront
          - casual
          - social
        config:
          type: object
          additionalProperties: true
        tick_rate:
          type: integer
          description: Частота обновлений в Hz
        max_latency_ms:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ApplyProfileRequest:
      type: object
      required:
      - instance_id
      properties:
        instance_id:
          type: string
          format: uuid
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    RealtimeEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        zone_id:
          type: string
          format: uuid
          nullable: true
        character_id:
          type: string
          format: uuid
          nullable: true
        event_type:
          type: string
          enum:
          - combat
          - movement
          - chat
          - world
          - social
        created_at:
          type: string
          format: date-time
        event_data:
          type: object
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PublishEventRequest:
      type: object
      required:
      - event_type
      - event_data
      properties:
        zone_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
        event_type:
          type: string
          enum:
          - combat
          - movement
          - chat
          - world
          - social
        event_data:
          type: object
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
