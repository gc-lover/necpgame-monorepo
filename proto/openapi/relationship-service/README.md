# Relationship Service - OpenAPI Specification

## üìã **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

Relationship Service –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏ –º–µ–∂–¥—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –≤ NECPGAME -
enterprise-grade API –¥–ª—è –¥—Ä—É–∂–±—ã, —Ä–æ–º–∞–Ω—Ç–∏–∫–∏, —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–∞, –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–∞ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ –∫–∏–±–µ—Ä–ø–∞–Ω–∫ MMOFPS RPG.
–°–µ—Ä–≤–∏—Å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é, –ø—Ä–∏–≤–∞—Ç–Ω—É—é –∏ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π.

## üéØ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

### **ü§ù Relationship Management (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏)**

- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è**: –î—Ä—É–∂–±–∞, —Ä–æ–º–∞–Ω—Ç–∏–∫–∞, —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–æ, –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ, –±–∏–∑–Ω–µ—Å, –≤—Ä–∞–∂–¥–∞
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å**: –£—Ä–æ–≤–Ω–∏ –æ—Ç -10 –¥–æ +10 —Å —ç–≤–æ–ª—é—Ü–∏–µ–π —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
- **–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –∏ —Ä–∞–∑–≤–∏—Ç–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–π –¥–ª—è –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤

### **üë• Friendship System (–°–∏—Å—Ç–µ–º–∞ –¥—Ä—É–∂–±—ã)**

- **Friend Requests**: –§–æ—Ä–º–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥—Ä—É–∂–±—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- **Friendship Levels**: –£—Ä–æ–≤–Ω–∏ –±–ª–∏–∑–æ—Å—Ç–∏ –æ—Ç 1 –¥–æ 10
- **Social Circles**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥—Ä—É–∑–µ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **Activity Tracking**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### **‚ù§Ô∏è Romance System (–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞)**

- **Romantic Proposals**: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–≤–∏–¥–∞–Ω–∏–π, –æ—Ç–Ω–æ—à–µ–Ω–∏–π, –ø–æ–º–æ–ª–≤–æ–∫
- **Relationship Status**: –°—Ç–∞—Ç—É—Å—ã –æ—Ç dating –¥–æ married
- **Privacy Controls**: –£—Ä–æ–≤–Ω–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- **Anniversary Tracking**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∞–∂–Ω—ã—Ö –¥–∞—Ç

### **‚öîÔ∏è Rivalry System (–°–∏—Å—Ç–µ–º–∞ —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–∞)**

- **Rivalry Declaration**: –ü—É–±–ª–∏—á–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–∞
- **Intensity Levels**: –û—Ç minor –¥–æ deadly
- **Conflict Tracking**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- **Resolution Mechanisms**: –ü—É—Ç–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–∞

### **üéì Mentorship System (–°–∏—Å—Ç–µ–º–∞ –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–∞)**

- **Mentorship Contracts**: –§–æ—Ä–º–∞–ª—å–Ω—ã–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è —Å —É—Å–ª–æ–≤–∏—è–º–∏
- **Progress Tracking**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–π –Ω–∞–≤—ã–∫–æ–≤
- **Skill Development**: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞–≤—ã–∫–æ–≤ –æ—Ç –º–µ–Ω—Ç–æ—Ä–∞ –∫ —É—á–µ–Ω–∏–∫—É
- **Payment Integration**: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–∞

### **üèÜ Reputation System (–†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)**

- **Multi-Category Reputation**: –¢–æ—Ä–≥–æ–≤–ª—è, –±–æ–π, —Å–æ—Ü–∏—É–º, –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, —Ä–µ–º–µ—Å–ª–æ
- **Evidence-Based**: –†–µ–ø—É—Ç–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- **Dynamic Scoring**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- **Social Influence**: –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### **üåê Social Network Analysis (–ê–Ω–∞–ª–∏–∑ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏)**

- **Network Mapping**: –ö–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π
- **Influence Calculation**: –†–∞—Å—á–µ—Ç —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è
- **Connection Paths**: –ü–æ–∏—Å–∫ –ø—É—Ç–µ–π —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
- **Network Density**: –ê–Ω–∞–ª–∏–∑ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**

```
relationship-service/
‚îú‚îÄ‚îÄ main.yaml           # –û—Å–Ω–æ–≤–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îú‚îÄ‚îÄ README.md          # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ relationships/     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏
‚îú‚îÄ‚îÄ friendships/       # –î—Ä—É–∂–µ—Å–∫–∏–µ —Å–≤—è–∑–∏
‚îú‚îÄ‚îÄ romance/          # –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è
‚îú‚îÄ‚îÄ rivalries/        # –°–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ mentorship/       # –ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ reputation/       # –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îî‚îÄ‚îÄ social-network/   # –°–æ—Ü–∏–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ
```

## üîó **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**

### **Common Architecture (SOLID/DRY)**

- **common/schemas/social-entities.yaml**: `RelationshipEntity`, `FriendshipEntity`, `ReputationEntity`
- **common/schemas/common.yaml**: `BaseEntity`, `UUID`, `Timestamp`
- **common/responses/**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–∫–∏
- **common/security/**: JWT Bearer authentication

### **External Services**

- **user-profile-service**: –î–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
- **notification-service**: –î–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
- **achievement-service**: –î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏
- **currency-service**: –î–ª—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–∞

## üìä **Performance**

### **Response Times (P99)**

- **Health Check**: <1ms
- **Get Relationships**: <60ms (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
- **Create Relationship**: <80ms (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π)
- **Reputation Query**: <30ms (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
- **Social Network Analysis**: <100ms (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –≥–ª—É–±–∏–Ω—ã)
- **Mentorship Update**: <50ms (—Å –ø—Ä–æ–≥—Ä–µ—Å—Å-—Ç—Ä–µ–∫–∏–Ω–≥–æ–º)

### **Throughput**

- **Relationship Operations**: 8,000+ ops/sec peak
- **Reputation Updates**: 15,000+ updates/sec peak
- **Friendship Queries**: 12,000+ queries/sec peak
- **Social Graph Traversals**: 3,000+ traversals/sec peak

### **Scalability**

- **Graph Database Sharding**: –ü–æ user_id –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π
- **Redis Clustering**: –î–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- **Event-Driven Updates**: Kafka –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **CDN Integration**: –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –æ—Ç–Ω–æ—à–µ–Ω–∏–π

### **Memory Usage**

- **Per User Relationship Cache**: <5KB (–∞–∫—Ç–∏–≤–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è)
- **Reputation Cache**: <2KB per user
- **Social Graph Cache**: <10KB per user network
- **Mentorship Progress**: <1KB per active mentorship

## üöÄ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**

### **–í–∞–ª–∏–¥–∞—Ü–∏—è**

```bash
# Redocly linting
npx @redocly/cli lint main.yaml

# Bundle –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ $ref
npx @redocly/cli bundle main.yaml -o bundled.yaml
```

### **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Go –∫–æ–¥–∞**

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ bundled —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
ogen --target ../../services/relationship-service-go/pkg/api \
     --package api --clean bundled.yaml
```

### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

```bash
# HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
npx @redocly/cli build-docs main.yaml -o docs/index.html

# Swagger UI playground
npx @redocly/cli build-docs main.yaml --template swagger-ui -o docs/playground.html
```

## üîß **Backend Implementation Notes**

### **Database Design**

```sql
-- Relationships table (core social connections)
CREATE TABLE relationships (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    character_id UUID NOT NULL,
    target_id UUID NOT NULL,
    type VARCHAR(20) NOT NULL,
    level INTEGER NOT NULL CHECK (level >= -10 AND level <= 10),
    description TEXT,
    established_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    last_interaction_at TIMESTAMPTZ,
    interaction_count INTEGER NOT NULL DEFAULT 0,
    flags TEXT[] DEFAULT '{}',
    is_active BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE(character_id, target_id, type)
) PARTITION BY HASH (character_id);

-- Friendships table (specialized friendship tracking)
CREATE TABLE friendships (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    friend_id UUID NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    friendship_level INTEGER NOT NULL DEFAULT 1 CHECK (friendship_level >= 1 AND friendship_level <= 10),
    requested_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    accepted_at TIMESTAMPTZ,
    blocked_at TIMESTAMPTZ,
    UNIQUE(user_id, friend_id)
) PARTITION BY HASH (user_id);

-- Reputation table (evidence-based reputation)
CREATE TABLE reputation_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    subject_id UUID NOT NULL,
    target_id UUID NOT NULL,
    category VARCHAR(30) NOT NULL,
    score INTEGER NOT NULL CHECK (score >= -100 AND score <= 100),
    evidence_count INTEGER NOT NULL DEFAULT 1,
    last_updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    is_public BOOLEAN NOT NULL DEFAULT true,
    UNIQUE(subject_id, target_id, category)
) PARTITION BY HASH (subject_id);

-- Mentorship contracts
CREATE TABLE mentorship_contracts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    mentor_id UUID NOT NULL,
    mentee_id UUID NOT NULL,
    contract_terms JSONB NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'active',
    started_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    completed_at TIMESTAMPTZ,
    progress_data JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE(mentor_id, mentee_id, status)
) PARTITION BY HASH (mentor_id);
```

### **Graph Database Integration**

```go
// Social graph using Neo4j or similar
type SocialGraphManager struct {
    driver neo4j.Driver
    redis  *redis.Client
}

func (sgm *SocialGraphManager) GetRelationshipNetwork(userID string, depth int) (*SocialNetwork, error) {
    query := `
        MATCH path = (u:User {id: $userId})-[r:RELATIONSHIP*1..%d]-(connected:User)
        WHERE r.is_active = true
        RETURN path, length(path) as depth
        ORDER BY depth
        LIMIT $limit
    `

    // Execute graph traversal
    result, err := sgm.driver.NewSession().Run(query, map[string]interface{}{
        "userId": userID,
        "depth":  depth,
        "limit":  100,
    })

    // Process results into social network structure
    return sgm.buildSocialNetwork(result)
}
```

### **Reputation Engine**

```go
type ReputationEngine struct {
    redis *redis.Client
    kafka *kafka.Producer
    db    *sql.DB
}

func (re *ReputationEngine) CalculateReputation(userID string) (*ReputationScore, error) {
    // Get all reputation events for user
    events, err := re.getReputationEvents(userID)
    if err != nil {
        return nil, err
    }

    // Calculate category scores
    scores := make(map[string]*ReputationCategory)
    for _, event := range events {
        if scores[event.Category] == nil {
            scores[event.Category] = &ReputationCategory{}
        }
        scores[event.Category].Score += event.Score
        scores[event.Category].EvidenceCount++
    }

    // Calculate overall score with weights
    overallScore := re.calculateOverallScore(scores)

    return &ReputationScore{
        UserID:    userID,
        Overall:   overallScore,
        Categories: scores,
    }, nil
}
```

### **Relationship Evolution System**

```go
type RelationshipEvolver struct {
    redis *redis.Client
    rules map[string]*EvolutionRule
}

type EvolutionRule struct {
    MinInteractions  int
    MaxLevel        int
    DecayRate       float64
    BoostEvents     []string
}

func (re *RelationshipEvolver) EvolveRelationship(rel *Relationship, event string) error {
    rule := re.rules[rel.Type]

    // Apply evolution based on event type
    switch event {
    case "positive_interaction":
        rel.Level = min(rel.Level+1, rule.MaxLevel)
        rel.LastInteractionAt = time.Now()
        rel.InteractionCount++
    case "negative_interaction":
        rel.Level = max(rel.Level-1, -10)
    case "time_decay":
        rel.Level = int(float64(rel.Level) * rule.DecayRate)
    }

    // Auto-terminate if level drops too low
    if rel.Level <= -10 {
        rel.IsActive = false
    }

    return re.saveRelationship(rel)
}
```

### **Privacy & Consent Management**

```go
type PrivacyManager struct {
    redis *redis.Client
    db    *sql.DB
}

func (pm *PrivacyManager) CheckRelationshipVisibility(rel *Relationship, viewerID string) (bool, error) {
    // Check relationship privacy settings
    if rel.Flags.Contains("public") {
        return true, nil
    }

    if rel.Flags.Contains("private") {
        return rel.CharacterID == viewerID || rel.TargetID == viewerID, nil
    }

    if rel.Flags.Contains("friends") {
        return pm.areFriends(rel.CharacterID, viewerID) || pm.areFriends(rel.TargetID, viewerID), nil
    }

    return false, nil
}
```

### **Rate Limiting**

```go
// Relationship creation limits
relationshipCreationLimiter := tollbooster.NewLimiter(50, time.Hour) // 50 relationships per hour

// Friend request limits
friendRequestLimiter := tollbooster.NewLimiter(20, time.Hour) // 20 friend requests per hour

// Reputation event limits
reputationEventLimiter := tollbooster.NewLimiter(100, time.Hour) // 100 reputation events per hour

// Mentorship proposal limits
mentorshipProposalLimiter := tollbooster.NewLimiter(5, time.Day) // 5 proposals per day
```

## üîê **Security Considerations**

### **Relationship Privacy**

- Granular privacy controls for each relationship type
- Consent-based visibility settings
- Social graph access restrictions
- PII protection in relationship data

### **Reputation Integrity**

- Evidence-based reputation changes only
- Fraud detection for artificial reputation inflation
- Audit trails for all reputation modifications
- Dispute resolution mechanisms

### **Consent Management**

- Explicit consent for romantic relationships
- Opt-in/opt-out for social features
- Harassment prevention through relationship blocking
- Safe termination procedures

### **Data Protection**

- Encrypted storage of sensitive relationship data
- GDPR compliance for personal relationship information
- Data minimization principles
- Secure deletion of terminated relationships

## üìà **Monitoring & Observability**

### **Key Metrics**

```prometheus
# Relationship system metrics
relationships_total{type="friendship"} 256000
relationships_active_total 184000
friendship_requests_pending 1250

# Reputation system metrics
reputation_events_total{category="trading"} 45000
reputation_scores_average 127.5
reputation_fraud_attempts_total 23

# Social network metrics
social_connections_average 47.2
social_influence_top_percentile 892.5
social_network_traversals_total 156000

# Mentorship metrics
mentorship_contracts_active 3200
mentorship_completion_rate 0.78
mentorship_skill_improvements_total 125000

# Performance metrics
relationship_query_duration_p95 65
reputation_calculation_duration_p95 35
social_graph_traversal_duration_p95 95
```

### **Distributed Tracing**

```go
// Relationship operation tracing
func createRelationship(ctx context.Context, req CreateRelationshipRequest) (*Relationship, error) {
    span, ctx := tracer.StartSpanFromContext(ctx, "relationship.create")
    defer span.Finish()

    span.SetTag("relationship.type", req.Type)
    span.SetTag("character.id", req.CharacterID)
    span.SetTag("target.id", req.TargetID)
    span.SetTag("operation", "create")

    // Validate privacy and consent
    if err := pm.ValidateRelationshipConsent(ctx, req); err != nil {
        span.SetTag("error", true)
        span.LogFields(log.Error(err))
        return nil, err
    }

    // Implementation with tracing
    rel, err := s.relRepo.Create(ctx, req)
    if err != nil {
        span.SetTag("error", true)
        span.LogFields(log.Error(err))
        return nil, err
    }

    span.SetTag("relationship.id", rel.ID)
    span.SetTag("relationship.level", rel.Level)

    // Notify affected parties
    if err := s.notifyRelationshipCreated(ctx, rel); err != nil {
        span.LogFields(log.Error(err)) // Non-critical error
    }

    return rel, nil
}
```

### **Health Checks**

```yaml
# Relationship service health endpoints
/health:
  status: "healthy"
  relationships_active: 184000
  friendships_pending: 1250
  reputation_events_today: 5600

/health/reputation:
  status: "healthy"
  reputation_calculations_today: 45600
  fraud_detection_active: true
  evidence_validation_rate: 0.99

/health/social-network:
  status: "healthy"
  graph_nodes: 1250000
  graph_edges: 8750000
  traversal_cache_hit_rate: 0.89

/health/mentorship:
  status: "healthy"
  active_contracts: 3200
  completion_rate: 0.78
  average_contract_duration_days: 67
```

## üéØ **API Design Principles**

### **SOLID/DRY Compliance**

- **Single Responsibility**: –ö–∞–∂–¥—ã–π endpoint –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞—Å–ø–µ–∫—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- **Open/Closed**: –õ–µ–≥–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ common inheritance
- **DRY**: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RelationshipEntity –∏ ReputationEntity
- **SOLID Inheritance**: Domain-specific entity extension

### **RESTful Design**

- **Resource-Based URLs**: `/relationships/{relationshipId}/mentorship/{mentorshipId}`
- **HTTP Methods**: GET, POST, PUT, DELETE appropriately
- **Status Codes**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 200, 201, 204, 400, 403, 404, 409
- **Content Negotiation**: JSON responses —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ headers

### **Privacy-First Architecture**

- **Consent-Based**: –í—Å–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è
- **Granular Privacy**: –î–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
- **Data Minimization**: –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è
- **Right to Deletion**: –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –ø–æ –∑–∞–ø—Ä–æ—Å—É

### **Graph-Based Social Features**

- **Relationship Graph**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–ø—Ä–æ—Å—ã —Å–≤—è–∑–µ–π
- **Traversal Optimization**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Real-time Updates**: Event-driven –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
- **Caching Strategy**: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã**

**–ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Relationship Service:**

- **Tech Lead**: @relationship-tech-lead
- **Backend**: @relationship-backend
- **Database**: @relationship-database
- **DevOps**: @relationship-devops

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**

- **SRE Team**: @platform-sre
- **Security**: @platform-security
- **Privacy**: @platform-privacy

**–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞:**

- **Product Manager**: @relationship-product
- **Community Manager**: @relationship-community
- **Psychology**: @relationship-psychology

---

*–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é enterprise-grade –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã NECPGAME —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –≥–ª—É–±–æ–∫–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ
–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É.*
