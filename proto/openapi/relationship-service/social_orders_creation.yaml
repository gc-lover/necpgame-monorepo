# Issue: #140894825
openapi: 3.0.3
info:
  title: Social Orders Creation Service API
  description: |
    Расширенный API для создания заказов с интеграцией репутации в MMOFPS RPG.

    **Основные возможности:**
    - Расширенное создание заказов с валидацией репутации
    - Предварительный расчет стоимости с учетом репутации
    - Рекомендации по оптимизации заказа
    - Автоматический подбор исполнителей по репутации
    - Валидация требований и доступности
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8080/api/v1/social/orders-creation
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1/social/orders-creation
    description: Продакшен сервер

tags:
  - name: Orders-Creation
    description: Расширенное создание заказов

paths:
  /orders/draft:
    post:
      tags:
        - Orders-Creation
      summary: Создание черновика заказа с предварительной валидацией
      description: |
        Создает черновик заказа и проводит предварительную валидацию:
        - Проверяет репутацию клиента
        - Рассчитывает стоимость с учетом репутации
        - Проверяет доступность исполнителей
        - Предоставляет рекомендации по оптимизации
      operationId: createOrderDraft
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOrderDraftRequest"
      responses:
        "200":
          description: Черновик заказа создан
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderDraftResponse"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"

  /orders/validate:
    post:
      tags:
        - Orders-Creation
      summary: Валидация параметров заказа
      description: |
        Проводит комплексную валидацию параметров заказа:
        - Валидация репутационных требований
        - Проверка баланса клиента
        - Оценка реалистичности сроков
        - Проверка доступности ресурсов
      operationId: validateOrderParameters
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ValidateOrderRequest"
      responses:
        "200":
          description: Результат валидации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderValidationResponse"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"

  /orders/optimize:
    post:
      tags:
        - Orders-Creation
      summary: Оптимизация параметров заказа
      description: |
        Предоставляет рекомендации по оптимизации заказа:
        - Оптимальная стоимость для привлечения исполнителей
        - Рекомендуемые сроки выполнения
        - Предложения по требованиям к исполнителям
        - Советы по максимизации успеха
      operationId: optimizeOrderParameters
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OptimizeOrderRequest"
      responses:
        "200":
          description: Рекомендации по оптимизации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderOptimizationResponse"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"

  /orders/contractors/suggest:
    post:
      tags:
        - Orders-Creation
      summary: Подбор рекомендуемых исполнителей
      description: |
        Автоматически подбирает подходящих исполнителей для заказа:
        - По навыкам и специализации
        - По репутации и рейтингу
        - По доступности и локации
        - С учетом предыдущего опыта
      operationId: suggestContractors
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SuggestContractorsRequest"
      responses:
        "200":
          description: Рекомендуемые исполнители
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuggestedContractorsResponse"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"

  /orders/create-with-validation:
    post:
      tags:
        - Orders-Creation
      summary: Создание заказа с полной валидацией и оптимизацией
      description: |
        Создает заказ с автоматической валидацией и оптимизацией:
        - Валидирует все параметры
        - Применяет оптимальные настройки
        - Проверяет баланс и доступность
        - Создает заказ и уведомляет исполнителей
      operationId: createOrderWithValidation
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOrderWithValidationRequest"
      responses:
        "201":
          description: Заказ успешно создан
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderCreatedResponse"
        "400":
          $ref: "../../common-schemas.yaml#/components/responses/BadRequest"
        "401":
          $ref: "../../common-schemas.yaml#/components/responses/Unauthorized"
        "402":
          description: Недостаточно средств
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "insufficient_funds"
                  required_balance:
                    type: integer
                  current_balance:
                    type: integer

components:
  schemas:
    CreateOrderDraftRequest:
      type: object
      description: Запрос на создание черновика заказа
      required:
        - title
        - description
        - order_type
        - reward
        - risk_level
      properties:
        title:
          type: string
          maxLength: 100
        description:
          type: string
          maxLength: 1000
        order_type:
          type: string
          enum: [ combat, hacking, trade, political, intelligence, medical, rescue, transport, diplomatic, social ]
        reward:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/Reward"
        risk_level:
          type: string
          enum: [ low, medium, high, extreme ]
        deadline:
          type: string
          format: date-time
        requirements:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/OrderRequirements"
        target_contractor_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Предпочитаемые исполнители

    OrderDraftResponse:
      type: object
      description: Ответ с черновиком заказа
      properties:
        draft_id:
          type: string
          format: uuid
        order_data:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/CreateOrderRequest"
        validation_results:
          $ref: "#/components/schemas/OrderValidationResponse"
        optimization_suggestions:
          $ref: "#/components/schemas/OrderOptimizationResponse"
        estimated_cost:
          $ref: "../orders/social-orders-reputation-integration-service.yaml#/components/schemas/OrderReputationCost"
        recommended_contractors:
          type: array
          items:
            $ref: "#/components/schemas/ContractorSuggestion"
          maxItems: 5

    ValidateOrderRequest:
      type: object
      description: Запрос на валидацию параметров заказа
      required:
        - order_parameters
      properties:
        order_parameters:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/CreateOrderRequest"
        client_id:
          type: string
          format: uuid
          description: ID клиента (если не из токена)

    OrderValidationResponse:
      type: object
      description: Результат валидации заказа
      properties:
        is_valid:
          type: boolean
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              error_type:
                type: string
                enum: [ required, invalid_format, out_of_range, insufficient_funds, reputation_too_low ]
              message:
                type: string
              suggestion:
                type: string
        warnings:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              warning_type:
                type: string
                enum: [ high_risk, expensive, unrealistic_deadline, low_success_chance ]
              message:
                type: string
              suggestion:
                type: string

    OptimizeOrderRequest:
      type: object
      description: Запрос на оптимизацию параметров заказа
      required:
        - order_parameters
      properties:
        order_parameters:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/CreateOrderRequest"
        optimization_goals:
          type: array
          items:
            type: string
            enum: [ minimize_cost, maximize_success, fastest_completion, best_contractors ]
          default: [ "maximize_success" ]

    OrderOptimizationResponse:
      type: object
      description: Рекомендации по оптимизации заказа
      properties:
        original_parameters:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/CreateOrderRequest"
        optimized_parameters:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/CreateOrderRequest"
        improvements:
          type: array
          items:
            type: object
            properties:
              parameter:
                type: string
              original_value:
                type: string
              optimized_value:
                type: string
              improvement_type:
                type: string
                enum: [ cost_reduction, success_increase, time_reduction, quality_improvement ]
              impact:
                type: string
                description: "Ожидаемый эффект (например: '-15% стоимости', '+20% успеха')"
        expected_outcomes:
          type: object
          properties:
            estimated_success_rate:
              type: number
              minimum: 0
              maximum: 100
            estimated_completion_time:
              type: string
              description: "Ожидаемое время выполнения (например: '2-3 дня')"
            total_cost_savings:
              type: integer
              description: "Экономия в валюте игры"

    SuggestContractorsRequest:
      type: object
      description: Запрос на подбор исполнителей
      required:
        - order_parameters
      properties:
        order_parameters:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/CreateOrderRequest"
        max_suggestions:
          type: integer
          minimum: 1
          maximum: 20
          default: 5
        filter_criteria:
          type: object
          properties:
            min_reputation_score:
              type: number
              minimum: 0
              maximum: 100
            required_skills:
              type: array
              items:
                type: string
            location:
              type: string
            max_hourly_rate:
              type: integer

    SuggestedContractorsResponse:
      type: object
      description: Рекомендуемые исполнители
      properties:
        suggestions:
          type: array
          items:
            $ref: "#/components/schemas/ContractorSuggestion"
        total_available:
          type: integer
          description: Общее количество доступных исполнителей
        search_criteria:
          type: object
          description: Критерии поиска, которые были применены

    ContractorSuggestion:
      type: object
      description: Рекомендация исполнителя
      properties:
        contractor_id:
          type: string
          format: uuid
        character_name:
          type: string
        reputation_score:
          type: number
          minimum: 0
          maximum: 100
        specialization_match:
          type: number
          minimum: 0
          maximum: 100
          description: Процент соответствия специализации
        estimated_success_rate:
          type: number
          minimum: 0
          maximum: 100
        average_completion_time:
          type: string
          description: "Среднее время выполнения (например: '24 часа')"
        hourly_rate:
          type: integer
        availability_status:
          type: string
          enum: [ available, busy, offline ]
        recommendation_reason:
          type: string
          description: Почему этот исполнитель рекомендуется

    CreateOrderWithValidationRequest:
      type: object
      description: Запрос на создание заказа с валидацией
      required:
        - order_parameters
      properties:
        order_parameters:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/CreateOrderRequest"
        apply_optimizations:
          type: boolean
          default: true
          description: Автоматически применить оптимизации
        notify_contractors:
          type: boolean
          default: true
          description: Уведомить рекомендуемых исполнителей

    OrderCreatedResponse:
      type: object
      description: Результат создания заказа
      properties:
        order:
          $ref: "social-player-orders-schemas.yaml#/components/schemas/Order"
        applied_optimizations:
          type: array
          items:
            type: string
            description: Какие оптимизации были применены
        notifications_sent:
          type: integer
          description: Количество отправленных уведомлений исполнителям
        estimated_completion_time:
          type: string
          description: Ожидаемое время выполнения
        success_probability:
          type: number
          minimum: 0
          maximum: 100
          description: Вероятность успешного выполнения (%)

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
