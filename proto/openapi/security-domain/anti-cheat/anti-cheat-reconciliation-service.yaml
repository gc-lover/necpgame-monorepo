openapi: 3.0.3
info:
  title: Anti-Cheat Reconciliation Service API
  description: API для reconciliation состояний клиент-сервер
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8086/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер
tags:
  - name: Reconciliation
    description: Reconciliation клиент-сервер
paths:
  /anti-cheat/reconciliation/compare:
    post:
      tags:
        - Reconciliation
      summary: Сравнение состояний клиент-сервер
      description: 'Сравнивает состояния клиента и сервера для обнаружения расхождений

        и определения необходимости reconciliation.

        '
      operationId: compareStates
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReconciliationCompareRequest'
      responses:
        '200':
          description: Результат сравнения состояний
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReconciliationCompareResponse'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
  /anti-cheat/reconciliation/resolve:
    post:
      tags:
        - Reconciliation
      summary: Разрешение конфликтов состояний
      description: 'Разрешает конфликты состояний между клиентом и сервером,

        применяя коррекции к состоянию клиента.

        '
      operationId: resolveConflicts
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReconciliationResolveRequest'
      responses:
        '200':
          description: Результат разрешения конфликтов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReconciliationResolveResponse'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    ReconciliationCompareRequest:
      type: object
      required:
        - player_id
        - client_state
        - server_state
      properties:
        player_id:
          type: string
          format: uuid
          description: Идентификатор игрока
          example: 550e8400-e29b-41d4-a716-446655440000
        client_state:
          $ref: anti-cheat-common.yaml#/components/schemas/GameState
        server_state:
          $ref: anti-cheat-common.yaml#/components/schemas/GameState
        reconciliation_window:
          type: integer
          minimum: 0
          default: 500
          description: Окно reconciliation в миллисекундах
          example: 500
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ReconciliationCompareResponse:
      type: object
      required:
        - states_match
        - requires_resolution
      properties:
        discrepancies:
          type: array
          items:
            $ref: anti-cheat-common.yaml#/components/schemas/StateDiscrepancy
          description: Список расхождений
        discrepancy_percentage:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Процент расхождения
          example: 15.5
        states_match:
          type: boolean
          description: Совпадают ли состояния
          example: false
        requires_resolution:
          type: boolean
          description: Требуется ли разрешение конфликтов
          example: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ReconciliationResolveRequest:
      type: object
      required:
        - player_id
        - discrepancies
      properties:
        player_id:
          type: string
          format: uuid
          description: Идентификатор игрока
          example: 550e8400-e29b-41d4-a716-446655440000
        discrepancies:
          type: array
          items:
            $ref: anti-cheat-common.yaml#/components/schemas/StateDiscrepancy
          description: Список расхождений для разрешения
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ReconciliationResolveResponse:
      type: object
      required:
        - resolved
      properties:
        corrections:
          type: array
          items:
            $ref: anti-cheat-common.yaml#/components/schemas/StateCorrection
          description: Список примененных коррекций
        resolved:
          type: boolean
          description: Разрешены ли конфликты
          example: true
        violation_logged:
          type: boolean
          description: Залогировано ли нарушение
          example: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
security:
  - BearerAuth: [ ]
