# Issue: #1930
openapi: 3.0.3
info:
  title: Guild Service API
  description: |
    API для управления гильдиями в NECPGAME MMOFPS RPG.

    **Основные возможности:**
    - Создание и управление гильдиями
    - Приглашения и управление членами
    - Ролевая система и разрешения
    - Гильдейские ресурсы и казна
    - Турниры и события гильдий
    - Репутация и ранги гильдий

    **BACKEND NOTE:** Struct field alignment optimized (large → small types).
    All schemas ordered for optimal memory layout in generated Go code.
  version: 1.0.0
  license:
    name: Proprietary
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@guild.necpgame.com
servers:
  - url: http://localhost:8084/api/v1
    description: Guild Service (локальная разработка)
  - url: https://guild.necpgame.com/api/v1
    description: Guild Service (продакшн)
tags:
  - name: Guild Management
    description: Управление гильдиями
  - name: Member Management
    description: Управление членами гильдии
  - name: Role Management
    description: Управление ролями и разрешениями
  - name: Resource Management
    description: Управление ресурсами гильдии
  - name: Tournament Management
    description: Турниры и события
paths:
  /guilds:
    post:
      tags:
        - Guild Management
      summary: Создать новую гильдию
      description: |
        Создает новую гильдию с указанными параметрами.
        Проверяет уникальность названия и доступность создания для игрока.
      operationId: createGuild
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGuildRequest'
      responses:
        '201':
          description: Гильдия успешно создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Конфликт (гильдия с таким названием уже существует)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags:
        - Guild Management
      summary: Получить список гильдий
      description: |
        Возвращает список гильдий с возможностью фильтрации и пагинации.
        Поддерживает поиск по названию, фильтрацию по уровню, региону и т.д.
      operationId: getGuilds
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: search
          in: query
          description: Поиск по названию гильдии
          schema:
            type: string
            maxLength: 100
        - name: min_level
          in: query
          description: Минимальный уровень гильдии
          schema:
            type: integer
            minimum: 1
            maximum: 100
        - name: max_level
          in: query
          description: Максимальный уровень гильдии
          schema:
            type: integer
            minimum: 1
            maximum: 100
        - name: region
          in: query
          description: Регион гильдии
          schema:
            type: string
            enum: [ north_america, europe, asia, south_america, australia ]
      responses:
        '200':
          description: Список гильдий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /guilds/{guild_id}:
    get:
      tags:
        - Guild Management
      summary: Получить информацию о гильдии
      description: |
        Возвращает детальную информацию о гильдии по её ID.
        Включает статистику, членов, ресурсы и текущие события.
      operationId: getGuild
      security:
        - BearerAuth: [ ]
      parameters:
        - name: guild_id
          in: path
          required: true
          description: ID гильдии
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о гильдии
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Guild Management
      summary: Обновить гильдию
      description: |
        Обновляет информацию о гильдии. Требует соответствующих разрешений.
        Проверяет уникальность названия при изменении.
      operationId: updateGuild
      security:
        - BearerAuth: [ ]
      parameters:
        - name: guild_id
          in: path
          required: true
          description: ID гильдии
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGuildRequest'
      responses:
        '200':
          description: Гильдия успешно обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Конфликт (новое название уже используется)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Guild Management
      summary: Распустить гильдию
      description: |
        Распускает гильдию. Доступно только лидеру гильдии.
        Возвращает ресурсы членам согласно правилам роспуска.
      operationId: disbandGuild
      security:
        - BearerAuth: [ ]
      parameters:
        - name: guild_id
          in: path
          required: true
          description: ID гильдии
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Гильдия успешно распущена
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /guilds/{guild_id}/members:
    get:
      tags:
        - Member Management
      summary: Получить список членов гильдии
      description: Возвращает список всех членов гильдии с их ролями и статусом.
      operationId: getGuildMembers
      security:
        - BearerAuth: [ ]
      parameters:
        - name: guild_id
          in: path
          required: true
          description: ID гильдии
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: role
          in: query
          description: Фильтр по роли
          schema:
            type: string
            enum: [ leader, officer, member, recruit ]
        - name: status
          in: query
          description: Фильтр по статусу
          schema:
            type: string
            enum: [ active, inactive, suspended ]
      responses:
        '200':
          description: Список членов гильдии
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildMemberListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Member Management
      summary: Пригласить игрока в гильдию
      description: |
        Отправляет приглашение игроку присоединиться к гильдии.
        Требует соответствующих разрешений для приглашения.
      operationId: inviteMember
      security:
        - BearerAuth: [ ]
      parameters:
        - name: guild_id
          in: path
          required: true
          description: ID гильдии
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteMemberRequest'
      responses:
        '201':
          description: Приглашение отправлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Игрок уже в гильдии или имеет активное приглашение
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /guilds/{guild_id}/members/{player_id}:
    put:
      tags:
        - Member Management
      summary: Обновить роль члена гильдии
      description: |
        Изменяет роль члена гильдии. Требует соответствующих разрешений.
        Лидер может изменять роли всех членов, офицеры - только нижестоящих.
      operationId: updateMemberRole
      security:
        - BearerAuth: [ ]
      parameters:
        - name: guild_id
          in: path
          required: true
          description: ID гильдии
          schema:
            type: string
            format: uuid
        - name: player_id
          in: path
          required: true
          description: ID игрока
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMemberRoleRequest'
      responses:
        '200':
          description: Роль успешно обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuildMemberResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Member Management
      summary: Исключить члена из гильдии
      description: |
        Исключает члена из гильдии. Требует соответствующих разрешений.
        Возвращает ресурсы игроку согласно правилам исключения.
      operationId: kickMember
      security:
        - BearerAuth: [ ]
      responses:
        '204':
          description: Member kicked successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
