openapi: 3.0.3
info:
  title: Guild War Service API
  description: Guild warfare management service
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost:8086/api/v1
security:
  - BearerAuth: [ ]
paths:
  /wars:
    get:
      operationId: listWars
      summary: List wars
      responses:
        '200':
          description: Wars list
  /guilds/{guild_id}/wars:
    parameters:
      - name: guild_id
        in: path
        schema:
          type: string
          format: uuid
    get:
      operationId: getGuildWars
      summary: Get guild wars
      responses:
        '200':
          description: Guild wars
    post:
      operationId: declareWar
      summary: Declare war
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeclareWarRequest'
      responses:
        '201':
          description: War declared
  /wars/{war_id}:
    parameters:
      - name: war_id
        in: path
        schema:
          type: string
          format: uuid
    get:
      operationId: getWar
      summary: Get war details
      responses:
        '200':
          description: War details
  /wars/{war_id}/points:
    parameters:
      - name: war_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      operationId: addWarPoints
      summary: Add war points
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddPointsRequest'
      responses:
        '200':
          description: Points added
  /wars/{war_id}/end:
    parameters:
      - name: war_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      operationId: endWar
      summary: End war
      responses:
        '200':
          description: War ended
  /wars/leaderboard:
    get:
      operationId: getWarLeaderboard
      summary: Get war leaderboard
      responses:
        '200':
          description: Leaderboard
  /wars/ws:
    get:
      operationId: warWebSocket
      summary: War WebSocket
      responses:
        '101':
          description: WebSocket connection
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    DeclareWarRequest:
      type: object
      required:
        - target_guild_id
        - type
      properties:
        target_guild_id:
          type: string
          format: uuid
        type:
          type: string
          enum:
            - territorial
            - ranking
            - resource
            - event
        duration_hours:
          type: integer
          minimum: 24
          maximum: 168
          default: 168
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AddPointsRequest:
      type: object
      required:
        - guild_id
        - points
        - reason
      properties:
        guild_id:
          type: string
          format: uuid
        reason:
          type: string
          enum:
            - kill
            - objective_capture
            - defense
            - bonus
        points:
          type: integer
          minimum: 1
          maximum: 1000
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    War:
      type: object
      properties:
        war_id:
          type: string
          format: uuid
        type:
          type: string
          enum:
            - territorial
            - ranking
            - resource
            - event
        status:
          type: string
          enum:
            - preparing
            - active
            - ended
        created_at:
          type: string
          format: date-time
        attacker_guild:
          $ref: '#/components/schemas/GuildSummary'
        defender_guild:
          $ref: '#/components/schemas/GuildSummary'
        points_attacker:
          type: integer
        points_defender:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    GuildSummary:
      type: object
      required:
        - guild_id
        - name
        - tag
      properties:
        guild_id:
          type: string
          format: uuid
        name:
          type: string
        tag:
          type: string
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
