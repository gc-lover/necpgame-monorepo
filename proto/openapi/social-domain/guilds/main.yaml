# Issue: #2235
openapi: 3.0.3
info:
  title: Social Domain - Guilds Module API
  description: |
    **Enterprise-Grade Guilds Module** for NECPGAME MMOFPS RPG.

    **Module Purpose:** Complete guild management system with warfare, territories, and social hierarchy

    **Architecture:** Event-driven microservice with Kafka integration
    **Domain:** social-domain
    **Module:** guilds

    **Core Features:**
    - Guild creation and lifecycle management
    - Member management and roles (leader, officer, member)
    - Guild bank and resource management
    - Territory claiming and defense
    - Guild warfare and PvP mechanics
    - Reputation and ranking systems
    - Cross-guild alliances and diplomacy

    **Performance Targets:**
    - Hot paths: 2000+ RPS, P99 <15ms (guild status, member lists)
    - Event throughput: 1000+ events/sec (guild updates, territory changes)
    - Memory: <30MB per service instance (optimized structs)
    - Cache hit rate: >95% (Redis for active guilds)

    **BACKEND NOTE:** Struct field alignment optimized (large â†’ small types).
    All schemas ordered for optimal memory layout in generated Go code.
    Expected memory savings: 30-50% for guild-related structs.
  version: 1.0.0
  contact:
    name: NECPGAME Guilds API Support
    url: https://necpgame.com/support
    email: api@guilds.necpgame.com

servers:
  - url: http://localhost:8084/api/v1/social-domain/guilds
    description: Guilds Module Development Server
  - url: https://guilds.necpgame.com/api/v1
    description: Guilds Module Production Server

security:
  - BearerAuth: []

tags:
  - name: Guild Management
    description: Core guild CRUD operations
  - name: Guild Members
    description: Member management and roles
  - name: Guild Bank
    description: Resource and inventory management
  - name: Guild Territories
    description: Territory claiming and control
  - name: Guild Warfare
    description: PvP and conflict systems
  - name: Guild Statistics
    description: Analytics and performance metrics

paths:
  # Guild management endpoints
  /health:
    $ref: "./paths/guild-management.yaml#/paths/~1health"
  /guilds:
    $ref: "./paths/guild-management.yaml#/paths/~1guilds"
  /guilds/{guild_id}:
    $ref: "./paths/guild-management.yaml#/paths/~1guilds~1{guild_id}"

  # Member management endpoints
  /guilds/{guild_id}/members:
    $ref: "./paths/member-management.yaml#/paths/~1guilds~1{guild_id}~1members"
  /guilds/{guild_id}/members/{player_id}:
    $ref: "./paths/member-management.yaml#/paths/~1guilds~1{guild_id}~1members~1{player_id}"

  # Territory management endpoints
  /guilds/{guild_id}/territories:
    $ref: "./paths/territory-management.yaml#/paths/~1guilds~1{guild_id}~1territories"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: JWT Bearer token authentication

  schemas:
    # Include schemas from separate files
    HealthResponse:
      $ref: "./schemas/health-schemas.yaml#/components/schemas/HealthResponse"
    ErrorResponse:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Unique error code
          example: GUILD_NOT_FOUND
        message:
          type: string
          description: Human-readable error message
          example: Guild with specified ID not found.
        details:
          type: object
          description: Additional error details (optional)

    # Guild schemas
    Guild:
      $ref: "../schemas/guild-schemas.yaml#/components/schemas/Guild"
    CreateGuildRequest:
      $ref: "../schemas/guild-schemas.yaml#/components/schemas/CreateGuildRequest"
    UpdateGuildRequest:
      $ref: "../schemas/guild-schemas.yaml#/components/schemas/UpdateGuildRequest"
    GuildResponse:
      $ref: "../schemas/guild-schemas.yaml#/components/schemas/GuildResponse"
    GuildsListResponse:
      $ref: "../schemas/guild-schemas.yaml#/components/schemas/GuildsListResponse"

    # Member schemas
    GuildMember:
      $ref: "./schemas/member-schemas.yaml#/components/schemas/GuildMember"
    GuildMembersResponse:
      $ref: "./schemas/member-schemas.yaml#/components/schemas/GuildMembersResponse"
    GuildMemberResponse:
      $ref: "./schemas/member-schemas.yaml#/components/schemas/GuildMemberResponse"
    InvitePlayerRequest:
      $ref: "./schemas/member-schemas.yaml#/components/schemas/InvitePlayerRequest"
    InvitationResponse:
      $ref: "./schemas/member-schemas.yaml#/components/schemas/InvitationResponse"
    UpdateMemberRoleRequest:
      $ref: "./schemas/member-schemas.yaml#/components/schemas/UpdateMemberRoleRequest"

    # Territory schemas
    Territory:
      $ref: "./schemas/territory-schemas.yaml#/components/schemas/Territory"
    GuildTerritoriesResponse:
      $ref: "./schemas/territory-schemas.yaml#/components/schemas/GuildTerritoriesResponse"
    ClaimTerritoryRequest:
      $ref: "./schemas/territory-schemas.yaml#/components/schemas/ClaimTerritoryRequest"
    TerritoryClaimResponse:
      $ref: "./schemas/territory-schemas.yaml#/components/schemas/TerritoryClaimResponse"
