# Issue: #2237 - Mail System API for Backend
paths:
  /inbox:
    get:
      summary: "Get player's inbox messages"
      description: |
        Retrieve paginated list of mail messages in player's inbox.
        Supports filtering by read status and mail type.
      operationId: getInbox
      tags: ["Mail"]
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: "Number of mails to return"
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: "Pagination offset"
        - name: status
          in: query
          schema:
            type: string
            enum: ["unread", "read", "all"]
            default: "all"
          description: "Filter by mail status"
        - name: type
          in: query
          schema:
            type: string
            enum: ["personal", "system", "guild", "faction", "trade", "reward"]
          description: "Filter by mail type"
      responses:
        '200':
          description: "Inbox retrieved successfully"
          content:
            application/json:
              schema:
                $ref: '../schemas/mail-schemas.yaml#/components/schemas/MailListResponse'
        '400':
          $ref: '../../../common.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /{mailId}/read:
    post:
      summary: "Mark mail as read"
      description: "Mark a specific mail message as read"
      operationId: markMailAsRead
      tags: ["Mail"]
      parameters:
        - name: mailId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Mail message ID"
      responses:
        '200':
          description: "Mail marked as read"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  read_at:
                    type: string
                    format: date-time
                    example: "2025-12-20T10:35:00Z"
        '400':
          $ref: '../../../common.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: '../../../common.yaml#/components/responses/NotFound'
        '500':
          $ref: '../../../common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /{mailId}/claim:
    post:
      summary: "Claim mail attachments"
      description: |
        Claim items and currency from mail attachments.
        For COD mails, payment is processed automatically.
      operationId: claimMailAttachments
      tags: ["Mail"]
      parameters:
        - name: mailId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: "Mail message ID"
      responses:
        '200':
          description: "Attachments claimed successfully"
          content:
            application/json:
              schema:
                $ref: '../schemas/mail-schemas.yaml#/components/schemas/ClaimAttachmentsResponse'
        '400':
          $ref: '../../../common.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common.yaml#/components/responses/Unauthorized'
        '402':
          description: "Payment required for COD mail"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "insufficient_funds"
                  required_amount:
                    type: integer
                    format: int64
                    example: 50000
                  current_balance:
                    type: integer
                    format: int64
                    example: 25000
        '404':
          $ref: '../../../common.yaml#/components/responses/NotFound'
        '409':
          description: "Mail already claimed or expired"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "already_claimed"
        '500':
          $ref: '../../../common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /delete:
    post:
      summary: "Delete mail messages"
      description: "Delete multiple mail messages from inbox"
      operationId: deleteMails
      tags: ["Mail"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/mail-schemas.yaml#/components/schemas/DeleteMailRequest'
      responses:
        '200':
          description: "Mails deleted successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted_count:
                    type: integer
                    description: "Number of mails deleted"
                    example: 3
                  success:
                    type: boolean
                    example: true
        '400':
          $ref: '../../../common.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../../common.yaml#/components/responses/Unauthorized'
        '404':
          description: "Some mails not found"
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "mails_not_found"
                  found_ids:
                    type: array
                    items:
                      type: string
                      format: uuid
                  not_found_ids:
                    type: array
                    items:
                      type: string
                      format: uuid
        '500':
          $ref: '../../../common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []

  /stats:
    get:
      summary: "Get mail statistics"
      description: "Get player's mail statistics and limits"
      operationId: getMailStats
      tags: ["Mail"]
      responses:
        '200':
          description: "Mail statistics retrieved"
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_mails:
                    type: integer
                    description: "Total mails in inbox"
                    example: 25
                  unread_count:
                    type: integer
                    description: "Number of unread mails"
                    example: 5
                  max_mails:
                    type: integer
                    description: "Maximum allowed mails"
                    example: 100
                  can_send_until:
                    type: string
                    format: date-time
                    description: "When player can send next mail (rate limit)"
                    nullable: true
                  storage_used_mb:
                    type: number
                    description: "Mail storage used in MB"
                    example: 2.5
                  storage_limit_mb:
                    type: integer
                    description: "Mail storage limit in MB"
                    example: 50
        '401':
          $ref: '../../../common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../../../common.yaml#/components/responses/InternalServerError'
      security:
        - BearerAuth: []