# Issue: #140946814
openapi: 3.0.3
info:
  title: Social Domain - Enterprise-Grade API
  description: |
    **Enterprise-Grade Social Domain** for NECPGAME MMOFPS RPG.

    **Domain Purpose:** Complete social interaction ecosystem
    **Architecture:** Modular microservices with event-driven communication

    **Core Modules:**
    - **Chat** - Real-time messaging and channels
    - **Guilds** - Guild management and warfare
    - **Parties** - Temporary player groups
    - **Relationships** - NPC and player relationships
    - **Orders** - Player commission system
    - **Mentorship** - Learning and teaching system
    - **Reputation** - Social standing and benefits
    - **Notifications** - Event notifications
    - **Voice Lobby** - Voice chat integration

    **Performance Targets:**
    - Hot paths: 1000+ RPS, P99 <20ms
    - Event throughput: 5000+ events/sec
    - Memory: <50MB per service instance
    - Cache hit rate: >95%
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@social.necpgame.com
servers:
  - url: http://localhost:8084/api/v1
    description: Development server
  - url: https://api.necpgame.com/api/v1
    description: Production server
security:
  - BearerAuth: []
tags:
  - name: Social
    description: Social domain endpoints
paths:
  /api/v1/social-domain/health:
    get:
      summary: social domain domain health check
      operationId: social-domainHealthCheck
      tags:
        - Social domain
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"
          headers:
            Cache-Control:
              schema:
                type: string
                example: max-age=300, s-maxage=600
            ETag:
              schema:
                type: string
                example: '"-api-v1-social-domain-health-v1.0"'
            Content-Encoding:
              schema:
                type: string
                enum:
                  - gzip
                  - deflate
                  - br
  /api/v1/social-domain/health/batch:
    post:
      summary: Batch health check for multiple domains
      operationId: batchHealthCheck
      tags:
        - System
      description:
        "Performance optimization: Check multiple domain health in single
        request"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - domains
              properties:
                domains:
                  type: array
                  items:
                    type: string
                  maxItems: 10
      responses:
        "200":
          description: Batch health results
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/HealthResponse"
                  total_time_ms:
                    type: integer
                    description: Total processing time
  /api/v1/social-domain/health/ws:
    get:
      summary: Real-time health monitoring WebSocket
      operationId: healthWebSocket
      tags:
        - System
      description: Real-time health updates without polling
      responses:
        "101":
          description: WebSocket connection established

  # Guilds module endpoints
  /guilds/{guild_id}:
    $ref: "./guilds/main.yaml#/paths/~1guilds~1{guild_id}"
  /guilds/{guild_id}/members:
    $ref: "./guilds/main.yaml#/paths/~1guilds~1{guild_id}~1members"
  /guilds/{guild_id}/members/{player_id}:
    $ref: "./guilds/main.yaml#/paths/~1guilds~1{guild_id}~1members~1{player_id}"
  /guilds/{guild_id}/territories:
    $ref: "./guilds/main.yaml#/paths/~1guilds~1{guild_id}~1territories"

  # Notifications module endpoints
  /notifications:
    get:
      summary: Get user notifications
      operationId: getNotifications
      responses:
        '200':
          description: List of notifications
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationsListResponse"
  /notifications/{notification_id}:
    parameters:
      - name: notification_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      summary: Get specific notification
      operationId: getNotification
      responses:
        '200':
          description: Notification details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Notification"
  /notifications/{notification_id}/read:
    parameters:
      - name: notification_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      summary: Mark notification as read
      operationId: markNotificationRead
      responses:
        '200':
          description: Notification marked as read
  /notifications/history:
    get:
      summary: Get notification history
      operationId: getNotificationHistory
      responses:
        '200':
          description: Notification history
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationsListResponse"
  /notifications/settings:
    get:
      summary: Get notification settings
      operationId: getNotificationSettings
      responses:
        '200':
          description: Notification settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationSettings"
    put:
      summary: Update notification settings
      operationId: updateNotificationSettings
      responses:
        '200':
          description: Settings updated
  /ws/notifications:
    get:
      summary: WebSocket for real-time notifications
      operationId: websocketNotifications
      responses:
        '101':
          description: WebSocket connection established
  /admin/notifications/stats:
    get:
      summary: Get notification statistics
      operationId: getNotificationStats
      responses:
        '200':
          description: Notification statistics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationStatsResponse"

  # Content Management module endpoints
  /content/quests:
    $ref: "./content-management/quests/main.yaml#/paths/~1"
  /content/quests/{quest_id}:
    $ref: "./content-management/quests/main.yaml#/paths/~1{quest_id}"
  /content/npcs:
    $ref: "./content-management/npcs/main.yaml#/paths/~1"
  /content/npcs/{npc_id}:
    $ref: "./content-management/npcs/main.yaml#/paths/~1{npc_id}"
  /content/dialogues:
    $ref: "./content-management/dialogues/main.yaml#/paths/~1"
  /content/dialogues/{dialogue_id}:
    $ref: "./content-management/dialogues/main.yaml#/paths/~1{dialogue_id}"
  /content/lore:
    $ref: "./content-management/lore/main.yaml#/paths/~1"
  /content/lore/{lore_id}:
    $ref: "./content-management/lore/main.yaml#/paths/~1{lore_id}"

  # Additional module references for future expansion
  # /chat: $ref: './chat/main.yaml'
  # /parties: $ref: './parties/main.yaml'
  # /orders: $ref: './orders/main.yaml'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Include schemas from modules
    # Guilds module schemas
    Guild:
      $ref: "./guilds/main.yaml#/components/schemas/Guild"
    CreateGuildRequest:
      $ref: "./guilds/main.yaml#/components/schemas/CreateGuildRequest"
    UpdateGuildRequest:
      $ref: "./guilds/main.yaml#/components/schemas/UpdateGuildRequest"
    GuildResponse:
      $ref: "./guilds/main.yaml#/components/schemas/GuildResponse"
    GuildsListResponse:
      $ref: "./guilds/main.yaml#/components/schemas/GuildsListResponse"
    GuildMember:
      $ref: "./guilds/main.yaml#/components/schemas/GuildMember"
    GuildMembersResponse:
      $ref: "./guilds/main.yaml#/components/schemas/GuildMembersResponse"
    Territory:
      $ref: "./guilds/main.yaml#/components/schemas/Territory"

    # Notification schemas
    Notification:
      type: object
      required:
        - id
        - type
        - title
        - message
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique notification identifier
        type:
          type: string
          enum: [ achievement, system, social, quest, combat, economy ]
          description: Notification category
        title:
          type: string
          maxLength: 200
          description: Notification title
        message:
          type: string
          maxLength: 1000
        created_at:
          type: string
          format: date-time
        read_at:
          type: string
          format: date-time
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true
    SendNotificationRequest:
      type: object
      required:
        - player_id
        - type
        - title
        - message
      properties:
        player_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [ achievement, system, social, quest, combat, economy ]
        title:
          type: string
          maxLength: 200
        message:
          type: string
          maxLength: 1000
        expires_in:
          type: integer
          description: Expiration time in seconds
    NotificationResponse:
      type: object
      required:
        - success
        - notification_id
      properties:
        success:
          type: boolean
        notification_id:
          type: string
          format: uuid
    NotificationsListResponse:
      type: object
      required:
        - notifications
        - total
      properties:
        notifications:
          type: array
          items:
            $ref: "#/components/schemas/Notification"
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
    NotificationSettings:
      type: object
      properties:
        enabled_types:
          type: array
          items:
            type: string
            enum: [ achievement, system, social, quest, combat, economy ]
        email_enabled:
          type: boolean
        push_enabled:
          type: boolean
    NotificationStatsResponse:
      type: object
      properties:
        total_sent:
          type: integer
        total_read:
          type: integer
        by_type:
          type: object

    # Content Management module schemas
    Quest:
      $ref: "./content-management/quests/main.yaml#/components/schemas/Quest"
    CreateQuestRequest:
      $ref: "./content-management/quests/main.yaml#/components/schemas/CreateQuestRequest"
    UpdateQuestRequest:
      $ref: "./content-management/quests/main.yaml#/components/schemas/UpdateQuestRequest"
    QuestResponse:
      $ref: "./content-management/quests/main.yaml#/components/schemas/QuestResponse"
    QuestsListResponse:
      $ref: "./content-management/quests/main.yaml#/components/schemas/QuestsListResponse"
    QuestReward:
      $ref: "./content-management/quests/main.yaml#/components/schemas/QuestReward"
    QuestObjective:
      $ref: "./content-management/quests/main.yaml#/components/schemas/QuestObjective"

    NPC:
      $ref: "./content-management/npcs/main.yaml#/components/schemas/NPC"
    CreateNPCRequest:
      $ref: "./content-management/npcs/main.yaml#/components/schemas/CreateNPCRequest"
    UpdateNPCRequest:
      $ref: "./content-management/npcs/main.yaml#/components/schemas/UpdateNPCRequest"
    NPCResponse:
      $ref: "./content-management/npcs/main.yaml#/components/schemas/NPCResponse"
    NPCsListResponse:
      $ref: "./content-management/npcs/main.yaml#/components/schemas/NPCsListResponse"

    Dialogue:
      $ref: "./content-management/dialogues/main.yaml#/components/schemas/Dialogue"
    DialogueNode:
      $ref: "./content-management/dialogues/main.yaml#/components/schemas/DialogueNode"
    DialogueResponse:
      $ref: "./content-management/dialogues/main.yaml#/components/schemas/DialogueResponse"
    DialogueCondition:
      $ref: "./content-management/dialogues/main.yaml#/components/schemas/DialogueCondition"
    DialogueAction:
      $ref: "./content-management/dialogues/main.yaml#/components/schemas/DialogueAction"
    CreateDialogueRequest:
      $ref: "./content-management/dialogues/main.yaml#/components/schemas/CreateDialogueRequest"
    DialoguesListResponse:
      $ref: "./content-management/dialogues/main.yaml#/components/schemas/DialoguesListResponse"

    LoreEntry:
      $ref: "./content-management/lore/main.yaml#/components/schemas/LoreEntry"
    CreateLoreRequest:
      $ref: "./content-management/lore/main.yaml#/components/schemas/CreateLoreRequest"
    LoreResponse:
      $ref: "./content-management/lore/main.yaml#/components/schemas/LoreResponse"
    LoreListResponse:
      $ref: "./content-management/lore/main.yaml#/components/schemas/LoreListResponse"

    # Common domain schemas defined here
    HealthResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          maxLength: 255
        status:
          type: string
          example: healthy
          maxLength: 255
        domain:
          type: string
          example: social-domain
          maxLength: 255
    Error:
      type: object
      properties:
        message:
          type: string
          example: Internal server error
          maxLength: 1000
        timestamp:
          type: string
          format: date-time
          maxLength: 255
        code:
          type: integer
          example: 500
          format: int32
          minimum: 100
          maximum: 599
        domain:
          type: string
          example: social-domain
          maxLength: 255
    WebSocketHealthMessage:
      type: object
      required:
        - type
        - message_timestamp
        - health
      properties:
        type:
          type: string
          enum:
            - health_update
            - health_alert
            - service_down
        message_timestamp:
          type: string
          format: date-time
          description: Timestamp of the health message
        health:
          $ref: "#/components/schemas/HealthResponse"
