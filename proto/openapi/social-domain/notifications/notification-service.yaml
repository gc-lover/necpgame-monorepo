openapi: 3.0.3
info:
  title: Notification Service API
  description: 'Real-time notification system for MMOFPS RPG.


    Handles in-game notifications, player communications, achievements, and system alerts.


    **BACKEND NOTE**: WebSocket connections require worker pool. Expected load: 10k concurrent connections.

    Memory per notification: ~256 bytes, cached notifications expire after 24h.


    **PERFORMANCE**: Pagination required for notification history, use Redis for caching.

    Expected throughput: 5k notifications/second during peak hours.


    **SCALING**: Horizontal scaling with event-driven architecture via Event Bus.

    WebSocket connections distributed across multiple service instances.

    '
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.necpgame.com/notifications
    description: Production server
security:
  - BearerAuth: [ ]
tags:
  - name: Notifications
    description: Core notification operations
  - name: History
    description: Notification history and archives
  - name: Settings
    description: User notification preferences
  - name: Real-time
    description: WebSocket and real-time features
  - name: Admin
    description: Administrative notification management
  - name: Stats
    description: Notification analytics and metrics
paths:
  /notifications/send:
    post:
      tags:
        - Notifications
      summary: Send notification to player
      operationId: sendNotification
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendNotificationRequest'
      responses:
        '201':
          description: Notification sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
  /notifications:
    get:
      tags:
        - Notifications
      summary: Get player notifications
      operationId: getNotifications
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - name: status
          in: query
          description: Filter by notification status
          schema:
            type: string
            enum:
              - unread
              - read
              - archived
        - name: type
          in: query
          description: Filter by notification type
          schema:
            type: string
            enum:
              - achievement
              - system
              - social
              - quest
              - combat
              - economy
      responses:
        '200':
          description: List of notifications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationsListResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
  /notifications/{notification_id}:
    parameters:
      - name: notification_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - Notifications
      summary: Get notification details
      operationId: getNotification
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Notification details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /notifications/{notification_id}/read:
    parameters:
      - name: notification_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags:
        - Notifications
      summary: Mark notification as read
      operationId: markAsRead
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Notification marked as read
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /notifications/bulk/read:
    put:
      tags:
        - Notifications
      summary: Mark multiple notifications as read
      operationId: bulkMarkAsRead
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - notification_ids
              properties:
                notification_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  maxItems: 100
      responses:
        '200':
          description: Notifications marked as read
          content:
            application/json:
              schema:
                type: object
                properties:
                  updated_count:
                    type: integer
                    example: 5
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
  /notifications/history:
    get:
      tags:
        - History
      summary: Get notification history with pagination
      operationId: getNotificationHistory
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - name: start_date
          in: query
          description: Start date for history filter (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: end_date
          in: query
          description: End date for history filter (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: type
          in: query
          description: Filter by notification type
          schema:
            type: string
            enum:
              - achievement
              - system
              - social
              - quest
              - combat
              - economy
      responses:
        '200':
          description: Paginated notification history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationHistoryResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
  /notifications/settings:
    get:
      tags:
        - Settings
      summary: Get notification settings
      operationId: getNotificationSettings
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: User notification settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettingsResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
    put:
      tags:
        - Settings
      summary: Update notification settings
      operationId: updateNotificationSettings
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNotificationSettingsRequest'
      responses:
        '200':
          description: Settings updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettingsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
  /ws/notifications:
    get:
      tags:
        - Real-time
      summary: WebSocket connection for real-time notifications
      operationId: websocketNotifications
      security:
        - BearerAuth: [ ]
      description: 'Establishes WebSocket connection for real-time notification delivery.


        **BACKEND NOTE**: Requires sticky sessions or distributed pub/sub for scaling.

        Connection limit: 1 per player, auto-disconnect on duplicate connections.


        **PROTOCOL**:

        - Server sends: `{"type": "notification", "data": {...}}`

        - Server sends: `{"type": "heartbeat", "timestamp": "..."}`

        - Client sends: `{"type": "pong"}` (optional keep-alive)

        '
      responses:
        '101':
          description: WebSocket connection established
        '403':
          $ref: '#/components/responses/Forbidden'
  /admin/notifications/stats:
    get:
      tags:
        - Stats
      summary: Get notification system statistics
      operationId: getNotificationStats
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Notification statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationStatsResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
  /admin/notifications/broadcast:
    post:
      tags:
        - Admin
      summary: Broadcast notification to all players
      operationId: broadcastNotification
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BroadcastNotificationRequest'
      responses:
        '201':
          description: Broadcast initiated
          content:
            application/json:
              schema:
                type: object
                properties:
                  broadcast_id:
                    type: string
                    format: uuid
                  estimated_reach:
                    type: integer
                    example: 50000
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    Limit:
      name: limit
      in: query
      description: Maximum number of items to return (1-100)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
    Offset:
      name: offset
      in: query
      description: Number of items to skip
      schema:
        type: integer
        minimum: 0
        default: 0
  schemas:
    Notification:
      type: object
      required:
        - id
        - type
        - title
        - message
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique notification identifier
        title:
          type: string
          maxLength: 200
          description: Notification title
        message:
          type: string
          maxLength: 1000
        type:
          type: string
          enum:
            - achievement
            - system
            - social
            - quest
            - combat
            - economy
          description: Notification category
        priority:
          type: string
          enum:
            - low
            - normal
            - high
            - urgent
          default: normal
        created_at:
          type: string
          format: date-time
        read_at:
          type: string
          format: date-time
          nullable: true
        data:
          type: object
          description: Additional notification data
        is_read:
          type: boolean
          default: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SendNotificationRequest:
      type: object
      required:
        - recipient_id
        - type
        - title
        - message
      properties:
        recipient_id:
          type: string
          format: uuid
        title:
          type: string
          maxLength: 200
        message:
          type: string
          maxLength: 1000
        type:
          type: string
          enum:
            - achievement
            - system
            - social
            - quest
            - combat
            - economy
        priority:
          type: string
          enum:
            - low
            - normal
            - high
            - urgent
          default: normal
        data:
          type: object
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    NotificationResponse:
      type: object
      properties:
        notification:
          $ref: '#/components/schemas/Notification'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    NotificationsListResponse:
      type: object
      properties:
        notifications:
          type: array
          items:
            $ref: '#/components/schemas/Notification'
        total_count:
          type: integer
          minimum: 0
        limit:
          type: integer
          minimum: 1
          maximum: 100
        offset:
          type: integer
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    NotificationSettings:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        enabled_types:
          type: array
          items:
            type: string
            enum:
              - achievement
              - system
              - social
              - quest
              - combat
              - economy
        enabled_priorities:
          type: array
          items:
            type: string
            enum:
              - low
              - normal
              - high
              - urgent
        email_enabled:
          type: boolean
          default: true
        push_enabled:
          type: boolean
          default: true
        sms_enabled:
          type: boolean
          default: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    NotificationSettingsResponse:
      type: object
      properties:
        settings:
          $ref: '#/components/schemas/NotificationSettings'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdateNotificationSettingsRequest:
      type: object
      properties:
        enabled_types:
          type: array
          items:
            type: string
            enum:
              - achievement
              - system
              - social
              - quest
              - combat
              - economy
        enabled_priorities:
          type: array
          items:
            type: string
            enum:
              - low
              - normal
              - high
              - urgent
        email_enabled:
          type: boolean
        push_enabled:
          type: boolean
        in_game_enabled:
          type: boolean
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    NotificationStatsResponse:
      type: object
      properties:
        notifications_by_type:
          type: object
          additionalProperties:
            type: integer
        notifications_by_priority:
          type: object
          additionalProperties:
            type: integer
        total_notifications:
          type: integer
          minimum: 0
        unread_count:
          type: integer
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    NotificationHistoryResponse:
      type: object
      properties:
        notifications:
          type: array
          items:
            $ref: '#/components/schemas/Notification'
        total_count:
          type: integer
          minimum: 0
        limit:
          type: integer
          minimum: 1
          maximum: 100
        offset:
          type: integer
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Error:
      type: object
      properties:
        message:
          type: string
          example: Access denied
        timestamp:
          type: string
          format: date-time
        code:
          type: integer
          example: 403
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    BroadcastNotificationRequest:
      type: object
      required:
        - title
        - message
        - type
      properties:
        title:
          type: string
          maxLength: 200
        message:
          type: string
          maxLength: 1000
        type:
          type: string
          enum: [ achievement, system, social, quest, combat, economy ]
        priority:
          type: string
          enum: [ low, normal, high, urgent ]
          default: normal
        target_audience:
          type: string
          enum: [ all, active, new_players ]
          default: all
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
  responses:
    BadRequest:
      description: Bad request - invalid input or malformed request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not found - resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    TooManyRequests:
      description: Too many requests - rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
