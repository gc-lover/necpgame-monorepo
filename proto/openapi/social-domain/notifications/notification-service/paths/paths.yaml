# Notification Service Paths
# Issue: #1847

# Отправка уведомлений
/notifications/send:
  post:
    tags: [ Notifications ]
    operationId: sendNotification
    summary: Отправить уведомление игрокам
    description: Отправляет уведомление одному или нескольким игрокам
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../schemas/schemas.yaml#/SendNotificationRequest"
    responses:
      "201":
        description: Уведомление отправлено
        content:
          application/json:
            schema:
              $ref: "../../../common-schemas.yaml#/components/schemas/SuccessResponse"
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"
      "403":
        $ref: "../../../common-schemas.yaml#/components/responses/Forbidden"

# Получение уведомлений
/notifications:
  get:
    tags: [ Notifications ]
    operationId: getActiveNotifications
    summary: Получить активные уведомления
    description: Возвращает список активных непрочитанных уведомлений пользователя
    security:
      - BearerAuth: [ ]
    parameters:
      - $ref: "../../../common-schemas.yaml#/components/parameters/Limit"
      - $ref: "../../../common-schemas.yaml#/components/parameters/Offset"
    responses:
      "200":
        description: Список уведомлений
        content:
          application/json:
            schema:
              $ref: "../schemas/schemas.yaml#/NotificationListResponse"
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"

# Управление конкретным уведомлением
/notifications/{notification_id}:
  parameters:
    - name: notification_id
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: ID уведомления

  get:
    tags: [ Notifications ]
    operationId: getNotificationById
    summary: Получить уведомление по ID
    security:
      - BearerAuth: [ ]
    responses:
      "200":
        description: Уведомление найдено
        content:
          application/json:
            schema:
              $ref: "../schemas/schemas.yaml#/Notification"
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"
      "404":
        $ref: "../../../common-schemas.yaml#/components/responses/NotFound"

  put:
    tags: [ Notifications ]
    operationId: updateNotification
    summary: Обновить уведомление
    description: Обновляет содержимое уведомления (только для отправителя или админа)
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../schemas/schemas.yaml#/UpdateNotificationRequest"
    responses:
      "200":
        description: Уведомление обновлено
        content:
          application/json:
            schema:
              $ref: "../schemas/schemas.yaml#/Notification"
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"
      "403":
        $ref: "../../../common-schemas.yaml#/components/responses/Forbidden"
      "404":
        $ref: "../../../common-schemas.yaml#/components/responses/NotFound"

  delete:
    tags: [ Notifications ]
    operationId: deleteNotification
    summary: Удалить уведомление
    security:
      - BearerAuth: [ ]
    responses:
      "204":
        description: Уведомление удалено
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"
      "403":
        $ref: "../../../common-schemas.yaml#/components/responses/Forbidden"
      "404":
        $ref: "../../../common-schemas.yaml#/components/responses/NotFound"

# Отметка как прочитанное
/notifications/{notification_id}/read:
  post:
    tags: [ Notifications ]
    operationId: markNotificationAsRead
    summary: Отметить уведомление как прочитанное
    security:
      - BearerAuth: [ ]
    parameters:
      - name: notification_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Уведомление отмечено как прочитанное
        content:
          application/json:
            schema:
              $ref: "../../../common-schemas.yaml#/components/schemas/SuccessResponse"
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"
      "404":
        $ref: "../../../common-schemas.yaml#/components/responses/NotFound"

# История уведомлений
/notifications/history:
  get:
    tags: [ History ]
    operationId: getNotificationHistory
    summary: Получить историю уведомлений
    description: Возвращает историю уведомлений с фильтрами и пагинацией
    security:
      - BearerAuth: [ ]
    parameters:
      - name: page
        in: query
        schema:
          type: integer
          minimum: 1
          default: 1
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
      - name: type
        in: query
        schema:
          $ref: "../schemas/schemas.yaml#/NotificationType"
      - name: priority
        in: query
        schema:
          $ref: "../../../common-schemas.yaml#/components/schemas/NotificationPriority"
      - name: read
        in: query
        schema:
          type: boolean
      - name: date_from
        in: query
        schema:
          type: string
          format: date-time
      - name: date_to
        in: query
        schema:
          type: string
          format: date-time
    responses:
      "200":
        description: История уведомлений
        content:
          application/json:
            schema:
              $ref: "../schemas/schemas.yaml#/NotificationListResponse"
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"

# Настройки уведомлений
/notifications/settings:
  get:
    tags: [ Settings ]
    operationId: getNotificationSettings
    summary: Получить настройки уведомлений
    security:
      - BearerAuth: [ ]
    responses:
      "200":
        description: Настройки пользователя
        content:
          application/json:
            schema:
              $ref: "../schemas/schemas.yaml#/NotificationSettings"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"

  put:
    tags: [ Settings ]
    operationId: updateNotificationSettings
    summary: Обновить настройки уведомлений
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../schemas/schemas.yaml#/NotificationSettings"
    responses:
      "200":
        description: Настройки обновлены
        content:
          application/json:
            schema:
              $ref: "../schemas/schemas.yaml#/NotificationSettings"
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"

# WebSocket endpoint (документация)
/ws/notifications:
  get:
    tags: [ Real-time ]
    operationId: websocketNotifications
    summary: WebSocket соединение для уведомлений
    description: |
      WebSocket endpoint для real-time получения уведомлений.

      **Протокол:**
      - Клиент отправляет: `{"type": "subscribe", "player_id": "uuid"}`
      - Сервер отправляет уведомления: `{"type": "notification", "data": {...}, "timestamp": "..."}`
      - Ping/Pong для поддержания соединения

      **BACKEND NOTE:** Использовать worker pool для WebSocket соединений.
      Ожидаемая нагрузка: 10k одновременных соединений.
    security:
      - BearerAuth: [ ]
    responses:
      "101":
        description: WebSocket соединение установлено
      "200":
        description: WebSocket handshake successful
      "400":
        $ref: "../../../common-schemas.yaml#/components/responses/BadRequest"
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"

# Статистика и метрики
/notifications/stats:
  get:
    tags: [ Notifications ]
    operationId: getNotificationStats
    summary: Получить статистику уведомлений
    description: Возвращает статистику по уведомлениям пользователя
    security:
      - BearerAuth: [ ]
    responses:
      "200":
        description: Статистика уведомлений
        content:
          application/json:
            schema:
              type: object
              properties:
                total_sent:
                  type: integer
                  description: Всего отправлено уведомлений
                total_read:
                  type: integer
                  description: Всего прочитано
                unread_count:
                  type: integer
                  description: Непрочитанных сейчас
                by_type:
                  type: object
                  description: Статистика по типам
                  additionalProperties:
                    type: integer
                by_priority:
                  type: object
                  description: Статистика по приоритетам
                  additionalProperties:
                    type: integer
      "401":
        $ref: "../../../common-schemas.yaml#/components/responses/Unauthorized"
