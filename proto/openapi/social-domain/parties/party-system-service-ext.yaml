$ref: ../../common-schemas.yaml#/components/schemas/Error
/social/party/invitations/{invitationId}/decline:
  parameters:
    - name: invitationId
      in: path
      required: true
      schema:
        type: string
        format: uuid
  post:
    tags:
      - Invitations
    summary: Отклонить приглашение
    description: Отклоняет приглашение в группу
    operationId: declineInvitation
    security:
      - BearerAuth: [ ]
    responses:
      '200':
        description: Приглашение отклонено
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StatusResponse'
      '404':
        $ref: ../../common-schemas.yaml#/components/responses/NotFound
/social/party/{partyId}/loot-mode:
  parameters:
    - name: partyId
      in: path
      required: true
      schema:
        type: string
        format: uuid
  get:
    tags:
      - Loot Distribution
    summary: Получить режим распределения лута
    description: Возвращает текущий режим распределения лута группы
    operationId: getLootMode
    security:
      - BearerAuth: [ ]
    responses:
      '200':
        description: Режим распределения лута
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LootModeResponse'
      '403':
        $ref: ../../common-schemas.yaml#/components/responses/Forbidden
  put:
    tags:
      - Loot Distribution
    summary: Изменить режим распределения лута
    description: Изменяет режим распределения лута группы (только лидер)
    operationId: setLootMode
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SetLootModeRequest'
    responses:
      '200':
        description: Режим изменён
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LootModeResponse'
      '403':
        $ref: ../../common-schemas.yaml#/components/responses/Forbidden
/social/party/{partyId}/loot/distribute:
  parameters:
    - name: partyId
      in: path
      required: true
      schema:
        type: string
        format: uuid
  post:
    tags:
      - Loot Distribution
    summary: Распределить лут
    description: Распределяет предметы между участниками группы согласно выбранному режиму
    operationId: distributeLoot
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DistributeLootRequest'
    responses:
      '200':
        description: Лут распределён
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LootDistributionResult'
      '400':
        $ref: ../../common-schemas.yaml#/components/responses/BadRequest
      '403':
        $ref: ../../common-schemas.yaml#/components/responses/Forbidden
/social/party/{partyId}/quests:
  parameters:
    - name: partyId
      in: path
      required: true
      schema:
        type: string
        format: uuid
  get:
    tags:
      - Quest Coordination
    summary: Получить задания группы
    description: Возвращает список активных заданий группы
    operationId: getPartyQuests
    security:
      - BearerAuth: [ ]
    responses:
      '200':
        description: Задания группы
        content:
          application/json:
            schema:
              type: object
              properties:
                quests:
                  type: array
                  items:
                    $ref: '#/components/schemas/PartyQuest'
      '403':
        $ref: ../../common-schemas.yaml#/components/responses/Forbidden
/social/party/{partyId}/quests/{questId}/sync:
  parameters:
    - name: partyId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    - name: questId
      in: path
      required: true
      schema:
        type: string
        format: uuid
  post:
    tags:
      - Quest Coordination
    summary: Синхронизировать прогресс задания
    description: Синхронизирует прогресс задания между участниками группы
    operationId: syncQuestProgress
    security:
      - BearerAuth: [ ]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SyncQuestRequest'
    responses:
      '200':
        description: Прогресс синхронизирован
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestSyncResult'
      '403':
        $ref: ../../common-schemas.yaml#/components/responses/Forbidden
/social/party/stats:
  get:
    tags:
      - Monitoring
    summary: Получить статистику групп
    description: Возвращает общую статистику системы групп
    operationId: getPartyStats
    security:
      - BearerAuth: [ ]
    responses:
      '200':
        description: Статистика групп
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PartyStats'
      '403':
        $ref: ../../common-schemas.yaml#/components/responses/Forbidden
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    CreatePartyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 50
          description: Название группы (опционально)
        settings:
          type: object
          description: Дополнительные настройки группы
        loot_mode:
          $ref: '#/components/schemas/LootMode'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdatePartyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 50
        settings:
          type: object
        loot_mode:
          $ref: '#/components/schemas/LootMode'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Party:
      type: object
      properties:
        id:
          type: string
          format: uuid
        leader_id:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        settings:
          type: object
          nullable: true
        loot_mode:
          $ref: '#/components/schemas/LootMode'
        status:
          $ref: '#/components/schemas/PartyStatus'
        members:
          type: array
          items:
            $ref: '#/components/schemas/PartyMember'
        max_members:
          type: integer
          default: 5
        current_members:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PartyStatus:
      type: string
      enum:
        - active
        - disbanded
      description: Статус группы
    PartyMember:
      type: object
      properties:
        account_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
          nullable: true
        joined_at:
          type: string
          format: date-time
        last_active_at:
          type: string
          format: date-time
        role:
          $ref: '#/components/schemas/MemberRole'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    MemberRole:
      type: string
      enum:
        - leader
        - member
      description: Роль участника в группе
    SendInvitationRequest:
      type: object
      required:
        - account_id
      properties:
        account_id:
          type: string
          format: uuid
          description: ID приглашаемого игрока
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PartyInvitation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        party_id:
          type: string
          format: uuid
        inviter_id:
          type: string
          format: uuid
        invitee_id:
          type: string
          format: uuid
        expires_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/InvitationStatus'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    InvitationStatus:
      type: string
      enum:
        - pending
        - accepted
        - declined
        - expired
    AddMemberRequest:
      type: object
      required:
        - account_id
      properties:
        account_id:
          type: string
          format: uuid
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdateRoleRequest:
      type: object
      required:
        - role
      properties:
        role:
          $ref: '#/components/schemas/MemberRole'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    LootMode:
      type: string
      enum:
        - free_for_all
        - need_before_greed
        - master_looter
        - round_robin
      description: Режим распределения лута
    LootModeResponse:
      type: object
      properties:
        set_by:
          type: string
          format: uuid
          description: ID игрока, установившего режим
        set_at:
          type: string
          format: date-time
        loot_mode:
          $ref: '#/components/schemas/LootMode'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SetLootModeRequest:
      type: object
      required:
        - loot_mode
      properties:
        loot_mode:
          $ref: '#/components/schemas/LootMode'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DistributeLootRequest:
      type: object
      required:
        - items
      properties:
        source:
          type: string
          enum:
            - combat
            - quest
            - container
          description: Источник лута
        items:
          type: array
          items:
            $ref: '#/components/schemas/LootItem'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    LootItem:
      type: object
      required:
        - item_id
      properties:
        item_id:
          type: string
          format: uuid
        quality:
          type: string
          enum:
            - common
            - uncommon
            - rare
            - epic
            - legendary
        quantity:
          type: integer
          minimum: 1
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    LootDistributionResult:
      type: object
      properties:
        completed_at:
          type: string
          format: date-time
        mode_used:
          $ref: '#/components/schemas/LootMode'
        distributions:
          type: array
          items:
            $ref: '#/components/schemas/ItemDistribution'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ItemDistribution:
      type: object
      properties:
        item_id:
          type: string
          format: uuid
        distributed_to:
          type: string
          format: uuid
        method:
          type: string
          enum:
            - assigned
            - rolled
            - traded
        quantity:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PartyQuest:
      type: object
      properties:
        quest_id:
          type: string
          format: uuid
        title:
          type: string
        started_at:
          type: string
          format: date-time
        progress:
          type: object
          description: Прогресс выполнения задания
        participants:
          type: array
          items:
            type: string
            format: uuid
          description: Участники, работающие над заданием
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SyncQuestRequest:
      type: object
      required:
        - progress_data
      properties:
        progress_data:
          type: object
          description: Данные прогресса для синхронизации
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestSyncResult:
      type: object
      properties:
        quest_id:
          type: string
          format: uuid
        synced_at:
          type: string
          format: date-time
        synced_progress:
          type: object
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PartyStats:
      type: object
      properties:
        total_parties:
          type: integer
        active_parties:
          type: integer
        disbanded_parties_today:
          type: integer
        loot_distributions_today:
          type: integer
        invitations_sent_today:
          type: integer
        average_party_size:
          type: number
          format: float
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StatusResponse:
      type: object
      properties:
        message:
          type: string
        status:
          type: string
          enum:
            - success
            - error
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    RateLimitError:
      allOf:
        - $ref: ../../common-schemas.yaml#/components/schemas/Error
        - type: object
          properties:
            retry_after_seconds:
              type: integer
            limit:
              type: integer
            remaining:
              type: integer
            reset_at:
              type: string
              format: date-time
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
security:
  - BearerAuth: [ ]
