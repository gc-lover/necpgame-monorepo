# Player Statistics Module
# Issue: #2246

paths:
  /players/{player_id}/stats:
    get:
      summary: Get detailed player combat statistics
      description: '**Enterprise-grade player statistics endpoint**

        Retrieves comprehensive combat statistics for a specific player.

        Includes performance metrics, weapon usage, ability effectiveness, and historical trends.


        **Performance:** <25ms P95 with Redis caching, 95%+ hit rate

        '
      operationId: getPlayerCombatStats
      tags:
        - Player Performance
      parameters:
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Player unique identifier
        - name: period
          in: query
          schema:
            type: string
            enum:
              - hourly
              - daily
              - weekly
              - monthly
              - all_time
            default: daily
          description: Time period for statistics
        - name: include_trends
          in: query
          schema:
            type: boolean
            default: false
          description: Include performance trend analysis
      responses:
        '200':
          description: Player combat statistics retrieved successfully
          headers:
            Cache-Control:
              schema:
                type: string
                example: max-age=300, private
            ETag:
              schema:
                type: string
                example: '"player-stats-uuid-v1"'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerCombatStatsResponse'
        '400':
          description: Invalid request - malformed player ID or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Player not found or no combat data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: Too many requests - rate limit exceeded
          headers:
            Retry-After:
              schema:
                type: integer
                example: 30
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Update player combat statistics
      description: '**Real-time combat statistics update endpoint**

        Updates player statistics after combat session completion.

        Supports batch updates for multiple players and optimized for high throughput.


        **Performance:** <10ms P95, supports 5000+ updates/second

        '
      operationId: updatePlayerCombatStats
      tags:
        - Player Performance
      security:
        - BearerAuth: []
      parameters:
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Player unique identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePlayerStatsRequest'
      responses:
        '200':
          description: Player statistics updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerStatsUpdateResponse'
        '400':
          description: Invalid request - malformed data or player ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Validation failed - statistics data integrity check
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: Too many requests - update rate limit exceeded
          headers:
            Retry-After:
              schema:
                type: integer
                example: 10
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    PlayerCombatStats:
      type: object
      required:
        - player_id
        - total_kills
        - total_deaths
        - total_damage_dealt
        - total_damage_received
        - accuracy_percentage
        - headshot_percentage
        - average_session_duration
        - win_rate
        - favorite_weapon
        - rank
        - updated_at
      properties:
        player_id:
          type: string
          format: uuid
          description: Player unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        total_kills:
          type: integer
          format: int64
          description: Total confirmed kills
          example: 15420
          minimum: 0
        total_deaths:
          type: integer
          format: int64
          description: Total deaths
          example: 12850
          minimum: 0
        total_damage_dealt:
          type: integer
          format: int64
          description: Total damage dealt to enemies
          example: 2850000
          minimum: 0
        total_damage_received:
          type: integer
          format: int64
          description: Total damage received from enemies
          example: 2150000
          minimum: 0
        accuracy_percentage:
          type: number
          format: float
          description: Overall shooting accuracy (0.0-100.0)
          example: 68.5
          minimum: 0.0
          maximum: 100.0
        headshot_percentage:
          type: number
          format: float
          description: Headshot accuracy percentage
          example: 24.3
          minimum: 0.0
          maximum: 100.0
        average_session_duration:
          type: integer
          description: Average combat session duration in seconds
          example: 1250
          minimum: 0
        win_rate:
          type: number
          format: float
          description: Win rate percentage (0.0-100.0)
          example: 54.7
          minimum: 0.0
          maximum: 100.0
        favorite_weapon:
          type: string
          description: Most used weapon name
          example: "Malorian Arms 3516"
          maxLength: 100
        rank:
          type: integer
          description: Current player rank
          example: 1250
          minimum: 0
        updated_at:
          type: string
          format: date-time
          description: Last statistics update timestamp
          example: '2025-12-23T23:54:00Z'
        kd_ratio:
          type: number
          format: float
          description: Kill/Death ratio
          example: 1.20
          minimum: 0.0
        total_sessions:
          type: integer
          format: int32
          description: Total combat sessions played
          example: 1250
          minimum: 0
        total_playtime_hours:
          type: integer
          description: Total playtime in hours
          example: 890
          minimum: 0
        achievements_unlocked:
          type: integer
          description: Number of combat achievements unlocked
          example: 45
          minimum: 0
        current_streak:
          type: integer
          description: Current win/loss streak
          example: 7
        longest_streak:
          type: integer
          description: Longest win streak
          example: 23
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%. Hot path optimization required for real-time updates.'
    PlayerCombatStatsResponse:
      type: object
      required:
        - stats
      properties:
        stats:
          $ref: '#/components/schemas/PlayerCombatStats'
        trends:
          type: object
          description: Performance trend analysis (optional)
          properties:
            kd_ratio_trend:
              type: string
              enum:
                - improving
                - declining
                - stable
              example: improving
            accuracy_trend:
              type: string
              enum:
                - improving
                - declining
                - stable
              example: stable
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdatePlayerStatsRequest:
      type: object
      required:
        - session_stats
      properties:
        session_stats:
          type: object
          required:
            - kills
            - deaths
            - damage_dealt
            - damage_received
            - session_duration
            - weapons_used
          properties:
            kills:
              type: integer
              minimum: 0
              example: 12
            deaths:
              type: integer
              minimum: 0
              example: 8
            damage_dealt:
              type: integer
              minimum: 0
              example: 15400
            damage_received:
              type: integer
              minimum: 0
              example: 12300
            session_duration:
              type: integer
              minimum: 0
              example: 1800
            weapons_used:
              type: array
              items:
                type: object
                required:
                  - weapon_id
                  - shots_fired
                  - hits
                properties:
                  weapon_id:
                    type: string
                    format: uuid
                    example: 550e8400-e29b-41d4-a716-446655440001
                  shots_fired:
                    type: integer
                    minimum: 0
                    example: 450
                  hits:
                    type: integer
                    minimum: 0
                    example: 180
                  headshots:
                    type: integer
                    minimum: 0
                    example: 45
            abilities_used:
              type: array
              items:
                type: object
                required:
                  - ability_id
                  - times_used
                properties:
                  ability_id:
                    type: string
                    format: uuid
                    example: 550e8400-e29b-41d4-a716-446655440002
                  times_used:
                    type: integer
                    minimum: 0
                    example: 8
            session_outcome:
              type: string
              enum:
                - victory
                - defeat
                - draw
              example: victory
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%. Optimized for batch processing.'
    PlayerStatsUpdateResponse:
      type: object
      required:
        - player_id
        - updated_at
        - success
      properties:
        player_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        updated_at:
          type: string
          format: date-time
          example: '2025-12-23T23:54:00Z'
        success:
          type: boolean
          example: true
        new_rank:
          type: integer
          description: Updated player rank after stats update
          example: 1251
        achievements_unlocked:
          type: array
          items:
            type: string
            maxLength: 100
          description: Any new achievements unlocked
          example:
            - "Sharpshooter"
            - "Combo Master"
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
