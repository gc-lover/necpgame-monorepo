# Issue: #158
openapi: 3.0.3
info:
  title: Combat Combos Service API
  description: API for managing combat combos and synergies in the NECPGAME
  version: 1.0.0
  contact:
    name: Backend Team
    email: backend@necp.game

servers:
  - url: http://localhost:8084/api/v1
    description: Development server
  - url: https://api.necp.game/combat/combos/v1
    description: Production server

security:
  - bearerAuth: [ ]

paths:
  /combat/combos/catalog:
    get:
      summary: Get combo catalog
      operationId: getComboCatalog
      description: Retrieve a paginated list of available combos with optional filtering
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [ solo, team, legendary ]
          description: Filter by combo type
        - name: complexity
          in: query
          schema:
            type: string
            enum: [ Bronze, Silver, Gold, Platinum, Legendary ]
          description: Filter by complexity level
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Number of items to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of items to skip
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboCatalogResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /combat/combos/{comboId}:
    get:
      summary: Get combo details
      operationId: getComboDetails
      description: Retrieve detailed information about a specific combo
      parameters:
        - name: comboId
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier of the combo
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboDetailResponse'
        '404':
          description: Combo not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /combat/combos/activate:
    post:
      summary: Activate combo
      operationId: activateCombo
      description: Activate a combo for a character
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivateComboRequest'
      responses:
        '200':
          description: Combo activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivateComboResponse'
        '400':
          description: Bad request or combo requirements not met
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: Service overloaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /combat/combos/loadout:
    get:
      summary: Get combo loadout
      operationId: getComboLoadout
      description: Retrieve the current combo loadout for the authenticated character
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboLoadoutResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Update combo loadout
      operationId: updateComboLoadout
      description: Update the combo loadout for the authenticated character
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComboLoadoutRequest'
      responses:
        '200':
          description: Loadout updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboLoadoutResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /combat/combos/analytics:
    get:
      summary: Get combo analytics
      operationId: getComboAnalytics
      description: Retrieve analytics data for combo usage
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 90
            default: 7
          description: Number of days to look back
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboAnalyticsResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ComboType:
      type: string
      enum: [ solo, team, legendary ]
      description: Type of combo

    ComboComplexity:
      type: string
      enum: [ Bronze, Silver, Gold, Platinum, Legendary ]
      description: Complexity level of the combo

    SynergyType:
      type: string
      enum: [ ability, team, equipment, implant, timing ]
      description: Type of synergy

    Requirements:
      type: object
      properties:
        min_level:
          type: integer
          minimum: 1
          description: Minimum character level required
        required_skills:
          type: array
          items:
            type: string
          description: Required skills
        min_participants:
          type: integer
          minimum: 1
          description: Minimum number of participants
        max_participants:
          type: integer
          minimum: 1
          description: Maximum number of participants

    Bonuses:
      type: object
      properties:
        damage_multiplier:
          type: number
          minimum: 1.0
          description: Damage multiplier applied
        cooldown_reduction:
          type: integer
          minimum: 0
          description: Cooldown reduction in milliseconds
        effect_bonuses:
          type: object
          additionalProperties:
            type: number
          description: Additional effect bonuses
        special_effects:
          type: array
          items:
            type: string
          description: Special effects triggered

    ComboCatalog:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier of the combo
        name:
          type: string
          description: Display name of the combo
        description:
          type: string
          description: Detailed description
        combo_type:
          $ref: '#/components/schemas/ComboType'
        complexity:
          $ref: '#/components/schemas/ComboComplexity'
        requirements:
          $ref: '#/components/schemas/Requirements'
        sequence:
          type: array
          items:
            type: string
          description: Required sequence of actions
        bonuses:
          $ref: '#/components/schemas/Bonuses'
        cooldown:
          type: integer
          minimum: 0
          description: Cooldown in milliseconds
        chain_compatible:
          type: boolean
          description: Whether combo can be chained
        created_at:
          type: string
          format: date-time
          description: Creation timestamp

    ComboSynergy:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier of the synergy
        synergy_type:
          $ref: '#/components/schemas/SynergyType'
        combo_id:
          type: string
          description: Associated combo ID
        ability_ids:
          type: array
          items:
            type: string
          description: Related ability IDs
        equipment_ids:
          type: array
          items:
            type: string
          description: Related equipment IDs
        implant_ids:
          type: array
          items:
            type: string
          description: Related implant IDs
        team_size:
          type: integer
          minimum: 1
          description: Required team size
        timing_window:
          type: integer
          minimum: 0
          description: Timing window in milliseconds
        bonuses:
          $ref: '#/components/schemas/Bonuses'
        requirements:
          $ref: '#/components/schemas/Requirements'

    ComboCatalogResponse:
      type: object
      properties:
        combos:
          type: array
          items:
            $ref: '#/components/schemas/ComboCatalog'
        total:
          type: integer
          minimum: 0
          description: Total number of combos available

    ComboDetailResponse:
      type: object
      properties:
        combo:
          $ref: '#/components/schemas/ComboCatalog'
        synergies:
          type: array
          items:
            $ref: '#/components/schemas/ComboSynergy'

    ActivateComboRequest:
      type: object
      required:
        - combo_id
        - character_id
      properties:
        combo_id:
          type: string
          description: ID of the combo to activate
        character_id:
          type: string
          description: ID of the character activating the combo
        participants:
          type: array
          items:
            type: string
          description: IDs of all participants
        context:
          type: object
          additionalProperties: true
          description: Additional context for activation

    ActivateComboResponse:
      type: object
      properties:
        activation_id:
          type: string
          description: ID of the activation record
        success:
          type: boolean
          description: Whether activation was successful
        score:
          type: integer
          minimum: 0
          description: Score achieved
        bonuses:
          $ref: '#/components/schemas/Bonuses'

    ComboLoadout:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier of the loadout
        character_id:
          type: string
          description: Character this loadout belongs to
        active_combos:
          type: array
          items:
            type: string
          description: IDs of active combos
        preferences:
          type: object
          additionalProperties: true
          description: User preferences
        auto_activate:
          type: boolean
          description: Whether to auto-activate combos
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp

    ComboLoadoutRequest:
      type: object
      properties:
        active_combos:
          type: array
          items:
            type: string
          description: IDs of active combos
        preferences:
          type: object
          additionalProperties: true
          description: User preferences
        auto_activate:
          type: boolean
          description: Whether to auto-activate combos

    ComboLoadoutResponse:
      type: object
      properties:
        loadout:
          $ref: '#/components/schemas/ComboLoadout'

    ComboAnalyticsResponse:
      type: object
      properties:
        total_activations:
          type: integer
          minimum: 0
          description: Total number of activations
        success_rate:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Success rate of activations
        popular_combos:
          type: array
          items:
            $ref: '#/components/schemas/ComboPopularity'
          description: Most popular combos
        scoring_trends:
          type: array
          items:
            $ref: '#/components/schemas/ScoringTrend'
          description: Scoring trends over time

    ComboPopularity:
      type: object
      properties:
        combo_id:
          type: string
          description: Combo identifier
        combo_name:
          type: string
          description: Combo display name
        activations:
          type: integer
          minimum: 0
          description: Number of activations
        average_score:
          type: number
          description: Average score achieved
        total_combos:
          type: integer
          minimum: 0
          description: Total number of combos

    ScoringTrend:
      type: object
      properties:
        date:
          type: string
          format: date
          description: Date of the trend data
        average_score:
          type: number
          description: Average score for the date
        total_combos:
          type: integer
          minimum: 0
          description: Total combos executed

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
      required:
        - error