# Issue: #41
openapi: 3.0.3
info:
  title: Combat Extended Mechanics Service API
  description: |
    API для расширенных механик боевой системы NECPGAME.
    
    **Основные возможности:**
    - Интеграция взлома в бой (hacking combat integration)
    - Управление боевыми имплантами
    - Продвинутая стрельба (advanced shooting)
    - Управление лоадаутами
    - Оркестрация боевых механик
    
    **Компоненты:**
    - Hacking Combat Integration - взлом в бою
    - Implant Combat System - боевые импланты
    - Advanced Shooting System - продвинутая стрельба
    - Loadout Management System - управление лоадаутами
    - Combat Mechanics Orchestrator - оркестратор механик
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8083/api/v1
    description: Gameplay Service (локальная разработка)
  - url: https://api.necp.game/api/v1
    description: Gameplay Service (продакшн)

tags:
  - name: Hacking Combat
    description: Интеграция взлома в бой
  - name: Implant Combat
    description: Боевые импланты
  - name: Advanced Shooting
    description: Продвинутая стрельба
  - name: Loadouts
    description: Управление лоадаутами
  - name: Mechanics Orchestration
    description: Оркестрация боевых механик

paths:
  /gameplay/combat/hacking/execute:
    post:
      tags:
        - Hacking Combat
      summary: Выполнить взлом в бою
      description: |
        Выполняет взлом цели в боевой сессии.
        Интегрирует взлом с боевой системой, применяет эффекты к целям.
      operationId: executeCombatHacking
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatHackingRequest'
      responses:
        '200':
          description: Взлом выполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatHackingResponse'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/hacking/networks:
    get:
      tags:
        - Hacking Combat
      summary: Получить доступные сети для взлома
      description: |
        Возвращает список доступных сетей для взлома в текущей боевой сессии.
      operationId: getCombatHackingNetworks
      security:
        - BearerAuth: [ ]
      parameters:
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор боевой сессии
      responses:
        '200':
          description: Список доступных сетей
          content:
            application/json:
              schema:
                type: object
                properties:
                  networks:
                    type: array
                    items:
                      $ref: '#/components/schemas/CombatHackingNetwork'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/implants/activate:
    post:
      tags:
        - Implant Combat
      summary: Активировать имплант в бою
      description: |
        Активирует имплант в боевой сессии и применяет эффекты.
      operationId: activateCombatImplant
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatImplantActivationRequest'
      responses:
        '200':
          description: Имплант активирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatImplantActivationResponse'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '409':
          description: Имплант недоступен (лимиты, энергия)
          content:
            application/json:
              schema:
                $ref: 'common.yaml#/components/schemas/Error'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/implants/effects:
    get:
      tags:
        - Implant Combat
      summary: Получить эффекты активных имплантов
      description: |
        Возвращает список активных эффектов имплантов в текущей боевой сессии.
      operationId: getCombatImplantEffects
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор боевой сессии
      responses:
        '200':
          description: Список эффектов имплантов
          content:
            application/json:
              schema:
                type: object
                properties:
                  effects:
                    type: array
                    items:
                      $ref: '#/components/schemas/CombatImplantEffect'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/shooting/advanced/aim:
    post:
      tags:
        - Advanced Shooting
      summary: Продвинутое прицеливание
      description: |
        Выполняет продвинутое прицеливание с учетом точности, отдачи и модификаторов.
      operationId: advancedAim
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdvancedAimRequest'
      responses:
        '200':
          description: Прицеливание выполнено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdvancedAimResponse'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/shooting/advanced/recoil:
    post:
      tags:
        - Advanced Shooting
      summary: Управление отдачей
      description: |
        Управляет отдачей оружия с учетом навыков и модификаторов.
      operationId: controlRecoil
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecoilControlRequest'
      responses:
        '200':
          description: Отдача обработана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecoilControlResponse'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/loadouts:
    get:
      tags:
        - Loadouts
      summary: Получить лоадауты
      description: |
        Возвращает список лоадаутов персонажа для боевой системы.
      operationId: getCombatLoadouts
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
        - $ref: 'common.yaml#/components/parameters/Limit'
        - $ref: 'common.yaml#/components/parameters/Offset'
      responses:
        '200':
          description: Список лоадаутов
          content:
            application/json:
              schema:
                type: object
                properties:
                  loadouts:
                    type: array
                    items:
                      $ref: '#/components/schemas/CombatLoadout'
                  total:
                    type: integer
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

    post:
      tags:
        - Loadouts
      summary: Создать или обновить лоадаут
      description: |
        Создает новый лоадаут или обновляет существующий.
        Включает оружие, способности, импланты и оборудование.
      operationId: createOrUpdateCombatLoadout
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatLoadoutCreate'
      responses:
        '200':
          description: Лоадаут обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatLoadout'
        '201':
          description: Лоадаут создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatLoadout'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '409':
          $ref: 'common.yaml#/components/responses/Conflict'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/loadouts/equip:
    post:
      tags:
        - Loadouts
      summary: Экипировать лоадаут
      description: |
        Экипирует лоадаут для персонажа в боевой сессии.
        Активирует все компоненты лоадаута (оружие, способности, импланты).
      operationId: equipCombatLoadout
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatLoadoutEquipRequest'
      responses:
        '200':
          description: Лоадаут экипирован
          content:
            application/json:
              schema:
                $ref: 'common.yaml#/components/schemas/StatusResponse'
        '400':
          $ref: 'common.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

  /gameplay/combat/mechanics/status:
    get:
      tags:
        - Mechanics Orchestration
      summary: Получить статус всех механик
      description: |
        Возвращает статус всех расширенных механик в боевой сессии:
        - Активные импланты и их эффекты
        - Доступные сети для взлома
        - Статус продвинутой стрельбы
        - Активный лоадаут
      operationId: getCombatMechanicsStatus
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор боевой сессии
      responses:
        '200':
          description: Статус всех механик
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatMechanicsStatus'
        '401':
          $ref: 'common.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'common.yaml#/components/responses/NotFound'
        '500':
          $ref: 'common.yaml#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      $ref: 'common.yaml#/components/securitySchemes/BearerAuth'

  schemas:
    CombatHackingRequest:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatHackingRequest'
    CombatHackingResponse:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatHackingResponse'
    CombatHackingNetwork:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatHackingNetwork'
    CombatImplantActivationRequest:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatImplantActivationRequest'
    CombatImplantActivationResponse:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatImplantActivationResponse'
    CombatImplantEffect:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatImplantEffect'
    AdvancedAimRequest:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/AdvancedAimRequest'
    AdvancedAimResponse:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/AdvancedAimResponse'
    RecoilControlRequest:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/RecoilControlRequest'
    RecoilControlResponse:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/RecoilControlResponse'
    CombatLoadout:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatLoadout'
    CombatLoadoutCreate:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatLoadoutCreate'
    CombatLoadoutEquipRequest:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatLoadoutEquipRequest'
    CombatMechanicsStatus:
      $ref: 'combat-extended-mechanics-schemas.yaml#/components/schemas/CombatMechanicsStatus'

security:
  - BearerAuth: [ ]

