openapi: 3.0.3
info:
  title: Combat Sandevistan Service Schemas
  description: Схемы данных для Combat Sandevistan Service API
  version: 1.0.0
components:
  schemas:
    SandevistanActivation:
      type: object
      required:
      - activation_id
      - phase
      - started_at
      - expires_at
      properties:
        activation_id:
          type: string
          format: uuid
          description: Идентификатор активации
          example: 550e8400-e29b-41d4-a716-446655440001
        phase:
          type: string
          enum:
          - preparation
          - active
          - recuperation
          description: Фаза активации
          example: active
        started_at:
          type: string
          format: date-time
          description: Время начала активации
          example: '2025-11-29T10:00:00Z'
        expires_at:
          type: string
          format: date-time
          description: Время окончания активации
          example: '2025-11-29T10:15:00Z'
        bonuses:
          type: object
          description: Бонусы активации
          properties:
            movement_boost:
              type: number
              format: float
              description: Увеличение скорости движения
              example: 1.5
            fire_rate_boost:
              type: number
              format: float
              description: Увеличение скорости стрельбы
              example: 2.0
            dash_distance:
              type: number
              format: float
              description: Дистанция рывка
              example: 10.0
        action_budget_remaining:
          type: integer
          minimum: 0
          maximum: 3
          description: Оставшийся Action Budget
          example: 2
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SandevistanStatus:
      type: object
      required:
      - is_active
      - phase
      - cooldown_remaining
      properties:
        activation_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор текущей активации
        phase:
          type: string
          enum:
          - inactive
          - preparation
          - active
          - recuperation
          description: Текущая фаза
          example: active
        cooldown_remaining:
          type: integer
          minimum: 0
          description: Секунды до следующей активации
          example: 30
        heat_stacks:
          type: integer
          minimum: 0
          maximum: 4
          description: Количество стаков перегрева
          example: 1
        action_budget_remaining:
          type: integer
          minimum: 0
          maximum: 3
          description: Оставшийся Action Budget
          example: 2
        temporal_marks_count:
          type: integer
          minimum: 0
          maximum: 3
          description: Количество активных Temporal Marks
          example: 1
        is_active:
          type: boolean
          description: Активен ли Sandevistan
          example: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Action:
      type: object
      required:
      - type
      properties:
        target_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор цели
        type:
          type: string
          enum:
          - dash
          - shoot
          - melee
          - reload
          description: Тип действия
          example: dash
        target_position:
          type: object
          description: Позиция цели
          properties:
            x:
              type: number
              format: float
            y:
              type: number
              format: float
            z:
              type: number
              format: float
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ActionBudgetResult:
      type: object
      required:
      - executed_actions
      - budget_remaining
      properties:
        executed_actions:
          type: array
          description: Выполненные действия
          items:
            type: object
            properties:
              action_type:
                type: string
                description: Тип действия
              success:
                type: boolean
                description: Успешность выполнения
              timestamp:
                type: string
                format: date-time
                description: Время выполнения
        budget_remaining:
          type: integer
          minimum: 0
          maximum: 3
          description: Оставшийся Action Budget
          example: 1
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TemporalMark:
      type: object
      required:
      - mark_id
      - target_id
      - marked_at
      - expires_at
      properties:
        mark_id:
          type: string
          format: uuid
          description: Идентификатор метки
          example: 550e8400-e29b-41d4-a716-446655440002
        target_id:
          type: string
          format: uuid
          description: Идентификатор цели
          example: 550e8400-e29b-41d4-a716-446655440003
        marked_at:
          type: string
          format: date-time
          description: Время установки метки
          example: '2025-11-29T10:00:00Z'
        expires_at:
          type: string
          format: date-time
          description: Время истечения метки
          example: '2025-11-29T10:15:00Z'
        delayed_burst_damage:
          type: number
          format: float
          description: Отложенный урон взрыва
          example: 100.0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CoolingResult:
      type: object
      required:
      - heat_stacks_removed
      - new_heat_level
      properties:
        heat_stacks_removed:
          type: integer
          minimum: 0
          description: Количество удаленных стаков перегрева
          example: 2
        new_heat_level:
          type: integer
          minimum: 0
          maximum: 4
          description: Новый уровень перегрева
          example: 0
        cooldown_reduced:
          type: integer
          minimum: 0
          description: Секунды снятия с кулдауна
          example: 10
        cyberpsychosis_risk:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Риск киберпсихоза
          example: 0.1
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    HeatStatus:
      type: object
      required:
      - current_stacks
      - max_stacks
      - is_overstress
      properties:
        overstress_penalty:
          type: object
          nullable: true
          description: Штрафы за перегрузку
          properties:
            hp_loss_percent:
              type: number
              format: float
              description: Потеря HP в процентах
            cooldown_multiplier:
              type: number
              format: float
              description: Множитель кулдауна
        current_stacks:
          type: integer
          minimum: 0
          maximum: 4
          description: Текущие стаки перегрева
          example: 2
        max_stacks:
          type: integer
          description: Максимальное количество стаков
          example: 4
        cyberpsychosis_risk:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Риск киберпсихоза
          example: 0.2
        is_overstress:
          type: boolean
          description: Состояние перегрузки
          example: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CounterplayResult:
      type: object
      required:
      - effect_applied
      - sandevistan_interrupted
      properties:
        effect_applied:
          type: string
          enum:
          - chrono_jammer
          - emp
          - dilation_break
          description: Примененный эффект
          example: chrono_jammer
        action_budget_reduced:
          type: integer
          minimum: 0
          description: Уменьшение Action Budget
          example: 1
        sandevistan_interrupted:
          type: boolean
          description: Прерван ли Sandevistan
          example: true
        phase_ended:
          type: boolean
          description: Завершена ли фаза
          example: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TemporalMarksApplied:
      type: object
      required:
      - marks_applied
      - damage_dealt
      - targets_hit
      properties:
        targets_hit:
          type: array
          items:
            type: string
            format: uuid
          description: Список ID целей, которым был нанесён урон
          example:
          - 550e8400-e29b-41d4-a716-446655440002
          - 550e8400-e29b-41d4-a716-446655440003
        marks_applied:
          type: integer
          minimum: 0
          description: Количество применённых temporal marks
          example: 2
        damage_dealt:
          type: integer
          minimum: 0
          description: Общий нанесённый урон
          example: 150
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SandevistanBonuses:
      type: object
      required:
      - is_active
      - phase
      - movement_boost
      - fire_rate_boost
      - dash_distance
      - auto_target_enabled
      properties:
        phase:
          type: string
          enum:
          - idle
          - preparation
          - active
          - recovery
          description: Текущая фаза
          example: active
        movement_boost:
          type: number
          format: float
          description: Множитель скорости движения (1.0 = базовая скорость)
          example: 1.4
        fire_rate_boost:
          type: number
          format: float
          description: Множитель скорости стрельбы (1.0 = базовая скорость)
          example: 1.25
        dash_distance:
          type: number
          format: float
          description: Дистанция auto-target dash в метрах
          example: 15
        is_active:
          type: boolean
          description: Активен ли Sandevistan
          example: true
        auto_target_enabled:
          type: boolean
          description: Включен ли auto-target dash
          example: true
      description: 'BACKEND NOTE: Current Sandevistan gameplay bonuses. Used by combat-service for real-time effect application.'
    PerceptionDragEvent:
      type: object
      required:
      - event_type
      - player_id
      - activation_id
      - phase
      - timestamp
      - affected_players
      - drag_duration_ms
      - drag_intensity
      properties:
        player_id:
          type: string
          format: uuid
          description: ID игрока с Sandevistan
          example: 550e8400-e29b-41d4-a716-446655440000
        activation_id:
          type: string
          format: uuid
          description: ID активации Sandevistan
          example: 550e8400-e29b-41d4-a716-446655440001
        event_type:
          type: string
          enum:
          - sandevistan_activated
          - sandevistan_deactivated
          - phase_changed
          description: Тип события Perception Drag
          example: sandevistan_activated
        phase:
          type: string
          enum:
          - preparation
          - active
          - recovery
          - idle
          description: Фаза Sandevistan
          example: active
        timestamp:
          type: string
          format: date-time
          description: Время события
          example: '2025-11-29T10:00:00Z'
        affected_players:
          type: array
          items:
            type: string
            format: uuid
          description: Список игроков, подверженных Perception Drag
          example:
          - 550e8400-e29b-41d4-a716-446655440002
          - 550e8400-e29b-41d4-a716-446655440003
        drag_duration_ms:
          type: integer
          minimum: 0
          maximum: 5000
          description: Длительность Perception Drag в миллисекундах
          example: 120
        drag_intensity:
          type: number
          format: float
          minimum: 0
          maximum: 1.0
          description: Интенсивность эффекта (0.0 = нет эффекта, 1.0 = максимальный)
          example: 0.8
      description: 'BACKEND NOTE: Event for Perception Drag effects. Published to realtime-service for client-side visual
        effects.'
    TemporalOverdriveRequest:
      type: object
      required:
      - duration_seconds
      - intensity_level
      properties:
        target_enemies:
          type: array
          items:
            type: string
            format: uuid
          maxItems: 5
          description: Список целей для применения Temporal Overdrive (опционально)
        duration_seconds:
          type: integer
          minimum: 5
          maximum: 30
          description: Длительность Temporal Overdrive в секундах
          example: 10
        intensity_level:
          type: integer
          minimum: 1
          maximum: 3
          description: Уровень интенсивности (1=стандартный, 2=усиленный, 3=экстремальный)
          example: 2
        damage_multiplier:
          type: number
          format: float
          minimum: 1.0
          maximum: 3.0
          description: Множитель урона (1.0 = стандартный, 3.0 = максимальный)
          example: 2.5
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TemporalOverdriveActivation:
      type: object
      required:
      - activation_id
      - started_at
      - duration_seconds
      - intensity_level
      - status
      properties:
        activation_id:
          type: string
          format: uuid
          description: Уникальный ID активации Temporal Overdrive
        status:
          type: string
          enum:
          - activating
          - active
          - deactivating
          - completed
          description: Статус активации
        started_at:
          type: string
          format: date-time
          description: Время начала активации
        duration_seconds:
          type: integer
          minimum: 5
          maximum: 30
          description: Общая длительность
        intensity_level:
          type: integer
          minimum: 1
          maximum: 3
          description: Уровень интенсивности
        targets_affected:
          type: integer
          minimum: 0
          description: Количество затронутых целей
        time_remaining_seconds:
          type: integer
          minimum: 0
          description: Оставшееся время в секундах
        damage_multiplier:
          type: number
          format: float
          description: Активный множитель урона
        heat_generation_rate:
          type: number
          format: float
          description: Скорость генерации тепла в секунду
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TemporalOverdriveEvent:
      type: object
      required:
      - event_type
      - player_id
      - timestamp
      properties:
        player_id:
          type: string
          format: uuid
          description: ID игрока
        activation_id:
          type: string
          format: uuid
          description: ID активации
        target_id:
          type: string
          format: uuid
          description: ID цели (если применимо)
        event_type:
          type: string
          enum:
          - activation_started
          - activation_completed
          - target_hit
          - overheat_warning
          - emergency_shutdown
          description: Тип события Temporal Overdrive
        timestamp:
          type: string
          format: date-time
          description: Время события
        damage_dealt:
          type: integer
          minimum: 0
          description: Нанесенный урон (если применимо)
        intensity_level:
          type: integer
          minimum: 1
          maximum: 3
          description: Уровень интенсивности
      description: 'BACKEND NOTE: Event published to realtime-service for client synchronization and UI updates.'
