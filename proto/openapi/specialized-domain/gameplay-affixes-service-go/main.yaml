openapi: 3.0.3
info:
  title: Gameplay Affixes Service API - Enterprise-Grade Dungeon and Raid Affixes Management
  description: '**Enterprise-Grade Domain API for NECPGAME Affixes System**

    This domain manages the affix system for dungeons and raids in the NECPGAME MMOFPS RPG.
    Affixes are modifiers that change gameplay mechanics, making encounters more challenging and rewarding.

    ## Key Features

    - **Weekly Rotations**: Affixes rotate weekly (Monday 00:00 UTC)
    - **Instance Application**: 2-4 random affixes per dungeon/raid instance
    - **Reward/Difficulty Scaling**: Dynamic scaling based on affix combinations
    - **Admin Controls**: Manual rotation triggers for special events
    - **Performance Optimized**: Struct alignment and efficient database queries

    ## Domain Purpose

    The Gameplay Affixes Service manages modifiers that change gameplay mechanics for dungeons and raids.
    This creates replayability and challenge scaling for end-game content.

    ## Performance Targets

    - P99 Latency: <50ms for hot paths
    - Memory: <50KB per player instance
    - Concurrent users: 10,000+ simultaneous connections
    - Data consistency: Event-sourced with CQRS patterns
    '
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com
  license:
    name: Proprietary
    url: https://necpgame.com/license
servers:
  - url: http://localhost:8083/api/v1
    description: Development server
  - url: https://api.necpgame.com/api/v1
    description: Production server
security:
  - BearerAuth: [ ]
tags:
  - name: Affixes
    description: Affix management and operations
  - name: Active
    description: Currently active affixes
  - name: Instances
    description: Instance-specific affix operations
  - name: Rotation
    description: Affix rotation management
  - name: System
    description: System health and monitoring
paths:
  /health:
    get:
      summary: Health check endpoint
      description: Проверка состояния сервиса аффиксов
      tags: [ System ]
      operationId: healthCheck
      security: [ ]
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                    maxLength: 255
                  timestamp:
                    type: string
                    format: date-time
                    maxLength: 255
                  service:
                    type: string
                    example: gameplay-affixes-service
                    maxLength: 255
                description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
        "503":
          $ref: '#/components/responses/ServiceUnavailable'

  /gameplay/affixes/active:
    get:
      summary: Get currently active affixes
      description: Returns the affixes that are currently active for this week's rotation
      tags: [ Active ]
      operationId: getActiveAffixes
      responses:
        "200":
          description: Active affixes retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActiveAffixesResponse'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /gameplay/affixes:
    get:
      summary: List all affixes
      description: Returns a paginated list of all available affixes
      tags: [ Affixes ]
      operationId: listAffixes
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: Affixes list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  affixes:
                    type: array
                    items:
                      $ref: '#/components/schemas/AffixSummary'
                  total:
                    type: integer
                    minimum: 0
                  limit:
                    type: integer
                    minimum: 1
                    maximum: 100
                  offset:
                    type: integer
                    minimum: 0
                description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
        "400":
          $ref: '#/components/responses/BadRequest'
        "500":
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create new affix
      description: Creates a new affix (admin operation)
      tags: [ Affixes ]
      operationId: createAffix
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAffixRequest'
      responses:
        "201":
          description: Affix created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Affix'
        "400":
          $ref: '#/components/responses/BadRequest'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /gameplay/affixes/{id}:
    get:
      summary: Get affix details
      description: Returns detailed information about a specific affix
      tags: [ Affixes ]
      operationId: getAffix
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Affix details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Affix'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/InternalServerError'
    put:
      summary: Update affix
      description: Updates an existing affix (admin operation)
      tags: [ Affixes ]
      operationId: updateAffix
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAffixRequest'
      responses:
        "200":
          description: Affix updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Affix'
        "400":
          $ref: '#/components/responses/BadRequest'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete affix
      description: Deletes an affix (admin operation)
      tags: [ Affixes ]
      operationId: deleteAffix
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Affix deleted successfully
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /gameplay/instances/{instanceId}/affixes:
    get:
      summary: Get instance affixes
      description: Returns the affixes applied to a specific dungeon/raid instance
      tags: [ Instances ]
      operationId: getInstanceAffixes
      parameters:
        - name: instanceId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Instance affixes retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAffixesResponse'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /gameplay/instances/{instanceId}/affixes/generate:
    post:
      summary: Generate affixes for instance
      description: Generates and applies random affixes to a dungeon/raid instance
      tags: [ Instances ]
      operationId: generateInstanceAffixes
      parameters:
        - name: instanceId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "201":
          description: Instance affixes generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAffixesResponse'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /gameplay/affixes/rotation/history:
    get:
      summary: Get affix rotation history
      description: Returns the history of affix rotations
      tags: [ Rotation ]
      operationId: getAffixRotationHistory
      parameters:
        - name: weeksBack
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 52
            default: 4
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: Rotation history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  rotations:
                    type: array
                    items:
                      $ref: '#/components/schemas/AffixRotation'
                  total:
                    type: integer
                    minimum: 0
                  limit:
                    type: integer
                    minimum: 1
                    maximum: 100
                  offset:
                    type: integer
                    minimum: 0
                description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
        "400":
          $ref: '#/components/responses/BadRequest'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /gameplay/affixes/rotation/trigger:
    post:
      summary: Trigger manual affix rotation
      description: Manually triggers an affix rotation (admin operation)
      tags: [ Rotation ]
      operationId: triggerAffixRotation
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerRotationRequest'
      responses:
        "200":
          description: Rotation triggered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Affix rotation triggered successfully"
                  nextRotation:
                    type: string
                    format: date-time
                description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
        "400":
          $ref: '#/components/responses/BadRequest'
        "500":
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer token authentication

  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    ServiceUnavailable:
      description: Service Unavailable
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    # Core Affix Schemas
    Affix:
      type: object
      required:
        - id
        - name
        - description
        - category
        - rewardModifier
        - difficultyModifier
        - mechanics
        - visualEffects
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          example: "Volatile"
          maxLength: 100
        description:
          type: string
          example: "Enemies explode on death, dealing area damage"
          maxLength: 500
        category:
          $ref: '#/components/schemas/AffixCategory'
        rewardModifier:
          type: number
          format: float
          example: 1.25
          minimum: 0.1
          maximum: 5.0
        difficultyModifier:
          type: number
          format: float
          example: 1.5
          minimum: 0.1
          maximum: 10.0
        mechanics:
          $ref: '#/components/schemas/AffixMechanics'
        visualEffects:
          $ref: '#/components/schemas/VisualEffects'
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    AffixSummary:
      type: object
      required:
        - id
        - name
        - description
        - category
        - rewardModifier
        - difficultyModifier
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          example: "Volatile"
          maxLength: 100
        description:
          type: string
          example: "Enemies explode on death, dealing area damage"
          maxLength: 500
        category:
          $ref: '#/components/schemas/AffixCategory'
        rewardModifier:
          type: number
          format: float
          example: 1.25
        difficultyModifier:
          type: number
          format: float
          example: 1.5
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    AffixCategory:
      type: string
      enum:
        - combat
        - environmental
        - debuff
        - defensive
      example: combat
      description: The category of the affix determining its type and effects

    AffixMechanics:
      type: object
      properties:
        trigger:
          type: string
          example: "on_death"
          maxLength: 50
        effectType:
          type: string
          example: "explosion"
          maxLength: 50
        radius:
          type: number
          format: float
          example: 5.0
          minimum: 0
        damagePercent:
          type: integer
          example: 25
          minimum: 0
          maximum: 1000
        damageType:
          type: string
          example: "fire"
          maxLength: 50
        duration:
          type: integer
          example: 300
          minimum: 0
        stacks:
          type: integer
          example: 5
          minimum: 0
        additionalData:
          type: object
          description: Additional mechanics data stored as flexible JSON
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    VisualEffects:
      type: object
      properties:
        explosionParticle:
          type: string
          example: "fire_explosion"
          maxLength: 100
        soundEffect:
          type: string
          example: "explosion_boom"
          maxLength: 100
        screenShake:
          type: boolean
          example: true
        particleEffect:
          type: string
          example: "fire_particles"
          maxLength: 100
        colorTint:
          type: string
          example: "#FF4500"
          maxLength: 7
        additionalData:
          type: object
          description: Additional visual effects data stored as flexible JSON
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Active Affixes
    ActiveAffixesResponse:
      type: object
      required:
        - weekStart
        - weekEnd
        - activeAffixes
      properties:
        weekStart:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
        weekEnd:
          type: string
          format: date-time
          example: "2024-01-08T00:00:00Z"
        activeAffixes:
          type: array
          items:
            $ref: '#/components/schemas/AffixSummary'
          maxItems: 10
        seasonalAffix:
          $ref: '#/components/schemas/AffixSummary'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Instance Affixes
    InstanceAffixesResponse:
      type: object
      required:
        - instanceId
        - appliedAt
        - affixes
        - totalRewardModifier
        - totalDifficultyModifier
      properties:
        instanceId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        appliedAt:
          type: string
          format: date-time
          example: "2024-01-01T12:00:00Z"
        affixes:
          type: array
          items:
            $ref: '#/components/schemas/AffixSummary'
          maxItems: 4
        totalRewardModifier:
          type: number
          format: float
          example: 1.75
        totalDifficultyModifier:
          type: number
          format: float
          example: 2.25
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Rotation
    AffixRotation:
      type: object
      required:
        - id
        - weekStart
        - weekEnd
        - activeAffixes
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"
        weekStart:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
        weekEnd:
          type: string
          format: date-time
          example: "2024-01-08T00:00:00Z"
        activeAffixes:
          type: array
          items:
            $ref: '#/components/schemas/AffixSummary'
          maxItems: 10
        seasonalAffix:
          $ref: '#/components/schemas/AffixSummary'
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Requests
    CreateAffixRequest:
      type: object
      required:
        - name
        - description
        - category
        - rewardModifier
        - difficultyModifier
        - mechanics
        - visualEffects
      properties:
        name:
          type: string
          example: "Volatile"
          maxLength: 100
        description:
          type: string
          example: "Enemies explode on death, dealing area damage"
          maxLength: 500
        category:
          $ref: '#/components/schemas/AffixCategory'
        rewardModifier:
          type: number
          format: float
          example: 1.25
          minimum: 0.1
          maximum: 5.0
        difficultyModifier:
          type: number
          format: float
          example: 1.5
          minimum: 0.1
          maximum: 10.0
        mechanics:
          $ref: '#/components/schemas/AffixMechanics'
        visualEffects:
          $ref: '#/components/schemas/VisualEffects'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    UpdateAffixRequest:
      type: object
      properties:
        name:
          type: string
          example: "Super Volatile"
          maxLength: 100
        description:
          type: string
          example: "Enemies explode on death, dealing massive area damage"
          maxLength: 500
        category:
          $ref: '#/components/schemas/AffixCategory'
        rewardModifier:
          type: number
          format: float
          example: 1.5
          minimum: 0.1
          maximum: 5.0
        difficultyModifier:
          type: number
          format: float
          example: 2.0
          minimum: 0.1
          maximum: 10.0
        mechanics:
          $ref: '#/components/schemas/AffixMechanics'
        visualEffects:
          $ref: '#/components/schemas/VisualEffects'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    TriggerRotationRequest:
      type: object
      properties:
        customAffixes:
          type: array
          items:
            type: string
            format: uuid
          maxItems: 10
          description: Optional custom affixes for this rotation
        force:
          type: boolean
          example: false
          description: Force rotation even if it's not time yet
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Error Schema
    Error:
      type: object
      required:
        - message
        - domain
        - timestamp
        - code
      properties:
        message:
          type: string
          example: Internal server error
          maxLength: 1000
        domain:
          type: string
          example: gameplay-affixes-service
          maxLength: 255
        timestamp:
          type: string
          format: date-time
          example: "2024-01-01T12:00:00Z"
          maxLength: 255
        code:
          type: integer
          example: 500
          format: int32
          minimum: 100
          maximum: 599
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
