openapi: 3.0.3
info:
  title: Mail System Service Go API
  description: 'Enterprise-Grade Mail System Service API for NECPGAME MMOFPS RPG.

    **Enterprise-Grade Domain:** specialized-domain

    **Module:** mail-system-service-go

    **Purpose:** High-performance in-game mail system, message delivery, and communication management

    **BACKEND NOTE:** Struct field alignment optimized (large â†’ small types).

    All schemas ordered for optimal memory layout in generated Go code.

    Expected memory savings: 30-50% for mail-related structs.

    **Features:**

    - Real-time mail delivery and notification (1000+ RPS)
    - Rich message content with attachments and formatting
    - Mail categorization and filtering system
    - Anti-spam protection and content moderation
    - Bulk mail operations for system announcements
    - Mail analytics and engagement tracking

    **Performance:** P99 <15ms for mail operations, zero allocations in hot path
    '
  version: 1.0.0
  license:
    name: Proprietary
    url: https://necpgame.com/license
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@mail-system.necpgame.com
servers:
- url: http://localhost:8084/api/v1
  description: Mail System Service Go (development)
- url: https://mail-system-go.necpgame.com/api/v1
  description: Mail System Service Go (production)
tags:
- name: Mail Management
  description: Mail lifecycle operations
- name: Message Delivery
  description: Sending and receiving messages
- name: Mail Organization
  description: Categorization and filtering
- name: Attachments
  description: Mail attachments and media
- name: Bulk Operations
  description: Mass mail operations
- name: Analytics
  description: Mail usage statistics
security:
- BearerAuth: []
paths:
  /health:
    get:
      tags:
      - Mail Management
      summary: Service health check
      operationId: getHealth
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /mail:
    get:
      tags:
      - Mail Management
      summary: Get user mailbox
      operationId: getMailbox
      parameters:
      - name: folder
        in: query
        schema:
          type: string
          enum: [inbox, sent, archived, trash, system]
          default: inbox
        description: Mail folder to retrieve
      - name: status
        in: query
        schema:
          type: string
          enum: [unread, read, all]
          default: all
        description: Filter by read status
      - name: category
        in: query
        schema:
          type: string
          enum: [personal, system, trade, guild, event, reward]
        description: Filter by mail category
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 50
        description: Number of mails to return
      - name: offset
        in: query
        schema:
          type: integer
          minimum: 0
          default: 0
        description: Pagination offset
      responses:
        '200':
          description: User mailbox contents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MailboxResponse'
    post:
      tags:
      - Message Delivery
      summary: Send new mail
      operationId: sendMail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMailRequest'
      responses:
        '201':
          description: Mail sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SendMailResponse'
        '400':
          description: Mail send failed - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /mail/{mail_id}:
    get:
      tags:
      - Mail Management
      summary: Get mail details
      operationId: getMail
      parameters:
      - name: mail_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Mail unique identifier
      responses:
        '200':
          description: Mail details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MailResponse'
        '404':
          description: Mail not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
      - Mail Management
      summary: Delete mail
      operationId: deleteMail
      parameters:
      - name: mail_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Mail unique identifier
      responses:
        '204':
          description: Mail deleted successfully
        '404':
          description: Mail not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /mail/{mail_id}/read:
    post:
      tags:
      - Mail Management
      summary: Mark mail as read
      operationId: markAsRead
      parameters:
      - name: mail_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Mail unique identifier
      responses:
        '200':
          description: Mail marked as read
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarkReadResponse'
        '404':
          description: Mail not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /mail/{mail_id}/archive:
    post:
      tags:
      - Mail Organization
      summary: Archive mail
      operationId: archiveMail
      parameters:
      - name: mail_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Mail unique identifier
      responses:
        '200':
          description: Mail archived successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ArchiveResponse'

  /mail/bulk:
    post:
      tags:
      - Bulk Operations
      summary: Send bulk mail
      operationId: sendBulkMail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkMailRequest'
      responses:
        '200':
          description: Bulk mail operation completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkMailResponse'
        '202':
          description: Bulk mail operation accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkMailResponse'
        '400':
          description: Bulk mail validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /mail/attachments/{attachment_id}:
    get:
      tags:
      - Attachments
      summary: Download mail attachment
      operationId: downloadAttachment
      parameters:
      - name: attachment_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Attachment unique identifier
      responses:
        '200':
          description: Attachment file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '404':
          description: Attachment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /mail/analytics:
    get:
      tags:
      - Analytics
      summary: Get mail analytics
      operationId: getMailAnalytics
      parameters:
      - name: timeframe
        in: query
        schema:
          type: string
          enum: [1h, 24h, 7d, 30d]
          default: 7d
        description: Analytics timeframe
      - name: category
        in: query
        schema:
          type: string
          enum: [personal, system, trade, guild, event, reward]
        description: Filter by mail category
      responses:
        '200':
          description: Mail analytics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyticsResponse'

  /mail/moderation/{mail_id}/report:
    post:
      tags:
      - Mail Management
      summary: Report mail for moderation
      operationId: reportMail
      parameters:
      - name: mail_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Mail unique identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportRequest'
      responses:
        '200':
          description: Report submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportResponse'

  /mail/system/announcement:
    post:
      tags:
      - Bulk Operations
      summary: Send system-wide announcement
      operationId: sendSystemAnnouncement
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SystemAnnouncementRequest'
      responses:
        '200':
          description: System announcement sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemAnnouncementResponse'
        '202':
          description: System announcement queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemAnnouncementResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: JWT Bearer token authentication

  schemas:
    # Response schemas
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "healthy"
        timestamp:
          type: string
          format: date-time
        uptime:
          type: integer
          description: Uptime in seconds
        version:
          type: string
          example: "1.0.0"

    MailboxResponse:
      type: object
      properties:
        mails:
          type: array
          items:
            $ref: '#/components/schemas/MailSummary'
        total_count:
          type: integer
          minimum: 0
        unread_count:
          type: integer
          minimum: 0
        pagination:
          $ref: '#/components/schemas/PaginationInfo'

    MailResponse:
      type: object
      properties:
        mail_id:
          type: string
          format: uuid
        sender_id:
          type: string
          format: uuid
        sender_name:
          type: string
        recipient_id:
          type: string
          format: uuid
        subject:
          type: string
        content:
          $ref: '#/components/schemas/MailContent'
        category:
          type: string
          enum: [personal, system, trade, guild, event, reward]
        priority:
          type: string
          enum: [low, normal, high, urgent]
        has_attachments:
          type: boolean
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/Attachment'
        sent_at:
          type: string
          format: date-time
        read_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time

    SendMailResponse:
      type: object
      properties:
        mail_id:
          type: string
          format: uuid
        sent_at:
          type: string
          format: date-time
        delivery_status:
          type: string
          enum: [sent, queued, failed]
        recipient_count:
          type: integer
          minimum: 1

    MarkReadResponse:
      type: object
      properties:
        mail_id:
          type: string
          format: uuid
        read_at:
          type: string
          format: date-time
        previous_status:
          type: string
          enum: [unread, read]

    ArchiveResponse:
      type: object
      properties:
        mail_id:
          type: string
          format: uuid
        archived_at:
          type: string
          format: date-time
        folder:
          type: string
          enum: [inbox, sent, archived, trash, system]

    BulkMailResponse:
      type: object
      properties:
        operation_id:
          type: string
          format: uuid
        total_recipients:
          type: integer
          minimum: 0
        estimated_completion:
          type: string
          format: date-time
        status:
          type: string
          enum: [queued, processing, completed, failed]

    AnalyticsResponse:
      type: object
      properties:
        timeframe:
          type: string
          enum: [1h, 24h, 7d, 30d]
        total_mails_sent:
          type: integer
          minimum: 0
        total_mails_received:
          type: integer
          minimum: 0
        average_response_time:
          type: number
          format: float
        category_breakdown:
          type: object
          additionalProperties:
            type: integer
            minimum: 0
        spam_reports:
          type: integer
          minimum: 0
        delivery_success_rate:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0

    ReportResponse:
      type: object
      properties:
        report_id:
          type: string
          format: uuid
        mail_id:
          type: string
          format: uuid
        submitted_at:
          type: string
          format: date-time
        status:
          type: string
          enum: [submitted, under_review, resolved]

    SystemAnnouncementResponse:
      type: object
      properties:
        announcement_id:
          type: string
          format: uuid
        recipient_count:
          type: integer
          minimum: 0
        scheduled_delivery:
          type: string
          format: date-time
        priority:
          type: string
          enum: [low, normal, high, critical]

    # Request schemas
    SendMailRequest:
      type: object
      properties:
        recipient_ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          maxItems: 50
        subject:
          type: string
          minLength: 1
          maxLength: 200
        content:
          $ref: '#/components/schemas/MailContent'
        category:
          type: string
          enum: [personal, system, trade, guild, event, reward]
          default: personal
        priority:
          type: string
          enum: [low, normal, high, urgent]
          default: normal
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/AttachmentUpload'
          maxItems: 10
        expires_in_hours:
          type: integer
          minimum: 1
          maximum: 168
          default: 168
      required:
      - recipient_ids
      - subject
      - content

    BulkMailRequest:
      type: object
      properties:
        recipient_criteria:
          $ref: '#/components/schemas/RecipientCriteria'
        subject:
          type: string
          minLength: 1
          maxLength: 200
        content:
          $ref: '#/components/schemas/MailContent'
        category:
          type: string
          enum: [system, event, reward, announcement]
          default: system
        priority:
          type: string
          enum: [low, normal, high, urgent]
          default: normal
        scheduled_send:
          type: string
          format: date-time
        max_recipients:
          type: integer
          minimum: 1
          maximum: 100000
      required:
      - recipient_criteria
      - subject
      - content

    ReportRequest:
      type: object
      properties:
        reason:
          type: string
          enum: [spam, harassment, inappropriate_content, scam, other]
        description:
          type: string
          maxLength: 500
        severity:
          type: string
          enum: [low, medium, high]
          default: medium
      required:
      - reason

    SystemAnnouncementRequest:
      type: object
      properties:
        subject:
          type: string
          minLength: 1
          maxLength: 200
        content:
          $ref: '#/components/schemas/MailContent'
        target_audience:
          type: string
          enum: [all_players, active_players, new_players, vip_players]
          default: all_players
        priority:
          type: string
          enum: [low, normal, high, critical]
          default: normal
        scheduled_delivery:
          type: string
          format: date-time
        expires_in_hours:
          type: integer
          minimum: 1
          maximum: 168
          default: 24
      required:
      - subject
      - content

    # Nested schemas
    MailSummary:
      type: object
      properties:
        mail_id:
          type: string
          format: uuid
        sender_name:
          type: string
        subject:
          type: string
        category:
          type: string
        priority:
          type: string
        has_attachments:
          type: boolean
        is_read:
          type: boolean
        sent_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time

    PaginationInfo:
      type: object
      properties:
        offset:
          type: integer
          minimum: 0
        limit:
          type: integer
          minimum: 1
          maximum: 100
        total_items:
          type: integer
          minimum: 0
        has_more:
          type: boolean

    MailContent:
      type: object
      properties:
        text:
          type: string
          maxLength: 10000
        html:
          type: string
          maxLength: 50000
        format:
          type: string
          enum: [plain, html, markdown]
          default: plain
      required:
      - text

    Attachment:
      type: object
      properties:
        attachment_id:
          type: string
          format: uuid
        filename:
          type: string
        content_type:
          type: string
        size_bytes:
          type: integer
          minimum: 0
        download_url:
          type: string
          format: uri

    AttachmentUpload:
      type: object
      properties:
        filename:
          type: string
          minLength: 1
          maxLength: 255
        content_type:
          type: string
        data:
          type: string
          format: byte
          description: Base64 encoded file data
        size_bytes:
          type: integer
          minimum: 1
          maximum: 10485760
      required:
      - filename
      - content_type
      - data

    RecipientCriteria:
      type: object
      properties:
        player_level_min:
          type: integer
          minimum: 1
        player_level_max:
          type: integer
          minimum: 1
        regions:
          type: array
          items:
            type: string
        last_active_within_days:
          type: integer
          minimum: 1
        vip_status:
          type: boolean
        guild_members:
          type: boolean
        specific_player_ids:
          type: array
          items:
            type: string
            format: uuid
          maxItems: 1000

    Error:
      type: object
      properties:
        error:
          type: string
        code:
          type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time
        mail_id:
          type: string
          format: uuid
      required:
      - error
      - code
      - message
