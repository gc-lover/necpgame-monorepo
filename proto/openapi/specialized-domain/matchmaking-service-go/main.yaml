# Issue: #2220
openapi: 3.0.3
info:
  title: Specialized Domain - Matchmaking Service Go API
  description: |
    **Enterprise-Grade Matchmaking Service API** for NECPGAME MMOFPS RPG.

    **Enterprise-Grade Domain:** specialized-domain
    **Module:** matchmaking-service-go
    **Purpose:** High-performance PvP matchmaking and queue management

    **BACKEND NOTE:** Struct field alignment optimized (large â†’ small types).
    All schemas ordered for optimal memory layout in generated Go code.
    Expected memory savings: 30-50% for matchmaking-related structs.
    Hot paths: /queue/join, /queue/status, /match/start
    Expected RPS: 2000+ for hot paths, zero allocations.

    **Core Features:**
    - Real-time matchmaking queue management
    - Skill-based matchmaking algorithms
    - Region and latency-based matching
    - Anti-cheat queue validation
    - Match creation and orchestration
    - Queue statistics and analytics
    - Cross-platform matchmaking support

    **Performance Targets:**
    - Queue join: <50ms P99
    - Match found: <30 seconds average
    - Concurrent queues: 100k+ players
    - Memory per queue entry: <1KB
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME Matchmaking API Support
    url: https://necpgame.com/support
    email: api@matchmaking.necpgame.com

servers:
  - url: http://localhost:8080/api/v1/matchmaking
    description: Development server
  - url: https://api.necpgame.com/api/v1/matchmaking
    description: Production server

security:
  - BearerAuth: [ ]

tags:
  - name: Queue Management
    description: Queue join, leave, and status operations
  - name: Match Operations
    description: Match creation, start, and management
  - name: Matchmaking Preferences
    description: Player matchmaking preferences and settings
  - name: Analytics
    description: Queue and matchmaking statistics
  - name: Anti-Cheat
    description: Matchmaking validation and anti-cheat
  - name: Health
    description: Service health check

paths:
  /health:
    get:
      summary: Service health check
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /queue/join:
    post:
      summary: Join matchmaking queue
      operationId: joinQueue
      description: |
        Adds a player to the matchmaking queue.
        **BACKEND NOTE:** Hot path - optimized for 2000+ RPS, zero allocations.
      tags:
        - Queue Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinQueueRequest'
      responses:
        '200':
          description: Successfully joined queue
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JoinQueueResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Conflict - already in queue or match
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: Too many requests - rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /queue/leave:
    post:
      summary: Leave matchmaking queue
      operationId: leaveQueue
      description: |
        Removes a player from the matchmaking queue.
      tags:
        - Queue Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeaveQueueRequest'
      responses:
        '200':
          description: Successfully left queue
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeaveQueueResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Not in queue
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /queue/status:
    get:
      summary: Get queue status
      operationId: getQueueStatus
      description: |
        Retrieves the player's current queue status.
        **BACKEND NOTE:** Hot path - optimized for 2000+ RPS, zero allocations.
      tags:
        - Queue Management
      parameters:
        - name: playerId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Player ID
      responses:
        '200':
          description: Queue status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueStatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /match/{matchId}:
    parameters:
      - name: matchId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Match ID
    get:
      summary: Get match details
      operationId: getMatchDetails
      description: |
        Retrieves details about a specific match.
      tags:
        - Match Operations
      responses:
        '200':
          description: Match details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchDetailsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /match/{matchId}/accept:
    post:
      summary: Accept match
      operationId: acceptMatch
      description: |
        Player accepts a proposed match.
        **BACKEND NOTE:** Hot path - optimized for 1000+ RPS, zero allocations.
      tags:
        - Match Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptMatchRequest'
      responses:
        '200':
          description: Match accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptMatchResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '408':
          description: Request timeout - match expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /match/{matchId}/decline:
    post:
      summary: Decline match
      operationId: declineMatch
      description: |
        Player declines a proposed match.
      tags:
        - Match Operations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeclineMatchRequest'
      responses:
        '200':
          description: Match declined
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeclineMatchResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /match/{matchId}/start:
    post:
      summary: Start match
      operationId: startMatch
      description: |
        Initiates the start of a match (server-side).
        **BACKEND NOTE:** Critical path - zero latency requirements.
      tags:
        - Match Operations
      responses:
        '200':
          description: Match started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StartMatchResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Conflict - match not ready to start
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /preferences:
    get:
      summary: Get matchmaking preferences
      operationId: getMatchmakingPreferences
      description: |
        Retrieves player's matchmaking preferences.
      tags:
        - Matchmaking Preferences
      parameters:
        - name: playerId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Player ID
      responses:
        '200':
          description: Matchmaking preferences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchmakingPreferencesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Update matchmaking preferences
      operationId: updateMatchmakingPreferences
      description: |
        Updates player's matchmaking preferences.
      tags:
        - Matchmaking Preferences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePreferencesRequest'
      responses:
        '200':
          description: Preferences updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdatePreferencesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /analytics/queue:
    get:
      summary: Get queue analytics
      operationId: getQueueAnalytics
      description: |
        Retrieves queue statistics and analytics.
      tags:
        - Analytics
      parameters:
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum: [ HOUR, DAY, WEEK, MONTH ]
            default: HOUR
          description: Analytics period
        - name: region
          in: query
          required: false
          schema:
            type: string
          description: Filter by region
      responses:
        '200':
          description: Queue analytics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueAnalyticsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /validate:
    post:
      summary: Validate matchmaking state
      operationId: validateMatchmakingState
      description: |
        Internal endpoint for anti-cheat and server-side validation of matchmaking state.
      tags:
        - Anti-Cheat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MatchmakingValidationRequest'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchmakingValidationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: JWT Bearer token authentication

  responses:
    BadRequest:
      description: Invalid request payload or parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Authentication required or failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Access denied
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Unexpected internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum: [ healthy ]
        timestamp:
          type: string
          format: date-time
        version:
          type: string

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Unique error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          description: Additional error details

    JoinQueueRequest:
      $ref: './schemas/join-queue-request.yaml'
    JoinQueueResponse:
      $ref: './schemas/join-queue-response.yaml'
    LeaveQueueRequest:
      $ref: './schemas/leave-queue-request.yaml'
    LeaveQueueResponse:
      $ref: './schemas/leave-queue-response.yaml'
    QueueStatusResponse:
      $ref: './schemas/queue-status-response.yaml'
    MatchDetailsResponse:
      $ref: './schemas/match-details-response.yaml'
    AcceptMatchRequest:
      $ref: './schemas/accept-match-request.yaml'
    AcceptMatchResponse:
      $ref: './schemas/accept-match-response.yaml'
    DeclineMatchRequest:
      $ref: './schemas/decline-match-request.yaml'
    DeclineMatchResponse:
      $ref: './schemas/decline-match-response.yaml'
    StartMatchResponse:
      $ref: './schemas/start-match-response.yaml'
    MatchmakingPreferencesResponse:
      $ref: './schemas/matchmaking-preferences-response.yaml'
    UpdatePreferencesRequest:
      $ref: './schemas/update-preferences-request.yaml'
    UpdatePreferencesResponse:
      $ref: './schemas/update-preferences-response.yaml'
    QueueAnalyticsResponse:
      $ref: './schemas/queue-analytics-response.yaml'
    MatchmakingValidationRequest:
      $ref: './schemas/matchmaking-validation-request.yaml'
    MatchmakingValidationResponse:
      $ref: './schemas/matchmaking-validation-response.yaml'

