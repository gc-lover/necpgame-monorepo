openapi: 3.0.3
info:
  title: Gameplay Weapon Special Mechanics Core Service API
  description: 'API для основных специальных механик оружия.


    **Основные возможности:**

    - Общие специальные механики оружия

    - Персистентные эффекты (снаряды в теле, DoT)

    - Цепной урон (молнии, EMP волны)

    - Разрушение окружения и частей тела

    '
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8083/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер
tags:
  - name: Special Mechanics
    description: Общие специальные механики оружия
  - name: Persistent Effects
    description: Персистентные эффекты (снаряды в теле, DoT)
  - name: Chain Damage
    description: Цепной урон (молнии, EMP волны)
  - name: Environment Destruction
    description: Разрушение окружения и частей тела
paths:
  /gameplay/combat/weapons/special-mechanics/apply:
    post:
      tags:
        - Special Mechanics
      summary: Применить специальную механику оружия
      operationId: applySpecialMechanics
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplySpecialMechanicsRequest'
      responses:
        '200':
          description: Механика успешно применена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplySpecialMechanicsResponse'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /gameplay/combat/weapons/special-mechanics/{weaponId}:
    get:
      tags:
        - Special Mechanics
      summary: Получить механики оружия
      operationId: getWeaponSpecialMechanics
      security:
        - BearerAuth: [ ]
      parameters:
        - name: weaponId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID оружия
      responses:
        '200':
          description: Список механик оружия
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeaponSpecialMechanicsResponse'
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '404':
          $ref: ../../common-schemas.yaml#/components/responses/NotFound
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /gameplay/combat/weapons/persistent-effects/create:
    post:
      tags:
        - Persistent Effects
      summary: Создать персистентный эффект
      operationId: createPersistentEffect
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePersistentEffectRequest'
      responses:
        '201':
          description: Персистентный эффект создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersistentEffect'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /gameplay/combat/weapons/persistent-effects/{targetId}:
    get:
      tags:
        - Persistent Effects
      summary: Получить персистентные эффекты цели
      operationId: getPersistentEffects
      security:
        - BearerAuth: [ ]
      parameters:
        - name: targetId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID цели
      responses:
        '200':
          description: Список персистентных эффектов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersistentEffectsResponse'
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '404':
          $ref: ../../common-schemas.yaml#/components/responses/NotFound
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /gameplay/combat/weapons/chain-damage/calculate:
    post:
      tags:
        - Chain Damage
      summary: Рассчитать цепной урон
      operationId: calculateChainDamage
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalculateChainDamageRequest'
      responses:
        '200':
          description: Результат расчета цепного урона
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChainDamageResponse'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /gameplay/combat/weapons/environment/destroy:
    post:
      tags:
        - Environment Destruction
      summary: Разрушить окружение
      operationId: destroyEnvironment
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DestroyEnvironmentRequest'
      responses:
        '200':
          description: Результат разрушения окружения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentDestructionResponse'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    ApplySpecialMechanicsRequest:
      type: object
      required:
        - weapon_id
        - character_id
        - target_id
        - mechanic_type
      properties:
        weapon_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
        target_id:
          type: string
          format: uuid
        mechanic_type:
          type: string
          enum:
            - persistent_effect
            - chain_damage
            - environment_destruction
            - deployable
            - laser
            - melee
            - elemental
            - temporal
            - control
            - summon
            - projectile_form
          description: Тип специальной механики
        mechanic_data:
          type: object
          additionalProperties: true
          description: Данные механики (зависит от типа)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ApplySpecialMechanicsResponse:
      type: object
      properties:
        effect_id:
          type: string
          format: uuid
          description: ID созданного эффекта
        mechanic_type:
          type: string
          description: Тип примененной механики
        applied_at:
          type: string
          format: date-time
          description: Время применения
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    WeaponSpecialMechanicsResponse:
      type: object
      properties:
        weapon_id:
          type: string
          format: uuid
        mechanics:
          type: array
          items:
            $ref: '#/components/schemas/WeaponMechanic'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    WeaponMechanic:
      type: object
      properties:
        id:
          type: string
          format: uuid
        mechanic_type:
          type: string
        created_at:
          type: string
          format: date-time
        mechanic_data:
          type: object
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CreatePersistentEffectRequest:
      type: object
      required:
        - target_id
        - projectile_type
        - position
        - damage_per_tick
        - tick_interval
      properties:
        target_id:
          type: string
          format: uuid
        projectile_type:
          type: string
          enum:
            - bolt
            - arrow
            - shuriken
          description: Тип снаряда
        position:


        remaining_ticks:
          type: integer
          minimum: 0
          description: Количество оставшихся тиков
        damage_per_tick:
          type: number
          format: float
          minimum: 0
          description: Урон за тик
        tick_interval:
          type: number
          format: float
          minimum: 0
          description: Интервал между тиками (секунды)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PersistentEffect:
      type: object
      properties:
        id:
          type: string
          format: uuid
        target_id:
          type: string
          format: uuid
        projectile_type:
          type: string
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        position:
          $ref: common-schemas.yaml#/components/schemas/Position3D
        remaining_ticks:
          type: integer
        damage_per_tick:
          type: number
          format: float
        tick_interval:
          type: number
          format: float
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PersistentEffectsResponse:
      type: object
      properties:
        target_id:
          type: string
          format: uuid
        effects:
          type: array
          items:
            $ref: '#/components/schemas/PersistentEffect'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CalculateChainDamageRequest:
      type: object
      required:
        - source_target_id
        - weapon_id
        - damage_type
        - base_damage
      properties:
        source_target_id:
          type: string
          format: uuid
        weapon_id:
          type: string
          format: uuid
        damage_type:
          type: string
          enum:
            - lightning
            - emp
          description: Тип цепного урона
        max_jumps:
          type: integer
          minimum: 1
          maximum: 10
          default: 5
          description: Максимальное количество прыжков
        base_damage:
          type: number
          format: float
          minimum: 0
          description: Базовый урон
        jump_damage_reduction:
          type: number
          format: float
          minimum: 0
          maximum: 1
          default: 0.25
          description: Снижение урона при каждом прыжке
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ChainDamageResponse:
      type: object
      properties:
        source_target_id:
          type: string
          format: uuid
        jumps:
          type: array
          items:
            $ref: '#/components/schemas/ChainDamageJump'
        total_damage:
          type: number
          format: float
          description: Общий урон по всем целям
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ChainDamageJump:
      type: object
      properties:
        target_id:
          type: string
          format: uuid
        jump_number:
          type: integer
          description: Номер прыжка
        damage:
          type: number
          format: float
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DestroyEnvironmentRequest:
      type: object
      required:
        - explosion_position
        - explosion_radius
        - weapon_id
        - damage
      properties:
        weapon_id:
          type: string
          format: uuid
          description: ID оружия
        explosion_position:
          $ref: common-schemas.yaml#/components/schemas/Position3D
        explosion_radius:
          type: number
          format: float
          minimum: 0
          description: Радиус взрыва
        damage:
          type: number
          format: float
          minimum: 0
          description: Урон взрыва
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EnvironmentDestructionResponse:
      type: object
      properties:
        destroyed_objects:
          type: array
          items:
            $ref: '#/components/schemas/DestroyedObject'
        affected_targets:
          type: array
          items:
            $ref: '#/components/schemas/AffectedTarget'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DestroyedObject:
      type: object
      properties:
        object_id:
          type: string
          format: uuid
        destruction_type:
          type: string
          enum:
            - wall
            - barrier
            - body_part
            - debris
        position:
          $ref: common-schemas.yaml#/components/schemas/Position3D
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AffectedTarget:
      type: object
      properties:
        target_id:
          type: string
          format: uuid
        body_parts_destroyed:
          type: array
          items:
            type: string
        damage:
          type: number
          format: float
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
