openapi: 3.0.3
info:
  title: Quest System API
  description: |
    **Enterprise-Grade Quest Management API for NECPGAME MMOFPS**

    Полная система управления квестами с enterprise-grade оптимизациями.
    Поддерживает динамические квесты, NPC взаимодействия, награды и прогрессию.

    ## Key Features
    - **Enterprise-grade quest management** с оптимизацией производительности
    - **Backend optimization hints** для struct alignment и memory savings
    - **Complete validation** с redocly и ogen code generation
    - **Security-first approach** с JWT authentication
    - **Performance-optimized** response structures
    - **Comprehensive error handling** с proper HTTP status codes

    ## Domain Purpose
    Quest System управляет всеми аспектами квестовой системы:
    создание квестов, отслеживание прогресса, награды, NPC диалоги, ветвление сюжета.

    ## Performance Targets
    - Hot paths: 1000+ RPS, P99 <15ms (quest status, progress updates)
    - Quest queries: <5ms average response time
    - Memory: <35MB per service instance
    - Cache hit rate: >95%
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME Quests API Support
    url: https://necpgame.com/support
    email: api@quests.necpgame.com

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://api.necpgame.com/api/v1
    description: Production server

security:
  - BearerAuth: [ ]

tags:
  - name: Quests
    description: Quest management operations
  - name: Quest Progress
    description: Quest progress tracking

paths:
  /api/v1/quests/health:
    get:
      summary: Quest service health check
      operationId: questHealthCheck
      tags:
        - Quests
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/v1/quests:
    get:
      summary: Get available quests
      operationId: getQuests
      tags:
        - Quests
      security:
        - BearerAuth: [ ]
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [ available, active, completed, failed ]
            default: available
          description: Filter by quest status
        - name: type
          in: query
          schema:
            type: string
            enum: [ main_story, side_quest, daily, event, faction ]
          description: Filter by quest type
        - name: location_id
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by location
        - name: level_min
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Minimum character level
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
          description: Maximum number of results
      responses:
        '200':
          description: Quests retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestListResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/quests/{quest_id}:
    get:
      summary: Get quest details
      operationId: getQuest
      tags:
        - Quests
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Quest unique identifier
      responses:
        '200':
          description: Quest details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestDetailResponse'
        '404':
          description: Quest not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/quests/{quest_id}/accept:
    post:
      summary: Accept a quest
      operationId: acceptQuest
      tags:
        - Quests
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Quest to accept
      responses:
        '200':
          description: Quest accepted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestProgressResponse'
        '400':
          description: Cannot accept quest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Quest already active or completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/quests/{quest_id}/progress:
    get:
      summary: Get quest progress
      operationId: getQuestProgress
      tags:
        - Quest Progress
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Quest identifier
      responses:
        '200':
          description: Quest progress retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestProgressResponse'
        '404':
          description: Quest not found or not active
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      summary: Update quest progress
      operationId: updateQuestProgress
      tags:
        - Quest Progress
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Quest identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProgressRequest'
      responses:
        '200':
          description: Progress updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestProgressResponse'
        '400':
          description: Invalid progress update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Quest not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/quests/{quest_id}/complete:
    post:
      summary: Complete a quest
      operationId: completeQuest
      tags:
        - Quests
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Quest to complete
      responses:
        '200':
          description: Quest completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestCompletionResponse'
        '400':
          description: Cannot complete quest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Quest not ready for completion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Seattle Quests Service Integration - specialized Seattle 2020-2029 quests
  /api/v1/seattle/quests:
    $ref: ./seattle-quests-service.yaml#/paths/~1api~1v1~1quests~1seattle
  /api/v1/seattle/quests/{quest_id}:
    $ref: ./seattle-quests-service.yaml#/paths/~1api~1v1~1quests~1seattle~1{quest_id}
  /api/v1/seattle/quests/{quest_id}/progress:
    $ref: ./seattle-quests-service.yaml#/paths/~1api~1v1~1quests~1seattle~1{quest_id}~1progress
  /api/v1/seattle/quests/landmarks:
    $ref: ./seattle-quests-service.yaml#/paths/~1api~1v1~1quests~1seattle~1landmarks
  /api/v1/seattle/quests/history/{year}:
    $ref: ./seattle-quests-service.yaml#/paths/~1api~1v1~1quests~1seattle~1history~1{year}
  /api/v1/seattle/quests/routes:
    $ref: ./seattle-quests-service.yaml#/paths/~1api~1v1~1quests~1seattle~1routes

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Core quest schemas
    Quest:
      type: object
      required:
        - id
        - title
        - type
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique quest identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        title:
          type: string
          maxLength: 200
          description: Quest title
          example: "Shadows of the Past"
        description:
          type: string
          maxLength: 2000
          description: Detailed quest description
        type:
          type: string
          enum: [ main_story, side_quest, daily, event, faction ]
          description: Quest type
          example: main_story
        status:
          type: string
          enum: [ draft, available, active, completed, failed, expired ]
          description: Quest status
          example: available
        level_requirement:
          type: integer
          minimum: 1
          maximum: 100
          description: Required character level
          example: 15
        location_id:
          type: string
          format: uuid
          description: Associated location
        giver_npc_id:
          type: string
          format: uuid
          description: NPC who gives the quest
        time_limit_hours:
          type: integer
          minimum: 1
          description: Time limit in hours
        is_repeatable:
          type: boolean
          default: false
          description: Whether quest can be repeated
        prerequisites:
          type: array
          items:
            type: object
            required:
              - type
              - value
            properties:
              type:
                type: string
                enum: [ quest_completed, level_minimum, faction_reputation, item_owned ]
              value:
                type: string
                description: Prerequisite value
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    QuestObjective:
      type: object
      required:
        - id
        - description
        - type
        - current_progress
        - target_progress
      properties:
        id:
          type: string
          format: uuid
          description: Objective identifier
        description:
          type: string
          maxLength: 500
          description: Objective description
        type:
          type: string
          enum: [ kill, collect, explore, interact, deliver, escort, defend ]
          description: Objective type
        current_progress:
          type: integer
          minimum: 0
          description: Current progress value
        target_progress:
          type: integer
          minimum: 1
          description: Target progress value
        location_id:
          type: string
          format: uuid
          description: Associated location
        npc_id:
          type: string
          format: uuid
          description: Associated NPC
        item_id:
          type: string
          format: uuid
          description: Required item

    QuestReward:
      type: object
      properties:
        experience_points:
          type: integer
          minimum: 0
          description: XP reward
        currency:
          type: object
          properties:
            amount:
              type: integer
              minimum: 0
            type:
              type: string
              enum: [ eddies, tokens, reputation ]
              default: eddies
        items:
          type: array
          items:
            type: object
            required:
              - item_id
              - quantity
            properties:
              item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
        faction_reputation:
          type: object
          description: Faction reputation changes
          additionalProperties:
            type: integer
            description: Reputation points (positive or negative)

    QuestDetailResponse:
      type: object
      required:
        - quest
        - objectives
        - rewards
      properties:
        quest:
          $ref: '#/components/schemas/Quest'
        objectives:
          type: array
          items:
            $ref: '#/components/schemas/QuestObjective'
        rewards:
          $ref: '#/components/schemas/QuestReward'
        dialogue_options:
          type: array
          items:
            type: object
            required:
              - text
              - action
            properties:
              text:
                type: string
                maxLength: 200
              action:
                type: string
                enum: [ accept, decline, ask_more_info ]

    QuestListResponse:
      type: object
      required:
        - quests
        - total_count
      properties:
        quests:
          type: array
          items:
            $ref: '#/components/schemas/Quest'
        total_count:
          type: integer
          minimum: 0
        has_more:
          type: boolean
          default: false

    QuestProgressResponse:
      type: object
      required:
        - quest_id
        - status
        - objectives
        - started_at
      properties:
        quest_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [ active, completed, failed ]
        objectives:
          type: array
          items:
            $ref: '#/components/schemas/QuestObjective'
        started_at:
          type: string
          format: date-time
        time_remaining_seconds:
          type: integer
          minimum: 0
          description: Seconds until quest expires

    UpdateProgressRequest:
      type: object
      required:
        - objective_id
        - progress_increment
      properties:
        objective_id:
          type: string
          format: uuid
          description: Objective to update
        progress_increment:
          type: integer
          minimum: 1
          description: Amount to add to progress

    QuestCompletionResponse:
      type: object
      required:
        - quest_id
        - rewards_granted
        - completed_at
      properties:
        quest_id:
          type: string
          format: uuid
        rewards_granted:
          $ref: '#/components/schemas/QuestReward'
        completed_at:
          type: string
          format: date-time
        next_quest_available:
          type: string
          format: uuid
          description: ID of next quest in chain

    # Common schemas
    HealthResponse:
      type: object
      required:
        - status
        - service
        - timestamp
      properties:
        status:
          type: string
          enum: [ healthy, degraded, unhealthy ]
          example: healthy
        service:
          type: string
          example: quests
        timestamp:
          type: string
          format: date-time
        version:
          type: string
          example: "1.0.0"
        active_quests:
          type: integer
          minimum: 0
          description: Number of currently active quests
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'

    # Seattle Quests Service Schemas Integration
    SeattleQuest:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleQuest
    SeattleQuestsResponse:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleQuestsResponse
    SeattleQuestDetailResponse:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleQuestDetailResponse
    UpdateQuestProgressRequest:
      $ref: ./seattle-quests-service.yaml#/components/schemas/UpdateQuestProgressRequest
    UpdateQuestProgressResponse:
      $ref: ./seattle-quests-service.yaml#/components/schemas/UpdateQuestProgressResponse
    SeattleLandmark:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleLandmark
    SeattleLandmarksResponse:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleLandmarksResponse
    SeattleHistoryResponse:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleHistoryResponse
    SeattleRoute:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleRoute
    SeattleRoutesResponse:
      $ref: ./seattle-quests-service.yaml#/components/schemas/SeattleRoutesResponse

    Error:
      type: object
      required:
        - message
        - code
      properties:
        message:
          type: string
          maxLength: 1000
          example: "Quest not found"
        code:
          type: string
          pattern: '^[A-Z_][A-Z0-9_]*$'
          example: QUEST_NOT_FOUND
        details:
          type: object
          description: Additional error details
        timestamp:
          type: string
          format: date-time
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'