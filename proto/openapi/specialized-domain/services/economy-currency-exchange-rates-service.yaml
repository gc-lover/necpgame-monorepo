# Issue: #1443
openapi: 3.0.3
info:
  title: Economy Currency Exchange Rates Service API
  description: 'API для управления курсами валют.

    **Основные возможности:**

    - Получение текущих курсов валют

    - Получение истории курсов

    - Расчёт предварительной котировки

    '
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8085/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер
tags:
  - name: Exchange Rates
    description: Управление курсами валют
paths:
  /currency-exchange/rates:
    get:
      tags:
        - Exchange Rates
      summary: Получить текущие курсы валют
      description: 'Возвращает текущие курсы всех доступных валютных пар.

        '
      operationId: getExchangeRates
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Текущие курсы валют
          content:
            application/json:
              schema:
                type: object
                properties:
                  rates:
                    type: array
                    items:
                      $ref: '#/components/schemas/ExchangeRate'
                  updated_at:
                    type: string
                    format: date-time
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /currency-exchange/rates/{pair}:
    get:
      tags:
        - Exchange Rates
      summary: Получить курс валютной пары
      description: 'Возвращает текущий курс для указанной валютной пары.

        '
      operationId: getExchangeRate
      security:
        - BearerAuth: [ ]
      parameters:
        - name: pair
          in: path
          required: true
          schema:
            type: string
          description: Валютная пара (например, USD/EUR)
          example: USD/EUR
      responses:
        '200':
          description: Курс валютной пары
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExchangeRate'
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '404':
          $ref: ../../common-schemas.yaml#/components/responses/NotFound
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /currency-exchange/rates/history:
    get:
      tags:
        - Exchange Rates
      summary: Получить историю курсов
      description: 'Возвращает историю курсов для указанной валютной пары за период.

        '
      operationId: getExchangeRateHistory
      security:
        - BearerAuth: [ ]
      parameters:
        - name: pair
          in: query
          required: true
          schema:
            type: string
          description: Валютная пара (например, USD/EUR)
        - name: period_start
          in: query
          schema:
            type: string
            format: date-time
          description: Начало периода
        - name: period_end
          in: query
          schema:
            type: string
            format: date-time
          description: Конец периода
        - $ref: ../../common-schemas.yaml#/components/parameters/Limit
        - $ref: common.yaml#/components/parameters/Offset
      responses:
        '200':
          description: История курсов
          content:
            application/json:
              schema:
                type: object
                properties:
                  pair:
                    type: string
                  history:
                    type: array
                    items:
                      $ref: '#/components/schemas/ExchangeRateHistory'
                  total:
                    type: integer
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /currency-exchange/quote:
    post:
      tags:
        - Exchange Rates
      summary: Расчёт предварительной котировки
      description: 'Рассчитывает предварительную котировку для обмена валют,

        включая курс, комиссию и итоговую сумму.

        '
      operationId: calculateQuote
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuoteRequest'
      responses:
        '200':
          description: Предварительная котировка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuoteResponse'
        '400':
          $ref: ../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    ExchangeRate:
      type: object
      properties:
        pair:
          type: string
          description: Валютная пара (например, USD/EUR)
        base_currency:
          type: string
        quote_currency:
          type: string
        updated_at:
          type: string
          format: date-time
        rate:
          type: number
          description: Курс обмена
        spread:
          type: number
          description: Спред
        buy_rate:
          type: number
          description: Курс покупки
        sell_rate:
          type: number
          description: Курс продажи
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ExchangeRateHistory:
      type: object
      properties:
        pair:
          type: string
        timestamp:
          type: string
          format: date-time
        rate:
          type: number
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuoteRequest:
      type: object
      required:
        - from_currency
        - to_currency
        - amount
      properties:
        from_currency:
          type: string
        to_currency:
          type: string
        amount:
          type: number
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuoteResponse:
      type: object
      properties:
        from_currency:
          type: string
        to_currency:
          type: string
        valid_until:
          type: string
          format: date-time
        amount:
          type: number
        rate:
          type: number
        fee:
          type: number
        total:
          type: number
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
security:
  - BearerAuth: [ ]
