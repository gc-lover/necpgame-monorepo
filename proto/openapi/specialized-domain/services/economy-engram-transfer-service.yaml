openapi: 3.0.3
info:
  title: Economy Engram Transfer Service API
  description: API для передачи энграмм между игроками
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8086/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер
tags:
  - name: Engram Transfer
    description: Передача энграмм между игроками
paths:
  /economy/engrams/{engram_id}/transfer:
    post:
      tags:
        - Engram Transfer
      summary: Передать энграмму другому игроку
      operationId: transferEngram
      security:
        - BearerAuth: [ ]
      parameters:
        - name: engram_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID энграммы
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferEngramRequest'
      responses:
        '200':
          description: Энграмма передана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransferEngramResponse'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '409':
          $ref: common.yaml#/components/responses/Conflict
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
  /economy/engrams/{engram_id}/loan:
    post:
      tags:
        - Engram Transfer
      summary: Одалжить энграмму другому игроку
      operationId: loanEngram
      security:
        - BearerAuth: [ ]
      parameters:
        - name: engram_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID энграммы
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoanEngramRequest'
      responses:
        '200':
          description: Энграмма одолжена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanEngramResponse'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '409':
          $ref: common.yaml#/components/responses/Conflict
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
  /economy/engrams/{engram_id}/extract:
    post:
      tags:
        - Engram Transfer
      summary: Принудительно извлечь энграмму (PvP)
      operationId: extractEngram
      security:
        - BearerAuth: [ ]
      parameters:
        - name: engram_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID энграммы
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExtractEngramRequest'
      responses:
        '200':
          description: Попытка извлечения выполнена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractEngramResponse'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
  /economy/engrams/{engram_id}/trade:
    post:
      tags:
        - Engram Transfer
      summary: Обменять/продать энграмму
      operationId: tradeEngram
      security:
        - BearerAuth: [ ]
      parameters:
        - name: engram_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID энграммы
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TradeEngramRequest'
      responses:
        '200':
          description: Торговля выполнена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeEngramResponse'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '401':
          $ref: common.yaml#/components/responses/Unauthorized
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    TransferEngramRequest:
      type: object
      required:
        - to_character_id
        - transfer_type
      properties:
        to_character_id:
          type: string
          format: uuid
          description: ID персонажа-получателя
        transfer_type:
          type: string
          enum:
            - voluntary
            - cooperative
            - forced
            - trade
          description: Тип передачи
        new_attitude_type:
          type: string
          enum:
            - aggressive
            - neutral
            - friendly
            - subservient
            - custom
          nullable: true
          description: Новый тип отношения к получателю
        transfer_price:
          type: number
          format: float
          nullable: true
          description: Цена передачи (если продажа)
        is_copy:
          type: boolean
          default: false
          description: Создать копию энграммы
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TransferEngramResponse:
      type: object
      required:
        - transfer_id
        - success
      properties:
        transfer_id:
          type: string
          format: uuid
          description: ID передачи
        new_engram_id:
          type: string
          format: uuid
          nullable: true
          description: ID новой энграммы (если копия)
        transferred_at:
          type: string
          format: date-time
          description: Время передачи
        success:
          type: boolean
          description: Успешно ли передана энграмма
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    LoanEngramRequest:
      type: object
      required:
        - to_character_id
        - loan_duration_days
      properties:
        to_character_id:
          type: string
          format: uuid
          description: ID персонажа-получателя
        loan_duration_days:
          type: integer
          minimum: 1
          maximum: 365
          description: Длительность одалживания (дни)
        non_conflict_settings:
          type: boolean
          default: true
          description: Настройки, чтобы энграмма не конфликтовала
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    LoanEngramResponse:
      type: object
      required:
        - loan_id
        - success
      properties:
        loan_id:
          type: string
          format: uuid
          description: ID одалживания
        temporary_engram_id:
          type: string
          format: uuid
          description: ID временной энграммы
        return_date:
          type: string
          format: date-time
          description: Дата возврата
        success:
          type: boolean
          description: Успешно ли одолжена энграмма
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ExtractEngramRequest:
      type: object
      required:
        - target_character_id
      properties:
        target_character_id:
          type: string
          format: uuid
          description: ID персонажа, у которого извлекается энграмма
        extraction_method:
          type: string
          enum:
            - from_inventory
            - from_installed
          description: Метод извлечения
        risk_level:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Риск извлечения (20-80%)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ExtractEngramResponse:
      type: object
      required:
        - extraction_id
        - success
      properties:
        extraction_id:
          type: string
          format: uuid
          description: ID извлечения
        extracted_engram_id:
          type: string
          format: uuid
          nullable: true
          description: ID извлечённой энграммы
        damage_percent:
          type: number
          format: float
          minimum: 0
          maximum: 100
          nullable: true
          description: Процент повреждения
        success:
          type: boolean
          description: Успешно ли извлечена энграмма
        engram_damaged:
          type: boolean
          description: Повреждена ли энграмма при извлечении
        target_character_died:
          type: boolean
          description: Умер ли целевой персонаж при извлечении
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TradeEngramRequest:
      type: object
      required:
        - trade_type
      properties:
        target_character_id:
          type: string
          format: uuid
          nullable: true
          description: ID персонажа для обмена
        exchange_item_id:
          type: string
          format: uuid
          nullable: true
          description: ID предмета для обмена
        trade_type:
          type: string
          enum:
            - sell
            - buy
            - exchange
          description: Тип торговли
        price:
          type: number
          format: float
          nullable: true
          description: Цена (если продажа)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TradeEngramResponse:
      type: object
      required:
        - trade_id
        - success
      properties:
        trade_id:
          type: string
          format: uuid
          description: ID торговли
        new_owner_id:
          type: string
          format: uuid
          nullable: true
          description: ID нового владельца
        traded_at:
          type: string
          format: date-time
          description: Время торговли
        success:
          type: boolean
          description: Успешно ли выполнена торговля
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
