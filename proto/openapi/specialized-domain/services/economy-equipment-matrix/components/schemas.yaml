components:
  securitySchemes:
    $ref: ../../../common-schemas.yaml#/components/securitySchemes
  schemas:
    ItemType:
      type: string
      enum:
      - WEAPON
      - IMPLANT
      - ARMOR
      - ACCESSORY
      description: Тип предмета.
    RarityCode:
      type: string
      enum:
      - COMMON
      - UNCOMMON
      - RARE
      - EPIC
      - LEGENDARY
      description: Класс редкости предмета.
    StatType:
      type: string
      enum:
      - DAMAGE
      - ACCURACY
      - RANGE
      - FIRE_RATE
      - RELOAD_SPEED
      - STABILITY
      - CRIT_CHANCE
      - CRIT_DAMAGE
      - HEAT_CAP
      - MOBILITY
      - HP
      - DR
      - PROC_CHANCE
      description: Тип характеристики.
    DistributionType:
      type: string
      enum:
      - UNIFORM
      - NORMAL
      - EXPONENTIAL
      description: Тип распределения значений стата.
    ModifierType:
      type: string
      enum:
      - DAMAGE_BOOST
      - CRIT_CHANCE
      - ELEMENTAL_DAMAGE
      - CONTROL
      - HEAT_REDUCTION
      - MOBILITY
      - SUPPORT
      description: Тип модификатора.
    CombatMode:
      type: string
      enum:
      - PVE
      - PVP
      - EXTRACT
      description: Режим для проверки баланса.
    Brand:
      type: object
      properties:
        id:
          type: string
          format: uuid
        code:
          type: string
          maxLength: 32
        name:
          type: string
          maxLength: 64
        tagline:
          type: string
          maxLength: 256
        faction:
          type: string
          maxLength: 64
        bonuses:
          type: array
          items:
            $ref: '#/components/schemas/BrandBonus'
        weaknesses:
          type: array
          items:
            type: string
            maxLength: 128
        unique_mods:
          type: array
          items:
            type: string
            maxLength: 128
      required:
      - id
      - name
      additionalProperties: false
      description: 'BRAND NOTE: fields ordered for struct alignment (large → small).



        BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    BrandBonus:
      type: object
      properties:
        stat:
          type: string
          maxLength: 64
        description:
          type: string
          maxLength: 256
        value:
          type: number
          format: float
      required:
      - stat
      - value
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Rarity:
      type: object
      properties:
        display_name:
          type: string
          maxLength: 32
        code:
          $ref: '#/components/schemas/RarityCode'
        mod_slots:
          type: integer
          format: int32
          minimum: 0
          maximum: 4
        guaranteed_min_level:
          type: integer
          format: int32
          minimum: 0
        weight:
          type: number
          format: float
          minimum: 0
      required:
      - code
      - display_name
      - weight
      - mod_slots
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StatPool:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          maxLength: 64
        distribution:
          $ref: '#/components/schemas/DistributionType'
        stat_type:
          $ref: '#/components/schemas/StatType'
        rarity_modifiers:
          type: array
          items:
            $ref: '#/components/schemas/RarityModifier'
        min_value:
          type: number
          format: float
        max_value:
          type: number
          format: float
      required:
      - id
      - name
      - stat_type
      - min_value
      - max_value
      - distribution
      additionalProperties: false
      description: 'BACKEND NOTE: large fields first for alignment.

        '
    RarityModifier:
      type: object
      properties:
        rarity:
          $ref: '#/components/schemas/RarityCode'
        multiplier:
          type: number
          format: float
          minimum: 0
      required:
      - rarity
      - multiplier
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Modifier:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          maxLength: 64
        restrictions:
          type: object
          additionalProperties: true
        modifier_type:
          $ref: '#/components/schemas/ModifierType'
        rarity:
          $ref: '#/components/schemas/RarityCode'
        compatibility:
          type: array
          items:
            type: string
            maxLength: 64
        value:
          type: number
          format: float
      required:
      - id
      - name
      - modifier_type
      - value
      - rarity
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EquipmentMatrix:
      type: object
      properties:
        id:
          type: string
          format: uuid
        brand_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        item_type:
          $ref: '#/components/schemas/ItemType'
        rarity:
          $ref: '#/components/schemas/RarityCode'
        stat_pools:
          type: array
          items:
            $ref: '#/components/schemas/StatPool'
        modifiers:
          type: array
          items:
            $ref: '#/components/schemas/Modifier'
        brand_bonuses:
          type: array
          items:
            $ref: '#/components/schemas/BrandBonus'
        version:
          type: integer
          format: int32
      required:
      - id
      - brand_id
      - item_type
      - rarity
      - stat_pools
      - modifiers
      - version
      - created_at
      - updated_at
      additionalProperties: false
      description: 'BACKEND NOTE: fields ordered for alignment; versioned matrix cached via Redis.

        '
    GenerateEquipmentRequest:
      type: object
      properties:
        brand_id:
          type: string
          format: uuid
          description: Целевой бренд; если не задан, выбирается по весам.
        stat_pool_id:
          type: string
          format: uuid
          description: Предпочтительный пул статов.
        seed:
          type: string
          maxLength: 64
        source:
          type: string
          maxLength: 64
          description: Источник генерации (loot, crafting, reward)
        mode:
          $ref: '#/components/schemas/CombatMode'
        item_type:
          $ref: '#/components/schemas/ItemType'
        rarity:
          $ref: '#/components/schemas/RarityCode'
        desired_modifiers:
          type: array
          items:
            type: string
            format: uuid
        level:
          type: integer
          format: int32
          minimum: 1
        desired_mod_slots:
          type: integer
          format: int32
          minimum: 0
          maximum: 4
        include_debug:
          type: boolean
          default: false
      required:
      - item_type
      additionalProperties: false
      description: 'BACKEND NOTE: deterministic seed supported; slots capped by rarity policy.

        '
    GeneratedItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        brand_id:
          type: string
          format: uuid
        seed:
          type: string
          maxLength: 64
        generated_at:
          type: string
          format: date-time
        stats:
          type: object
          additionalProperties:
            type: number
            format: float
        item_type:
          $ref: '#/components/schemas/ItemType'
        rarity:
          $ref: '#/components/schemas/RarityCode'
        modifiers:
          type: array
          items:
            $ref: '#/components/schemas/Modifier'
        mod_slots:
          type: integer
          format: int32
          minimum: 0
          maximum: 4
      required:
      - id
      - seed
      - brand_id
      - item_type
      - rarity
      - stats
      - modifiers
      - mod_slots
      - generated_at
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ValidateBalanceRequest:
      type: object
      properties:
        league:
          type: string
          maxLength: 32
        mode:
          $ref: '#/components/schemas/CombatMode'
        item:
          $ref: '#/components/schemas/GeneratedItem'
        target_ttk_seconds:
          type: number
          format: float
          minimum: 0
        heat_budget_percent:
          type: number
          format: float
          minimum: 0
        allow_exotic_core:
          type: boolean
      required:
      - item
      - mode
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    BalanceIssue:
      type: object
      properties:
        code:
          type: string
          maxLength: 64
        message:
          type: string
          maxLength: 256
        severity:
          type: string
          enum:
          - warning
          - error
      required:
      - code
      - message
      - severity
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    BalanceValidationResult:
      type: object
      properties:
        metrics:
          type: object
          additionalProperties:
            type: number
            format: float
        suggested_rarity:
          $ref: '#/components/schemas/RarityCode'
        issues:
          type: array
          items:
            $ref: '#/components/schemas/BalanceIssue'
        is_valid:
          type: boolean
      required:
      - is_valid
      - issues
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EquipmentMatrixListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/EquipmentMatrix'
        total:
          type: integer
          format: int32
          minimum: 0
      required:
      - items
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    BrandListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Brand'
      required:
      - items
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    RarityListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Rarity'
      required:
      - items
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StatPoolListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/StatPool'
      required:
      - items
      additionalProperties: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
