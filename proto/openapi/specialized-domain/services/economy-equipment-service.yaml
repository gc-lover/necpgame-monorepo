# Issue: #62
openapi: 3.0.3
info:
  title: Economy Equipment Service API
  description: |
    API для системы оборудования в NECPGAME.

    **Основные возможности:**
    - Каталог оборудования (ручной срез ключевых предметов)
    - Временная линия культового оборудования (Iconic Equipment Timeline)
    - Процедурная генерация оборудования
    - Управление матрицей характеристик
    - Аналитика оборудования

    **Интеграции:**
    - inventory-service - добавление предметов в инвентарь
    - economy-service - торговля оборудованием
    - gameplay-service - расчет характеристик
    - narrative-service - разблокировка культового через квесты
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8085/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

tags:
  - name: Equipment Catalog
    description: Каталог оборудования
  - name: Iconic Equipment
    description: Культовое оборудование
  - name: Equipment Matrix
    description: Процедурная матрица снаряжения
  - name: Equipment Analytics
    description: Аналитика оборудования

paths:
  /economy/equipment/catalog:
    get:
      tags:
        - Equipment Catalog
      summary: Получить каталог оборудования
      description: |
        Возвращает каталог оборудования с возможностью фильтрации.
      operationId: getEquipmentCatalog
      security:
        - BearerAuth: [ ]
      parameters:
        - name: category
          in: query
          schema:
            type: string
          description: Фильтр по категории
        - name: brand_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по бренду
        - name: rarity
          in: query
          schema:
            $ref: "#/components/schemas/EquipmentRarity"
          description: Фильтр по редкости
        - $ref: "common.yaml#/components/parameters/Limit"
        - $ref: "common.yaml#/components/parameters/Offset"
      responses:
        "200":
          description: Каталог оборудования
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/CatalogItem"
                  total:
                    type: integer
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/catalog/{id}:
    get:
      tags:
        - Equipment Catalog
      summary: Получить предмет из каталога
      description: |
        Возвращает детальную информацию о предмете из каталога.
      operationId: getCatalogItem
      security:
        - BearerAuth: [ ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор предмета
      responses:
        "200":
          description: Информация о предмете
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CatalogItem"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "common.yaml#/components/responses/NotFound"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/iconic/timeline:
    get:
      tags:
        - Iconic Equipment
      summary: Получить временную линию культового оборудования
      description: |
        Возвращает временную линию культового оборудования по годам (2020-2093).
      operationId: getIconicTimeline
      security:
        - BearerAuth: [ ]
      parameters:
        - name: year
          in: query
          schema:
            type: integer
            minimum: 2020
            maximum: 2093
          description: Фильтр по году
        - name: unlocked_only
          in: query
          schema:
            type: boolean
          description: Только разблокированное оборудование
        - $ref: "common.yaml#/components/parameters/Limit"
        - $ref: "common.yaml#/components/parameters/Offset"
      responses:
        "200":
          description: Временная линия культового оборудования
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/IconicItem"
                  total:
                    type: integer
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/iconic/{id}:
    get:
      tags:
        - Iconic Equipment
      summary: Получить культовый предмет
      description: |
        Возвращает детальную информацию о культовом предмете.
      operationId: getIconicItem
      security:
        - BearerAuth: [ ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор культового предмета
      responses:
        "200":
          description: Информация о культовом предмете
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IconicItem"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "404":
          $ref: "common.yaml#/components/responses/NotFound"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/analytics:
    get:
      tags:
        - Equipment Analytics
      summary: Получить аналитику оборудования
      description: |
        Возвращает аналитику по использованию оборудования.
      operationId: getEquipmentAnalytics
      security:
        - BearerAuth: [ ]
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [ day, week, month, year ]
          description: Период аналитики
        - name: category
          in: query
          schema:
            type: string
          description: Фильтр по категории
      responses:
        "200":
          description: Аналитика оборудования
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EquipmentAnalytics"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/generate:
    post:
      tags:
        - Equipment Matrix
      summary: Генерация предмета процедурно
      operationId: generateEquipment
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateEquipmentRequest"
      responses:
        "200":
          description: Предмет сгенерирован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GeneratedItem"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/matrix:
    get:
      tags:
        - Equipment Matrix
      summary: Получить матрицу характеристик
      operationId: getEquipmentMatrix
      security:
        - BearerAuth: [ ]
      parameters:
        - name: brand_id
          in: query
          schema:
            type: string
            format: uuid
        - name: item_type
          in: query
          schema:
            $ref: "#/components/schemas/EquipmentItemType"
        - name: rarity
          in: query
          schema:
            $ref: "#/components/schemas/EquipmentRarity"
      responses:
        "200":
          description: Матрица характеристик
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EquipmentMatrix"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/brands:
    get:
      tags:
        - Equipment Matrix
      summary: Получить список брендов
      operationId: getEquipmentBrands
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Список брендов
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BrandsListResponse"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/rarities:
    get:
      tags:
        - Equipment Matrix
      summary: Получить список редкостей
      operationId: getEquipmentRarities
      security:
        - BearerAuth: [ ]
      responses:
        "200":
          description: Список редкостей
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RaritiesListResponse"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/stat-pools:
    get:
      tags:
        - Equipment Matrix
      summary: Получить пулы характеристик
      operationId: getStatPools
      security:
        - BearerAuth: [ ]
      parameters:
        - name: item_type
          in: query
          schema:
            $ref: "#/components/schemas/EquipmentItemType"
      responses:
        "200":
          description: Список пулов характеристик
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatPoolsListResponse"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

  /economy/equipment/validate-balance:
    post:
      tags:
        - Equipment Matrix
      summary: Валидация баланса предмета
      operationId: validateEquipmentBalance
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ValidateBalanceRequest"
      responses:
        "200":
          description: Результат валидации баланса
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BalanceValidationResult"
        "400":
          $ref: "common.yaml#/components/responses/BadRequest"
        "401":
          $ref: "common.yaml#/components/responses/Unauthorized"
        "500":
          $ref: "common.yaml#/components/responses/InternalServerError"

components:
  securitySchemes:
    BearerAuth:
      $ref: "common.yaml#/components/securitySchemes/BearerAuth"

  schemas:
    GenerateEquipmentRequest:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/GenerateEquipmentRequest'
    GeneratedItem:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/GeneratedItem'
    EquipmentItemType:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/EquipmentItemType'
    EquipmentRarity:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/EquipmentRarity'
    EquipmentMatrix:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/EquipmentMatrix'
    StatPool:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/StatPool'
    StatType:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/StatType'
    StatDistribution:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/StatDistribution'
    Modifier:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/Modifier'
    ModifierType:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/ModifierType'
    Brand:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/Brand'
    BrandsListResponse:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/BrandsListResponse'
    Rarity:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/Rarity'
    RaritiesListResponse:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/RaritiesListResponse'
    StatPoolsListResponse:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/StatPoolsListResponse'
    ValidateBalanceRequest:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/ValidateBalanceRequest'
    BalanceValidationResult:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/BalanceValidationResult'
    CatalogItem:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/CatalogItem'
    IconicItem:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/IconicItem'
    EquipmentAnalytics:
      $ref: 'economy-equipment-schemas.yaml#/components/schemas/EquipmentAnalytics'

security:
  - BearerAuth: [ ]
