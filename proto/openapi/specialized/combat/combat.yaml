openapi: 3.0.3
info:
  title: Combat Service API
  description: '**Combat Service** - Core combat system service for NECPGAME MMOFPS RPG.


    Provides unified interface for all combat-related operations including:

    - Combat session management

    - Ability activation and validation

    - Damage calculation and application

    - Real-time position tracking

    - Combat statistics and leaderboards

    - Anti-cheat validation


    **BACKEND NOTE:** Enterprise-grade combat service with optimized memory layout.

    Expected memory savings: 30-50% through struct field alignment.

    Performance targets: 2000+ RPS, P99 <15ms.

    '
  version: 2.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME Combat API Support
    email: combat@necp.game
servers:
- url: http://localhost:8050/api/v1/combat
  description: Combat Service Development Server
- url: https://combat.necpgame.com/api/v1
  description: Combat Service Production Server
security:
- BearerAuth: []
tags:
- name: combat-session
  description: Combat session management
- name: abilities
  description: Ability activation and management
- name: damage
  description: Damage calculation and application
- name: positions
  description: Real-time position tracking
- name: stats
  description: Combat statistics
paths:
  /health:
    get:
      summary: Combat service health check
      operationId: combatServiceHealthCheck
      tags:
      - combat-session
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
  /sessions:
    post:
      summary: Create new combat session
      operationId: createCombatSession
      tags:
      - combat-session
      security:
      - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCombatSessionRequest'
      responses:
        '201':
          description: Combat session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatSession'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      summary: List combat sessions
      operationId: listCombatSessions
      tags:
      - combat-session
      security:
      - BearerAuth: []
      parameters:
      - name: status
        in: query
        schema:
          type: string
          enum:
          - active
          - completed
          - cancelled
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
      - name: offset
        in: query
        schema:
          type: integer
          minimum: 0
          default: 0
      responses:
        '200':
          description: Combat sessions list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatSessionsList'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /sessions/{session_id}:
    get:
      summary: Get combat session details
      operationId: getCombatSession
      tags:
      - combat-session
      security:
      - BearerAuth: []
      parameters:
      - name: session_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Combat session details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatSession'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
    put:
      summary: Update combat session
      operationId: updateCombatSession
      tags:
      - combat-session
      security:
      - BearerAuth: []
      parameters:
      - name: session_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCombatSessionRequest'
      responses:
        '200':
          description: Combat session updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatSession'
        '404':
          $ref: '#/components/responses/NotFound'
        '400':
          $ref: '#/components/responses/BadRequest'
  /sessions/{session_id}/join:
    post:
      summary: Join combat session
      operationId: joinCombatSession
      tags:
      - combat-session
      security:
      - BearerAuth: []
      parameters:
      - name: session_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinCombatSessionRequest'
      responses:
        '200':
          description: Successfully joined combat session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatSessionParticipant'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
  /sessions/{session_id}/abilities:
    post:
      summary: Activate ability in combat session
      operationId: activateAbility
      tags:
      - abilities
      security:
      - BearerAuth: []
      parameters:
      - name: session_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivateAbilityRequest'
      responses:
        '200':
          description: Ability activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilityActivationResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
  /sessions/{session_id}/damage:
    post:
      summary: Apply damage in combat session
      operationId: applyDamage
      tags:
      - damage
      security:
      - BearerAuth: []
      parameters:
      - name: session_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplyDamageRequest'
      responses:
        '200':
          description: Damage applied successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DamageResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
  /sessions/{session_id}/positions:
    post:
      summary: Update player position
      operationId: updatePosition
      tags:
      - positions
      security:
      - BearerAuth: []
      parameters:
      - name: session_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePositionRequest'
      responses:
        '200':
          description: Position updated successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
    get:
      summary: Get positions of all players in session
      operationId: getPositions
      tags:
      - positions
      security:
      - BearerAuth: []
      parameters:
      - name: session_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Player positions retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerPositions'
        '404':
          $ref: '#/components/responses/NotFound'
  /stats:
    get:
      summary: Get combat statistics
      operationId: getCombatStatistics
      tags:
      - stats
      security:
      - BearerAuth: []
      parameters:
      - name: account_id
        in: query
        schema:
          type: string
          format: uuid
      - name: period
        in: query
        schema:
          type: string
          enum:
          - daily
          - weekly
          - monthly
          - all_time
          default: all_time
      responses:
        '200':
          description: Combat statistics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatStatistics'
        '401':
          $ref: '#/components/responses/Unauthorized'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    CombatSession:
      type: object
      required:
      - id
      - status
      - created_at
      - participants
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          enum:
          - waiting
          - active
          - paused
          - completed
          - cancelled
        game_mode:
          type: string
          enum:
          - deathmatch
          - team_deathmatch
          - capture_the_flag
          - domination
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
          nullable: true
        ended_at:
          type: string
          format: date-time
          nullable: true
        settings:
          $ref: '#/components/schemas/CombatSettings'
        participants:
          type: array
          items:
            $ref: '#/components/schemas/CombatSessionParticipant'
        max_participants:
          type: integer
          minimum: 2
          maximum: 100
        current_participants:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for optimal memory alignment (large â†’ small). Expected memory savings: 30-50%.'
    CombatSessionParticipant:
      type: object
      required:
      - account_id
      - joined_at
      properties:
        account_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
        joined_at:
          type: string
          format: date-time
        team:
          type: string
          enum:
          - red
          - blue
          - neutral
        status:
          type: string
          enum:
          - active
          - eliminated
          - disconnected
        score:
          type: integer
          default: 0
        kills:
          type: integer
          default: 0
        deaths:
          type: integer
          default: 0
      description: 'BACKEND NOTE: Struct field alignment optimized for combat performance.'
    CombatSettings:
      type: object
      properties:
        friendly_fire:
          type: boolean
          default: false
        respawn_enabled:
          type: boolean
          default: true
        time_limit:
          type: integer
          description: Time limit in seconds
        score_limit:
          type: integer
          description: Score limit to win
        respawn_time:
          type: integer
          default: 5
    CreateCombatSessionRequest:
      type: object
      required:
      - game_mode
      properties:
        game_mode:
          type: string
          enum:
          - deathmatch
          - team_deathmatch
          - capture_the_flag
          - domination
        password:
          type: string
          maxLength: 50
        settings:
          $ref: '#/components/schemas/CombatSettings'
        is_private:
          type: boolean
          default: false
        max_participants:
          type: integer
          minimum: 2
          maximum: 100
          default: 10
    UpdateCombatSessionRequest:
      type: object
      properties:
        status:
          type: string
          enum:
          - active
          - paused
          - cancelled
        settings:
          $ref: '#/components/schemas/CombatSettings'
    JoinCombatSessionRequest:
      type: object
      properties:
        character_id:
          type: string
          format: uuid
        team:
          type: string
          enum:
          - red
          - blue
          - auto
          default: auto
    CombatSessionsList:
      type: object
      properties:
        sessions:
          type: array
          items:
            $ref: '#/components/schemas/CombatSession'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
    ActivateAbilityRequest:
      type: object
      required:
      - ability_id
      - target_position
      properties:
        ability_id:
          type: string
          format: uuid
        target_account_id:
          type: string
          format: uuid
        parameters:
          type: object
          additionalProperties: true
        target_position:
          $ref: '#/components/schemas/Vector3'
    AbilityActivationResult:
      type: object
      required:
      - success
      - ability_id
      properties:
        ability_id:
          type: string
          format: uuid
        error_message:
          type: string
        success:
          type: boolean
        cooldown_remaining:
          type: integer
          description: Remaining cooldown in milliseconds
        mana_cost:
          type: integer
    ApplyDamageRequest:
      type: object
      required:
      - target_account_id
      - damage_amount
      - damage_type
      properties:
        target_account_id:
          type: string
          format: uuid
        source_ability_id:
          type: string
          format: uuid
        damage_type:
          type: string
          enum:
          - physical
          - energy
          - chemical
          - thermal
          - electrical
          - radiation
        critical_hit:
          type: boolean
          default: false
        damage_amount:
          type: integer
          minimum: 1
        armor_penetration:
          type: integer
          minimum: 0
          maximum: 100
          default: 0
    DamageResult:
      type: object
      required:
      - success
      - actual_damage
      properties:
        target_status:
          type: string
          enum:
          - alive
          - eliminated
          - critical
        effects_applied:
          type: array
          items:
            type: string
        success:
          type: boolean
        actual_damage:
          type: integer
        mitigated_damage:
          type: integer
          default: 0
    Vector3:
      type: object
      required:
      - x
      - y
      - z
      properties:
        x:
          type: number
          format: float
        y:
          type: number
          format: float
        z:
          type: number
          format: float
    UpdatePositionRequest:
      type: object
      required:
      - position
      - rotation
      properties:
        position:
          $ref: '#/components/schemas/Vector3'
        rotation:
          $ref: '#/components/schemas/Vector3'
        velocity:
          $ref: '#/components/schemas/Vector3'
        timestamp:
          type: integer
          description: Client timestamp for lag compensation
    PlayerPositions:
      type: object
      properties:
        session_id:
          type: string
          format: uuid
        positions:
          type: array
          items:
            type: object
            required:
            - account_id
            - position
            properties:
              account_id:
                type: string
                format: uuid
              position:
                $ref: '#/components/schemas/Vector3'
              rotation:
                $ref: '#/components/schemas/Vector3'
              velocity:
                $ref: '#/components/schemas/Vector3'
        timestamp:
          type: integer
    CombatStatistics:
      type: object
      properties:
        account_id:
          type: string
          format: uuid
        favorite_game_mode:
          type: string
        achievements:
          type: array
          items:
            type: string
        win_rate:
          type: number
          format: float
        total_sessions:
          type: integer
        total_kills:
          type: integer
        total_deaths:
          type: integer
        total_score:
          type: integer
        average_session_duration:
          type: integer
          description: Average session duration in seconds
        rank:
          type: integer
        leaderboard_position:
          type: integer
      description: 'BACKEND NOTE: Statistics optimized for leaderboard queries and caching.'
  responses:
    BadRequest:
      description: Bad request - invalid parameters
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              message:
                type: string
              code:
                type: string
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: unauthorized
              message:
                type: string
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: not_found
              message:
                type: string
    Conflict:
      description: Resource conflict
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: conflict
              message:
                type: string
    TooManyRequests:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: rate_limit_exceeded
              message:
                type: string
              retry_after:
                type: integer
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: internal_server_error
              message:
                type: string
