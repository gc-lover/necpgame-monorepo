openapi: 3.0.3
info:
  title: Combat Sandevistan Service API
  description: 'API для управления имплантом Sandevistan - временной овердрайв системы.


    Функционал:

    - Активация и деактивация Sandevistan

    - Управление фазами (подготовка, активная, рекуперация)

    - Action Priority Budget

    - Перегрев и охлаждение

    - Temporal Marks (пометка целей)

    - Temporal Overdrive (расширенная активация)

    - Контрплей механики

    '
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
- url: http://localhost:8080/api/v1
  description: Локальный сервер разработки
- url: https://api.necp.game/api/v1
  description: Продакшен сервер
tags:
- name: sandevistan
  description: Операции с Sandevistan имплантом
- name: cooling
  description: Управление охлаждением
paths:
  /combat/players/{player_id}/sandevistan/activate:
    post:
      tags:
      - sandevistan
      summary: Активировать Sandevistan
      operationId: activateSandevistan
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Sandevistan активирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SandevistanActivation'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Невозможно активировать (перегрев или кулдаун)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/deactivate:
    post:
      tags:
      - sandevistan
      summary: Досрочно деактивировать Sandevistan
      operationId: deactivateSandevistan
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Sandevistan деактивирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/status:
    get:
      tags:
      - sandevistan
      summary: Получить статус Sandevistan
      operationId: getSandevistanStatus
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Статус успешно получен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SandevistanStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/action-budget:
    post:
      tags:
      - sandevistan
      summary: Использовать Action Budget
      operationId: useActionBudget
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - actions
              properties:
                actions:
                  type: array
                  maxItems: 3
                  items:
                    $ref: '#/components/schemas/Action'
      responses:
        '200':
          description: Действия выполнены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionBudgetResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Action Budget исчерпан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/temporal-marks:
    post:
      tags:
      - sandevistan
      summary: Установить Temporal Marks на цели
      operationId: setTemporalMarks
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - target_ids
              properties:
                target_ids:
                  type: array
                  maxItems: 3
                  items:
                    type: string
                    format: uuid
      responses:
        '201':
          description: Temporal Marks установлены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
      - sandevistan
      summary: Получить активные Temporal Marks
      operationId: getTemporalMarks
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Список Temporal Marks
          content:
            application/json:
              schema:
                type: object
                properties:
                  marks:
                    type: array
                    items:
                      $ref: '#/components/schemas/TemporalMark'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/apply-temporal-marks:
    post:
      tags:
      - sandevistan
      summary: Применить Temporal Marks (delayed burst damage)
      operationId: applyTemporalMarks
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Temporal Marks применены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemporalMarksApplied'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/temporal-overdrive:
    post:
      tags:
      - sandevistan
      summary: Активировать Temporal Overdrive (расширенный Sandevistan)
      operationId: activateTemporalOverdrive
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemporalOverdriveRequest'
      responses:
        '200':
          description: Temporal Overdrive активирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemporalOverdriveActivation'
        '400':
          description: Неверный запрос или недостаточно ресурсов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          description: Слишком частые активации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/bonuses:
    get:
      tags:
      - sandevistan
      summary: Получить текущие бонусы Sandevistan
      operationId: getSandevistanBonuses
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Текущие бонусы Sandevistan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SandevistanBonuses'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/perception-drag:
    post:
      tags:
      - sandevistan
      summary: Опубликовать Perception Drag событие
      operationId: publishPerceptionDragEvent
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока с Sandevistan
        example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PerceptionDragEvent'
      responses:
        '200':
          description: Perception Drag событие опубликовано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/cooling:
    post:
      tags:
      - cooling
      summary: Использовать охлаждающий картридж
      operationId: applyCoolingCartridge
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - cartridge_id
              properties:
                cartridge_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Охлаждение применено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CoolingResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/heat:
    get:
      tags:
      - cooling
      summary: Получить статус перегрева
      operationId: getHeatStatus
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Статус перегрева
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HeatStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/players/{player_id}/sandevistan/counterplay:
    post:
      tags:
      - sandevistan
      summary: Применить контрплей эффект
      description: Chrono-Jammer, EMP или dilation_break
      operationId: applyCounterplay
      security:
      - BearerAuth: []
      parameters:
      - name: player_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Идентификатор игрока
        example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - effect_type
              - source_player_id
              properties:
                effect_type:
                  type: string
                  enum:
                  - chrono_jammer
                  - emp
                  - dilation_break
                source_player_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Контрплей применен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CounterplayResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
  schemas:
    Error:
      type: object
      required:
      - error
      - code
      properties:
        error:
          type: string
          description: Error message
        timestamp:
          type: string
          format: date-time
        details:
          type: object
          description: Additional error details
        code:
          type: integer
          minimum: 1000
          description: Error code
      description: 'BACKEND NOTE: Standard error response schema.'
    StatusResponse:
      type: object
      properties:
        status:
          type: string
          enum:
          - ok
          - error
          example: ok
        timestamp:
          type: string
          format: date-time
      description: 'BACKEND NOTE: Standard status response schema.'
    SandevistanActivation:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/SandevistanActivation
    SandevistanStatus:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/SandevistanStatus
    Action:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/Action
    ActionBudgetResult:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/ActionBudgetResult
    TemporalMark:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/TemporalMark
    CoolingResult:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/CoolingResult
    HeatStatus:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/HeatStatus
    CounterplayResult:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/CounterplayResult
    TemporalMarksApplied:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/TemporalMarksApplied
    SandevistanBonuses:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/SandevistanBonuses
    PerceptionDragEvent:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/PerceptionDragEvent
    TemporalOverdriveRequest:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/TemporalOverdriveRequest
    TemporalOverdriveActivation:
      $ref: combat-sandevistan-service-schemas.yaml#/components/schemas/TemporalOverdriveActivation
security:
- BearerAuth: []
