openapi: 3.0.3
info:
  title: Analytics Combat Abilities Service API
  description: 'API для статистики способностей.

    **Основные возможности:**

    - Статистика способностей (использование, эффективность)

    '
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
- url: http://localhost:8089/api/v1/analytics
  description: Локальный сервер разработки
- url: https://api.necp.game/api/v1/analytics
  description: Продакшен сервер
tags:
- name: Abilities Stats
  description: Статистика способностей
paths:
  /combat/abilities/stats:
    get:
      tags:
      - Abilities Stats
      summary: Получить статистику способностей
      description: 'Возвращает общую статистику по способностям: общее использование,

        средняя эффективность и другие метрики.

        '
      operationId: getAbilitiesStats
      security:
      - BearerAuth: []
      parameters:
      - name: start_date
        in: query
        required: false
        description: Начальная дата периода
        schema:
          type: string
          format: date-time
      - name: end_date
        in: query
        required: false
        description: Конечная дата периода
        schema:
          type: string
          format: date-time
      - name: mode
        in: query
        required: false
        description: Фильтр по игровому режиму
        schema:
          $ref: analytics-combat-schemas.yaml#/components/schemas/GameMode
      responses:
        '200':
          description: Статистика способностей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilitiesStats'
              example:
                total_uses: 1000000
                unique_abilities: 50
                average_effectiveness: 0.68
                average_cooldown_usage: 0.75
        '400':
          $ref: ../../../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../../../common-schemas.yaml#/components/responses/InternalServerError
  /combat/abilities/usage:
    get:
      tags:
      - Abilities Stats
      summary: Получить статистику использования способностей
      description: 'Возвращает статистику использования способностей: частота использования,

        популярность и другие метрики.

        '
      operationId: getAbilitiesUsage
      security:
      - BearerAuth: []
      parameters:
      - name: ability_id
        in: query
        required: false
        description: Фильтр по способности
        schema:
          type: string
          format: uuid
      - name: start_date
        in: query
        required: false
        description: Начальная дата периода
        schema:
          type: string
          format: date-time
      - name: end_date
        in: query
        required: false
        description: Конечная дата периода
        schema:
          type: string
          format: date-time
      - name: limit
        in: query
        required: false
        description: Лимит результатов
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
      - name: offset
        in: query
        required: false
        description: Смещение для пагинации
        schema:
          type: integer
          minimum: 0
          default: 0
      responses:
        '200':
          description: Статистика использования способностей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilitiesUsageResponse'
              example:
                abilities:
                - ability_id: bb0e8400-e29b-41d4-a716-446655440000
                  ability_name: Cyber Strike
                  total_uses: 50000
                  usage_rate: 0.05
                  pick_rate: 0.12
                  average_damage: 150.5
                total: 50
        '400':
          $ref: ../../../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../../../common-schemas.yaml#/components/responses/InternalServerError
  /combat/abilities/effectiveness:
    get:
      tags:
      - Abilities Stats
      summary: Получить статистику эффективности способностей
      description: 'Возвращает метрики эффективности способностей: средний урон,

        коэффициент убийств, успешность использования.

        '
      operationId: getAbilitiesEffectiveness
      security:
      - BearerAuth: []
      parameters:
      - name: ability_id
        in: query
        required: false
        description: Фильтр по способности
        schema:
          type: string
          format: uuid
      - name: start_date
        in: query
        required: false
        description: Начальная дата периода
        schema:
          type: string
          format: date-time
      - name: end_date
        in: query
        required: false
        description: Конечная дата периода
        schema:
          type: string
          format: date-time
      responses:
        '200':
          description: Статистика эффективности способностей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilitiesEffectivenessResponse'
              example:
                ability_id: bb0e8400-e29b-41d4-a716-446655440000
                ability_name: Cyber Strike
                average_damage: 150.5
                average_dps: 75.2
                kill_contribution: 0.15
                success_rate: 0.82
                sample_count: 50000
        '400':
          $ref: ../../../../common-schemas.yaml#/components/responses/BadRequest
        '401':
          $ref: ../../../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../../../common-schemas.yaml#/components/responses/InternalServerError
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    AbilitiesStats:
      type: object
      required:
      - total_uses
      - unique_abilities
      - average_effectiveness
      properties:
        average_effectiveness:
          type: number
          format: float
          description: Средняя эффективность (0.0-1.0)
          minimum: 0.0
          maximum: 1.0
          example: 0.68
        average_cooldown_usage:
          type: number
          format: float
          description: Средний процент использования кулдаунов
          minimum: 0.0
          maximum: 1.0
          example: 0.75
        total_uses:
          type: integer
          description: Общее количество использований
          minimum: 0
          example: 1000000
        unique_abilities:
          type: integer
          description: Количество уникальных способностей
          minimum: 0
          example: 50
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilitiesUsageResponse:
      type: object
      required:
      - abilities
      - total
      properties:
        abilities:
          type: array
          items:
            $ref: '#/components/schemas/AbilityUsage'
        total:
          type: integer
          minimum: 0
          example: 50
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilityUsage:
      type: object
      required:
      - ability_id
      - ability_name
      - total_uses
      - usage_rate
      - pick_rate
      - average_damage
      properties:
        ability_id:
          type: string
          format: uuid
          example: bb0e8400-e29b-41d4-a716-446655440000
        ability_name:
          type: string
          example: Cyber Strike
        usage_rate:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          example: 0.05
        pick_rate:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          example: 0.12
        average_damage:
          type: number
          format: float
          minimum: 0
          example: 150.5
        total_uses:
          type: integer
          minimum: 0
          example: 50000
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilitiesEffectivenessResponse:
      type: object
      required:
      - ability_id
      - ability_name
      - average_damage
      - average_dps
      - kill_contribution
      - success_rate
      - sample_count
      properties:
        ability_id:
          type: string
          format: uuid
          example: bb0e8400-e29b-41d4-a716-446655440000
        ability_name:
          type: string
          example: Cyber Strike
        average_damage:
          type: number
          format: float
          minimum: 0
          example: 150.5
        average_dps:
          type: number
          format: float
          minimum: 0
          example: 75.2
        kill_contribution:
          type: number
          format: float
          description: Вклад в убийства (0.0-1.0)
          minimum: 0.0
          maximum: 1.0
          example: 0.15
        success_rate:
          type: number
          format: float
          description: Процент успешных использований
          minimum: 0.0
          maximum: 1.0
          example: 0.82
        sample_count:
          type: integer
          minimum: 0
          example: 50000
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
  responses:
    BadRequest:
      $ref: ../../../../common-schemas.yaml#/components/responses/BadRequest
    Unauthorized:
      $ref: common.yaml#/components/responses/Unauthorized
    InternalServerError:
      $ref: common.yaml#/components/responses/InternalServerError
