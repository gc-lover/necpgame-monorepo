components:
  schemas:
    SubscriptionAnalytics:
      type: object
      required:
      - timeframe
      - total_subscriptions
      - active_subscriptions
      - subscription_lifecycle
      - pattern_usage
      properties:
        timeframe:
          type: string
          enum:
          - 1h
          - 6h
          - 24h
          - 7d
          description: Analytics timeframe
        subscription_lifecycle:
          type: object
          description: Subscription lifecycle statistics
          properties:
            created:
              type: integer
              description: Subscriptions created
              example: 5000
            expired:
              type: integer
              description: Subscriptions expired
              example: 800
            manually_deleted:
              type: integer
              description: Manually deleted subscriptions
              example: 1200
            failed:
              type: integer
              description: Failed subscriptions
              example: 50
            avg_lifetime_hours:
              type: number
              format: float
              description: Average subscription lifetime
              example: 24.5
        pattern_usage:
          type: object
          description: Pattern usage statistics
          properties:
            total_patterns:
              type: integer
              description: Total patterns across all subscriptions
              example: 15000
            unique_patterns:
              type: integer
              description: Unique pattern strings
              example: 2500
            patterns_by_type:
              type: object
              description: Patterns grouped by matching type
              properties:
                exact:
                  type: integer
                  example: 8000
                wildcard:
                  type: integer
                  example: 5000
                regex:
                  type: integer
                  example: 1500
                jsonpath:
                  type: integer
                  example: 500
            most_used_patterns:
              type: array
              items:
                type: object
                properties:
                  pattern:
                    type: string
                    example: combat.*
                  usage_count:
                    type: integer
                    example: 850
                  subscription_count:
                    type: integer
                    example: 650
              maxItems: 20
              description: Top 20 most used patterns
        event_delivery:
          type: object
          description: Event delivery analytics
          properties:
            events_delivered:
              type: integer
              description: Total events successfully delivered
              example: 2500000
            events_failed:
              type: integer
              description: Total delivery failures
              example: 15000
            delivery_success_rate:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Delivery success rate
              example: 0.994
            avg_delivery_latency_ms:
              type: number
              format: float
              description: Average delivery latency
              example: 45.2
            events_by_type:
              type: object
              description: Events delivered by type
              additionalProperties:
                type: integer
              example:
                combat.player_hit: 800000
                social.chat_message: 1200000
                system.notification: 300000
                economy.transaction: 200000
        connection_analytics:
          type: object
          description: WebSocket connection analytics
          properties:
            total_connections:
              type: integer
              description: Total connections handled
              example: 15000
            avg_connection_duration_hours:
              type: number
              format: float
              description: Average connection duration
              example: 2.5
            connection_success_rate:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Connection success rate
              example: 0.985
            reconnections_per_connection:
              type: number
              format: float
              description: Average reconnections per connection
              example: 0.15
        performance_metrics:
          type: object
          description: System performance metrics
          properties:
            pattern_matching_time_ns:
              type: integer
              description: Average pattern matching time
              example: 2500
            subscription_lookup_time_ns:
              type: integer
              description: Average subscription lookup time
              example: 1500
            event_routing_time_ns:
              type: integer
              description: Average event routing time
              example: 800
            memory_usage_mb:
              type: integer
              description: Current memory usage
              example: 512
            cpu_usage_percent:
              type: number
              format: float
              description: CPU usage percentage
              example: 65.5
        user_engagement:
          type: object
          description: User engagement metrics
          properties:
            unique_users:
              type: integer
              description: Unique users with subscriptions
              example: 8500
            avg_subscriptions_per_user:
              type: number
              format: float
              description: Average subscriptions per user
              example: 3.2
            most_active_users:
              type: array
              items:
                type: object
                properties:
                  user_id:
                    type: string
                    format: uuid
                  events_received:
                    type: integer
                  subscriptions_count:
                    type: integer
              maxItems: 10
              description: Top 10 most active users
            engagement_by_platform:
              type: object
              description: Engagement metrics by platform
              additionalProperties:
                type: object
                properties:
                  users:
                    type: integer
                  avg_session_hours:
                    type: number
                    format: float
              example:
                web:
                  users: 6500
                  avg_session_hours: 3.2
                mobile:
                  users: 1500
                  avg_session_hours: 2.8
                desktop:
                  users: 500
                  avg_session_hours: 4.1
        total_subscriptions:
          type: integer
          minimum: 0
          description: Total subscriptions created in timeframe
          example: 5000
        active_subscriptions:
          type: integer
          minimum: 0
          description: Currently active subscriptions
          example: 3200
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PerformanceMetrics:
      type: object
      required:
      - timestamp
      - system_health
      - throughput
      - latency
      - resource_usage
      properties:
        timestamp:
          type: string
          format: date-time
          description: Metrics timestamp
          example: '2025-12-20T21:49:00Z'
        system_health:
          type: object
          description: Overall system health indicators
          properties:
            status:
              type: string
              enum:
              - healthy
              - degraded
              - critical
              description: System health status
              example: healthy
            active_connections:
              type: integer
              description: Active WebSocket connections
              example: 8500
            active_subscriptions:
              type: integer
              description: Active subscriptions
              example: 3200
            error_rate_percent:
              type: number
              format: float
              minimum: 0
              maximum: 100
              description: Current error rate
              example: 0.5
        throughput:
          type: object
          description: System throughput metrics
          properties:
            events_per_second:
              type: number
              format: float
              description: Events processed per second
              example: 2500.5
            subscriptions_created_per_minute:
              type: number
              format: float
              description: New subscriptions per minute
              example: 12.3
            connections_per_minute:
              type: number
              format: float
              description: New connections per minute
              example: 45.8
            peak_events_per_second:
              type: number
              format: float
              description: Peak EPS in last hour
              example: 3200.0
        latency:
          type: object
          description: System latency metrics
          properties:
            avg_event_delivery_ms:
              type: number
              format: float
              description: Average event delivery latency
              example: 45.2
            p95_event_delivery_ms:
              type: number
              format: float
              description: 95th percentile delivery latency
              example: 120.5
            p99_event_delivery_ms:
              type: number
              format: float
              description: 99th percentile delivery latency
              example: 250.8
            avg_pattern_matching_ns:
              type: integer
              description: Average pattern matching time
              example: 2500
            avg_subscription_lookup_ns:
              type: integer
              description: Average subscription lookup time
              example: 1500
        resource_usage:
          type: object
          description: System resource usage
          properties:
            memory_usage_mb:
              type: integer
              description: Current memory usage
              example: 512
            memory_usage_percent:
              type: number
              format: float
              minimum: 0
              maximum: 100
              description: Memory usage percentage
              example: 65.5
            cpu_usage_percent:
              type: number
              format: float
              minimum: 0
              maximum: 100
              description: CPU usage percentage
              example: 72.3
            disk_usage_gb:
              type: number
              format: float
              description: Disk usage in GB
              example: 25.8
            network_in_mbps:
              type: number
              format: float
              description: Network inbound traffic
              example: 150.5
            network_out_mbps:
              type: number
              format: float
              description: Network outbound traffic
              example: 200.8
        queue_metrics:
          type: object
          description: Internal queue metrics
          properties:
            event_queue_depth:
              type: integer
              description: Current event queue depth
              example: 150
            subscription_queue_depth:
              type: integer
              description: Current subscription queue depth
              example: 25
            avg_queue_wait_time_ms:
              type: number
              format: float
              description: Average queue wait time
              example: 12.5
            queue_overflow_events:
              type: integer
              description: Queue overflow events in last hour
              example: 0
        cache_metrics:
          type: object
          description: Cache performance metrics
          properties:
            pattern_cache_hit_rate:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Pattern cache hit rate
              example: 0.985
            subscription_cache_hit_rate:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Subscription cache hit rate
              example: 0.975
            cache_memory_usage_mb:
              type: integer
              description: Cache memory usage
              example: 128
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
