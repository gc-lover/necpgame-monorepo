components:
  schemas:
    TrafficRoute:
      type: object
      required:
        - route_id
        - service_name
        - route_type
        - match_conditions
        - destinations
        - created_at
        - status
      properties:
        route_id:
          type: string
          format: uuid
          description: Unique route identifier
          example: route1a2b3c4-d5e6-7890-1234-567890abcdef
        service_name:
          type: string
          description: Target service name
          example: guild-service
        namespace:
          type: string
          description: Kubernetes namespace
          example: game-services
        timeout:
          type: string
          description: Request timeout for this route
          example: 30s
        route_type:
          type: string
          enum:
            - canary
            - blue_green
            - weighted
            - header_based
            - path_based
            - fault_injection
          description: Type of traffic routing
          example: canary
        status:
          type: string
          enum:
            - active
            - inactive
            - pending
          description: Route status
          example: active
        created_at:
          type: string
          format: date-time
          description: Route creation timestamp
          example: '2025-12-20T21:45:00Z'
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: '2025-12-20T21:46:00Z'
        match_conditions:
          type: object
          description: Conditions for matching incoming traffic
          properties:
            http_method:
              type: array
              items:
                type: string
                enum:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - PATCH
                  - HEAD
                  - OPTIONS
              description: HTTP methods to match
              example:
                - GET
                - POST
            path_prefix:
              type: string
              description: Path prefix to match
              example: /api/v1/guilds
            headers:
              type: object
              description: Header-based matching conditions
              additionalProperties:
                type: object
                properties:
                  exact:
                    type: string
                    description: Exact header value match
                  regex:
                    type: string
                    description: Regex pattern match
                  prefix:
                    type: string
                    description: Prefix match
              example:
                X-Version:
                  exact: v2.0
                User-Agent:
                  regex: NECPGAME-.*
            query_parameters:
              type: object
              description: Query parameter matching
              additionalProperties:
                type: string
              example:
                version: beta
            source_labels:
              type: object
              description: Source service labels
              additionalProperties: true
              example:
                version: v1.2.3
        fault_injection:
          type: object
          description: Fault injection configuration (for chaos engineering)
          properties:
            delay:
              type: object
              properties:
                percentage:
                  type: number
                  format: float
                  minimum: 0
                  maximum: 100
                  description: Percentage of requests to delay
                  example: 10.0
                fixed_delay:
                  type: string
                  description: Fixed delay duration
                  example: 5s
                exponential_delay:
                  type: object
                  properties:
                    base_delay:
                      type: string
                      example: 1s
                    max_delay:
                      type: string
                      example: 30s
            abort:
              type: object
              properties:
                percentage:
                  type: number
                  format: float
                  minimum: 0
                  maximum: 100
                  description: Percentage of requests to abort
                  example: 5.0
                http_status:
                  type: integer
                  minimum: 400
                  maximum: 599
                  description: HTTP status for aborted requests
                  example: 503
        circuit_breaker:
          type: object
          description: Circuit breaker configuration for this route
          properties:
            max_requests:
              type: integer
              minimum: 1
              description: Max concurrent requests
              example: 100
            max_pending_requests:
              type: integer
              minimum: 0
              description: Max pending requests in queue
              example: 50
            max_requests_per_connection:
              type: integer
              minimum: 1
              description: Max requests per connection
              example: 10
            max_retries:
              type: integer
              minimum: 0
              description: Max retry attempts
              example: 3
        retry_policy:
          type: object
          description: Retry policy configuration
          properties:
            attempts:
              type: integer
              minimum: 0
              maximum: 10
              description: Number of retry attempts
              example: 3
            per_try_timeout:
              type: string
              description: Timeout per retry attempt
              example: 10s
            retry_on:
              type: array
              items:
                type: string
                enum:
                  - connect-failure
                  - refused-stream
                  - unavailable
                  - cancel
                  - retriable-status-codes
              description: Conditions to trigger retry
              example:
                - connect-failure
                - unavailable
        destinations:
          type: array
          items:
            type: object
            required:
              - service_name
              - weight
            properties:
              service_name:
                type: string
                description: Destination service name
                example: guild-service-v2
              namespace:
                type: string
                description: Destination namespace
                example: game-services
              subset:
                type: string
                description: Service subset/version
                example: v2.0
              port:
                type: integer
                description: Destination port
                example: 8080
              weight:
                type: integer
                minimum: 0
                maximum: 100
                description: Traffic weight (percentage)
                example: 20
              headers:
                type: object
                description: Headers to add/modify for this destination
                additionalProperties: true
                example:
                  X-Canary: 'true'
          description: Traffic destination configurations
        priority:
          type: integer
          minimum: 0
          maximum: 1000
          default: 0
          description: Route priority (higher values evaluated first)
          example: 100
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TrafficRouteRequest:
      type: object
      required:
        - service_name
        - route_type
        - match_conditions
        - destinations
      properties:
        service_name:
          type: string
          description: Target service name
          example: guild-service
        namespace:
          type: string
          default: game-services
          description: Kubernetes namespace
        timeout:
          type: string
          description: Request timeout
          example: 30s
        route_type:
          type: string
          enum:
            - canary
            - blue_green
            - weighted
            - header_based
            - path_based
            - fault_injection
          description: Type of traffic routing
          example: canary
        match_conditions:
          type: object
          description: Conditions for matching incoming traffic
          properties:
            http_method:
              type: array
              items:
                type: string
                enum:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - PATCH
                  - HEAD
                  - OPTIONS
              description: HTTP methods to match
            path_prefix:
              type: string
              description: Path prefix to match
            headers:
              type: object
              description: Header-based matching conditions
              additionalProperties:
                type: object
                properties:
                  exact:
                    type: string
                  regex:
                    type: string
                  prefix:
                    type: string
            query_parameters:
              type: object
              description: Query parameter matching
              additionalProperties:
                type: string
        fault_injection:
          type: object
          description: Fault injection configuration
          properties:
            delay:
              type: object
              properties:
                percentage:
                  type: number
                  format: float
                  minimum: 0
                  maximum: 100
                fixed_delay:
                  type: string
                exponential_delay:
                  type: object
                  properties:
                    base_delay:
                      type: string
                    max_delay:
                      type: string
            abort:
              type: object
              properties:
                percentage:
                  type: number
                  format: float
                  minimum: 0
                  maximum: 100
                http_status:
                  type: integer
                  minimum: 400
                  maximum: 599
        circuit_breaker:
          type: object
          description: Circuit breaker configuration
          properties:
            max_requests:
              type: integer
              minimum: 1
            max_pending_requests:
              type: integer
              minimum: 0
            max_requests_per_connection:
              type: integer
              minimum: 1
            max_retries:
              type: integer
              minimum: 0
        retry_policy:
          type: object
          description: Retry policy configuration
          properties:
            attempts:
              type: integer
              minimum: 0
              maximum: 10
            per_try_timeout:
              type: string
            retry_on:
              type: array
              items:
                type: string
                enum:
                  - connect-failure
                  - refused-stream
                  - unavailable
                  - cancel
                  - retriable-status-codes
        destinations:
          type: array
          items:
            type: object
            required:
              - service_name
              - weight
            properties:
              service_name:
                type: string
                description: Destination service name
              namespace:
                type: string
                description: Destination namespace
              subset:
                type: string
                description: Service subset/version
              port:
                type: integer
                description: Destination port
              weight:
                type: integer
                minimum: 0
                maximum: 100
                description: Traffic weight (percentage)
              headers:
                type: object
                description: Headers to add/modify
                additionalProperties: true
          minItems: 1
          description: Traffic destination configurations
        priority:
          type: integer
          minimum: 0
          maximum: 1000
          default: 0
          description: Route priority
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TrafficRouteUpdateRequest:
      type: object
      properties:
        timeout:
          type: string
        status:
          type: string
          enum:
            - active
            - inactive
            - pending
        match_conditions:
          type: object
          description: Updated match conditions
        fault_injection:
          type: object
          description: Updated fault injection
        circuit_breaker:
          type: object
          description: Updated circuit breaker config
        retry_policy:
          type: object
          description: Updated retry policy
        destinations:
          type: array
          items:
            type: object
            required:
              - service_name
              - weight
            properties:
              service_name:
                type: string
              namespace:
                type: string
              subset:
                type: string
              port:
                type: integer
              weight:
                type: integer
                minimum: 0
                maximum: 100
              headers:
                type: object
                additionalProperties: true
          description: Updated destinations
        priority:
          type: integer
          minimum: 0
          maximum: 1000
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
