openapi: 3.0.3
info:
  title: Voice Chat Service API
  description: |
    API для управления голосовыми каналами, WebRTC соединениями и голосовыми лобби.
    
    Система поддерживает:
    - Управление голосовыми каналами (Party, Guild, Raid, Proximity)
    - WebRTC соединения для голосового чата
    - Голосовые лобби (Activity, Clan/Guild, Raid, Tournament)
    - Подбор групп через Party Finder
    - Управление подканалами в лобби
    - Систему прав доступа к лобби
    - Интеграцию с party/guild/clan системами
  version: 2.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game

servers:
  - url: http://localhost:8091/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер

tags:
  - name: Voice Channel Manager
    description: Управление голосовыми каналами
  - name: WebRTC Connection Manager
    description: Управление WebRTC соединениями
  - name: Audio Mixer
    description: Микширование аудио
  - name: Participant Manager
    description: Управление участниками
  - name: Proximity Voice Handler
    description: Обработка proximity каналов
  - name: Quality Manager
    description: Управление качеством звука
  - name: Voice Events
    description: События голосового чата
  - name: Voice Statistics
    description: Статистика голосового чата
  - name: Voice Lobby
    description: Управление голосовыми лобби
  - name: Party Finder
    description: Подбор групп для лобби
  - name: Lobby Subchannels
    description: Управление подканалами в лобби
  - name: Lobby Permissions
    description: Управление правами доступа к лобби

paths:
  /social/voice/channels:
    post:
      tags:
        - Voice Channel Manager
      summary: Создать голосовой канал
      operationId: createChannel
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChannelRequest'
      responses:
        '201':
          description: Канал создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceChannel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
        - Voice Channel Manager
      summary: Получить список голосовых каналов
      operationId: listChannels
      security:
        - BearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/VoiceChannelType'
          description: Тип канала
        - name: owner_id
          in: query
          schema:
            type: string
            format: uuid
          description: ID владельца канала
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Количество записей на странице
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Смещение для пагинации
      responses:
        '200':
          description: Список каналов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/{channel_id}:
    get:
      tags:
        - Voice Channel Manager
      summary: Получить информацию о канале
      operationId: getChannel
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о канале
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceChannel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/{channel_id}/detail:
    get:
      tags:
        - Voice Channel Manager
      summary: Получить детальную информацию о канале с участниками
      operationId: getChannelDetail
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Детальная информация о канале
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelDetailResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/{channel_id}/join:
    post:
      tags:
        - Voice Channel Manager
      summary: Присоединиться к каналу
      operationId: joinChannel
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinChannelRequest'
      responses:
        '200':
          description: Успешное присоединение к каналу
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebRTCTokenResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Канал переполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/{channel_id}/leave:
    post:
      tags:
        - Voice Channel Manager
      summary: Покинуть канал
      operationId: leaveChannel
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeaveChannelRequest'
      responses:
        '200':
          description: Успешный выход из канала
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/{channel_id}/participants:
    get:
      tags:
        - Participant Manager
      summary: Получить список участников канала
      operationId: getChannelParticipants
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Список участников
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParticipantListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/{channel_id}/participants/{player_id}/status:
    put:
      tags:
        - Participant Manager
      summary: Обновить статус участника
      operationId: updateParticipantStatus
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateParticipantStatusRequest'
      responses:
        '200':
          description: Статус участника обновлен
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/{channel_id}/participants/{player_id}/position:
    put:
      tags:
        - Participant Manager
      summary: Обновить позицию участника
      operationId: updateParticipantPosition
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateParticipantPositionRequest'
      responses:
        '200':
          description: Позиция участника обновлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/channels/create:
    post:
      tags:
        - Voice Channel Manager
      summary: Создать голосовой канал
      operationId: createVoiceChannel
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChannelRequest'
      responses:
        '201':
          description: Канал создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceChannel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/webrtc/token:
    post:
      tags:
        - WebRTC Connection Manager
      summary: Получить токен WebRTC
      operationId: getWebRTCToken
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetWebRTCTokenRequest'
      responses:
        '200':
          description: Токен WebRTC
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebRTCTokenResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/webrtc/connect:
    post:
      tags:
        - WebRTC Connection Manager
      summary: Подключиться к WebRTC
      operationId: connectWebRTC
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectWebRTCRequest'
      responses:
        '200':
          description: Подключение установлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebRTCConnectionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/webrtc/disconnect:
    post:
      tags:
        - WebRTC Connection Manager
      summary: Отключиться от WebRTC
      operationId: disconnectWebRTC
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DisconnectWebRTCRequest'
      responses:
        '200':
          description: Отключение выполнено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebRTCDisconnectResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/mixer/configure:
    post:
      tags:
        - Audio Mixer
      summary: Настроить микшер аудио
      operationId: configureAudioMixer
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigureMixerRequest'
      responses:
        '200':
          description: Микшер настроен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MixerStatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/mixer/status:
    get:
      tags:
        - Audio Mixer
      summary: Получить статус микшера
      operationId: getMixerStatus
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Статус микшера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MixerStatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/participants/{participant_id}/mute:
    post:
      tags:
        - Participant Manager
      summary: Заглушить участника
      operationId: muteParticipant
      security:
        - BearerAuth: []
      parameters:
        - name: participant_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MuteParticipantRequest'
      responses:
        '200':
          description: Участник заглушен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParticipantResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/participants/{participant_id}/deafen:
    post:
      tags:
        - Participant Manager
      summary: Оглушить участника
      operationId: deafenParticipant
      security:
        - BearerAuth: []
      parameters:
        - name: participant_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeafenParticipantRequest'
      responses:
        '200':
          description: Участник оглушён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParticipantResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/participants/{participant_id}/kick:
    post:
      tags:
        - Participant Manager
      summary: Исключить участника из канала
      operationId: kickParticipant
      security:
        - BearerAuth: []
      parameters:
        - name: participant_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KickParticipantRequest'
      responses:
        '200':
          description: Участник исключён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParticipantResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/proximity/update:
    post:
      tags:
        - Proximity Voice Handler
      summary: Обновить позицию для proximity канала
      operationId: updateProximityPosition
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProximityPositionRequest'
      responses:
        '200':
          description: Позиция обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProximityUpdateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/proximity/nearby/{player_id}:
    get:
      tags:
        - Proximity Voice Handler
      summary: Получить ближайших игроков для proximity канала
      operationId: getNearbyPlayers
      security:
        - BearerAuth: []
      parameters:
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: radius
          in: query
          schema:
            type: number
            format: float
            default: 20.0
      responses:
        '200':
          description: Ближайшие игроки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NearbyPlayersResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/quality/presets:
    get:
      tags:
        - Quality Manager
      summary: Получить пресеты качества звука
      operationId: getQualityPresets
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Пресеты качества
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QualityPresetsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/quality/set:
    post:
      tags:
        - Quality Manager
      summary: Установить качество звука
      operationId: setQuality
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetQualityRequest'
      responses:
        '200':
          description: Качество установлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QualityStatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/quality/status:
    get:
      tags:
        - Quality Manager
      summary: Получить статус качества звука
      operationId: getQualityStatus
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: query
          schema:
            type: string
            format: uuid
        - name: participant_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Статус качества
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QualityStatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/events/{channel_id}:
    get:
      tags:
        - Voice Events
      summary: Получить события голосового канала
      operationId: getVoiceEvents
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: event_type
          in: query
          schema:
            type: string
            enum:
              - voice:channel-joined
              - voice:channel-left
              - voice:participant-joined
              - voice:participant-left
              - voice:participant-muted
              - voice:participant-speaking
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: События канала
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceEventsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/stats/channels:
    get:
      tags:
        - Voice Statistics
      summary: Получить статистику каналов
      operationId: getChannelStats
      security:
        - BearerAuth: []
      parameters:
        - name: channel_type
          in: query
          schema:
            type: string
            enum:
              - PARTY
              - GUILD
              - RAID
              - PROXIMITY
      responses:
        '200':
          description: Статистика каналов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelStatsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/stats/participants:
    get:
      tags:
        - Voice Statistics
      summary: Получить статистику участников
      operationId: getParticipantStats
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Статистика участников
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParticipantStatsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice/stats/quality:
    get:
      tags:
        - Voice Statistics
      summary: Получить статистику качества звука
      operationId: getQualityStats
      security:
        - BearerAuth: []
      parameters:
        - name: channel_id
          in: query
          schema:
            type: string
            format: uuid
        - name: participant_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Статистика качества
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QualityStatsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /social/voice-lobby/directory:
    get:
      tags:
        - Voice Lobby
      summary: Каталог лобби
      operationId: getLobbyDirectory
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_type
          in: query
          schema:
            type: string
            enum:
              - ACTIVITY
              - CLAN_GUILD
              - RAID
              - TOURNAMENT
        - name: is_private
          in: query
          schema:
            type: boolean
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Каталог лобби
          content:
            application/json:
              schema:
                type: object
                properties:
                  lobbies:
                    type: array
                    items:
                      $ref: '#/components/schemas/VoiceLobby'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'

  /social/voice-lobby/search:
    get:
      tags:
        - Voice Lobby
      summary: Поиск лобби
      operationId: searchLobbies
      security:
        - BearerAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
        - name: lobby_type
          in: query
          schema:
            type: string
            enum:
              - ACTIVITY
              - CLAN_GUILD
              - RAID
              - TOURNAMENT
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Результаты поиска
          content:
            application/json:
              schema:
                type: object
                properties:
                  lobbies:
                    type: array
                    items:
                      $ref: '#/components/schemas/VoiceLobby'
                  total:
                    type: integer
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /social/voice-lobby/available:
    get:
      tags:
        - Voice Lobby
      summary: Доступные лобби
      operationId: getAvailableLobbies
      security:
        - BearerAuth: []
      parameters:
        - name: player_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: lobby_type
          in: query
          schema:
            type: string
            enum:
              - ACTIVITY
              - CLAN_GUILD
              - RAID
              - TOURNAMENT
      responses:
        '200':
          description: Доступные лобби
          content:
            application/json:
              schema:
                type: object
                properties:
                  lobbies:
                    type: array
                    items:
                      $ref: '#/components/schemas/VoiceLobby'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /social/voice-lobby:
    post:
      tags:
        - Voice Lobby
      summary: Создание лобби
      operationId: createLobby
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLobbyRequest'
      responses:
        '201':
          description: Лобби создано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceLobby'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /social/voice-lobby/{lobby_id}:
    get:
      tags:
        - Voice Lobby
      summary: Информация о лобби
      operationId: getLobby
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о лобби
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceLobbyDetail'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

    put:
      tags:
        - Voice Lobby
      summary: Обновление лобби
      operationId: updateLobby
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateLobbyRequest'
      responses:
        '200':
          description: Лобби обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceLobby'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Voice Lobby
      summary: Удаление лобби
      operationId: deleteLobby
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Лобби удалено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/join:
    post:
      tags:
        - Voice Lobby
      summary: Присоединение к лобби
      operationId: joinLobby
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinLobbyRequest'
      responses:
        '200':
          description: Присоединение успешно
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LobbyParticipant'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/leave:
    post:
      tags:
        - Voice Lobby
      summary: Покидание лобби
      operationId: leaveLobby
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeaveLobbyRequest'
      responses:
        '200':
          description: Покидание выполнено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: left
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/party-finder/search:
    post:
      tags:
        - Party Finder
      summary: Поиск игроков для группы
      operationId: searchPartyFinder
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PartyFinderSearchRequest'
      responses:
        '200':
          description: Результаты поиска
          content:
            application/json:
              schema:
                type: object
                properties:
                  players:
                    type: array
                    items:
                      $ref: '#/components/schemas/PartyFinderPlayer'
                  total:
                    type: integer
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /social/voice-lobby/party-finder/create-group:
    post:
      tags:
        - Party Finder
      summary: Создание группы
      operationId: createPartyFinderGroup
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePartyFinderGroupRequest'
      responses:
        '201':
          description: Группа создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  group_id:
                    type: string
                    format: uuid
                  lobby_id:
                    type: string
                    format: uuid
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /social/voice-lobby/party-finder/invite:
    post:
      tags:
        - Party Finder
      summary: Приглашение игрока
      operationId: invitePartyFinderPlayer
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvitePartyFinderRequest'
      responses:
        '200':
          description: Приглашение отправлено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: invited
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/subchannels:
    post:
      tags:
        - Lobby Subchannels
      summary: Создание подканала
      operationId: createSubchannel
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubchannelRequest'
      responses:
        '201':
          description: Подканал создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LobbySubchannel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    get:
      tags:
        - Lobby Subchannels
      summary: Список подканалов
      operationId: listSubchannels
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Список подканалов
          content:
            application/json:
              schema:
                type: object
                properties:
                  subchannels:
                    type: array
                    items:
                      $ref: '#/components/schemas/LobbySubchannel'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/subchannels/{subchannel_id}/join:
    post:
      tags:
        - Lobby Subchannels
      summary: Присоединение к подканалу
      operationId: joinSubchannel
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: subchannel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinSubchannelRequest'
      responses:
        '200':
          description: Присоединение к подканалу выполнено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: joined
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/subchannels/{subchannel_id}/leave:
    post:
      tags:
        - Lobby Subchannels
      summary: Покидание подканала
      operationId: leaveSubchannel
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: subchannel_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeaveSubchannelRequest'
      responses:
        '200':
          description: Покидание подканала выполнено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: left
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/permissions:
    get:
      tags:
        - Lobby Permissions
      summary: Права доступа к лобби
      operationId: getLobbyPermissions
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Права доступа
          content:
            application/json:
              schema:
                type: object
                properties:
                  permissions:
                    type: array
                    items:
                      $ref: '#/components/schemas/LobbyPermission'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/permissions/{player_id}:
    post:
      tags:
        - Lobby Permissions
      summary: Назначение прав
      operationId: setLobbyPermission
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: player_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetPermissionRequest'
      responses:
        '200':
          description: Права назначены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LobbyPermission'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/{lobby_id}/permissions/check:
    get:
      tags:
        - Lobby Permissions
      summary: Проверка прав
      operationId: checkLobbyPermission
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: player_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: permission
          in: query
          required: true
          schema:
            type: string
            enum:
              - CREATE_SUBCHANNEL
              - DELETE_SUBCHANNEL
              - MANAGE_MEMBERS
              - KICK_MEMBERS
              - MUTE_MEMBERS
      responses:
        '200':
          description: Результат проверки
          content:
            application/json:
              schema:
                type: object
                properties:
                  has_permission:
                    type: boolean
                  role:
                    type: string
                    enum:
                      - OWNER
                      - ADMIN
                      - MODERATOR
                      - MEMBER
                      - GUEST
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/events/{lobby_id}:
    get:
      tags:
        - Voice Events
      summary: События лобби
      operationId: getLobbyEvents
      security:
        - BearerAuth: []
      parameters:
        - name: lobby_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: event_type
          in: query
          schema:
            type: string
            enum:
              - voice-lobby:created
              - voice-lobby:player-joined
              - voice-lobby:player-left
              - voice-lobby:subchannel-created
              - voice-lobby:subchannel-deleted
              - voice-lobby:permission-changed
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: События лобби
          content:
            application/json:
              schema:
                type: object
                properties:
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/LobbyEvent'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/integration/party/{party_id}:
    post:
      tags:
        - Voice Lobby
      summary: Создание лобби для группы
      operationId: createLobbyForParty
      security:
        - BearerAuth: []
      parameters:
        - name: party_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLobbyForPartyRequest'
      responses:
        '201':
          description: Лобби создано для группы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceLobby'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /social/voice-lobby/integration/guild/{guild_id}:
    post:
      tags:
        - Voice Lobby
      summary: Создание лобби для гильдии
      operationId: createLobbyForGuild
      security:
        - BearerAuth: []
      parameters:
        - name: guild_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLobbyForGuildRequest'
      responses:
        '201':
          description: Лобби создано для гильдии
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceLobby'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    VoiceChannelType:
      type: string
      enum: [PARTY, GUILD, RAID, PROXIMITY]
      description: Тип голосового канала

    ParticipantStatus:
      type: string
      enum: [MUTED, DEAFENED, SPEAKING, IDLE]
      description: Статус участника

    VoiceChannel:
      type: object
      properties:
        id:
          type: string
          format: uuid
        channel_type:
          type: string
          enum:
            - PARTY
            - GUILD
            - RAID
            - PROXIMITY
        owner_id:
          type: string
          format: uuid
          nullable: true
        name:
          type: string
          maxLength: 255
        max_participants:
          type: integer
        quality_preset:
          type: string
          enum:
            - HIGH
            - MEDIUM
            - LOW
            - ADAPTIVE
        is_active:
          type: boolean
          default: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    VoiceParticipant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        channel_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        webrtc_token:
          type: string
          maxLength: 255
        is_muted:
          type: boolean
          default: false
        is_deafened:
          type: boolean
          default: false
        is_speaking:
          type: boolean
          default: false
        position_x:
          type: number
          format: float
          nullable: true
        position_y:
          type: number
          format: float
          nullable: true
        position_z:
          type: number
          format: float
          nullable: true
        joined_at:
          type: string
          format: date-time
        last_activity_at:
          type: string
          format: date-time

    CreateChannelRequest:
      type: object
      required:
        - player_id
        - channel_type
        - name
      properties:
        player_id:
          type: string
          format: uuid
        channel_type:
          type: string
          enum:
            - PARTY
            - GUILD
            - RAID
            - PROXIMITY
        name:
          type: string
          maxLength: 255
        max_participants:
          type: integer
        quality_preset:
          type: string
          enum:
            - HIGH
            - MEDIUM
            - LOW
            - ADAPTIVE

    JoinChannelRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid
        position_x:
          type: number
          format: float
          nullable: true
        position_y:
          type: number
          format: float
          nullable: true
        position_z:
          type: number
          format: float
          nullable: true

    LeaveChannelRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    UpdateParticipantStatusRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid
        is_muted:
          type: boolean
        is_deafened:
          type: boolean

    UpdateParticipantPositionRequest:
      type: object
      required:
        - player_id
        - position_x
        - position_y
        - position_z
      properties:
        player_id:
          type: string
          format: uuid
        position_x:
          type: number
          format: float
        position_y:
          type: number
          format: float
        position_z:
          type: number
          format: float

    ChannelListResponse:
      type: object
      properties:
        channels:
          type: array
          items:
            $ref: '#/components/schemas/VoiceChannel'
        total:
          type: integer

    ParticipantListResponse:
      type: object
      properties:
        participants:
          type: array
          items:
            $ref: '#/components/schemas/VoiceParticipant'
        total:
          type: integer

    ChannelDetailResponse:
      type: object
      properties:
        channel:
          $ref: '#/components/schemas/VoiceChannel'
        participants:
          type: array
          items:
            $ref: '#/components/schemas/VoiceParticipant'

    WebRTCTokenResponse:
      type: object
      properties:
        token:
          type: string
        server_url:
          type: string
        expires_at:
          type: string
          format: date-time

    GetWebRTCTokenRequest:
      type: object
      required:
        - channel_id
        - player_id
      properties:
        channel_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid

    ConnectWebRTCRequest:
      type: object
      required:
        - channel_id
        - player_id
        - token
      properties:
        channel_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        token:
          type: string

    DisconnectWebRTCRequest:
      type: object
      required:
        - channel_id
        - player_id
      properties:
        channel_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid

    WebRTCConnectionResponse:
      type: object
      properties:
        success:
          type: boolean
        channel_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        connection_status:
          type: string
          enum:
            - INITIATING
            - CONNECTING
            - CONNECTED
            - DISCONNECTED
            - RECONNECTING

    WebRTCDisconnectResponse:
      type: object
      properties:
        success:
          type: boolean
        channel_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid

    ConfigureMixerRequest:
      type: object
      required:
        - channel_id
      properties:
        channel_id:
          type: string
          format: uuid
        mixing_strategy:
          type: string
          enum:
            - MIX_ALL
            - SELECTIVE
        audio_effects:
          type: object
          additionalProperties: true
          nullable: true

    MixerStatusResponse:
      type: object
      properties:
        channel_id:
          type: string
          format: uuid
        mixing_strategy:
          type: string
        active_streams:
          type: integer
        audio_latency_ms:
          type: integer

    MuteParticipantRequest:
      type: object
      required:
        - channel_id
        - muted_by
        - is_muted
      properties:
        channel_id:
          type: string
          format: uuid
        muted_by:
          type: string
          format: uuid
        is_muted:
          type: boolean

    DeafenParticipantRequest:
      type: object
      required:
        - channel_id
        - deafened_by
        - is_deafened
      properties:
        channel_id:
          type: string
          format: uuid
        deafened_by:
          type: string
          format: uuid
        is_deafened:
          type: boolean

    KickParticipantRequest:
      type: object
      required:
        - channel_id
        - kicked_by
      properties:
        channel_id:
          type: string
          format: uuid
        kicked_by:
          type: string
          format: uuid

    ParticipantResponse:
      type: object
      properties:
        participant:
          $ref: '#/components/schemas/VoiceParticipant'

    UpdateProximityPositionRequest:
      type: object
      required:
        - player_id
        - position_x
        - position_y
        - position_z
      properties:
        player_id:
          type: string
          format: uuid
        position_x:
          type: number
          format: float
        position_y:
          type: number
          format: float
        position_z:
          type: number
          format: float

    ProximityUpdateResponse:
      type: object
      properties:
        success:
          type: boolean
        player_id:
          type: string
          format: uuid
        nearby_players:
          type: array
          items:
            type: string
            format: uuid

    NearbyPlayersResponse:
      type: object
      properties:
        player_id:
          type: string
          format: uuid
        nearby_players:
          type: array
          items:
            $ref: '#/components/schemas/VoiceParticipant'
        radius:
          type: number
          format: float

    QualityPresetsResponse:
      type: object
      properties:
        presets:
          type: array
          items:
            $ref: '#/components/schemas/QualityPreset'

    QualityPreset:
      type: object
      properties:
        name:
          type: string
          enum:
            - HIGH
            - MEDIUM
            - LOW
            - ADAPTIVE
        sample_rate:
          type: integer
        channels:
          type: integer
        bitrate:
          type: integer

    SetQualityRequest:
      type: object
      required:
        - channel_id
        - quality_preset
      properties:
        channel_id:
          type: string
          format: uuid
        participant_id:
          type: string
          format: uuid
          nullable: true
        quality_preset:
          type: string
          enum:
            - HIGH
            - MEDIUM
            - LOW
            - ADAPTIVE

    QualityStatusResponse:
      type: object
      properties:
        channel_id:
          type: string
          format: uuid
        participant_id:
          type: string
          format: uuid
          nullable: true
        quality_preset:
          type: string
        audio_latency_ms:
          type: integer
        packet_loss_percent:
          type: number
          format: float
        quality_score:
          type: number
          format: float

    VoiceEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        channel_id:
          type: string
          format: uuid
        event_type:
          type: string
          enum:
            - voice:channel-joined
            - voice:channel-left
            - voice:participant-joined
            - voice:participant-left
            - voice:participant-muted
            - voice:participant-speaking
        event_data:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    VoiceEventsResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/VoiceEvent'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    ChannelStatsResponse:
      type: object
      properties:
        channel_type:
          type: string
          enum:
            - PARTY
            - GUILD
            - RAID
            - PROXIMITY
        active_channels:
          type: integer
        total_participants:
          type: integer
        average_quality_score:
          type: number
          format: float

    ParticipantStatsResponse:
      type: object
      properties:
        channel_id:
          type: string
          format: uuid
        total_participants:
          type: integer
        active_participants:
          type: integer
        muted_participants:
          type: integer
        speaking_participants:
          type: integer

    QualityStatsResponse:
      type: object
      properties:
        channel_id:
          type: string
          format: uuid
        participant_id:
          type: string
          format: uuid
          nullable: true
        audio_latency_ms:
          type: integer
        packet_loss_percent:
          type: number
          format: float
        quality_score:
          type: number
          format: float
        recorded_at:
          type: string
          format: date-time

    VoiceLobby:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        lobby_type:
          type: string
          enum:
            - ACTIVITY
            - CLAN_GUILD
            - RAID
            - TOURNAMENT
        owner_id:
          type: string
          format: uuid
        voice_channel_id:
          type: string
          format: uuid
        max_participants:
          type: integer
          default: 50
        current_participants:
          type: integer
        is_private:
          type: boolean
          default: false
        settings:
          type: object
          additionalProperties: true
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    VoiceLobbyDetail:
      type: object
      properties:
        lobby:
          $ref: '#/components/schemas/VoiceLobby'
        participants:
          type: array
          items:
            $ref: '#/components/schemas/LobbyParticipant'
        subchannels:
          type: array
          items:
            $ref: '#/components/schemas/LobbySubchannel'

    CreateLobbyRequest:
      type: object
      required:
        - owner_id
        - name
        - lobby_type
      properties:
        owner_id:
          type: string
          format: uuid
        name:
          type: string
          maxLength: 255
        lobby_type:
          type: string
          enum:
            - ACTIVITY
            - CLAN_GUILD
            - RAID
            - TOURNAMENT
        max_participants:
          type: integer
          default: 50
        is_private:
          type: boolean
          default: false
        settings:
          type: object
          additionalProperties: true
          nullable: true

    UpdateLobbyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        max_participants:
          type: integer
        is_private:
          type: boolean
        settings:
          type: object
          additionalProperties: true
          nullable: true

    JoinLobbyRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    LeaveLobbyRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    LobbyParticipant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        lobby_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        role:
          type: string
          enum:
            - OWNER
            - ADMIN
            - MODERATOR
            - MEMBER
            - GUEST
        current_subchannel_id:
          type: string
          format: uuid
          nullable: true
        joined_at:
          type: string
          format: date-time

    PartyFinderSearchRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid
        criteria:
          type: object
          properties:
            roles:
              type: array
              items:
                type: string
            rating_min:
              type: integer
            rating_max:
              type: integer
            activity_type:
              type: string
            region:
              type: string
            language:
              type: string

    PartyFinderPlayer:
      type: object
      properties:
        player_id:
          type: string
          format: uuid
        player_name:
          type: string
        role:
          type: string
        rating:
          type: integer
        activity_type:
          type: string
        region:
          type: string
        language:
          type: string

    CreatePartyFinderGroupRequest:
      type: object
      required:
        - player_id
        - lobby_id
      properties:
        player_id:
          type: string
          format: uuid
        lobby_id:
          type: string
          format: uuid
        criteria:
          type: object
          additionalProperties: true

    InvitePartyFinderRequest:
      type: object
      required:
        - from_player_id
        - to_player_id
        - lobby_id
      properties:
        from_player_id:
          type: string
          format: uuid
        to_player_id:
          type: string
          format: uuid
        lobby_id:
          type: string
          format: uuid

    LobbySubchannel:
      type: object
      properties:
        id:
          type: string
          format: uuid
        lobby_id:
          type: string
          format: uuid
        name:
          type: string
        voice_subchannel_id:
          type: string
          format: uuid
          nullable: true
        max_participants:
          type: integer
          nullable: true
        position:
          type: integer
        created_at:
          type: string
          format: date-time

    CreateSubchannelRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          maxLength: 255
        max_participants:
          type: integer
          nullable: true
        position:
          type: integer

    JoinSubchannelRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    LeaveSubchannelRequest:
      type: object
      required:
        - player_id
      properties:
        player_id:
          type: string
          format: uuid

    LobbyPermission:
      type: object
      properties:
        id:
          type: string
          format: uuid
        lobby_id:
          type: string
          format: uuid
        player_id:
          type: string
          format: uuid
        permission:
          type: string
          enum:
            - CREATE_SUBCHANNEL
            - DELETE_SUBCHANNEL
            - MANAGE_MEMBERS
            - KICK_MEMBERS
            - MUTE_MEMBERS
        granted:
          type: boolean
          default: true

    SetPermissionRequest:
      type: object
      required:
        - permission
        - granted
      properties:
        permission:
          type: string
          enum:
            - CREATE_SUBCHANNEL
            - DELETE_SUBCHANNEL
            - MANAGE_MEMBERS
            - KICK_MEMBERS
            - MUTE_MEMBERS
        granted:
          type: boolean

    LobbyEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        lobby_id:
          type: string
          format: uuid
        event_type:
          type: string
          enum:
            - voice-lobby:created
            - voice-lobby:player-joined
            - voice-lobby:player-left
            - voice-lobby:subchannel-created
            - voice-lobby:subchannel-deleted
            - voice-lobby:permission-changed
        event_data:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    CreateLobbyForPartyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        max_participants:
          type: integer
          default: 50
        settings:
          type: object
          additionalProperties: true
          nullable: true

    CreateLobbyForGuildRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        max_participants:
          type: integer
          default: 50
        settings:
          type: object
          additionalProperties: true
          nullable: true

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        code:
          type: string

  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Не авторизован
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Forbidden:
      description: Недостаточно прав доступа
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

