# Weapon Elemental Effects Service - Enterprise-Grade Domain Service

## Назначение

Weapon Elemental Effects Service предоставляет enterprise-grade API для управления элементальными эффектами оружия в NECPGAME. Сервис отвечает
за применение эффектов, расчет урона с учетом синергий и визуализацию эффектов.

## Функциональность

- **Применение эффектов**: Привязка элементальных эффектов к оружию с валидацией совместимости
- **Расчет урона**: Продвинутые формулы расчета с учетом синергий и сопротивлений
- **Визуальные эффекты**: Системы частиц и визуализация для эффектов
- **Синергия эффектов**: Комбинации эффектов с бонусами и штрафами
- **Анти-чит валидация**: Защита от читов и эксплойтов
- **Аналитика**: Статистика использования эффектов и их эффективности

## Структура

```
weapon-elemental-effects-service/
├── main.yaml              # Основная спецификация API
└── README.md              # Эта документация
```

## Зависимости

- **common**: Общие схемы и ответы
- **combat-service**: Интеграция с боевой системой для расчетов урона
- **analytics-service**: Аналитика использования эффектов
- **visual-effects-service**: Визуализация эффектов

## Performance

- **P99 Latency**: <12ms для операций с эффектами
- **Memory per Instance**: <8KB
- **Concurrent Users**: 50,000+ одновременных расчетов эффектов
- **Update Frequency**: 2000+ обновлений эффектов в секунду

## Типы элементов

- **fire**: Огненный урон, поджигание, постепенный урон
- **ice**: Ледяной урон, замедление, заморозка
- **electric**: Электрический урон, паралич, цепная реакция
- **poison**: Ядовитый урон, постепенное отравление
- **acid**: Кислотный урон, разъедание брони
- **radiation**: Радиационный урон, мутации, дебаффы
- **plasma**: Плазменный урон, игнорирование брони
- **cyber**: Кибернетический урон, хакинговые эффекты
- **nano**: Нано-урон, регенерация, усиление
- **quantum**: Квантовый урон, телепортация, фазовые эффекты

## Типы эффектов

- **damage_over_time**: Урон со временем (DoT)
- **status_effect**: Эффекты статуса (станы, замедления)
- **damage_boost**: Усиление урона
- **defense_reduction**: Снижение защиты
- **movement_impairment**: Ограничение подвижности
- **healing_reduction**: Снижение лечения
- **energy_drain**: Поглощение энергии
- **attribute_boost**: Усиление атрибутов

## API Endpoints

### Управление эффектами
- `POST /effects` - Создать эффект (admin)
- `GET /effects` - Получить список эффектов
- `GET /effects/{id}` - Получить детали эффекта
- `PUT /effects/{id}` - Обновить эффект (admin)
- `DELETE /effects/{id}` - Удалить эффект (admin)

### Применение эффектов
- `POST /effects/{id}/apply` - Применить эффект к оружию
- `POST /effects/{id}/remove` - Удалить эффект с оружия

### Расчеты и синергии
- `POST /effects/calculate/damage` - Рассчитать урон
- `POST /effects/calculate/synergies` - Рассчитать синергии
- `POST /effects/batch/calculate` - Пакетный расчет урона

### Визуализация и аналитика
- `POST /effects/visual/config` - Настроить визуальные эффекты
- `GET /effects/analytics/summary` - Аналитика эффектов

### AI и адаптация
- `POST /effects/adaptive/train` - Обучение AI на данных эффектов
- `GET /effects/adaptive/recommend` - AI рекомендации эффектов

## Система синергий

### Принцип работы
Синергии возникают при комбинации совместимых элементов, давая бонусы к урону и дополнительные эффекты.

### Примеры синергий
- **Fire + Electric**: Цепная реакция, повышенный урон по группам
- **Ice + Poison**: Замедление с постепенным отравлением
- **Acid + Radiation**: Разъедание брони с мутациями
- **Plasma + Cyber**: Игнорирование брони с хакинговыми эффектами

### Расчет синергии
```
Total_Multiplier = Base_Damage × (1 + Synergy_Bonus) × Resistance_Modifier
```

## Система визуализации

### Компоненты эффектов
- **Particle Systems**: Системы частиц для визуального отображения
- **Color Schemes**: Цветовые схемы для разных элементов
- **Sound Effects**: Звуковые эффекты для атмосферы
- **Screen Effects**: Эффекты экрана (тряска, цветовые фильтры)

### Производительность
- **LOD System**: Уровни детализации для разных расстояний
- **Pooling**: Переиспользование эффектов для оптимизации
- **Culling**: Отсечение невидимых эффектов

## Баланс и оптимизация

### Ограничения оружия
- **Power Capacity**: Ограничение по энергопотреблению
- **Stability Rating**: Стабильность оружия при эффектах
- **Heat Generation**: Нагрев от эффектов
- **Cooldown Management**: Управление перезарядками

### Формулы баланса
```
Stability = Base_Stability - Σ(Effect_Instability)
Power_Draw = Σ(Effect_Power_Cost × Mod_Level)
Heat_Gen = Σ(Effect_Heat × Activity_Multiplier)
```

## Анти-чит система

### Валидация эффектов
- **Hash Validation**: Проверка хэшей конфигураций
- **Server-side Calculation**: Серверные расчеты для верификации
- **Timestamp Validation**: Проверка временных меток
- **Statistical Analysis**: Статистический анализ паттернов

### Обнаружение читов
- **Impossible Combinations**: Невозможные комбинации эффектов
- **Overpowered Stats**: Слишком мощные характеристики
- **Timing Anomalies**: Аномалии во времени применения
- **Pattern Recognition**: Распознавание подозрительных паттернов

## Использование

### Валидация

```bash
npx @redocly/cli lint main.yaml
```

### Генерация Go кода

```bash
ogen --target ../../services/weapon-elemental-effects-service-go/pkg/api \
     --package api --clean main.yaml
```

### Документация

```bash
npx @redocly/cli build-docs main.yaml -o docs/index.html
```

## Примеры использования

### Применение эффекта

```json
{
  "weapon_id": "550e8400-e29b-41d4-a716-446655440000",
  "character_id": "550e8400-e29b-41d4-a716-446655440001",
  "slot_index": 0,
  "mod_level": 3
}
```

### Расчет урона

```json
{
  "attacker_id": "550e8400-e29b-41d4-a716-446655440000",
  "target_id": "550e8400-e29b-41d4-a716-446655440001",
  "weapon_config": {...},
  "base_damage": 100,
  "target_armor": {
    "physical": 50,
    "energy": 30
  },
  "target_resistances": {
    "fire": 0.2,
    "electric": 0.1
  }
}
```

### Синергия эффектов

```json
{
  "effects": [
    "550e8400-e29b-41d4-a716-446655440000",
    "550e8400-e29b-41d4-a716-446655440001"
  ],
  "weapon_type": "rifle",
  "combat_context": "pvp"
}
```

## Мониторинг и метрики

### Ключевые метрики
- **Effect Application Rate**: Скорость применения эффектов
- **Damage Calculation Latency**: Задержка расчетов урона
- **Synergy Hit Rate**: Процент успешных синергий
- **Visual Performance**: Производительность визуальных эффектов

### Мониторинг здоровья
- **Memory Usage**: Потребление памяти эффектами
- **CPU Utilization**: Загрузка CPU расчетами
- **Network Traffic**: Сетевой трафик для синхронизации
- **Error Rates**: Уровень ошибок в расчетах

## Расширение системы

### Добавление новых элементов
1. Определить характеристики элемента
2. Настроить взаимодействия с существующими
3. Создать визуальные эффекты
4. Провести балансное тестирование

### Добавление новых эффектов
1. Выбрать тип эффекта
2. Определить механику действия
3. Настроить параметры баланса
4. Интегрировать с системой синергий

