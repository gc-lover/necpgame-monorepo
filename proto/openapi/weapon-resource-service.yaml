openapi: 3.0.0
info:
  title: Weapon Resource Service API
  description: Service for managing weapon resources (ammunition, heat, energy, cooldowns)
  version: 1.0.0
servers:
- url: http://localhost:8091
  description: Local development
- url: https://api.necpgame.com
  description: Production
tags:
- name: resources
  description: Weapon resource management
paths:
  /api/v1/weapons/resources/{weaponId}:
    get:
      summary: Get weapon resources
      description: Retrieve current resource state for a weapon instance
      tags:
      - resources
      parameters:
      - name: weaponId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Weapon instance ID
      responses:
        '200':
          description: Weapon resource state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeaponResources'
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
      security:
      - BearerAuth: []
  /api/v1/weapons/resources/{weaponId}/consume:
    post:
      summary: Consume weapon resources
      description: Consume ammunition, energy, or apply heat when weapon is used
      tags:
      - resources
      parameters:
      - name: weaponId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConsumeResourceRequest'
      responses:
        '200':
          description: Resource consumed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeaponResources'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
      security:
      - BearerAuth: []
  /api/v1/weapons/resources/{weaponId}/reload:
    post:
      summary: Reload weapon
      description: Reload ammunition for a weapon
      tags:
      - resources
      parameters:
      - name: weaponId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReloadWeaponRequest'
      responses:
        '200':
          description: Weapon reloaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeaponResources'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
      security:
      - BearerAuth: []
  /api/v1/weapons/resources/{weaponId}/status:
    get:
      summary: Get weapon status
      description: Get current status including overheated state and active cooldowns
      tags:
      - resources
      parameters:
      - name: weaponId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Weapon status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeaponStatus'
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
      security:
      - BearerAuth: []
  /api/v1/weapons/resources/{weaponId}/cooldown:
    post:
      summary: Apply cooldown
      description: Apply cooldown to weapon or ability
      tags:
      - resources
      parameters:
      - name: weaponId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplyCooldownRequest'
      responses:
        '200':
          description: Cooldown applied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeaponResources'
        '400':
          $ref: common.yaml#/components/responses/BadRequest
        '404':
          $ref: common.yaml#/components/responses/NotFound
        '500':
          $ref: common.yaml#/components/responses/InternalServerError
      security:
      - BearerAuth: []
components:
  schemas:
    WeaponResources:
      type: object
      properties:
        weaponInstanceId:
          type: string
          format: uuid
        updatedAt:
          type: string
          format: date-time
        cooldowns:
          type: object
          additionalProperties:
            type: string
            format: date-time
          description: Active cooldowns with expiration times
        ammunition:
          $ref: '#/components/schemas/AmmunitionState'
        energy:
          $ref: '#/components/schemas/EnergyState'
        heat:
          $ref: '#/components/schemas/HeatState'
      required:
      - weaponInstanceId
      - ammunition
      - heat
      - energy
      - cooldowns
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AmmunitionState:
      type: object
      properties:
        type:
          type: string
          enum:
          - standard
          - fire
          - ice
          - poison
          - electric
          - explosive
          description: Ammunition type
        current:
          type: integer
          minimum: 0
          description: Current ammunition count
        max:
          type: integer
          minimum: 0
          description: Maximum ammunition capacity
      required:
      - current
      - max
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    HeatState:
      type: object
      properties:
        overheatExpiresAt:
          type: string
          format: date-time
          description: When overheat ends (if overheated)
        current:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Current heat level
        coolingRate:
          type: number
          format: float
          description: Cooling rate per second
        overheated:
          type: boolean
          description: Whether weapon is currently overheated
      required:
      - current
      - coolingRate
      - overheated
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EnergyState:
      type: object
      properties:
        current:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Current energy level
        regenRate:
          type: number
          format: float
          description: Regeneration rate per second
        costPerShot:
          type: number
          format: float
          description: Energy cost per shot
      required:
      - current
      - regenRate
    ConsumeResourceRequest:
      type: object
      properties:
        resourceType:
          type: string
          enum:
          - ammunition
          - heat
          - energy
        amount:
          type: number
          format: float
          minimum: 0
      required:
      - resourceType
      - amount
    ReloadWeaponRequest:
      type: object
      properties:
        playerId:
          type: string
          format: uuid
        ammoSource:
          type: string
          enum:
          - inventory
          - pickup
          description: Source of ammunition for reload
      required:
      - playerId
    WeaponStatus:
      type: object
      properties:
        weaponInstanceId:
          type: string
          format: uuid
        blockedReason:
          type: string
          description: Reason why weapon is blocked (if canFire is false)
        activeCooldowns:
          type: array
          items:
            $ref: '#/components/schemas/CooldownInfo'
        canFire:
          type: boolean
          description: Whether weapon can currently fire
        overheated:
          type: boolean
      required:
      - weaponInstanceId
      - canFire
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CooldownInfo:
      type: object
      properties:
        abilityId:
          type: string
          description: Ability or weapon ID on cooldown
        expiresAt:
          type: string
          format: date-time
        remainingSeconds:
          type: number
          format: float
      required:
      - abilityId
      - expiresAt
      - remainingSeconds
    ApplyCooldownRequest:
      type: object
      properties:
        abilityId:
          type: string
          description: Ability or weapon ID to apply cooldown to
        durationSeconds:
          type: integer
          minimum: 1
          description: Cooldown duration in seconds
      required:
      - abilityId
      - durationSeconds
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth








