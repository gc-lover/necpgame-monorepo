openapi: 3.0.3
info:
  title: Gameplay Time Trials Weekly Service API
  description: 'API для еженедельных временных испытаний (Weekly Time Challenges).

    **Основные возможности:**

    - Получение текущего еженедельного испытания

    - История еженедельных испытаний

    - Управление еженедельными испытаниями

    '
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8083/api/v1/gameplay
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1/gameplay
    description: Продакшен сервер
tags:
  - name: Weekly Challenges
    description: Еженедельные испытания
paths:
  /time-trials/weekly/current:
    get:
      tags:
        - Weekly Challenges
      summary: Получить текущее еженедельное испытание
      description: 'Возвращает информацию о текущем активном еженедельном испытании.

        '
      operationId: getCurrentWeeklyChallenge
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Текущее еженедельное испытание
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeeklyChallengeResponse'
              example:
                challenge_id: e5f6a7b8-c9d0-1234-5678-901234ef0123
                challenge_type: time_attack_dungeon
                content_id: f6a7b8c9-d0e1-2345-6789-012345f01234
                week_start: '2025-12-01T00:00:00Z'
                week_end: '2025-12-08T00:00:00Z'
                conditions:
                  max_time: 1800
                  difficulty: hard
                rewards:
                  bronze:
                    time_limit: 1800
                    rewards:
                      - 'title: Bronze Speedrunner'
                  silver:
                    time_limit: 1200
                    rewards:
                      - 'title: Silver Speedrunner'
                  gold:
                    time_limit: 900
                    rewards:
                      - 'title: Gold Speedrunner'
                  platinum:
                    time_limit: 600
                    rewards:
                      - 'title: Platinum Speedrunner'
                      - 'cosmetic: Speedrun Badge'
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '404':
          description: Еженедельное испытание не активно
          content:
            application/json:
              schema:
                $ref: ../../common-schemas.yaml#/components/schemas/Error
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
  /time-trials/weekly/history:
    get:
      tags:
        - Weekly Challenges
      summary: Получить историю еженедельных испытаний
      description: 'Возвращает историю еженедельных испытаний с возможностью фильтрации.

        '
      operationId: getWeeklyChallengesHistory
      security:
        - BearerAuth: [ ]
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Количество записей
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Смещение для пагинации
      responses:
        '200':
          description: История еженедельных испытаний
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeeklyChallengesHistoryResponse'
              example:
                challenges:
                  - challenge_id: g7a8b9c0-e1f2-3456-7890-123456g01234
                    challenge_type: speedrun_raid
                    week_start: '2025-11-24T00:00:00Z'
                    week_end: '2025-12-01T00:00:00Z'
                    status: completed
                  - challenge_id: h8b9c0d1-f2e3-4567-8901-234567h01234
                    challenge_type: time_attack_dungeon
                    week_start: '2025-11-17T00:00:00Z'
                    week_end: '2025-11-24T00:00:00Z'
                    status: completed
                total: 10
        '401':
          $ref: ../../common-schemas.yaml#/components/responses/Unauthorized
        '500':
          $ref: ../../common-schemas.yaml#/components/responses/InternalServerError
components:
  securitySchemes:
    BearerAuth:
      $ref: common.yaml#/components/securitySchemes/BearerAuth
  schemas:
    WeeklyChallengeResponse:
      type: object
      required:
        - challenge_id
        - challenge_type
        - content_id
        - week_start
        - week_end
        - conditions
        - rewards
      properties:
        challenge_id:
          type: string
          format: uuid
          description: ID еженедельного испытания
          example: e5f6a7b8-c9d0-1234-5678-901234ef0123
        content_id:
          type: string
          format: uuid
          description: ID контента
          example: f6a7b8c9-d0e1-2345-6789-012345f01234
        challenge_type:
          type: string
          enum:
            - speedrun_raid
            - time_attack_dungeon
            - weekly_time_challenge
          description: Тип испытания
          example: time_attack_dungeon
        week_start:
          type: string
          format: date-time
          description: Начало недели
          example: '2025-12-01T00:00:00Z'
        week_end:
          type: string
          format: date-time
          description: Конец недели
          example: '2025-12-08T00:00:00Z'
        conditions:
          type: object
          description: Условия испытания
          additionalProperties: true
          example:
            max_time: 1800
            difficulty: hard
        rewards:
          type: object
          description: Награды по уровням
          properties:
            bronze:
              $ref: '#/components/schemas/TimeRewardTier'
            silver:
              $ref: '#/components/schemas/TimeRewardTier'
            gold:
              $ref: '#/components/schemas/TimeRewardTier'
            platinum:
              $ref: '#/components/schemas/TimeRewardTier'
          example:
            bronze:
              time_limit: 1800
              rewards:
                - 'title: Bronze Speedrunner'
            silver:
              time_limit: 1200
              rewards:
                - 'title: Silver Speedrunner'
            gold:
              time_limit: 900
              rewards:
                - 'title: Gold Speedrunner'
            platinum:
              time_limit: 600
              rewards:
                - 'title: Platinum Speedrunner'
                - 'cosmetic: Speedrun Badge'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    TimeRewardTier:
      type: object
      required:
        - time_limit
        - rewards
      properties:
        rewards:
          type: array
          items:
            type: string
          description: Список наград
          example:
            - 'title: Bronze Speedrunner'
        time_limit:
          type: integer
          description: Лимит времени в секундах
          minimum: 0
          example: 1800
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    WeeklyChallengeHistoryItem:
      type: object
      required:
        - challenge_id
        - challenge_type
        - week_start
        - week_end
        - status
      properties:
        challenge_id:
          type: string
          format: uuid
          description: ID еженедельного испытания
          example: g7a8b9c0-e1f2-3456-7890-123456g01234
        challenge_type:
          type: string
          enum:
            - speedrun_raid
            - time_attack_dungeon
            - weekly_time_challenge
          description: Тип испытания
          example: speedrun_raid
        status:
          type: string
          enum:
            - active
            - completed
            - upcoming
          description: Статус испытания
          example: completed
        week_start:
          type: string
          format: date-time
          description: Начало недели
          example: '2025-11-24T00:00:00Z'
        week_end:
          type: string
          format: date-time
          description: Конец недели
          example: '2025-12-01T00:00:00Z'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    WeeklyChallengesHistoryResponse:
      type: object
      required:
        - challenges
        - total
      properties:
        challenges:
          type: array
          items:
            $ref: '#/components/schemas/WeeklyChallengeHistoryItem'
          description: Список еженедельных испытаний
        total:
          type: integer
          description: Общее количество испытаний
          minimum: 0
          example: 10
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
  responses:
    BadRequest:
      $ref: ../../common-schemas.yaml#/components/responses/BadRequest
    Unauthorized:
      $ref: common.yaml#/components/responses/Unauthorized
    NotFound:
      $ref: common.yaml#/components/responses/NotFound
    InternalServerError:
      $ref: common.yaml#/components/responses/InternalServerError
security:
  - BearerAuth: [ ]
