openapi: 3.0.3
info:
  title: World Locations Service API
  description: |
    **Enterprise-Grade World Locations API for NECPGAME MMOFPS**

    Управление игровыми локациями, городами и географическими объектами.
    Предоставляет полный спектр операций для работы с мировыми локациями.

    ## Key Features
    - **Enterprise-grade location management** с оптимизацией производительности
    - **Backend optimization hints** для struct alignment и memory savings
    - **Complete validation** с redocly и ogen code generation
    - **Security-first approach** с JWT authentication
    - **Performance-optimized** response structures
    - **Comprehensive error handling** с proper HTTP status codes

    ## Domain Purpose
    World Locations Service управляет всеми географическими объектами игрового мира:
    города, районы, достопримечательности, зоны влияния фракций.

    ## Performance Targets
    - Hot paths: 1000+ RPS, P99 <20ms
    - Location queries: <10ms average response time
    - Memory: <40MB per service instance
    - Cache hit rate: >90%
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    name: NECPGAME Locations API Support
    url: https://necpgame.com/support
    email: api@locations.necpgame.com

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://api.necpgame.com/api/v1
    description: Production server

security:
  - BearerAuth: [ ]

tags:
  - name: Locations
    description: Location management operations
  - name: Cities
    description: City-specific operations

paths:
  /api/v1/locations/health:
    get:
      summary: Location service health check
      operationId: locationHealthCheck
      tags:
        - Locations
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /api/v1/locations:
    get:
      summary: Get locations with filtering
      operationId: getLocations
      tags:
        - Locations
      security:
        - BearerAuth: [ ]
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [ city, district, landmark, faction_territory ]
          description: Filter by location type
        - name: faction_id
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by controlling faction
        - name: level_min
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Minimum level requirement
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Maximum number of results
      responses:
        "200":
          description: Locations retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LocationListResponse"

  /api/v1/locations/{location_id}:
    get:
      summary: Get location details
      operationId: getLocation
      tags:
        - Locations
      security:
        - BearerAuth: [ ]
      parameters:
        - name: location_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Location unique identifier
      responses:
        "200":
          description: Location details retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LocationDetailResponse"
        "404":
          description: Location not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/v1/locations/{location_id}/nearby:
    get:
      summary: Get nearby locations
      operationId: getNearbyLocations
      tags:
        - Locations
      security:
        - BearerAuth: [ ]
      parameters:
        - name: location_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Base location identifier
        - name: radius
          in: query
          schema:
            type: number
            minimum: 0.1
            maximum: 100.0
            default: 10.0
          description: Search radius in kilometers
      responses:
        "200":
          description: Nearby locations found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NearbyLocationsResponse"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Core location schemas
    Location:
      type: object
      required:
        - id
        - name
        - type
        - coordinates
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique location identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          maxLength: 100
          description: Location name
          example: "Night City Downtown"
        type:
          type: string
          enum: [ city, district, landmark, faction_territory ]
          description: Location type
          example: city
        coordinates:
          type: object
          required:
            - latitude
            - longitude
          properties:
            latitude:
              type: number
              minimum: -90
              maximum: 90
              description: Latitude coordinate
              example: 47.6062
            longitude:
              type: number
              minimum: -180
              maximum: 180
              description: Longitude coordinate
              example: -122.3321
        level_range:
          type: string
          pattern: '^\d+-\d+$'
          description: "Диапазон уровней (формат: min-max)"
          example: "10-25"
        controlling_faction_id:
          type: string
          format: uuid
          description: ID controlling faction
          example: 550e8400-e29b-41d4-a716-446655440001
        is_active:
          type: boolean
          default: true
          description: Whether location is currently active
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    LocationDetailResponse:
      type: object
      required:
        - location
        - nearby_poi
      properties:
        location:
          $ref: "#/components/schemas/Location"
        nearby_poi:
          type: array
          items:
            type: object
            required:
              - id
              - name
              - type
              - distance_km
            properties:
              id:
                type: string
                format: uuid
              name:
                type: string
                maxLength: 100
              type:
                type: string
                enum: [ shop, npc, quest_giver, fast_travel ]
              distance_km:
                type: number
                minimum: 0
              coordinates:
                $ref: "#/components/schemas/Location/properties/coordinates"
        faction_influence:
          type: object
          description: Current faction influence levels
          additionalProperties:
            type: number
            minimum: 0
            maximum: 100

    LocationListResponse:
      type: object
      required:
        - locations
        - total_count
        - has_more
      properties:
        locations:
          type: array
          items:
            $ref: "#/components/schemas/Location"
        total_count:
          type: integer
          minimum: 0
          description: Total number of matching locations
        has_more:
          type: boolean
          description: Whether there are more results available

    NearbyLocationsResponse:
      type: object
      required:
        - base_location
        - locations
      properties:
        base_location:
          $ref: "#/components/schemas/Location"
        locations:
          type: array
          items:
            type: object
            required:
              - location
              - distance_km
              - bearing_degrees
            properties:
              location:
                $ref: "#/components/schemas/Location"
              distance_km:
                type: number
                minimum: 0
                description: Distance in kilometers
              bearing_degrees:
                type: number
                minimum: 0
                maximum: 360
                description: Bearing in degrees from north

    # Common schemas
    HealthResponse:
      type: object
      required:
        - status
        - service
        - timestamp
      properties:
        status:
          type: string
          enum: [ healthy, degraded, unhealthy ]
          example: healthy
        service:
          type: string
          example: locations
        timestamp:
          type: string
          format: date-time
        version:
          type: string
          example: "1.0.0"
        uptime_seconds:
          type: integer
          minimum: 0
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."

    Error:
      type: object
      required:
        - message
        - code
      properties:
        message:
          type: string
          maxLength: 1000
          example: "Location not found"
        code:
          type: string
          pattern: "^[A-Z_][A-Z0-9_]*$"
          example: LOCATION_NOT_FOUND
        details:
          type: object
          description: Additional error details
        timestamp:
          type: string
          format: date-time
      description: "BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%."
