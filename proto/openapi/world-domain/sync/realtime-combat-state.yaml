openapi: 3.0.3
info:
  title: Real-time Combat API - State Synchronization
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  description: State synchronization management for real-time combat system
servers:
  - url: http://localhost:8110
    description: Local development
  - url: https://api.necpgame.com/v1/realtime/combat
    description: Production API
tags:
  - name: state
    description: Real-time state synchronization
security:
  - BearerAuth: [ ]
paths:
  /api/v1/realtime/combat/state/{session_id}/sync:
    post:
      summary: Request state synchronization
      operationId: requestStateSync
      tags:
        - state
      security:
        - BearerAuth: [ ]
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Combat session ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StateSyncRequest'
      responses:
        '200':
          description: State synchronization initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StateSyncResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/v1/realtime/combat/state/{session_id}/snapshot:
    get:
      summary: Get current state snapshot
      operationId: getStateSnapshot
      tags:
        - state
      security:
        - BearerAuth: [ ]
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Combat session ID
        - name: include_history
          in: query
          schema:
            type: boolean
            default: false
          description: Include recent state history
        - name: max_history_entries
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Maximum history entries to include
      responses:
        '200':
          description: Current state snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StateSnapshot'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
  schemas:
    StateSyncRequest:
      type: object
      required:
        - player_id
        - client_state_version
      properties:
        player_id:
          type: string
          format: uuid
          description: Player requesting synchronization
        priority:
          type: string
          enum:
            - low
            - normal
            - high
            - urgent
          default: normal
          description: Synchronization priority
        metadata:
          type: object
          additionalProperties: true
          description: Additional sync metadata
        requested_components:
          type: array
          items:
            type: string
            enum:
              - player_states
              - combat_entities
              - environment
              - ai_states
              - items
              - effects
          description: Specific state components to sync
        client_state_version:
          type: integer
          minimum: 0
          description: Client's current state version
        compression:
          type: boolean
          default: true
          description: Enable response compression
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StateSyncResponse:
      type: object
      required:
        - sync_id
        - session_id
        - server_state_version
        - status
        - initiated_at
      properties:
        sync_id:
          type: string
          format: uuid
          description: Unique synchronization identifier
        session_id:
          type: string
          format: uuid
          description: Combat session identifier
        checksum:
          type: string
          description: Data integrity checksum
        status:
          type: string
          enum:
            - initiated
            - in_progress
            - completed
            - failed
          description: Synchronization status
        initiated_at:
          type: string
          format: date-time
          description: Sync initiation timestamp
        estimated_completion:
          type: string
          format: date-time
          description: Estimated completion time
        next_sync_recommended:
          type: string
          format: date-time
          description: Recommended time for next sync
        components_included:
          type: array
          items:
            type: string
            enum:
              - player_states
              - combat_entities
              - environment
              - ai_states
              - items
              - effects
          description: State components included in sync
        server_state_version:
          type: integer
          minimum: 0
          description: Current server state version
        data_size:
          type: integer
          minimum: 0
          description: Size of sync data in bytes
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StateSnapshot:
      type: object
      required:
        - session_id
        - state_version
        - timestamp
        - players
        - entities
      properties:
        session_id:
          type: string
          format: uuid
          description: Combat session identifier
        timestamp:
          type: string
          format: date-time
          description: Snapshot creation timestamp
        metadata:
          type: object
          properties:
            server_load:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Server load factor
            active_connections:
              type: integer
              minimum: 0
              description: Number of active connections
            last_full_sync:
              type: string
              format: date-time
              description: Last full synchronization timestamp
          description: Session metadata
        environment:
          $ref: '#/components/schemas/EnvironmentState'
        players:
          type: array
          items:
            $ref: '#/components/schemas/PlayerState'
          description: Current player states
        entities:
          type: array
          items:
            $ref: '#/components/schemas/CombatEntityState'
          description: Current combat entity states
        ai_states:
          type: array
          items:
            $ref: '#/components/schemas/AIState'
          description: AI entity states
        items:
          type: array
          items:
            $ref: '#/components/schemas/ItemState'
          description: Item states in the session
        effects:
          type: array
          items:
            $ref: '#/components/schemas/EffectState'
          description: Active effects
        history:
          type: array
          items:
            $ref: '#/components/schemas/StateChange'
          description: Recent state changes (if requested)
        state_version:
          type: integer
          minimum: 0
          description: State version number
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    PlayerState:
      type: object
      required:
        - player_id
        - position
        - health
        - status
        - last_update
      properties:
        player_id:
          type: string
          format: uuid
          description: Player identifier
        status:
          type: string
          enum:
            - alive
            - dead
            - incapacitated
            - spectating
          description: Player status
        last_update:
          type: string
          format: date-time
          description: Last state update timestamp
        input_state:
          type: object
          properties:
            movement_keys:
              type: array
              items:
                type: string
                enum:
                  - w
                  - a
                  - s
                  - d
                  - space
                  - shift
              description: Currently pressed movement keys
            mouse_position:
              $ref: '#/components/schemas/Vector2'
            actions:
              type: array
              items:
                type: string
                enum:
                  - attack
                  - defend
                  - ability1
                  - ability2
                  - ability3
                  - ultimate
              description: Currently active actions
          description: Current input state
        health:
          $ref: '#/components/schemas/HealthState'
        position:
          $ref: '#/components/schemas/Vector3'
        rotation:
          $ref: '#/components/schemas/Vector3'
        velocity:
          $ref: '#/components/schemas/Vector3'
        equipment:
          type: array
          items:
            $ref: '#/components/schemas/EquipmentItem'
          description: Currently equipped items
        active_abilities:
          type: array
          items:
            type: string
            format: uuid
          description: IDs of currently active abilities
        buffs:
          type: array
          items:
            $ref: '#/components/schemas/StatusEffect'
          description: Active buffs/debuffs
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CombatEntityState:
      type: object
      required:
        - entity_id
        - entity_type
        - position
        - health
        - status
        - last_update
      properties:
        entity_id:
          type: string
          format: uuid
          description: Entity identifier
        target_id:
          type: string
          format: uuid
          description: Current target entity ID
        entity_type:
          type: string
          enum:
            - enemy
            - npc
            - projectile
            - trap
            - environmental
          description: Type of combat entity
        status:
          type: string
          enum:
            - active
            - inactive
            - destroyed
            - spawning
          description: Entity status
        ai_state:
          type: string
          enum:
            - idle
            - patrolling
            - chasing
            - attacking
            - fleeing
            - stunned
          description: AI behavior state
        last_update:
          type: string
          format: date-time
          description: Last state update timestamp
        health:
          $ref: '#/components/schemas/HealthState'
        position:
          $ref: '#/components/schemas/Vector3'
        rotation:
          $ref: '#/components/schemas/Vector3'
        velocity:
          $ref: '#/components/schemas/Vector3'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EnvironmentState:
      type: object
      properties:
        weather:
          type: string
          enum:
            - clear
            - rainy
            - stormy
            - foggy
            - snowy
          description: Current weather conditions
        time_of_day:
          type: string
          format: date-time
          description: Current game time
        active_zones:
          type: array
          items:
            $ref: '#/components/schemas/ZoneState'
          description: Active environmental zones
        destructible_objects:
          type: array
          items:
            $ref: '#/components/schemas/DestructibleObjectState'
          description: States of destructible environment objects
        lighting:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Lighting level (0=dark, 1=bright)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AIState:
      type: object
      required:
        - ai_id
        - behavior_tree_state
        - last_update
      properties:
        ai_id:
          type: string
          format: uuid
          description: AI entity identifier
        last_update:
          type: string
          format: date-time
          description: Last AI state update
        behavior_tree_state:
          type: object
          additionalProperties: true
          description: Current state of AI behavior tree
        decision_context:
          type: object
          properties:
            threat_level:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Perceived threat level
            confidence:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: AI decision confidence
            last_target_seen:
              type: string
              format: date-time
              description: When target was last seen
          description: Context for AI decision making
        pathfinding_state:
          type: object
          properties:
            current_path:
              type: array
              items:
                $ref: '#/components/schemas/Vector3'
              description: Current navigation path
            path_progress:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Progress along current path
            stuck_timer:
              type: number
              format: float
              minimum: 0
              description: Time spent stuck (seconds)
          description: Pathfinding state
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ItemState:
      type: object
      required:
        - item_id
        - item_type
        - position
        - status
      properties:
        item_id:
          type: string
          format: uuid
          description: Item identifier
        owner_id:
          type: string
          format: uuid
          description: Current owner player ID (if picked up)
        item_type:
          type: string
          enum:
            - weapon
            - armor
            - consumable
            - currency
            - quest_item
          description: Type of item
        status:
          type: string
          enum:
            - available
            - picked_up
            - destroyed
            - respawning
          description: Item availability status
        position:
          $ref: '#/components/schemas/Vector3'
        rotation:
          $ref: '#/components/schemas/Vector3'
        respawn_timer:
          type: integer
          minimum: 0
          description: Time until respawn (seconds)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EffectState:
      type: object
      required:
        - effect_id
        - effect_type
        - position
        - radius
        - duration
        - remaining_time
      properties:
        effect_id:
          type: string
          format: uuid
          description: Effect identifier
        effect_type:
          type: string
          enum:
            - damage_over_time
            - healing
            - buff
            - debuff
            - environmental
          description: Type of effect
        parameters:
          type: object
          additionalProperties: true
          description: Effect-specific parameters
        position:
          $ref: '#/components/schemas/Vector3'
        affected_entities:
          type: array
          items:
            type: string
            format: uuid
          description: IDs of affected entities
        radius:
          type: number
          format: float
          minimum: 0
          description: Effect radius
        duration:
          type: number
          format: float
          minimum: 0
          description: Total effect duration (seconds)
        remaining_time:
          type: number
          format: float
          minimum: 0
          description: Remaining effect time (seconds)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StateChange:
      type: object
      required:
        - change_id
        - change_type
        - timestamp
        - entity_id
      properties:
        change_id:
          type: string
          format: uuid
          description: Change identifier
        entity_id:
          type: string
          format: uuid
          description: Affected entity ID
        change_reason:
          type: string
          description: Reason for the change
        change_type:
          type: string
          enum:
            - position_update
            - health_change
            - status_change
            - equipment_change
            - effect_applied
            - effect_removed
          description: Type of state change
        timestamp:
          type: string
          format: date-time
          description: Change timestamp
        previous_value:
          type: object
          additionalProperties: true
          description: Previous state value
        new_value:
          type: object
          additionalProperties: true
          description: New state value
        metadata:
          type: object
          additionalProperties: true
          description: Additional change metadata
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EquipmentItem:
      type: object
      required:
        - item_id
        - slot
        - item_type
      properties:
        item_id:
          type: string
          format: uuid
          description: Equipment item identifier
        item_type:
          type: string
          description: Type of equipment item
        slot:
          type: string
          enum:
            - weapon_primary
            - weapon_secondary
            - armor_head
            - armor_body
            - armor_legs
            - accessory1
            - accessory2
          description: Equipment slot
        durability:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Item durability (0=broken, 1=perfect)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StatusEffect:
      type: object
      required:
        - effect_id
        - effect_type
        - duration
        - remaining_time
      properties:
        effect_id:
          type: string
          format: uuid
          description: Status effect identifier
        name:
          type: string
          description: Effect name
        effect_type:
          type: string
          enum:
            - buff
            - debuff
          description: Effect type
        parameters:
          type: object
          additionalProperties: true
          description: Effect parameters (damage per second, etc.)
        duration:
          type: number
          format: float
          minimum: 0
          description: Total effect duration (seconds)
        remaining_time:
          type: number
          format: float
          minimum: 0
          description: Remaining effect time (seconds)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ZoneState:
      type: object
      required:
        - zone_id
        - zone_type
        - bounds
        - active
      properties:
        zone_id:
          type: string
          format: uuid
          description: Zone identifier
        zone_type:
          type: string
          enum:
            - safe
            - danger
            - objective
            - restricted
          description: Type of zone
        bounds:
          type: object
          properties:
            center:
              $ref: '#/components/schemas/Vector3'
            radius:
              type: number
              format: float
              minimum: 0
              description: Zone radius
          description: Zone boundaries
        properties:
          type: object
          additionalProperties: true
          description: Zone-specific properties
        active:
          type: boolean
          description: Whether zone is currently active
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DestructibleObjectState:
      type: object
      required:
        - object_id
        - position
        - health
        - destroyed
      properties:
        object_id:
          type: string
          format: uuid
          description: Object identifier
        health:
          $ref: '#/components/schemas/HealthState'
        position:
          $ref: '#/components/schemas/Vector3'
        respawn_timer:
          type: integer
          minimum: 0
          description: Time until respawn (seconds)
        destroyed:
          type: boolean
          description: Whether object is destroyed
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Vector2:
      type: object
      required:
        - x
        - y
      properties:
        x:
          type: number
          format: float
          description: X coordinate
        y:
          type: number
          format: float
          description: Y coordinate
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Vector3:
      type: object
      required:
        - x
        - y
        - z
      properties:
        x:
          type: number
          format: float
          description: X coordinate
        y:
          type: number
          format: float
          description: Y coordinate
        z:
          type: number
          format: float
          description: Z coordinate
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    HealthState:
      type: object
      required:
        - current
        - maximum
      properties:
        current:
          type: integer
          minimum: 0
          description: Current health points
        maximum:
          type: integer
          minimum: 1
          description: Maximum health points
        shields:
          type: integer
          minimum: 0
          description: Current shield points
        regeneration_rate:
          type: number
          format: float
          minimum: 0
          description: Health regeneration per second
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Error:
      type: object
      required:
        - error
        - message
        - timestamp
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        request_id:
          type: string
          description: Request identifier for tracing
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
        details:
          type: object
          additionalProperties: true
          description: Additional error details
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
