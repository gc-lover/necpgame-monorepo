# Issue: #1993
openapi: 3.0.3
info:
  title: World Service API
  description: |
    API для управления игровым миром в NECPGAME MMOFPS RPG.

    **Основные возможности:**
    - Управление локациями и зонами
    - Динамические события мира
    - NPC и интерактивные объекты
    - Погода и время суток
    - Мировые квесты и события

    **BACKEND NOTE:** Struct field alignment optimized (large → small types).
    All schemas ordered for optimal memory layout in generated Go code.
  version: 1.0.0
  license:
    name: Proprietary
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@world.necpgame.com
servers:
  - url: http://localhost:8086/api/v1
    description: World Service (локальная разработка)
  - url: https://world.necpgame.com/api/v1
    description: World Service (продакшн)
tags:
  - name: World Management
    description: Управление миром
  - name: Location Management
    description: Управление локациями
  - name: Event Management
    description: События мира
  - name: NPC Management
    description: Управление NPC
  - name: Weather Management
    description: Погода и окружение
paths:
  /world/health:
    get:
      tags:
        - World Management
      summary: Health check for World Service
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  service:
                    type: string
                    example: "world-service"
                  version:
                    type: string
                    example: "1.0.0"

  /world/locations:
    get:
      tags:
        - Location Management
      summary: Получить список локаций
      description: |
        Возвращает список доступных локаций с фильтрацией.
        Поддерживает поиск по региону, типу, уровню.
      operationId: getLocations
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: region
          in: query
          description: Фильтр по региону
          schema:
            type: string
            enum: [north_america, europe, asia, south_america, australia]
        - name: location_type
          in: query
          description: Тип локации
          schema:
            type: string
            enum: [city, wilderness, dungeon, instance, pvp_zone]
        - name: min_level
          in: query
          description: Минимальный уровень
          schema:
            type: integer
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Список локаций
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetLocationsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/locations/{location_id}:
    get:
      tags:
        - Location Management
      summary: Получить информацию о локации
      description: |
        Возвращает детальную информацию о локации.
        Включает NPC, объекты, события, погоду.
      operationId: getLocation
      security:
        - BearerAuth: []
      parameters:
        - name: location_id
          in: path
          required: true
          description: ID локации
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о локации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetLocationResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/locations/{location_id}/npcs:
    get:
      tags:
        - NPC Management
      summary: Получить NPC в локации
      description: Возвращает список NPC в указанной локации.
      operationId: getLocationNPCs
      security:
        - BearerAuth: []
      parameters:
        - name: location_id
          in: path
          required: true
          description: ID локации
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: npc_type
          in: query
          description: Тип NPC
          schema:
            type: string
            enum: [merchant, quest_giver, trainer, guard, civilian]
      responses:
        '200':
          description: Список NPC
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetNPCsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/events:
    get:
      tags:
        - Event Management
      summary: Получить активные события мира
      description: |
        Возвращает список активных мировых событий.
        Фильтрация по типу, региону, времени.
      operationId: getWorldEvents
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - name: event_type
          in: query
          description: Тип события
          schema:
            type: string
            enum: [raid, invasion, festival, weather, disaster, quest]
        - name: region
          in: query
          description: Регион события
          schema:
            type: string
            enum: [north_america, europe, asia, south_america, australia]
        - name: status
          in: query
          description: Статус события
          schema:
            type: string
            enum: [upcoming, active, completed]
      responses:
        '200':
          description: Список событий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetWorldEventsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Event Management
      summary: Создать событие мира
      description: |
        Создает новое событие мира (требует админ прав).
        Используется для запуска динамических событий.
      operationId: createWorldEvent
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorldEventRequest'
      responses:
        '201':
          description: Событие создано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateWorldEventResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/weather:
    get:
      tags:
        - Weather Management
      summary: Получить текущую погоду
      description: Возвращает информацию о погоде по регионам.
      operationId: getWeather
      security:
        - BearerAuth: []
      parameters:
        - name: region
          in: query
          description: Регион для погоды
          schema:
            type: string
            enum: [north_america, europe, asia, south_america, australia]
        - name: location_id
          in: query
          description: Конкретная локация
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о погоде
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetWeatherResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Weather Management
      summary: Обновить погоду
      description: |
        Изменяет погодные условия (требует админ прав).
        Используется для создания динамических эффектов.
      operationId: updateWeather
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWeatherRequest'
      responses:
        '200':
          description: Погода обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateWeatherResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /world/time:
    get:
      tags:
        - World Management
      summary: Получить игровое время
      description: Возвращает текущее игровое время и информацию о времени суток.
      operationId: getWorldTime
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Игровое время
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetWorldTimeResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    Page:
      name: page
      in: query
      description: Номер страницы (начиная с 1)
      schema:
        type: integer
        minimum: 1
        default: 1
    Limit:
      name: limit
      in: query
      description: Количество элементов на странице
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

  responses:
    BadRequest:
      description: Некорректный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Недостаточно прав доступа
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
