# Automatic pprof Port Assignment

## Issue: #1584

Автоматическое назначение портов для pprof на основе детерминированного hash от имени сервиса.

## Преимущества

OK **Нет хардкода** - порты генерируются автоматически  
OK **Детерминированно** - один и тот же сервис всегда получает один порт  
OK **Автоматическое разрешение коллизий** - если два сервиса получают один порт, алгоритм автоматически находит
свободный  
OK **Не нужно обновлять конфиг** - просто запусти скрипт

## Использование

### Проверка конфликтов (dry-run)

```bash
python scripts/assign-pprof-ports-auto.py --dry-run
```

### Автоматическое исправление всех портов

```bash
python scripts/assign-pprof-ports-auto.py
```

### Генерация конфига (опционально)

```bash
python scripts/assign-pprof-ports-auto.py --generate-config
```

## Алгоритм

1. **Hash от имени сервиса**: Используется SHA256 для генерации детерминированного числа
2. **Маппинг в диапазон**: Порты в диапазоне 6060-6999 (940 портов)
3. **Разрешение коллизий**: Если порт занят, используется offset для генерации нового

## Пример

```python
# Сервис: matchmaking-go
# Hash: SHA256("matchmaking-go")
# Порт: 6498 (детерминированно)

# Сервис: inventory-service-go  
# Hash: SHA256("inventory-service-go")
# Порт: 6819 (детерминированно)
```

## Сравнение подходов

### Ручной конфиг (`infrastructure/pprof-ports.yaml`)

- OK Полный контроль
- ❌ Нужно обновлять при добавлении сервисов
- ❌ Легко забыть добавить новый сервис

### Автоматическая генерация (`scripts/assign-pprof-ports-auto.py`)

- OK Автоматически для всех сервисов
- OK Не нужно обновлять конфиг
- OK Автоматическое разрешение коллизий
- WARNING Порты могут быть не последовательными (но это не проблема)

## Рекомендация

**Используй автоматическую генерацию** для новых сервисов - просто запусти скрипт и все порты будут назначены
автоматически!

