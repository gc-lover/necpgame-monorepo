# Alerting Rules for ogen Services
# Issue: #143576311 - [QA] ogen Migration: Comprehensive Testing Strategy & Performance Validation Framework

groups:
  - name: ogen_service_alerts
    rules:

    # High latency alerts
    - alert: OgenHighLatency
      expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.05
      for: 5m
      labels:
        severity: warning
        service: ogen
      annotations:
        summary: "High latency detected on ogen service"
        description: "95th percentile response time > 50ms for 5 minutes"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-latency"

    - alert: OgenVeryHighLatency
      expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.1
      for: 2m
      labels:
        severity: critical
        service: ogen
      annotations:
        summary: "Very high latency on ogen service"
        description: "95th percentile response time > 100ms for 2 minutes"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-latency-critical"

    # Error rate alerts
    - alert: OgenHighErrorRate
      expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.05
      for: 5m
      labels:
        severity: warning
        service: ogen
      annotations:
        summary: "High error rate on ogen service"
        description: "Error rate > 5% for 5 minutes"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-errors"

    - alert: OgenCriticalErrorRate
      expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.1
      for: 2m
      labels:
        severity: critical
        service: ogen
      annotations:
        summary: "Critical error rate on ogen service"
        description: "Error rate > 10% for 2 minutes"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-errors-critical"

    # Resource usage alerts
    - alert: OgenHighMemoryUsage
      expr: process_resident_memory_bytes / 1024 / 1024 > 512
      for: 5m
      labels:
        severity: warning
        service: ogen
      annotations:
        summary: "High memory usage on ogen service"
        description: "Memory usage > 512MB for 5 minutes"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-memory"

    - alert: OgenHighCPUUsage
      expr: rate(process_cpu_user_seconds_total[5m]) * 100 > 70
      for: 5m
      labels:
        severity: warning
        service: ogen
      annotations:
        summary: "High CPU usage on ogen service"
        description: "CPU usage > 70% for 5 minutes"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-cpu"

    # Database connection alerts
    - alert: OgenDBConnectionIssues
      expr: increase(ogen_db_connection_errors_total[5m]) > 5
      for: 2m
      labels:
        severity: warning
        service: ogen
      annotations:
        summary: "Database connection issues on ogen service"
        description: "More than 5 database connection errors in 5 minutes"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-db-connections"

    # Service availability alerts
    - alert: OgenServiceDown
      expr: up{job=~"ogen-.*-service"} == 0
      for: 1m
      labels:
        severity: critical
        service: ogen
      annotations:
        summary: "ogen service is down"
        description: "Service has been down for 1 minute"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-service-down"

    # Performance regression alerts
    - alert: OgenPerformanceRegression
      expr: increase(ogen_performance_regression_detected_total[1h]) > 0
      for: 0m
      labels:
        severity: warning
        service: ogen
      annotations:
        summary: "Performance regression detected"
        description: "Automated performance tests detected regression"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-regression"

    # Load testing alerts
    - alert: OgenLoadTestFailure
      expr: increase(ogen_load_test_failures_total[1h]) > 0
      for: 0m
      labels:
        severity: critical
        service: ogen
      annotations:
        summary: "Load test failure detected"
        description: "Automated load tests failed"
        runbook_url: "https://docs.necpgame.com/monitoring/ogen-load-test-failure"





