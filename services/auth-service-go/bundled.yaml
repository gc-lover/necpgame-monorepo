openapi: 3.0.3
info:
  title: Auth Service API
  description: '**Enterprise-grade API for Authentication & Authorization**


    ## Domain Purpose

    Core authentication service providing secure user login, registration, session
    management,

    and authorization for the NECPGAME platform. Handles OAuth integrations and multi-factor
    authentication.


    ## Business Value

    - Secure user access to all platform services

    - OAuth integration with external providers

    - Multi-factor authentication support

    - Session security and audit trails

    - Rate limiting and fraud prevention


    ## Performance Targets

    - P99 Latency: <50ms for all endpoints

    - Memory per Instance: <50KB baseline

    - Concurrent Users: 10,000+ supported

    - Uptime: 99.9% SLA


    ## Domain Inheritance

    This service inherits from infrastructure-entities.yaml providing:

    - UserAccountEntity for user management

    - SessionEntity for session handling

    - AuditLogEntity for security auditing

    - ApiKeyEntity for third-party access

    - Optimistic locking for concurrent operations

    - Strict typing with validation rules

    '
  version: 1.0.0
  contact:
    name: NECPGAME API Team
    email: api@necpgame.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
- url: https://api.necpgame.com/v1/auth-service
  description: Production environment
- url: https://staging-api.necpgame.com/v1/auth-service
  description: Staging environment
- url: http://localhost:8080/api/v1/auth-service
  description: Local development
security:
- BearerAuth: []
tags:
- name: Authentication
  description: Core authentication operations
- name: Authorization
  description: User permissions and access control
- name: Sessions
  description: Session management operations
- name: OAuth
  description: External OAuth provider integrations
- name: Security
  description: Security and audit operations
- name: Health Monitoring
  description: Service health and performance monitoring
- name: Administration
  description: Administrative operations
paths:
  /health:
    $ref: ./paths/health.yaml#/paths/~1health
  /health/detailed:
    $ref: ./paths/health-detailed.yaml#/paths/~1health~1detailed
  /health/batch:
    $ref: ./paths/health-batch.yaml#/paths/~1health~1batch
  /health/ws:
    $ref: ./paths/health-ws.yaml#/paths/~1health~1ws
  /auth/login:
    $ref: ./paths/auth-login.yaml#/paths/~1auth~1login
  /auth/register:
    $ref: ./paths/auth-register.yaml#/paths/~1auth~1register
  /auth/verify-email:
    $ref: ./paths/auth-verify-email.yaml#/paths/~1auth~1verify-email
  /auth/logout:
    $ref: ./paths/auth-logout.yaml#/paths/~1auth~1logout
  /auth/refresh:
    $ref: ./paths/auth-refresh.yaml#/paths/~1auth~1refresh
  /auth/forgot-password:
    $ref: ./paths/auth-forgot-password.yaml#/paths/~1auth~1forgot-password
  /auth/reset-password:
    $ref: ./paths/auth-reset-password.yaml#/paths/~1auth~1reset-password
  /sessions:
    $ref: ./paths/sessions.yaml#/paths/~1sessions
  /sessions/{sessionId}/revoke:
    $ref: ./paths/sessions-{sessionId}-revoke.yaml#/paths/~1sessions~1{sessionId}~1revoke
  /oauth/{provider}/authorize:
    $ref: ./paths/oauth-{provider}-authorize.yaml#/paths/~1oauth~1{provider}~1authorize
  /oauth/{provider}/callback:
    $ref: ./paths/oauth-{provider}-callback.yaml#/paths/~1oauth~1{provider}~1callback
components:
  schemas:
    UserAccount:
      description: Complete user account entity with infrastructure domain inheritance
      allOf:
      - $ref: ../common/schemas/infrastructure-entities.yaml#/UserAccountEntity
      - type: object
        properties:
          auth_provider_data:
            type: object
            description: OAuth provider specific data
            properties:
              google_id:
                type: string
                description: Google OAuth user ID
              discord_id:
                type: string
                description: Discord user ID
              steam_id:
                type: string
                description: Steam user ID
          last_password_change:
            type: string
            format: date-time
            description: When password was last changed
          password_reset_tokens:
            type: array
            items:
              type: object
              properties:
                token:
                  type: string
                  description: Reset token hash
                expires_at:
                  type: string
                  format: date-time
                  description: Token expiration
                used:
                  type: boolean
                  description: Whether token was used
    Session:
      description: Complete session entity with infrastructure domain inheritance
      allOf:
      - $ref: ../common/schemas/infrastructure-entities.yaml#/SessionEntity
      - type: object
        properties:
          oauth_provider:
            type: string
            enum:
            - google
            - discord
            - steam
            - email_password
            description: How session was created
          mfa_verified:
            type: boolean
            description: Whether MFA was verified for this session
            example: true
    ApiKey:
      description: Complete API key entity with infrastructure domain inheritance
      allOf:
      - $ref: ../common/schemas/infrastructure-entities.yaml#/ApiKeyEntity
      - type: object
        properties:
          scopes:
            type: array
            items:
              type: string
              enum:
              - read
              - write
              - admin
              - analytics
            description: API key permission scopes
    UserAccountSummary:
      description: Summary user account for authentication responses
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User account ID
        username:
          type: string
          description: Username
        email:
          type: string
          format: email
          description: Email address
        account_status:
          type: string
          enum:
          - active
          - suspended
          - banned
          - pending_verification
          description: Account status
        email_verified:
          type: boolean
          description: Email verification status
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp
    SessionSummary:
      description: Summary session for session management
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Session ID
        ip_address:
          type: string
          description: Client IP address
        user_agent:
          type: string
          description: Client user agent
        created_at:
          type: string
          format: date-time
          description: Session creation time
        last_activity_at:
          type: string
          format: date-time
          description: Last activity timestamp
        is_active:
          type: boolean
          description: Whether session is active
    LoginRequest:
      description: Request payload for user login
      type: object
      required:
      - identifier
      - password
      properties:
        identifier:
          type: string
          description: Username or email for login
          example: nightrunner2077
        password:
          type: string
          format: password
          minLength: 8
          description: User password
        remember_me:
          type: boolean
          description: Whether to extend session duration
          default: false
        mfa_code:
          type: string
          pattern: ^[0-9]{6}$
          description: 6-digit MFA code if enabled
    RegisterRequest:
      description: Request payload for user registration
      type: object
      required:
      - username
      - email
      - password
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 30
          pattern: ^[a-zA-Z0-9_-]+$
          description: Unique username
          example: nightrunner2077
        email:
          type: string
          format: email
          description: Email address
          example: nightrunner@necpgame.com
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: Password (server validates complexity)
          example: MySecureP@ssw0rd123
        preferred_language:
          type: string
          enum:
          - en
          - es
          - zh
          - ja
          - ru
          - de
          - fr
          - pl
          - ko
          - pt
          description: User's preferred language
          default: en
        terms_accepted:
          type: boolean
          description: Whether terms of service were accepted
          example: true
        marketing_consent:
          type: boolean
          description: Consent for marketing communications
          example: false
    VerifyEmailRequest:
      description: Request payload for email verification
      type: object
      required:
      - token
      properties:
        token:
          type: string
          minLength: 32
          description: Email verification token
          example: abc123def456...
    RefreshTokenRequest:
      description: Request payload for token refresh
      type: object
      required:
      - refresh_token
      properties:
        refresh_token:
          type: string
          description: JWT refresh token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ForgotPasswordRequest:
      description: Request payload for password reset initiation
      type: object
      required:
      - email
      properties:
        email:
          type: string
          format: email
          description: Account email address
          example: nightrunner@necpgame.com
    ResetPasswordRequest:
      description: Request payload for password reset completion
      type: object
      required:
      - token
      - new_password
      properties:
        token:
          type: string
          minLength: 32
          description: Password reset token
          example: reset_abc123...
        new_password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: New password
          example: NewSecureP@ssw0rd456
    AuthConfiguration:
      description: Auth service configuration entity
      allOf:
      - $ref: ../common/schemas/infrastructure-entities.yaml#/ConfigurationEntity
      - type: object
        properties:
          auth_settings:
            type: object
            description: Authentication-specific settings
            properties:
              password_min_length:
                type: integer
                minimum: 8
                maximum: 128
                description: Minimum password length
              session_timeout_hours:
                type: integer
                minimum: 1
                maximum: 168
                description: Session timeout in hours
              max_failed_attempts:
                type: integer
                minimum: 3
                maximum: 10
                description: Max failed login attempts before lockout
              lockout_duration_minutes:
                type: integer
                minimum: 5
                maximum: 1440
                description: Account lockout duration
    AuthAuditLog:
      description: Audit trail for authentication operations
      allOf:
      - $ref: ../common/schemas/infrastructure-entities.yaml#/AuditLogEntity
      - type: object
        properties:
          user_id:
            type: string
            format: uuid
            description: Associated user account ID
          operation_type:
            type: string
            enum:
            - login
            - logout
            - register
            - verify_email
            - password_reset
            - session_revoke
            - oauth_login
            description: Type of authentication operation performed
  responses:
    OK:
      $ref: ../common/responses/success.yaml#/OK
    Created:
      $ref: ../common/responses/success.yaml#/Created
    Updated:
      $ref: ../common/responses/success.yaml#/Updated
    Deleted:
      $ref: ../common/responses/success.yaml#/Deleted
    UserAccountActionSuccess:
      description: User account action completed successfully
      content:
        application/json:
          schema:
            allOf:
            - $ref: ../common/responses/success.yaml#/ActionSuccess
            - type: object
              properties:
                data:
                  type: object
                  properties:
                    user_account_id:
                      type: string
                      format: uuid
                      description: ID of the affected user account
                    action_result:
                      type: object
                      description: Result of the action performed
    BadRequest:
      $ref: ../common/responses/error.yaml#/BadRequest
    Unauthorized:
      $ref: ../common/responses/error.yaml#/Unauthorized
    Forbidden:
      $ref: ../common/responses/error.yaml#/Forbidden
    NotFound:
      $ref: ../common/responses/error.yaml#/NotFound
    Conflict:
      $ref: ../common/responses/error.yaml#/Conflict
    TooManyRequests:
      $ref: ../common/responses/error.yaml#/TooManyRequests
    InternalServerError:
      $ref: ../common/responses/error.yaml#/InternalServerError
  securitySchemes:
    BearerAuth:
      $ref: ../common/security/security.yaml#/BearerAuth
    ApiKeyAuth:
      $ref: ../common/security/security.yaml#/ApiKeyAuth
    ServiceAuth:
      $ref: ../common/security/security.yaml#/ServiceAuth
