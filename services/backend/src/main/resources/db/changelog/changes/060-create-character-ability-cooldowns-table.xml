<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">
    <changeSet id="060-create-character-ability-cooldowns-table" author="system">
        <preConditions onFail="MARK_RAN"><not><tableExists tableName="character_ability_cooldowns"/></not></preConditions>
        <createTable tableName="character_ability_cooldowns">
            <column name="id" type="UUID"><constraints primaryKey="true" nullable="false"/></column>
            <column name="character_id" type="UUID"><constraints nullable="false"/></column>
            <column name="ability_id" type="VARCHAR(100)"><constraints nullable="false"/></column>
            <column name="used_at" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="ready_at" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="remaining_charges" type="INT"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"><constraints nullable="false"/></column>
        </createTable>
        <addForeignKeyConstraint baseTableName="character_ability_cooldowns" baseColumnNames="character_id" constraintName="fk_character_ability_cooldowns_character" referencedTableName="characters" referencedColumnNames="id" onDelete="CASCADE"/>
        <addForeignKeyConstraint baseTableName="character_ability_cooldowns" baseColumnNames="ability_id" constraintName="fk_character_ability_cooldowns_ability" referencedTableName="abilities" referencedColumnNames="id" onDelete="CASCADE"/>
        <createIndex tableName="character_ability_cooldowns" indexName="idx_character_ability_cooldowns_character"><column name="character_id"/></createIndex>
        <createIndex tableName="character_ability_cooldowns" indexName="idx_character_ability_cooldowns_ready"><column name="ready_at"/></createIndex>
        <rollback><dropTable tableName="character_ability_cooldowns"/></rollback>
    </changeSet>
</databaseChangeLog>
