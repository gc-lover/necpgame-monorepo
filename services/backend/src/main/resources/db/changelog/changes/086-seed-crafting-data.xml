<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="086-seed-crafting-data" author="backend-agent">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="crafting_recipes"/>
        </preConditions>

        <insert tableName="crafting_recipes">
            <column name="recipe_id" value="RCP-MANTIS-BLADES"/>
            <column name="name" value="Legendary Mantis Blades"/>
            <column name="description" value="Артефактные клинки, усиливающие ближний бой."/>
            <column name="category" value="WEAPONS"/>
            <column name="tier" value="T5"/>
            <column name="required_skill" value="CRAFTING"/>
            <column name="required_skill_level" valueNumeric="25"/>
            <column name="base_crafting_time_seconds" valueNumeric="420"/>
            <column name="base_success_rate" valueNumeric="0.62"/>
            <column name="components_count" valueNumeric="4"/>
            <column name="station_requirement" value="WEAPONS_BENCH"/>
            <column name="unlock_source" value="Blueprint: Legendary Mantis Blades"/>
            <column name="result_item_id" value="5f0c6d32-9af9-4f2f-a0f2-1e91b1c5b001"/>
            <column name="result_item_name" value="Legendary Mantis Blades"/>
            <column name="result_quality_min" value="EPIC"/>
            <column name="result_quality_max" value="LEGENDARY"/>
        </insert>

        <insert tableName="crafting_recipes">
            <column name="recipe_id" value="RCP-TAC-VEST"/>
            <column name="name" value="Tactical SynFiber Vest"/>
            <column name="description" value="Средняя броня с усиленной синтетической тканью."/>
            <column name="category" value="ARMOR"/>
            <column name="tier" value="T3"/>
            <column name="required_skill" value="CRAFTING"/>
            <column name="required_skill_level" valueNumeric="14"/>
            <column name="base_crafting_time_seconds" valueNumeric="240"/>
            <column name="base_success_rate" valueNumeric="0.74"/>
            <column name="components_count" valueNumeric="3"/>
            <column name="station_requirement" value="ARMOR_BENCH"/>
            <column name="unlock_source" value="Vendor Research Level 3"/>
            <column name="result_item_id" value="5f0c6d32-9af9-4f2f-a0f2-1e91b1c5b002"/>
            <column name="result_item_name" value="SynFiber Vest"/>
            <column name="result_quality_min" value="UNCOMMON"/>
            <column name="result_quality_max" value="EPIC"/>
        </insert>

        <insert tableName="crafting_recipes">
            <column name="recipe_id" value="RCP-NEURAL-BOOSTER"/>
            <column name="name" value="Neural Booster Mk.II"/>
            <column name="description" value="Имплант для ускорения реакции и обработки данных."/>
            <column name="category" value="IMPLANTS"/>
            <column name="tier" value="T4"/>
            <column name="required_skill" value="CRAFTING"/>
            <column name="required_skill_level" valueNumeric="19"/>
            <column name="base_crafting_time_seconds" valueNumeric="360"/>
            <column name="base_success_rate" valueNumeric="0.68"/>
            <column name="components_count" valueNumeric="4"/>
            <column name="station_requirement" value="CYBERWARE_LAB"/>
            <column name="unlock_source" value="Faction Research: Netwatch"/>
            <column name="result_item_id" value="5f0c6d32-9af9-4f2f-a0f2-1e91b1c5b003"/>
            <column name="result_item_name" value="Neural Booster Mk.II"/>
            <column name="result_quality_min" value="RARE"/>
            <column name="result_quality_max" value="EPIC"/>
        </insert>

        <!-- Components for Legendary Mantis Blades -->
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-MANTIS-BLADES"/>
            <column name="component_id" value="11f4a0d1-2bce-4b63-9f36-58a816fbc001"/>
            <column name="component_name" value="Mantis Frame"/>
            <column name="quantity" valueNumeric="1"/>
            <column name="rarity" value="LEGENDARY"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-MANTIS-BLADES"/>
            <column name="component_id" value="11f4a0d1-2bce-4b63-9f36-58a816fbc002"/>
            <column name="component_name" value="Servo Cluster"/>
            <column name="quantity" valueNumeric="2"/>
            <column name="rarity" value="EPIC"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-MANTIS-BLADES"/>
            <column name="component_id" value="11f4a0d1-2bce-4b63-9f36-58a816fbc003"/>
            <column name="component_name" value="Carbon Mesh"/>
            <column name="quantity" valueNumeric="4"/>
            <column name="rarity" value="RARE"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-MANTIS-BLADES"/>
            <column name="component_id" value="11f4a0d1-2bce-4b63-9f36-58a816fbc004"/>
            <column name="component_name" value="Optic Core"/>
            <column name="quantity" valueNumeric="2"/>
            <column name="rarity" value="EPIC"/>
            <column name="alternatives_json" valueComputed="'[{"componentId":"11f4a0d1-2bce-4b63-9f36-58a816fbc005","quantity":3}]'::jsonb"/>
        </insert>

        <!-- Components for SynFiber Vest -->
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-TAC-VEST"/>
            <column name="component_id" value="22f4a0d1-2bce-4b63-9f36-58a816fbc006"/>
            <column name="component_name" value="SynFiber Roll"/>
            <column name="quantity" valueNumeric="3"/>
            <column name="rarity" value="RARE"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-TAC-VEST"/>
            <column name="component_id" value="22f4a0d1-2bce-4b63-9f36-58a816fbc007"/>
            <column name="component_name" value="Reactive Plate"/>
            <column name="quantity" valueNumeric="2"/>
            <column name="rarity" value="UNCOMMON"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-TAC-VEST"/>
            <column name="component_id" value="22f4a0d1-2bce-4b63-9f36-58a816fbc008"/>
            <column name="component_name" value="Smart Threads"/>
            <column name="quantity" valueNumeric="2"/>
            <column name="rarity" value="RARE"/>
        </insert>

        <!-- Components for Neural Booster -->
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-NEURAL-BOOSTER"/>
            <column name="component_id" value="33f4a0d1-2bce-4b63-9f36-58a816fbc009"/>
            <column name="component_name" value="Neural Matrix"/>
            <column name="quantity" valueNumeric="1"/>
            <column name="rarity" value="EPIC"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-NEURAL-BOOSTER"/>
            <column name="component_id" value="33f4a0d1-2bce-4b63-9f36-58a816fbc00a"/>
            <column name="component_name" value="Quantum Microcapacitors"/>
            <column name="quantity" valueNumeric="3"/>
            <column name="rarity" value="RARE"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-NEURAL-BOOSTER"/>
            <column name="component_id" value="33f4a0d1-2bce-4b63-9f36-58a816fbc00b"/>
            <column name="component_name" value="Cooling Nano Gel"/>
            <column name="quantity" valueNumeric="2"/>
            <column name="rarity" value="UNCOMMON"/>
        </insert>
        <insert tableName="crafting_recipe_components">
            <column name="id" valueComputed="gen_random_uuid()"/>
            <column name="recipe_id" value="RCP-NEURAL-BOOSTER"/>
            <column name="component_id" value="33f4a0d1-2bce-4b63-9f36-58a816fbc00c"/>
            <column name="component_name" value="Encrypted Datashard"/>
            <column name="quantity" valueNumeric="1"/>
            <column name="rarity" value="RARE"/>
        </insert>

        <!-- Crafting stations -->
        <insert tableName="crafting_stations">
            <column name="station_id" value="station_weapons_bench_prime"/>
            <column name="name" value="Weapons Bench Prime"/>
            <column name="station_type" value="WEAPONS_BENCH"/>
            <column name="location_id" value="NC-SMITHERY-01"/>
            <column name="available" valueBoolean="true"/>
            <column name="success_rate_bonus" valueNumeric="0.08"/>
            <column name="time_reduction" valueNumeric="0.12"/>
            <column name="quality_chance_bonus" valueNumeric="0.05"/>
        </insert>
        <insert tableName="crafting_stations">
            <column name="station_id" value="station_armor_bench_secure"/>
            <column name="name" value="Secure Armor Bench"/>
            <column name="station_type" value="ARMOR_BENCH"/>
            <column name="location_id" value="NC-ARMORY-02"/>
            <column name="available" valueBoolean="true"/>
            <column name="success_rate_bonus" valueNumeric="0.05"/>
            <column name="time_reduction" valueNumeric="0.10"/>
            <column name="quality_chance_bonus" valueNumeric="0.03"/>
        </insert>
        <insert tableName="crafting_stations">
            <column name="station_id" value="station_cyberware_lab_orbit"/>
            <column name="name" value="Orbit Cyberware Lab"/>
            <column name="station_type" value="CYBERWARE_LAB"/>
            <column name="location_id" value="NC-BIO-03"/>
            <column name="available" valueBoolean="true"/>
            <column name="success_rate_bonus" valueNumeric="0.06"/>
            <column name="time_reduction" valueNumeric="0.08"/>
            <column name="quality_chance_bonus" valueNumeric="0.04"/>
        </insert>

        <rollback>
            <delete tableName="crafting_recipe_components">
                <where>recipe_id IN ('RCP-MANTIS-BLADES','RCP-TAC-VEST','RCP-NEURAL-BOOSTER')</where>
            </delete>
            <delete tableName="crafting_recipes">
                <where>recipe_id IN ('RCP-MANTIS-BLADES','RCP-TAC-VEST','RCP-NEURAL-BOOSTER')</where>
            </delete>
            <delete tableName="crafting_stations">
                <where>station_id IN ('station_weapons_bench_prime','station_armor_bench_secure','station_cyberware_lab_orbit')</where>
            </delete>
        </rollback>
    </changeSet>

</databaseChangeLog>
