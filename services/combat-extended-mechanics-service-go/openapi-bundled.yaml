openapi: 3.0.3
info:
  title: Combat Extended Mechanics Service API
  description: |
    API для расширенных механик боевой системы NECPGAME.

    **Основные возможности:**
    - Интеграция взлома в бой (hacking combat integration)
    - Управление боевыми имплантами
    - Продвинутая стрельба (advanced shooting)
    - Управление лоадаутами
    - Оркестрация боевых механик

    **Компоненты:**
    - Hacking Combat Integration - взлом в бою
    - Implant Combat System - боевые импланты
    - Advanced Shooting System - продвинутая стрельба
    - Loadout Management System - управление лоадаутами
    - Combat Mechanics Orchestrator - оркестратор механик
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8083/api/v1
    description: Gameplay Service (локальная разработка)
  - url: https://api.necp.game/api/v1
    description: Gameplay Service (продакшн)
security:
  - BearerAuth: []
tags:
  - name: Hacking Combat
    description: Интеграция взлома в бой
  - name: Implant Combat
    description: Боевые импланты
  - name: Advanced Shooting
    description: Продвинутая стрельба
  - name: Loadouts
    description: Управление лоадаутами
  - name: Mechanics Orchestration
    description: Оркестрация боевых механик
paths:
  /gameplay/combat/hacking/execute:
    post:
      tags:
        - Hacking Combat
      summary: Выполнить взлом в бою
      description: |
        Выполняет взлом цели в боевой сессии.
        Интегрирует взлом с боевой системой, применяет эффекты к целям.
      operationId: executeCombatHacking
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatHackingRequest'
      responses:
        '200':
          description: Взлом выполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatHackingResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/hacking/networks:
    get:
      tags:
        - Hacking Combat
      summary: Получить доступные сети для взлома
      description: |
        Возвращает список доступных сетей для взлома в текущей боевой сессии.
      operationId: getCombatHackingNetworks
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор боевой сессии
      responses:
        '200':
          description: Список доступных сетей
          content:
            application/json:
              schema:
                type: object
                properties:
                  networks:
                    type: array
                    items:
                      $ref: '#/components/schemas/CombatHackingNetwork'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants/activate:
    post:
      tags:
        - Implant Combat
      summary: Активировать имплант в бою
      description: |
        Активирует имплант в боевой сессии и применяет эффекты.
      operationId: activateCombatImplant
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatImplantActivationRequest'
      responses:
        '200':
          description: Имплант активирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatImplantActivationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Имплант недоступен (лимиты, энергия)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants/effects:
    get:
      tags:
        - Implant Combat
      summary: Получить эффекты активных имплантов
      description: |
        Возвращает список активных эффектов имплантов в текущей боевой сессии.
      operationId: getCombatImplantEffects
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор боевой сессии
      responses:
        '200':
          description: Список эффектов имплантов
          content:
            application/json:
              schema:
                type: object
                properties:
                  effects:
                    type: array
                    items:
                      $ref: '#/components/schemas/CombatImplantEffect'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/shooting/advanced/aim:
    post:
      tags:
        - Advanced Shooting
      summary: Продвинутое прицеливание
      description: |
        Выполняет продвинутое прицеливание с учетом точности, отдачи и модификаторов.
      operationId: advancedAim
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdvancedAimRequest'
      responses:
        '200':
          description: Прицеливание выполнено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdvancedAimResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/shooting/advanced/recoil:
    post:
      tags:
        - Advanced Shooting
      summary: Управление отдачей
      description: |
        Управляет отдачей оружия с учетом навыков и модификаторов.
      operationId: controlRecoil
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecoilControlRequest'
      responses:
        '200':
          description: Отдача обработана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecoilControlResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/loadouts:
    get:
      tags:
        - Loadouts
      summary: Получить лоадауты
      description: |
        Возвращает список лоадаутов персонажа для боевой системы.
      operationId: getCombatLoadouts
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Список лоадаутов
          content:
            application/json:
              schema:
                type: object
                properties:
                  loadouts:
                    type: array
                    items:
                      $ref: '#/components/schemas/CombatLoadout'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Loadouts
      summary: Создать или обновить лоадаут
      description: |
        Создает новый лоадаут или обновляет существующий.
        Включает оружие, способности, импланты и оборудование.
      operationId: createOrUpdateCombatLoadout
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatLoadoutCreate'
      responses:
        '200':
          description: Лоадаут обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatLoadout'
        '201':
          description: Лоадаут создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatLoadout'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/loadouts/equip:
    post:
      tags:
        - Loadouts
      summary: Экипировать лоадаут
      description: |
        Экипирует лоадаут для персонажа в боевой сессии.
        Активирует все компоненты лоадаута (оружие, способности, импланты).
      operationId: equipCombatLoadout
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CombatLoadoutEquipRequest'
      responses:
        '200':
          description: Лоадаут экипирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/mechanics/status:
    get:
      tags:
        - Mechanics Orchestration
      summary: Получить статус всех механик
      description: |
        Возвращает статус всех расширенных механик в боевой сессии:
        - Активные импланты и их эффекты
        - Доступные сети для взлома
        - Статус продвинутой стрельбы
        - Активный лоадаут
      operationId: getCombatMechanicsStatus
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор боевой сессии
      responses:
        '200':
          description: Статус всех механик
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatMechanicsStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации
  schemas:
    CombatHackingRequest:
      type: object
      required:
        - character_id
        - session_id
        - hacking_type
        - target_id
      properties:
        character_id:
          type: string
          format: uuid
          description: Идентификатор персонажа
        session_id:
          type: string
          format: uuid
          description: Идентификатор боевой сессии
        hacking_type:
          type: string
          enum:
            - disable_implant
            - control_device
            - access_network
            - infrastructure_hack
          description: Тип взлома
        target_id:
          type: string
          format: uuid
          description: Идентификатор цели взлома
        network_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор сети (если требуется)
    CombatHackingResponse:
      type: object
      required:
        - success
        - effects_applied
      properties:
        success:
          type: boolean
          description: Успешность взлома
        effects_applied:
          type: array
          items:
            type: object
            properties:
              effect_type:
                type: string
              target_id:
                type: string
                format: uuid
              duration:
                type: integer
                description: Длительность эффекта в секундах
    CombatHackingNetwork:
      type: object
      required:
        - network_id
        - network_name
        - network_type
        - access_level
      properties:
        network_id:
          type: string
          format: uuid
        network_name:
          type: string
        network_type:
          type: string
          enum:
            - enemy
            - device
            - infrastructure
            - combat_scenario
        access_level:
          type: integer
          minimum: 1
          maximum: 10
        available_demons:
          type: array
          items:
            type: string
    CombatImplantActivationRequest:
      type: object
      required:
        - character_id
        - session_id
        - implant_id
      properties:
        character_id:
          type: string
          format: uuid
        session_id:
          type: string
          format: uuid
        implant_id:
          type: string
          format: uuid
    CombatImplantActivationResponse:
      type: object
      required:
        - activation_id
        - effects_applied
      properties:
        activation_id:
          type: string
          format: uuid
        effects_applied:
          type: array
          items:
            $ref: '#/components/schemas/CombatImplantEffect'
        energy_used:
          type: integer
        humanity_cost:
          type: integer
    CombatImplantEffect:
      type: object
      required:
        - effect_id
        - effect_type
        - applied_at
      properties:
        effect_id:
          type: string
          format: uuid
        effect_type:
          type: string
        implant_id:
          type: string
          format: uuid
        applied_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
          nullable: true
        modifiers:
          type: object
          description: Модификаторы эффекта
    AdvancedAimRequest:
      type: object
      required:
        - character_id
        - weapon_id
        - target_position
      properties:
        character_id:
          type: string
          format: uuid
        weapon_id:
          type: string
          format: uuid
        target_position:
          $ref: '#/components/schemas/Position3D'
        accuracy_modifiers:
          type: object
          nullable: true
    AdvancedAimResponse:
      type: object
      required:
        - accuracy
        - calculated_position
      properties:
        accuracy:
          type: number
          format: float
          minimum: 0
          maximum: 1
        calculated_position:
          $ref: '#/components/schemas/Position3D'
        modifiers_applied:
          type: array
          items:
            type: string
    RecoilControlRequest:
      type: object
      required:
        - character_id
        - weapon_id
        - shots_fired
      properties:
        character_id:
          type: string
          format: uuid
        weapon_id:
          type: string
          format: uuid
        shots_fired:
          type: integer
          minimum: 1
        control_skill:
          type: number
          format: float
          nullable: true
    RecoilControlResponse:
      type: object
      required:
        - recoil_reduction
        - final_spread
      properties:
        recoil_reduction:
          type: number
          format: float
        final_spread:
          type: number
          format: float
        control_applied:
          type: boolean
    CombatLoadout:
      type: object
      required:
        - loadout_id
        - character_id
        - name
        - weapons
        - abilities
        - implants
      properties:
        loadout_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
        name:
          type: string
        weapons:
          type: array
          items:
            type: string
            format: uuid
        abilities:
          type: array
          items:
            type: string
            format: uuid
        implants:
          type: array
          items:
            type: string
            format: uuid
        equipment:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        is_active:
          type: boolean
    CombatLoadoutCreate:
      type: object
      required:
        - character_id
        - name
        - weapons
        - abilities
        - implants
      properties:
        character_id:
          type: string
          format: uuid
        name:
          type: string
        weapons:
          type: array
          items:
            type: string
            format: uuid
        abilities:
          type: array
          items:
            type: string
            format: uuid
        implants:
          type: array
          items:
            type: string
            format: uuid
        equipment:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
    CombatLoadoutEquipRequest:
      type: object
      required:
        - character_id
        - session_id
        - loadout_id
      properties:
        character_id:
          type: string
          format: uuid
        session_id:
          type: string
          format: uuid
        loadout_id:
          type: string
          format: uuid
    CombatMechanicsStatus:
      type: object
      required:
        - character_id
        - session_id
        - active_implants
        - available_networks
        - shooting_status
        - active_loadout
      properties:
        character_id:
          type: string
          format: uuid
        session_id:
          type: string
          format: uuid
        active_implants:
          type: array
          items:
            $ref: '#/components/schemas/CombatImplantEffect'
        available_networks:
          type: array
          items:
            $ref: '#/components/schemas/CombatHackingNetwork'
        shooting_status:
          type: object
          properties:
            weapon_id:
              type: string
              format: uuid
            accuracy:
              type: number
              format: float
            recoil_control:
              type: number
              format: float
        active_loadout:
          $ref: '#/components/schemas/CombatLoadout'
          nullable: true
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Тип ошибки
        message:
          type: string
          description: Сообщение об ошибке
        code:
          type: string
          description: Код ошибки
          nullable: true
        details:
          type: object
          additionalProperties: true
          description: Дополнительные детали ошибки
          nullable: true
    Position3D:
      type: object
      required:
        - x
        - 'y'
        - z
      properties:
        x:
          type: number
          format: float
          description: Координата X
        'y':
          type: number
          format: float
          description: Координата Y
        z:
          type: number
          format: float
          description: Координата Z
    StatusResponse:
      type: object
      properties:
        status:
          type: string
          description: Статус операции
  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: BadRequest
            message: Неверные параметры запроса
            code: INVALID_PARAMETERS
    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Unauthorized
            message: Требуется аутентификация
            code: AUTH_REQUIRED
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: NotFound
            message: Ресурс не найден
            code: RESOURCE_NOT_FOUND
    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: InternalServerError
            message: Внутренняя ошибка сервера
            code: INTERNAL_ERROR
    Conflict:
      description: Конфликт ресурсов
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Conflict
            message: Конфликт ресурсов
            code: RESOURCE_CONFLICT
  parameters:
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 50
      description: Количество элементов на странице
    Offset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Смещение для пагинации
