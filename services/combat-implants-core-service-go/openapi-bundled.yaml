openapi: 3.0.3
info:
  title: Combat Implants Core Service API
  description: |
    API для управления каталогом имплантов, установкой и удалением в NECPGAME.

    **Основные возможности:**
    - Каталог имплантов (типы, бренды, редкость)
    - Установка и удаление имплантов
    - Управление слотами имплантов
    - Информация об установленных имплантах

    **Типы имплантов:**
    - Combat (боевые)
    - Movement (двигательные)
    - OS (операционные системы)
    - Visual (визуальные)
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8083/api/v1
    description: Gameplay Service (локальная разработка)
  - url: https://api.necp.game/api/v1
    description: Gameplay Service (продакшн)
security:
  - BearerAuth: []
tags:
  - name: Implant Catalog
    description: Каталог имплантов
  - name: Implant Installation
    description: Установка и удаление имплантов
  - name: Implant Slots
    description: Управление слотами имплантов
paths:
  /gameplay/combat/implants/catalog:
    get:
      tags:
        - Implant Catalog
      summary: Получить каталог имплантов
      description: |
        Возвращает каталог имплантов с возможностью фильтрации по типу, бренду, редкости.
        Поддерживает пагинацию.
      operationId: getImplantCatalog
      security:
        - BearerAuth: []
      parameters:
        - name: implant_type
          in: query
          schema:
            type: string
            enum:
              - combat
              - movement
              - os
              - visual
          description: Фильтр по типу импланта
        - name: brand
          in: query
          schema:
            type: string
          description: Фильтр по бренду
        - name: rarity
          in: query
          schema:
            type: string
            enum:
              - common
              - uncommon
              - rare
              - epic
              - legendary
              - artifact
          description: Фильтр по редкости
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Каталог имплантов
          content:
            application/json:
              schema:
                type: object
                properties:
                  implants:
                    type: array
                    items:
                      $ref: '#/components/schemas/Implant'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants/{implant_id}:
    get:
      tags:
        - Implant Catalog
      summary: Получить информацию об импланте
      description: |
        Возвращает детальную информацию об импланте по его ID.
      operationId: getImplantById
      security:
        - BearerAuth: []
      parameters:
        - name: implant_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор импланта
      responses:
        '200':
          description: Информация об импланте
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Implant'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants/character/{character_id}:
    get:
      tags:
        - Implant Installation
      summary: Получить импланты персонажа
      description: |
        Возвращает список установленных имплантов для персонажа.
      operationId: getCharacterImplants
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
      responses:
        '200':
          description: Список имплантов персонажа
          content:
            application/json:
              schema:
                type: object
                properties:
                  implants:
                    type: array
                    items:
                      $ref: '#/components/schemas/InstalledImplant'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants/install:
    post:
      tags:
        - Implant Installation
      summary: Установить имплант
      description: |
        Устанавливает имплант персонажу. Проверяет доступность слотов и совместимость.
      operationId: installImplant
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstallImplantRequest'
      responses:
        '200':
          description: Имплант установлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstalledImplant'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Невозможно установить (нет слота, несовместимость)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants/uninstall:
    post:
      tags:
        - Implant Installation
      summary: Удалить имплант
      description: |
        Удаляет имплант у персонажа. Освобождает слот.
      operationId: uninstallImplant
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UninstallImplantRequest'
      responses:
        '200':
          description: Имплант удален
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants/slots:
    get:
      tags:
        - Implant Slots
      summary: Получить информацию о слотах
      description: |
        Возвращает информацию о доступных и занятых слотах имплантов для персонажа.
      operationId: getImplantSlots
      security:
        - BearerAuth: []
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
      responses:
        '200':
          description: Информация о слотах
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImplantSlots'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации
  schemas:
    Implant:
      type: object
      required:
        - id
        - name
        - implant_type
        - brand
        - rarity
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        implant_type:
          type: string
          enum:
            - combat
            - movement
            - os
            - visual
        brand:
          type: string
          enum:
            - arasaka
            - militech
            - kang_tao
            - zetatech
            - biotechnica
            - custom
        rarity:
          type: string
          enum:
            - common
            - uncommon
            - rare
            - epic
            - legendary
            - artifact
        description:
          type: string
        effects:
          type: object
          description: Эффекты импланта
        slot_type:
          type: string
          enum:
            - combat
            - tactical
            - defensive
            - movement
            - os
        energy_cost:
          type: integer
          minimum: 0
        humanity_cost:
          type: integer
          minimum: 0
    InstalledImplant:
      type: object
      required:
        - id
        - implant_id
        - character_id
        - installed_at
      properties:
        id:
          type: string
          format: uuid
        implant_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
        slot_type:
          type: string
        installed_at:
          type: string
          format: date-time
        durability:
          type: number
          format: float
          minimum: 0
          maximum: 100
    InstallImplantRequest:
      type: object
      required:
        - character_id
        - implant_id
        - slot_type
      properties:
        character_id:
          type: string
          format: uuid
        implant_id:
          type: string
          format: uuid
        slot_type:
          type: string
          enum:
            - combat
            - tactical
            - defensive
            - movement
            - os
    UninstallImplantRequest:
      type: object
      required:
        - character_id
        - installed_implant_id
      properties:
        character_id:
          type: string
          format: uuid
        installed_implant_id:
          type: string
          format: uuid
    ImplantSlots:
      type: object
      required:
        - character_id
        - total_slots
        - used_slots
        - available_slots
      properties:
        character_id:
          type: string
          format: uuid
        total_slots:
          type: object
          properties:
            combat:
              type: integer
            tactical:
              type: integer
            defensive:
              type: integer
            movement:
              type: integer
            os:
              type: integer
        used_slots:
          type: object
          properties:
            combat:
              type: integer
            tactical:
              type: integer
            defensive:
              type: integer
            movement:
              type: integer
            os:
              type: integer
        available_slots:
          type: object
          properties:
            combat:
              type: integer
            tactical:
              type: integer
            defensive:
              type: integer
            movement:
              type: integer
            os:
              type: integer
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Тип ошибки
        message:
          type: string
          description: Сообщение об ошибке
        code:
          type: string
          description: Код ошибки
          nullable: true
        details:
          type: object
          additionalProperties: true
          description: Дополнительные детали ошибки
          nullable: true
    StatusResponse:
      type: object
      properties:
        status:
          type: string
          description: Статус операции
  parameters:
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 50
      description: Количество элементов на странице
    Offset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Смещение для пагинации
  responses:
    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Unauthorized
            message: Требуется аутентификация
            code: AUTH_REQUIRED
    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: InternalServerError
            message: Внутренняя ошибка сервера
            code: INTERNAL_ERROR
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: NotFound
            message: Ресурс не найден
            code: RESOURCE_NOT_FOUND
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: BadRequest
            message: Неверные параметры запроса
            code: INVALID_PARAMETERS
