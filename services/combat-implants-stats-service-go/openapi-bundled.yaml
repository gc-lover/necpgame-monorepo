openapi: 3.0.3
info:
  title: Combat Implants Stats Service API
  description: |
    API для статов и ограничений имплантов в NECPGAME.

    **Основные возможности:**
    - Энергетический пул и перегрев
    - Человечность и киберпсихоз
    - Совместимость имплантов
    - Сет-бонусы брендов

    **Ограничения:**
    - Слоты (боевые, тактические, защитные, двигательные, OS)
    - Энергопотребление
    - Человечность
    - Совместимость

    **Бренды и сет-бонусы:**
    - Arasaka - тактические преимущества
    - Militech - боевые усиления
    - Kang Tao - точность и крит
    - Zetatech - энергоэффективность
    - Biotechnica - регенерация

    **Киберпсихоз:**
    - Риск растёт с установкой имплантов
    - Несовместимые импланты повышают риск
    - Временное превышение лимитов опасно
  version: 1.0.0
  license:
    name: Proprietary
    url: https://necpgame.com/license
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com
servers:
  - url: http://localhost:8083/api/v1
    description: Gameplay Service (локальная разработка)
  - url: https://gameplay.necpgame.com/api/v1
    description: Gameplay Service (продакшн)
security:
  - BearerAuth: [ ]
tags:
  - name: Energy
    description: Энергия
  - name: Humanity
    description: Человечность
  - name: Compatibility
    description: Совместимость
  - name: Set Bonuses
    description: Сет-бонусы
paths:
  /combat/implants/energy:
    get:
      tags:
        - Energy
      summary: Энергетический статус
      description: |
        Возвращает текущий энергетический статус.

        **Параметры:**
        - Current - текущая энергия
        - Max - максимальная энергия
        - Consumption - потребление
        - Overheated - флаг перегрева
      operationId: getEnergyStatus
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: ID персонажа (если не указан, используется текущий персонаж)
      responses:
        '200':
          description: Энергия
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnergyStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/implants/humanity:
    get:
      tags:
        - Humanity
      summary: Человечность
      description: |
        Возвращает текущий уровень человечности.

        **Параметры:**
        - Current - текущая человечность
        - Max - максимальная человечность
        - Cyberpsychosis Risk - риск киберпсихоза (0-100%)
      operationId: getHumanityStatus
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: ID персонажа (если не указан, используется текущий персонаж)
      responses:
        '200':
          description: Человечность
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HumanityStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/implants/compatibility:
    get:
      tags:
        - Compatibility
      summary: Проверка совместимости
      description: |
        Проверяет совместимость имплантов.

        **Проверки:**
        - Конфликты с установленными имплантами
        - Энергетический лимит
        - Человечность
        - Слоты
      operationId: checkCompatibility
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: ID персонажа (если не указан, используется текущий персонаж)
        - name: implant_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: ID импланта для проверки
      responses:
        '200':
          description: Результат проверки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompatibilityResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /combat/implants/set-bonuses:
    get:
      tags:
        - Set Bonuses
      summary: Сет-бонусы
      description: |
        Возвращает активные сет-бонусы брендов.

        **Бонусы:**
        - 2 items - малый бонус
        - 3 items - средний бонус
        - 4+ items - полный сет-бонус
      operationId: getSetBonuses
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: ID персонажа (если не указан, используется текущий персонаж)
      responses:
        '200':
          description: Сет-бонусы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SetBonuses'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации
  schemas:
    EnergyStatus:
      type: object
      properties:
        current:
          type: number
          description: Текущая энергия
          format: float
        max:
          type: number
          description: Максимальная энергия
          format: float
        consumption:
          type: number
          description: Потребление
          format: float
        overheated:
          type: boolean
          description: Флаг перегрева
        cooling_rate:
          type: number
          description: Скорость охлаждения
          format: float
    HumanityStatus:
      type: object
      properties:
        current:
          type: number
          description: Текущая человечность
          format: float
        max:
          type: number
          description: Максимальная человечность
          format: float
        cyberpsychosis_risk:
          type: number
          description: Риск киберпсихоза (0-100%)
          format: float
          minimum: 0
          maximum: 100
        implant_count:
          type: integer
          description: Количество имплантов
          minimum: 0
    CompatibilityResult:
      type: object
      properties:
        compatible:
          type: boolean
          description: Совместим ли
        conflicts:
          type: array
          description: Конфликты
          items:
            type: object
            properties:
              implant_id:
                type: string
                format: uuid
              reason:
                type: string
        warnings:
          type: array
          description: Предупреждения
          items:
            type: string
        energy_check:
          type: object
          description: Проверка энергии
          properties:
            available:
              type: number
              format: float
            required:
              type: number
              format: float
            sufficient:
              type: boolean
        humanity_check:
          type: object
          description: Проверка человечности
          properties:
            available:
              type: number
              format: float
            required:
              type: number
              format: float
            sufficient:
              type: boolean
    SetBonuses:
      type: object
      properties:
        active_sets:
          type: array
          description: Активные сеты
          items:
            type: object
            properties:
              brand:
                type: string
                description: Бренд
              implants_count:
                type: integer
                description: Количество имплантов
                minimum: 0
              bonuses:
                type: array
                description: Бонусы
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    description:
                      type: string
                    value:
                      type: number
                      format: float
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Тип ошибки
        message:
          type: string
          description: Сообщение об ошибке
        code:
          type: string
          description: Код ошибки
          nullable: true
        details:
          type: object
          additionalProperties: true
          description: Дополнительные детали ошибки
          nullable: true
  responses:
    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Unauthorized
            message: Требуется аутентификация
            code: AUTH_REQUIRED
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: NotFound
            message: Ресурс не найден
            code: RESOURCE_NOT_FOUND
    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: InternalServerError
            message: Внутренняя ошибка сервера
            code: INTERNAL_ERROR
