openapi: 3.0.3
info:
  title: Combat AI Enemies Service API
  description: |
    API для системы AI врагов в NECPGAME.

    **Основные возможности:**
    - Профили AI врагов
    - Управление встречами (encounters)
    - Рейдовые сценарии
    - Фазы боссов
    - Телеметрия AI
    - Автобалансировка

    **Уровни сложности:**
    - Street (1-10) - уличные враги, базовая тактика
    - Tactical (11-20) - тактические враги, продвинутая тактика, фракционные способности
    - Mythic (21-30) - мифические враги, легендарные способности
    - Raid (31+) - рейдовые боссы, многофазовые, координация команды

    **Фракции:**
    - Arasaka, Militech, Kang Tao, NetWatch, Voodoo Boys
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com
servers:
  - url: http://localhost:8083
    description: Gameplay Service (локальная разработка)
  - url: https://gameplay.necpgame.com
    description: Gameplay Service (продакшн)
tags:
  - name: Profiles
    description: Профили AI
  - name: Encounters
    description: Встречи с врагами
  - name: Raids
    description: Рейды
  - name: Telemetry
    description: Телеметрия AI
paths:
  /api/v1/gameplay/combat/ai/profiles:
    get:
      tags:
        - Profiles
      summary: Список профилей AI
      description: |
        Возвращает список профилей AI врагов.

        **Фильтры:**
        - По уровню сложности (street, tactical, mythic, raid)
        - По фракции
        - По skill level
      operationId: getAIProfiles
      parameters:
        - name: difficulty_layer
          in: query
          schema:
            type: string
            enum:
              - street
              - tactical
              - mythic
              - raid
        - name: faction_id
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Список профилей
          content:
            application/json:
              schema:
                type: object
                properties:
                  profiles:
                    type: array
                    items:
                      $ref: '#/components/schemas/AIProfile'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - BearerAuth: [ ]
  /api/v1/gameplay/combat/ai/profiles/{profile_id}:
    get:
      tags:
        - Profiles
      summary: Информация о профиле
      description: Возвращает детальную информацию о профиле AI
      operationId: getAIProfile
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Профиль AI
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIProfileDetailed'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - BearerAuth: [ ]
  /api/v1/gameplay/combat/ai/profiles/{profile_id}/telemetry:
    get:
      tags:
        - Telemetry
      summary: Телеметрия профиля
      description: Возвращает телеметрию для профиля AI
      operationId: getProfileTelemetry
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Телеметрия профиля
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIProfileTelemetry'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - BearerAuth: [ ]
  /api/v1/gameplay/combat/ai/encounter:
    post:
      tags:
        - Encounters
      summary: Создание встречи
      description: |
        Создаёт встречу с врагами.

        **Встреча включает:**
        - Список врагов (профили AI)
        - Позиции спавна
        - Условия победы/поражения
        - Награды
      operationId: createEncounter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEncounterRequest'
      responses:
        '201':
          description: Встреча создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - BearerAuth: [ ]
  /api/v1/gameplay/combat/ai/encounter/{encounter_id}:
    get:
      tags:
        - Encounters
      summary: Информация о встрече
      description: Возвращает информацию о встрече
      operationId: getEncounter
      parameters:
        - name: encounter_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Встреча
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - BearerAuth: [ ]
  /api/v1/gameplay/combat/ai/encounter/{encounter_id}/start:
    post:
      tags:
        - Encounters
      summary: Старт встречи
      description: Запускает встречу с врагами
      operationId: startEncounter
      parameters:
        - name: encounter_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Встреча запущена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Encounter'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - BearerAuth: [ ]
  /api/v1/gameplay/combat/ai/encounter/{encounter_id}/end:
    post:
      tags:
        - Encounters
      summary: Завершение встречи
      description: Завершает встречу с врагами
      operationId: endEncounter
      parameters:
        - name: encounter_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EndEncounterRequest'
      responses:
        '200':
          description: Встреча завершена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncounterResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - BearerAuth: [ ]
  /api/v1/gameplay/combat/raids/{raid_id}/phase:
    post:
      tags:
        - Raids
      summary: Переход фазы рейда
      description: Переходит к следующей фазе рейда
      operationId: advanceRaidPhase
      parameters:
        - name: raid_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RaidPhaseRequest'
      responses:
        '200':
          description: Фаза переключена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RaidPhase'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - BearerAuth: [ ]
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации
  schemas:
    AIProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        difficulty_layer:
          type: string
          enum:
            - street
            - tactical
            - mythic
            - raid
        skill_level_min:
          type: integer
        skill_level_max:
          type: integer
        faction_id:
          type: string
          format: uuid
    AIProfileDetailed:
      allOf:
        - $ref: '#/components/schemas/AIProfile'
        - type: object
          properties:
            behavior_tree:
              type: object
              description: Дерево поведения
            utility_weights:
              type: object
              description: Веса Utility AI
            abilities:
              type: array
              description: Способности AI
              items:
                type: object
            loot_table_id:
              type: string
              format: uuid
    AIProfileTelemetry:
      type: object
      properties:
        profile_id:
          type: string
          format: uuid
        encounters_count:
          type: integer
        avg_time_to_defeat:
          type: number
        win_rate:
          type: number
        damage_dealt_avg:
          type: integer
        damage_taken_avg:
          type: integer
    CreateEncounterRequest:
      type: object
      required:
        - area_id
        - enemies
      properties:
        area_id:
          type: string
        enemies:
          type: array
          items:
            type: object
            properties:
              profile_id:
                type: string
                format: uuid
              spawn_position:
                type: object
        difficulty_modifier:
          type: number
    Encounter:
      type: object
      properties:
        id:
          type: string
          format: uuid
        area_id:
          type: string
        enemies:
          type: array
          items:
            type: object
        status:
          type: string
          enum:
            - pending
            - active
            - completed
            - failed
        created_at:
          type: string
          format: date-time
    EndEncounterRequest:
      type: object
      required:
        - victory
      properties:
        victory:
          type: boolean
        survivors:
          type: array
          items:
            type: string
            format: uuid
    EncounterResult:
      type: object
      properties:
        encounter_id:
          type: string
          format: uuid
        victory:
          type: boolean
        duration:
          type: integer
        rewards:
          type: object
    RaidPhaseRequest:
      type: object
      required:
        - next_phase
      properties:
        next_phase:
          type: integer
        conditions_met:
          type: array
          items:
            type: string
    RaidPhase:
      type: object
      properties:
        raid_id:
          type: string
          format: uuid
        current_phase:
          type: integer
        phase_name:
          type: string
        mechanics:
          type: array
          items:
            type: string
        boss_health_percent:
          type: number
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Тип ошибки
        message:
          type: string
          description: Сообщение об ошибке
        code:
          type: string
          description: Код ошибки
          nullable: true
        details:
          type: object
          additionalProperties: true
          description: Дополнительные детали ошибки
          nullable: true
  responses:
    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Unauthorized
            message: Требуется аутентификация
            code: AUTH_REQUIRED
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: NotFound
            message: Ресурс не найден
            code: RESOURCE_NOT_FOUND
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: BadRequest
            message: Неверные параметры запроса
            code: INVALID_PARAMETERS
