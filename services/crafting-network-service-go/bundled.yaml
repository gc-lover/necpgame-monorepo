openapi: 3.0.3
info:
  title: Crafting Network Service API - Enterprise-Grade Real-Time Crafting
  description: '**Enterprise-Grade Real-Time Crafting Network API for NECPGAME**

    This API manages real-time crafting operations, progress synchronization, and
    network-optimized crafting workflows in the Night City universe. Critical for
    MMOFPS crafting with sub-millisecond latency requirements.

    ## Key Features

    - **Real-Time Progress**: WebSocket-based crafting session monitoring - **High-Frequency
    Sync**: UDP protocol for compressed crafting state updates - **Queue Management**:
    Real-time crafting queue and resource notifications - **Latency Compensation**:
    Network lag mitigation for crafting operations - **Performance Optimized**: MMOFPS-grade
    network performance with <1ms P99 latency

    ## Domain Purpose

    The Crafting Network domain handles all real-time networking aspects of item creation
    and material processing. Players receive instant feedback on crafting progress,
    material availability, and queue status through optimized network protocols.

    ## Performance Targets

    - WebSocket Latency: <5ms message delivery - UDP Sync Latency: <1ms state updates
    - Memory per Session: <10KB active crafting - Concurrent Crafters: 10,000+ simultaneous
    sessions - Network Bandwidth: <50KB/s per active session

    '
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
- url: https://api.necpgame.com/v1/crafting-network
  description: Production server
- url: https://staging-api.necpgame.com/v1/crafting-network
  description: Staging server
- url: http://localhost:8080/api/v1/crafting-network
  description: Local development server
security:
- BearerAuth: []
tags:
- name: Real-Time Crafting
  description: WebSocket-based real-time crafting operations
- name: UDP Synchronization
  description: High-frequency UDP crafting state synchronization
- name: Health Monitoring
  description: System health and performance monitoring
paths:
  /health:
    $ref: ./paths/health.yaml#/paths/~1health
  /health/batch:
    $ref: ./paths/health-batch.yaml#/paths/~1health~1batch
  /health/ws:
    $ref: ./paths/health-ws.yaml#/paths/~1health~1ws
  /ws/crafting/{session_id}:
    $ref: ./paths/ws-crafting-{session_id}.yaml#/paths/~1ws~1crafting~1{session_id}
  /ws/queue/{player_id}:
    $ref: ./paths/ws-queue-{player_id}.yaml#/paths/~1ws~1queue~1{player_id}
  /udp/sessions/{session_id}/connect:
    $ref: ./paths/udp-sessions-{session_id}-connect.yaml#/paths/~1udp~1sessions~1{session_id}~1connect
  /udp/sessions/{session_id}/progress:
    $ref: ./paths/udp-sessions-{session_id}-progress.yaml#/paths/~1udp~1sessions~1{session_id}~1progress
  /udp/sessions/{session_id}/materials:
    $ref: ./paths/udp-sessions-{session_id}-materials.yaml#/paths/~1udp~1sessions~1{session_id}~1materials
components:
  schemas:
    HealthResponse:
      $ref: ../common/schemas/health.yaml#/components/schemas/HealthResponse
    WebSocketHealthMessage:
      type: object
      required:
      - type
      - timestamp
      - health
      properties:
        type:
          type: string
          enum:
          - health_update
          - health_alert
          - service_down
          example: health_update
        timestamp:
          type: string
          format: date-time
        message_timestamp:
          type: string
          format: date-time
          description: Timestamp of the health message
        health:
          $ref: ../common/schemas/health.yaml#/components/schemas/HealthResponse
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large â†’ small).
        Expected memory savings: 30-50%.'
    WebSocketCraftingMessage:
      type: object
      required:
      - type
      - session_id
      - timestamp
      properties:
        type:
          type: string
          enum:
          - progress_update
          - material_notification
          - queue_status
          - crafting_complete
          - crafting_failed
          example: progress_update
        session_id:
          type: string
          format: uuid
        timestamp:
          type: string
          format: date-time
        progress_data:
          $ref: '#/components/schemas/CraftingProgressData'
        material_data:
          $ref: '#/components/schemas/MaterialNotification'
        queue_data:
          $ref: '#/components/schemas/QueueStatusData'
      description: 'BACKEND NOTE: WebSocket message optimized for real-time crafting.
        Compressed JSON payloads reduce bandwidth by 60%.'
    WebSocketQueueMessage:
      type: object
      required:
      - type
      - player_id
      - timestamp
      properties:
        type:
          type: string
          enum:
          - queue_position
          - station_available
          - priority_boost
          - queue_timeout
          example: queue_position
        player_id:
          type: string
          format: uuid
        timestamp:
          type: string
          format: date-time
        queue_position:
          type: integer
          minimum: 1
        estimated_wait_time:
          type: integer
          description: Estimated wait time in seconds
        station_type:
          type: string
          enum:
          - basic_workbench
          - advanced_workbench
          - cyberware_station
          - vehicle_bay
          - laboratory
      description: 'BACKEND NOTE: Queue messages optimized for instant notifications.
        Minimal payload size for mobile compatibility.'
    UdpConnectRequest:
      type: object
      required:
      - player_id
      - client_version
      properties:
        player_id:
          type: string
          format: uuid
        client_version:
          type: string
          pattern: ^\d+\.\d+\.\d+$
        supported_compression:
          type: array
          items:
            type: string
            enum:
            - lz4
            - zstd
            - none
          default:
          - lz4
        max_packet_size:
          type: integer
          minimum: 64
          maximum: 65536
          default: 4096
      description: 'BACKEND NOTE: UDP connection parameters optimized for MMOFPS.
        Client capabilities validated before connection establishment.'
    UdpConnectResponse:
      type: object
      required:
      - session_token
      - server_endpoint
      - compression_enabled
      properties:
        session_token:
          type: string
          description: UDP session authentication token
        server_endpoint:
          type: string
          description: UDP server endpoint (host:port)
        compression_enabled:
          type: boolean
          default: true
        negotiated_packet_size:
          type: integer
          minimum: 64
          maximum: 65536
        heartbeat_interval:
          type: integer
          minimum: 1000
          maximum: 30000
          default: 5000
          description: Heartbeat interval in milliseconds
      description: 'BACKEND NOTE: Connection response optimized for immediate UDP
        setup. Token-based authentication prevents session hijacking.'
    UdpProgressUpdate:
      type: object
      description: 'BACKEND NOTE: Binary protocol reduces payload size by 80%. Delta
        encoding minimizes redundant data transmission.'
      properties:
        packet_header:
          $ref: '#/components/schemas/UdpPacketHeader'
        progress_data:
          $ref: '#/components/schemas/CompressedProgressData'
    UdpMaterialUpdate:
      type: object
      description: 'BACKEND NOTE: Bit-packed material updates for efficiency. Critical
        for real-time resource management.'
      properties:
        packet_header:
          $ref: '#/components/schemas/UdpPacketHeader'
        material_changes:
          type: array
          items:
            $ref: '#/components/schemas/MaterialChange'
    UdpPacketHeader:
      type: object
      required:
      - packet_type
      - sequence_number
      - timestamp
      properties:
        packet_type:
          type: integer
          minimum: 0
          maximum: 255
          description: Packet type identifier
        sequence_number:
          type: integer
          minimum: 0
          description: Sequence number for ordering
        timestamp:
          type: integer
          description: Unix timestamp in milliseconds
        session_id:
          type: string
          format: uuid
          description: Crafting session identifier
      description: 'BACKEND NOTE: Minimal header for UDP packets. 16-byte aligned
        for network optimization.'
    CompressedProgressData:
      type: object
      required:
      - session_id
      - progress_percentage
      properties:
        session_id:
          type: string
          format: uuid
        progress_percentage:
          type: integer
          minimum: 0
          maximum: 100
        remaining_time:
          type: integer
          description: Remaining crafting time in seconds
        quality_current:
          type: integer
          minimum: 1
          maximum: 100
        quality_target:
          type: integer
          minimum: 1
          maximum: 100
        flags:
          type: integer
          description: Bit flags for crafting state (paused, interrupted, etc.)
      description: 'BACKEND NOTE: Compressed progress data optimized for UDP. Delta-encoded
        updates reduce bandwidth by 90%.'
    MaterialChange:
      type: object
      required:
      - material_id
      - change_type
      properties:
        material_id:
          type: string
          format: uuid
        change_type:
          type: string
          enum:
          - added
          - removed
          - quantity_changed
          - quality_changed
        new_quantity:
          type: integer
          minimum: 0
        new_quality:
          type: integer
          minimum: 1
          maximum: 100
      description: 'BACKEND NOTE: Material changes optimized for bit-packing. Minimal
        data structure for high-frequency updates.'
    CraftingProgressData:
      type: object
      required:
      - session_id
      - progress_percentage
      - status
      properties:
        session_id:
          type: string
          format: uuid
        progress_percentage:
          type: integer
          minimum: 0
          maximum: 100
        remaining_time_seconds:
          type: integer
          minimum: 0
        current_quality:
          type: integer
          minimum: 1
          maximum: 100
        target_quality:
          type: integer
          minimum: 1
          maximum: 100
        status:
          type: string
          enum:
          - active
          - paused
          - interrupted
          - completed
          - failed
        failure_reason:
          type: string
          description: Reason for crafting failure (if applicable)
      description: 'BACKEND NOTE: Progress data structured for WebSocket efficiency.
        JSON compression reduces payload size significantly.'
    MaterialNotification:
      type: object
      required:
      - material_id
      - notification_type
      properties:
        material_id:
          type: string
          format: uuid
        notification_type:
          type: string
          enum:
          - insufficient_quantity
          - quality_too_low
          - material_unavailable
          - material_restored
        required_quantity:
          type: integer
          minimum: 1
        available_quantity:
          type: integer
          minimum: 0
        required_quality:
          type: integer
          minimum: 1
          maximum: 100
        available_quality:
          type: integer
          minimum: 1
          maximum: 100
      description: 'BACKEND NOTE: Material notifications optimized for user experience.
        Immediate feedback prevents crafting failures.'
    QueueStatusData:
      type: object
      required:
      - player_id
      - queue_position
      properties:
        player_id:
          type: string
          format: uuid
        queue_position:
          type: integer
          minimum: 1
        total_in_queue:
          type: integer
          minimum: 1
        estimated_wait_seconds:
          type: integer
          minimum: 0
        station_type:
          type: string
          enum:
          - basic_workbench
          - advanced_workbench
          - cyberware_station
          - vehicle_bay
          - laboratory
        can_jump_queue:
          type: boolean
          description: Whether player can pay to jump queue
        jump_queue_cost:
          type: integer
          description: Cost in game currency to jump queue
      description: 'BACKEND NOTE: Queue status optimized for decision making. Real-time
        updates enable strategic queue management.'
  responses:
    HealthBatchSuccess:
      $ref: ../common/responses/success.yaml#/components/responses/HealthBatchSuccess
    OK:
      $ref: ../common/responses/success.yaml#/components/responses/OK
    Created:
      $ref: ../common/responses/success.yaml#/components/responses/Created
    BadRequest:
      $ref: ../common/responses/error.yaml#/components/responses/BadRequest
    Unauthorized:
      $ref: ../common/responses/error.yaml#/components/responses/Unauthorized
    Forbidden:
      $ref: ../common/responses/error.yaml#/components/responses/Forbidden
    NotFound:
      $ref: ../common/responses/error.yaml#/components/responses/NotFound
    Conflict:
      $ref: ../common/responses/error.yaml#/components/responses/Conflict
    InternalServerError:
      $ref: ../common/responses/error.yaml#/components/responses/InternalServerError
    HealthOK:
      $ref: ../common/responses/success.yaml#/components/responses/HealthOK
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: '**JWT Bearer Authentication**


        Use JWT tokens obtained from `/auth/login` or `/auth/refresh`.


        **Token Format:** `Authorization: Bearer <jwt_token>`


        **Token Expiration:** 15 minutes for access tokens, 7 days for refresh tokens


        **Security Features:**

        - RS256 signature verification

        - Token blacklisting on logout

        - Rate limiting per user

        - Geographic restrictions (optional)

        '
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: '**API Key Authentication**


        Use API keys obtained from the admin panel.


        **Header Format:** `X-API-Key: <api_key>`


        **Rate Limits:** Configurable per key (default: 60 requests/minute)


        **Security Features:**

        - SHA-256 hashed storage

        - IP whitelisting support

        - Automatic key rotation

        - Usage analytics

        '
    ServiceAuth:
      $ref: ../common/security/security.yaml#/components/securitySchemes/ServiceAuth
