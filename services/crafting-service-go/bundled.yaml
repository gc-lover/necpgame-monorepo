openapi: 3.0.3
info:
  title: Crafting Service API - Enterprise-Grade Domain Service
  description: '**Enterprise-Grade Crafting System API for NECPGAME**

    This API manages item crafting mechanics, recipe management, and material processing
    in the Night City universe, providing comprehensive crafting workflows, quality
    control, and resource optimization.

    ## Key Features

    - **Recipe Management**: Dynamic recipe loading and validation - **Material Processing**:
    Resource consumption and quality calculations - **Crafting Workflows**: Multi-step
    crafting processes with progress tracking - **Quality Control**: Item quality
    assessment and enhancement mechanics - **Resource Optimization**: Material efficiency
    and waste reduction - **Performance Optimized**: MMOFPS-grade performance with
    <50ms P99 latency

    ## Domain Purpose

    The Crafting domain handles all aspects of item creation and material processing
    in Night City. Players combine resources, follow recipes, and create equipment
    through sophisticated crafting mechanics that affect item quality and characteristics.

    ## Performance Targets

    - P99 Latency: <50ms for crafting operations - Memory: <20KB per active crafting
    session - Concurrent users: 25,000+ simultaneous crafting - Recipe calculations:
    <5ms response time

    '
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
- url: https://api.necpgame.com/v1/crafting
  description: Production server
- url: https://staging-api.necpgame.com/v1/crafting
  description: Staging server
- url: http://localhost:8080/api/v1/crafting
  description: Local development server
security:
- BearerAuth: []
tags:
- name: Crafting
  description: Core crafting operations
- name: Health Monitoring
  description: System health and performance monitoring
paths:
  /health:
    $ref: ./paths/health.yaml#/paths/~1health
  /health/batch:
    $ref: ./paths/health-batch.yaml#/paths/~1health~1batch
  /health/ws:
    $ref: ./paths/health-ws.yaml#/paths/~1health~1ws
  /recipes:
    $ref: ./paths/recipes.yaml#/paths/~1recipes
  /crafting/{crafting_id}:
    $ref: ./paths/crafting-{crafting_id}.yaml#/paths/~1crafting~1{crafting_id}
  /crafting/recipes:
    $ref: ./paths/crafting-recipes.yaml#/paths/~1crafting~1recipes
components:
  schemas:
    BaseEntity:
      type: object
      required:
      - id
      - created_at
      - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier (UUID v4)
          example: 123e4567-e89b-12d3-a456-426614174000
          maxLength: 36
        created_at:
          type: string
          format: date-time
          description: Creation timestamp (ISO 8601)
          example: '2025-12-28T10:00:00Z'
          maxLength: 30
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp (ISO 8601)
          example: '2025-12-28T10:00:00Z'
          maxLength: 30
    HealthResponse:
      $ref: ../common/schemas/health.yaml#/HealthResponse
    WebSocketHealthMessage:
      type: object
      required:
      - type
      - timestamp
      - health
      properties:
        type:
          type: string
          enum:
          - health_update
          - health_alert
          - service_down
          example: health_update
          maxLength: 255
        timestamp:
          type: string
          format: date-time
          maxLength: 255
        message_timestamp:
          type: string
          format: date-time
          description: Timestamp of the health message
          maxLength: 1000
        health:
          $ref: ../common/schemas/health.yaml#/HealthResponse
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%.'
    Error:
      $ref: ../common/schemas/infrastructure-entities.yaml#/ErrorResponse
    Example:
      type: object
      required:
      - id
      - name
      - created_at
      - status
      - is_active
      properties:
        id:
          type: string
          format: uuid
          description: Example unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Example display name
          example: Sample Example
        description:
          type: string
          maxLength: 1000
          description: Detailed description
          example: This is a comprehensive example demonstrating best practices.
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: '2025-12-21T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: '2025-12-21T10:00:00Z'
        status:
          type: string
          enum:
          - active
          - inactive
          - pending
          - archived
          default: active
          description: Current status
          example: active
        tags:
          type: array
          items:
            type: string
            maxLength: 50
          maxItems: 10
          description: Associated tags
          example:
          - demo
          - template
          - best-practice
        is_active:
          type: boolean
          description: Whether this example is active
          example: true
        priority:
          type: integer
          minimum: 1
          maximum: 10
          default: 5
          description: Processing priority
          example: 7
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%. Hot path optimization required.'
    CreateExampleRequest:
      type: object
      required:
      - name
      - description
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Desired example name
          example: My New Example
        description:
          type: string
          maxLength: 1000
          description: Example description
          example: A new example following enterprise-grade patterns.
        tags:
          type: array
          items:
            type: string
            maxLength: 50
          maxItems: 10
          description: Initial tags
        priority:
          type: integer
          minimum: 1
          maximum: 10
          default: 5
          description: Processing priority
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%.'
    UpdateExampleRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: New example name
          example: Updated Example Name
        description:
          type: string
          maxLength: 1000
          description: New description
        status:
          type: string
          enum:
          - active
          - inactive
          - pending
          - archived
          description: New status
        tags:
          type: array
          items:
            type: string
            maxLength: 50
          maxItems: 10
          description: Replace all tags
        is_active:
          type: boolean
          description: Update active status
        priority:
          type: integer
          minimum: 1
          maximum: 10
          description: New priority
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%.'
    ExampleResponse:
      type: object
      required:
      - example
      properties:
        example:
          $ref: '#/components/schemas/Example'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%.'
    ExampleListResponse:
      type: object
      required:
      - examples
      - total_count
      - has_more
      properties:
        examples:
          type: array
          items:
            $ref: '#/components/schemas/Example'
          description: List of examples
        has_more:
          type: boolean
          description: Whether there are more results available
          example: true
        total_count:
          type: integer
          description: Total number of examples matching criteria
          example: 150
        page:
          type: integer
          description: Current page number
          example: 1
        limit:
          type: integer
          description: Items per page
          example: 20
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%. Paginated responses optimized for memory
        efficiency.'
    PaginationParams:
      $ref: ../common/schemas/pagination.yaml#/PaginationParams
    PaginatedResponse:
      $ref: ../common/schemas/pagination.yaml#/PaginatedResponse
    RecipeListResponse:
      type: object
      required:
      - recipes
      - pagination
      properties:
        recipes:
          type: array
          items:
            $ref: '#/components/schemas/Recipe'
          description: List of crafting recipes
        pagination:
          type: object
          required:
          - page
          - limit
          - total_count
          - total_pages
          properties:
            page:
              type: integer
              minimum: 1
              description: Current page number
            limit:
              type: integer
              minimum: 1
              description: Items per page
            total_count:
              type: integer
              minimum: 0
              description: Total number of recipes matching criteria
            total_pages:
              type: integer
              minimum: 0
              description: Total number of pages
          description: Pagination metadata
        filters_applied:
          type: object
          description: Applied filters summary
          additionalProperties: true
      description: '"BACKEND NOTE: Response optimized for frontend recipe browser.

        Includes pagination for large recipe catalogs."

        '
    Recipe:
      allOf:
      - $ref: ../common/schemas/common.yaml#/AuditableEntity
      - type: object
        required:
        - name
        - category
        - tier
        - ingredients
        - result_item
        - crafting_time
        - required_skill_level
        properties:
          name:
            type: string
            maxLength: 100
            description: Human-readable recipe name
            example: Legendary Katana Crafting Recipe
          lore_description:
            type: string
            maxLength: 500
            description: Recipe description and lore
            example: Ancient crafting technique passed down through generations
          category:
            type: string
            enum:
            - weapons
            - armor
            - implants
            - vehicles
            - consumables
            - tools
            - cyberware
            - equipment
            description: Recipe category
          tier:
            type: integer
            minimum: 1
            maximum: 5
            description: Recipe difficulty tier (1-5)
          ingredients:
            type: array
            items:
              $ref: '#/components/schemas/RecipeIngredient'
            minItems: 1
            description: Required crafting materials
          result_item:
            type: object
            required:
            - item_id
            - quantity
            properties:
              item_id:
                type: string
                format: uuid
                description: Result item identifier
              item_name:
                type: string
                description: Result item name
              quantity:
                type: integer
                minimum: 1
                description: Quantity produced
            description: Item produced by recipe
          quality_range:
            type: object
            required:
            - min
            - max
            properties:
              min:
                type: integer
                minimum: 1
                maximum: 100
              max:
                type: integer
                minimum: 1
                maximum: 100
            description: Quality range of crafted item
          crafting_time:
            type: integer
            minimum: 1
            description: Base crafting time in seconds
          required_skill_level:
            type: integer
            minimum: 1
            description: Minimum crafting skill level required
          required_facility:
            type: string
            enum:
            - basic_workbench
            - advanced_workbench
            - cyberware_station
            - vehicle_bay
            - laboratory
            description: Required crafting facility
          success_chance:
            type: number
            format: float
            minimum: 0
            maximum: 1
            default: 1.0
            description: Base success probability
          experience_gained:
            type: integer
            minimum: 0
            description: Experience points awarded on success
          is_discovered:
            type: boolean
            description: Whether recipe is discovered by player
          tags:
            type: array
            items:
              type: string
            description: Recipe tags for filtering
        description: Last recipe modification
      description: '"BACKEND NOTE: Recipe data optimized for crafting calculations.

        Ingredients pre-validated for availability checks."

        '
    RecipeIngredient:
      type: object
      required:
      - item_id
      - quantity
      properties:
        item_id:
          type: string
          format: uuid
          description: Required item identifier
        item_name:
          type: string
          description: Required item name
        quantity:
          type: integer
          minimum: 1
          description: Required quantity
        quality_required:
          type: integer
          minimum: 1
          maximum: 100
          description: Minimum quality required
        is_consumed:
          type: boolean
          default: true
          description: Whether ingredient is consumed in crafting
        alternative_items:
          type: array
          items:
            type: string
            format: uuid
          description: Alternative items that can substitute this ingredient
      description: '"BACKEND NOTE: Ingredient validation prevents impossible crafts.

        Alternative items support flexible crafting requirements."

        '
  responses:
    HealthBatchSuccess:
      $ref: ../common/responses/success.yaml#/HealthBatchSuccess
    ExampleListSuccess:
      description: Examples retrieved successfully
      headers:
        Cache-Control:
          schema:
            type: string
            example: max-age=300, private
        X-Total-Count:
          schema:
            type: integer
            example: 150
            description: Total number of examples matching criteria
        X-Page-Count:
          schema:
            type: integer
            example: 8
            description: Total number of pages
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ExampleListResponse'
    ExampleCreated:
      description: Example created successfully
      headers:
        Location:
          schema:
            type: string
            example: /api/v1/crafting/550e8400-e29b-41d4-a716-446655440000
            description: URL of the created example
        Cache-Control:
          schema:
            type: string
            example: no-cache
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ExampleResponse'
    ExampleRetrieved:
      description: Example retrieved successfully
      headers:
        ETag:
          schema:
            type: string
            example: '"example-123-v1"'
            description: Entity tag for caching
        Cache-Control:
          schema:
            type: string
            example: max-age=300, private
            description: Cache control directives
        Last-Modified:
          schema:
            type: string
            format: date-time
            example: '2025-12-21T10:00:00Z'
            description: Last modification timestamp
        X-Processing-Time:
          schema:
            type: integer
            example: 5
            description: Processing time in milliseconds
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ExampleResponse'
    ExampleUpdated:
      description: Example updated successfully
      headers:
        Last-Modified:
          schema:
            type: string
            format: date-time
            example: '2025-12-21T10:05:00Z'
            description: Last modification timestamp
        X-Processing-Time:
          schema:
            type: integer
            example: 25
            description: Processing time in milliseconds
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ExampleResponse'
    ExampleDeleted:
      description: Example deleted successfully
      headers:
        X-Processing-Time:
          schema:
            type: integer
            example: 15
            description: Processing time in milliseconds
    OK:
      $ref: ../common/responses/success.yaml#/OK
    Created:
      $ref: ../common/responses/success.yaml#/Created
    BadRequest:
      $ref: ../common/responses/error.yaml#/BadRequest
    Unauthorized:
      $ref: ../common/responses/error.yaml#/Unauthorized
    Forbidden:
      $ref: ../common/responses/error.yaml#/Forbidden
    NotFound:
      $ref: ../common/responses/error.yaml#/NotFound
    Conflict:
      $ref: ../common/responses/error.yaml#/Conflict
    InternalServerError:
      $ref: ../common/responses/error.yaml#/InternalServerError
    HealthOK:
      $ref: ../common/responses/success.yaml#/HealthOK
  securitySchemes:
    BearerAuth:
      $ref: ../common/security/security.yaml#/BearerAuth
    ApiKeyAuth:
      $ref: ../common/security/security.yaml#/ApiKeyAuth
    ServiceAuth:
      $ref: ../common/security/security.yaml#/ServiceAuth
