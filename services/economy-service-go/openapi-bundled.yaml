openapi: 3.0.3
info:
  title: Economy Core Service API
  description: |
    API для базовых экономических механик в NECPGAME.

    **Основные возможности:**
    - Обзор экономической системы
    - Базовая P2P торговля между игроками
    - Торговые гильдии
    - Управление валютами и ресурсами
    - Влияние экономики на игровой мир

    **Валюты:**
    - Eurodollars (ED) - основная валюта
    - PvP Tokens - награды за PvP
    - PvE Credits - награды за PvE
    - Faction Currency - фракционные единицы
    - Regional Currencies - региональные валюты

    **Ресурсы:**
    - Базовые материалы
    - Редкие компоненты
    - Крафт-ресурсы
    - Ресурсы для имплантов
    - Информационные ресурсы
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8085/api/v1
    description: Economy Service (локальная разработка)
  - url: https://api.necp.game/api/v1
    description: Economy Service (продакшн)
security:
  - BearerAuth: [ ]
tags:
  - name: Economy Overview
    description: Обзор экономики
  - name: Currencies
    description: Валюты
  - name: Resources
    description: Ресурсы
  - name: Trading
    description: Базовая торговля
  - name: Trading Guilds
    description: Торговые гильдии
  - name: World Impact
    description: Влияние на мир
paths:
  /economy/overview:
    get:
      tags:
        - Economy Overview
      summary: Получить обзор экономики
      description: |
        Возвращает обзор экономической системы: общий объём торговли, инфляция, курсы валют.
      operationId: getEconomyOverview
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Обзор экономики
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EconomyOverview'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/model:
    get:
      tags:
        - Economy Overview
      summary: Получить информацию о типе экономической модели
      description: |
        Возвращает информацию о типе экономической модели:
        структура рынков, управление, ценообразование.
      operationId: getEconomyModel
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Информация о типе экономической модели
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EconomyModel'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/currencies:
    get:
      tags:
        - Currencies
      summary: Получить список валют
      description: |
        Возвращает список всех доступных валют в системе.
      operationId: getCurrencies
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Список валют
          content:
            application/json:
              schema:
                type: object
                properties:
                  currencies:
                    type: array
                    items:
                      $ref: '#/components/schemas/Currency'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/currencies/{currency_id}/balance:
    get:
      tags:
        - Currencies
      summary: Получить баланс валюты
      description: |
        Возвращает баланс указанной валюты для персонажа.
      operationId: getCurrencyBalance
      security:
        - BearerAuth: [ ]
      parameters:
        - name: currency_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор валюты
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор персонажа
      responses:
        '200':
          description: Баланс валюты
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrencyBalance'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/resources:
    get:
      tags:
        - Resources
      summary: Получить каталог ресурсов
      description: |
        Возвращает каталог ресурсов с возможностью фильтрации по типу.
      operationId: getResources
      security:
        - BearerAuth: [ ]
      parameters:
        - name: resource_type
          in: query
          schema:
            type: string
            enum:
              - basic
              - rare
              - craft
              - implant
              - information
          description: Фильтр по типу ресурса
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Каталог ресурсов
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Resource'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/resources/{resource_id}:
    get:
      tags:
        - Resources
      summary: Получить информацию о ресурсе
      description: |
        Возвращает детальную информацию о ресурсе по его ID.
      operationId: getResourceById
      security:
        - BearerAuth: [ ]
      parameters:
        - name: resource_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор ресурса
      responses:
        '200':
          description: Информация о ресурсе
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Resource'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/resources/category/{category}:
    get:
      tags:
        - Resources
      summary: Получить ресурсы по категории
      description: Возвращает список ресурсов, отфильтрованных по категории (raw_materials, electronics, bio_chem, data_assets).
      operationId: getResourcesByCategory
      security:
        - BearerAuth: [ ]
      parameters:
        - name: category
          in: path
          required: true
          schema:
            type: string
            enum:
              - raw_materials
              - electronics
              - bio_chem
              - data_assets
          description: Категория ресурсов
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Список ресурсов по категории
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Resource'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/resources/tier/{tier}:
    get:
      tags:
        - Resources
      summary: Получить ресурсы по tier
      description: Возвращает список ресурсов, отфильтрованных по tier (1-5).
      operationId: getResourcesByTier
      security:
        - BearerAuth: [ ]
      parameters:
        - name: tier
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 5
          description: Tier ресурсов (1-5)
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Список ресурсов по tier
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Resource'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/resources/{resource_id}/price:
    get:
      tags:
        - Resources
      summary: Получить текущую цену ресурса
      description: Возвращает текущую рыночную цену ресурса с историей изменений (опционально).
      operationId: getResourcePrice
      security:
        - BearerAuth: [ ]
      parameters:
        - name: resource_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор ресурса
        - name: include_history
          in: query
          schema:
            type: boolean
            default: false
          description: Включить историю изменений цены
        - name: history_days
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 30
            default: 7
          description: Количество дней истории
      responses:
        '200':
          description: Текущая цена ресурса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourcePrice'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/trade/initiate:
    post:
      tags:
        - Trading
      summary: Инициировать торговлю
      description: |
        Инициирует базовую P2P торговлю между двумя игроками.
      operationId: initiateTrade
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InitiateTradeRequest'
      responses:
        '200':
          description: Торговля инициирована
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeSession'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/trade/{trade_id}/accept:
    post:
      tags:
        - Trading
      summary: Принять торговлю
      description: |
        Принимает предложение торговли и завершает сделку.
      operationId: acceptTrade
      security:
        - BearerAuth: [ ]
      parameters:
        - name: trade_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор торговой сессии
      responses:
        '200':
          description: Торговля завершена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/trade/{trade_id}/cancel:
    post:
      tags:
        - Trading
      summary: Отменить торговлю
      description: |
        Отменяет торговую сессию и разблокирует предметы.
      operationId: cancelTrade
      security:
        - BearerAuth: [ ]
      parameters:
        - name: trade_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор торговой сессии
      responses:
        '200':
          description: Торговля отменена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/guilds:
    get:
      tags:
        - Trading Guilds
      summary: Получить список торговых гильдий
      description: |
        Возвращает список торговых гильдий с возможностью фильтрации.
      operationId: getTradingGuilds
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Список торговых гильдий
          content:
            application/json:
              schema:
                type: object
                properties:
                  guilds:
                    type: array
                    items:
                      $ref: '#/components/schemas/TradingGuild'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/guilds/create:
    post:
      tags:
        - Trading Guilds
      summary: Создать торговую гильдию
      description: |
        Создает новую торговую гильдию.
      operationId: createTradingGuild
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGuildRequest'
      responses:
        '201':
          description: Гильдия создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradingGuild'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/guilds/{guild_id}/join:
    post:
      tags:
        - Trading Guilds
      summary: Вступить в торговую гильдию
      description: |
        Вступает в торговую гильдию.
      operationId: joinTradingGuild
      security:
        - BearerAuth: [ ]
      parameters:
        - name: guild_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор гильдии
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - character_id
              properties:
                character_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Вступление в гильдию успешно
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /economy/world-impact:
    get:
      tags:
        - World Impact
      summary: Получить влияние экономики на мир
      description: |
        Возвращает информацию о влиянии экономических операций на игровой мир.
      operationId: getWorldImpact
      security:
        - BearerAuth: [ ]
      parameters:
        - name: region_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по региону
      responses:
        '200':
          description: Влияние на мир
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorldImpact'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации
  schemas:
    EconomyOverview:
      type: object
      required:
        - total_trade_volume
        - inflation_rate
        - currency_rates
      properties:
        total_trade_volume:
          type: number
          format: float
          description: Общий объём торговли
        inflation_rate:
          type: number
          format: float
          description: Уровень инфляции
        currency_rates:
          type: object
          additionalProperties:
            type: number
            format: float
          description: Курсы валют
        market_health:
          type: string
          enum:
            - healthy
            - stable
            - declining
            - crisis
          description: Состояние рынка
    EconomyModel:
      type: object
      required:
        - model_type
        - market_structure
        - pricing_mechanism
      properties:
        model_type:
          type: string
          enum:
            - player_driven
            - hybrid
            - managed
          description: Тип экономической модели
        market_structure:
          type: string
          description: Структура рынков
        pricing_mechanism:
          type: string
          description: Механизм ценообразования
        governance:
          type: string
          description: Управление экономикой
    Currency:
      type: object
      required:
        - id
        - name
        - code
        - type
      description: |
        BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory: ~40 bytes/instance.
      properties:
        id:
          type: string
          format: uuid
          description: Идентификатор валюты
        name:
          type: string
          description: Название валюты
        code:
          type: string
          description: Код валюты (ED, PVP, PVE, FAC, REG)
        type:
          type: string
          enum:
            - primary
            - pvp_token
            - pve_credit
            - faction
            - regional
          description: Тип валюты
        exchange_rate:
          type: number
          format: float
          description: Курс обмена к основной валюте (ED)
        tradeable:
          type: boolean
          description: Можно ли торговать валютой
    CurrencyBalance:
      type: object
      required:
        - currency_id
        - character_id
        - balance
      description: |
        BACKEND NOTE: Hot endpoint (frequent updates). Fields ordered for alignment.
        Expected memory: ~52 bytes/instance.
      properties:
        currency_id:
          type: string
          format: uuid
          description: ID валюты
        character_id:
          type: string
          format: uuid
          description: ID персонажа
        updated_at:
          type: string
          format: date-time
          description: Время последнего обновления
        balance:
          type: number
          format: float
          description: Текущий баланс
        locked:
          type: number
          format: float
          description: Заблокированная сумма (в торговле)
    Resource:
      type: object
      required:
        - id
        - name
        - type
        - rarity
      description: |
        BACKEND NOTE: Config data, cached. Fields ordered for struct alignment.
        Expected memory: ~64 bytes/instance.
      properties:
        id:
          type: string
          format: uuid
          description: ID ресурса
        name:
          type: string
          description: Название ресурса
        type:
          type: string
          enum:
            - basic
            - rare
            - craft
            - implant
            - information
          description: Тип ресурса
        category:
          type: string
          enum:
            - raw_materials
            - electronics
            - bio_chem
            - data_assets
        tier:
          type: integer
          minimum: 1
          maximum: 5
          description: Уровень ресурса (1-5)
        rarity:
          type: string
          enum:
            - common
            - uncommon
            - rare
            - epic
            - legendary
        description:
          type: string
        weight:
          type: number
          format: float
        stackable:
          type: boolean
        max_stack:
          type: integer
    ResourcePrice:
      type: object
      required:
        - resource_id
        - current_price
        - currency
      properties:
        resource_id:
          type: string
          format: uuid
        current_price:
          type: number
          format: float
        currency:
          type: string
          default: ED
        price_history:
          type: array
          items:
            $ref: '#/components/schemas/PriceHistoryPoint'
        volatility:
          type: number
          format: float
          description: Волатильность цены
    PriceHistoryPoint:
      type: object
      required:
        - timestamp
        - price
      properties:
        timestamp:
          type: string
          format: date-time
        price:
          type: number
          format: float
        volume:
          type: integer
          description: Объём торговли на момент
    InitiateTradeRequest:
      type: object
      required:
        - initiator_id
        - target_player_id
        - offered_items
      properties:
        initiator_id:
          type: string
          format: uuid
          description: ID инициатора торговли
        target_player_id:
          type: string
          format: uuid
          description: ID целевого игрока
        offered_items:
          type: array
          items:
            type: object
            properties:
              item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
        offered_currency:
          type: number
          format: float
          description: Предлагаемая валюта (eddies)
        message:
          type: string
          description: Сообщение для целевого игрока
    TradeSession:
      type: object
      required:
        - trade_id
        - initiator_id
        - target_player_id
        - status
        - created_at
      properties:
        trade_id:
          type: string
          format: uuid
        initiator_id:
          type: string
          format: uuid
        target_player_id:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - pending
            - accepted
            - rejected
            - completed
            - cancelled
        initiator_offer:
          type: object
          properties:
            items:
              type: array
              items:
                type: object
            currency:
              type: number
              format: float
        target_offer:
          type: object
          properties:
            items:
              type: array
              items:
                type: object
            currency:
              type: number
              format: float
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
    TradingGuild:
      type: object
      required:
        - guild_id
        - name
        - owner_id
      properties:
        guild_id:
          type: string
          format: uuid
        name:
          type: string
        owner_id:
          type: string
          format: uuid
        description:
          type: string
        member_count:
          type: integer
        trade_volume:
          type: number
          format: float
        reputation:
          type: number
          format: float
        created_at:
          type: string
          format: date-time
    CreateGuildRequest:
      type: object
      required:
        - name
        - owner_id
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 50
        owner_id:
          type: string
          format: uuid
        description:
          type: string
          maxLength: 500
        tax_rate:
          type: number
          format: float
          minimum: 0
          maximum: 0.5
          default: 0.05
    WorldImpact:
      type: object
      required:
        - region_id
      properties:
        region_id:
          type: string
          format: uuid
        economic_health:
          type: string
          enum:
            - booming
            - healthy
            - stable
            - declining
            - crisis
        faction_influence:
          type: object
          additionalProperties:
            type: number
            format: float
        market_events:
          type: array
          items:
            type: object
            properties:
              event_type:
                type: string
              impact:
                type: string
                enum:
                  - positive
                  - negative
                  - neutral
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Тип ошибки
        message:
          type: string
          description: Сообщение об ошибке
        code:
          type: string
          description: Код ошибки
          nullable: true
        details:
          type: object
          additionalProperties: true
          description: Дополнительные детали ошибки
          nullable: true
    StatusResponse:
      type: object
      properties:
        status:
          type: string
          description: Статус операции
  responses:
    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Unauthorized
            message: Требуется аутентификация
            code: AUTH_REQUIRED
    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: InternalServerError
            message: Внутренняя ошибка сервера
            code: INTERNAL_ERROR
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: NotFound
            message: Ресурс не найден
            code: RESOURCE_NOT_FOUND
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: BadRequest
            message: Неверные параметры запроса
            code: INVALID_PARAMETERS
    Conflict:
      description: Конфликт ресурсов
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Conflict
            message: Конфликт ресурсов
            code: RESOURCE_CONFLICT
  parameters:
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 50
      description: Количество элементов на странице
    Offset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Смещение для пагинации
