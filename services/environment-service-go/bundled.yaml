openapi: 3.0.3
info:
  title: Environment Service API - Enterprise-Grade Dynamic World Management
  description: '**Enterprise-Grade Environment API for NECPGAME**

    Environment Service manages dynamic world elements, seasonal content, time trials,
    and real-time gameplay systems. Provides seasonal challenges, timed competitions,
    protocol optimization, and real-time combat coordination.

    ## Key Features

    - **Seasonal Content**: Dynamic seasonal challenges and rewards - **Time Trials**:
    Competitive timed gameplay mechanics - **Realtime Protocol**: High-performance
    communication optimization - **Combat Systems**: Real-time combat state management
    and coordination - **Performance Monitoring**: System performance tracking and
    optimization - **Scalable Architecture**: Support for massive concurrent gameplay

    ## Domain Purpose

    Manages all dynamic environmental gameplay elements including seasonal events,
    competitive challenges, real-time systems, and performance optimization. Essential
    for engaging, dynamic gameplay experiences in Night City.

    ## Performance Targets

    - P99 Latency: <25ms for real-time operations - Memory: <20KB per active environment
    session - Concurrent users: 100,000+ simultaneous participants - Protocol throughput:
    100,000+ messages per second

    '
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
- url: https://api.necpgame.com/v1/environment
  description: Production server
- url: https://staging-api.necpgame.com/v1/environment
  description: Staging server
- url: http://localhost:8080/api/v1/environment
  description: Local development server
security:
- BearerAuth: []
tags:
- name: Seasonal Challenges
  description: Seasonal gameplay content and challenges
- name: Time Trials
  description: Competitive timed gameplay mechanics
- name: Realtime Protocol
  description: Communication protocol optimization
- name: Combat Systems
  description: Real-time combat coordination and state
- name: Health Monitoring
  description: System health and performance monitoring
paths:
  /health:
    $ref: ./paths/health.yaml#/paths/~1health
  /challenges/seasonal/active:
    $ref: ./paths/challenges-seasonal-active.yaml#/paths/~1challenges~1seasonal~1active
  /trials/time/active:
    $ref: ./paths/trials-time-active.yaml#/paths/~1trials~1time~1active
  /realtime/sessions:
    $ref: ./paths/realtime-sessions.yaml#/paths/~1realtime~1sessions
  /combat/sessions/active:
    $ref: ./paths/combat-sessions-active.yaml#/paths/~1combat~1sessions~1active
  /protocol/optimize:
    $ref: ./paths/protocol-optimize.yaml#/paths/~1protocol~1optimize
components:
  schemas:
    Error:
      $ref: ../common/schemas/infrastructure-entities.yaml#/ErrorResponse
    SeasonalChallenge:
      type: object
      description: Seasonal challenge definition and progress tracking
      properties:
        id:
          type: string
          format: uuid
          description: Unique challenge identifier
        name:
          type: string
          description: Challenge display name
        description:
          type: string
          description: Challenge description and objectives
        seasonId:
          type: string
          format: uuid
          description: Associated season identifier
        type:
          type: string
          enum:
          - daily
          - weekly
          - monthly
          - seasonal
          description: Challenge frequency type
        objectives:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeObjective'
          description: Challenge completion objectives
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeReward'
          description: Available rewards upon completion
        startDate:
          type: string
          format: date-time
          description: Challenge activation date
        endDate:
          type: string
          format: date-time
          description: Challenge expiration date
        isActive:
          type: boolean
          description: Whether challenge is currently available
        progress:
          type: object
          description: Player progress tracking
          properties:
            characterId:
              type: string
              format: uuid
            completed:
              type: boolean
            currentProgress:
              type: number
            maxProgress:
              type: number
            lastUpdated:
              type: string
              format: date-time
      required:
      - id
      - name
      - seasonId
      - type
      - objectives
      - startDate
      - endDate
    ChallengeObjective:
      type: object
      description: Individual challenge objective
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum:
          - kill
          - collect
          - explore
          - achieve
          - compete
        target:
          type: string
          description: Objective target (enemy type, item, location, etc.)
        count:
          type: integer
          minimum: 1
        description:
          type: string
      required:
      - id
      - type
      - target
      - count
    ChallengeReward:
      type: object
      description: Challenge completion reward
      properties:
        type:
          type: string
          enum:
          - currency
          - item
          - experience
          - title
          - achievement
        value:
          oneOf:
          - type: integer
          - type: string
          description: Reward value or identifier
        rarity:
          type: string
          enum:
          - common
          - uncommon
          - rare
          - epic
          - legendary
      required:
      - type
      - value
    TimeTrial:
      type: object
      description: Time trial challenge definition
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        courseId:
          type: string
          format: uuid
        category:
          type: string
          enum:
          - speed
          - combat
          - exploration
          - mixed
        difficulty:
          type: string
          enum:
          - easy
          - medium
          - hard
          - expert
        targetTime:
          type: integer
          description: Target completion time in seconds
        recordTime:
          type: integer
          description: Current record time in seconds
        recordHolder:
          type: string
          format: uuid
          description: Character ID of record holder
        isActive:
          type: boolean
      required:
      - id
      - name
      - courseId
      - category
      - difficulty
      - targetTime
    RealtimeSession:
      type: object
      description: Real-time gameplay session state
      properties:
        sessionId:
          type: string
          format: uuid
        characterId:
          type: string
          format: uuid
        connectionState:
          type: string
          enum:
          - connecting
          - connected
          - disconnected
          - error
        lastHeartbeat:
          type: string
          format: date-time
        protocolVersion:
          type: string
        performanceProfile:
          type: object
          properties:
            latency:
              type: integer
              description: Current latency in ms
            packetLoss:
              type: number
              format: float
              description: Packet loss percentage
            bandwidth:
              type: integer
              description: Bandwidth usage in KB/s
      required:
      - sessionId
      - characterId
      - connectionState
    CombatState:
      type: object
      description: Real-time combat session state
      properties:
        combatId:
          type: string
          format: uuid
        participants:
          type: array
          items:
            type: string
            format: uuid
          description: Character IDs in combat
        state:
          type: string
          enum:
          - initializing
          - active
          - paused
          - completed
          - terminated
        startTime:
          type: string
          format: date-time
        currentTurn:
          type: integer
          minimum: 1
        turnTimeout:
          type: integer
          description: Turn timeout in seconds
        lastActivity:
          type: string
          format: date-time
      required:
      - combatId
      - participants
      - state
  responses: {}
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: '**JWT Bearer token authentication**

        Required for all authenticated endpoints. Token must be obtained from auth-service
        and included in Authorization header.

        **Format:** `Authorization: Bearer <token>`

        **Token Expiry:** 15 minutes for access tokens, 7 days for refresh tokens '
