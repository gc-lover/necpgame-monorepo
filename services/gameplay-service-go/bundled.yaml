openapi: 3.0.3
info:
  title: Gameplay Affixes Service API - Enterprise-Grade Domain Service
  description: '**Enterprise-Grade Gameplay Affixes API for NECPGAME**

    This API manages gameplay affixes system, providing comprehensive affix management,
    rotation control, and performance-optimized operations for MMOFPS RPG content.

    ## Key Features

    - **Affix Management**: Full CRUD operations for affix entities with validation
    - **Rotation System**: Automated weekly affix rotation with manual triggers -
    **Instance Application**: Dynamic affix application to dungeon/raid instances
    - **Analytics**: Comprehensive telemetry and performance metrics - **Real-time
    Effects**: WebSocket integration for live affix effects

    ## Domain Purpose

    The Gameplay Affixes domain manages the dynamic difficulty system for raids and
    dungeons, providing players with fresh and challenging content through randomized
    modifiers.

    ## Performance Targets

    - P99 Latency: <50ms for affix operations, <10ms for effect processing - Memory:
    <10MB for affix configurations, <1KB per instance affixes - Concurrent instances:
    1000+ simultaneous instances with affixes - Response time: <100ms P95 for API
    endpoints

    ## Security Features

    - Server-side affix validation (zero trust model) - Anti-cheat protection for
    affix manipulation - Audit trails for all affix operations - Rate limiting for
    admin operations

    ## Integration Points

    - **Combat Service**: Real-time affix effect processing - **World Service**: Instance
    creation and management - **Analytics Service**: Telemetry data aggregation -
    **Leaderboard Service**: Difficulty-based rankings - **Realtime Gateway**: WebSocket
    synchronization

    ## Affix Categories

    - **Combat**: Damage modifiers, health changes, ability effects - **Environmental**:
    Area effects, weather modifications, terrain changes - **Debuff**: Status effects,
    movement impairments, stat reductions - **Defensive**: Resistance boosts, healing
    modifiers, survivability improvements

    ## Rotation System

    Weekly rotations ensure content freshness with 8-10 active affixes per week. Seasonal
    affixes provide special events and limited-time challenges.

    '
  version: 1.0.0
  license:
    name: Proprietary
    url: https://necpgame.com/license
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@gameplay.necpgame.com
servers:
- url: https://api.necpgame.com/v1/gameplay
  description: Production server
- url: https://staging-api.necpgame.com/v1/gameplay
  description: Staging server
- url: http://localhost:8083/api/v1/gameplay
  description: Local development server
security:
- bearerAuth: []
tags:
- name: Affix Management
  description: Core affix CRUD operations and management
- name: Rotation System
  description: Affix rotation management and scheduling
- name: Instance Operations
  description: Affix application to game instances
- name: Analytics
  description: Affix performance and popularity metrics
- name: Health Monitoring
  description: System health and performance monitoring
paths:
  /health:
    get:
      summary: Health check endpoint
      description: Returns service health status and basic metrics
      tags:
      - Health Monitoring
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/gameplay/affixes/active:
    get:
      summary: Get active affixes for current week
      description: Returns list of currently active affixes in the rotation system
      tags:
      - Affix Management
      responses:
        '200':
          description: List of active affixes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActiveAffixesResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/gameplay/affixes/{id}:
    get:
      summary: Get affix details
      description: Returns detailed information about a specific affix
      tags:
      - Affix Management
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Affix UUID
      responses:
        '200':
          description: Affix details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AffixDetailsResponse'
        '404':
          description: Affix not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/gameplay/instances/{instanceId}/affixes:
    get:
      summary: Get affixes for instance
      description: Returns affixes applied to a specific game instance
      tags:
      - Instance Operations
      parameters:
      - name: instanceId
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Instance UUID
      responses:
        '200':
          description: Instance affixes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAffixesResponse'
        '404':
          description: Instance not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/gameplay/affixes/rotation/current:
    get:
      summary: Get current rotation
      description: Returns information about the current affix rotation
      tags:
      - Rotation System
      responses:
        '200':
          description: Current rotation details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrentRotationResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/gameplay/affixes/rotation/history:
    get:
      summary: Get rotation history
      description: Returns history of past affix rotations
      tags:
      - Rotation System
      parameters:
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 50
          default: 10
        description: Number of rotations to return
      - name: offset
        in: query
        schema:
          type: integer
          minimum: 0
          default: 0
        description: Offset for pagination
      responses:
        '200':
          description: Rotation history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RotationHistoryResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/gameplay/affixes/rotation/trigger:
    post:
      summary: Trigger manual rotation
      description: Manually trigger a new affix rotation (admin only)
      tags:
      - Rotation System
      security:
      - bearerAuth: []
      responses:
        '200':
          description: Rotation triggered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RotationTriggerResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/gameplay/affixes:
    post:
      summary: Create new affix
      description: Create a new affix in the system (admin only)
      tags:
      - Affix Management
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAffixRequest'
      responses:
        '201':
          description: Affix created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Affix'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      summary: List affixes
      description: Get paginated list of all affixes (admin only)
      tags:
      - Affix Management
      security:
      - bearerAuth: []
      parameters:
      - name: category
        in: query
        schema:
          type: string
          enum:
          - combat
          - environmental
          - debuff
          - defensive
        description: Filter by category
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
        description: Number of items per page
      - name: offset
        in: query
        schema:
          type: integer
          minimum: 0
          default: 0
        description: Offset for pagination
      responses:
        '200':
          description: List of affixes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListAffixesResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/admin/gameplay/affixes/{id}:
    put:
      summary: Update affix
      description: Update an existing affix configuration (admin only)
      tags:
      - Affix Management
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Affix UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAffixRequest'
      responses:
        '200':
          description: Affix updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Affix'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Affix not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete affix
      description: Delete an affix from the system (admin only)
      tags:
      - Affix Management
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Affix UUID
      responses:
        '204':
          description: Affix deleted successfully
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema: null
              $ref: '#/components/schemas/Error'
        '404':
          description: Affix not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/analytics/affixes/popularity:
    get:
      summary: Get affix popularity metrics
      description: Returns popularity statistics for affixes
      tags:
      - Analytics
      security:
      - bearerAuth: []
      parameters:
      - name: period
        in: query
        schema:
          type: string
          enum:
          - week
          - month
          - quarter
          default: week
        description: Time period for analysis
      responses:
        '200':
          description: Popularity metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopularityMetricsResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/analytics/affixes/difficulty:
    get:
      summary: Get difficulty metrics
      description: Returns difficulty analysis for affixes
      tags:
      - Analytics
      security:
      - bearerAuth: []
      parameters:
      - name: period
        in: query
        schema:
          type: string
          enum:
          - week
          - month
          - quarter
          default: week
        description: Time period for analysis
      responses:
        '200':
          description: Difficulty metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DifficultyMetricsResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/analytics/affixes/combinations:
    get:
      summary: Get combination analysis
      description: Returns analysis of affix combinations and their success rates
      tags:
      - Analytics
      security:
      - bearerAuth: []
      parameters:
      - name: min_combinations
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 4
          default: 2
        description: Minimum number of affixes in combination
      - name: limit
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 50
          default: 20
        description: Number of combinations to return
      responses:
        '200':
          description: Combination analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombinationAnalysisResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Error:
      type: object
      required:
      - error
      properties:
        error:
          type: object
          required:
          - code
          - message
          properties:
            code:
              type: string
              example: INTERNAL_ERROR
            message:
              type: string
              example: An internal server error occurred
            details:
              type: object
              additionalProperties: true
    HealthResponse:
      type: object
      required:
      - status
      - timestamp
      properties:
        status:
          type: string
          enum:
          - healthy
          - degraded
          - unhealthy
          example: healthy
        timestamp:
          type: string
          format: date-time
          example: '2025-01-05T10:00:00Z'
        version:
          type: string
          example: 1.0.0
        uptime:
          type: integer
          description: Uptime in seconds
          example: 3600
    Affix:
      type: object
      required:
      - affix
      properties:
        affix:
          $ref: '#/components/schemas/Affix'
    ActiveAffixesResponse:
      type: object
      required:
      - affixes
      - rotation
      properties:
        affixes:
          type: array
          items:
            $ref: '#/components/schemas/Affix'
        rotation:
          type: object
          required:
          - week_start
          - week_end
          properties:
            week_start:
              type: string
              format: date-time
            week_end:
              type: string
              format: date-time
            seasonal_affix:
              $ref: '#/components/schemas/Affix'
    AffixDetailsResponse:
      type: object
      required:
      - affix
      properties:
        affix:
          $ref: '#/components/schemas/Affix'
    InstanceAffixesResponse:
      type: object
      required:
      - instance_id
      - affixes
      - modifiers
      properties:
        instance_id:
          type: string
          format: uuid
        affixes:
          type: array
          items:
            $ref: '#/components/schemas/Affix'
        modifiers:
          type: object
          required:
          - reward_modifier
          - difficulty_modifier
          properties:
            reward_modifier:
              type: number
              format: float
            difficulty_modifier:
              type: number
              format: float
    CurrentRotationResponse:
      type: object
      required:
      - rotation
      - affixes
      properties:
        rotation:
          type: object
          required:
          - id
          - week_start
          - week_end
          properties:
            id:
              type: string
              format: uuid
            week_start:
              type: string
              format: date-time
            week_end:
              type: string
              format: date-time
            seasonal_affix:
              $ref: '#/components/schemas/Affix'
        affixes:
          type: array
          items:
            $ref: '#/components/schemas/Affix'
    RotationHistoryResponse:
      type: object
      required:
      - rotations
      - pagination
      properties:
        rotations:
          type: array
          items:
            type: object
            required:
            - id
            - week_start
            - week_end
            - affixes
            properties:
              id:
                type: string
                format: uuid
              week_start:
                type: string
                format: date-time
              week_end:
                type: string
                format: date-time
              seasonal_affix:
                $ref: '#/components/schemas/Affix'
              affixes:
                type: array
                items:
                  $ref: '#/components/schemas/Affix'
        pagination:
          type: object
          required:
          - total
          - limit
          - offset
          properties:
            total:
              type: integer
            limit:
              type: integer
            offset:
              type: integer
    RotationTriggerResponse:
      type: object
      required:
      - success
      - new_rotation
      properties:
        success:
          type: boolean
          example: true
        new_rotation:
          type: object
          required:
          - id
          - week_start
          - week_end
          properties:
            id:
              type: string
              format: uuid
            week_start:
              type: string
              format: date-time
            week_end:
              type: string
              format: date-time
    CreateAffixRequest:
      type: object
      required:
      - name
      - description
      - category
      - reward_modifier
      - difficulty_modifier
      - mechanics
      properties:
        name:
          type: string
          maxLength: 100
          example: New Affix
        description:
          type: string
          example: Description of the new affix
        category:
          type: string
          enum:
          - combat
          - environmental
          - debuff
          - defensive
        reward_modifier:
          type: number
          format: float
          minimum: 1.0
          example: 1.25
        difficulty_modifier:
          type: number
          format: float
          minimum: 1.0
          example: 1.15
        mechanics:
          type: object
          additionalProperties: true
        visual_effects:
          type: object
          additionalProperties: true
    UpdateAffixRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        description:
          type: string
        category:
          type: string
          enum:
          - combat
          - environmental
          - debuff
          - defensive
        reward_modifier:
          type: number
          format: float
          minimum: 1.0
        difficulty_modifier:
          type: number
          format: float
          minimum: 1.0
        mechanics:
          type: object
          additionalProperties: true
        visual_effects:
          type: object
          additionalProperties: true
    ListAffixesResponse:
      type: object
      required:
      - affixes
      - pagination
      properties:
        affixes:
          type: array
          items:
            $ref: '#/components/schemas/Affix'
        pagination:
          type: object
          required:
          - total
          - limit
          - offset
          properties:
            total:
              type: integer
            limit:
              type: integer
            offset:
              type: integer
    PopularityMetricsResponse:
      type: object
      required:
      - period
      - metrics
      properties:
        period:
          type: string
          example: week
        metrics:
          type: array
          items:
            type: object
            required:
            - affix_id
            - name
            - usage_count
            - popularity_rank
            properties:
              affix_id:
                type: string
                format: uuid
              name:
                type: string
              usage_count:
                type: integer
              popularity_rank:
                type: integer
              win_rate:
                type: number
                format: float
    DifficultyMetricsResponse:
      type: object
      required:
      - period
      - metrics
      properties:
        period:
          type: string
          example: week
        metrics:
          type: array
          items:
            type: object
            required:
            - affix_id
            - name
            - avg_completion_time
            - difficulty_score
            properties:
              affix_id:
                type: string
                format: uuid
              name:
                type: string
              avg_completion_time:
                type: integer
                description: Average completion time in seconds
              difficulty_score:
                type: number
                format: float
              failure_rate:
                type: number
                format: float
    CombinationAnalysisResponse:
      type: object
      required:
      - combinations
      properties:
        combinations:
          type: array
          items:
            type: object
            required:
            - affix_ids
            - affix_names
            - usage_count
            - success_rate
            - avg_completion_time
            properties:
              affix_ids:
                type: array
                items:
                  type: string
                  format: uuid
              affix_names:
                type: array
                items:
                  type: string
              usage_count:
                type: integer
              success_rate:
                type: number
                format: float
              avg_completion_time:
                type: integer
                description: Average completion time in seconds
