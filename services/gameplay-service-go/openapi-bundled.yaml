openapi: 3.0.3
info:
  title: Gameplay Service API
  description: |
    API для игровых механик: боевые системы, способности, импланты, стелс, паркур, экстракт-зоны, арены.

    **Основные модули:**
    - Combat Sessions - боевые сессии
    - Combat Abilities - способности и активация
    - Combat Combos - комбо и синергии
    - Combat Implants - импланты и киберпсихоз
    - Stealth System - стелс механики
    - Freerun System - паркур и акробатика
    - Extract Zones - зоны экстракции
    - Arena System - арены

    **Performance:**
    - Hot endpoints: POST /combat/sessions, POST /combat/abilities/activate
    - Expected load: 2k RPS, P99 <50ms
    - Tick rate: 60-128 Hz для боевых действий
  version: 2.0.0
  contact:
    name: NECPGAME API Support
    email: api@necp.game
servers:
  - url: http://localhost:8083/api/v1
    description: Локальный сервер разработки
  - url: https://api.necp.game/api/v1
    description: Продакшен сервер
security:
  - BearerAuth: [ ]
tags:
  - name: Combat Sessions
    description: Боевые сессии
  - name: Combat Abilities
    description: Способности
  - name: Combat Combos
    description: Комбо и синергии
  - name: Combat Implants
    description: Импланты
  - name: Combat AI
    description: AI враги и рейды
  - name: Stealth
    description: Стелс система
  - name: Freerun
    description: Паркур
  - name: Extract Zones
    description: Зоны экстракции
  - name: Arena
    description: Арены
  - name: Loadouts
    description: Лоадауты
  - name: Affixes
    description: Аффиксы рейдов и подземелий
  - name: Quests
    description: Система квестов
paths:
  /gameplay/combat/sessions:
    post:
      summary: Создать боевую сессию
      operationId: createCombatSession
      tags:
        - Combat Sessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSessionRequest'
      responses:
        '201':
          description: Сессия создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatSessionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
    get:
      summary: Список сессий
      operationId: listCombatSessions
      tags:
        - Combat Sessions
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/SessionStatus'
        - name: session_type
          in: query
          schema:
            $ref: '#/components/schemas/SessionType'
      responses:
        '200':
          description: Список сессий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionListResponse'
  /gameplay/combat/sessions/{sessionId}:
    parameters:
      - $ref: '#/components/parameters/SessionId'
    get:
      summary: Получить сессию
      operationId: getCombatSession
      tags:
        - Combat Sessions
      responses:
        '200':
          description: Состояние сессии
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CombatSessionResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Завершить сессию
      operationId: endCombatSession
      tags:
        - Combat Sessions
      responses:
        '200':
          description: Сессия завершена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionEndResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
  /gameplay/combat/abilities/catalog:
    get:
      tags:
        - Ability Catalog
      summary: Получить каталог способностей
      description: |
        Возвращает каталог способностей с возможностью фильтрации по типу, слоту и источнику.
        Поддерживает пагинацию.
      operationId: getAbilityCatalog
      security:
        - BearerAuth: [ ]
      parameters:
        - name: ability_type
          in: query
          schema:
            $ref: '#/components/schemas/AbilityType'
          description: Фильтр по типу способности
        - name: slot
          in: query
          schema:
            $ref: '#/components/schemas/AbilitySlot'
          description: Фильтр по слоту
        - name: source
          in: query
          schema:
            $ref: '#/components/schemas/AbilitySource'
          description: Фильтр по источнику
        - name: min_rank
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 10
          description: Минимальный ранг
        - name: max_rank
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 10
          description: Максимальный ранг
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: object
                required:
                  - abilities
                  - total
                properties:
                  abilities:
                    type: array
                    items:
                      $ref: '#/components/schemas/Ability'
                  total:
                    type: integer
                    minimum: 0
                    description: Общее количество способностей
                    example: 50
                  limit:
                    type: integer
                    minimum: 1
                    example: 20
                  offset:
                    type: integer
                    minimum: 0
                    example: 0
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/{abilityId}:
    get:
      tags:
        - Ability Catalog
      summary: Получить информацию о способности
      description: |
        Возвращает детальную информацию о конкретной способности.
      operationId: getAbilityById
      security:
        - BearerAuth: [ ]
      parameters:
        - name: abilityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор способности
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ability'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/loadouts:
    post:
      tags:
        - Ability Loadouts
      summary: Создать или обновить лоадаут способностей
      description: |
        Создает новый лоадаут или обновляет существующий для текущего персонажа.
        Валидирует требования способностей и проверяет доступность.
      operationId: createOrUpdateAbilityLoadout
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AbilityLoadoutCreate'
      responses:
        '200':
          description: Лоадаут успешно создан или обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilityLoadout'
        '201':
          description: Лоадаут успешно создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilityLoadout'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
        - Ability Loadouts
      summary: Получить список лоадаутов
      description: |
        Возвращает список всех лоадаутов для текущего персонажа.
        Поддерживает фильтрацию по активности и пагинацию.
      operationId: getAbilityLoadouts
      security:
        - BearerAuth: [ ]
      parameters:
        - name: is_active
          in: query
          schema:
            type: boolean
          description: Фильтр по активности лоадаута
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: object
                required:
                  - loadouts
                  - total
                properties:
                  loadouts:
                    type: array
                    items:
                      $ref: '#/components/schemas/AbilityLoadout'
                  total:
                    type: integer
                    minimum: 0
                    description: Общее количество лоадаутов
                    example: 5
                  limit:
                    type: integer
                    minimum: 1
                    example: 20
                  offset:
                    type: integer
                    minimum: 0
                    example: 0
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/activate:
    post:
      tags:
        - Ability Activation
      summary: Активировать способность
      description: |
        Активирует способность для текущего персонажа.
        Проверяет доступность, кулдауны, ресурсы (энергия, здоровье) и киберпсихоз.
        При успешной активации запускает кулдаун и обновляет киберпсихоз.
      operationId: activateAbility
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AbilityActivationRequest'
      responses:
        '200':
          description: Способность успешно активирована
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilityActivationResponse'
        '400':
          description: Ошибка валидации или способность недоступна
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: ValidationError
                message: Ability is on cooldown
                code: ABILITY_ON_COOLDOWN
                details:
                  ability_id: 550e8400-e29b-41d4-a716-446655440000
                  cooldown_expires_at: '2025-11-23T10:00:15Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Способность недоступна из-за ограничений
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: ForbiddenError
                message: Ability requirements not met
                code: ABILITY_REQUIREMENTS_NOT_MET
        '404':
          description: Способность не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: NotFoundError
                message: Ability not found
                code: ABILITY_NOT_FOUND
        '409':
          description: Конфликт при активации (например, недостаточно ресурсов)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: ConflictError
                message: Insufficient energy
                code: INSUFFICIENT_ENERGY
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/cooldowns:
    post:
      tags:
        - Cooldowns
      summary: Проверить статус кулдаунов
      description: |
        Проверяет статус кулдаунов для списка способностей.
        Возвращает информацию о текущих кулдаунах, времени окончания и оставшемся времени.
      operationId: checkCooldowns
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CooldownCheckRequest'
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CooldownCheckResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/synergies:
    get:
      tags:
        - Synergies
      summary: Получить доступные синергии
      description: |
        Возвращает список доступных синергий для текущего персонажа.
        Фильтрует синергии на основе активных способностей, имплантов и экипировки.
        Поддерживает фильтрацию по типу синергии и пагинацию.
      operationId: getAvailableSynergies
      security:
        - BearerAuth: [ ]
      parameters:
        - name: synergy_type
          in: query
          schema:
            $ref: '#/components/schemas/SynergyType'
          description: Фильтр по типу синергии
        - name: complexity
          in: query
          schema:
            type: string
            enum:
              - Bronze
              - Silver
              - Gold
              - Platinum
              - Legendary
          description: Фильтр по сложности
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: object
                required:
                  - synergies
                  - total
                properties:
                  synergies:
                    type: array
                    items:
                      $ref: '#/components/schemas/Synergy'
                  total:
                    type: integer
                    minimum: 0
                    description: Общее количество доступных синергий
                    example: 10
                  limit:
                    type: integer
                    minimum: 1
                    example: 20
                  offset:
                    type: integer
                    minimum: 0
                    example: 0
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/synergies/apply:
    post:
      tags:
        - Synergies
      summary: Применить синергию
      description: |
        Применяет синергию к способности или набору способностей.
        Проверяет требования синергии и применяет бонусы.
      operationId: applySynergy
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SynergyApplyRequest'
      responses:
        '200':
          description: Синергия успешно применена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SynergyApplyResponse'
        '400':
          description: Ошибка валидации или синергия недоступна
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: ValidationError
                message: Synergy requirements not met
                code: SYNERGY_REQUIREMENTS_NOT_MET
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Синергия недоступна
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: ForbiddenError
                message: Synergy not available
                code: SYNERGY_NOT_AVAILABLE
        '404':
          description: Синергия не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: NotFoundError
                message: Synergy not found
                code: SYNERGY_NOT_FOUND
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/cyberpsychosis:
    post:
      tags:
        - Cyberpsychosis
      summary: Обновить состояние киберпсихоза
      description: |
        Обновляет состояние киберпсихоза на основе использования способности.
        Рассчитывает влияние способности на киберпсихоз с учетом активных имплантов.
        Проверяет пороговые значения и применяет ограничения при необходимости.
      operationId: updateCyberpsychosis
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CyberpsychosisUpdateRequest'
      responses:
        '200':
          description: Состояние киберпсихоза успешно обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CyberpsychosisState'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Способность не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: NotFoundError
                message: Ability not found
                code: ABILITY_NOT_FOUND
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
        - Cyberpsychosis
      summary: Получить текущее состояние киберпсихоза
      description: |
        Возвращает текущее состояние киберпсихоза для текущего персонажа.
        Включает уровень киберпсихоза, количество превышений порогов и активные ограничения.
      operationId: getCyberpsychosisState
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CyberpsychosisState'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Состояние киберпсихоза не найдено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: NotFoundError
                message: Cyberpsychosis state not found
                code: CYBERPSYCHOSIS_STATE_NOT_FOUND
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/abilities/metrics:
    get:
      tags:
        - Metrics
      summary: Получить метрики способностей
      description: |
        Возвращает метрики использования способностей для текущего персонажа.
        Поддерживает фильтрацию по способности и периоду времени.
      operationId: getAbilityMetrics
      security:
        - BearerAuth: [ ]
      parameters:
        - name: ability_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по идентификатору способности
        - name: period_start
          in: query
          schema:
            type: string
            format: date-time
          description: Начало периода статистики
        - name: period_end
          in: query
          schema:
            type: string
            format: date-time
          description: Конец периода статистики
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: object
                required:
                  - metrics
                  - total
                properties:
                  metrics:
                    type: array
                    items:
                      $ref: '#/components/schemas/AbilityMetrics'
                  total:
                    type: integer
                    minimum: 0
                    description: Общее количество записей метрик
                    example: 10
                  limit:
                    type: integer
                    minimum: 1
                    example: 20
                  offset:
                    type: integer
                    minimum: 0
                    example: 0
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/combos/catalog:
    get:
      tags:
        - Combo Catalog
      summary: Получить каталог комбо
      operationId: getComboCatalog
      security:
        - BearerAuth: [ ]
      parameters:
        - name: combo_type
          in: query
          schema:
            $ref: '#/components/schemas/ComboType'
        - name: complexity
          in: query
          schema:
            $ref: '#/components/schemas/ComboComplexity'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Каталог комбо
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboCatalogResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/combos/activate:
    post:
      tags:
        - Combo Activation
      summary: Активировать комбо
      operationId: activateCombo
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivateComboRequest'
      responses:
        '200':
          description: Комбо активировано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboActivationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/combos/loadout:
    get:
      tags:
        - Combo Loadouts
      summary: Получить лоадаут комбо
      operationId: getComboLoadout
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Лоадаут комбо
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboLoadout'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Combo Loadouts
      summary: Обновить лоадаут комбо
      operationId: updateComboLoadout
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateLoadoutRequest'
      responses:
        '200':
          description: Лоадаут обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboLoadout'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/combos/score:
    post:
      tags:
        - Combo Scoring
      summary: Отправить результаты scoring
      operationId: submitComboScore
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitScoreRequest'
      responses:
        '200':
          description: Score отправлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScoreSubmissionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/combos/analytics:
    get:
      tags:
        - Combo Analytics
      summary: Получить аналитику комбо
      operationId: getComboAnalytics
      security:
        - BearerAuth: [ ]
      parameters:
        - name: combo_id
          in: query
          schema:
            type: string
            format: uuid
        - name: character_id
          in: query
          schema:
            type: string
            format: uuid
        - name: period_start
          in: query
          schema:
            type: string
            format: date-time
        - name: period_end
          in: query
          schema:
            type: string
            format: date-time
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Аналитика комбо
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyticsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/implants:
    get:
      tags:
        - Combat Implants
      summary: Получить установленные импланты
      operationId: getInstalledImplants
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Список имплантов
          content:
            application/json:
              schema:
                type: object
                properties:
                  implants:
                    type: array
                    items:
                      $ref: '#/components/schemas/Implant'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/ai/encounter:
    post:
      tags:
        - Encounters
      summary: Создание встречи
      description: |
        Создает новую встречу с AI врагами в указанной зоне.
        Встреча может быть обычной или рейдовой.
      operationId: createEncounter
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEncounterRequest'
      responses:
        '201':
          description: Встреча создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIEncounter'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/ai/encounter/{encounter_id}:
    get:
      tags:
        - Encounters
      summary: Информация о встрече
      description: Возвращает детальную информацию о встрече с AI врагами.
      operationId: getEncounter
      security:
        - BearerAuth: [ ]
      parameters:
        - name: encounter_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор встречи
          example: 550e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Информация о встрече
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIEncounter'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/ai/encounter/{encounter_id}/start:
    post:
      tags:
        - Encounters
      summary: Старт встречи
      description: |
        Запускает встречу с AI врагами. После старта враги становятся активными
        и начинают использовать поведенческие паттерны.
      operationId: startEncounter
      security:
        - BearerAuth: [ ]
      parameters:
        - name: encounter_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор встречи
          example: 550e8400-e29b-41d4-a716-446655440002
      responses:
        '200':
          description: Встреча запущена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIEncounter'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/ai/encounter/{encounter_id}/end:
    post:
      tags:
        - Encounters
      summary: Завершение встречи
      description: |
        Завершает встречу с AI врагами. Обрабатывает результат встречи,
        начисляет награды и обновляет телеметрию.
      operationId: endEncounter
      security:
        - BearerAuth: [ ]
      parameters:
        - name: encounter_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор встречи
          example: 550e8400-e29b-41d4-a716-446655440002
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EndEncounterRequest'
      responses:
        '200':
          description: Встреча завершена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIEncounter'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/ai/profiles:
    get:
      tags:
        - AI Profiles
      summary: Список профилей AI
      description: |
        Возвращает список всех профилей AI врагов с возможностью фильтрации
        по слою сложности, фракции и уровню навыков.
      operationId: listAIProfiles
      security:
        - BearerAuth: [ ]
      parameters:
        - name: difficulty_layer
          in: query
          schema:
            type: string
            enum:
              - street
              - tactical
              - mythic
              - raid
          description: Фильтр по слою сложности
        - name: faction_id
          in: query
          schema:
            type: string
            format: uuid
          description: Фильтр по фракции
        - name: skill_level_min
          in: query
          schema:
            type: integer
            minimum: 1
          description: Минимальный уровень навыков
        - name: skill_level_max
          in: query
          schema:
            type: integer
            minimum: 1
          description: Максимальный уровень навыков
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Список профилей AI
          content:
            application/json:
              schema:
                type: object
                required:
                  - profiles
                  - total
                properties:
                  profiles:
                    type: array
                    items:
                      $ref: '#/components/schemas/AIProfile'
                  total:
                    type: integer
                    minimum: 0
                    example: 50
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/ai/profiles/{profile_id}:
    get:
      tags:
        - AI Profiles
      summary: Информация о профиле AI
      description: Возвращает детальную информацию о конкретном профиле AI врага.
      operationId: getAIProfile
      security:
        - BearerAuth: [ ]
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор профиля AI
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Информация о профиле AI
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIProfile'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/ai/profiles/{profile_id}/telemetry:
    get:
      tags:
        - Telemetry
      summary: Телеметрия профиля AI
      description: |
        Возвращает телеметрию для указанного профиля AI, включая метрики урона,
        времени до поражения, использования способностей и балансировки.
      operationId: getAIProfileTelemetry
      security:
        - BearerAuth: [ ]
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор профиля AI
          example: 550e8400-e29b-41d4-a716-446655440000
        - name: start_date
          in: query
          schema:
            type: string
            format: date-time
          description: Начальная дата для выборки телеметрии
        - name: end_date
          in: query
          schema:
            type: string
            format: date-time
          description: Конечная дата для выборки телеметрии
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Телеметрия профиля AI
          content:
            application/json:
              schema:
                type: object
                required:
                  - telemetry
                  - total
                properties:
                  telemetry:
                    type: array
                    items:
                      $ref: '#/components/schemas/AITelemetry'
                  total:
                    type: integer
                    minimum: 0
                    example: 100
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/raids/{raid_id}/phase:
    post:
      tags:
        - Raids
      summary: Переход фазы рейда
      description: |
        Переводит рейдовую сессию в следующую фазу. Используется для управления
        фазами боссов и механиками рейдов.
      operationId: transitionRaidPhase
      security:
        - BearerAuth: [ ]
      parameters:
        - name: raid_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Идентификатор рейдовой сессии
          example: 550e8400-e29b-41d4-a716-446655440001
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RaidPhaseTransitionRequest'
      responses:
        '200':
          description: Фаза рейда переведена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RaidSession'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/combat/stealth/status:
    get:
      tags:
        - Stealth
      summary: Получить статус стелса
      operationId: getStealthStatus
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Статус стелса
          content:
            application/json:
              schema:
                type: object
                properties:
                  is_stealthed:
                    type: boolean
                  detection_level:
                    type: number
                    format: float
        '401':
          $ref: '#/components/responses/Unauthorized'
  /gameplay/combat/freerun/routes:
    get:
      tags:
        - Freerun
      summary: Получить доступные маршруты паркура
      operationId: getFreerunRoutes
      security:
        - BearerAuth: [ ]
      parameters:
        - name: position
          in: query
          required: true
          schema:
            type: string
          description: x,y,z
        - name: radius
          in: query
          schema:
            type: number
            format: float
            default: 100
      responses:
        '200':
          description: Список маршрутов
          content:
            application/json:
              schema:
                type: object
                properties:
                  routes:
                    type: array
        '401':
          $ref: '#/components/responses/Unauthorized'
  /gameplay/extract/zones:
    get:
      tags:
        - Extract Zones
      summary: Получить зоны экстракции
      operationId: getExtractZones
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Список зон
          content:
            application/json:
              schema:
                type: object
                properties:
                  zones:
                    type: array
        '401':
          $ref: '#/components/responses/Unauthorized'
  /gameplay/arena/sessions:
    get:
      tags:
        - Arena
      summary: Получить ареновые сессии
      operationId: getArenaSessions
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Список сессий
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessions:
                    type: array
        '401':
          $ref: '#/components/responses/Unauthorized'
  /gameplay/loadouts:
    get:
      tags:
        - Loadouts
      summary: Получить лоадауты персонажа
      operationId: getLoadouts
      security:
        - BearerAuth: [ ]
      parameters:
        - name: character_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Список лоадаутов
          content:
            application/json:
              schema:
                type: object
                properties:
                  loadouts:
                    type: array
        '401':
          $ref: '#/components/responses/Unauthorized'
  /gameplay/affixes/active:
    get:
      tags:
        - Affixes
      summary: Получить список активных аффиксов
      description: |
        Возвращает список аффиксов, активных в текущей неделе.
        Аффиксы ротируются еженедельно (понедельник 00:00 UTC).
      operationId: getActiveAffixes
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: Список активных аффиксов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActiveAffixesResponse'
              example:
                week_start: '2025-12-01T00:00:00Z'
                week_end: '2025-12-08T00:00:00Z'
                active_affixes:
                  - id: 550e8400-e29b-41d4-a716-446655440000
                    name: Volatile
                    category: combat
                    description: Враги взрываются при смерти, нанося урон в радиусе
                    reward_modifier: 1.25
                    difficulty_modifier: 1.15
                  - id: 550e8400-e29b-41d4-a716-446655440001
                    name: Fortified
                    category: defensive
                    description: Враги имеют +50% HP
                    reward_modifier: 1.35
                    difficulty_modifier: 1.25
                seasonal_affix:
                  id: 550e8400-e29b-41d4-a716-446655440002
                  name: Frostbite
                  category: environmental
                  description: Периодически накладывает замедление на игроков
                  reward_modifier: 1.5
                  difficulty_modifier: 1.4
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/affixes/{id}:
    get:
      tags:
        - Affixes
      summary: Получить информацию об аффиксе
      description: |
        Возвращает детальную информацию об аффиксе по его ID.
        Включает описание механик, визуальные эффекты и модификаторы.
      operationId: getAffix
      security:
        - BearerAuth: [ ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID аффикса
      responses:
        '200':
          description: Информация об аффиксе
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Affix'
              example:
                id: 550e8400-e29b-41d4-a716-446655440000
                name: Volatile
                category: combat
                description: Враги взрываются при смерти, нанося урон в радиусе 5 метров
                mechanics:
                  trigger: enemy_death
                  effect_type: area_damage
                  radius: 5
                  damage_percent: 50
                  damage_type: fire
                visual_effects:
                  explosion_particle: volatile_explosion
                  sound_effect: volatile_explode
                  screen_shake: true
                reward_modifier: 1.25
                difficulty_modifier: 1.15
                created_at: '2025-11-01T00:00:00Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/instances/{instance_id}/affixes:
    get:
      tags:
        - Instance Affixes
      summary: Получить аффиксы инстанса
      description: |
        Возвращает список аффиксов, примененных к конкретному инстансу рейда или подземелья.
        Каждый инстанс имеет 2-4 случайных аффикса из активных.
      operationId: getInstanceAffixes
      security:
        - BearerAuth: [ ]
      parameters:
        - name: instance_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID инстанса рейда или подземелья
      responses:
        '200':
          description: Аффиксы инстанса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAffixesResponse'
              example:
                instance_id: 660e8400-e29b-41d4-a716-446655440000
                applied_at: '2025-12-01T10:30:00Z'
                affixes:
                  - id: 550e8400-e29b-41d4-a716-446655440000
                    name: Volatile
                    category: combat
                    description: Враги взрываются при смерти
                    reward_modifier: 1.25
                    difficulty_modifier: 1.15
                  - id: 550e8400-e29b-41d4-a716-446655440001
                    name: Fortified
                    category: defensive
                    description: Враги имеют +50% HP
                    reward_modifier: 1.35
                    difficulty_modifier: 1.25
                total_reward_modifier: 1.69
                total_difficulty_modifier: 1.44
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/affixes/rotation/history:
    get:
      tags:
        - Affix Rotation
      summary: Получить историю ротаций аффиксов
      description: |
        Возвращает историю еженедельных ротаций аффиксов.
        Поддерживает пагинацию для просмотра прошлых ротаций.
      operationId: getAffixRotationHistory
      security:
        - BearerAuth: [ ]
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
        - name: weeks_back
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 52
            default: 4
          description: Количество недель назад для получения истории
      responses:
        '200':
          description: История ротаций
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AffixRotationHistoryResponse'
              example:
                items:
                  - id: 770e8400-e29b-41d4-a716-446655440000
                    week_start: '2025-12-01T00:00:00Z'
                    week_end: '2025-12-08T00:00:00Z'
                    active_affixes:
                      - id: 550e8400-e29b-41d4-a716-446655440000
                        name: Volatile
                      - id: 550e8400-e29b-41d4-a716-446655440001
                        name: Fortified
                    seasonal_affix:
                      id: 550e8400-e29b-41d4-a716-446655440002
                      name: Frostbite
                    created_at: '2025-12-01T00:00:00Z'
                total: 52
                limit: 20
                offset: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/affixes/rotation/trigger:
    post:
      tags:
        - Affix Rotation
      summary: Запустить ротацию аффиксов (admin)
      description: |
        Принудительно запускает ротацию аффиксов для следующей недели.
        Доступно только администраторам.
        Обычно ротация происходит автоматически каждую неделю (понедельник 00:00 UTC).
      operationId: triggerAffixRotation
      security:
        - BearerAuth: [ ]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerRotationRequest'
            example:
              force: false
              custom_affixes:
                - 550e8400-e29b-41d4-a716-446655440000
                - 550e8400-e29b-41d4-a716-446655440001
                - 550e8400-e29b-41d4-a716-446655440002
                - 550e8400-e29b-41d4-a716-446655440003
                - 550e8400-e29b-41d4-a716-446655440004
                - 550e8400-e29b-41d4-a716-446655440005
                - 550e8400-e29b-41d4-a716-446655440006
                - 550e8400-e29b-41d4-a716-446655440007
      responses:
        '200':
          description: Ротация успешно запущена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AffixRotation'
              example:
                id: 770e8400-e29b-41d4-a716-446655440001
                week_start: '2025-12-08T00:00:00Z'
                week_end: '2025-12-15T00:00:00Z'
                active_affixes:
                  - id: 550e8400-e29b-41d4-a716-446655440003
                    name: Raging
                  - id: 550e8400-e29b-41d4-a716-446655440004
                    name: Afflicted
                seasonal_affix:
                  id: 550e8400-e29b-41d4-a716-446655440005
                  name: Heat Wave
                created_at: '2025-12-08T00:00:00Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/start:
    post:
      tags:
        - Quest Management
      summary: Начать квест
      description: |
        Начинает новый квест для текущего игрока.
        Проверяет требования квеста и создаёт инстанс квеста.
      operationId: startQuest
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartQuestRequest'
      responses:
        '200':
          description: Квест успешно начат
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StartQuestResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}:
    get:
      tags:
        - Quest Management
      summary: Получить информацию о квесте
      description: |
        Возвращает информацию о квесте по ID инстанса квеста.
        Включает состояние, прогресс и детали квеста.
      operationId: getQuest
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Информация о квесте
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestInstance'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/by-player/{player_id}:
    get:
      tags:
        - Quest Management
      summary: Получить квесты игрока
      description: |
        Возвращает список всех квестов игрока.
        Поддерживает фильтрацию по состоянию и пагинацию.
      operationId: getPlayerQuests
      security:
        - BearerAuth: [ ]
      parameters:
        - name: player_id
          in: path
          required: true
          description: ID игрока
          schema:
            type: string
            format: uuid
        - name: state
          in: query
          description: Фильтр по состоянию квеста
          schema:
            type: string
            enum:
              - NOT_STARTED
              - IN_PROGRESS
              - COMPLETED
              - FAILED
              - CANCELLED
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Список квестов игрока
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/complete:
    post:
      tags:
        - Quest Management
      summary: Завершить квест
      description: |
        Завершает квест и распределяет награды.
        Проверяет выполнение всех целей перед завершением.
      operationId: completeQuest
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteQuestRequest'
      responses:
        '200':
          description: Квест успешно завершён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompleteQuestResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/cancel:
    post:
      tags:
        - Quest Management
      summary: Отменить квест
      description: |
        Отменяет активный квест.
        Квест переходит в состояние CANCELLED.
      operationId: cancelQuest
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Квест успешно отменён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestInstance'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/state:
    get:
      tags:
        - Quest State
      summary: Получить состояние квеста
      description: |
        Возвращает текущее состояние квеста, включая текущую цель и данные прогресса.
      operationId: getQuestState
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Состояние квеста
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestState'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Quest State
      summary: Обновить состояние квеста
      description: |
        Обновляет состояние квеста.
        Используется для переходов между состояниями и обновления прогресса.
      operationId: updateQuestState
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateStateRequest'
      responses:
        '200':
          description: Состояние квеста обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestState'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/dialogue:
    get:
      tags:
        - Quest Dialogue
      summary: Получить текущий диалог
      description: |
        Возвращает текущий узел диалога для квеста.
        Включает текст, варианты выбора и проверки навыков.
      operationId: getQuestDialogue
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Текущий диалог
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DialogueNode'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/dialogue/choice:
    post:
      tags:
        - Quest Dialogue
      summary: Сделать выбор в диалоге
      description: |
        Обрабатывает выбор игрока в диалоге.
        Переходит к следующему узлу диалога на основе выбора.
      operationId: makeDialogueChoice
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DialogueChoiceRequest'
      responses:
        '200':
          description: Выбор обработан, возвращается следующий узел диалога
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DialogueNode'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/dialogue/history:
    get:
      tags:
        - Quest Dialogue
      summary: Получить историю диалогов
      description: |
        Возвращает полную историю диалогов для квеста.
        Включает все пройденные узлы и сделанные выборы.
      operationId: getDialogueHistory
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: История диалогов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DialogueHistory'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/skill-check:
    post:
      tags:
        - Skill Checks
      summary: Выполнить проверку навыка
      description: |
        Выполняет проверку навыка для квеста.
        Проверяет атрибуты, навыки, предметы или репутацию персонажа.
      operationId: performSkillCheck
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SkillCheckRequest'
      responses:
        '200':
          description: Результат проверки навыка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillCheckResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/skill-checks:
    get:
      tags:
        - Skill Checks
      summary: Получить историю проверок навыков
      description: |
        Возвращает историю всех проверок навыков для квеста.
        Поддерживает пагинацию.
      operationId: getSkillCheckHistory
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
        - name: check_type
          in: query
          description: Фильтр по типу проверки
          schema:
            type: string
            enum:
              - attribute
              - skill
              - item
              - reputation
        - name: passed
          in: query
          description: Фильтр по результату (true/false)
          schema:
            type: boolean
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: История проверок навыков
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillChecksResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/conditions/check:
    post:
      tags:
        - Quest Conditions
      summary: Проверить условия квеста
      description: |
        Проверяет условия квеста (требования для начала, условия для завершения, условия для целей).
        Возвращает результат проверки всех условий.
      operationId: checkQuestConditions
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Результат проверки условий
          content:
            application/json:
              schema:
                type: object
                required:
                  - all_conditions_met
                  - conditions
                properties:
                  all_conditions_met:
                    type: boolean
                    description: Все условия выполнены
                  conditions:
                    type: array
                    description: Детали проверки каждого условия
                    items:
                      type: object
                      properties:
                        condition_type:
                          type: string
                        condition_target:
                          type: string
                        required_value:
                          type: integer
                        actual_value:
                          type: integer
                        met:
                          type: boolean
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/requirements:
    get:
      tags:
        - Quest Conditions
      summary: Получить требования квеста
      description: |
        Возвращает все требования для начала квеста.
        Включает уровень, предметы, предыдущие квесты, репутацию и местоположение.
      operationId: getQuestRequirements
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID определения квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Требования квеста
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestRequirements'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/rewards/distribute:
    post:
      tags:
        - Quest Rewards
      summary: Распределить награды за квест
      description: |
        Распределяет награды за завершённый квест.
        Выдаёт опыт, валюту, предметы, репутацию и титулы.
        Интегрируется с economy-service и mail-service.
      operationId: distributeQuestRewards
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Награды успешно распределены
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - rewards
                properties:
                  success:
                    type: boolean
                    description: Успешно ли распределены награды
                  rewards:
                    $ref: '#/components/schemas/QuestRewards'
                  distribution_details:
                    type: object
                    description: Детали распределения (какие награды куда отправлены)
                    additionalProperties: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/rewards:
    get:
      tags:
        - Quest Rewards
      summary: Получить награды квеста
      description: |
        Возвращает информацию о наградах квеста.
        Показывает, какие награды будут выданы при завершении квеста.
      operationId: getQuestRewards
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID определения квеста или инстанса квеста
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Награды квеста
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestRewards'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/{quest_id}/events:
    get:
      tags:
        - Quest Events
      summary: Получить события квеста
      description: |
        Возвращает историю событий квеста.
        Включает события начала, выполнения целей, завершения и отмены.
        Поддерживает фильтрацию по типу события и пагинацию.
      operationId: getQuestEvents
      security:
        - BearerAuth: [ ]
      parameters:
        - name: quest_id
          in: path
          required: true
          description: ID инстанса квеста
          schema:
            type: string
            format: uuid
        - name: event_type
          in: query
          description: Фильтр по типу события
          schema:
            type: string
            enum:
              - started
              - objective-completed
              - completed
              - failed
              - cancelled
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Список событий квеста
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestEventsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /gameplay/quests/content/reload:
    post:
      tags:
        - Quests
      summary: Импортировать контентный квест из YAML в БД
      operationId: reloadQuestContent
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReloadQuestContentRequest'
      responses:
        '200':
          description: Квест успешно импортирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReloadQuestContentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации
  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: BadRequest
            message: Неверные параметры запроса
            code: INVALID_PARAMETERS
    Unauthorized:
      description: Требуется аутентификация
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Unauthorized
            message: Требуется аутентификация
            code: AUTH_REQUIRED
    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: InternalServerError
            message: Внутренняя ошибка сервера
            code: INTERNAL_ERROR
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: NotFound
            message: Ресурс не найден
            code: RESOURCE_NOT_FOUND
    Forbidden:
      description: Доступ запрещен
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Forbidden
            message: Доступ запрещен
            code: ACCESS_DENIED
    Conflict:
      description: Конфликт ресурсов
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Conflict
            message: Конфликт ресурсов
            code: RESOURCE_CONFLICT
  parameters:
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 50
      description: Количество элементов на странице
    Offset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Смещение для пагинации
    SessionId:
      name: sessionId
      in: path
      required: true
      schema:
        type: string
        format: uuid
  schemas:
    SessionStatus:
      type: string
      enum:
        - pending
        - active
        - ended
        - aborted
    SessionType:
      type: string
      enum:
        - pvp_arena
        - pve_raid
        - extract_zone
        - guild_war
    PaginationResponse:
      type: object
      required:
        - items
        - total
      properties:
        items:
          type: array
          description: Список элементов
        total:
          type: integer
          minimum: 0
          description: Общее количество элементов
        limit:
          type: integer
          minimum: 1
          description: Количество элементов на странице
        offset:
          type: integer
          minimum: 0
          description: Смещение для пагинации
        has_more:
          type: boolean
          description: Есть ли еще элементы
    SessionSummary:
      type: object
      required:
        - id
        - session_type
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/SessionStatus'
        session_type:
          $ref: '#/components/schemas/SessionType'
        participant_count:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SessionListResponse:
      type: object
      required:
        - items
        - pagination
      properties:
        pagination:
          $ref: '#/components/schemas/PaginationResponse'
        items:
          type: array
          items:
            $ref: '#/components/schemas/SessionSummary'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Difficulty:
      type: string
      enum:
        - normal
        - hard
        - elite
    CreateSessionRequest:
      type: object
      required:
        - session_type
        - participants
      properties:
        zone_id:
          type: string
        settings:
          type: object
        difficulty:
          $ref: '#/components/schemas/Difficulty'
        session_type:
          $ref: '#/components/schemas/SessionType'
        participants:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          maxItems: 200
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    BaseEntity:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор
    TimestampFields:
      type: object
      properties:
        created_at:
          type: string
          format: date-time
          description: Дата создания
        updated_at:
          type: string
          format: date-time
          description: Дата обновления
          nullable: true
        expires_at:
          type: string
          format: date-time
          description: Дата истечения
          nullable: true
    BaseEntityWithTimestamps:
      allOf:
        - $ref: '#/components/schemas/BaseEntity'
        - $ref: '#/components/schemas/TimestampFields'
    Participant:
      type: object
      required:
        - player_id
        - character_id
        - team
        - role
        - health
        - max_health
        - status
      properties:
        player_id:
          type: string
          format: uuid
        character_id:
          type: string
          format: uuid
        team:
          type: string
          enum:
            - team_a
            - team_b
            - solo
        role:
          type: string
          enum:
            - assault
            - support
            - tech
            - stealth
        status:
          type: string
          enum:
            - alive
            - dead
            - extracted
            - disconnected
        damage_dealt:
          type: integer
          format: int64
        damage_taken:
          type: integer
          format: int64
        healing_done:
          type: integer
          format: int64
        kills:
          type: integer
        deaths:
          type: integer
        assists:
          type: integer
        health:
          type: integer
        max_health:
          type: integer
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CombatSessionResponse:
      allOf:
        - $ref: '#/components/schemas/BaseEntityWithTimestamps'
        - type: object
          required:
            - session_type
            - status
            - participants
          properties:
            session_type:
              $ref: '#/components/schemas/SessionType'
            status:
              $ref: '#/components/schemas/SessionStatus'
            zone_id:
              type: string
            difficulty:
              $ref: '#/components/schemas/Difficulty'
            participants:
              type: array
              items:
                $ref: '#/components/schemas/Participant'
            winner_team:
              type: string
              nullable: true
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Тип ошибки
        message:
          type: string
          description: Сообщение об ошибке
        code:
          type: string
          description: Код ошибки
          nullable: true
        details:
          type: object
          additionalProperties: true
          description: Дополнительные детали ошибки
          nullable: true
    Reward:
      type: object
      required:
        - player_id
        - experience
        - currency
      properties:
        player_id:
          type: string
          format: uuid
        currency:
          type: object
          properties:
            eurodollars:
              type: integer
            cryptos:
              type: integer
        items:
          type: array
          items:
            type: object
            required:
              - item_id
              - quantity
            properties:
              item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
        experience:
          type: integer
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SessionEndResponse:
      type: object
      required:
        - session_id
        - status
      properties:
        session_id:
          type: string
          format: uuid
        winner_team:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/SessionStatus'
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/Reward'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilityType:
      type: string
      enum:
        - tactical
        - signature
        - ultimate
        - passive
        - hacking
      description: Тип способности
      example: tactical
    AbilitySlot:
      type: string
      enum:
        - Q
        - E
        - R
        - passive
        - hacking
      description: Слот способности
      example: Q
    AbilitySource:
      type: string
      enum:
        - equipment
        - implant
        - progression
        - cyberdeck
      description: Источник способности
      example: progression
    Ability:
      type: object
      required:
        - id
        - name
        - ability_type
        - slot
        - source
        - rank
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор способности
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: Название способности
          example: Thermal Grenade
        description:
          type: string
          description: Описание способности
          example: Бросает термическую гранату, наносящую урон по области
        created_at:
          type: string
          format: date-time
          description: Дата создания
          example: '2025-11-23T10:00:00Z'
        requirements:
          type: object
          description: Требования для использования способности
          properties:
            min_level:
              type: integer
              minimum: 1
              example: 10
            required_attributes:
              type: object
              additionalProperties:
                type: integer
              example:
                strength: 15
                intelligence: 10
            required_skills:
              type: array
              items:
                type: string
              example:
                - combat
                - tactics
            required_abilities:
              type: array
              items:
                type: string
                format: uuid
              example: [ ]
        modifiers:
          type: object
          description: Модификаторы способности
          properties:
            damage_multiplier:
              type: number
              format: float
              minimum: 0
              example: 1.2
            range_bonus:
              type: number
              format: float
              minimum: 0
              example: 1.5
            duration_bonus:
              type: number
              format: float
              minimum: 0
              example: 1.3
        slot:
          $ref: '#/components/schemas/AbilitySlot'
        source:
          $ref: '#/components/schemas/AbilitySource'
        ability_type:
          $ref: '#/components/schemas/AbilityType'
        rank:
          type: integer
          minimum: 1
          maximum: 10
          description: Ранг способности
          example: 5
        energy_cost:
          type: integer
          minimum: 0
          description: Стоимость энергии
          example: 25
        health_cost:
          type: integer
          minimum: 0
          description: Стоимость здоровья
          example: 0
        cooldown_base:
          type: integer
          minimum: 0
          description: Базовое время кулдауна в секундах
          example: 15
        cyberpsychosis_impact:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Влияние на киберпсихоз (0-1)
          example: 0.05
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilityLoadout:
      type: object
      required:
        - id
        - character_id
        - name
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор лоадаута
          example: 550e8400-e29b-41d4-a716-446655440001
        character_id:
          type: string
          format: uuid
          description: Идентификатор персонажа
          example: 550e8400-e29b-41d4-a716-446655440002
        slot_q:
          type: string
          format: uuid
          nullable: true
          description: Способность в слоте Q
          example: 550e8400-e29b-41d4-a716-446655440000
        slot_e:
          type: string
          format: uuid
          nullable: true
          description: Способность в слоте E
          example: 550e8400-e29b-41d4-a716-446655440003
        slot_r:
          type: string
          format: uuid
          nullable: true
          description: Способность в слоте R
          example: 550e8400-e29b-41d4-a716-446655440004
        name:
          type: string
          description: Название лоадаута
          example: Assault Build
        created_at:
          type: string
          format: date-time
          description: Дата создания
          example: '2025-11-23T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          description: Дата обновления
          example: '2025-11-23T10:00:00Z'
        passive_abilities:
          type: array
          items:
            type: string
            format: uuid
          description: Список пассивных способностей
          example:
            - 550e8400-e29b-41d4-a716-446655440005
        hacking_abilities:
          type: array
          items:
            type: string
            format: uuid
          description: Список хакерских способностей
          example:
            - 550e8400-e29b-41d4-a716-446655440006
        priority:
          type: integer
          minimum: 1
          description: Приоритет лоадаута
          example: 1
        auto_cast_enabled:
          type: boolean
          description: Автоматическая активация способностей
          example: false
        is_active:
          type: boolean
          description: Активен ли лоадаут
          example: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilityLoadoutCreate:
      type: object
      required:
        - name
      properties:
        slot_q:
          type: string
          format: uuid
          nullable: true
          description: Способность в слоте Q
          example: 550e8400-e29b-41d4-a716-446655440000
        slot_e:
          type: string
          format: uuid
          nullable: true
          description: Способность в слоте E
          example: 550e8400-e29b-41d4-a716-446655440003
        slot_r:
          type: string
          format: uuid
          nullable: true
          description: Способность в слоте R
          example: 550e8400-e29b-41d4-a716-446655440004
        name:
          type: string
          description: Название лоадаута
          example: Assault Build
        passive_abilities:
          type: array
          items:
            type: string
            format: uuid
          description: Список пассивных способностей
          example:
            - 550e8400-e29b-41d4-a716-446655440005
        hacking_abilities:
          type: array
          items:
            type: string
            format: uuid
          description: Список хакерских способностей
          example:
            - 550e8400-e29b-41d4-a716-446655440006
        priority:
          type: integer
          minimum: 1
          description: Приоритет лоадаута
          example: 1
        auto_cast_enabled:
          type: boolean
          description: Автоматическая активация способностей
          example: false
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilityActivationRequest:
      type: object
      required:
        - ability_id
      properties:
        ability_id:
          type: string
          format: uuid
          description: Идентификатор способности для активации
          example: 550e8400-e29b-41d4-a716-446655440000
        target_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор цели (если требуется)
          example: 550e8400-e29b-41d4-a716-446655440007
        position:
          type: object
          nullable: true
          description: Позиция для активации (если требуется)
          properties:
            x:
              type: number
              format: float
            'y':
              type: number
              format: float
            z:
              type: number
              format: float
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilityActivationResponse:
      type: object
      required:
        - success
        - ability_id
      properties:
        ability_id:
          type: string
          format: uuid
          description: Идентификатор активированной способности
          example: 550e8400-e29b-41d4-a716-446655440000
        message:
          type: string
          nullable: true
          description: Сообщение о результате
          example: Ability activated successfully
        cooldown_expires_at:
          type: string
          format: date-time
          nullable: true
          description: Время окончания кулдауна
          example: '2025-11-23T10:00:15Z'
        cyberpsychosis_level:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Текущий уровень киберпсихоза
          example: 0.15
        success:
          type: boolean
          description: Успешность активации
          example: true
        cooldown_started:
          type: boolean
          description: Запущен ли кулдаун
          example: true
        synergy_triggered:
          type: boolean
          description: Сработала ли синергия
          example: false
        cyberpsychosis_updated:
          type: boolean
          description: Обновлен ли киберпсихоз
          example: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CooldownCheckRequest:
      type: object
      required:
        - ability_ids
      properties:
        ability_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Список идентификаторов способностей для проверки
          example:
            - 550e8400-e29b-41d4-a716-446655440000
            - 550e8400-e29b-41d4-a716-446655440003
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CooldownStatus:
      type: object
      required:
        - ability_id
        - is_on_cooldown
      properties:
        ability_id:
          type: string
          format: uuid
          description: Идентификатор способности
          example: 550e8400-e29b-41d4-a716-446655440000
        started_at:
          type: string
          format: date-time
          nullable: true
          description: Время начала кулдауна
          example: '2025-11-23T10:00:00Z'
        expires_at:
          type: string
          format: date-time
          nullable: true
          description: Время окончания кулдауна
          example: '2025-11-23T10:00:15Z'
        cooldown_duration:
          type: integer
          minimum: 0
          nullable: true
          description: Длительность кулдауна в секундах
          example: 15
        remaining_seconds:
          type: integer
          minimum: 0
          nullable: true
          description: Оставшееся время кулдауна в секундах
          example: 10
        is_on_cooldown:
          type: boolean
          description: Находится ли способность на кулдауне
          example: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CooldownCheckResponse:
      type: object
      required:
        - cooldowns
      properties:
        cooldowns:
          type: array
          items:
            $ref: '#/components/schemas/CooldownStatus'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SynergyType:
      type: string
      enum:
        - ability
        - team
        - equipment
        - implant
        - timing
      description: Тип синергии
      example: ability
    Synergy:
      type: object
      required:
        - id
        - synergy_type
        - bonuses
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор синергии
          example: 550e8400-e29b-41d4-a716-446655440008
        complexity:
          type: string
          enum:
            - Bronze
            - Silver
            - Gold
            - Platinum
            - Legendary
          description: Сложность синергии
          example: Gold
        created_at:
          type: string
          format: date-time
          description: Дата создания
          example: '2025-11-23T10:00:00Z'
        requirements:
          type: object
          description: Требования для активации синергии
          properties:
            min_level:
              type: integer
              minimum: 1
              example: 10
            required_attributes:
              type: object
              additionalProperties:
                type: integer
              example:
                strength: 15
        bonuses:
          type: object
          description: Бонусы от синергии
          properties:
            damage_multiplier:
              type: number
              format: float
              minimum: 1
              example: 1.2
            cooldown_reduction:
              type: integer
              minimum: 0
              example: 5
            energy_cost_reduction:
              type: integer
              minimum: 0
              example: 10
            special_effects:
              type: array
              items:
                type: string
              example:
                - burn
                - stun
        synergy_type:
          $ref: '#/components/schemas/SynergyType'
        ability_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Список идентификаторов способностей
          example:
            - 550e8400-e29b-41d4-a716-446655440000
            - 550e8400-e29b-41d4-a716-446655440003
        implant_ids:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
          description: Список идентификаторов имплантов
          example:
            - 550e8400-e29b-41d4-a716-446655440009
        equipment_ids:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
          description: Список идентификаторов экипировки
          example:
            - 550e8400-e29b-41d4-a716-446655440010
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SynergyApplyRequest:
      type: object
      required:
        - synergy_id
      properties:
        synergy_id:
          type: string
          format: uuid
          description: Идентификатор синергии для применения
          example: 550e8400-e29b-41d4-a716-446655440008
        target_ability_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор способности-цели (если требуется)
          example: 550e8400-e29b-41d4-a716-446655440000
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SynergyApplyResponse:
      type: object
      required:
        - success
        - synergy_id
      properties:
        synergy_id:
          type: string
          format: uuid
          description: Идентификатор примененной синергии
          example: 550e8400-e29b-41d4-a716-446655440008
        message:
          type: string
          nullable: true
          description: Сообщение о результате
          example: Synergy applied successfully
        bonuses_applied:
          type: object
          description: Примененные бонусы
          properties:
            damage_multiplier:
              type: number
              format: float
              minimum: 1
              example: 1.2
            cooldown_reduction:
              type: integer
              minimum: 0
              example: 5
        success:
          type: boolean
          description: Успешность применения синергии
          example: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CyberpsychosisState:
      type: object
      required:
        - character_id
        - current_level
      properties:
        character_id:
          type: string
          format: uuid
          description: Идентификатор персонажа
          example: 550e8400-e29b-41d4-a716-446655440002
        last_update:
          type: string
          format: date-time
          description: Время последнего обновления
          example: '2025-11-23T10:00:00Z'
        restrictions:
          type: object
          description: Ограничения из-за киберпсихоза
          properties:
            ability_usage_penalty:
              type: number
              format: float
              minimum: 0
              maximum: 1
              example: 0.1
            attribute_penalties:
              type: object
              additionalProperties:
                type: number
                format: float
              example:
                strength: -0.05
                intelligence: -0.05
        threshold_breaches:
          type: integer
          minimum: 0
          description: Количество превышений порогов
          example: 0
        active_implants_count:
          type: integer
          minimum: 0
          description: Количество активных имплантов
          example: 3
        current_level:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Текущий уровень киберпсихоза (0-1)
          example: 0.15
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CyberpsychosisUpdateRequest:
      type: object
      required:
        - ability_id
      properties:
        ability_id:
          type: string
          format: uuid
          description: Идентификатор способности, которая влияет на киберпсихоз
          example: 550e8400-e29b-41d4-a716-446655440000
        duration_seconds:
          type: integer
          minimum: 0
          nullable: true
          description: Длительность использования в секундах
          example: 5
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AbilityMetrics:
      type: object
      required:
        - character_id
        - ability_id
      properties:
        character_id:
          type: string
          format: uuid
          description: Идентификатор персонажа
          example: 550e8400-e29b-41d4-a716-446655440002
        ability_id:
          type: string
          format: uuid
          description: Идентификатор способности
          example: 550e8400-e29b-41d4-a716-446655440000
        period_start:
          type: string
          format: date-time
          description: Начало периода статистики
          example: '2025-11-23T00:00:00Z'
        period_end:
          type: string
          format: date-time
          description: Конец периода статистики
          example: '2025-11-23T23:59:59Z'
        activations_count:
          type: integer
          minimum: 0
          description: Количество активаций
          example: 150
        successful_activations:
          type: integer
          minimum: 0
          description: Количество успешных активаций
          example: 145
        failed_activations:
          type: integer
          minimum: 0
          description: Количество неудачных активаций
          example: 5
        synergies_triggered:
          type: integer
          minimum: 0
          description: Количество срабатываний синергий
          example: 30
        average_damage:
          type: number
          format: float
          minimum: 0
          nullable: true
          description: Средний урон
          example: 250.5
        total_damage:
          type: number
          format: float
          minimum: 0
          description: Общий урон
          example: 37575
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ComboType:
      type: string
      enum:
        - solo
        - team
        - legendary
      description: Тип комбо
      example: solo
    ComboComplexity:
      type: string
      enum:
        - Bronze
        - Silver
        - Gold
        - Platinum
        - Legendary
      description: Сложность комбо
      example: Gold
    Combo:
      type: object
      description: |
        BACKEND NOTE: Fields ordered for optimal struct alignment (large → small).
        Expected memory: ~120 bytes/instance.
      required:
        - id
        - name
        - combo_type
        - complexity
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор комбо
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: Название комбо
          example: Aerial Devastation
        description:
          type: string
          description: Описание комбо
          example: Комбо из воздушных атак с максимальным уроном
        created_at:
          type: string
          format: date-time
          description: Дата создания
        requirements:
          type: object
          description: Требования для активации комбо
          properties:
            min_level:
              type: integer
              minimum: 1
              example: 10
            required_skills:
              type: array
              items:
                type: string
              example:
                - acrobatics
                - combat
            required_abilities:
              type: array
              items:
                type: string
                format: uuid
              example:
                - 550e8400-e29b-41d4-a716-446655440001
            min_participants:
              type: integer
              minimum: 1
              example: 1
            max_participants:
              type: integer
              minimum: 1
              example: 5
        bonuses:
          type: object
          description: Бонусы от комбо
          properties:
            damage_multiplier:
              type: number
              format: float
              minimum: 1
              example: 1.5
            cooldown_reduction:
              type: integer
              minimum: 0
              example: 10
            special_effects:
              type: array
              items:
                type: string
              example:
                - stun
                - knockback
        complexity:
          $ref: '#/components/schemas/ComboComplexity'
        combo_type:
          $ref: '#/components/schemas/ComboType'
        sequence:
          type: array
          description: Последовательность действий для активации
          items:
            type: string
          example:
            - wall_run
            - air_dash
            - attack
        cooldown:
          type: integer
          description: Кулдаун комбо в секундах
          minimum: 0
          example: 30
        chain_compatible:
          type: boolean
          description: Совместимость с chain-комбо
          example: true
    ComboCatalogResponse:
      type: object
      properties:
        combos:
          type: array
          items:
            $ref: '#/components/schemas/Combo'
        total:
          type: integer
          description: Общее количество комбо
          example: 50
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ActivateComboRequest:
      type: object
      required:
        - character_id
        - combo_id
      properties:
        character_id:
          type: string
          format: uuid
          description: ID персонажа, активирующего комбо
          example: 550e8400-e29b-41d4-a716-446655440003
        combo_id:
          type: string
          format: uuid
          description: ID комбо для активации
          example: 550e8400-e29b-41d4-a716-446655440000
        context:
          type: object
          description: Контекст активации (позиция, состояние, окружение)
          additionalProperties: true
        participants:
          type: array
          items:
            type: string
            format: uuid
          description: ID участников команды (для team/legendary комбо)
          example:
            - 550e8400-e29b-41d4-a716-446655440003
            - 550e8400-e29b-41d4-a716-446655440004
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    schemas-Synergy:
      type: object
      description: |
        BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory: ~80 bytes/instance.
      required:
        - id
        - synergy_type
        - combo_id
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440002
        combo_id:
          type: string
          format: uuid
          description: ID комбо, к которому применяется синергия
        bonuses:
          type: object
          description: Бонусы от синергии
          properties:
            damage_multiplier:
              type: number
              format: float
              minimum: 1
            cooldown_reduction:
              type: integer
              minimum: 0
            special_effects:
              type: array
              items:
                type: string
        requirements:
          type: object
          description: Требования для активации синергии
        synergy_type:
          $ref: '#/components/schemas/SynergyType'
        ability_ids:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
          description: ID способностей для ability синергии
        equipment_ids:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
          description: ID экипировки для equipment синергии
        implant_ids:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
          description: ID имплантов для implant синергии
        team_size:
          type: integer
          minimum: 2
          nullable: true
          description: Размер команды для team синергии
        timing_window:
          type: integer
          minimum: 0
          nullable: true
          description: Временное окно в миллисекундах для timing синергии
    ComboActivationResponse:
      type: object
      required:
        - success
        - activation_id
      properties:
        activation_id:
          type: string
          format: uuid
          description: ID активации комбо
          example: 550e8400-e29b-41d4-a716-446655440005
        message:
          type: string
          description: Сообщение о результате
          example: Combo activated successfully
        bonuses_applied:
          type: object
          description: Примененные бонусы
          properties:
            damage_multiplier:
              type: number
              format: float
            cooldown_reduction:
              type: integer
            special_effects:
              type: array
              items:
                type: string
        combo:
          $ref: '#/components/schemas/Combo'
        applied_synergies:
          type: array
          items:
            $ref: '#/components/schemas/schemas-Synergy'
        success:
          type: boolean
          description: Успешность активации
          example: true
        chain_combo_available:
          type: boolean
          description: Доступность chain-комбо
          example: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ComboLoadout:
      type: object
      required:
        - id
        - character_id
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440006
        character_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440003
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        preferences:
          type: object
          description: Настройки лоадаута
          properties:
            auto_activate:
              type: boolean
              description: Автоматическая активация комбо
              example: false
            priority_order:
              type: array
              items:
                type: string
                format: uuid
              description: Порядок приоритета комбо
        active_combos:
          type: array
          items:
            type: string
            format: uuid
          description: ID активных комбо в лоадауте
          example:
            - 550e8400-e29b-41d4-a716-446655440000
            - 550e8400-e29b-41d4-a716-446655440007
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdateLoadoutRequest:
      type: object
      required:
        - character_id
      properties:
        character_id:
          type: string
          format: uuid
        preferences:
          type: object
          properties:
            auto_activate:
              type: boolean
            priority_order:
              type: array
              items:
                type: string
                format: uuid
        active_combos:
          type: array
          items:
            type: string
            format: uuid
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SubmitScoreRequest:
      type: object
      required:
        - activation_id
        - execution_difficulty
        - damage_output
        - visual_impact
      properties:
        activation_id:
          type: string
          format: uuid
        execution_difficulty:
          type: integer
          minimum: 0
          maximum: 100
        damage_output:
          type: integer
          minimum: 0
        visual_impact:
          type: integer
          minimum: 0
          maximum: 100
        team_coordination:
          type: integer
          minimum: 0
          maximum: 100
          nullable: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ComboScore:
      type: object
      description: |
        BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory: ~56 bytes/instance. Hot endpoint for scoring.
      required:
        - activation_id
        - total_score
        - category
      properties:
        activation_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440005
        timestamp:
          type: string
          format: date-time
        category:
          $ref: '#/components/schemas/ComboComplexity'
        execution_difficulty:
          type: integer
          minimum: 0
          maximum: 100
          description: Сложность исполнения (0-100)
          example: 85
        damage_output:
          type: integer
          minimum: 0
          description: Выданный урон
          example: 5000
        visual_impact:
          type: integer
          minimum: 0
          maximum: 100
          description: Визуальный эффект (0-100)
          example: 90
        team_coordination:
          type: integer
          minimum: 0
          maximum: 100
          nullable: true
          description: Координация команды (0-100, только для team комбо)
          example: 75
        total_score:
          type: integer
          minimum: 0
          description: Общий score
          example: 7500
    ScoreSubmissionResponse:
      type: object
      required:
        - success
        - score
      properties:
        rewards:
          type: object
          nullable: true
          description: Награды за score (если применимо)
          properties:
            experience:
              type: integer
            currency:
              type: integer
            items:
              type: array
              items:
                type: string
                format: uuid
        score:
          $ref: '#/components/schemas/ComboScore'
        success:
          type: boolean
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ComboAnalytics:
      type: object
      properties:
        combo_id:
          type: string
          format: uuid
        average_category:
          $ref: '#/components/schemas/ComboComplexity'
        most_used_synergies:
          type: array
          items:
            type: object
            properties:
              synergy_id:
                type: string
                format: uuid
              synergy_type:
                $ref: '#/components/schemas/SynergyType'
              usage_count:
                type: integer
          description: Наиболее используемые синергии
        total_activations:
          type: integer
          minimum: 0
          description: Общее количество активаций
          example: 1250
        chain_combo_count:
          type: integer
          minimum: 0
          description: Количество chain-комбо
          example: 150
        success_rate:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Процент успешных активаций
          example: 0.85
        average_score:
          type: number
          format: float
          minimum: 0
          description: Средний score
          example: 6500
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AnalyticsResponse:
      type: object
      properties:
        period_start:
          type: string
          format: date-time
        period_end:
          type: string
          format: date-time
        analytics:
          type: array
          items:
            $ref: '#/components/schemas/ComboAnalytics'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Implant:
      type: object
      required:
        - id
        - name
        - implant_type
        - brand
        - rarity
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        implant_type:
          type: string
          enum:
            - combat
            - movement
            - os
            - visual
        brand:
          type: string
          enum:
            - arasaka
            - militech
            - kang_tao
            - zetatech
            - biotechnica
            - custom
        rarity:
          type: string
          enum:
            - common
            - uncommon
            - rare
            - epic
            - legendary
            - artifact
        slot_type:
          type: string
          enum:
            - combat
            - tactical
            - defensive
            - movement
            - os
        effects:
          type: object
          description: Эффекты импланта
        energy_cost:
          type: integer
          minimum: 0
        humanity_cost:
          type: integer
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CreateEncounterRequest:
      type: object
      required:
        - encounter_type
        - profile_ids
        - zone_id
      properties:
        zone_id:
          type: string
          format: uuid
          description: Идентификатор зоны
          example: 550e8400-e29b-41d4-a716-446655440006
        encounter_type:
          type: string
          description: Тип встречи
          example: street
        profile_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Идентификаторы профилей AI для встречи
          example:
            - 550e8400-e29b-41d4-a716-446655440000
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AIEncounter:
      type: object
      required:
        - id
        - encounter_type
        - profile_ids
        - zone_id
        - started_at
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор встречи
          example: 550e8400-e29b-41d4-a716-446655440002
        zone_id:
          type: string
          format: uuid
          description: Идентификатор зоны
          example: 550e8400-e29b-41d4-a716-446655440006
        encounter_type:
          type: string
          description: Тип встречи
          example: street
        result:
          type: string
          enum:
            - victory
            - defeat
            - abandoned
          nullable: true
          description: Результат встречи
        started_at:
          type: string
          format: date-time
          description: Время начала встречи
          example: '2025-11-29T10:00:00Z'
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Время завершения встречи
        profile_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Идентификаторы профилей AI
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    EndEncounterRequest:
      type: object
      required:
        - result
      properties:
        result:
          type: string
          enum:
            - victory
            - defeat
            - abandoned
          description: Результат встречи
          example: victory
        completion_data:
          type: object
          description: Дополнительные данные о завершении
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AIAbility:
      type: object
      required:
        - id
        - name
        - ability_type
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор способности
          example: 550e8400-e29b-41d4-a716-446655440003
        name:
          type: string
          description: Название способности
          example: Urban Sweep
        ability_type:
          type: string
          description: Тип способности
          example: area_attack
        effects:
          type: object
          description: Эффекты способности
          additionalProperties: true
        requirements:
          type: object
          description: Требования для использования
          additionalProperties: true
        cooldown:
          type: integer
          minimum: 0
          description: Время перезарядки в секундах
          example: 30
        damage:
          type: integer
          minimum: 0
          description: Урон способности
          example: 100
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AIProfile:
      type: object
      required:
        - id
        - name
        - difficulty_layer
        - skill_level_min
        - skill_level_max
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор профиля
          example: 550e8400-e29b-41d4-a716-446655440000
        loot_table_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор таблицы лута
        faction_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор фракции
        name:
          type: string
          description: Название профиля AI
          example: Street Thug
        difficulty_layer:
          type: string
          enum:
            - street
            - tactical
            - mythic
            - raid
          description: Слой сложности
          example: street
        created_at:
          type: string
          format: date-time
          description: Время создания
          example: '2025-11-29T10:00:00Z'
        behavior_tree:
          type: object
          description: Дерево поведения AI
          additionalProperties: true
        utility_weights:
          type: object
          description: Веса утилит для Utility AI
          additionalProperties: true
        world_influence:
          type: object
          description: Влияние на мир
          additionalProperties: true
        abilities:
          type: array
          items:
            $ref: '#/components/schemas/AIAbility'
          description: Список способностей AI
        skill_level_min:
          type: integer
          minimum: 1
          description: Минимальный уровень навыков
          example: 1
        skill_level_max:
          type: integer
          minimum: 1
          description: Максимальный уровень навыков
          example: 10
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AITelemetry:
      type: object
      required:
        - id
        - profile_id
        - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор записи телеметрии
          example: 550e8400-e29b-41d4-a716-446655440004
        profile_id:
          type: string
          format: uuid
          description: Идентификатор профиля AI
          example: 550e8400-e29b-41d4-a716-446655440000
        encounter_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор встречи
        raid_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор рейда
        timestamp:
          type: string
          format: date-time
          description: Временная метка
          example: '2025-11-29T10:00:00Z'
        abilities_used:
          type: object
          description: Использованные способности
          additionalProperties:
            type: integer
        damage_dealt:
          type: integer
          minimum: 0
          description: Нанесенный урон
          example: 5000
        damage_taken:
          type: integer
          minimum: 0
          description: Полученный урон
          example: 3000
        time_to_defeat:
          type: integer
          minimum: 0
          description: Время до поражения в секундах
          example: 120
        skill_tests_passed:
          type: integer
          minimum: 0
          description: Количество пройденных проверок навыков
          example: 5
        skill_tests_failed:
          type: integer
          minimum: 0
          description: Количество проваленных проверок навыков
          example: 2
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    RaidPhaseTransitionRequest:
      type: object
      required:
        - phase_number
      properties:
        reason:
          type: string
          description: Причина перехода фазы
          example: Boss health threshold reached
        phase_number:
          type: integer
          minimum: 1
          description: Номер фазы для перехода
          example: 2
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    RaidSession:
      type: object
      required:
        - id
        - raid_id
        - current_phase
        - status
        - started_at
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор сессии
          example: 550e8400-e29b-41d4-a716-446655440001
        raid_id:
          type: string
          format: uuid
          description: Идентификатор рейда
          example: 550e8400-e29b-41d4-a716-446655440005
        status:
          type: string
          enum:
            - in_progress
            - completed
            - failed
          description: Статус рейда
          example: in_progress
        started_at:
          type: string
          format: date-time
          description: Время начала рейда
          example: '2025-11-29T10:00:00Z'
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Время завершения рейда
        participants:
          type: array
          items:
            type: string
            format: uuid
          description: Идентификаторы участников рейда
        current_phase:
          type: integer
          minimum: 1
          description: Текущая фаза рейда
          example: 2
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AffixSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        category:
          type: string
          enum:
            - combat
            - environmental
            - debuff
            - defensive
        reward_modifier:
          type: number
          format: float
          minimum: 1
        difficulty_modifier:
          type: number
          format: float
          minimum: 1
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ActiveAffixesResponse:
      type: object
      properties:
        week_start:
          type: string
          format: date-time
          description: Начало текущей недели ротации
        week_end:
          type: string
          format: date-time
          description: Конец текущей недели ротации
        seasonal_affix:
          type: object
          nullable: true
          allOf:
            - $ref: '#/components/schemas/AffixSummary'
          description: Сезонный аффикс (если есть)
        active_affixes:
          type: array
          items:
            $ref: '#/components/schemas/AffixSummary'
          description: Список активных аффиксов на текущей неделе
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    Affix:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор аффикса
        name:
          type: string
          description: Название аффикса
          example: Volatile
        description:
          type: string
          description: Описание механики аффикса
        category:
          type: string
          enum:
            - combat
            - environmental
            - debuff
            - defensive
          description: Категория аффикса
        created_at:
          type: string
          format: date-time
          description: Дата создания аффикса
        mechanics:
          type: object
          description: Детальные механики аффикса
          properties:
            trigger:
              type: string
              description: Условие срабатывания
              example: enemy_death
            effect_type:
              type: string
              description: Тип эффекта
              example: area_damage
            radius:
              type: number
              format: float
              description: Радиус эффекта в метрах
            damage_percent:
              type: integer
              description: Процент урона
            damage_type:
              type: string
              description: Тип урона
              example: fire
          additionalProperties: true
        visual_effects:
          type: object
          description: Визуальные эффекты аффикса
          properties:
            explosion_particle:
              type: string
              description: ID частиц взрыва
            sound_effect:
              type: string
              description: ID звукового эффекта
            screen_shake:
              type: boolean
              description: Тряска экрана
          additionalProperties: true
        reward_modifier:
          type: number
          format: float
          minimum: 1
          description: Модификатор наград (1.0 = базовые награды, 1.25 = +25%)
          example: 1.25
        difficulty_modifier:
          type: number
          format: float
          minimum: 1
          description: Модификатор сложности (1.0 = базовая сложность, 1.15 = +15%)
          example: 1.15
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    InstanceAffixesResponse:
      type: object
      properties:
        instance_id:
          type: string
          format: uuid
          description: ID инстанса
        applied_at:
          type: string
          format: date-time
          description: Время применения аффиксов
        affixes:
          type: array
          items:
            $ref: '#/components/schemas/AffixSummary'
          description: Список аффиксов инстанса (2-4 аффикса)
        total_reward_modifier:
          type: number
          format: float
          minimum: 1
          description: Общий модификатор наград (произведение всех модификаторов)
          example: 1.69
        total_difficulty_modifier:
          type: number
          format: float
          minimum: 1
          description: Общий модификатор сложности (произведение всех модификаторов)
          example: 1.44
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AffixRotation:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ID ротации
        week_start:
          type: string
          format: date-time
          description: Начало недели
        week_end:
          type: string
          format: date-time
          description: Конец недели
        created_at:
          type: string
          format: date-time
          description: Дата создания ротации
        seasonal_affix:
          type: object
          nullable: true
          allOf:
            - $ref: '#/components/schemas/AffixSummary'
          description: Сезонный аффикс
        active_affixes:
          type: array
          items:
            $ref: '#/components/schemas/AffixSummary'
          description: Активные аффиксы на неделе
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    AffixRotationHistoryResponse:
      allOf:
        - $ref: '#/components/schemas/PaginationResponse'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/AffixRotation'
              description: История ротаций
    TriggerRotationRequest:
      type: object
      properties:
        custom_affixes:
          type: array
          items:
            type: string
            format: uuid
          description: Кастомный список аффиксов (опционально, иначе случайный выбор)
          maxItems: 10
          minItems: 8
        force:
          type: boolean
          default: false
          description: Принудительно запустить ротацию даже если уже есть активная
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    StartQuestRequest:
      type: object
      required:
        - quest_id
      properties:
        quest_id:
          type: string
          format: uuid
          description: ID определения квеста для начала
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DialogueChoice:
      type: object
      required:
        - choice_id
        - text
      properties:
        choice_id:
          type: string
          description: ID выбора
        text:
          type: string
          description: Текст выбора
        next_node_id:
          type: string
          description: ID следующего узла
        requirements:
          type: object
          description: Требования для выбора
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SkillCheck:
      type: object
      required:
        - check_type
        - check_target
        - required_value
      properties:
        check_target:
          type: string
          description: Цель проверки (название атрибута/навыка/предмета)
        check_type:
          type: string
          enum:
            - attribute
            - skill
            - item
            - reputation
          description: |
            Тип проверки:
            - `attribute` - проверка атрибутов
            - `skill` - проверка навыков
            - `item` - проверка предметов
            - `reputation` - проверка репутации
        required_value:
          type: integer
          description: Требуемое значение
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DialogueNode:
      type: object
      required:
        - node_id
        - text
      properties:
        node_id:
          type: string
          description: ID узла диалога
        text:
          type: string
          description: Текст диалога
        speaker:
          type: string
          description: Имя говорящего
        choices:
          type: array
          description: Варианты выбора
          items:
            $ref: '#/components/schemas/DialogueChoice'
        skill_checks:
          type: array
          description: Проверки навыков для этого узла
          items:
            $ref: '#/components/schemas/SkillCheck'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestInstance:
      type: object
      description: |
        BACKEND NOTE: Quest tracking (100+ active quests per player).
        Fields ordered for struct alignment. Expected memory: ~112 bytes/instance.
      required:
        - id
        - quest_id
        - player_id
        - state
        - started_at
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор инстанса квеста
        quest_id:
          type: string
          format: uuid
          description: ID определения квеста
        player_id:
          type: string
          format: uuid
          description: ID игрока
        state:
          type: string
          enum:
            - NOT_STARTED
            - IN_PROGRESS
            - COMPLETED
            - FAILED
            - CANCELLED
          description: |
            Состояние квеста:
            - `NOT_STARTED` - квест не начат
            - `IN_PROGRESS` - квест в процессе
            - `COMPLETED` - квест завершён
            - `FAILED` - квест провален
            - `CANCELLED` - квест отменён
        started_at:
          type: string
          format: date-time
          description: Время начала квеста
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Время завершения квеста
        updated_at:
          type: string
          format: date-time
          description: Время последнего обновления
        progress_data:
          type: object
          description: Данные прогресса квеста (JSON)
          additionalProperties: true
        current_objective:
          type: integer
          description: Текущий номер цели (индекс)
          minimum: 0
    StartQuestResponse:
      type: object
      required:
        - quest_instance
      properties:
        dialogue:
          nullable: true
          description: Начальный диалог (если есть)
        quest_instance:
          $ref: '#/components/schemas/QuestInstance'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestListResponse:
      type: object
      required:
        - quests
        - total
      properties:
        quests:
          type: array
          description: Список квестов
          items:
            $ref: '#/components/schemas/QuestInstance'
        total:
          type: integer
          description: Общее количество квестов
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CompleteQuestRequest:
      type: object
      properties:
        force:
          type: boolean
          default: false
          description: Принудительное завершение (для админов)
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestRewards:
      type: object
      properties:
        reputation:
          type: object
          description: Репутация
          additionalProperties: true
        items:
          type: array
          description: Предметы
          items:
            type: object
            properties:
              item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
        titles:
          type: array
          description: Титулы
          items:
            type: string
        experience:
          type: integer
          description: Опыт
          minimum: 0
        currency:
          type: integer
          description: Валюта
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    CompleteQuestResponse:
      type: object
      required:
        - quest_instance
        - rewards
      properties:
        quest_instance:
          $ref: '#/components/schemas/QuestInstance'
        rewards:
          $ref: '#/components/schemas/QuestRewards'
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestState:
      type: object
      required:
        - state
        - current_objective
      properties:
        state:
          type: string
          enum:
            - NOT_STARTED
            - IN_PROGRESS
            - COMPLETED
            - FAILED
            - CANCELLED
          description: Текущее состояние квеста
        progress_data:
          type: object
          description: Данные прогресса
          additionalProperties: true
        current_objective:
          type: integer
          description: Текущий номер цели
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    UpdateStateRequest:
      type: object
      required:
        - state
      properties:
        state:
          type: string
          enum:
            - IN_PROGRESS
            - COMPLETED
            - FAILED
            - CANCELLED
          description: Новое состояние квеста
        progress_data:
          type: object
          description: Обновлённые данные прогресса
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DialogueChoiceRequest:
      type: object
      required:
        - choice_id
      properties:
        choice_id:
          type: string
          description: ID выбранного варианта
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    DialogueHistory:
      type: object
      required:
        - quest_instance_id
        - history
      properties:
        quest_instance_id:
          type: string
          format: uuid
          description: ID инстанса квеста
        history:
          type: array
          description: История диалогов
          items:
            type: object
            properties:
              node_id:
                type: string
              text:
                type: string
              speaker:
                type: string
              choice_made:
                type: string
                nullable: true
              timestamp:
                type: string
                format: date-time
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SkillCheckRequest:
      type: object
      required:
        - check_type
        - check_target
      properties:
        check_target:
          type: string
          description: Цель проверки
        check_type:
          type: string
          enum:
            - attribute
            - skill
            - item
            - reputation
          description: Тип проверки
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SkillCheckResult:
      type: object
      required:
        - check_type
        - check_target
        - required_value
        - actual_value
        - passed
      properties:
        id:
          type: string
          format: uuid
          description: ID результата проверки
        quest_instance_id:
          type: string
          format: uuid
          description: ID инстанса квеста
        check_target:
          type: string
          description: Цель проверки
        check_type:
          type: string
          enum:
            - attribute
            - skill
            - item
            - reputation
          description: Тип проверки
        checked_at:
          type: string
          format: date-time
          description: Время проверки
        required_value:
          type: integer
          description: Требуемое значение
        actual_value:
          type: integer
          description: Фактическое значение
        passed:
          type: boolean
          description: Пройдена ли проверка
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    SkillChecksResponse:
      type: object
      required:
        - skill_checks
        - total
      properties:
        skill_checks:
          type: array
          description: Список проверок навыков
          items:
            $ref: '#/components/schemas/SkillCheckResult'
        total:
          type: integer
          description: Общее количество проверок
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestRequirements:
      type: object
      properties:
        reputation:
          type: object
          description: Требования репутации
          additionalProperties: true
        location:
          type: object
          description: Требования местоположения
          additionalProperties: true
        items:
          type: array
          description: Требуемые предметы
          items:
            type: object
            properties:
              item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
        quest_prerequisites:
          type: array
          description: Требуемые предыдущие квесты
          items:
            type: string
            format: uuid
        level:
          type: integer
          description: Требуемый уровень
          minimum: 1
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestEvent:
      type: object
      required:
        - event_type
        - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: ID события
        quest_instance_id:
          type: string
          format: uuid
          description: ID инстанса квеста
        event_type:
          type: string
          enum:
            - started
            - objective-completed
            - completed
            - failed
            - cancelled
          description: |
            Тип события:
            - `started` - квест начат
            - `objective-completed` - цель выполнена
            - `completed` - квест завершён
            - `failed` - квест провален
            - `cancelled` - квест отменён
        timestamp:
          type: string
          format: date-time
          description: Время события
        event_data:
          type: object
          description: Данные события (JSON)
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    QuestEventsResponse:
      type: object
      required:
        - events
        - total
      properties:
        events:
          type: array
          description: Список событий
          items:
            $ref: '#/components/schemas/QuestEvent'
        total:
          type: integer
          description: Общее количество событий
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ReloadQuestContentRequest:
      type: object
      required:
        - quest_id
        - yaml_content
      properties:
        quest_id:
          type: string
          description: ID квеста из YAML файла (metadata.id)
        yaml_content:
          type: object
          description: Полное содержимое YAML файла квеста
          additionalProperties: true
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
    ReloadQuestContentResponse:
      type: object
      properties:
        quest_id:
          type: string
        message:
          type: string
        imported_at:
          type: string
          format: date-time
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small). Expected memory savings: 30-50%.'
