openapi: 3.0.3
info:
  title: OAuth Service API
  description: '**Enterprise-grade API for OAuth Provider Integration**


    ## Domain Purpose

    Comprehensive OAuth integration service providing secure authentication flows,

    token management, and account linking for external identity providers.


    ## Business Value

    - Secure OAuth 2.0/OpenID Connect implementation

    - Multi-provider support (Google, Discord, Steam, GitHub)

    - Account linking and profile synchronization

    - Enterprise-grade token security and rotation

    - GDPR compliant data handling


    ## Performance Targets

    - P99 Latency: <35ms for OAuth flows

    - Memory per Instance: <45KB baseline

    - Concurrent OAuth Flows: 10,000+ per second

    - Token Cache Hit Rate: >98% for active tokens


    ## Domain Inheritance

    This service inherits from infrastructure-entities.yaml providing:

    - User account references and linking

    - Audit trails for OAuth operations

    - Configuration management for providers

    - Session management integration

    - Optimistic locking for concurrent operations

    - Strict typing with validation rules

    '
  version: 1.0.0
  contact:
    name: NECPGAME API Team
    email: api@necpgame.com
  license:
    name: MIT
servers:
- url: https://api.necpgame.com/v1/oauth-service
  description: Production environment
- url: https://staging-api.necpgame.com/v1/oauth-service
  description: Staging environment
- url: http://localhost:8080/api/v1/oauth-service
  description: Local development
security:
- BearerAuth: []
tags:
- name: OAuth Flow
  description: OAuth authorization and token exchange
- name: Account Linking
  description: OAuth account linking and management
- name: Token Management
  description: OAuth token operations and refresh
- name: Provider Management
  description: OAuth provider configuration
- name: Security Auditing
  description: OAuth security and audit operations
- name: Health Monitoring
  description: Service health and performance monitoring
paths:
  /health:
    $ref: ./paths/health.yaml#/paths/~1health
  /oauth/{provider}/authorize:
    $ref: ./paths/oauth-{provider}-authorize.yaml#/paths/~1oauth~1{provider}~1authorize
  /oauth/{provider}/callback:
    $ref: ./paths/oauth-{provider}-callback.yaml#/paths/~1oauth~1{provider}~1callback
  /oauth/{provider}/token:
    $ref: ./paths/oauth-{provider}-token.yaml#/paths/~1oauth~1{provider}~1token
  /oauth/{provider}/refresh:
    $ref: ./paths/oauth-{provider}-refresh.yaml#/paths/~1oauth~1{provider}~1refresh
  /users/{userId}/oauth:
    $ref: ./paths/users-{userId}-oauth.yaml#/paths/~1users~1{userId}~1oauth
  /oauth/providers:
    $ref: ./paths/oauth-providers.yaml#/paths/~1oauth~1providers
  /oauth/providers/{provider}/config:
    $ref: ./paths/oauth-providers-{provider}-config.yaml#/paths/~1oauth~1providers~1{provider}~1config
  /audit/oauth:
    $ref: ./paths/audit-oauth.yaml#/paths/~1audit~1oauth
components:
  schemas:
    OAuthAccountLink:
      description: OAuth account link entity
      type: object
      required:
      - id
      - user_id
      - provider
      - provider_user_id
      - linked_at
      properties:
        id:
          type: string
          format: uuid
          description: Link unique identifier
        user_id:
          type: string
          format: uuid
          description: Linked NECPGAME user ID
        provider:
          type: string
          enum:
          - google
          - discord
          - steam
          - github
          description: OAuth provider
        provider_user_id:
          type: string
          description: User ID from OAuth provider
        provider_username:
          type: string
          description: Username from OAuth provider
        provider_email:
          type: string
          format: email
          description: Email from OAuth provider
        access_token_hash:
          type: string
          description: Hashed OAuth access token
        refresh_token_hash:
          type: string
          description: Hashed OAuth refresh token
        token_expires_at:
          type: string
          format: date-time
          description: When OAuth tokens expire
        linked_at:
          type: string
          format: date-time
          description: When accounts were linked
        last_sync_at:
          type: string
          format: date-time
          description: Last profile synchronization
        scopes:
          type: array
          items:
            type: string
          description: Granted OAuth scopes
        metadata:
          type: object
          description: Provider-specific metadata
          properties:
            avatar_url:
              type: string
              format: uri
              description: Avatar URL from provider
            profile_url:
              type: string
              format: uri
              description: Profile URL from provider
    OAuthProvider:
      description: OAuth provider information
      type: object
      required:
      - provider
      - name
      - is_active
      properties:
        provider:
          type: string
          enum:
          - google
          - discord
          - steam
          - github
          description: Provider identifier
        name:
          type: string
          description: Human-readable provider name
        description:
          type: string
          description: Provider description
        icon_url:
          type: string
          format: uri
          description: Provider icon URL
        is_active:
          type: boolean
          description: Whether provider is enabled
        scopes:
          type: array
          items:
            type: string
          description: Default scopes requested
        website_url:
          type: string
          format: uri
          description: Provider website
    OAuthProviderConfig:
      description: OAuth provider configuration
      allOf:
      - $ref: ../common/schemas/infrastructure-entities.yaml#/ConfigurationEntity
      - type: object
        properties:
          provider:
            type: string
            enum:
            - google
            - discord
            - steam
            - github
            description: Provider identifier
          client_id:
            type: string
            description: OAuth client ID
          client_secret_hash:
            type: string
            description: Hashed OAuth client secret
          authorization_url:
            type: string
            format: uri
            description: Provider authorization endpoint
          token_url:
            type: string
            format: uri
            description: Provider token endpoint
          user_info_url:
            type: string
            format: uri
            description: Provider user info endpoint
          scopes_supported:
            type: array
            items:
              type: string
            description: Supported OAuth scopes
          pkce_required:
            type: boolean
            description: Whether PKCE is required
          token_rotation_enabled:
            type: boolean
            description: Whether token rotation is enabled
    OAuthAuditEntry:
      description: Audit entry for OAuth operations
      allOf:
      - $ref: ../common/schemas/infrastructure-entities.yaml#/AuditLogEntity
      - type: object
        properties:
          provider:
            type: string
            enum:
            - google
            - discord
            - steam
            - github
            description: OAuth provider involved
          operation_type:
            type: string
            enum:
            - authorize
            - callback
            - token_exchange
            - refresh
            - link
            - unlink
            - sync
            description: Type of OAuth operation
          user_id:
            type: string
            format: uuid
            description: Associated user ID
          provider_user_id:
            type: string
            description: User ID from OAuth provider
          ip_address:
            type: string
            description: Client IP address
          success:
            type: boolean
            description: Whether operation succeeded
    UserAccountSummary:
      description: Summary user account for OAuth responses
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User account ID
        username:
          type: string
          description: Username
        email:
          type: string
          format: email
          description: Email address
        account_status:
          type: string
          enum:
          - active
          - suspended
          - banned
          - pending_verification
          description: Account status
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp
    OAuthCallbackRequest:
      description: Request payload for OAuth callback processing
      type: object
      required:
      - code
      - state
      properties:
        code:
          type: string
          description: Authorization code from provider
        state:
          type: string
          description: State parameter for validation
        code_verifier:
          type: string
          description: PKCE code verifier
        redirect_uri:
          type: string
          format: uri
          description: Redirect URI used in authorization
    OAuthResult:
      description: Result of OAuth authentication flow
      type: object
      properties:
        access_token:
          type: string
          description: Platform JWT access token
        refresh_token:
          type: string
          description: Platform JWT refresh token
        token_type:
          type: string
          enum:
          - Bearer
          example: Bearer
        expires_in:
          type: integer
          description: Access token expiration in seconds
        user_linked:
          type: boolean
          description: Whether OAuth account was linked to existing user
        user_created:
          type: boolean
          description: Whether new user account was created
        account_link:
          $ref: '#/components/schemas/OAuthAccountLink'
        user:
          $ref: '#/components/schemas/UserAccountSummary'
    TokenExchangeRequest:
      description: Request payload for token exchange
      type: object
      required:
      - code
      - redirect_uri
      properties:
        code:
          type: string
          description: Authorization code to exchange
        redirect_uri:
          type: string
          format: uri
          description: Redirect URI used in authorization
        code_verifier:
          type: string
          description: PKCE code verifier
        link_to_user:
          type: string
          format: uuid
          description: Existing user ID to link OAuth account to
    TokenRefreshRequest:
      description: Request payload for token refresh
      type: object
      required:
      - refresh_token
      properties:
        refresh_token:
          type: string
          description: OAuth refresh token
        scopes:
          type: array
          items:
            type: string
          description: Requested scopes for new token
    LinkOAuthAccountRequest:
      description: Request payload for linking OAuth account
      type: object
      required:
      - provider
      - authorization_code
      properties:
        provider:
          type: string
          enum:
          - google
          - discord
          - steam
          - github
          description: OAuth provider
        authorization_code:
          type: string
          description: OAuth authorization code
        redirect_uri:
          type: string
          format: uri
          description: Redirect URI used
        code_verifier:
          type: string
          description: PKCE code verifier (if used)
  responses:
    OK:
      $ref: ../common/responses/success.yaml#/OK
    Created:
      $ref: ../common/responses/success.yaml#/Created
    Updated:
      $ref: ../common/responses/success.yaml#/Updated
    Deleted:
      $ref: ../common/responses/success.yaml#/Deleted
    BadRequest:
      $ref: ../common/responses/error.yaml#/BadRequest
    Unauthorized:
      $ref: ../common/responses/error.yaml#/Unauthorized
    NotFound:
      $ref: ../common/responses/error.yaml#/NotFound
    Conflict:
      $ref: ../common/responses/error.yaml#/Conflict
  securitySchemes:
    BearerAuth:
      $ref: ../common/security/security.yaml#/BearerAuth
    ServiceAuth:
      $ref: ../common/security/security.yaml#/ServiceAuth
