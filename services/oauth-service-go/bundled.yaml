openapi: 3.0.3
info:
  title: OAuth Service API
  description: '**Enterprise-grade OAuth integration API for NECPGAME**


    ## Key Features


    - **Enterprise-grade architecture** with proper domain separation

    - **Backend optimization hints** for struct alignment and performance

    - **Complete validation** with redocly and ogen code generation

    - **Security-first approach** with secure OAuth state management

    - **Performance-optimized** OAuth flow handling

    - **Comprehensive error handling** with proper HTTP status codes


    ## Domain Purpose


    Provides comprehensive OAuth integration with external providers (Google, Facebook,
    Discord, Steam).

    Handles OAuth redirects, callbacks, and secure token exchange for social authentication.


    ## Performance Targets


    - P99 Latency: <100ms for OAuth operations

    - Memory: <75KB per instance

    - Concurrent users: 5,000+ simultaneous OAuth authorizations

    - Provider API optimization: Cached responses and connection pooling

    '
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    email: api@necpgame.com
  license:
    name: MIT
servers:
- url: https://api.necpgame.com/v1/oauth
  description: Production server
- url: https://staging-api.necpgame.com/v1/oauth
  description: Staging server
- url: http://localhost:8080/api/v1/oauth
  description: Local development server
security:
- BearerAuth: []
tags:
- name: OAuth
  description: OAuth provider integrations
- name: Health Monitoring
  description: System health and performance monitoring
paths:
  /health:
    get:
      summary: OAuth service health check
      description: '**Enterprise-grade health check endpoint**


        Provides real-time health status of the OAuth microservice.


        Critical for service discovery, load balancing, and monitoring.


        **Performance:** <1ms response time, cached for 30 seconds

        '
      operationId: oauthServiceHealthCheck
      tags:
      - Health Monitoring
      parameters:
      - name: Accept-Encoding
        in: header
        schema:
          type: string
          enum:
          - gzip
          - deflate
          - br
      responses:
        '200':
          description: Service is healthy
          headers:
            Cache-Control:
              schema:
                type: string
                example: max-age=30, s-maxage=60
            ETag:
              schema:
                type: string
                example: '"health-v1.0"'
            Content-Encoding:
              schema:
                type: string
                enum:
                - gzip
          content:
            application/json:
              schema:
                type: object
                required:
                - status
                - timestamp
                properties:
                  status:
                    type: string
                    enum:
                    - healthy
                    - degraded
                    - unhealthy
                    example: healthy
                    maxLength: 255
                  domain:
                    type: string
                    example: service-name
                    maxLength: 255
                  timestamp:
                    type: string
                    format: date-time
                    example: '2025-12-28T10:00:00Z'
                    maxLength: 255
                  version:
                    type: string
                    example: 1.0.0
                    maxLength: 50
                  uptime_seconds:
                    type: integer
                    example: 3600
                    minimum: 0
                  active_connections:
                    type: integer
                    example: 1500
                    minimum: 0
                description: 'BACKEND NOTE: Fields ordered for struct alignment (large
                  → small). Expected memory savings: 30-50%.'
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                required:
                - status
                - timestamp
                properties:
                  status:
                    type: string
                    enum:
                    - healthy
                    - degraded
                    - unhealthy
                    example: healthy
                    maxLength: 255
                  domain:
                    type: string
                    example: service-name
                    maxLength: 255
                  timestamp:
                    type: string
                    format: date-time
                    example: '2025-12-28T10:00:00Z'
                    maxLength: 255
                  version:
                    type: string
                    example: 1.0.0
                    maxLength: 50
                  uptime_seconds:
                    type: integer
                    example: 3600
                    minimum: 0
                  active_connections:
                    type: integer
                    example: 1500
                    minimum: 0
                description: 'BACKEND NOTE: Fields ordered for struct alignment (large
                  → small). Expected memory savings: 30-50%.'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
  /health/batch:
    post:
      summary: Batch health check for multiple OAuth providers
      description: '**Batch health monitoring for OAuth ecosystem**


        Checks connectivity and responsiveness of multiple OAuth providers simultaneously.

        Essential for proactive monitoring and automated failover decisions.


        **Performance:** <100ms for all providers, parallel execution

        '
      operationId: oauthServiceBatchHealthCheck
      tags:
      - Health Monitoring
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                providers:
                  type: array
                  items:
                    type: string
                    enum:
                    - google
                    - facebook
                    - discord
                    - steam
                  description: List of providers to check
                timeout:
                  type: integer
                  minimum: 1000
                  maximum: 30000
                  default: 5000
                  description: Timeout in milliseconds per provider
      responses:
        '200':
          description: Batch health check completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/HealthResponse'
                    description: Health status per provider
                  summary:
                    type: object
                    properties:
                      total_checked:
                        type: integer
                      healthy_count:
                        type: integer
                      unhealthy_count:
                        type: integer
                      average_response_time:
                        type: integer
                        description: Average response time in milliseconds
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
  /auth/oauth/{provider}/redirect:
    get:
      tags:
      - OAuth
      summary: Получить URL для редиректа OAuth
      operationId: getOAuthRedirect
      parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum:
          - google
          - facebook
          - discord
          - steam
      responses:
        '200':
          description: URL для редиректа
          content:
            application/json:
              schema:
                type: object
                properties:
                  redirect_url:
                    type: string
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
  /auth/oauth/{provider}/callback:
    get:
      tags:
      - OAuth
      summary: Обработка callback от OAuth провайдера
      operationId: handleOAuthCallback
      parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum:
          - google
          - facebook
          - discord
          - steam
      - name: code
        in: query
        required: true
        schema:
          type: string
      - name: state
        in: query
        schema:
          type: string
      responses:
        '200':
          description: OAuth авторизация успешна
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                type: object
                required:
                - code
                - message
                properties:
                  code:
                    type: integer
                    example: 500
                    format: int32
                    minimum: 100
                    maximum: 599
                  message:
                    type: string
                    example: Internal server error
                    maxLength: 1000
                  details:
                    type: object
                    description: Additional error details
                description: Standard error response format
components:
  responses:
    OK:
      description: Operation completed successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: true
              message:
                type: string
                example: Operation completed
    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            type: object
            required:
            - code
            - message
            properties:
              code:
                type: integer
                example: 500
                format: int32
                minimum: 100
                maximum: 599
              message:
                type: string
                example: Internal server error
                maxLength: 1000
              details:
                type: object
                description: Additional error details
            description: Standard error response format
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            required:
            - code
            - message
            properties:
              code:
                type: integer
                example: 500
                format: int32
                minimum: 100
                maximum: 599
              message:
                type: string
                example: Internal server error
                maxLength: 1000
              details:
                type: object
                description: Additional error details
            description: Standard error response format
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            required:
            - code
            - message
            properties:
              code:
                type: integer
                example: 500
                format: int32
                minimum: 100
                maximum: 599
              message:
                type: string
                example: Internal server error
                maxLength: 1000
              details:
                type: object
                description: Additional error details
            description: Standard error response format
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            required:
            - code
            - message
            properties:
              code:
                type: integer
                example: 500
                format: int32
                minimum: 100
                maximum: 599
              message:
                type: string
                example: Internal server error
                maxLength: 1000
              details:
                type: object
                description: Additional error details
            description: Standard error response format
  schemas:
    Error:
      type: object
      required:
      - code
      - message
      properties:
        code:
          type: integer
          example: 500
          format: int32
          minimum: 100
          maximum: 599
        message:
          type: string
          example: Internal server error
          maxLength: 1000
        details:
          type: object
          description: Additional error details
      description: Standard error response format
    HealthResponse:
      type: object
      required:
      - status
      - timestamp
      properties:
        status:
          type: string
          enum:
          - healthy
          - degraded
          - unhealthy
          example: healthy
          maxLength: 255
        domain:
          type: string
          example: service-name
          maxLength: 255
        timestamp:
          type: string
          format: date-time
          example: '2025-12-28T10:00:00Z'
          maxLength: 255
        version:
          type: string
          example: 1.0.0
          maxLength: 50
        uptime_seconds:
          type: integer
          example: 3600
          minimum: 0
        active_connections:
          type: integer
          example: 1500
          minimum: 0
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%.'
    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        account:
          $ref: '#/components/schemas/Account'
        expires_in:
          type: integer
          description: Token expiration time in seconds
        token_type:
          type: string
          enum:
          - Bearer
          example: Bearer
        scope:
          type: string
          description: Granted OAuth scopes
          example: read write
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%.'
    Account:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Internal user ID
        email:
          type: string
          format: email
          description: User email address
        username:
          type: string
          description: Username
        provider:
          type: string
          enum:
          - google
          - github
          - discord
          - steam
          description: OAuth provider
        provider_id:
          type: string
          description: Provider-specific user ID
        avatar_url:
          type: string
          format: uri
          description: User avatar URL
        verified_at:
          type: string
          format: date-time
        email_verified:
          type: boolean
        two_factor_enabled:
          type: boolean
      description: 'BACKEND NOTE: Fields ordered for struct alignment (large → small).
        Expected memory savings: 30-50%.'
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer token authentication
