openapi: 3.0.3
info:
  title: Announcement Components
  version: 1.0.0
  x-microservice:
    name: admin-service
    port: 8088
    domain: admin
    base-path: /api/v1/admin
    package: com.necpgame.adminservice
paths: {}

components:
  parameters:
    AnnouncementId:
      name: announcementId
      in: path
      required: true
      description: Идентификатор объявления
      schema:
        type: string
  schemas:
    AnnouncementDraftRequest:
      type: object
      required: [title, body, type]
      properties:
        title: { type: string, maxLength: 140 }
        summary: { type: string, maxLength: 280 }
        body: { type: string, description: Markdown/HTML контент }
        type: { type: string, enum: [NEWS, PATCH_NOTES, MAINTENANCE, EVENT, EMERGENCY] }
        tags:
          type: array
          items: { type: string }
        mediaAssets:
          type: array
          items: { $ref: '#/components/schemas/MediaAsset' }
        defaultChannels: { $ref: '#/components/schemas/ChannelConfig' }
        authorId: { type: string }
    Announcement:
      type: object
      required: [announcementId, title, status, type, createdAt]
      properties:
        announcementId: { type: string }
        title: { type: string }
        type: { type: string }
        status: { type: string, enum: [draft, scheduled, active, archived, cancelled] }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        channels: { $ref: '#/components/schemas/ChannelConfig' }
        audience: { $ref: '#/components/schemas/AudienceRules' }
        authorId: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    AnnouncementsListResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/Announcement' }
        pagination: { $ref: '../../shared/common/pagination.yaml#/components/schemas/PaginationMeta' }
    AnnouncementDetail:
      type: object
      properties:
        announcement: { $ref: '#/components/schemas/Announcement' }
        content: { $ref: '#/components/schemas/AnnouncementContent' }
        schedule: { $ref: '#/components/schemas/ScheduleInfo' }
        locales:
          type: array
          items: { $ref: '#/components/schemas/TranslationPayload' }
        history: { $ref: '#/components/schemas/HistoryResponse' }
    AnnouncementContent:
      type: object
      properties:
        body: { type: string }
        summary: { type: string }
        mediaAssets:
          type: array
          items: { $ref: '#/components/schemas/MediaAsset' }
        attachments:
          type: array
          items: { type: string, format: uri }
    AnnouncementUpdateRequest:
      type: object
      properties:
        title: { type: string }
        summary: { type: string }
        body: { type: string }
        tags:
          type: array
          items: { type: string }
        channels: { $ref: '#/components/schemas/ChannelConfig' }
        audience: { $ref: '#/components/schemas/AudienceRules' }
        mediaAssets:
          type: array
          items: { $ref: '#/components/schemas/MediaAsset' }
    MediaAsset:
      type: object
      required: [assetId, url]
      properties:
        assetId: { type: string }
        url: { type: string, format: uri }
        type: { type: string, enum: [image, video, audio, file] }
        altText: { type: string }
    ScheduleRequest:
      type: object
      required: [startAt]
      properties:
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        timezone: { type: string, example: "Europe/Berlin" }
        recurrence:
          type: object
          properties:
            pattern: { type: string, enum: [none, daily, weekly] }
            occurrences: { type: integer }
        fallbackChannels:
          type: array
          items: { type: string, enum: [email, push, web_portal] }
    ScheduleInfo:
      type: object
      properties:
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        timezone: { type: string }
        recurrence:
          type: object
          properties:
            pattern: { type: string }
            occurrences: { type: integer }
    CancellationRequest:
      type: object
      required: [reason]
      properties:
        reason: { type: string, maxLength: 280 }
        notifyChannels:
          type: array
          items: { type: string }
        incidentTicketId: { type: string }
    ChannelConfig:
      type: object
      properties:
        inGameBanner: { $ref: '#/components/schemas/ChannelToggle' }
        modal: { $ref: '#/components/schemas/ChannelToggle' }
        chat: { $ref: '#/components/schemas/ChannelToggle' }
        email: { $ref: '#/components/schemas/ChannelToggle' }
        push: { $ref: '#/components/schemas/ChannelToggle' }
        webPortal: { $ref: '#/components/schemas/ChannelToggle' }
    ChannelToggle:
      type: object
      properties:
        enabled: { type: boolean }
        templateId: { type: string }
        priority: { type: integer, minimum: 1, maximum: 10 }
    AudienceRules:
      type: object
      properties:
        regions:
          type: array
          items: { type: string }
        platforms:
          type: array
          items: { type: string, enum: [pc, console, mobile] }
        minLevel: { type: integer, minimum: 1 }
        maxLevel: { type: integer }
        subscriptionTags:
          type: array
          items: { type: string }
        excludeClans:
          type: array
          items: { type: string }
    PreviewRequest:
      type: object
      properties:
        channels:
          type: array
          items: { type: string }
        locale: { type: string }
        screenshotMode: { type: boolean }
    PreviewResponse:
      type: object
      properties:
        renders:
          type: array
          items:
            type: object
            properties:
              channel: { type: string }
              content: { type: string }
              assets:
                type: array
                items: { type: string, format: uri }
    AnalyticsResponse:
      type: object
      properties:
        announcementId: { type: string }
        range: { type: string }
        viewsByChannel:
          type: object
          additionalProperties: { type: integer }
        openRate: { type: number }
        clickThroughRate: { type: number }
        ackCount: { type: integer }
        unsubscribeCount: { type: integer }
        feedbackStats:
          type: object
          properties:
            useful: { type: integer }
            neutral: { type: integer }
            notUseful: { type: integer }
    FeedbackRequest:
      type: object
      required: [playerId, rating]
      properties:
        playerId: { type: string }
        rating: { type: string, enum: [useful, neutral, not_useful] }
        comment: { type: string, maxLength: 500 }
        channel: { type: string }
    TranslationPayload:
      type: object
      required: [locale, title, body]
      properties:
        locale: { type: string, pattern: '^[a-z]{2}-[A-Z]{2}$' }
        title: { type: string }
        summary: { type: string }
        body: { type: string }
        mediaAssets:
          type: array
          items: { $ref: '#/components/schemas/MediaAsset' }
    EmergencyRequest:
      type: object
      required: [message, channels]
      properties:
        message: { type: string, maxLength: 500 }
        channels:
          type: array
          items: { type: string, enum: [in_game_banner, modal, chat, push, email] }
        severity: { type: string, enum: [critical, high, medium] }
        requireAck: { type: boolean }
        expiresAt: { type: string, format: date-time }
    HistoryResponse:
      type: object
      properties:
        entries:
          type: array
          items: { $ref: '#/components/schemas/HistoryEntry' }
    HistoryEntry:
      type: object
      properties:
        version: { type: integer }
        authorId: { type: string }
        changeType: { type: string, enum: [created, updated, scheduled, cancelled, translated] }
        timestamp: { type: string, format: date-time }
        comments: { type: string }
    MediaAssetList:
      type: array
      items: { $ref: '#/components/schemas/MediaAsset' }
    AnnouncementError:
      type: object
      required: [code, message]
      properties:
        code: { type: string, enum: [INVALID_CHANNEL, SCHEDULE_CONFLICT, NOT_AUTHORIZED, ALREADY_PUBLISHED, TRANSLATION_MISSING, LIMIT_EXCEEDED] }
        message: { type: string }
        retryAfterSeconds: { type: integer }
servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
