openapi: 3.0.3
info:
  title: Battle Pass Components
  version: 1.0.0
  x-microservice:
    name: gameplay-service
    port: 8083
    domain: gameplay
    base-path: /api/v1/gameplay
    package: com.necpgame.gameplayservice
paths: {}

components:
  parameters:
    SeasonId:
      name: seasonId
      in: path
      required: true
      description: Идентификатор сезона battle pass
      schema: { type: string }
  schemas:
    BattlePassSeasonCreateRequest:
      type: object
      required: [seasonNumber, name, startDate, endDate, maxLevel, xpPerLevel]
      properties:
        seasonNumber: { type: integer, minimum: 1 }
        name: { type: string }
        theme: { type: string }
        description: { type: string }
        startDate: { type: string, format: date-time }
        endDate: { type: string, format: date-time }
        maxLevel: { type: integer, minimum: 1 }
        xpPerLevel: { type: integer, minimum: 1 }
        premiumPrice: { type: integer, minimum: 0 }
        premiumCurrency: { type: string }
        xpCapPerDay: { type: integer }
    BattlePassSeasonUpdateRequest:
      type: object
      properties:
        name: { type: string }
        theme: { type: string }
        description: { type: string }
        startDate: { type: string, format: date-time }
        endDate: { type: string, format: date-time }
        maxLevel: { type: integer }
        xpPerLevel: { type: integer }
        xpCapPerDay: { type: integer }
    BattlePassSeason:
      type: object
      required: [seasonId, seasonNumber, name, startDate, endDate, status]
      properties:
        seasonId: { type: string }
        seasonNumber: { type: integer }
        name: { type: string }
        theme: { type: string }
        description: { type: string }
        startDate: { type: string, format: date-time }
        endDate: { type: string, format: date-time }
        maxLevel: { type: integer }
        xpPerLevel: { type: integer }
        premiumPrice: { type: integer }
        premiumCurrency: { type: string }
        xpCapPerDay: { type: integer }
        status: { type: string, enum: [SCHEDULED, ACTIVE, ENDED, ARCHIVED] }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    BattlePassSeasonListResponse:
      type: object
      properties:
        seasons:
          type: array
          items: { $ref: '#/components/schemas/BattlePassSeason' }
    SeasonStatusChangeRequest:
      type: object
      required: [status]
      properties:
        status: { type: string, enum: [SCHEDULED, ACTIVE, ENDED, ARCHIVED] }
        reason: { type: string }
    PremiumConfigRequest:
      type: object
      required: [premiumPrice, premiumCurrency]
      properties:
        premiumPrice: { type: integer, minimum: 0 }
        premiumCurrency: { type: string }
        discounts:
          type: array
          items:
            type: object
            properties:
              tier: { type: string }
              percent: { type: number }
              validFrom: { type: string, format: date-time }
              validUntil: { type: string, format: date-time }
    PlayerBattlePassProgress:
      type: object
      required: [playerId, seasonId, currentLevel, currentXP, totalXPEarned, hasPremium]
      properties:
        playerId: { type: string }
        seasonId: { type: string }
        currentLevel: { type: integer }
        currentXP: { type: integer }
        totalXPEarned: { type: integer }
        hasPremium: { type: boolean }
        premiumPurchasedAt: { type: string, format: date-time }
        claimedFreeLevels:
          type: array
          items: { type: integer }
        claimedPremiumLevels:
          type: array
          items: { type: integer }
        lastXPEarnedAt: { type: string, format: date-time }
    XpGrantRequest:
      type: object
      required: [playerId, seasonId, source, amount]
      properties:
        playerId: { type: string }
        seasonId: { type: string }
        source: { type: string, enum: [DAILY_QUEST, MATCH_WIN, ACHIEVEMENT, PLAYTIME, EVENT] }
        amount: { type: integer, minimum: 1 }
        multiplier: { type: number, minimum: 1 }
        metadata: { type: object, additionalProperties: true }
    XpGrantResponse:
      type: object
      properties:
        seasonId: { type: string }
        playerId: { type: string }
        xpAdded: { type: integer }
        currentLevel: { type: integer }
        currentXP: { type: integer }
        totalXPEarned: { type: integer }
        levelUps:
          type: array
          items:
            type: object
            properties:
              level: { type: integer }
              achievedAt: { type: string, format: date-time }
    ProgressSyncRequest:
      type: object
      required: [playerId, seasonId]
      properties:
        playerId: { type: string }
        seasonId: { type: string }
        revertSeasonId: { type: string }
    ProgressResetRequest:
      type: object
      required: [seasonId]
      properties:
        seasonId: { type: string }
        dryRun: { type: boolean }
    PremiumPurchaseRequest:
      type: object
      required: [playerId, seasonId, paymentMethod]
      properties:
        playerId: { type: string }
        seasonId: { type: string }
        paymentMethod: { type: string, enum: [CURRENCY, TOKEN, BUNDLE] }
        currency: { type: string }
        amount: { type: integer }
        platform: { type: string }
    PremiumPurchaseResponse:
      type: object
      properties:
        playerId: { type: string }
        seasonId: { type: string }
        hasPremium: { type: boolean }
        premiumPurchasedAt: { type: string, format: date-time }
        remainingCurrency: { type: integer }
    PremiumStatusResponse:
      type: object
      properties:
        playerId: { type: string }
        seasonId: { type: string }
        hasPremium: { type: boolean }
        premiumPurchasedAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time }
        entitlementSource: { type: string }
    XpSourcesResponse:
      type: object
      properties:
        sources:
          type: array
          items:
            type: object
            properties:
              source: { type: string }
              baseAmount: { type: integer }
              dailyLimit: { type: integer }
              enabled: { type: boolean }
    LevelSkipRequest:
      type: object
      required: [playerId, seasonId, levelsToSkip]
      properties:
        playerId: { type: string }
        seasonId: { type: string }
        levelsToSkip: { type: integer, minimum: 1 }
        paymentMethod: { type: string }
        cost: { type: integer }
        auditId: { type: string }
    LevelSkipResponse:
      type: object
      properties:
        newLevel: { type: integer }
        totalLevelsSkipped: { type: integer }
        remainingCurrency: { type: integer }
    BattlePassAnalyticsResponse:
      type: object
      properties:
        generatedAt: { type: string, format: date-time }
        seasonId: { type: string }
        range: { type: string }
        activePlayers: { type: integer }
        premiumConversionRate: { type: number }
        averageLevel: { type: number }
        xpDistribution:
          type: array
          items:
            type: object
            properties:
              levelRange: { type: string }
              playerCount: { type: integer }
        retentionMetrics:
          type: object
          properties:
            day7: { type: number }
            day30: { type: number }
            premiumRetention: { type: number }
    BattlePassError:
      type: object
      required: [code, message]
      properties:
        code: { type: string, enum: [SEASON_NOT_FOUND, XP_SOURCE_DISABLED, INSUFFICIENT_FUNDS, ALREADY_PREMIUM, LEVEL_CAP_REACHED, SEASON_NOT_ACTIVE] }
        message: { type: string }
        traceId: { type: string }
servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
