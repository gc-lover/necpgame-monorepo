# Combat Cyberpsychosis API - Модели данных
# Источник: .BRAIN/02-gameplay/combat/combat-cyberpsychosis.md (v1.1.0)
# Раздел: Модели данных для системы киберпсихоза

openapi: 3.0.3
info:
  title: Combat Cyberpsychosis - Models
  version: 1.0.0

  x-microservice:
    name: gameplay-service
    port: 8083
    domain: gameplay
    base-path: /api/v1/gameplay
    package: com.necpgame.gameplayservice
paths: {}

components:
  schemas:
    # Человечность
    HumanityInfo:
      type: object
      required:
        - current
        - max
        - loss_percentage
        - stage
      description: Информация о человечности игрока
      properties:
        current:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Текущий уровень человечности (0-100)
        max:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Максимальный уровень человечности
        loss_percentage:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Процент потери человечности (0-100%)
        stage:
          type: string
          enum: [early, middle, late, cyberpsychosis]
          description: Текущая стадия киберпсихоза

    HumanityLossCalculation:
      type: object
      required:
        - base_loss
        - total_loss
        - new_humanity_level
      description: Расчет потери человечности при установке импланта
      properties:
        base_loss:
          type: number
          format: float
          minimum: 0
          description: Базовая потеря человечности
        modifiers:
          type: object
          description: Модификаторы потери
          properties:
            type_modifier:
              type: number
              format: float
            quality_modifier:
              type: number
              format: float
            installer_modifier:
              type: number
              format: float
            compatibility_modifier:
              type: number
              format: float
            intensity_modifier:
              type: number
              format: float
        total_loss:
          type: number
          format: float
          minimum: 0
          description: Итоговая потеря человечности
        new_humanity_level:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Новый уровень человечности после потери

    HumanityUpdateResult:
      type: object
      required:
        - new_level
        - stage_transition
      description: Результат обновления человечности
      properties:
        new_level:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Новый уровень человечности
        stage_transition:
          type: object
          nullable: true
          description: Переход между стадиями
          properties:
            from_stage:
              type: string
              enum: [early, middle, late, cyberpsychosis]
            to_stage:
              type: string
              enum: [early, middle, late, cyberpsychosis]
            triggered_at:
              type: string
              format: date-time
        symptoms_triggered:
          type: array
          items:
            type: string
            format: uuid
          description: Идентификаторы сработавших симптомов

    # Стадии и симптомы
    CyberpsychosisStage:
      type: object
      required:
        - stage
        - humanity_range
        - symptoms
        - effects
      description: Стадия киберпсихоза игрока
      properties:
        stage:
          type: string
          enum: [early, middle, late, cyberpsychosis]
          description: Название стадии
        humanity_range:
          type: object
          description: Диапазон потери человечности для стадии
          properties:
            min:
              type: number
              format: float
            max:
              type: number
              format: float
        symptoms:
          type: array
          items:
            $ref: '#/components/schemas/Symptom'
          description: Активные симптомы стадии
        effects:
          type: array
          items:
            type: object
          description: Эффекты стадии

    Symptom:
      type: object
      required:
        - symptom_id
        - name
        - description
        - severity
        - effects
      description: Симптом киберпсихоза
      properties:
        symptom_id:
          type: string
          format: uuid
          description: Идентификатор симптома
        name:
          type: string
          description: Название симптома
        description:
          type: string
          description: Описание симптома
        severity:
          type: string
          enum: [low, medium, high, critical]
          description: Серьезность симптома
        effects:
          type: object
          description: Эффекты симптома
          additionalProperties: true
        duration:
          type: number
          format: float
          nullable: true
          minimum: 0
          description: Длительность симптома в секундах

    StageInfo:
      type: object
      required:
        - name
        - humanity_range
        - symptoms
        - effects
        - consequences
      description: Информация о стадии киберпсихоза
      properties:
        name:
          type: string
          enum: [early, middle, late, cyberpsychosis]
          description: Название стадии
        humanity_range:
          type: object
          description: Диапазон потери человечности для стадии
          properties:
            min:
              type: number
              format: float
            max:
              type: number
              format: float
        symptoms:
          type: array
          items:
            type: object
          description: Список возможных симптомов для стадии
        effects:
          type: array
          items:
            type: object
          description: Эффекты стадии
        consequences:
          type: array
          items:
            type: object
          description: Последствия стадии

    # Прогрессия
    ProgressionInfo:
      type: object
      required:
        - current_progression_rate
        - factors
        - triggers
      description: Информация о прогрессии киберпсихоза
      properties:
        current_progression_rate:
          type: number
          format: float
          description: Текущая скорость прогрессии
        factors:
          type: array
          items:
            type: object
          description: Активные факторы прогрессии
        triggers:
          type: array
          items:
            type: object
          description: Активные триггеры прогрессии
        next_check_time:
          type: string
          format: date-time
          nullable: true
          description: Время следующей проверки прогрессии

    ProgressionCalculation:
      type: object
      required:
        - base_rate
        - total_rate
        - predicted_loss
      description: Расчет прогрессии киберпсихоза
      properties:
        base_rate:
          type: number
          format: float
          description: Базовая скорость прогрессии
        factors:
          type: array
          items:
            type: object
          description: Факторы прогрессии с их влиянием
        total_rate:
          type: number
          format: float
          description: Итоговая скорость прогрессии
        predicted_loss:
          type: number
          format: float
          description: Предсказанная потеря человечности за период

    ProgressionTriggerResult:
      type: object
      required:
        - loss_applied
        - stage_transition
      description: Результат триггера прогрессии
      properties:
        loss_applied:
          type: number
          format: float
          minimum: 0
          description: Примененная потеря человечности
        stage_transition:
          type: object
          nullable: true
          description: Переход между стадиями
          properties:
            from_stage:
              type: string
              enum: [early, middle, late, cyberpsychosis]
            to_stage:
              type: string
              enum: [early, middle, late, cyberpsychosis]
        symptoms_triggered:
          type: array
          items:
            type: string
            format: uuid
          description: Идентификаторы сработавших симптомов

    # Последствия
    ConsequencesInfo:
      type: object
      required:
        - stat_penalties
        - social_effects
        - control_effects
      description: Последствия киберпсихоза
      properties:
        stat_penalties:
          $ref: '#/components/schemas/StatPenalties'
          description: Штрафы к характеристикам
        social_effects:
          $ref: '#/components/schemas/SocialEffects'
          description: Социальные эффекты
        control_effects:
          type: object
          description: Эффекты на контроль
          additionalProperties: true
        visual_indicators:
          type: array
          items:
            type: string
          description: Визуальные индикаторы стадии

    StatPenalties:
      type: object
      description: Штрафы к характеристикам от киберпсихоза
      properties:
        accuracy:
          type: number
          format: float
          maximum: 0
          description: Штраф к точности
        social_skills:
          type: number
          format: float
          maximum: 0
          description: Штраф к социальным навыкам
        health_regen:
          type: number
          format: float
          maximum: 0
          description: Штраф к восстановлению здоровья
        energy_max:
          type: number
          format: float
          maximum: 0
          description: Штраф к максимальной энергии
        other:
          type: object
          nullable: true
          description: Другие штрафы
          additionalProperties:
            type: number
            format: float

    SocialEffects:
      type: object
      description: Социальные эффекты киберпсихоза
      properties:
        reputation_penalty:
          type: number
          format: float
          maximum: 0
          description: Штраф к репутации с фракциями
        npc_access_restrictions:
          type: array
          items:
            type: object
          description: Ограничения доступа к NPC
        visual_indicators:
          type: array
          items:
            type: string
          description: Визуальные индикаторы для других игроков

    # Управление
    PreventionResult:
      type: object
      required:
        - effectiveness
        - duration
        - cost
        - progression_modifier
      description: Результат профилактики
      properties:
        effectiveness:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Эффективность профилактики
        duration:
          type: number
          format: float
          minimum: 0
          description: Длительность эффекта в секундах
        cost:
          type: number
          format: float
          minimum: 0
          description: Стоимость профилактики
        progression_modifier:
          type: number
          format: float
          maximum: 0
          description: Модификатор прогрессии

    TreatmentResult:
      type: object
      required:
        - humanity_restored
        - cost
        - duration
      description: Результат лечения
      properties:
        humanity_restored:
          type: number
          format: float
          minimum: 0
          description: Восстановленная человечность
        cost:
          type: number
          format: float
          minimum: 0
          description: Стоимость лечения
        duration:
          type: number
          format: float
          minimum: 0
          description: Длительность лечения в секундах
        cooldown:
          type: number
          format: float
          nullable: true
          minimum: 0
          description: Кулдаун до следующего лечения в секундах
        limitations:
          type: array
          items:
            type: string
          description: Ограничения восстановления

    TreatmentOption:
      type: object
      required:
        - type
        - name
        - description
        - cost
        - effectiveness
      description: Опция лечения
      properties:
        type:
          type: string
          enum: [therapy, medication, implant_removal, detoxification]
          description: Тип лечения
        name:
          type: string
          description: Название метода лечения
        description:
          type: string
          description: Описание метода лечения
        cost:
          type: number
          format: float
          minimum: 0
          description: Стоимость лечения
        effectiveness:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Эффективность лечения
        cooldown:
          type: number
          format: float
          nullable: true
          minimum: 0
          description: Кулдаун до следующего использования в секундах
        requirements:
          type: object
          nullable: true
          description: Требования для использования
          additionalProperties: true

    SymptomManagementResult:
      type: object
      required:
        - symptoms_affected
        - effectiveness
        - duration
        - cost
      description: Результат управления симптомами
      properties:
        symptoms_affected:
          type: array
          items:
            type: string
            format: uuid
          description: Идентификаторы затронутых симптомов
        effectiveness:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Эффективность управления симптомами
        duration:
          type: number
          format: float
          minimum: 0
          description: Длительность эффекта в секундах
        cost:
          type: number
          format: float
          minimum: 0
          description: Стоимость управления симптомами

    AdaptationInfo:
      type: object
      required:
        - adapted_symptoms
        - adaptation_level
        - effects_reduction
      description: Информация об адаптации к симптомам
      properties:
        adapted_symptoms:
          type: array
          items:
            type: string
            format: uuid
          description: Идентификаторы адаптированных симптомов
        adaptation_level:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Уровень адаптации
        effects_reduction:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Снижение влияния симптомов

    ImplantRemovalResult:
      type: object
      required:
        - humanity_restored
        - cost
      description: Результат удаления импланта
      properties:
        humanity_restored:
          type: number
          format: float
          minimum: 0
          description: Восстановленная человечность
        cost:
          type: number
          format: float
          minimum: 0
          description: Стоимость удаления импланта
        effects:
          type: object
          nullable: true
          description: Эффекты удаления
          additionalProperties: true

    DetoxificationResult:
      type: object
      required:
        - humanity_restored
        - cost
        - duration
        - cooldown
      description: Результат детоксикации
      properties:
        humanity_restored:
          type: number
          format: float
          minimum: 0
          description: Восстановленная человечность
        cost:
          type: number
          format: float
          minimum: 0
          description: Стоимость детоксикации
        duration:
          type: number
          format: float
          minimum: 0
          description: Длительность процедуры в секундах
        cooldown:
          type: number
          format: float
          minimum: 0
          description: Кулдаун до следующей детоксикации в секундах

    TreatmentCosts:
      type: object
      required:
        - base_cost
        - total_cost
        - currency
      description: Стоимость лечения
      properties:
        base_cost:
          type: number
          format: float
          minimum: 0
          description: Базовая стоимость лечения
        modifiers:
          type: object
          nullable: true
          description: Модификаторы стоимости
          additionalProperties:
            type: number
        total_cost:
          type: number
          format: float
          minimum: 0
          description: Итоговая стоимость лечения
        currency:
          type: string
          description: Валюта
        discounts:
          type: array
          items:
            type: object
          description: Примененные скидки

    SocialSupportResult:
      type: object
      required:
        - stress_reduction
        - progression_modifier
        - duration
      description: Результат социальной поддержки
      properties:
        stress_reduction:
          type: number
          format: float
          minimum: 0
          description: Снижение стресса
        progression_modifier:
          type: number
          format: float
          maximum: 0
          description: Модификатор прогрессии
        duration:
          type: number
          format: float
          minimum: 0
          description: Длительность эффекта в секундах
servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
