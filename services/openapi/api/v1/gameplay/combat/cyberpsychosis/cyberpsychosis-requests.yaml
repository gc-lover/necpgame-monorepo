openapi: 3.0.3
info:
  title: Combat Cyberpsychosis - Requests
  version: 1.0.0
  description: Запросы для операций управления киберпсихозом

  x-microservice:
    name: gameplay-service
    port: 8083
    domain: gameplay
    base-path: /api/v1/gameplay
    package: com.necpgame.gameplayservice
paths: {}

components:
  schemas:
    CalculateLossRequest:
      type: object
      required:
        - implant_id
        - implant_class
        - implant_grade
        - slot_type
        - humanity_current
      properties:
        implant_id:
          type: string
          format: uuid
          description: Идентификатор импланта, вызывающего потенциальную потерю человечности
          example: "a2b41a5e-6fce-4d68-9eab-62c4e5f9b211"
        implant_class:
          type: string
          description: Класс импланта
          enum: [combat, neural, sensory, support, utility]
          example: combat
        implant_grade:
          type: string
          description: Редкость импланта, влияющая на базовый процент потери
          enum: [common, uncommon, rare, epic, legendary, prototype]
          example: epic
        slot_type:
          type: string
          description: Слот, в который устанавливается имплант
          enum: [neural_core, limb, circulatory, immune, ocular, dermal]
          example: neural_core
        humanity_current:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Текущая человечность игрока
          example: 72.5
        mitigating_factors:
          type: object
          description: Факторы, снижающие потерю человечности
          properties:
            cyberware_tolerance:
              type: integer
              minimum: 0
              maximum: 10
              description: Уровень прокачки устойчивости к кибернетике
              example: 3
            medical_support_level:
              type: string
              enum: [none, clinic, hospital, black_clinic]
              description: Доступный уровень медицинской поддержки
              example: clinic
            pre_installation_therapy:
              type: boolean
              description: Проходил ли персонаж терапию перед установкой импланта
              example: true

    ApplyLossRequest:
      type: object
      required:
        - loss_amount
        - reason
      properties:
        loss_amount:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Фактическая потеря человечности, которая будет применена
          example: 8.75
        reason:
          type: string
          description: Причина потери человечности
          enum: [implant_installation, trauma, cyberdrugs, overclock, experimental_procedure]
          example: implant_installation
        implant_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор импланта, если потеря вызвана его установкой
          example: "a2b41a5e-6fce-4d68-9eab-62c4e5f9b211"
        applied_by:
          type: string
          nullable: true
          description: Идентификатор врача/техника, подтвердившего потерю (если применимо)
          example: "npc-ripperdoc-viktor"
        notes:
          type: string
          maxLength: 500
          nullable: true
          description: Дополнительные комментарии по событию

    CalculateProgressionRequest:
      type: object
      required:
        - humanity_current
        - stage
        - active_triggers
      properties:
        humanity_current:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Текущая человечность игрока
          example: 58.2
        stage:
          type: string
          description: Текущая стадия киберпсихоза
          enum: [none, early, moderate, late, cyberpsychosis]
          example: moderate
        active_triggers:
          type: array
          minItems: 0
          items:
            type: string
            enum:
              - sustained_combat
              - trauma_event
              - implant_damage
              - netrunning_overload
              - blackwall_contact
              - cyberdrug_addiction
          description: Активные триггеры, ускоряющие прогрессию
          example: ["sustained_combat", "implant_damage"]
        recent_events:
          type: array
          description: Последние ключевые события с влиянием на прогрессию
          items:
            type: object
            required:
              - event_type
              - impact
            properties:
              event_type:
                type: string
                description: Тип события
              impact:
                type: number
                format: float
                description: Влияние события на прогрессию (-100..100)
              timestamp:
                type: string
                format: date-time
                description: Время события

    TriggerProgressionRequest:
      type: object
      required:
        - trigger_type
        - intensity
      properties:
        trigger_type:
          type: string
          description: Триггер, запускающий скачок прогрессии
          enum: [combat_berserk, cyberdeck_blackout, implant_failure, mass_casualties, betrayal_event]
          example: combat_berserk
        intensity:
          type: number
          minimum: 1
          maximum: 10
          description: Интенсивность события (1-10)
          example: 7
        duration_minutes:
          type: integer
          minimum: 1
          description: Продолжительность события в минутах
          example: 12
        collateral_damage:
          type: integer
          minimum: 0
          description: Количество жертв/пострадавших, влияющее на прогрессию
          example: 3

    ApplyPreventionRequest:
      type: object
      required:
        - method
        - duration_hours
      properties:
        method:
          type: string
          description: Метод профилактики киберпсихоза
          enum: [therapy_session, meditation_protocol, neurofeedback, medical_sedation, community_support]
          example: neurofeedback
        duration_hours:
          type: integer
          minimum: 1
          maximum: 168
          description: Продолжительность профилактики в часах
          example: 6
        facilitator_id:
          type: string
          nullable: true
          description: Идентификатор специалиста, проводящего процедуру
          example: "npc-therapist-river"
        resources_used:
          type: array
          items:
            type: string
          description: Идентификаторы ресурсов, использованных в процедуре

    ApplyTreatmentRequest:
      type: object
      required:
        - treatment_id
        - facility_level
        - expected_duration_hours
      properties:
        treatment_id:
          type: string
          description: Выбранный протокол лечения
          enum: [neural_reset, pharmacological, cyberware_adjustment, empathy_boost, extreme_detox]
          example: pharmacological
        facility_level:
          type: string
          description: Уровень медучреждения
          enum: [street_clinic, licensed_clinic, hospital, corporate_center]
          example: licensed_clinic
        expected_duration_hours:
          type: integer
          minimum: 1
          maximum: 720
          description: Предполагаемая продолжительность лечения
          example: 48
        risk_acknowledged:
          type: boolean
          description: Подтверждено ли согласие пациента с рисками
          example: true
        cost_override:
          type: number
          format: float
          nullable: true
          description: Пользовательское значение стоимости лечения (если применяется скидка или льгота)

    ApplySymptomManagementRequest:
      type: object
      required:
        - symptom_ids
        - action
      properties:
        symptom_ids:
          type: array
          minItems: 1
          items:
            type: string
          description: Идентификаторы симптомов, над которыми проводится работа
          example: ["symptom-aggression", "symptom-hallucination"]
        action:
          type: string
          description: Выбранная стратегия управления
          enum: [medication, cognitive_therapy, restraint_protocol, sensory_isolation, emergency_sedation]
          example: cognitive_therapy
        medication_dose_mg:
          type: number
          format: float
          nullable: true
          description: Доза медикамента в мг, если используется фармакология
        session_length_minutes:
          type: integer
          minimum: 15
          maximum: 480
          description: Продолжительность сессии управления симптомами
          example: 90

    RemoveImplantRequest:
      type: object
      required:
        - implant_id
        - removal_method
      properties:
        implant_id:
          type: string
          format: uuid
          description: Идентификатор удаляемого импланта
          example: "d82eb589-7c27-4f19-8c83-3f6618a7c245"
        removal_method:
          type: string
          description: Метод удаления импланта
          enum: [surgical, emergency, remote_shutdown, staged]
          example: surgical
        facility_id:
          type: string
          nullable: true
          description: Идентификатор клиники/лаборатории
        anesthetic_protocol:
          type: string
          nullable: true
          description: Используемый вид анестезии
          enum: [local, general, neural_block, none]
        predicted_humanity_regain:
          type: number
          format: float
          nullable: true
          description: Оценка возврата человечности после удаления импланта

    DetoxificationRequest:
      type: object
      required:
        - protocol
        - duration_hours
      properties:
        protocol:
          type: string
          description: Протокол детоксикации
          enum: [chemical_flush, neural_cooling, nanobot_cleanup, cyberdrug_purge]
          example: neural_cooling
        duration_hours:
          type: integer
          minimum: 1
          maximum: 168
          description: Продолжительность детоксикации
          example: 24
        supervision_level:
          type: string
          description: Требуемый уровень наблюдения
          enum: [self, medic, specialist, corporate_team]
          example: specialist
        supportive_medication:
          type: array
          items:
            type: string
          description: Применяемые поддерживающие препараты

    ApplySocialSupportRequest:
      type: object
      required:
        - support_type
        - facilitator_role
      properties:
        support_type:
          type: string
          description: Тип социальной поддержки
          enum: [family_session, clan_intervention, mentorship, community_circle, therapy_group]
          example: mentorship
        facilitator_role:
          type: string
          description: Роль ведущего социальной программы
          enum: [mentor, therapist, clan_leader, fixer, priest]
          example: mentor
        participants:
          type: array
          items:
            type: string
          description: Участники сессии поддержки
          example: ["npc-mentor-jackie", "npc-therapist-river"]
        session_count:
          type: integer
          minimum: 1
          description: Количество назначенных сессий
          example: 6
        expected_outcome:
          type: string
          nullable: true
          maxLength: 500
          description: Ожидаемый результат программы

servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
