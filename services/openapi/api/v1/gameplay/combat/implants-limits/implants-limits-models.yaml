# Combat Implants Limits API - Модели данных
# Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md (v1.0.0)
# Раздел: Модели данных для ограничений и энергетики имплантов

openapi: 3.0.3
info:
  title: Combat Implants Limits - Models
  version: 1.0.0

  x-microservice:
    name: gameplay-service
    port: 8083
    domain: gameplay
    base-path: /api/v1/gameplay
    package: com.necpgame.gameplayservice
paths: {}

components:
  schemas:
    # Слоты имплантов
    ImplantSlots:
      type: object
      required:
        - slots_by_type
      description: |
        Слоты имплантов игрока по типам.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Ограничения имплантов
      properties:
        slots_by_type:
          type: object
          description: Слоты по типам имплантов
          properties:
            combat:
              type: array
              items:
                $ref: '#/components/schemas/SlotInfo'
            tactical:
              type: array
              items:
                $ref: '#/components/schemas/SlotInfo'
            defensive:
              type: array
              items:
                $ref: '#/components/schemas/SlotInfo'
            mobility:
              type: array
              items:
                $ref: '#/components/schemas/SlotInfo'
            os:
              type: array
              items:
                $ref: '#/components/schemas/SlotInfo'

    SlotInfo:
      type: object
      required:
        - slot_id
        - is_occupied
        - can_install
      description: Информация о слоте импланта
      properties:
        slot_id:
          type: string
          format: uuid
          description: Идентификатор слота
        is_occupied:
          type: boolean
          description: Занят ли слот
        installed_implant_id:
          type: string
          format: uuid
          nullable: true
          description: Идентификатор установленного импланта (если занят)
        can_install:
          type: boolean
          description: Можно ли установить имплант в этот слот

    # Совместимость
    CompatibilityResult:
      type: object
      required:
        - is_compatible
      description: |
        Результат проверки совместимости импланта.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Совместимость
      properties:
        is_compatible:
          type: boolean
          description: Совместим ли имплант с установленными
        conflicts:
          type: array
          items:
            $ref: '#/components/schemas/Conflict'
          description: Конфликты совместимости
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/Warning'
          description: Предупреждения о совместимости

    Conflict:
      type: object
      required:
        - implant_id
        - reason
        - severity
      description: Конфликт совместимости
      properties:
        implant_id:
          type: string
          format: uuid
          description: Идентификатор конфликтующего импланта
        reason:
          type: string
          description: Причина конфликта
        severity:
          type: string
          enum: [low, medium, high, critical]
          description: Серьезность конфликта

    Warning:
      type: object
      required:
        - message
        - type
      description: Предупреждение
      properties:
        message:
          type: string
          description: Текст предупреждения
        type:
          type: string
          enum: [compatibility, energy, limit, quality]
          description: Тип предупреждения

    # Лимиты имплантов
    ImplantLimits:
      type: object
      required:
        - base_limit
        - current_limit
        - used_slots
        - available_slots
      description: |
        Лимиты имплантов игрока.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Лимит имплантов
      properties:
        base_limit:
          type: integer
          minimum: 0
          description: Базовый лимит имплантов
        bonus_from_class:
          type: integer
          minimum: 0
          description: Бонус от класса
        bonus_from_progression:
          type: integer
          minimum: 0
          description: Бонус от прокачки
        humanity_penalty:
          type: integer
          maximum: 0
          description: Штраф от человечности (отрицательное значение)
        current_limit:
          type: integer
          minimum: 0
          description: Текущий лимит имплантов
        used_slots:
          type: integer
          minimum: 0
          description: Использовано слотов
        available_slots:
          type: integer
          minimum: 0
          description: Доступно слотов
        can_exceed_temporarily:
          type: boolean
          description: Можно ли временно превысить лимит
        temporary_exceed_duration:
          type: number
          format: float
          nullable: true
          minimum: 0
          description: Длительность временного превышения в секундах (если превышен)

    ImplantLimitInfo:
      type: object
      required:
        - base_limit
        - current_limit
        - used
        - available
      description: Информация о лимите имплантов
      properties:
        base_limit:
          type: integer
          minimum: 0
          description: Базовый лимит
        bonuses:
          type: object
          description: Бонусы к лимиту
          properties:
            class:
              type: integer
              minimum: 0
            progression:
              type: integer
              minimum: 0
            other:
              type: integer
              minimum: 0
        humanity_penalty:
          type: integer
          maximum: 0
          description: Штраф от человечности
        current_limit:
          type: integer
          minimum: 0
          description: Текущий лимит
        used:
          type: integer
          minimum: 0
          description: Использовано
        available:
          type: integer
          minimum: 0
          description: Доступно
        can_exceed_temporarily:
          type: boolean
          description: Можно ли временно превысить

    ImplantLimitCalculation:
      type: object
      required:
        - base
        - total
      description: |
        Расчет лимита имплантов с учетом всех факторов.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Лимит имплантов
      properties:
        base:
          type: integer
          minimum: 0
          description: Базовый лимит
        bonuses:
          type: object
          description: Бонусы к лимиту
          properties:
            class:
              type: integer
              minimum: 0
            progression:
              type: integer
              minimum: 0
        penalties:
          type: object
          description: Штрафы к лимиту
          properties:
            humanity:
              type: integer
              maximum: 0
            quality:
              type: integer
              maximum: 0
        total:
          type: integer
          minimum: 0
          description: Итоговый лимит
        breakdown:
          type: string
          description: Описание расчета

    # Энергетический лимит
    EnergyPoolInfo:
      type: object
      required:
        - total_pool
        - used
        - available
        - regen_rate
        - current_level
      description: |
        Информация об энергетическом пуле игрока.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Энергетический лимит
      properties:
        total_pool:
          type: number
          format: float
          minimum: 0
          description: Общий энергетический пул
        used:
          type: number
          format: float
          minimum: 0
          description: Использовано энергии
        available:
          type: number
          format: float
          minimum: 0
          description: Доступно энергии
        regen_rate:
          type: number
          format: float
          minimum: 0
          description: Скорость восстановления энергии в единицах/сек
        current_level:
          type: number
          format: float
          minimum: 0
          description: Текущий уровень энергии
        max_level:
          type: number
          format: float
          minimum: 0
          description: Максимальный уровень энергии
        individual_limits:
          type: array
          items:
            $ref: '#/components/schemas/IndividualEnergyLimits'
          description: Индивидуальные ограничения для сложных имплантов

    EnergyCalculation:
      type: object
      required:
        - total_drain
        - can_install
      description: |
        Расчет энергетического потребления имплантов.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Энергетический лимит
      properties:
        total_drain:
          type: number
          format: float
          minimum: 0
          description: Общее потребление энергии
        individual_limits:
          type: array
          items:
            $ref: '#/components/schemas/IndividualLimit'
          description: Индивидуальные ограничения имплантов
        can_install:
          type: boolean
          description: Можно ли установить импланты с учетом энергетического лимита
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/Warning'
          description: Предупреждения о энергетическом потреблении

    IndividualLimit:
      type: object
      required:
        - implant_id
        - limit
        - usage
        - can_exceed
      description: Индивидуальное энергетическое ограничение импланта
      properties:
        implant_id:
          type: string
          format: uuid
          description: Идентификатор импланта
        limit:
          type: number
          format: float
          minimum: 0
          description: Индивидуальный лимит энергии
        usage:
          type: number
          format: float
          minimum: 0
          description: Текущее использование энергии
        can_exceed:
          type: boolean
          description: Можно ли превысить индивидуальный лимит

    EnergyRestoreResult:
      type: object
      required:
        - new_level
        - restored_amount
      description: |
        Результат восстановления энергии.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Восстановление энергии
      properties:
        new_level:
          type: number
          format: float
          minimum: 0
          description: Новый уровень энергии
        restored_amount:
          type: number
          format: float
          minimum: 0
          description: Восстановленное количество энергии
        cooldown:
          type: number
          format: float
          nullable: true
          minimum: 0
          description: Кулдаун до следующего восстановления в секундах

    IndividualEnergyLimits:
      type: object
      required:
        - implant_id
        - individual_limit
        - current_usage
        - can_exceed
      description: |
        Индивидуальные энергетические ограничения импланта.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Энергетический лимит
      properties:
        implant_id:
          type: string
          format: uuid
          description: Идентификатор импланта
        individual_limit:
          type: number
          format: float
          minimum: 0
          description: Индивидуальный лимит энергии
        current_usage:
          type: number
          format: float
          minimum: 0
          description: Текущее использование энергии
        can_exceed:
          type: boolean
          description: Можно ли превысить индивидуальный лимит
        penalty_on_exceed:
          type: object
          nullable: true
          description: Штрафы при превышении лимита
          additionalProperties: true

    # Валидация
    ValidationResult:
      type: object
      required:
        - can_install
        - slot_available
        - compatibility_ok
        - limit_ok
        - energy_ok
      description: |
        Результат валидации установки импланта.
        Источник: .BRAIN/02-gameplay/combat/combat-implants-limits.md -> Ограничения имплантов
      properties:
        can_install:
          type: boolean
          description: Можно ли установить имплант
        reasons:
          type: array
          items:
            $ref: '#/components/schemas/Reason'
          description: Причины отказа (если can_install=false)
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/Warning'
          description: Предупреждения
        errors:
          type: array
          items:
            $ref: '#/components/schemas/Error'
          description: Ошибки валидации
        slot_available:
          type: boolean
          description: Доступен ли слот для установки
        compatibility_ok:
          type: boolean
          description: Совместим ли имплант с установленными
        limit_ok:
          type: boolean
          description: Не превышен ли лимит имплантов
        energy_ok:
          type: boolean
          description: Достаточно ли энергии для установки

    Reason:
      type: object
      required:
        - message
        - type
        - severity
      description: Причина отказа в установке
      properties:
        message:
          type: string
          description: Текст причины
        type:
          type: string
          enum: [slot, compatibility, limit, energy, quality]
          description: Тип причины
        severity:
          type: string
          enum: [low, medium, high, critical]
          description: Серьезность причины

    Error:
      type: object
      required:
        - message
        - code
      description: Ошибка валидации
      properties:
        message:
          type: string
          description: Текст ошибки
        code:
          type: string
          description: Код ошибки






















servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
