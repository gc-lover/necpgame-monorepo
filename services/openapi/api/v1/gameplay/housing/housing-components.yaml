openapi: 3.0.3
info:
  title: Housing Components
  version: 1.0.0
  x-microservice:
    name: gameplay-service
    port: 8083
    domain: gameplay
    base-path: /api/v1/gameplay
    package: com.necpgame.gameplayservice
paths: {}

components:
  parameters:
    ApartmentId:
      name: apartmentId
      in: path
      required: true
      description: Идентификатор апартаментов
      schema: { type: string }
  schemas:
    ApartmentPurchaseRequest:
      type: object
      required: [locationId, tier, paymentMethod]
      properties:
        locationId: { type: string }
        tier: { type: integer, minimum: 1, maximum: 5 }
        paymentMethod: { type: string, enum: [credits, shards, prestige_points] }
        initialLayout:
          $ref: '#/components/schemas/LayoutPresetPayload'
        inviteFriends:
          type: array
          items: { type: string }
    ApartmentPurchaseResponse:
      type: object
      properties:
        apartment: { $ref: '#/components/schemas/Apartment' }
        payment:
          type: object
          properties:
            amount: { type: integer }
            currency: { type: string }
        prestigeGain: { type: integer }
    ApartmentsListResponse:
      type: object
      properties:
        apartments:
          type: array
          items: { $ref: '#/components/schemas/Apartment' }
    Apartment:
      type: object
      required: [apartmentId, playerId, locationId, tier, status, createdAt]
      properties:
        apartmentId: { type: string }
        playerId: { type: string }
        locationId: { type: string }
        tier: { type: integer }
        prestige: { type: integer }
        rooms: { type: integer }
        status: { type: string, enum: [ACTIVE, RENOVATION, FOR_SALE] }
        upkeep:
          type: object
          properties:
            nextPaymentAt: { type: string, format: date-time }
            amount: { type: integer }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    ApartmentDetail:
      type: object
      properties:
        apartment: { $ref: '#/components/schemas/Apartment' }
        upgrades:
          type: array
          items: { $ref: '#/components/schemas/ApartmentUpgradeState' }
        layouts:
          type: array
          items: { $ref: '#/components/schemas/LayoutPreset' }
        storage: { $ref: '#/components/schemas/StorageStatus' }
        guests:
          type: array
          items: { $ref: '#/components/schemas/GuestInvite' }
    ApartmentUpgradeState:
      type: object
      properties:
        upgradeType: { type: string, enum: [ROOM, STORAGE, FUNCTIONAL] }
        level: { type: integer }
        completedAt: { type: string, format: date-time }
        activeConstruction:
          type: object
          properties:
            finishesAt: { type: string, format: date-time }
            workforceAssigned: { type: integer }
    ApartmentUpgradeRequest:
      type: object
      required: [upgradeType]
      properties:
        upgradeType: { type: string, enum: [ROOM, STORAGE, FUNCTIONAL] }
        targetLevel: { type: integer, minimum: 1 }
        paymentMethod: { type: string }
    LayoutPresetRequest:
      type: object
      required: [action]
      properties:
        action: { type: string, enum: [save, apply, delete] }
        preset: { $ref: '#/components/schemas/LayoutPresetPayload' }
    LayoutPresetResponse:
      type: object
      properties:
        layouts:
          type: array
          items: { $ref: '#/components/schemas/LayoutPreset' }
    LayoutPresetPayload:
      type: object
      required: [presetId, name, placements]
      properties:
        presetId: { type: string }
        name: { type: string }
        placements:
          type: array
          items: { $ref: '#/components/schemas/FurniturePlacement' }
    LayoutPreset:
      allOf:
        - $ref: '#/components/schemas/LayoutPresetPayload'
        - type: object
          properties:
            lastUpdated: { type: string, format: date-time }
    FurniturePlacementRequest:
      type: object
      required: [action, placements]
      properties:
        action: { type: string, enum: [place, move, remove] }
        placements:
          type: array
          items: { $ref: '#/components/schemas/FurniturePlacement' }
    FurniturePlacement:
      type: object
      required: [itemId, slotId]
      properties:
        itemId: { type: string }
        slotId: { type: string }
        position:
          type: object
          properties:
            x: { type: number }
            y: { type: number }
            z: { type: number }
        rotation:
          type: object
          properties:
            yaw: { type: number }
            pitch: { type: number }
            roll: { type: number }
        customizationOptions:
          type: object
          properties:
            color: { type: string }
            variant: { type: string }
    ApartmentLayoutState:
      type: object
      properties:
        appliedPresetId: { type: string }
        placements:
          type: array
          items: { $ref: '#/components/schemas/FurniturePlacement' }
    FurnitureCatalogResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/FurnitureItem' }
        pagination: { $ref: '../../shared/common/pagination.yaml#/components/schemas/PaginationMeta' }
    FurnitureItem:
      type: object
      required: [itemId, name, type, price]
      properties:
        itemId: { type: string }
        name: { type: string }
        type: { type: string, enum: [furniture, decor, functional] }
        rarity: { type: string, enum: [common, rare, epic, legendary] }
        price:
          type: object
          properties:
            amount: { type: integer }
            currency: { type: string }
        tags:
          type: array
          items: { type: string }
    FurniturePurchaseRequest:
      type: object
      required: [itemId]
      properties:
        itemId: { type: string }
        quantity: { type: integer, minimum: 1 }
        paymentMethod: { type: string }
    FurniturePurchaseResponse:
      type: object
      properties:
        itemId: { type: string }
        quantity: { type: integer }
        remainingCurrency: { type: integer }
    StorageStatus:
      type: object
      properties:
        capacity: { type: integer }
        usedSlots: { type: integer }
        upgrades:
          type: array
          items: { $ref: '#/components/schemas/StorageUpgrade' }
        storedItems:
          type: array
          items: { $ref: '#/components/schemas/StoredItem' }
    StorageUpgrade:
      type: object
      properties:
        level: { type: integer }
        bonusSlots: { type: integer }
        acquiredAt: { type: string, format: date-time }
    StoredItem:
      type: object
      required: [itemId, quantity]
      properties:
        itemId: { type: string }
        quantity: { type: integer }
        quality: { type: integer }
        source: { type: string }
    StorageTransferRequest:
      type: object
      required: [direction, items]
      properties:
        direction: { type: string, enum: [to_storage, to_inventory] }
        items:
          type: array
          items: { $ref: '#/components/schemas/StoredItem' }
    GuestInviteRequest:
      type: object
      required: [guestPlayerId, action]
      properties:
        guestPlayerId: { type: string }
        action: { type: string, enum: [invite, revoke, ban] }
        accessLevel: { type: string, enum: [visitor, decorator, cohost], default: visitor }
        expiresAt: { type: string, format: date-time }
    GuestInvite:
      type: object
      properties:
        guestPlayerId: { type: string }
        status: { type: string, enum: [PENDING, ACCEPTED, DECLINED, BANNED] }
        invitedAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time }
        accessLevel: { type: string }
    GuestListResponse:
      type: object
      properties:
        invites:
          type: array
          items: { $ref: '#/components/schemas/GuestInvite' }
        visitLog:
          type: array
          items: { $ref: '#/components/schemas/GuestLogEntry' }
    GuestLogEntry:
      type: object
      properties:
        playerId: { type: string }
        joinedAt: { type: string, format: date-time }
        leftAt: { type: string, format: date-time }
        actions:
          type: array
          items: { type: string }
    HousingEventRequest:
      type: object
      required: [eventType, startAt]
      properties:
        eventType: { type: string, enum: [party, trade_fair, raid_preparation] }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        maxParticipants: { type: integer }
        rewardsPreview:
          type: array
          items: { type: string }
    HousingEvent:
      type: object
      properties:
        eventId: { type: string }
        eventType: { type: string }
        apartmentId: { type: string }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        participants:
          type: array
          items: { type: string }
        rewards:
          type: array
          items: { type: string }
    HousingAnalyticsResponse:
      type: object
      properties:
        generatedAt: { type: string, format: date-time }
        range: { type: string }
        visitsPerDay: { type: number }
        popularLocations:
          type: array
          items:
            type: object
            properties:
              locationId: { type: string }
              visitShare: { type: number }
        topPrestigeApartments:
          type: array
          items:
            type: object
            properties:
              apartmentId: { type: string }
              prestige: { type: integer }
              ownerId: { type: string }
        dwellTime: { type: number }
        housingRevenue: { type: integer }
    SellApartmentRequest:
      type: object
      required: [mode]
      properties:
        mode: { type: string, enum: [npc_broker, market_listing] }
        price: { type: integer }
        includeFurniture: { type: boolean }
        buyerPlayerId: { type: string }
    SellApartmentResponse:
      type: object
      properties:
        apartmentId: { type: string }
        salePrice: { type: integer }
        taxesPaid: { type: integer }
        storageReturned:
          type: array
          items: { $ref: '#/components/schemas/StoredItem' }
    HousingError:
      type: object
      required: [code, message]
      properties:
        code: { type: string, enum: [APARTMENT_LIMIT_REACHED, INSUFFICIENT_FUNDS, INVALID_SLOT, INVITE_LIMIT, ITEM_NOT_OWNED, STORAGE_FULL] }
        message: { type: string }
        retryAfterSeconds: { type: integer }
servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
