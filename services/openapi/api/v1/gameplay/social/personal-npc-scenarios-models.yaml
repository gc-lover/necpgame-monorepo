openapi: 3.0.3
info:
  title: Personal NPC Scenario Models
  version: 1.0.0
components:
  schemas:
    ScenarioStep:
      type: object
      required: [id, order, type, action]
      properties:
        id:
          type: string
        order:
          type: integer
          minimum: 1
        type:
          type: string
          enum: [action, condition, loop, parallel]
        action:
          type: string
        parameters:
          type: object
          additionalProperties:
            type: object
        conditions:
          type: object
          additionalProperties:
            type: object
        onSuccess:
          type: string
        onFailure:
          type: string
        timeout:
          type: number
          format: float
    ScenarioReward:
      type: object
      properties:
        rewards:
          type: object
          additionalProperties:
            type: number
            format: float
        reputationChange:
          type: object
          additionalProperties:
            type: integer
        experienceGain:
          type: number
          format: float
    ScenarioCost:
      type: object
      properties:
        costs:
          type: object
          additionalProperties:
            type: number
            format: float
        riskLevel:
          type: string
          enum: [low, medium, high]
        insuranceRequired:
          type: boolean
    ScenarioBlueprintSummary:
      type: object
      required: [id, name, authorId, version, category, requiredRoles, isPublic, isVerified]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        authorId:
          type: string
          format: uuid
        version:
          type: string
        category:
          type: string
          enum: [economy, social, combat, logistics]
        requiredRoles:
          type: array
          items:
            type: string
        parameters:
          type: object
          additionalProperties:
            type: object
        isPublic:
          type: boolean
        isVerified:
          type: boolean
        price:
          type: number
          format: float
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    ScenarioBlueprintDetail:
      type: object
      required: [summary, steps, conditions]
      properties:
        summary:
          $ref: '#/components/schemas/ScenarioBlueprintSummary'
        steps:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioStep'
        conditions:
          type: object
          additionalProperties:
            type: object
        rewards:
          $ref: '#/components/schemas/ScenarioReward'
        costs:
          $ref: '#/components/schemas/ScenarioCost'
        automationHints:
          type: array
          items:
            type: string
        verificationNotes:
          type: string
    ScenarioBlueprintListResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioBlueprintSummary'
        meta:
          $ref: '../../shared/common/pagination.yaml#/components/schemas/PaginationMeta'
    ScenarioBlueprintDetailResponse:
      type: object
      required: [data]
      properties:
        data:
          $ref: '#/components/schemas/ScenarioBlueprintDetail'
    ScenarioBlueprintCreateRequest:
      type: object
      required: [name, description, authorId, category, requiredRoles, steps]
      properties:
        name:
          type: string
        description:
          type: string
        authorId:
          type: string
          format: uuid
        category:
          type: string
          enum: [economy, social, combat, logistics]
        requiredRoles:
          type: array
          items:
            type: string
        version:
          type: string
        parameters:
          type: object
          additionalProperties:
            type: object
        conditions:
          type: object
          additionalProperties:
            type: object
        steps:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/ScenarioStep'
        rewards:
          $ref: '#/components/schemas/ScenarioReward'
        costs:
          $ref: '#/components/schemas/ScenarioCost'
        isPublic:
          type: boolean
        price:
          type: number
          format: float
    ScenarioBlueprintUpdateRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        version:
          type: string
        requiredRoles:
          type: array
          items:
            type: string
        parameters:
          type: object
          additionalProperties:
            type: object
        conditions:
          type: object
          additionalProperties:
            type: object
        steps:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioStep'
        rewards:
          $ref: '#/components/schemas/ScenarioReward'
        costs:
          $ref: '#/components/schemas/ScenarioCost'
        price:
          type: number
          format: float
        isPublic:
          type: boolean
        isVerified:
          type: boolean
    ScenarioBlueprintPublishRequest:
      type: object
      required: [publish]
      properties:
        publish:
          type: boolean
        price:
          type: number
          format: float
        visibilityScope:
          type: string
          enum: [private, faction, marketplace]
    ExecuteScenarioRequest:
      type: object
      required: [blueprintId]
      properties:
        blueprintId:
          type: string
          format: uuid
        parameters:
          type: object
          additionalProperties:
            type: object
        scheduledAt:
          type: string
          format: date-time
        priority:
          type: integer
          minimum: 1
          maximum: 10
        automationRuleId:
          type: string
    ScenarioKPI:
      type: object
      required: [successRate, efficiency]
      properties:
        successRate:
          type: number
          format: float
          minimum: 0
          maximum: 100
        efficiency:
          type: number
          format: float
          minimum: 0
          maximum: 200
        timeToComplete:
          type: number
          format: float
        resourcesUsed:
          type: object
          additionalProperties:
            type: number
            format: float
        rewardsEarned:
          type: object
          additionalProperties:
            type: number
            format: float
        costsIncurred:
          type: object
          additionalProperties:
            type: number
            format: float
        issues:
          type: array
          items:
            type: string
    ScenarioInstance:
      type: object
      required: [id, blueprintId, npcId, ownerId, status, kpi]
      properties:
        id:
          type: string
          format: uuid
        blueprintId:
          type: string
          format: uuid
        npcId:
          type: string
          format: uuid
        ownerId:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, running, paused, completed, failed, cancelled]
        currentStep:
          type: integer
          minimum: 0
        parameters:
          type: object
          additionalProperties:
            type: object
        kpi:
          $ref: '#/components/schemas/ScenarioKPI'
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        scheduledAt:
          type: string
          format: date-time
        duration:
          type: number
          format: float
        result:
          type: object
          additionalProperties:
            type: object
    ScenarioInstanceListResponse:
      type: object
      required: [data, meta]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ScenarioInstance'
        meta:
          $ref: '../../shared/common/pagination.yaml#/components/schemas/PaginationMeta'
    ScenarioExecutionResponse:
      type: object
      required: [instanceId, status]
      properties:
        instanceId:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, scheduled, running]
        scheduledAt:
          type: string
          format: date-time
        queuePosition:
          type: integer
          minimum: 0

