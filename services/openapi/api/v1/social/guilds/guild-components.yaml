openapi: 3.0.3
info:
  title: Guild Components
  version: 1.0.0
  x-microservice:
    name: social-service
    port: 8084
    domain: social
    base-path: /api/v1/social
    package: com.necpgame.socialservice
paths: {}
components:
  parameters:
    GuildId:
      name: guildId
      in: path
      required: true
      description: Идентификатор гильдии
      schema: { type: string }
    MemberId:
      name: memberId
      in: path
      required: true
      description: Участник гильдии
      schema: { type: string }
    ApplicationId:
      name: applicationId
      in: path
      required: true
      description: Идентификатор заявки
      schema: { type: string }
    EventId:
      name: eventId
      in: path
      required: true
      description: Идентификатор гильдейского события
      schema: { type: string }
  schemas:
    GuildCreateRequest:
      type: object
      required: [name, tag, shard]
      properties:
        name: { type: string, minLength: 3, maxLength: 32 }
        tag: { type: string, minLength: 2, maxLength: 5 }
        description: { type: string, maxLength: 512 }
        language: { type: string }
        shard: { type: string }
        policy: { type: string, enum: [open, invite_only, application] }
        emblemId: { type: string }
        playstyle: { type: string }
    GuildSummary:
      type: object
      properties:
        guildId: { type: string }
        name: { type: string }
        tag: { type: string }
        level: { type: integer }
        members: { type: integer }
        shard: { type: string }
        emblemUrl: { type: string, format: uri }
    GuildDetail:
      type: object
      properties:
        guildId: { type: string }
        name: { type: string }
        tag: { type: string }
        description: { type: string }
        language: { type: string }
        policy: { type: string }
        playstyle: { type: string }
        level: { type: integer }
        xp: { type: integer }
        perksUnlocked:
          type: array
          items: { type: string }
        shard: { type: string }
        createdAt: { type: string, format: date-time }
        emblemUrl: { type: string, format: uri }
        officers:
          type: array
          items: { type: string }
    GuildUpdateRequest:
      type: object
      properties:
        description: { type: string }
        language: { type: string }
        policy: { type: string, enum: [open, invite_only, application] }
        playstyle: { type: string }
        emblemId: { type: string }
        rules: { type: string }
    GuildDisbandRequest:
      type: object
      required: [confirm]
      properties:
        confirm: { type: boolean }
        reason: { type: string }
    GuildSearchResponse:
      type: object
      properties:
        results:
          type: array
          items: { $ref: '#/components/schemas/GuildSummary' }
        pagination: { $ref: '../../shared/common/pagination.yaml#/components/schemas/PaginationMeta' }
    GuildMembersResponse:
      type: object
      properties:
        guildId: { type: string }
        members:
          type: array
          items: { $ref: '#/components/schemas/GuildMember' }
    GuildMember:
      type: object
      properties:
        memberId: { type: string }
        playerId: { type: string }
        displayName: { type: string }
        rankId: { type: string }
        role: { type: string }
        joinDate: { type: string, format: date-time }
        contribution: { type: integer }
        status: { type: string, enum: [active, vacation, suspended] }
        lastOnline: { type: string, format: date-time }
    GuildMemberAddRequest:
      type: object
      properties:
        playerId: { type: string }
        inviteNote: { type: string }
        source: { type: string, enum: [invite, application] }
    GuildMemberUpdateRequest:
      type: object
      properties:
        rankId: { type: string }
        role: { type: string }
        notes: { type: string }
        status: { type: string }
    GuildApplicationsResponse:
      type: object
      properties:
        applications:
          type: array
          items: { $ref: '#/components/schemas/GuildApplication' }
    GuildApplication:
      type: object
      properties:
        applicationId: { type: string }
        applicant: { type: string }
        message: { type: string }
        status: { type: string, enum: [pending, accepted, declined] }
        submittedAt: { type: string, format: date-time }
        decisionAt: { type: string, format: date-time }
    GuildApplicationRequest:
      type: object
      required: [guildId]
      properties:
        guildId: { type: string }
        message: { type: string, maxLength: 256 }
    GuildApplicationDecisionRequest:
      type: object
      required: [decision]
      properties:
        decision: { type: string, enum: [approve, decline] }
        note: { type: string }
    GuildRanksResponse:
      type: object
      properties:
        ranks:
          type: array
          items: { $ref: '#/components/schemas/GuildRank' }
    GuildRank:
      type: object
      required: [rankId, name, priority]
      properties:
        rankId: { type: string }
        name: { type: string }
        priority: { type: integer }
        permissions:
          type: array
          items: { $ref: '#/components/schemas/GuildPermission' }
        limits:
          type: object
          properties:
            withdrawLimit: { type: integer }
            inviteLimit: { type: integer }
    GuildPermission:
      type: object
      properties:
        permission: { type: string }
        description: { type: string }
    GuildRankUpdateRequest:
      type: object
      required: [ranks]
      properties:
        ranks:
          type: array
          items: { $ref: '#/components/schemas/GuildRank' }
    GuildBankResponse:
      type: object
      properties:
        balance: { type: integer }
        currency: { type: string }
        softCap: { type: integer }
        hardCap: { type: integer }
        withdrawalPolicy: { type: string }
        transactions:
          type: array
          items: { $ref: '#/components/schemas/GuildBankTransaction' }
    GuildBankTransaction:
      type: object
      properties:
        transactionId: { type: string }
        type: { type: string, enum: [deposit, withdraw, purchase] }
        amount: { type: integer }
        itemId: { type: string }
        initiatorId: { type: string }
        approvedBy: { type: string }
        status: { type: string, enum: [pending, approved, rejected] }
        timestamp: { type: string, format: date-time }
        notes: { type: string }
    GuildBankTransactionRequest:
      type: object
      required: [type]
      properties:
        type: { type: string, enum: [deposit, withdraw] }
        amount: { type: integer }
        itemId: { type: string }
        memo: { type: string }
    GuildProgression:
      type: object
      properties:
        level: { type: integer }
        xp: { type: integer }
        nextLevelXp: { type: integer }
        perksUnlocked:
          type: array
          items: { type: string }
        research:
          type: array
          items: { type: string }
    GuildPerkUnlockRequest:
      type: object
      required: [perkId]
      properties:
        perkId: { type: string }
        useBankCurrency: { type: boolean }
    GuildEventsResponse:
      type: object
      properties:
        events:
          type: array
          items: { $ref: '#/components/schemas/GuildEvent' }
    GuildEvent:
      type: object
      properties:
        eventId: { type: string }
        title: { type: string }
        type: { type: string, enum: [raid, meeting, training, social] }
        schedule: { type: string, format: date-time }
        location: { type: string }
        maxParticipants: { type: integer }
        attendance:
          type: array
          items: { $ref: '#/components/schemas/GuildAttendance' }
    GuildEventCreateRequest:
      type: object
      required: [title, type, schedule]
      properties:
        title: { type: string }
        type: { type: string }
        schedule: { type: string, format: date-time }
        location: { type: string }
        maxParticipants: { type: integer }
        description: { type: string }
    GuildAttendanceRequest:
      type: object
      required: [status]
      properties:
        status: { type: string, enum: [confirmed, tentative, declined] }
        note: { type: string }
    GuildAttendance:
      type: object
      properties:
        memberId: { type: string }
        status: { type: string }
        updatedAt: { type: string, format: date-time }
    GuildWarStatusResponse:
      type: object
      properties:
        wars:
          type: array
          items: { $ref: '#/components/schemas/GuildWarStatus' }
        alliances:
          type: array
          items: { $ref: '#/components/schemas/AllianceInfo' }
    GuildWarStatus:
      type: object
      properties:
        warId: { type: string }
        opponentGuildId: { type: string }
        phase: { type: string }
        score: { type: integer }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
    AllianceRequest:
      type: object
      required: [allyGuildId]
      properties:
        allyGuildId: { type: string }
        terms: { type: string }
    AllianceInfo:
      type: object
      properties:
        allianceId: { type: string }
        allyGuildId: { type: string }
        status: { type: string, enum: [pending, active, revoked] }
        createdAt: { type: string, format: date-time }
    GuildAuditResponse:
      type: object
      properties:
        entries:
          type: array
          items: { $ref: '#/components/schemas/GuildAuditEntry' }
    GuildAuditEntry:
      type: object
      properties:
        entryId: { type: string }
        actorId: { type: string }
        action: { type: string }
        payload: { type: object, additionalProperties: true }
        createdAt: { type: string, format: date-time }
    GuildMemberEvent:
      type: object
      properties:
        guildId: { type: string }
        member: { $ref: '#/components/schemas/GuildMember' }
        action: { type: string, enum: [joined, left, rankChanged] }
    GuildBankEvent:
      type: object
      properties:
        guildId: { type: string }
        transaction: { $ref: '#/components/schemas/GuildBankTransaction' }
    GuildBank:
      type: object
      properties:
        balance: { type: integer }
        currency: { type: string }
    GuildError:
      type: object
      required: [code, message]
      properties:
        code: { type: string, enum: [NAME_TAKEN, LIMIT_REACHED, PERMISSION_DENIED, BANK_LIMIT, APPLICATION_DUPLICATE, WAR_LOCK, ALLY_CONFLICT] }
        message: { type: string }
        traceId: { type: string }
servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
