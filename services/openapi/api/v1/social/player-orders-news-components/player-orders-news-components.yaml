openapi: 3.0.3
info:
  title: Player Orders News Components
  version: 1.0.0
  x-microservice:
    name: social-service
    port: 8084
    domain: social
    base-path: /api/v1/social
    package: com.necpgame.socialservice
paths: {}
components:
  parameters:
    NewsId:
      name: newsId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Идентификатор новости о заказе.
    SubscriptionId:
      name: subscriptionId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Идентификатор подписки на новости.
    CityFilter:
      name: cityId
      in: query
      schema:
        type: string
        format: uuid
      description: Фильтр по идентификатору города.
    TagFilter:
      name: tag
      in: query
      schema:
        type: string
        maxLength: 64
      description: Фильтр по тегу новости.
    SeverityFilter:
      name: severity
      in: query
      schema:
        type: string
        enum: [info, caution, warning, critical]
      description: Фильтр по уровню серьёзности события.
    OrderFilter:
      name: orderId
      in: query
      schema:
        type: string
        format: uuid
      description: Фильтр по связанному заказу.
    TemplateFilter:
      name: template
      in: query
      schema:
        type: string
        enum: [combat, hacker, economy, social, exploration]
      description: Фильтр по шаблону заказа.
    PeriodFilter:
      name: period
      in: query
      schema:
        type: string
        pattern: '^P(?!$).+'
      description: Период в ISO 8601 (например, P7D) для агрегированной выдачи.
    LanguageFilter:
      name: language
      in: query
      schema:
        type: string
        pattern: '^[a-zA-Z]{2,3}(-[a-zA-Z]{2})?$'
      description: Предпочитаемый язык новости (BCP-47).
    SinceFilter:
      name: since
      in: query
      schema:
        type: string
        format: date-time
      description: Возвращать новости, опубликованные после указанного времени.
  schemas:
    PlayerOrderNewsTag:
      type: object
      required: [tagId, label]
      properties:
        tagId:
          type: string
        label:
          type: string
        category:
          type: string
          enum: [order, crisis, economy, reputation, community, tournament, other]
    PlayerOrderNewsAttachment:
      type: object
      properties:
        attachmentId:
          type: string
          format: uuid
        type:
          type: string
          enum: [image, video, audio, document, map]
        url:
          type: string
          format: uri
        caption:
          type: string
    PlayerOrderNewsItem:
      type: object
      required:
        - newsId
        - title
        - summary
        - severity
        - publishedAt
        - tags
      properties:
        newsId:
          type: string
          format: uuid
        title:
          type: string
        summary:
          type: string
        body:
          type: string
        severity:
          type: string
          enum: [info, caution, warning, critical]
        orderIds:
          type: array
          items:
            type: string
            format: uuid
        cityIds:
          type: array
          items:
            type: string
            format: uuid
        factionIds:
          type: array
          items:
            type: string
            format: uuid
        tags:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsTag'
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsAttachment'
        metrics:
          type: object
          properties:
            engagementScore:
              type: number
              minimum: 0
            reads:
              type: integer
              minimum: 0
            shares:
              type: integer
              minimum: 0
        source:
          type: string
          enum: [system, moderator, economy-service, world-service, player]
        language:
          type: string
        publishedAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
        relatedEffects:
          type: array
          items:
            type: string
            format: uuid
        relatedIndexes:
          type: array
          items:
            type: string
        priority:
          type: integer
          minimum: 0
          maximum: 100
    PlayerOrderNewsList:
      type: object
      required: [data, pagination]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsItem'
        pagination:
          $ref: '../../shared/common/pagination.yaml#/components/schemas/PaginationMeta'
    PlayerOrderNewsHighlight:
      type: object
      required: [highlightId, title, type, publishedAt]
      properties:
        highlightId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [spotlight, crisis, tournament, milestone, promotional]
        media:
          $ref: '#/components/schemas/PlayerOrderNewsAttachment'
        cta:
          type: object
          properties:
            label:
              type: string
            url:
              type: string
              format: uri
        score:
          type: number
        tags:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsTag'
        publishedAt:
          type: string
          format: date-time
    PlayerOrderNewsHighlightList:
      type: object
      required: [data]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsHighlight'
    PlayerOrderNewsPublishRequest:
      type: object
      required:
        - title
        - summary
        - severity
        - tags
      properties:
        title:
          type: string
          minLength: 8
        summary:
          type: string
          minLength: 16
        body:
          type: string
        severity:
          type: string
          enum: [info, caution, warning, critical]
        orderIds:
          type: array
          items:
            type: string
            format: uuid
        cityIds:
          type: array
          items:
            type: string
            format: uuid
        tags:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/PlayerOrderNewsTag'
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsAttachment'
        language:
          type: string
          pattern: '^[a-zA-Z]{2,3}(-[a-zA-Z]{2})?$'
        visibility:
          type: string
          enum: [public, faction, private]
        scheduledAt:
          type: string
          format: date-time
    PlayerOrderNewsSubscriptionRequest:
      type: object
      required: [channel]
      properties:
        channel:
          type: string
          enum: [push, email, webhook, in_game]
        cityIds:
          type: array
          items:
            type: string
            format: uuid
        tags:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsTag'
        severity:
          type: array
          items:
            type: string
            enum: [info, caution, warning, critical]
        language:
          type: string
        deliveryWindow:
          type: string
          pattern: '^([01]\\d|2[0-3]):[0-5]\\d-([01]\\d|2[0-3]):[0-5]\\d$'
        webhookUrl:
          type: string
          format: uri
        muteUntil:
          type: string
          format: date-time
    PlayerOrderNewsSubscription:
      type: object
      required:
        - subscriptionId
        - channel
        - createdAt
      properties:
        subscriptionId:
          type: string
          format: uuid
        channel:
          type: string
          enum: [push, email, webhook, in_game]
        filters:
          type: object
          properties:
            cityIds:
              type: array
              items:
                type: string
                format: uuid
            tags:
              type: array
              items:
                $ref: '#/components/schemas/PlayerOrderNewsTag'
            severity:
              type: array
              items:
                type: string
                enum: [info, caution, warning, critical]
            language:
              type: string
        webhookUrl:
          type: string
          format: uri
        deliveryWindow:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [active, paused, muted, cancelled]
    PlayerOrderNewsSubscriptionList:
      type: object
      required: [data]
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/PlayerOrderNewsSubscription'
    PlayerOrderNewsAlert:
      type: object
      required:
        - alertId
        - type
        - severity
        - description
        - createdAt
      properties:
        alertId:
          type: string
        type:
          type: string
          enum: [crisis, surge, milestone, economy, reputation]
        severity:
          type: string
          enum: [info, caution, warning, critical]
        description:
          type: string
        actions:
          type: array
          items:
            type: string
        cityIds:
          type: array
          items:
            type: string
            format: uuid
        orderIds:
          type: array
          items:
            type: string
            format: uuid
        createdAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
    PlayerOrderNewsEvent:
      type: object
      required: [eventId, eventType, payload, createdAt]
      properties:
        eventId:
          type: string
        eventType:
          type: string
          enum: [news_published, news_updated, news_deleted]
        payload:
          $ref: '#/components/schemas/PlayerOrderNewsItem'
        createdAt:
          type: string
          format: date-time

servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
