openapi: 3.0.3
info:
  title: Player Order Ratings Examples
  version: 1.0.0
  description: Примеры запросов и ответов для API рейтингов, отзывов и санкций.
  x-microservice:
    name: social-service
    port: 8084
    domain: social
    base-path: /api/v1/social
    package: com.necpgame.socialservice
paths: {}
components:
  examples:
    PlayerRatingGoldExample:
      summary: Рейтинг исполнителя категории Gold
      value:
        playerId: "7fb0f6c8-93a0-4e9b-94dc-6a3fa0b2c1c2"
        role: executor
        score: 78.4
        category: gold
        decayApplied: 6.2
        warnings:
          - code: decay_high
            severity: warning
            messageKey: ratings.warning.decay_high
            defaultMessage: "Рейтинг снизился из-за продолжительной неактивности."
            suggestedAction: "Выполните 3 заказа с высоким рейтингом в течение недели."
        trend:
          window: 30d
          points:
            - timestamp: "2025-10-10T12:00:00Z"
              score: 82.1
              delta: 0.5
              category: gold
            - timestamp: "2025-10-17T12:00:00Z"
              score: 80.3
              delta: -1.8
              category: gold
            - timestamp: "2025-10-24T12:00:00Z"
              score: 78.4
              delta: -1.9
              category: gold
        metrics:
          executor:
            weights:
              completion_rate: 0.3
              timeliness: 0.2
              quality: 0.25
              reliability: 0.15
              complexity_bonus: 0.1
            values:
              - code: completion_rate
                label: "Completion Rate"
                normalizedValue: 92.0
                weightedContribution: 0.276
                sampleSize: 142
              - code: timeliness
                label: "Timeliness"
                normalizedValue: 74.0
                weightedContribution: 0.148
                sampleSize: 142
              - code: quality
                label: "Quality"
                normalizedValue: 81.0
                weightedContribution: 0.203
                sampleSize: 128
        seasonStats:
          seasonId: "2077-Q4"
          matchesCompleted: 45
          disputesOpened: 2
          disputesLost: 0
          perfectOrders: 12
          awards: ["top_executor_october"]
        updatedAt: "2025-11-08T15:45:21Z"
    RatingRecalculateRequestExample:
      summary: Запуск batch-пересчёта рейтингов
      value:
        playerIds:
          - "7fb0f6c8-93a0-4e9b-94dc-6a3fa0b2c1c2"
          - "2fa9bd27-bf54-479b-b5ed-ef30cd7a1c8d"
          - "a7f34d8e-13ac-4de8-9a8d-cd5b1a4dfd81"
        role: executor
        reason: anomaly_detected
        requestedBy: "6c0ec9a1-9a88-4d50-8eca-34d2a6dfe8cf"
        notifyPlayers: true
    RatingRecalculateJobExample:
      summary: Статус задачи пересчёта
      value:
        jobId: "1b6a75b4-47ef-4c95-9e1d-a97ec8e90b3f"
        status: completed
        role: executor
        processedCount: 3
        failedCount: 0
        createdAt: "2025-11-08T15:40:00Z"
        startedAt: "2025-11-08T15:40:03Z"
        finishedAt: "2025-11-08T15:41:12Z"
        requestedBy: "6c0ec9a1-9a88-4d50-8eca-34d2a6dfe8cf"
    RatingListResponseExample:
      summary: Список рейтингов с фильтрами
      value:
        data:
          - playerId: "7fb0f6c8-93a0-4e9b-94dc-6a3fa0b2c1c2"
            role: executor
            score: 78.4
            category: gold
            trendDelta: -1.9
            warnings:
              - code: decay_high
                severity: warning
                messageKey: ratings.warning.decay_high
            updatedAt: "2025-11-08T15:45:21Z"
          - playerId: "2fa9bd27-bf54-479b-b5ed-ef30cd7a1c8d"
            role: client
            score: 66.2
            category: gold
            trendDelta: 2.4
            warnings: []
            updatedAt: "2025-11-08T16:10:03Z"
        pagination:
          page: 1
          pageSize: 20
          total: 2
          totalPages: 1
    ReviewCreateRequestExample:
      summary: Создание отзыва
      value:
        orderId: "3d5bfb02-6a27-4c9a-9747-6d1e0fb2c912"
        reviewerId: "7fb0f6c8-93a0-4e9b-94dc-6a3fa0b2c1c2"
        targetId: "2fa9bd27-bf54-479b-b5ed-ef30cd7a1c8d"
        role: client
        ratings:
          quality: 5
          communication: 4
          professionalism: 5
          fairness: 4
        text: >
          Работа выполнена качественно, команда соблюдала тайминг и активно
          коммуницировала. Рекомендую к сотрудничеству.
        tags: ["stealth", "teamplay"]
        visibility: public
        locale: "ru-RU"
        attachments:
          - "https://cdn.necpgame.com/orders/3d5bfb02/proof-1.png"
    ReviewResponseExample:
      summary: Одобренный отзыв
      value:
        reviewId: "6ab5d3d2-53a8-4f68-8a9d-793b1a3f506d"
        orderId: "3d5bfb02-6a27-4c9a-9747-6d1e0fb2c912"
        reviewerId: "7fb0f6c8-93a0-4e9b-94dc-6a3fa0b2c1c2"
        targetId: "2fa9bd27-bf54-479b-b5ed-ef30cd7a1c8d"
        role: client
        ratings:
          quality: 5
          communication: 4
          professionalism: 5
          fairness: 4
        text: "Команда выполнила заказ качественно и без задержек."
        flags: ["positive"]
        moderation:
          status: approved
          toxicityScore: 0.03
          reviewedBy: "a1ef2e4d-22ed-4d78-bd0e-b54ce76b4468"
          reviewedAt: "2025-11-08T16:01:22Z"
        sentimentScore: 0.82
        locale: "ru-RU"
        attachments:
          - "https://cdn.necpgame.com/orders/3d5bfb02/proof-1.png"
        createdAt: "2025-11-08T16:00:00Z"
        updatedAt: "2025-11-08T16:01:22Z"
    ReviewListResponseExample:
      summary: Список отзывов по заказу
      value:
        data:
          - reviewId: "6ab5d3d2-53a8-4f68-8a9d-793b1a3f506d"
            orderId: "3d5bfb02-6a27-4c9a-9747-6d1e0fb2c912"
            reviewerId: "7fb0f6c8-93a0-4e9b-94dc-6a3fa0b2c1c2"
            targetId: "2fa9bd27-bf54-479b-b5ed-ef30cd7a1c8d"
            role: client
            ratings:
              quality: 5
              communication: 4
              professionalism: 5
              fairness: 4
            text: "Команда выполнила заказ качественно и без задержек."
            flags: ["positive"]
            moderation:
              status: approved
              toxicityScore: 0.03
            sentimentScore: 0.82
            locale: "ru-RU"
            attachments:
              - "https://cdn.necpgame.com/orders/3d5bfb02/proof-1.png"
            createdAt: "2025-11-08T16:00:00Z"
            updatedAt: "2025-11-08T16:01:22Z"
        pagination:
          page: 1
          pageSize: 20
          total: 1
          totalPages: 1
    ReviewSubmissionResponseExample:
      summary: Ответ при создании отзыва
      value:
        reviewId: "6ab5d3d2-53a8-4f68-8a9d-793b1a3f506d"
        status: pending_moderation
        moderation:
          status: pending
          toxicityScore: 0.18
    PenaltyRequestExample:
      summary: Применение штрафа за просроченную оплату
      value:
        playerId: "2fa9bd27-bf54-479b-b5ed-ef30cd7a1c8d"
        role: client
        penaltyType: late_payment
        delta: -12
        reason: "Оплата заказа #3d5bfb02 задержана более чем на 48 часов после завершения."
        appliedBy: "9a41c88b-03eb-4c2d-88c0-31f3eb0a6c1f"
        linkedOrderId: "3d5bfb02-6a27-4c9a-9747-6d1e0fb2c912"
        notifyPlayer: true
    CategoryConfigExample:
      summary: Конфигурация категорий рейтинга
      value:
        data:
          - category: bronze
            minScore: 0
            maxScore: 39.9
            decayRate: 1.5
            benefits:
              commissionDiscount: 0.0
              escrowBonus: 0.0
              inviteQuota: 2
              exclusiveContracts: false
              matchmakingBoost: false
          - category: silver
            minScore: 40
            maxScore: 64.9
            decayRate: 1.0
            benefits:
              commissionDiscount: 0.02
              escrowBonus: 0.05
              inviteQuota: 4
              exclusiveContracts: false
              matchmakingBoost: true
          - category: gold
            minScore: 65
            maxScore: 84.9
            decayRate: 0.7
            benefits:
              commissionDiscount: 0.04
              escrowBonus: 0.1
              inviteQuota: 8
              exclusiveContracts: true
              matchmakingBoost: true
          - category: platinum
            minScore: 85
            maxScore: 100
            decayRate: 0.5
            benefits:
              commissionDiscount: 0.06
              escrowBonus: 0.15
              inviteQuota: 12
              exclusiveContracts: true
              matchmakingBoost: true
        version: "2077.Q4"
        updatedAt: "2025-11-08T12:00:00Z"
        decayDefaults:
          inactivityGraceDays: 14
          minimumFloor: 20

servers:
  - url: https://api.necp.game/v1
    description: Production API Gateway
  - url: http://localhost:8080/api/v1
    description: Local API Gateway
