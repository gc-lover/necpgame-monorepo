# Task ID: API-TASK-311
**–¢–∏–ø:** API Generation  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –≤—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** queued  
**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-08 09:26  
**–°–æ–∑–¥–∞—Ç–µ–ª—å:** AI Task Creator Agent  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** none

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é `dialogue-audit` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏—Ç–æ–º –¥–∏–∞–ª–æ–≥–æ–≤: –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å NPC/–∫–≤–µ—Å—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤, –≤—ã—è–≤–ª—è—Ç—å –ø—Ä–æ–±–µ–ª—ã –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –º–∏—Ä–∞.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:** –æ–ø–∏—Å–∞—Ç—å API –≤ `api/v1/narrative/dialogues/dialogue-audit.yaml`, –æ–±–µ—Å–ø–µ—á–∏–≤ –ø–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏—Ç–æ—Ä—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤, —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –∞—É–¥–∏—Ç–∞ –≤ narrative-service.

---

## üéØ –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å API-—Å–ª–æ–π –¥–ª—è Narrative Operations, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç:
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ (NPC –∏ –∫–≤–µ—Å—Ç–æ–≤—ã–µ –≤–µ—Ç–∫–∏);
- —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã (–Ω–µ—Ç —Ñ–∞–π–ª–æ–≤, –Ω–µ—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏–π, –Ω–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ñ–ª–∞–≥–∞–º);
- —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã (`DIALOGUE-TEMPLATE`), —Å–æ—Å—Ç–æ—è–Ω–∏—è `quest_skill_hooks` –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã;
- –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏/–Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞;
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –±—ç–∫–µ–Ω–¥—É –º–µ—Ö–∞–Ω–∏–∑–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞—É–¥–∏—Ç–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤.

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**
- Narrative-–∫–æ–º–∞–Ω–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –ø–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥–æ–≤.
- Gameplay –∏ World —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤–µ—Ç–æ–∫ –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
- QA –∏ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä—ã –≤–∏–¥—è—Ç –ø—Ä–æ–±–µ–ª—ã –∏ –∏—Å—Ç–æ—Ä–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä–∞–Ω–µ–µ —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–∞—è ¬´–ø–µ—Ä–≤–∞—è –≤–æ–ª–Ω–∞¬ª NPC (13 —Ñ–∞–π–ª–æ–≤) –∏ –∫–≤–µ—Å—Ç–æ–≤—ã—Ö –∞—Ä–æ–∫ –∏–∑ –∞—É–¥–∏—Ç–∞.

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `.BRAIN`  
**–ü—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É:** `.BRAIN/06-tasks/active/CURRENT-WORK/active/2025-11-07-dialogue-audit.md`  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-07 18:05  
**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** approved  

**–ß—Ç–æ –≤–∞–∂–Ω–æ –∏–∑ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
- –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (NPC, –∫–≤–µ—Å—Ç—ã, —à–∞–±–ª–æ–Ω—ã, —Ñ–æ—Ä–º—É–ª—ã), –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–∂–∞—Ç—å—Å—è –≤ –∞—É–¥–∏—Ç–µ.
- –ü—Ä–æ–±–µ–ª—ã: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
- –ü–µ—Ä–≤–∞—è –≤–æ–ª–Ω–∞ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è (13 NPC, 4 –∫–≤–µ—Å—Ç–æ–≤—ã–µ –∞—Ä–∫–∏) ‚Äî –Ω—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ API.
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å —Ñ–ª–∞–≥–∞–º–∏, —Ä–µ–ø—É—Ç–∞—Ü–∏—è–º–∏ –∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –º–∏—Ä–∞.

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

- `.BRAIN/03-lore/characters/characters-overview.md` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ NPC –∏ —Ä–æ–ª–∏.
- `.BRAIN/04-narrative/dialogues/DIALOGUE-TEMPLATE.md` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤.
- `.BRAIN/04-narrative/dialogues/npc-hiroshi-tanaka.md`, `npc-aisha-frost.md` ‚Äî –ø—Ä–∏–º–µ—Ä—ã –≥–æ—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤.
- `.BRAIN/04-narrative/quest-system.md` ‚Äî —Ç–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–æ–∫/—Ñ–ª–∞–≥–æ–≤ (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ shooter skill hooks).
- `.BRAIN/02-gameplay/social/reputation-formulas.md` ‚Äî –±–ª–∏–∂–∞–π—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π.

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- API –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö NPC (`API-TASK-284` ‚Ä¶ `API-TASK-292`) –∏ –∫–≤–µ—Å—Ç–æ–≤—ã–µ –≤–µ—Ç–∫–∏ (`API-TASK-294`, `API-TASK-295`) ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.
- `API-SWAGGER/api/v1/narrative/dialogues/` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ NPC) ‚Äî —Å–æ–±–ª—é–¥–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—Ö–µ–º.

---

## üìÅ –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API

### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `API-SWAGGER`

**–¶–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª:** `api/v1/narrative/dialogues/dialogue-audit.yaml`  
**API –≤–µ—Ä—Å–∏—è:** v1  
**–¢–∏–ø —Ñ–∞–π–ª–∞:** OpenAPI 3.0.3 (YAML)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
```
API-SWAGGER/
‚îî‚îÄ‚îÄ api/
    ‚îî‚îÄ‚îÄ v1/
        ‚îî‚îÄ‚îÄ narrative/
            ‚îî‚îÄ‚îÄ dialogues/
                ‚îú‚îÄ‚îÄ npc-*.yaml          # —Ç–µ–∫—É—â–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ NPC
                ‚îî‚îÄ‚îÄ dialogue-audit.yaml ‚Üê —Å–æ–∑–¥–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

**–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞:** –Ω–æ–≤—ã–π —Ñ–∞–π–ª (—Å–æ–∑–¥–∞—Ç—å).

---

## üèóÔ∏è –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

### Backend (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å:** narrative-service  
- **–ü–æ—Ä—Ç:** 8087  
- **API Base Path:** `/api/v1/narrative/dialogues/*`  
- **–î–æ–º–µ–Ω:** narrative ‚Üí dialogues ‚Üí audit  
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** `gameplay-service` (—Ñ–ª–∞–≥–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏), `world-service` (–º–∏—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è), `social-service` (—Ä–µ–ø—É—Ç–∞—Ü–∏–∏).

### Frontend (–º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- **–ú–æ–¥—É–ª—å:** `modules/narrative/dialogue-audit`  
- **State Store:** `useNarrativeStore` (—Ä–∞–∑–¥–µ–ª `dialogueAudit`)  
- **UI (@shared/ui):** `DataGrid`, `StatusPill`, `Badge`, `Timeline`, `Tooltip`  
- **Forms (@shared/forms):** `FilterForm`, `DateRangeForm`, `StateToggleForm`  
- **Layouts (@shared/layouts):** `GameLayout`, `OperationsSplitView`  
- **Hooks (@shared/hooks):** `useRealtime`, `useDebounce`, `useFeatureFlags`

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è API —Ñ–∞–π–ª–∞
–í –Ω–∞—á–∞–ª–µ `dialogue-audit.yaml` –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π c –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:
```
# Target Architecture:
# - Microservice: narrative-service (port 8087)
# - Frontend Module: modules/narrative/dialogue-audit
# - State: useNarrativeStore(dialogueAudit)
# - UI: @shared/ui (DataGrid, StatusPill, Badge, Timeline, Tooltip)
# - Forms: @shared/forms (FilterForm, DateRangeForm, StateToggleForm)
# - Related Services: gameplay-service, world-service, social-service
# - API Base: /api/v1/narrative/dialogues/*
```

---

## ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω)

1. **–†–∞–∑–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤** ‚Äî –∏–∑–≤–ª–µ—á—å –∏–∑ –∞—É–¥–∏—Ç–∞ –ø–µ—Ä–µ—á–µ–Ω—å —Å—É—â–Ω–æ—Å—Ç–µ–π (NPC, –∫–≤–µ—Å—Ç—ã, —à–∞–±–ª–æ–Ω—ã, —Å–æ—Å—Ç–æ—è–Ω–∏—è), –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏ —Å–≤—è–∑–∏.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ —Å–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å-–æ–±—ä–µ–∫—Ç–æ–≤ –∞—É–¥–∏—Ç–∞ –∏ –º–∞—Ç—Ä–∏—Ü–∞ ¬´—Ñ–∞–π–ª ‚Üí —Å—Ç–∞—Ç—É—Å ‚Üí –ø—Ä–æ–±–µ–ª—ã¬ª.
2. **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ö–µ–º—ã (`DialogueAuditSummary`, `DialogueAsset`, `DialogueGap`, `DialogueUpdateRequest`, `DialogueStateMetrics`), –≤–∫–ª—é—á–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ enums –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º (scout/trusted/corporate/exposed –∏ —Ç.–¥.).  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ —Å—Ö–µ–º + —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π —Ñ–ª–∞–≥–æ–≤/—Ä–µ–ø—É—Ç–∞—Ü–∏–π.
3. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ endpoints** ‚Äî —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å REST-–ø—É—Ç–∏ (–ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –æ—Ç—á—ë—Ç–∞, –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–µ–ª–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞/manual refresh, —ç–∫—Å–ø–æ—Ä—Ç).  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –∫–æ–¥–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤, –ø—Ä–∏–º–µ—Ä–æ–≤.
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Å–≤—è–∑—å —Å shared –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏** ‚Äî —Å–≤—è–∑–∞—Ç—å –æ—à–∏–±–∫–∏ —Å `shared/common/responses.yaml`, –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ pagination/shared —Å—Ö–µ–º—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ `$ref`, –µ–¥–∏–Ω—ã–µ –æ—à–∏–±–∫–∏, –æ–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å OpenAPI –ª–∏–Ω—Ç–µ—Ä–æ–º, —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ `/api/v1/narrative/dialogues/*.yaml`.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –≤–∞–ª–∏–¥–Ω—ã–π YAML, –≥–æ—Ç–æ–≤—ã–π –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞.

---

## üîó Endpoints (–ø—Ä–æ–µ–∫—Ç–Ω—ã–µ –∑–∞–≥–æ—Ç–æ–≤–∫–∏)

1. **GET `/api/v1/narrative/dialogues/audit`**
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤ (NPC, –∫–≤–µ—Å—Ç—ã, —à–∞–±–ª–æ–Ω—ã).
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
     - `scope` (query, enum: `npc`, `quest`, `template`, `all`, default `all`)
     - `wave` (query, string, –ø—Ä–∏–º–µ—Ä: `wave-1`)
     - `updatedSince` (query, date-time)
   - –û—Ç–≤–µ—Ç—ã:
     - `200 OK` ‚Üí `DialogueAuditSummary` (–≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º, —Å–ø–∏—Å–æ–∫ —Ç–æ–ø-–ø—Ä–æ–±–µ–ª–æ–≤).
     - `$ref` –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏–∑ `shared/common/responses.yaml` (400, 401, 403, 404, 500).

2. **GET `/api/v1/narrative/dialogues/audit/gaps`**
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–µ–ª–æ–≤ (–Ω–µ—Ç —Ñ–∞–π–ª–∞, –Ω–µ—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏—è, –Ω–µ—Ç —Å–≤—è–∑–∫–∏ —Å —Ä–µ–ø—É—Ç–∞—Ü–∏—è–º–∏/—Ñ–ª–∞–≥–∞–º–∏).
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
     - `type` (query, enum: `missing-file`, `missing-branch`, `missing-flags`, `missing-status`)
     - `priority` (query, enum: `critical`, `high`, `medium`, `low`)
     - –ü–∞–≥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ `shared/common/pagination.yaml`.
   - –û—Ç–≤–µ—Ç—ã:
     - `200 OK` ‚Üí `DialogueGapList` (—Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ `DialogueGap` + –ø–∞–≥–∏–Ω–∞—Ü–∏—è).
     - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `$ref`.

3. **POST `/api/v1/narrative/dialogues/audit/refresh`**
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ç—Ä–∏–≥–≥–µ—Ä —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞—É–¥–∏—Ç–∞ (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤/–≤–µ—Ç–æ–∫).
   - –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞: `DialogueAuditRefreshRequest` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `force`, `targets`, `notes`).
   - –û—Ç–≤–µ—Ç—ã:
     - `202 Accepted` ‚Üí `DialogueAuditRefreshJob` (ID –∑–∞–¥–∞—á–∏, —Å—Ç–∞—Ç—É—Å, ETA).
     - –û—à–∏–±–∫–∏ 409 (—É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ) –∏ 422 (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ü–µ–ª–∏) –∏–∑ `shared/common/responses.yaml`.

4. **GET `/api/v1/narrative/dialogues/audit/history/{auditId}`** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ (–∫—Ç–æ –æ–±–Ω–æ–≤–ª—è–ª, –∫–æ–≥–¥–∞, –∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã).
   - –û—Ç–≤–µ—Ç `200 OK` ‚Üí `DialogueAuditHistory`.

> –†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç, –æ—Ç—á—ë—Ç—ã –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å QA.

---

## üß± –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–Ω–æ–≤–æ–π —Å–æ—Å—Ç–∞–≤)

- `DialogueAuditSummary`
  - `waveId` (string, –ø—Ä–∏–º–µ—Ä: `wave-1`)
  - `totalAssets` (integer, ‚â• 0)
  - `completedAssets` (integer, ‚â• 0)
  - `progressPercentage` (number, format float, 0‚Äì100)
  - `npcBreakdown` (`DialogueStateMetrics`)
  - `questBreakdown` (`DialogueStateMetrics`)
  - `topGaps` (array of `DialogueGap`, maxItems 10)
  - `lastUpdatedAt` (date-time, required)

- `DialogueStateMetrics`
  - `state` (enum: `scout`, `trusted`, `corporate`, `exposed`, `missing`)
  - `count` (integer, ‚â• 0)
  - `percentage` (number, 0‚Äì100)

- `DialogueAsset`
  - `assetId` (string, pattern `dialogue-[a-z0-9-]+`)
  - `assetType` (enum: `npc`, `quest`, `template`)
  - `title` (string, 1‚Äì200)
  - `status` (enum: `draft`, `review`, `approved`, `ready`)
  - `statesCovered` (array enum: `scout`, `trusted`, `corporate`, `exposed`)
  - `flagDependencies` (array of strings, –ø—Ä–∏–º–µ—Ä—ã: `flag.neon.support`)
  - `reputationDependencies` (array, –ø—Ä–∏–º–µ—Ä: `rep.fixers.neon`)
  - `linkedTasks` (array of `TaskReference`)
  - `lastAuditNote` (string, ‚â§ 500, optional)

- `DialogueGap`
  - `gapId` (string, uuid)
  - `assetId` (string)
  - `gapType` (enum: `missing-file`, `missing-branch`, `missing-flags`, `missing-status`)
  - `description` (string, ‚â§ 500)
  - `severity` (enum: `critical`, `high`, `medium`, `low`)
  - `recommendedAction` (string, ‚â§ 500)
  - `relatedFlags` (array of strings)
  - `createdAt` (date-time)

- `DialogueAuditRefreshRequest`
  - `force` (boolean, default false)
  - `targets` (array of strings, –æ–ø–∏—Å—ã–≤–∞–µ—Ç assetIds, maxItems 50)
  - `notes` (string, optional, ‚â§ 400)

- `DialogueAuditRefreshJob`
  - `jobId` (string, uuid)
  - `status` (enum: `queued`, `running`, `completed`, `failed`)
  - `startedAt` (date-time)
  - `completedAt` (date-time, nullable)
  - `processedAssets` (integer)

- `TaskReference`
  - `taskId` (string, pattern `API-TASK-[0-9]+`)
  - `taskPath` (string, example: `tasks/active/queue/task-284-npc-aisha-frost-dialogue-api.md`)

> –í—Å–µ –º–æ–¥–µ–ª–∏ —Å–Ω–∞–±–¥–∏—Ç—å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ required —Å–ø–∏—Å–∫–∞–º–∏. –û—à–∏–±–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ `shared/common/responses.yaml`.

---

## üìê –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏ –ø—Ä–∞–≤–∏–ª–∞

- SOLID/DRY/KISS ‚Äî –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—ã, –≤—ã–Ω–æ—Å–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ `components`.
- OpenAPI 3.0.3, –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Å—Ç–∏–ª—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∏–∞–ª–æ–≥–æ–≤—ã–º–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$ref` –Ω–∞:
  - `api/v1/shared/common/responses.yaml` –¥–ª—è –æ—à–∏–±–æ–∫;
  - `api/v1/shared/common/pagination.yaml` –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏;
  - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `TaskReference`/`Flag`/`Reputation` —Å—Ö–µ–º—ã (–µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å).
- –ù–∞–∑–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π –≤ PascalCase, –ø–æ–ª—è –≤ camelCase.
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Äî –≤—Å—ë –∏–∑ –ë–î/—Å–µ—Ä–≤–∏—Å–æ–≤.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 400 —Å—Ç—Ä–æ–∫ –Ω–∞ —Ñ–∞–π–ª —Å–æ–±–ª—é–¥–∞—Ç—å (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–Ω–µ—Å—Ç–∏ —Å—Ö–µ–º—ã).

---

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

1. –§–∞–π–ª `api/v1/narrative/dialogues/dialogue-audit.yaml` —Å–æ–∑–¥–∞–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω –ø–æ OpenAPI 3.0.3.
2. –í —Ñ–∞–π–ª–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å —Ü–µ–ª–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (microservice/frontend).
3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–∏–Ω–∏–º—É–º —Ç—Ä–∏ endpoints (summary, gaps, refresh) —Å –ø–æ–ª–Ω—ã–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏.
4. –í–∫–ª—é—á–µ–Ω—ã —Å—Ö–µ–º—ã `DialogueAuditSummary`, `DialogueGap`, `DialogueAsset`, `DialogueAuditRefreshRequest`, `DialogueAuditRefreshJob`, `DialogueStateMetrics`, `TaskReference`.
5. –í –æ—Ç–≤–µ—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `$ref` –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏–∑ `shared/common/responses.yaml`.
6. –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è `/gaps` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ `shared/common/pagination.yaml`.
7. –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏ enum –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º (`scout`, `trusted`, `corporate`, `exposed` –∏ —Ç.–¥.).
8. –ü—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ endpoint, —É—á–∏—Ç—ã–≤–∞—é—â–∏–µ –ø–µ—Ä–≤—É—é –≤–æ–ª–Ω—É NPC/–∫–≤–µ—Å—Ç–æ–≤.
9. –í—Å–µ –ø–æ–ª—è —Å–Ω–∞–±–∂–µ–Ω—ã required/nullable/format, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
10. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏–Ω—Ç–µ—Ä (–±–µ–∑ –æ—à–∏–±–æ–∫/–≤–∞—Ä–Ω–∏–Ω–≥–æ–≤) –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∏–∞–ª–æ–≥–æ–≤—ã–º–∏ API.
11. –í `brain-mapping.yaml` –∏ –∏—Å—Ö–æ–¥–Ω–æ–º `.BRAIN` –¥–æ–∫—É–º–µ–Ω—Ç–µ —É–∫–∞–∑–∞–Ω–∞ —Å–≤—è–∑—å —Å `API-TASK-311`.

---

## ‚ùì FAQ

- **–ù—É–∂–Ω–æ –ª–∏ –≤–∫–ª—é—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–∂–¥–æ–π NPC?**  
  –ù–µ—Ç, API –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏–∞–ª–æ–≥–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è—Ö (`npc-*.yaml`).

- **–ö–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å `quest_skill_hooks`?**  
  –ß–µ—Ä–µ–∑ –ø–æ–ª—è `flagDependencies` –∏ `reputationDependencies`, –ø–µ—Ä–µ—á–∏—Å–ª—è—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã.

- **–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –¥–æ–±–∞–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è?**  
  –†–∞—Å—à–∏—Ä–∏—Ç—å enum –≤ `DialogueStateMetrics` –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–ø–∏—Å–∞–Ω–∏–∏.

- **–ú–æ–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å endpoint `/history`?**  
  –î–æ–ø—É—Å—Ç–∏–º–æ, –µ—Å–ª–∏ –±–∏–∑–Ω–µ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω–æ—Å—Ç—å. –ò–Ω–∞—á–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ read-only.

- **–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö NPC?**  
  –í –º–∞—Å—Å–∏–≤–µ `linkedTasks` (`TaskReference`) —É–∫–∞–∑—ã–≤–∞—Ç—å —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ `API-TASK-284` ‚Ä¶ `API-TASK-292`.

- **–ù—É–∂–µ–Ω –ª–∏ WebSocket/stream?**  
  –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è: audit –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å/tasks job (refresh). –†–µ–∞–ª–∏–∑–∞—Ü–∏—è realtime –±—É–¥–µ—Ç –æ–±—Å—É–∂–¥–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

- **–ß—Ç–æ —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π?**  
  API –¥–æ–ª–∂–Ω–æ –ø–æ–∑–≤–æ–ª—è—Ç—å —Ä–∞—Å—à–∏—Ä—è—Ç—å —Å—Ö–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `localizationStatus`) –±–µ–∑ breaking changes (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å optional –ø–æ–ª—è).

---

–ì–æ—Ç–æ–≤–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞—Å—Ç Narrative-–∫–æ–º–∞–Ω–¥–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å—é –¥–∏–∞–ª–æ–≥–æ–≤, –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã –∏ —É—Å–∫–æ—Ä–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å gameplay/world —Å–µ—Ä–≤–∏—Å–∞–º–∏.


### OpenAPI (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

- –ó–∞–ø–æ–ª–Ω–∏ `info.x-microservice` (name, port, domain, base-path, package) –ø–æ –¥–∞–Ω–Ω—ã–º —Ü–µ–ª–µ–≤–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.
- –í —Å–µ–∫—Ü–∏–∏ `servers` –æ—Å—Ç–∞–≤—å Production gateway `https://api.necp.game/v1` –∏ –ø—Ä–∏–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ `http://localhost:8080/api/v1`.
- WebSocket –º–∞—Ä—à—Ä—É—Ç—ã –ø—É–±–ª–∏–∫—É–π —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `wss://api.necp.game/v1/...`.

