# Task ID: API-TASK-312
**–¢–∏–ø:** API Generation  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –≤—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** queued  
**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-08 09:35  
**–°–æ–∑–¥–∞—Ç–µ–ª—å:** AI Task Creator Agent  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** API-TASK-285, API-TASK-289, API-TASK-294

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é `dialogue-quest-main-001-first-steps` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞ ¬´–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏¬ª: –æ–ø–∏—Å–∞—Ç—å API –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö —É–∑–ª–æ–≤, –ø—Ä–æ–≤–µ—Ä–æ–∫ D&D, —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Å–æ–±—ã—Ç–∏—è –º–∏—Ä–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:** —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `api/v1/narrative/dialogues/quests/main-001-first-steps.yaml`, —á—Ç–æ–±—ã narrative-service –º–æ–≥ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏, —Ñ–ª–∞–≥–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –∫–≤–µ—Å—Ç–∞, –∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤–µ—Ç–≤–ª–µ–Ω–∏—è –ú–∞—Ä–∫–æ –°–∞–Ω—á–µ—Å–∞ –∏ –æ–±—É—á–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏.

---

## üéØ –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–û–±–µ—Å–ø–µ—á–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ –ø–µ—Ä–≤–æ–π –≥–ª–∞–≤—ã:
- —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω –æ–±—É—á–µ–Ω–∏—è (arrival, market-run, tutorial-hud, fixer-brief, stealth-route, tech-door, wrap-up);
- —ç–∫—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ D&D –∏ —É—Å–ª–æ–≤–∏–π (Perception, Parkour, Communication, Stealth, Tech) —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –∏ —Ç–∞–π–º–µ—Ä–∞–º–∏;
- —É—á—ë—Ç —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ –º–∏—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (`metro_shutdown`, `blackwall_breach`, `solar_flare_2075`);
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –∏ —Ñ–ª–∞–≥–æ–≤—ã–º–∏ –∏—Å—Ö–æ–¥–∞–º–∏ (corp/street/freelance –≤–µ—Ç–∫–∏, tutorial flags);
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–≤–µ—Å—Ç–∞–º–∏ (`002-choose-path`) –∏ –¥–∏–∞–ª–æ–≥–∞–º–∏ NPC (–ú–∞—Ä–∫–æ –°–∞–Ω—á–µ—Å, –î–∂–µ–π–∫ –ê—Ä—á–µ—Ä, –†–∏—Ç–∞ –ú–æ—Ä–µ–Ω–æ).

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**
- Gameplay –ø–æ–ª—É—á–∞–µ—Ç machine-readable —Å—Ü–µ–Ω–∞—Ä–∏–π –∫–≤–µ—Å—Ç–∞ 1.1 –¥–ª—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏.
- Narrative/UI –ø–æ–ª—É—á–∞—é—Ç –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫, HUD-–∂—É—Ä–Ω–∞–ª–æ–≤ –∏ –≤—ã–±–æ—Ä–æ–≤.
- QA –º–æ–∂–µ—Ç —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Å–æ–±—ã—Ç–∏—è –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤.
- –°–ª—É–∂–±—ã —Ä–µ–ø—É—Ç–∞—Ü–∏–π –∏ —Å–æ–±—ã—Ç–∏–π –∑–Ω–∞—é—Ç, –∫–∞–∫–∏–µ —Ñ–ª–∞–≥–∏ –∏ —Å–æ–±—ã—Ç–∏—è –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã –Ω–∞ —Å—Ç–∞—Ä—Ç–µ.

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `.BRAIN`  
**–ü—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É:** `.BRAIN/04-narrative/dialogues/quest-main-001-first-steps.md`  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-08 09:26  
**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** approved  

**–ß—Ç–æ –≤–∞–∂–Ω–æ –∏–∑ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
- –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Å—Ü–µ–Ω –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π (arrival ‚Üí wrap-up) —Å –ø—Å–µ–≤–¥–æ-YAML —É–∑–ª–∞–º–∏.
- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ D&D, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, —Ç–∞–π–º–µ—Ä—ã –∏ –∏—Å—Ö–æ–¥—ã (success, failure, critical).
- –°–≤—è–∑—å —Å —Å–æ–±—ã—Ç–∏—è–º–∏ –º–∏—Ä–∞ –∏ UI –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏.
- –§–ª–∞–≥–∏ (`flag.main001.*`), —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ (`rep.fixers.marco`, `rep.street`, `rep.corp`) –∏ –Ω–∞–≥—Ä–∞–¥—ã.
- –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ NPC –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∫–≤–µ—Å—Ç—ã.

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

- `.BRAIN/04-narrative/dialogues/npc-marco-fix-sanchez.md`
- `.BRAIN/04-narrative/dialogues/npc-jake-archer-dialogue.md`
- `.BRAIN/04-narrative/quests/main/001-first-steps.md`
- `.BRAIN/04-narrative/quest-system.md`
- `.BRAIN/02-gameplay/social/reputation-formulas.md`
- `.BRAIN/02-gameplay/world/events/live-events-system.md`

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- API –∑–∞–¥–∞–Ω–∏—è –Ω–∞ NPC (`API-TASK-285`, `API-TASK-289`).
- `API-TASK-294` (quest-choose-path) ‚Äî –∑–∞–≤–∏—Å–∏–º—ã–π —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø.
- `API-TASK-311` (dialogue audit) ‚Äî –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–≤–µ—Å—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤.

---

## üìÅ –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API

### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `API-SWAGGER`

**–¶–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª:** `api/v1/narrative/dialogues/quests/main-001-first-steps.yaml`  
**API –≤–µ—Ä—Å–∏—è:** v1  
**–¢–∏–ø —Ñ–∞–π–ª–∞:** OpenAPI 3.0.3 (YAML)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
```
API-SWAGGER/
‚îî‚îÄ‚îÄ api/
    ‚îî‚îÄ‚îÄ v1/
        ‚îî‚îÄ‚îÄ narrative/
            ‚îî‚îÄ‚îÄ dialogues/
                ‚îú‚îÄ‚îÄ npc-marco-fix-sanchez.yaml
                ‚îú‚îÄ‚îÄ npc-jake-archer.yaml
                ‚îú‚îÄ‚îÄ quest-main-001-first-steps.yaml ‚Üê —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å
                ‚îî‚îÄ‚îÄ ...
```

**–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞:** –Ω–æ–≤—ã–π (—Å–æ–∑–¥–∞—Ç—å). –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–Ω–µ—Å—Ç–∏ —Å—Ö–µ–º—ã –≤ `components/` (‚â§ 400 —Å—Ç—Ä–æ–∫ –Ω–∞ —Ñ–∞–π–ª).

---

## üèóÔ∏è –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

### Backend (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å:** narrative-service  
- **–ü–æ—Ä—Ç:** 8087  
- **API Base Path:** `/api/v1/narrative/dialogues/quests/*`  
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**  
  - gameplay-service (–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ç–∞–π–º–µ—Ä—ã)  
  - world-service (—Å–æ–±—ã—Ç–∏—è `metro_shutdown`, `blackwall_breach`, `solar_flare_2075`)  
  - social-service (—Ä–µ–ø—É—Ç–∞—Ü–∏–∏ street/corp/fixer/law)

### Frontend (–º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- **–ú–æ–¥—É–ª—å:** `modules/narrative/quests/main-001`  
- **State Store:** `useNarrativeStore` (`quests.main001`)  
- **UI (@shared/ui):** `DialogViewport`, `BranchTree`, `CheckOutcomeBanner`, `Badge`, `Tooltip`, `Timeline`  
- **Forms (@shared/forms):** `DialogueChoiceForm`, `CheckSimulationForm`, `EventToggleForm`  
- **Layouts (@shared/layouts):** `GameLayout`, `QuestSplitPanel`  
- **Hooks (@shared/hooks):** `useRealtime`, `useQuestFlags`, `useDebounce`

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è API —Ñ–∞–π–ª–∞
–î–æ–±–∞–≤–∏—Ç—å –≤–≤–µ—Ä—Ö—É YAML:
```
# Target Architecture:
# - Microservice: narrative-service (port 8087)
# - Frontend Module: modules/narrative/quests/main-001
# - State: useNarrativeStore(quests.main001)
# - UI: @shared/ui (DialogViewport, BranchTree, CheckOutcomeBanner, Badge, Tooltip, Timeline)
# - Forms: @shared/forms (DialogueChoiceForm, CheckSimulationForm, EventToggleForm)
# - Layouts: @shared/layouts (GameLayout, QuestSplitPanel)
# - Hooks: @shared/hooks (useRealtime, useQuestFlags, useDebounce)
# - Related Services: gameplay-service, world-service, social-service
# - API Base: /api/v1/narrative/dialogues/quests/*
```

---

## ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω)

1. **–ò–∑—É—á–∏—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫**: —Å–æ–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω, —É–∑–ª–æ–≤, —Ñ–ª–∞–≥–æ–≤, –ø—Ä–æ–≤–µ—Ä–æ–∫, –º–∏—Ä–æ–≤—ã—Ö —Ä–µ–∞–∫—Ü–∏–π –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–π.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –∫–∞—Ä—Ç–∞ —É–∑–ª–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (flags, reputation, events).
2. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –º–æ–¥–µ–ª–∏**: —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—ã `QuestDialogue`, `DialogueNode`, `DialogueOption`, `CheckDefinition`, `OutcomeBundle`, `WorldReaction`, `ReputationImpact`.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª–µ–π, —Ç–∏–ø—ã, enum –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π (`arrival`, `market-run`, ...).
3. **–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å endpoints**: –º–∏–Ω–∏–º—É–º —Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ (–ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è, —Å–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞) –ø–ª—é—Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–æ–±—ã—Ç–∏–µ/—Ä–µ–ø–ª–µ–π.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—É—Ç–µ–π, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤, —Å—Ç–∞—Ç—É—Å—ã.
4. **–û—Ñ–æ—Ä–º–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: –≤—ã–Ω–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Å–≤—è–∑–∞—Ç—å –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `shared/common/responses.yaml`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é, –≥–¥–µ –Ω—É–∂–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å—Ç–æ—Ä–∏—è –≤—ã–±–æ—Ä–æ–≤).  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ `$ref`, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
5. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã**: –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã JSON –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Å—Ü–µ–Ω, –ø—Ä–æ–≤–µ—Ä–æ–∫ (Perception, Parkour, Tech) –∏ —Ä–µ–∞–∫—Ü–∏–π —Å–æ–±—ã—Ç–∏–π.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ —Å–µ–∫—Ü–∏—è `examples` –ø–æ–∫—Ä—ã–≤–∞–µ—Ç success/failure/critical —Å—Ü–µ–Ω–∞—Ä–∏–∏.
6. **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ø—Ä–æ–≥–Ω–∞—Ç—å –ª–∏–Ω—Ç–µ—Ä, —É–±–µ–¥–∏—Ç—å—Å—è –≤ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏ narrative, –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–± –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.  
   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –≤–∞–ª–∏–¥–Ω—ã–π OpenAPI —Ñ–∞–π–ª, –≥–æ—Ç–æ–≤—ã–π –¥–ª—è codegen.

---

## üîó Endpoints (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ)

1. **GET `/api/v1/narrative/dialogues/quests/main-001`**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (—É–∑–ª—ã, —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏).
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
     - `includeStates` (bool, default `true`)
     - `includeChecks` (bool, default `true`)
     - `events[]` (array of strings) ‚Äî —Å–∏–º—É–ª–∏—Ä—É–µ–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –º–∏—Ä–∞.
   - –û—Ç–≤–µ—Ç `200 OK` ‚Üí `QuestDialogue`
   - –û—à–∏–±–∫–∏: `404` (–∫–≤–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω), `422` (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è) —á–µ—Ä–µ–∑ `shared/common/responses.yaml`.

2. **POST `/api/v1/narrative/dialogues/quests/main-001/checks/simulate`**
   - –°–∏–º—É–ª–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É D&D —Å —É—á—ë—Ç–æ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, gear –∏ –≤—Ä–µ–º–µ–Ω–∏.
   - –¢–µ–ª–æ: `CheckSimulationRequest` (nodeId, optionId, stat, modifiers, gear, eventContext).
   - –û—Ç–≤–µ—Ç `200 OK` ‚Üí `CheckSimulationResult` (success/failure/critical, —Ä–µ–ø—É—Ç–∞—Ü–∏—è, —Ñ–ª–∞–≥–∏, HUD).
   - –û—à–∏–±–∫–∏ `404`, `409` (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —É–∑–µ–ª), `422` (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã).

3. **POST `/api/v1/narrative/dialogues/quests/main-001/progress`**
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä–æ–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞.
   - –¢–µ–ª–æ: `ProgressUpdateRequest` (currentState, chosenOptionId, checkOutcome, contextFlags).
   - –û—Ç–≤–µ—Ç `200 OK` ‚Üí `ProgressUpdateResponse` (nextState, setFlags, reputationChanges, followUpNodes, questRedirects).
   - –û—à–∏–±–∫–∏ `409` (–≤–µ—Ç–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞), `422` (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ñ–ª–∞–≥–∏).

4. **GET `/api/v1/narrative/dialogues/quests/main-001/history`** *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)*  
   - –ü–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—ã–±–æ—Ä–æ–≤/–ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `shared/common/pagination.yaml`.

5. **POST `/api/v1/narrative/dialogues/quests/main-001/events/apply`** *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)*  
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ª–∏–±–æ –æ—Ç–∫–∞—Ç –º–∏—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∫ —Å—Ü–µ–Ω–∞—Ä–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä `metro_shutdown`).

---

## üß± –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–æ—Å—Ç–∞–≤)

- `QuestDialogue`
  - `questId` (string, pattern `quest-main-001`)
  - `title` (string)
  - `states` (array of `DialogueState`)
  - `nodes` (array of `DialogueNode`, required)
  - `checks` (array of `CheckDefinition`)
  - `worldReactions` (array of `WorldReaction`)
  - `defaultFlags` (array of strings)
  - `lastUpdatedAt` (date-time)

- `DialogueState`
  - `id` (enum: `arrival`, `market-run`, `tutorial-hud`, `fixer-brief`, `stealth-route`, `tech-door`, `wrap-up`)
  - `description` (string)
  - `entryConditions` (array of `Condition`)
  - `linkedNodes` (array of nodeIds)

- `DialogueNode`
  - `id` (string)
  - `label` (string)
  - `speakerOrder` (array of strings)
  - `lines` (array of `DialogueLine`)
  - `options` (array of `DialogueOption`)
  - `hudHints` (array of `HudHint`)

- `DialogueOption`
  - `optionId` (string)
  - `text` (string)
  - `check` (`CheckReference`, nullable)
  - `outcomes` (`OutcomeBundle`)
  - `nextNodeId` (string, nullable)

- `CheckDefinition`
  - `checkId` (string, pattern like `arrival.arrival-curious`)
  - `stat` (enum: `Perception`, `Parkour`, `Communication`, `Stealth`, `Tech`)
  - `dc` (integer)
  - `timerSeconds` (integer, nullable)
  - `modifiers` (array of `Modifier`)
  - `successOutcome` (`OutcomeBundle`)
  - `failureOutcome` (`OutcomeBundle`)
  - `criticalSuccessOutcome` (`OutcomeBundle`)
  - `criticalFailureOutcome` (`OutcomeBundle`)

- `OutcomeBundle`
  - `setFlags` (array of strings)
  - `clearFlags` (array of strings)
  - `reputation` (array of `ReputationImpact`)
  - `rewards` (array of `RewardReference`)
  - `triggers` (array of `TriggerReference`)
  - `hud` (`HudEffect`, nullable)

- `WorldReaction`
  - `eventId` (enum: `world.event.metro_shutdown`, `world.event.blackwall_breach`, `world.event.solar_flare_2075`)
  - `description` (string)
  - `effects` (`WorldReactionEffect`)

- `CheckSimulationRequest`, `CheckSimulationResult`, `ProgressUpdateRequest`, `ProgressUpdateResponse` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ (—É—Å–ø–µ—Ö/–ø—Ä–æ–≤–∞–ª/–∫—Ä–∏—Ç).

–í—Å–µ —Å—Ö–µ–º—ã —Å–Ω–∞–±–¥–∏—Ç—å `examples`, `required`, `enum` –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ (`minItems`, `maxItems`).

---

## üìê –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏ –ø—Ä–∞–≤–∏–ª–∞

- –°–æ–±–ª—é–¥–∞—Ç—å SOLID / DRY / KISS; –≤—ã–Ω–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å—Ö–µ–º—ã –≤ `components`.
- OpenAPI 3.0.3; –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$ref` –Ω–∞ `shared/common/responses.yaml` –∏ `shared/common/pagination.yaml`.
- –ù–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–π/—Ñ–ª–∞–≥–æ–≤, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.
- –õ–∏–º–∏—Ç 400 —Å—Ç—Ä–æ–∫ ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–Ω–µ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `components/quests/main-001/*.yaml`.
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Äî –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∏–∑ –ë–î/—Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

1. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `api/v1/narrative/dialogues/quests/main-001-first-steps.yaml` (–≤–∞–ª–∏–¥–Ω—ã–π OpenAPI 3.0.3).
2. –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å —Ü–µ–ª–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.
3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –º–∏–Ω–∏–º—É–º —Ç—Ä–∏ endpoints (GET —Å—Ü–µ–Ω–∞—Ä–∏—è, POST —Å–∏–º—É–ª—è—Ü–∏–∏, POST –ø—Ä–æ–≥—Ä–µ—Å—Å–∞).
4. –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`arrival`, `market-run`, `tutorial-hud`, `fixer-brief`, `stealth-route`, `tech-door`, `wrap-up`) –æ—Ç—Ä–∞–∂–µ–Ω—ã –≤ —Å—Ö–µ–º–∞—Ö.
5. –ü—Ä–æ–≤–µ—Ä–∫–∏ D&D –≤–∫–ª—é—á–µ–Ω—ã —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –∏ –∏—Å—Ö–æ–¥–∞–º–∏ (success/failure/critical).
6. –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –º–∏—Ä–∞ (`metro_shutdown`, `blackwall_breach`, `solar_flare_2075`) –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ API.
7. –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Ñ–ª–∞–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω–µ—á–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö.
8. –í—Å–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ `shared/common/responses.yaml`; –∏—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `shared/common/pagination.yaml`, –µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.
9. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ (success, failure, critical) –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
10. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏–Ω—Ç–µ—Ä –±–µ–∑ –æ—à–∏–±–æ–∫/–≤–∞—Ä–Ω–∏–Ω–≥–æ–≤.
11. `brain-mapping.yaml` –∏ `.BRAIN` –¥–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã, —Å—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.

---

## ‚ùì FAQ

- **–ù—É–∂–µ–Ω –ª–∏ WebSocket/stream?**  
  –ù–µ—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ REST. –†–µ–∞–ª—Ç–∞–π–º-–ø—É—à–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ `useRealtime`.

- **–ö–∞–∫ —É—á–∏—Ç—ã–≤–∞—Ç—å gear/–∫–ª–∞—Å—Å—ã?**  
  –ß–µ—Ä–µ–∑ –º–∞—Å—Å–∏–≤ `modifiers` –∏ `contextFlags` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö; backend —Å–∞–º —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–µ –±–æ–Ω—É—Å—ã.

- **–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏—Å—Ö–æ–¥–∞–º–∏?**  
  –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å—Ö–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `OutcomeBundle` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö —Å–∏–º—É–ª—è—Ü–∏–∏/–ø—Ä–æ–≥—Ä–µ—Å—Å–∞.

- **–ö–∞–∫ —Å–≤—è–∑–∞—Ç—å —Å `002-choose-path`?**  
  –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `nextQuestId` –≤ `ProgressUpdateResponse` –ø—Ä–∏ –≤—ã–±–æ—Ä–µ wrap-up –æ–ø—Ü–∏–π.

- **–ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è?**  
  –î–∞, `events[]` –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã; backend –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏–∑–Ω–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º.

- **–ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å HUD –ø–æ–¥—Å–∫–∞–∑–∫–∏?**  
  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `HudEffect` —Å —Ç–∏–ø–æ–º (`toast`, `timeline`, `replay`) –∏ payload.

- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è?**  
  –î–æ–±–∞–≤–∏—Ç—å optional `localizationKey` –≤ `DialogueLine`/`DialogueOption` –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

---

–≠—Ç–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–≤–µ—Å—Ç –∏ –ø–æ–∑–≤–æ–ª–∏—Ç –∫–æ–º–∞–Ω–¥–∞–º –≥–µ–π–º–ø–ª–µ—è, UI –∏ narrative —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ –µ–¥–∏–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.


### OpenAPI (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

- –ó–∞–ø–æ–ª–Ω–∏ `info.x-microservice` (name, port, domain, base-path, package) –ø–æ –¥–∞–Ω–Ω—ã–º —Ü–µ–ª–µ–≤–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.
- –í —Å–µ–∫—Ü–∏–∏ `servers` –æ—Å—Ç–∞–≤—å Production gateway `https://api.necp.game/v1` –∏ –ø—Ä–∏–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ `http://localhost:8080/api/v1`.
- WebSocket –º–∞—Ä—à—Ä—É—Ç—ã –ø—É–±–ª–∏–∫—É–π —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `wss://api.necp.game/v1/...`.

