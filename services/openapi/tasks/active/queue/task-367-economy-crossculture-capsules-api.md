# Task ID: API-TASK-367
**–¢–∏–ø:** API Generation  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –≤—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** queued  
**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-08 17:26  
**–°–æ–∑–¥–∞—Ç–µ–ª—å:** AI Brain Manager (GPT-5 Codex)  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** API-TASK-366 (world crossculture season API), API-TASK-150 (trading-guilds API), API-TASK-256 (stock-exchange-dividends API), API-TASK-320 (player-orders-economy-index API)

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å OpenAPI `crossculture-capsules.yaml` –¥–ª—è economy-service, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Ä—ã–Ω–æ–∫ ¬´–ö–æ–ª–ª–∞–±-–∫–∞–ø—Å—É–ª—ã¬ª: –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ü–µ–Ω—ã, –ª–∏–º–∏—Ç—ã, –ø–æ–∫—É–ø–∫–∏, –≤—ã–¥–∞—á—É —Å–µ–∑–æ–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã `thread-token` –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å.

---

## üéØ –¶–µ–ª—å

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏–∫–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API, —á—Ç–æ–±—ã:
- —É–ø—Ä–∞–≤–ª—è—Ç—å –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º —Å–µ–∑–æ–Ω–Ω—ã—Ö –∫–∞–ø—Å—É–ª –∏ —ç–º–æ—Ü–∏–π;
- –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –±–æ–Ω—É—Å—ã;
- —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫—É–ø–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã —Å inventory-service;
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–∞—à–±–æ—Ä–¥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥–∞–∂.

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏

- `.BRAIN/06-tasks/active/CURRENT-WORK/active/2025-11-07-crossculture-easter-atlas.md` (v1.0.0, ready).
- `.BRAIN/02-gameplay/economy/economy-overview.md` (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∞–ª—é—Ç –∏ marketplace).
- `.BRAIN/02-gameplay/economy/economy-pricing-detailed.md` ‚Äî –º–µ—Ç–æ–¥—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.
- `.BRAIN/05-technical/backend/mail-system.md` ‚Äî —Ä–∞—Å—Å—ã–ª–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π.
- `.BRAIN/06-tasks/active/CURRENT-WORK/open-questions.md` ‚Äî —Ä–µ—à–µ–Ω–∏—è –ø–æ —Ç–æ–∫–µ–Ω–∞–º `thread-token`.

---

## üìÅ –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- **–§–∞–π–ª:** `api/v1/economy/crossculture/capsules.yaml`
- **–§–æ—Ä–º–∞—Ç:** OpenAPI 3.0.3
- **–í–µ—Ä—Å–∏—è:** 1.0.0

```
api/
  v1/
    economy/
      crossculture/
        capsules.yaml
```

`info.x-microservice`:
```yaml
info:
  title: Crossculture Capsule Market API
  version: 1.0.0
  description: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∑–æ–Ω–Ω—ã–º —Ä—ã–Ω–∫–æ–º –∫–∞–ø—Å—É–ª Metropolis Threads
  x-microservice:
    name: economy-service
    port: 8085
    domain: economy
    basePath: /api/v1/economy
    package: com.necp.economy.crossculture
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Backend:** economy-service (8085) + inventory-service (–≤—ã–¥–∞—á–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤), world-service (—Ö–∞–±—ã), social-service (—ç–º–æ—Ü–∏–∏/—Ç–∏—Ç—É–ª—ã), analytics-service.
- **Frontend:** `modules/economy/seasonal-market`, `modules/social/seasons`.
  - State: `useEconomyStore` (`seasonalCatalog`, `purchaseHistory`, `tokenBalance`).
  - UI: `@shared/ui/CapsuleCard`, `@shared/ui/TokenBalance`, `@shared/forms/CapsulePurchaseForm`.
- **Kafka:** `economy.crossculture.purchase`, `economy.crossculture.catalog-updated`.

---

## üîß –ü–ª–∞–Ω

1. –°–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ –∫–∞–ø—Å—É–ª—ã (id, —Ä–µ–≥–∏–æ–Ω, —Ü–µ–Ω–∞, –ª–∏–º–∏—Ç—ã, –Ω–∞–≥—Ä–∞–¥—ã) –∏–∑ `.BRAIN`.
2. –û–ø–∏—Å–∞—Ç—å REST endpoints: –∫–∞—Ç–∞–ª–æ–≥, –ø–æ–∫—É–ø–∫–∞, –ª–∏–º–∏—Ç—ã, –æ—Ç—á—ë—Ç—ã, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ.
3. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–¥–∞—á—É —Å–µ–∑–æ–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã `thread-token` –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–Ω–µ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤.
4. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (baseline, surge, discount).
5. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è Kafka –∏ —Å–≤—è–∑—å —Å inventory-service.
6. –û–±–Ω–æ–≤–∏—Ç—å mapping –∏ –¥–æ–∫—É–º–µ–Ω—Ç .BRAIN.

---

## üåê Endpoints

1. `GET /api/v1/economy/crossculture/capsules`
   - –ö–∞—Ç–∞–ª–æ–≥ –∫–∞–ø—Å—É–ª (—Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Ä–µ–≥–∏–æ–Ω—É, —Ç–∏–ø—É, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏).
   - –ü–∞–≥–∏–Ω–∞—Ü–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ / —Ü–µ–Ω–µ.

2. `POST /api/v1/economy/crossculture/capsules/purchase`
   - –¢–µ–ª–æ: `capsuleId`, `quantity`, `paymentMethod` (eddies/thread-token), `playerId`, `region`.
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã, —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã, –ø—É–±–ª–∏–∫—É–µ—Ç `economy.crossculture.purchase`.

3. `GET /api/v1/economy/crossculture/capsules/{capsuleId}`
   - –î–µ—Ç–∞–ª–∏ –∫–∞–ø—Å—É–ª—ã: –Ω–∞–≥—Ä–∞–¥—ã, –ª–∏–º–∏—Ç—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞.

4. `GET /api/v1/economy/crossculture/purchases`
   - –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –∏–≥—Ä–æ–∫–∞ (—Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º, —Ç–∏–ø–∞–º).

5. `POST /api/v1/economy/crossculture/capsules/{capsuleId}/adjust-price`
   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ surge/discount.

6. `GET /api/v1/economy/crossculture/stats`
   - –ú–µ—Ç—Ä–∏–∫–∏: `salesVolume`, `tokenSpent`, `topCapsules`, `regionsPerformance`.

7. `GET /api/v1/economy/crossculture/token-balance`
   - –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `thread-token` –¥–ª—è –∏–≥—Ä–æ–∫–∞.

---

## üß± –ú–æ–¥–µ–ª–∏

- `Capsule`: `capsuleId`, `name`, `region`, `category`, `basePrice`, `currentPrice`, `purchaseLimitDaily`, `rewardPackage`, `activeFrom`, `activeTo`.
- `PurchaseRequest`: `playerId`, `capsuleId`, `quantity`, `paymentMethod`, `region`, `clientVersion`.
- `RewardPackage`: `items[]`, `emotes[]`, `titles[]`, `tokenBonus`.
- `CapsuleStats`: `salesVolume`, `uniqueBuyers`, `tokensConsumed`, `avgBasket`, `conversionRate`.
- `TokenBalance`: `playerId`, `balance`, `dailyEarned`, `dailySpent`.

---

## üìä –ü—Ä–∞–≤–∏–ª–∞

- –õ–∏–º–∏—Ç –ø–æ–∫—É–ø–æ–∫: 3/–¥–µ–Ω—å –Ω–∞ –∫–∞–ø—Å—É–ª—É; –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞: `currentPrice = basePrice * demandCoefficient * regionModifier`.
- –¢–æ–∫–µ–Ω—ã: –ª–∏–º–∏—Ç 150 –∑–∞ —Å–µ–∑–æ–Ω, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑ –Ω–∞–≥—Ä–∞–¥ —Ö–∞–±–æ–≤.
- –ü–æ–∫—É–ø–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ audit + –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ mail-service.
- –í–æ–∑–≤—Ä–∞—Ç—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (422 –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ).

---

## ‚úÖ Acceptance Criteria

1. –°–æ–∑–¥–∞–Ω `api/v1/economy/crossculture/capsules.yaml`, –≤–∞–ª–∏–¥–µ–Ω –ø–æ OpenAPI.
2. –í `info.x-microservice` —É–∫–∞–∑–∞–Ω economy-service (8085).
3. –í—Å–µ endpoints –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å –∫–æ–¥–∞–º–∏ –æ—à–∏–±–æ–∫ (`CAPSULE_LIMIT_EXCEEDED`, `CAPSULE_SOLD_OUT`, `TOKEN_CAP_REACHED`).
4. –û–ø–∏—Å–∞–Ω—ã –º–æ–¥–µ–ª–∏ –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (–ª–∏–º–∏—Ç—ã, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞, —Ç–æ–∫–µ–Ω—ã).
5. Kafka —Å–æ–±—ã—Ç–∏—è `economy.crossculture.purchase` –∏ `economy.crossculture.catalog-updated` –æ—Ñ–æ—Ä–º–ª–µ–Ω—ã.
6. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±—â–∏–µ —Å—Ö–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –æ—Ç–≤–µ—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫.
7. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è —É—Å–ø–µ—à–Ω—É—é –∏ –æ—Ç–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ–∫—É–ø–∫—É).
8. `brain-mapping.yaml` —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å—å –¥–ª—è API-TASK-367.
9. `.BRAIN/2025-11-07-crossculture-easter-atlas.md` –æ–±–Ω–æ–≤–ª—ë–Ω (API Tasks Status).
10. –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∑–∞–º–µ—Ç–∫–∞ –æ –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è economy-service –∏ UI.

---

## ‚ùìFAQ

- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ª–∏ –ø–∞–∫–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º?** –î–∞, —Ä–µ–≥–∏–æ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –º–æ–¥–µ–ª–µ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ö –∫–∞—Ç–∞–ª–æ–≥–∞.
- **–ù—É–∂–Ω–æ –ª–∏ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Å market API?** –ù–µ—Ç, —Å–µ–∑–æ–Ω–Ω—ã–π —Ä—ã–Ω–æ–∫ –∞–≤—Ç–æ–Ω–æ–º–µ–Ω; —Å–≤—è–∑—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º marketplace ‚Äî —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã.
- **–ö–∞–∫ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã?** –í –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è; —É–∫–∞–∑–∞—Ç—å –≤ `Rejected Scenarios`.

---

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å mapping, .BRAIN –¥–æ–∫—É–º–µ–Ω—Ç –∏ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é.

