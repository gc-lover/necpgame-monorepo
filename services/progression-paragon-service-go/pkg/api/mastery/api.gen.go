// Package masteryapi provides primitives to interact with the openapi HTTP API.
//
// Code generated by github.com/oapi-codegen/oapi-codegen/v2 version v2.5.1 DO NOT EDIT.
package masteryapi

import (
	"context"
	"fmt"
	"net/http"
	"time"

	"github.com/gorilla/mux"
	"github.com/oapi-codegen/runtime"
	openapi_types "github.com/oapi-codegen/runtime/types"
)

const (
	BearerAuthScopes = "BearerAuth.Scopes"
)

// Defines values for MasteryMasteryType.
const (
	MasteryMasteryTypeDungeon     MasteryMasteryType = "dungeon"
	MasteryMasteryTypeExploration MasteryMasteryType = "exploration"
	MasteryMasteryTypePvp         MasteryMasteryType = "pvp"
	MasteryMasteryTypeRaid        MasteryMasteryType = "raid"
	MasteryMasteryTypeWorldBoss   MasteryMasteryType = "world_boss"
)

// Defines values for MasteryProgressMasteryType.
const (
	MasteryProgressMasteryTypeDungeon     MasteryProgressMasteryType = "dungeon"
	MasteryProgressMasteryTypeExploration MasteryProgressMasteryType = "exploration"
	MasteryProgressMasteryTypePvp         MasteryProgressMasteryType = "pvp"
	MasteryProgressMasteryTypeRaid        MasteryProgressMasteryType = "raid"
	MasteryProgressMasteryTypeWorldBoss   MasteryProgressMasteryType = "world_boss"
)

// Defines values for MasteryRewardsRewardsMasteryType.
const (
	MasteryRewardsRewardsMasteryTypeDungeon     MasteryRewardsRewardsMasteryType = "dungeon"
	MasteryRewardsRewardsMasteryTypeExploration MasteryRewardsRewardsMasteryType = "exploration"
	MasteryRewardsRewardsMasteryTypePvp         MasteryRewardsRewardsMasteryType = "pvp"
	MasteryRewardsRewardsMasteryTypeRaid        MasteryRewardsRewardsMasteryType = "raid"
	MasteryRewardsRewardsMasteryTypeWorldBoss   MasteryRewardsRewardsMasteryType = "world_boss"
)

// Defines values for GetMasteryRewardsParamsMasteryType.
const (
	GetMasteryRewardsParamsMasteryTypeDungeon     GetMasteryRewardsParamsMasteryType = "dungeon"
	GetMasteryRewardsParamsMasteryTypeExploration GetMasteryRewardsParamsMasteryType = "exploration"
	GetMasteryRewardsParamsMasteryTypePvp         GetMasteryRewardsParamsMasteryType = "pvp"
	GetMasteryRewardsParamsMasteryTypeRaid        GetMasteryRewardsParamsMasteryType = "raid"
	GetMasteryRewardsParamsMasteryTypeWorldBoss   GetMasteryRewardsParamsMasteryType = "world_boss"
)

// Defines values for GetMasteryProgressParamsType.
const (
	Dungeon     GetMasteryProgressParamsType = "dungeon"
	Exploration GetMasteryProgressParamsType = "exploration"
	Pvp         GetMasteryProgressParamsType = "pvp"
	Raid        GetMasteryProgressParamsType = "raid"
	WorldBoss   GetMasteryProgressParamsType = "world_boss"
)

// Error defines model for Error.
type Error struct {
	// Code Код ошибки
	Code *string `json:"code"`

	// Details Дополнительные детали ошибки
	Details *map[string]interface{} `json:"details"`

	// Error Тип ошибки
	Error string `json:"error"`

	// Message Сообщение об ошибке
	Message string `json:"message"`
}

// Mastery defines model for Mastery.
type Mastery struct {
	ExperienceCurrent  *int                `json:"experience_current,omitempty"`
	ExperienceRequired *int                `json:"experience_required,omitempty"`
	MasteryLevel       *int                `json:"mastery_level,omitempty"`
	MasteryType        *MasteryMasteryType `json:"mastery_type,omitempty"`
	RewardsUnlocked    *[]struct {
		Level      *int    `json:"level,omitempty"`
		RewardId   *string `json:"reward_id,omitempty"`
		RewardType *string `json:"reward_type,omitempty"`
	} `json:"rewards_unlocked,omitempty"`
}

// MasteryMasteryType defines model for Mastery.MasteryType.
type MasteryMasteryType string

// MasteryLevels defines model for MasteryLevels.
type MasteryLevels struct {
	CharacterId *openapi_types.UUID `json:"character_id,omitempty"`
	Masteries   *[]Mastery          `json:"masteries,omitempty"`
}

// MasteryProgress defines model for MasteryProgress.
type MasteryProgress struct {
	CharacterId        *openapi_types.UUID         `json:"character_id,omitempty"`
	CompletionsCount   *int                        `json:"completions_count,omitempty"`
	ExperienceCurrent  *int                        `json:"experience_current,omitempty"`
	ExperienceRequired *int                        `json:"experience_required,omitempty"`
	MasteryLevel       *int                        `json:"mastery_level,omitempty"`
	MasteryType        *MasteryProgressMasteryType `json:"mastery_type,omitempty"`
	ProgressPercent    *float32                    `json:"progress_percent,omitempty"`
	RewardsUnlocked    *[]struct {
		Level      *int       `json:"level,omitempty"`
		RewardId   *string    `json:"reward_id,omitempty"`
		RewardType *string    `json:"reward_type,omitempty"`
		UnlockedAt *time.Time `json:"unlocked_at,omitempty"`
	} `json:"rewards_unlocked,omitempty"`
	TotalExperienceEarned *int `json:"total_experience_earned,omitempty"`
}

// MasteryProgressMasteryType defines model for MasteryProgress.MasteryType.
type MasteryProgressMasteryType string

// MasteryRewards defines model for MasteryRewards.
type MasteryRewards struct {
	CharacterId *openapi_types.UUID `json:"character_id,omitempty"`
	Rewards     *[]struct {
		Level       *int                              `json:"level,omitempty"`
		MasteryType *MasteryRewardsRewardsMasteryType `json:"mastery_type,omitempty"`
		RewardId    *string                           `json:"reward_id,omitempty"`
		RewardName  *string                           `json:"reward_name,omitempty"`
		RewardType  *string                           `json:"reward_type,omitempty"`
		Unlocked    *bool                             `json:"unlocked,omitempty"`
		UnlockedAt  *time.Time                        `json:"unlocked_at"`
	} `json:"rewards,omitempty"`
}

// MasteryRewardsRewardsMasteryType defines model for MasteryRewards.Rewards.MasteryType.
type MasteryRewardsRewardsMasteryType string

// InternalServerError defines model for InternalServerError.
type InternalServerError = Error

// NotFound defines model for NotFound.
type NotFound = Error

// Unauthorized defines model for Unauthorized.
type Unauthorized = Error

// GetMasteryLevelsParams defines parameters for GetMasteryLevels.
type GetMasteryLevelsParams struct {
	// CharacterId Идентификатор персонажа
	CharacterId openapi_types.UUID `form:"character_id" json:"character_id"`
}

// GetMasteryRewardsParams defines parameters for GetMasteryRewards.
type GetMasteryRewardsParams struct {
	// CharacterId Идентификатор персонажа
	CharacterId openapi_types.UUID `form:"character_id" json:"character_id"`

	// MasteryType Фильтр по типу мастерства (опционально)
	MasteryType *GetMasteryRewardsParamsMasteryType `form:"mastery_type,omitempty" json:"mastery_type,omitempty"`
}

// GetMasteryRewardsParamsMasteryType defines parameters for GetMasteryRewards.
type GetMasteryRewardsParamsMasteryType string

// GetMasteryProgressParams defines parameters for GetMasteryProgress.
type GetMasteryProgressParams struct {
	// CharacterId Идентификатор персонажа
	CharacterId openapi_types.UUID `form:"character_id" json:"character_id"`
}

// GetMasteryProgressParamsType defines parameters for GetMasteryProgress.
type GetMasteryProgressParamsType string

// ServerInterface represents all server handlers.
type ServerInterface interface {
	// Получить уровни мастерства
	// (GET /mastery/levels)
	GetMasteryLevels(w http.ResponseWriter, r *http.Request, params GetMasteryLevelsParams)
	// Получить награды мастерства
	// (GET /mastery/rewards)
	GetMasteryRewards(w http.ResponseWriter, r *http.Request, params GetMasteryRewardsParams)
	// Получить прогресс мастерства по типу
	// (GET /mastery/{type}/progress)
	GetMasteryProgress(w http.ResponseWriter, r *http.Request, pType GetMasteryProgressParamsType, params GetMasteryProgressParams)
}

// ServerInterfaceWrapper converts contexts to parameters.
type ServerInterfaceWrapper struct {
	Handler            ServerInterface
	HandlerMiddlewares []MiddlewareFunc
	ErrorHandlerFunc   func(w http.ResponseWriter, r *http.Request, err error)
}

type MiddlewareFunc func(http.Handler) http.Handler

// GetMasteryLevels operation middleware
func (siw *ServerInterfaceWrapper) GetMasteryLevels(w http.ResponseWriter, r *http.Request) {

	var err error

	ctx := r.Context()

	ctx = context.WithValue(ctx, BearerAuthScopes, []string{})

	r = r.WithContext(ctx)

	// Parameter object where we will unmarshal all parameters from the context
	var params GetMasteryLevelsParams

	// ------------- Required query parameter "character_id" -------------

	if paramValue := r.URL.Query().Get("character_id"); paramValue != "" {

	} else {
		siw.ErrorHandlerFunc(w, r, &RequiredParamError{ParamName: "character_id"})
		return
	}

	err = runtime.BindQueryParameter("form", true, true, "character_id", r.URL.Query(), &params.CharacterId)
	if err != nil {
		siw.ErrorHandlerFunc(w, r, &InvalidParamFormatError{ParamName: "character_id", Err: err})
		return
	}

	handler := http.Handler(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		siw.Handler.GetMasteryLevels(w, r, params)
	}))

	for _, middleware := range siw.HandlerMiddlewares {
		handler = middleware(handler)
	}

	handler.ServeHTTP(w, r)
}

// GetMasteryRewards operation middleware
func (siw *ServerInterfaceWrapper) GetMasteryRewards(w http.ResponseWriter, r *http.Request) {

	var err error

	ctx := r.Context()

	ctx = context.WithValue(ctx, BearerAuthScopes, []string{})

	r = r.WithContext(ctx)

	// Parameter object where we will unmarshal all parameters from the context
	var params GetMasteryRewardsParams

	// ------------- Required query parameter "character_id" -------------

	if paramValue := r.URL.Query().Get("character_id"); paramValue != "" {

	} else {
		siw.ErrorHandlerFunc(w, r, &RequiredParamError{ParamName: "character_id"})
		return
	}

	err = runtime.BindQueryParameter("form", true, true, "character_id", r.URL.Query(), &params.CharacterId)
	if err != nil {
		siw.ErrorHandlerFunc(w, r, &InvalidParamFormatError{ParamName: "character_id", Err: err})
		return
	}

	// ------------- Optional query parameter "mastery_type" -------------

	err = runtime.BindQueryParameter("form", true, false, "mastery_type", r.URL.Query(), &params.MasteryType)
	if err != nil {
		siw.ErrorHandlerFunc(w, r, &InvalidParamFormatError{ParamName: "mastery_type", Err: err})
		return
	}

	handler := http.Handler(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		siw.Handler.GetMasteryRewards(w, r, params)
	}))

	for _, middleware := range siw.HandlerMiddlewares {
		handler = middleware(handler)
	}

	handler.ServeHTTP(w, r)
}

// GetMasteryProgress operation middleware
func (siw *ServerInterfaceWrapper) GetMasteryProgress(w http.ResponseWriter, r *http.Request) {

	var err error

	// ------------- Path parameter "type" -------------
	var pType GetMasteryProgressParamsType

	err = runtime.BindStyledParameterWithOptions("simple", "type", mux.Vars(r)["type"], &pType, runtime.BindStyledParameterOptions{Explode: false, Required: true})
	if err != nil {
		siw.ErrorHandlerFunc(w, r, &InvalidParamFormatError{ParamName: "type", Err: err})
		return
	}

	ctx := r.Context()

	ctx = context.WithValue(ctx, BearerAuthScopes, []string{})

	r = r.WithContext(ctx)

	// Parameter object where we will unmarshal all parameters from the context
	var params GetMasteryProgressParams

	// ------------- Required query parameter "character_id" -------------

	if paramValue := r.URL.Query().Get("character_id"); paramValue != "" {

	} else {
		siw.ErrorHandlerFunc(w, r, &RequiredParamError{ParamName: "character_id"})
		return
	}

	err = runtime.BindQueryParameter("form", true, true, "character_id", r.URL.Query(), &params.CharacterId)
	if err != nil {
		siw.ErrorHandlerFunc(w, r, &InvalidParamFormatError{ParamName: "character_id", Err: err})
		return
	}

	handler := http.Handler(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		siw.Handler.GetMasteryProgress(w, r, pType, params)
	}))

	for _, middleware := range siw.HandlerMiddlewares {
		handler = middleware(handler)
	}

	handler.ServeHTTP(w, r)
}

type UnescapedCookieParamError struct {
	ParamName string
	Err       error
}

func (e *UnescapedCookieParamError) Error() string {
	return fmt.Sprintf("error unescaping cookie parameter '%s'", e.ParamName)
}

func (e *UnescapedCookieParamError) Unwrap() error {
	return e.Err
}

type UnmarshalingParamError struct {
	ParamName string
	Err       error
}

func (e *UnmarshalingParamError) Error() string {
	return fmt.Sprintf("Error unmarshaling parameter %s as JSON: %s", e.ParamName, e.Err.Error())
}

func (e *UnmarshalingParamError) Unwrap() error {
	return e.Err
}

type RequiredParamError struct {
	ParamName string
}

func (e *RequiredParamError) Error() string {
	return fmt.Sprintf("Query argument %s is required, but not found", e.ParamName)
}

type RequiredHeaderError struct {
	ParamName string
	Err       error
}

func (e *RequiredHeaderError) Error() string {
	return fmt.Sprintf("Header parameter %s is required, but not found", e.ParamName)
}

func (e *RequiredHeaderError) Unwrap() error {
	return e.Err
}

type InvalidParamFormatError struct {
	ParamName string
	Err       error
}

func (e *InvalidParamFormatError) Error() string {
	return fmt.Sprintf("Invalid format for parameter %s: %s", e.ParamName, e.Err.Error())
}

func (e *InvalidParamFormatError) Unwrap() error {
	return e.Err
}

type TooManyValuesForParamError struct {
	ParamName string
	Count     int
}

func (e *TooManyValuesForParamError) Error() string {
	return fmt.Sprintf("Expected one value for %s, got %d", e.ParamName, e.Count)
}

// Handler creates http.Handler with routing matching OpenAPI spec.
func Handler(si ServerInterface) http.Handler {
	return HandlerWithOptions(si, GorillaServerOptions{})
}

type GorillaServerOptions struct {
	BaseURL          string
	BaseRouter       *mux.Router
	Middlewares      []MiddlewareFunc
	ErrorHandlerFunc func(w http.ResponseWriter, r *http.Request, err error)
}

// HandlerFromMux creates http.Handler with routing matching OpenAPI spec based on the provided mux.
func HandlerFromMux(si ServerInterface, r *mux.Router) http.Handler {
	return HandlerWithOptions(si, GorillaServerOptions{
		BaseRouter: r,
	})
}

func HandlerFromMuxWithBaseURL(si ServerInterface, r *mux.Router, baseURL string) http.Handler {
	return HandlerWithOptions(si, GorillaServerOptions{
		BaseURL:    baseURL,
		BaseRouter: r,
	})
}

// HandlerWithOptions creates http.Handler with additional options
func HandlerWithOptions(si ServerInterface, options GorillaServerOptions) http.Handler {
	r := options.BaseRouter

	if r == nil {
		r = mux.NewRouter()
	}
	if options.ErrorHandlerFunc == nil {
		options.ErrorHandlerFunc = func(w http.ResponseWriter, r *http.Request, err error) {
			http.Error(w, err.Error(), http.StatusBadRequest)
		}
	}
	wrapper := ServerInterfaceWrapper{
		Handler:            si,
		HandlerMiddlewares: options.Middlewares,
		ErrorHandlerFunc:   options.ErrorHandlerFunc,
	}

	r.HandleFunc(options.BaseURL+"/mastery/levels", wrapper.GetMasteryLevels).Methods("GET")

	r.HandleFunc(options.BaseURL+"/mastery/rewards", wrapper.GetMasteryRewards).Methods("GET")

	r.HandleFunc(options.BaseURL+"/mastery/{type}/progress", wrapper.GetMasteryProgress).Methods("GET")

	return r
}
