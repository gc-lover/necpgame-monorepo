openapi: 3.0.3
info:
  title: Relationship Service API - Enterprise-Grade Social Domain Service
  description: '**Enterprise-Grade Relationship Management API for NECPGAME Social
    Domain**

    This API manages all character relationships in the cyberpunk MMOFPS RPG, including
    friendship, romance, rivalry, mentorship, and business connections between players.

    ## Key Features

    - **Multi-Type Relationships**: Friendship, romance, rivalry, mentorship, business
    - **Dynamic Relationship Levels**: Intensity tracking from -10 to +10 - **Reputation
    System**: Community standing and trust metrics - **Social History**: Interaction
    tracking and relationship evolution - **Performance Optimized**: MMOFPS-grade
    performance with <50ms P99 latency

    ## Domain Purpose

    The Relationship domain handles all social connections between characters in Night
    City. Players form alliances, rivalries, romantic connections, and mentorship
    bonds that affect gameplay, reputation, and community standing.

    ## Performance Targets

    - P99 Latency: <50ms for relationship operations, <30ms for reputation queries
    - Memory: <60KB per active user relationship network - Concurrent users: 75,000+
    simultaneous relationship updates - Database queries: <25ms average response time

    '
  version: 1.0.0
  contact:
    name: NECPGAME API Support
    url: https://necpgame.com/support
    email: api@necpgame.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
- url: https://api.necpgame.com/v1/relationship
  description: Production server
- url: https://staging-api.necpgame.com/v1/relationship
  description: Staging server
- url: http://localhost:8080/api/v1/relationship
  description: Local development server
security:
- BearerAuth: []
tags:
- name: Relationships
  description: Core relationship management
- name: Friendship
  description: Friendship-specific operations
- name: Reputation
  description: Reputation and trust metrics
- name: Social Network
  description: Social graph and connections
- name: Mentorship
  description: Mentorship and guidance relationships
- name: Romance
  description: Romantic relationship management
- name: Rivalry
  description: Rivalry and conflict tracking
- name: Health Monitoring
  description: System health and performance monitoring
paths:
  /health:
    $ref: ./paths/health.yaml#/paths/~1health
  /health/batch:
    $ref: ./paths/health-batch.yaml#/paths/~1health~1batch
  /relationships:
    $ref: ./paths/relationships.yaml#/paths/~1relationships
  /relationships/{relationshipId}:
    $ref: ./paths/relationships-{relationshipId}.yaml#/paths/~1relationships~1{relationshipId}
  /relationships/search:
    $ref: ./paths/relationships-search.yaml#/paths/~1relationships~1search
  /friendships:
    $ref: ./paths/friendships.yaml#/paths/~1friendships
  /friendships/{friendshipId}:
    $ref: ./paths/friendships-{friendshipId}.yaml#/paths/~1friendships~1{friendshipId}
  /reputation/{userId}:
    $ref: ./paths/reputation-{userId}.yaml#/paths/~1reputation~1{userId}
  /reputation/{userId}/history:
    $ref: ./paths/reputation-{userId}-history.yaml#/paths/~1reputation~1{userId}~1history
  /reputation/events:
    $ref: ./paths/reputation-events.yaml#/paths/~1reputation~1events
  /reputation/quest-triggers:
    $ref: ./paths/reputation-quest-triggers.yaml#/paths/~1reputation~1quest-triggers
  /social-network/{userId}/connections:
    $ref: ./paths/social-network-{userId}-connections.yaml#/paths/~1social-network~1{userId}~1connections
  /social-network/{userId}/influence:
    $ref: ./paths/social-network-{userId}-influence.yaml#/paths/~1social-network~1{userId}~1influence
  /mentorship:
    $ref: ./paths/mentorship.yaml#/paths/~1mentorship
  /mentorship/{mentorshipId}:
    $ref: ./paths/mentorship-{mentorshipId}.yaml#/paths/~1mentorship~1{mentorshipId}
  /mentorship/{mentorshipId}/progress:
    $ref: ./paths/mentorship-{mentorshipId}-progress.yaml#/paths/~1mentorship~1{mentorshipId}~1progress
  /romance:
    $ref: ./paths/romance.yaml#/paths/~1romance
  /romance/proposals:
    $ref: ./paths/romance-proposals.yaml#/paths/~1romance~1proposals
  /rivalries:
    $ref: ./paths/rivalries.yaml#/paths/~1rivalries
components:
  schemas:
    RelationshipResponse:
      allOf:
      - $ref: ../common/schemas/social-entities.yaml#/RelationshipEntity
      - type: object
        properties:
          character_profile:
            $ref: ../common/schemas/social-entities.yaml#/UserProfileEntity
          target_profile:
            $ref: ../common/schemas/social-entities.yaml#/UserProfileEntity
          is_mutual:
            type: boolean
            description: Whether relationship is mutual
            example: true
          last_interaction_at:
            $ref: ../common/schemas/common.yaml#/Timestamp
    RelationshipDetailResponse:
      allOf:
      - $ref: '#/components/schemas/RelationshipResponse'
      - type: object
        properties:
          history:
            type: array
            items:
              type: object
              properties:
                event_type:
                  type: string
                  enum:
                  - created
                  - level_changed
                  - interaction
                  - terminated
                timestamp:
                  $ref: ../common/schemas/common.yaml#/Timestamp
                description:
                  type: string
                  maxLength: 200
                level_change:
                  type: integer
                  description: Change in relationship level
          statistics:
            type: object
            properties:
              total_interactions:
                type: integer
                example: 45
              average_level:
                type: number
                example: 6.2
              relationship_duration_days:
                type: integer
                example: 127
    CreateRelationshipRequest:
      type: object
      required:
      - target_id
      - type
      properties:
        target_id:
          type: string
          format: uuid
          description: Target character ID
        type:
          type: string
          enum:
          - friendship
          - romance
          - rivalry
          - mentorship
          - business
          - enmity
          description: Type of relationship to create
        initial_level:
          type: integer
          minimum: -10
          maximum: 10
          default: 1
          description: Initial relationship level
        description:
          type: string
          maxLength: 200
          description: Relationship description
        is_public:
          type: boolean
          default: false
          description: Whether relationship is visible to others
    UpdateRelationshipRequest:
      type: object
      properties:
        level:
          type: integer
          minimum: -10
          maximum: 10
          description: New relationship level
        description:
          type: string
          maxLength: 200
          description: Updated relationship description
        flags:
          type: array
          items:
            type: string
            enum:
            - exclusive
            - public
            - secret
            - temporary
          description: Relationship flags
    FriendshipResponse:
      allOf:
      - $ref: ../common/schemas/social-entities.yaml#/FriendshipEntity
      - type: object
        properties:
          friend_profile:
            $ref: ../common/schemas/social-entities.yaml#/UserProfileEntity
          friendship_level:
            type: integer
            minimum: 1
            maximum: 10
            description: Friendship intimacy level
            example: 7
    SendFriendRequest:
      type: object
      required:
      - friend_id
      properties:
        friend_id: null
        message:
          type: string
          maxLength: 200
          description: Optional message with the request
    FriendRequestResponse:
      type: object
      properties:
        friendship_id:
          $ref: ../common/schemas/common.yaml#/UUID
        status:
          type: string
          enum:
          - pending
          - accepted
          - declined
          example: pending
        requested_at:
          $ref: ../common/schemas/common.yaml#/Timestamp
        message:
          type: string
    UserReputationResponse:
      type: object
      properties:
        user_id:
          $ref: ../common/schemas/common.yaml#/UUID
        overall_score:
          type: integer
          minimum: -1000
          maximum: 1000
          description: Overall reputation score
          example: 450
        categories:
          type: object
          properties:
            trading:
              $ref: '#/components/schemas/ReputationCategory'
            combat:
              $ref: '#/components/schemas/ReputationCategory'
            social:
              $ref: '#/components/schemas/ReputationCategory'
            leadership:
              $ref: '#/components/schemas/ReputationCategory'
            craftsmanship:
              $ref: '#/components/schemas/ReputationCategory'
            reliability:
              $ref: '#/components/schemas/ReputationCategory'
            generosity:
              $ref: '#/components/schemas/ReputationCategory'
            combat_skill:
              $ref: '#/components/schemas/ReputationCategory'
        evidence_count:
          type: integer
          description: Total number of reputation events
          example: 127
        last_updated:
          $ref: ../common/schemas/common.yaml#/Timestamp
    ReputationCategory:
      type: object
      properties:
        score:
          type: integer
          minimum: -100
          maximum: 100
          description: Category-specific reputation score
          example: 35
        evidence_count:
          type: integer
          description: Number of events in this category
          example: 23
        trend:
          type: string
          enum:
          - improving
          - stable
          - declining
          description: Reputation trend in this category
          example: improving
    ReputationEventResponse:
      allOf:
      - $ref: ../common/schemas/social-entities.yaml#/ReputationEntity
      - type: object
        properties:
          subject_profile:
            $ref: ../common/schemas/social-entities.yaml#/UserProfileEntity
          target_profile:
            $ref: ../common/schemas/social-entities.yaml#/UserProfileEntity
    RecordReputationEventRequest:
      required:
      - subject_id
      - target_id
      - category
      - points
      - description
      properties:
        subject_id:
          $ref: ../common/schemas/common.yaml#/UUID
          description: ID of the player whose reputation is being affected
        target_id:
          $ref: ../common/schemas/common.yaml#/UUID
          description: ID of the target (player, faction, location) of the reputation
            event
        category:
          type: string
          enum:
          - combat
          - social
          - trading
          - leadership
          - craftsmanship
          - reliability
          - generosity
          - combat_skill
          description: Category of reputation being affected
        points:
          type: integer
          minimum: -1000
          maximum: 1000
          description: Points to add/subtract from reputation (positive = gain, negative
            = loss)
        description:
          type: string
          maxLength: 500
          description: Description of the event that affected reputation
        consequences:
          type: array
          items:
            $ref: '#/components/schemas/ReputationConsequence'
          description: Dynamic consequences that should be triggered by this reputation
            change
        quest_triggers:
          type: array
          items:
            $ref: '#/components/schemas/QuestTrigger'
          description: Quest triggers that should be evaluated based on this reputation
            change
    SocialNetworkResponse:
      type: object
      properties:
        user_id:
          $ref: ../common/schemas/common.yaml#/UUID
        connections:
          type: array
          items:
            type: object
            properties:
              character:
                $ref: ../common/schemas/social-entities.yaml#/UserProfileEntity
              relationship:
                $ref: '#/components/schemas/RelationshipResponse'
              connection_path:
                type: array
                items:
                  type: object
                  properties:
                    character_id:
                      $ref: ../common/schemas/common.yaml#/UUID
                    relationship_type:
                      type: string
                    relationship_level:
                      type: integer
                description: Path of connections to reach this character
        network_stats:
          type: object
          properties:
            total_connections:
              type: integer
              example: 156
            average_relationship_level:
              type: number
              example: 4.2
            network_density:
              type: number
              minimum: 0
              maximum: 1
              description: Network connectivity density (0-1)
              example: 0.23
    SocialInfluenceResponse:
      type: object
      properties:
        user_id:
          $ref: ../common/schemas/common.yaml#/UUID
        influence_score:
          type: integer
          minimum: 0
          maximum: 1000
          description: Overall social influence score
          example: 387
        influence_factors:
          type: object
          properties:
            reputation_weight:
              type: number
              description: Influence from reputation
              example: 0.4
            network_size_weight:
              type: number
              description: Influence from network size
              example: 0.3
            relationship_quality_weight:
              type: number
              description: Influence from relationship quality
              example: 0.3
        influence_rank:
          type: integer
          description: Rank among all players
          example: 1247
        percentile:
          type: number
          minimum: 0
          maximum: 100
          description: Percentile ranking
          example: 78.5
    MentorshipResponse:
      type: object
      allOf:
      - $ref: ../common/schemas/social-entities.yaml#/RelationshipEntity
      - type: object
        required:
        - mentor_id
        - mentee_id
        - contract_terms
        properties:
          mentor_id:
            $ref: ../common/schemas/common.yaml#/UUID
          mentee_id:
            $ref: ../common/schemas/common.yaml#/UUID
          contract_terms:
            type: object
            properties:
              duration_days:
                type: integer
                minimum: 30
                description: Contract duration in days
                example: 90
              skills_to_teach:
                type: array
                items:
                  type: string
                  maxLength: 50
                description: Skills the mentor will teach
              payment_terms:
                type: object
                properties:
                  currency:
                    type: string
                    default: credits
                  amount:
                    type: integer
                    minimum: 0
                  schedule:
                    type: string
                    enum:
                    - weekly
                    - monthly
                    - completion
          progress:
            type: object
            properties:
              lessons_completed:
                type: integer
                example: 12
              skills_improved:
                type: array
                items:
                  type: object
                  properties:
                    skill_name:
                      type: string
                    improvement_percent:
                      type: integer
                      minimum: 0
                      maximum: 100
              satisfaction_rating:
                type: integer
                minimum: 1
                maximum: 5
          status:
            type: string
            enum:
            - active
            - completed
            - terminated
            - paused
            example: active
    InitiateMentorshipRequest:
      type: object
      required:
      - target_id
      - skills_to_teach
      properties:
        target_id:
          type: string
          format: uuid
          description: Target character ID
        skills_to_teach:
          type: array
          items:
            type: string
            maxLength: 50
          minItems: 1
          maxItems: 10
          description: Skills the mentor will teach
        contract_terms:
          type: object
          properties:
            duration_days:
              type: integer
              minimum: 30
              maximum: 365
              default: 90
            payment_amount:
              type: integer
              minimum: 0
              default: 0
            payment_schedule:
              type: string
              enum:
              - weekly
              - monthly
              - completion
              default: completion
    UpdateMentorshipRequest:
      type: object
      properties:
        status:
          type: string
          enum:
          - active
          - completed
          - terminated
          - paused
        contract_terms:
          $ref: '#/components/schemas/InitiateMentorshipRequest/properties/contract_terms'
        progress_notes:
          type: string
          maxLength: 500
          description: Notes about mentorship progress
    RecordProgressRequest:
      type: object
      required:
      - progress_type
      - description
      properties:
        progress_type:
          type: string
          enum:
          - lesson_completed
          - skill_improved
          - milestone_achieved
          - issue_resolved
        description:
          type: string
          minLength: 10
          maxLength: 300
          description: Description of the progress made
        skill_improvements:
          type: array
          items:
            type: object
            required:
            - skill_name
            - improvement_percent
            properties:
              skill_name:
                type: string
                maxLength: 50
              improvement_percent:
                type: integer
                minimum: 1
                maximum: 100
        lesson_rating:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating of the lesson/mentoring session
    MentorshipProgressResponse:
      type: object
      properties:
        progress_id:
          $ref: ../common/schemas/common.yaml#/UUID
        mentorship_id:
          $ref: ../common/schemas/common.yaml#/UUID
        recorded_at:
          $ref: ../common/schemas/common.yaml#/Timestamp
        progress_type:
          type: string
          enum:
          - lesson_completed
          - skill_improved
          - milestone_achieved
          - issue_resolved
        description:
          type: string
        skill_improvements:
          type: array
          items:
            type: object
            properties:
              skill_name:
                type: string
              improvement_percent:
                type: integer
    RomanticRelationshipResponse:
      allOf:
      - $ref: '#/components/schemas/RelationshipResponse'
      - type: object
        properties:
          romantic_status:
            type: string
            enum:
            - dating
            - engaged
            - married
            - separated
            - divorced
            example: dating
          privacy_level:
            type: string
            enum:
            - private
            - friends
            - public
            example: private
          anniversary:
            $ref: ../common/schemas/common.yaml#/Timestamp
          engagement_details:
            type: object
            properties:
              ring_item_id:
                $ref: ../common/schemas/common.yaml#/UUID
              proposal_date:
                $ref: ../common/schemas/common.yaml#/Timestamp
              proposal_message:
                type: string
                maxLength: 500
    RomanticProposalRequest:
      type: object
      required:
      - target_id
      - proposal_type
      properties:
        target_id:
          type: string
          format: uuid
          description: Target character ID
        proposal_type:
          type: string
          enum:
          - date
          - relationship
          - engagement
          - marriage
          description: Type of romantic proposal
        message:
          type: string
          minLength: 10
          maxLength: 300
          description: Personal message with the proposal
        privacy_level:
          type: string
          enum:
          - private
          - friends
          - public
          default: private
    RomanticProposalResponse:
      type: object
      properties:
        proposal_id:
          $ref: ../common/schemas/common.yaml#/UUID
        status:
          type: string
          enum:
          - pending
          - accepted
          - declined
          example: pending
        expires_at:
          $ref: ../common/schemas/common.yaml#/Timestamp
        proposal_type:
          type: string
          enum:
          - date
          - relationship
          - engagement
          - marriage
    RivalryResponse:
      allOf:
      - $ref: '#/components/schemas/RelationshipResponse'
      - type: object
        properties:
          rivalry_intensity:
            type: string
            enum:
            - minor
            - moderate
            - major
            - deadly
            example: moderate
          rivalry_reason:
            type: string
            maxLength: 300
            description: Reason for the rivalry
            example: Competed for the same bounty
          active_conflicts:
            type: integer
            description: Number of active conflicts
            example: 2
          last_conflict_at:
            $ref: ../common/schemas/common.yaml#/Timestamp
    DeclareRivalryRequest:
      type: object
      required:
      - target_id
      - reason
      properties:
        target_id:
          type: string
          format: uuid
          description: Target character ID
        reason:
          type: string
          minLength: 10
          maxLength: 300
          description: Reason for declaring rivalry
        initial_intensity:
          type: string
          enum:
          - minor
          - moderate
          - major
          - deadly
          default: moderate
        is_public:
          type: boolean
          default: true
          description: Whether rivalry declaration is public
    ReputationConsequence:
      type: object
      required:
      - type
      - target
      properties:
        type:
          type: string
          enum:
          - social_penalty
          - economic_penalty
          - quest_penalty
          - faction_penalty
          - access_restriction
          - relationship_damage
          description: Type of consequence triggered by reputation change
        target:
          type: string
          enum:
          - player
          - faction
          - location
          - global
          description: Scope of the consequence
        severity:
          type: string
          enum:
          - minor
          - moderate
          - major
          - critical
          default: moderate
          description: Severity level of the consequence
        duration_hours:
          type: integer
          minimum: 1
          maximum: 8760
          description: How long the consequence lasts (in hours)
        description:
          type: string
          maxLength: 200
          description: Human-readable description of the consequence
        parameters:
          type: object
          description: Additional parameters specific to the consequence type
          properties:
            penalty_multiplier:
              type: number
              minimum: 0.1
              maximum: 5.0
              description: Multiplier for penalties
            affected_entities:
              type: array
              items:
                type: string
                format: uuid
              description: IDs of entities affected by this consequence
    QuestTrigger:
      type: object
      required:
      - quest_id
      - trigger_type
      properties:
        quest_id:
          type: string
          description: ID of the quest that may be triggered
        trigger_type:
          type: string
          enum:
          - unlock
          - block
          - modify_requirements
          - change_rewards
          description: Type of trigger action
        condition:
          $ref: '#/components/schemas/ReputationCondition'
          description: Reputation condition that must be met for trigger
        priority:
          type: integer
          minimum: 1
          maximum: 100
          default: 50
          description: Priority of this trigger (higher = more important)
    ReputationCondition:
      type: object
      required:
      - category
      - operator
      - threshold
      properties:
        category:
          type: string
          enum:
          - combat
          - social
          - trading
          - leadership
          - craftsmanship
          - reliability
          - generosity
          - combat_skill
          - overall
          description: Reputation category to check
        operator:
          type: string
          enum:
          - greater_than
          - less_than
          - equal
          - greater_equal
          - less_equal
          - between
          description: Comparison operator
        threshold:
          type: integer
          minimum: -1000
          maximum: 1000
          description: Reputation threshold value
        threshold_max:
          type: integer
          minimum: -1000
          maximum: 1000
          description: Upper threshold for 'between' operator
        target:
          type: string
          enum:
          - player
          - faction
          - location
          default: player
          description: Target of reputation check
    EvaluateQuestTriggersRequest:
      type: object
      required:
      - player_id
      - reputation_changes
      properties:
        player_id:
          $ref: ../common/schemas/common.yaml#/UUID
          description: ID of the player whose quest triggers are being evaluated
        reputation_changes:
          type: array
          items:
            type: object
            required:
            - category
            - old_value
            - new_value
            properties:
              category:
                type: string
                enum:
                - combat
                - social
                - trading
                - leadership
                - craftsmanship
                - reliability
                - generosity
                - combat_skill
                description: Reputation category that changed
              old_value:
                type: integer
                minimum: -1000
                maximum: 1000
                description: Previous reputation value
              new_value:
                type: integer
                minimum: -1000
                maximum: 1000
                description: New reputation value
              target_id:
                $ref: ../common/schemas/common.yaml#/UUID
                description: ID of the target (faction/location) if applicable
        evaluate_all_active:
          type: boolean
          default: false
          description: Whether to evaluate all active quest triggers, not just those
            affected by recent changes
    QuestTriggersResponse:
      type: object
      required:
      - player_id
      - triggered_quests
      properties:
        player_id:
          $ref: ../common/schemas/common.yaml#/UUID
          description: ID of the player
        triggered_quests:
          type: array
          items:
            type: object
            required:
            - quest_id
            - trigger_type
            - reason
            properties:
              quest_id:
                type: string
                description: ID of the triggered quest
              trigger_type:
                type: string
                enum:
                - unlocked
                - blocked
                - requirements_modified
                - rewards_modified
                description: Type of trigger that occurred
              reason:
                type: string
                maxLength: 200
                description: Explanation of why this quest was triggered
              quest_details:
                type: object
                description: Additional quest information
                properties:
                  title:
                    type: string
                    description: Quest title
                  category:
                    type: string
                    description: Quest category
                  level_requirement:
                    type: integer
                    description: Required player level
              metadata:
                type: object
                description: Additional metadata about the trigger
        evaluated_triggers:
          type: integer
          description: Total number of triggers evaluated
        execution_time_ms:
          type: number
          description: Time taken to evaluate triggers (in milliseconds)
  responses:
    OK:
      $ref: ../common/responses/success.yaml#/OK
    Created:
      $ref: ../common/responses/success.yaml#/Created
    Updated:
      $ref: ../common/responses/success.yaml#/Updated
    Deleted:
      $ref: ../common/responses/success.yaml#/Deleted
    BadRequest:
      $ref: ../common/responses/error.yaml#/BadRequest
    Unauthorized:
      $ref: ../common/responses/error.yaml#/Unauthorized
    Forbidden:
      $ref: ../common/responses/error.yaml#/Forbidden
    NotFound:
      $ref: ../common/responses/error.yaml#/NotFound
    Conflict:
      $ref: ../common/responses/error.yaml#/Conflict
    TooManyRequests:
      $ref: ../common/responses/error.yaml#/TooManyRequests
  securitySchemes:
    BearerAuth:
      $ref: ../common/security/security.yaml#/BearerAuth
    ApiKeyAuth:
      $ref: ../common/security/security.yaml#/ApiKeyAuth
    ServiceAuth:
      $ref: ../common/security/security.yaml#/ServiceAuth
