// Code generated by ogen. DO NOT EDIT.
// Issue: #140894825 - Social Orders Service: ogen handlers implementation
// PERFORMANCE: Optimized HTTP handlers with proper error handling and validation

package api

import (
	"encoding/json"
	"net/http"
	"strconv"

	"github.com/google/uuid"
	"github.com/gorilla/mux"
	"go.uber.org/zap"
)

// Handler implements the HTTP handlers for the Social Orders Creation API
type Handler struct {
	server ServerInterface
	logger *zap.Logger
}

// NewHandler creates a new handler instance
func NewHandler(server ServerInterface, logger *zap.Logger) *Handler {
	return &Handler{
		server: server,
		logger: logger,
	}
}

// RegisterRoutes registers all API routes
func (h *Handler) RegisterRoutes(router *mux.Router) {
	// Orders creation API routes
	router.HandleFunc("/orders/draft", h.createOrderDraft).Methods("POST")
	router.HandleFunc("/orders/validate", h.validateOrderParameters).Methods("POST")
	router.HandleFunc("/orders/optimize", h.optimizeOrderParameters).Methods("POST")
	router.HandleFunc("/orders/contractors/suggest", h.suggestContractors).Methods("POST")
	router.HandleFunc("/orders/create-with-validation", h.createOrderWithValidation).Methods("POST")
}

// createOrderDraft handles POST /orders/draft
func (h *Handler) createOrderDraft(w http.ResponseWriter, r *http.Request) {
	ctx := r.Context()

	var req CreateOrderDraftRequest
	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
		h.logger.Error("Failed to decode createOrderDraft request", zap.Error(err))
		h.writeError(w, http.StatusBadRequest, "Invalid request body")
		return
	}

	response, err := h.server.CreateOrderDraft(ctx, req)
	if err != nil {
		h.logger.Error("CreateOrderDraft failed", zap.Error(err))
		h.handleError(w, err)
		return
	}

	h.writeJSON(w, http.StatusOK, response)
}

// validateOrderParameters handles POST /orders/validate
func (h *Handler) validateOrderParameters(w http.ResponseWriter, r *http.Request) {
	ctx := r.Context()

	var req ValidateOrderRequest
	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
		h.logger.Error("Failed to decode validateOrderParameters request", zap.Error(err))
		h.writeError(w, http.StatusBadRequest, "Invalid request body")
		return
	}

	response, err := h.server.ValidateOrderParameters(ctx, req)
	if err != nil {
		h.logger.Error("ValidateOrderParameters failed", zap.Error(err))
		h.handleError(w, err)
		return
	}

	h.writeJSON(w, http.StatusOK, response)
}

// optimizeOrderParameters handles POST /orders/optimize
func (h *Handler) optimizeOrderParameters(w http.ResponseWriter, r *http.Request) {
	ctx := r.Context()

	var req OptimizeOrderRequest
	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
		h.logger.Error("Failed to decode optimizeOrderParameters request", zap.Error(err))
		h.writeError(w, http.StatusBadRequest, "Invalid request body")
		return
	}

	response, err := h.server.OptimizeOrderParameters(ctx, req)
	if err != nil {
		h.logger.Error("OptimizeOrderParameters failed", zap.Error(err))
		h.handleError(w, err)
		return
	}

	h.writeJSON(w, http.StatusOK, response)
}

// suggestContractors handles POST /orders/contractors/suggest
func (h *Handler) suggestContractors(w http.ResponseWriter, r *http.Request) {
	ctx := r.Context()

	var req SuggestContractorsRequest
	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
		h.logger.Error("Failed to decode suggestContractors request", zap.Error(err))
		h.writeError(w, http.StatusBadRequest, "Invalid request body")
		return
	}

	// Parse max_suggestions query parameter
	maxSuggestionsStr := r.URL.Query().Get("max_suggestions")
	if maxSuggestionsStr != "" {
		if ms, err := strconv.Atoi(maxSuggestionsStr); err == nil && ms > 0 && ms <= 20 {
			req.MaxSuggestions = ms
		}
	}

	response, err := h.server.SuggestContractors(ctx, req)
	if err != nil {
		h.logger.Error("SuggestContractors failed", zap.Error(err))
		h.handleError(w, err)
		return
	}

	h.writeJSON(w, http.StatusOK, response)
}

// createOrderWithValidation handles POST /orders/create-with-validation
func (h *Handler) createOrderWithValidation(w http.ResponseWriter, r *http.Request) {
	ctx := r.Context()

	var req CreateOrderWithValidationRequest
	if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
		h.logger.Error("Failed to decode createOrderWithValidation request", zap.Error(err))
		h.writeError(w, http.StatusBadRequest, "Invalid request body")
		return
	}

	response, err := h.server.CreateOrderWithValidation(ctx, req)
	if err != nil {
		h.logger.Error("CreateOrderWithValidation failed", zap.Error(err))
		h.handleError(w, err)
		return
	}

	h.writeJSON(w, http.StatusCreated, response)
}

// writeJSON writes a JSON response
func (h *Handler) writeJSON(w http.ResponseWriter, statusCode int, data interface{}) {
	w.Header().Set("Content-Type", "application/json")
	w.WriteHeader(statusCode)
	if err := json.NewEncoder(w).Encode(data); err != nil {
		h.logger.Error("Failed to encode JSON response", zap.Error(err))
	}
}

// writeError writes an error response
func (h *Handler) writeError(w http.ResponseWriter, statusCode int, message string) {
	errorResp := Error{
		Message: message,
		Code:    statusCode,
	}
	h.writeJSON(w, statusCode, errorResp)
}

// handleError handles different types of errors
func (h *Handler) handleError(w http.ResponseWriter, err error) {
	if statusErr, ok := err.(*ErrorStatusCode); ok {
		h.writeJSON(w, statusErr.StatusCode, statusErr.Response)
		return
	}

	// Default to internal server error
	h.writeError(w, http.StatusInternalServerError, "Internal server error")
}
