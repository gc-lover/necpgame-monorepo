databaseChangeLog:
  - changeSet:
      id: 013-create-skill-tables
      author: workqueue
      changes:
        - createTable:
            tableName: skill_data
            columns:
              - column:
                  name: content_entity_id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: skill_category_value_id
                  type: UUID
              - column:
                  name: skill_type_value_id
                  type: UUID
              - column:
                  name: target_type_value_id
                  type: UUID
              - column:
                  name: scaling_type_value_id
                  type: UUID
              - column:
                  name: resource_cost
                  type: NUMERIC(19,4)
              - column:
                  name: resource_type
                  type: VARCHAR(64)
              - column:
                  name: cooldown_seconds
                  type: NUMERIC(10,2)
              - column:
                  name: cast_time_seconds
                  type: NUMERIC(10,2)
              - column:
                  name: duration_seconds
                  type: NUMERIC(10,2)
              - column:
                  name: range_min
                  type: NUMERIC(10,2)
              - column:
                  name: range_max
                  type: NUMERIC(10,2)
              - column:
                  name: max_rank
                  type: INT
              - column:
                  name: unlock_requirements
                  type: JSONB
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: skill_data
            baseColumnNames: content_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_skill_data_entity
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: skill_data
            baseColumnNames: skill_category_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_skill_data_category
        - addForeignKeyConstraint:
            baseTableName: skill_data
            baseColumnNames: skill_type_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_skill_data_type
        - addForeignKeyConstraint:
            baseTableName: skill_data
            baseColumnNames: target_type_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_skill_data_target_type
        - addForeignKeyConstraint:
            baseTableName: skill_data
            baseColumnNames: scaling_type_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_skill_data_scaling_type
        - createTable:
            tableName: skill_rank_effects
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: skill_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: rank
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: effect_payload
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
              - column:
                  name: notes
                  type: TEXT
        - addForeignKeyConstraint:
            baseTableName: skill_rank_effects
            baseColumnNames: skill_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_skill_rank_effects_entity
            onDelete: CASCADE
        - addUniqueConstraint:
            tableName: skill_rank_effects
            columnNames: skill_entity_id, rank
            constraintName: uq_skill_rank_effects_rank
        - createTable:
            tableName: skill_effect_links
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: skill_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: effect_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: trigger_value_id
                  type: UUID
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: skill_effect_links
            baseColumnNames: skill_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_skill_effect_links_skill
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: skill_effect_links
            baseColumnNames: effect_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_skill_effect_links_effect
        - addForeignKeyConstraint:
            baseTableName: skill_effect_links
            baseColumnNames: trigger_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_skill_effect_links_trigger

