databaseChangeLog:
  - changeSet:
      id: 014-create-item-tables
      author: workqueue
      changes:
        - createTable:
            tableName: item_data
            columns:
              - column:
                  name: content_entity_id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: item_category_value_id
                  type: UUID
              - column:
                  name: item_slot_value_id
                  type: UUID
              - column:
                  name: rarity_value_id
                  type: UUID
              - column:
                  name: bind_type_value_id
                  type: UUID
              - column:
                  name: weight
                  type: NUMERIC(19,4)
              - column:
                  name: level_requirement
                  type: INT
              - column:
                  name: stack_size
                  type: INT
              - column:
                  name: vendor_price
                  type: NUMERIC(19,4)
              - column:
                  name: durability_max
                  type: INT
              - column:
                  name: is_tradeable
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: false
              - column:
                  name: power_score
                  type: NUMERIC(19,4)
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: item_data
            baseColumnNames: content_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_item_data_entity
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: item_data
            baseColumnNames: item_category_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_item_data_category
        - addForeignKeyConstraint:
            baseTableName: item_data
            baseColumnNames: item_slot_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_item_data_slot
        - addForeignKeyConstraint:
            baseTableName: item_data
            baseColumnNames: rarity_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_item_data_rarity
        - addForeignKeyConstraint:
            baseTableName: item_data
            baseColumnNames: bind_type_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_item_data_bind_type
        - createTable:
            tableName: weapon_stats
            columns:
              - column:
                  name: item_entity_id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: weapon_class_value_id
                  type: UUID
              - column:
                  name: damage_type_value_id
                  type: UUID
              - column:
                  name: damage_min
                  type: NUMERIC(19,4)
              - column:
                  name: damage_max
                  type: NUMERIC(19,4)
              - column:
                  name: fire_rate
                  type: NUMERIC(10,3)
              - column:
                  name: magazine_size
                  type: INT
              - column:
                  name: reload_time_seconds
                  type: NUMERIC(10,3)
              - column:
                  name: range_min
                  type: NUMERIC(10,3)
              - column:
                  name: range_max
                  type: NUMERIC(10,3)
              - column:
                  name: critical_chance
                  type: NUMERIC(10,4)
              - column:
                  name: critical_multiplier
                  type: NUMERIC(10,4)
              - column:
                  name: accuracy
                  type: NUMERIC(10,4)
              - column:
                  name: recoil
                  type: NUMERIC(10,4)
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: weapon_stats
            baseColumnNames: item_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_weapon_stats_entity
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: weapon_stats
            baseColumnNames: weapon_class_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_weapon_stats_class
        - addForeignKeyConstraint:
            baseTableName: weapon_stats
            baseColumnNames: damage_type_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_weapon_stats_damage_type
        - createTable:
            tableName: armor_stats
            columns:
              - column:
                  name: item_entity_id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: armor_type_value_id
                  type: UUID
              - column:
                  name: armor_value
                  type: NUMERIC(19,4)
              - column:
                  name: resistances
                  type: JSONB
              - column:
                  name: mobility_penalty
                  type: NUMERIC(10,4)
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: armor_stats
            baseColumnNames: item_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_armor_stats_entity
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: armor_stats
            baseColumnNames: armor_type_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_armor_stats_type
        - createTable:
            tableName: consumable_effects
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: item_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: effect_entity_id
                  type: UUID
              - column:
                  name: duration_seconds
                  type: NUMERIC(10,3)
              - column:
                  name: cooldown_seconds
                  type: NUMERIC(10,3)
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: consumable_effects
            baseColumnNames: item_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_consumable_effects_item
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: consumable_effects
            baseColumnNames: effect_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_consumable_effects_effect
        - createTable:
            tableName: item_mod_slots
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: item_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: slot_code
                  type: VARCHAR(64)
                  constraints:
                    nullable: false
              - column:
                  name: capacity
                  type: INT
                  defaultValueNumeric: 1
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: item_mod_slots
            baseColumnNames: item_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_item_mod_slots_entity
            onDelete: CASCADE
        - addUniqueConstraint:
            tableName: item_mod_slots
            columnNames: item_entity_id, slot_code
            constraintName: uq_item_mod_slots_code
        - createTable:
            tableName: item_component_requirements
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: item_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: component_item_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: quantity
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: notes
                  type: TEXT
        - addForeignKeyConstraint:
            baseTableName: item_component_requirements
            baseColumnNames: item_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_item_component_req_item
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: item_component_requirements
            baseColumnNames: component_item_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_item_component_req_component

