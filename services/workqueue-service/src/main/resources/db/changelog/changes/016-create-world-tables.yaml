databaseChangeLog:
  - changeSet:
      id: 016-create-world-tables
      author: workqueue
      changes:
        - createTable:
            tableName: world_location_data
            columns:
              - column:
                  name: content_entity_id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: region_value_id
                  type: UUID
              - column:
                  name: biome_value_id
                  type: UUID
              - column:
                  name: parent_location_id
                  type: UUID
              - column:
                  name: danger_level
                  type: INT
              - column:
                  name: recommended_level_min
                  type: INT
              - column:
                  name: recommended_level_max
                  type: INT
              - column:
                  name: population_estimate
                  type: INT
              - column:
                  name: coordinates
                  type: JSONB
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: world_location_data
            baseColumnNames: content_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_location_entity
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: world_location_data
            baseColumnNames: region_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_world_location_region
        - addForeignKeyConstraint:
            baseTableName: world_location_data
            baseColumnNames: biome_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_world_location_biome
        - addForeignKeyConstraint:
            baseTableName: world_location_data
            baseColumnNames: parent_location_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_location_parent
        - createTable:
            tableName: world_location_links
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: from_location_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: to_location_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: link_type
                  type: VARCHAR(64)
              - column:
                  name: travel_time_minutes
                  type: INT
              - column:
                  name: metadata
                  type: JSONB
        - addForeignKeyConstraint:
            baseTableName: world_location_links
            baseColumnNames: from_location_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_links_from
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: world_location_links
            baseColumnNames: to_location_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_links_to
            onDelete: CASCADE
        - createIndex:
            indexName: idx_world_links_from
            tableName: world_location_links
            columns:
              - column:
                  name: from_location_id
        - createTable:
            tableName: world_event_data
            columns:
              - column:
                  name: content_entity_id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: event_type_value_id
                  type: UUID
              - column:
                  name: region_value_id
                  type: UUID
              - column:
                  name: location_entity_id
                  type: UUID
              - column:
                  name: difficulty_tier
                  type: INT
              - column:
                  name: recurrence_pattern
                  type: JSONB
              - column:
                  name: reward_entity_id
                  type: UUID
              - column:
                  name: reward_description
                  type: TEXT
              - column:
                  name: metadata
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: world_event_data
            baseColumnNames: content_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_event_entity
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: world_event_data
            baseColumnNames: event_type_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_world_event_type
        - addForeignKeyConstraint:
            baseTableName: world_event_data
            baseColumnNames: region_value_id
            referencedTableName: enum_values
            referencedColumnNames: id
            constraintName: fk_world_event_region
        - addForeignKeyConstraint:
            baseTableName: world_event_data
            baseColumnNames: location_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_event_location
        - addForeignKeyConstraint:
            baseTableName: world_event_data
            baseColumnNames: reward_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_event_reward
        - createTable:
            tableName: world_event_requirements
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: world_event_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: requirement_payload
                  type: JSONB
                  defaultValue: '{}'
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: world_event_requirements
            baseColumnNames: world_event_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_event_req_entity
            onDelete: CASCADE
        - createTable:
            tableName: world_spawn_points
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: location_entity_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: spawn_type
                  type: VARCHAR(64)
              - column:
                  name: target_entity_id
                  type: UUID
              - column:
                  name: respawn_seconds
                  type: INT
              - column:
                  name: conditions
                  type: JSONB
              - column:
                  name: metadata
                  type: JSONB
        - addForeignKeyConstraint:
            baseTableName: world_spawn_points
            baseColumnNames: location_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_spawn_location
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: world_spawn_points
            baseColumnNames: target_entity_id
            referencedTableName: content_entities
            referencedColumnNames: id
            constraintName: fk_world_spawn_target

