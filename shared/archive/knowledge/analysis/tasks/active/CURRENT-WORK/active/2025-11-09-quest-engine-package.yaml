metadata:
  id: analysis-2025-11-09-quest-engine-package
  title: "Пакет Quest Engine Backend"
  document_type: analysis
  category: quest-backend
  status: in-review
  version: '1.0.0'
  last_updated: 2025-11-09T14:05:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: brain_manager
      contact: brain.manager@necp.game
  tags:
    - quests
    - backend
    - api
    - events
  topics:
    - quest-engine
    - gameplay-service
  related_systems:
    - gameplay-service
    - economy-service
    - social-service
    - analytics-service
  related_documents: []
  source: shared/docs/knowledge/analysis/tasks/active/CURRENT-WORK/active/2025-11-09-quest-engine-package.md
  visibility: internal
  audience:
    - concept
    - backend
  risk_level: high
review:
  chain:
    - role: brain_manager
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: "Нужно подготовить пакет задач для backend quest engine без D&D зависимостей."
  goal: "Собрать REST, WebSocket, Event Bus, хранение и зависимости для постановки задач ДУАПИТАСК."
  essence: "Документ объединяет прогресс по `quest-engine-backend`, описывает контуры API и хранение, а также влияние на связанные сервисы."
  key_points:
    - "Quest engine базируется на gameplay-service и фронтенд модуле `modules/quests`."
    - "REST включает старт, прогресс, диалоги и финализацию квестов."
    - "WebSocket каналы и события позволяют пушить обновления клиента и телеметрию."
    - "Хранение охватывает quest_instances, objectives, dialogue_state, skill tests и награды."
content:
  sections:
    - id: progress
      title: "Текущий прогресс"
      body: |
        Перепроверен `.BRAIN/05-technical/backend/quest-engine-backend.md` (ready), синхронизированы
        материалы `quest-system.md` и `combat-shooter-core.md`, матрица зависимостей дополнена.
      mechanics_links: []
      assets: []
    - id: api
      title: "REST и WebSocket"
      body: |
        Перечислены эндпоинты старт/прогресс/диалоги/завершение квестов и WebSocket каналы для
        обновлений по instance и игроку.
      mechanics_links: []
      assets: []
    - id: events
      title: "Событийная модель"
      body: |
        Описаны исходящие события (`quest:started`, `quest:objective-progress`, `quest:completed`,
        `quest:failed`) и входящие триггеры из combat, inventory, economy, social и world сервисов.
      mechanics_links: []
      assets: []
    - id: storage
      title: "Хранение и данные"
      body: |
        Структура таблиц `quest_instances`, `quest_objectives_state`, `dialogue_state`,
        `skill_test_results`, `quest_rewards_history`, `quest_dependencies_cache`.
      mechanics_links: []
      assets: []
    - id: dependencies
      title: "Связанные сервисы"
      body: |
        Зафиксированы зависимости от character, economy, social, combat, analytics, auth/characters
        пакета и новой схемы ветвления квестов.
      mechanics_links:
        - shared/docs/knowledge/analysis/tasks/active/CURRENT-WORK/active/2025-11-09-quest-branching-validation.yaml
      assets: []
    - id: roadmap
      title: "Следующие шаги"
      body: |
        Подготовить бриф ДУАПИТАСК, собрать приложение с готовыми документами, обновить трекеры и
        readiness-файлы после постановки задач.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references:
    - shared/docs/knowledge/analysis/tasks/active/CURRENT-WORK/active/2025-11-09-quest-branching-validation.yaml
  decisions: []
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml#analysis-2025-11-09-quest-engine-package
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-09
    author: brain_manager
    changes: "Конвертировано из 2025-11-09-quest-engine-package.md; структурированы API, события и хранение."
validation:
  checksum: ''
  schema_version: '1.0'

