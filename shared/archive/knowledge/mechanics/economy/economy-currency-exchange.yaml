metadata:
  id: economy-currency-exchange
  title: Экономика — Валютная биржа
  document_type: mechanics
  category: economy
  status: approved
  version: '1.1.0'
  last_updated: 2025-11-07T16:14:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-07T16:14:00Z
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - economy
    - trading
    - exchange
  topics:
    - валютные-системы
    - игрок-и-рынок
  related_systems:
    - economy-service
    - wallet-service
    - tax-service
    - analytics-service
  related_documents:
    - id: economy-currencies-resources
      relation: references
    - id: economy-overview
      relation: references
  source: mechanics/economy/economy-currency-exchange.md
  visibility: internal
  audience:
    - concept
    - economy
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: 2025-11-07T16:14:00Z
      status: approved
  next_actions: []
summary:
  problem: Игроки перемещаются между регионами с разными валютами и нуждаются в надёжной системе обмена, регулирующей цены и создающей возможности для спекуляции.
  goal: Спроектировать валютную биржу с динамическими курсами, комиссиями, ордерами и интеграциями в экономический стек NECPGAME.
  essence: Централизованная биржа с поддержкой instant и limit ордеров, риск-контролем и событийным API, синхронизированным с экономическими событиями мира.
  key_points:
    - Поддерживаются major и cross валютные пары с описанными курсами, спредами и объёмами.
    - Система ордеров включает instant обмен и лимитные заявки с комиссиями и скидочными модификаторами.
    - Курсы реагируют на внутриигровые события, а risk-компонент ограничивает волатильность и злоупотребления.
    - Matching engine и API обеспечивают потоковые котировки, историю сделок и интеграцию с сервисами кошельков, налогов и аналитики.
content:
  sections:
    - id: introduction
      title: Введение
      body: |
        Валютная биржа позволяет игрокам обменивать региональные валюты и участвовать в спекулятивной торговле. Система поддерживает постоянное обновление курсов, учитывает рыночные события и интегрируется с экономическими сервисами NECPGAME.
      mechanics_links:
        - mechanics/economy/economy-overview.yaml
      assets: []
    - id: feature_scope
      title: Объём функциональности
      body: |
        Биржа предоставляет доступ к обмену через instant операции и лимитные ордера, отображает динамические курсы и поддерживает торговые гильдии, VIP-статусы и высокообъёмных трейдеров. Статус документа — approved, фича планируется к пост-MVP и готова к постановке задач.
      mechanics_links:
        - mechanics/economy/economy-resources-catalog.yaml
      assets: []
    - id: currency_pairs
      title: Валютные пары
      body: |
        Система описывает пары EDDY с основными валютами и их параметры: курс, спред, суточный объём, волатильность. Также поддерживаются кросс-пары между основными валютами. Курсы указываются как референсные значения, обновляемые ежедневно.
      mechanics_links:
        - mechanics/economy/economy-resources-catalog.yaml
      assets: []
    - id: exchange_mechanics
      title: Механика обмена
      body: |
        Instant обмен рассчитывает результат с учётом текущего курса и комиссии. Лимитные ордера фиксируют желаемый курс и исполняются при достижении условия. Примеры расчётов описывают торговые сценарии в токийском регионе и экономию на лимитных заявках.
      mechanics_links:
        - mechanics/economy/economy-overview.yaml
      assets: []
    - id: fees_structure
      title: Комиссии и спреды
      body: |
        Базовая комиссия составляет 1% с возможностью снижения до 0.5% для крупных объёмов, VIP и торговых гильдий. Спред задаётся как разница между ставками покупки и продажи и масштабируется в зависимости от ликвидности и волатильности.
      mechanics_links:
        - mechanics/economy/economy-overview.yaml
      assets: []
    - id: rates_dynamics
      title: Динамика курсов
      body: |
        Базовые курсы устанавливаются системой и корректируются событиями мира. Примеры охватывают корпоративные войны и экономические кризисы, которые изменяют соотношения валют и формируют повод для спекуляции.
      mechanics_links:
        - mechanics/world/events/live-events-system.yaml
      assets: []
    - id: data_model
      title: Структура данных
      body: |
        Описаны таблицы `currency_exchange_rates` и `currency_exchange_orders`, хранящие пары, курсы, спреды, объём и статусы ордеров. Жизненный цикл ордера включает стадии валидации, активного матчинга, частичного и полного исполнения, отмены и блокировки антифродом.
      mechanics_links:
        - mechanics/economy/economy-production-chains.yaml
      assets: []
    - id: api_surface
      title: API и события
      body: |
        Экономический сервис предоставляет REST и WebSocket эндпоинты для котировок, создания и отмены ордеров, истории сделок и расчёта предварительных котировок. Событийная шина публикует обновления курсов и состояний ордеров для сервисов кошельков, налогов, аналитики и уведомлений.
      mechanics_links:
        - implementation/api-requirements/mvp-endpoints/system-endpoints.yaml
      assets: []
    - id: risk_management
      title: Риск и соответствие
      body: |
        Введены лимиты AML, троттлинг котировок, механизм торговых остановок при резкой волатильности и защита против кросс-регионального арбитража. Эти меры поддерживают честный рынок и соответствие внутриигровым регуляциям.
      mechanics_links:
        - mechanics/economy/economy-analytics.yaml
      assets: []
    - id: matching_engine
      title: Matching Engine
      body: |
        Очередь заявок обслуживается по принципу FIFO с учётом времени, поддерживается системный маркет-мейкер для основых пар, а спред расширяется при недостаточной ликвидности. TTL лимитных ордеров задаёт время жизни заявок.
      mechanics_links:
        - mechanics/economy/economy-trading-guilds.yaml
      assets: []
    - id: integrations
      title: Интеграции и UX
      body: |
        Биржа взаимодействует с сервисами кошельков, налогов, событий и аналитики, обеспечивая блокировку средств, сбор комиссий и отчётность. Интерфейс предоставляет веб-сокеты для графиков и уведомления для игроков.
      mechanics_links:
        - mechanics/economy/economy-trading.yaml
      assets: []
appendix:
  glossary:
    - term: EDDY
      definition: Базовая внутриигровая валюта NECPGAME, используемая для торговых операций.
    - term: Spread
      definition: Разница между ставками покупки и продажи валютной пары, отражающая ликвидность рынка.
  references:
    - type: internal
      link: mechanics/economy/economy-resources-catalog.yaml
    - type: internal
      link: mechanics/economy/economy-overview.yaml
  decisions:
    - id: currency-exchange-centralized
      title: Централизованная модель валютной биржи
      status: approved
      rationale: Обеспечивает единый контроль курсов и интеграцию с сервисами риска.
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-06
    author: concept_team
    changes: Сформулированы цели биржи, базовые курсы и структура ордеров.
  - version: '1.1.0'
    date: 2025-11-07
    author: concept_team
    changes: Добавлены API, жизненный цикл ордеров, risk-контроль и интеграции.
validation:
  checksum: ''
  schema_version: '1.0'

