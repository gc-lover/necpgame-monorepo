metadata:
  id: npc-relationships-system-detailed
  title: Система отношений с NPC — Детально
  document_type: mechanics
  category: social
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-09T19:17:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-09T19:17:00Z
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - npc
    - relationships
    - romance
  topics:
    - npc-relations
    - social-mechanics
  related_systems:
    - social-service
    - world-service
    - gameplay-service
    - economy-service
    - character-service
  related_documents:
    - id: npc-relationships-system
      relation: references
    - id: npc-hiring-system-detailed
      relation: complements
    - id: relationships-system-detailed
      relation: complements
  source: shared/docs/knowledge/mechanics/social/npc-relationships-system-детально.md
  visibility: internal
  audience:
    - concept
    - narrative
    - social
  risk_level: high
review:
  chain:
    - role: social_design_lead
      reviewer: ''
      reviewed_at: 2025-11-09T19:17:00Z
      status: approved
  next_actions: []
summary:
  problem: Детальная методология отношений с NPC находилась в Markdown и требовала структурирования для API и сервисов.
  goal: Зафиксировать уровни отношений, типы NPC, формулы влияния и интеграции с сервисами мира.
  essence: Документ описывает полный стек отношений от репутации и эмоций до REST/Kafka контрактов и UX.
  key_points:
    - Многослойная модель включает репутацию, доверие, эмоции, романтику и специальное взаимодействие.
    - Классы, фракции и происхождение влияют на стартовые и динамические показатели.
    - API и события обеспечивают синхронизацию с social, world, gameplay и economy сервисами.
content:
  sections:
    - id: methodology
      title: Методика детализации
      body: |
        Описаны слои отношения, типы NPC, модули-смежники и события поведения. Система охватывает
        социальные, мировые и геймплейные сервисы и требует журналов, эмоций и доверия.
      mechanics_links:
        - mechanics/social/npc-relationships-system.yaml
    - id: npc-types
      title: Типы NPC и важность
      body: |
        Core Story, Functional, Romance, Hireable, Social Leaders и Antagonists имеют собственные
        пороги и сценарии. Каждый тип определяет доступные квесты, бонусы и риски.
      mechanics_links:
        - mechanics/social/npc-hiring-system.yaml
    - id: relationship-levels
      title: Уровни отношений и эмоций
      body: |
        Репутация распределена по диапазонам от ненависти до союза. Дополнительные слои: доверие,
        эмоциональное состояние, лояльность и романтическая шкала (Interest → Bond). Требуются условия
        по репутации, поведению и времени.
      mechanics_links:
        - mechanics/social/npc-relationships-system.yaml
    - id: class-faction-impact
      title: Влияние классов и фракций
      body: |
        Классы дают бонусы к доверию и скидкам, фракции меняют отношения, происхождение задаёт стартовые
        значения. Интеграция с `factions-overview` и `classes-*` документами.
      mechanics_links:
        - mechanics/social/relationships-system-детально.md
    - id: relationship-dynamics
      title: Рост и падение отношений
      body: |
        Квесты, подарки, свободное время, предательство и мировые события регулируют отношения. Вводятся
        cooldown, глобальные эффекты и связи с экономикой.
      mechanics_links:
        - mechanics/social/npc-relationships-system.yaml
    - id: special-relationships
      title: Специальные типы
      body: |
        Наставничество, гильдии, семья, деловые и скрытые связи. Требуют дополнительных условий и дают
        уникальные бонусы.
      mechanics_links:
        - mechanics/social/mentorship-system.yaml
    - id: players-as-npc
      title: Игроки как NPC
      body: |
        Игроки могут выступать квестодателями и услугеодателями при наличии рейтинга и доверия. Social-service
        контролирует честность, economy-service — платежи.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: hiring
      title: Найм NPC
      body: |
        Уровни найма, параметры персонала, требования доверия и связь с документами по найму NPC.
      mechanics_links:
        - mechanics/social/npc-hiring-system.yaml
    - id: world-impact
      title: Влияние на мир
      body: |
        Отношения влияют на города, фракции, экономику и бой. NPC предоставляют ресурсы, спасают игрока,
        инициируют события и поддерживают в кризисах.
      mechanics_links:
        - mechanics/social/player-orders-world-impact-детально.yaml
    - id: ux
      title: UX и журнал отношений
      body: |
        Требуются карточки NPC, таймлайн событий, романтические чеклисты и уведомления. UX макеты
        согласованы по PR `FW-NPC-REL-013`.
      mechanics_links:
        - mechanics/social/npc-relationships-system.yaml
    - id: api
      title: REST и JSON схемы
      body: |
        Сформированы endpoints для статуса, изменений, взаимодействий, романтики и истории, а также JSON
        схемы для каждой операции.
      mechanics_links:
        - mechanics/social/npc-relationships-system.yaml
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: true
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-09
    author: concept_director
    changes: Детализирована система отношений, уровни, API и события для сервисов.
validation:
  checksum: ''
  schema_version: '1.0'

