metadata:
  id: KNL-QUEST-TRIGGERS
  title: "Система триггеров квестов"
  document_type: mechanics
  category: narrative
  status: approved
  version: '1.1.0'
  last_updated: 2025-11-10T04:05:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-06T23:25:00Z
  owners:
    - role: concept_director
      contact: ''
    - role: vision_manager
      contact: ''
  tags:
    - quests
    - triggers
    - narrative
  topics:
    - quest-system
    - player-progression
  related_systems:
    - quest-service
    - narrative-service
  related_documents: []
  source: ''
  visibility: internal
  audience:
    - concept
    - vision
    - readiness
  risk_level: medium
review:
  chain:
    - role: vision_manager
      reviewer: ''
      reviewed_at: 2025-11-06T23:30:00Z
      status: approved
  next_actions: []
summary:
  problem: "Нужно описать зависимости между ключевыми квестами и финальными состояниями сюжета."
  goal: "Документировать триггеры, цепочки и правила тайминга для квестов, влияющих на финалы кампании."
  essence: "Триггеры квестов сгруппированы по типам, их цепочки описаны отдельно вместе с правилами тайминга и финалами."
  key_points:
    - "Основные и побочные квесты открывают новые сюжетные ветки через триггеры."
    - "Цепочки NetWatch, ИИ и революционеров ведут к альтернативным финалам."
    - "Правила тайминга определяют, когда раскрываются новые квесты (immediate, next_era, finale и др.)."
content:
  sections:
    - id: overview
      title: "Обзор"
      body: |
        Система триггеров описывает, какие квесты открывают другие задания, как формируются сюжетные
        цепочки и какие условия необходимы для альтернативных финалов. Раздел включает основные
        (main) и побочные (side) квесты, цепочки для NetWatch, ИИ и революционеров, а также финальные
        требования и правила тайминга.
    - id: triggers_data
      title: "Триггеры квестов"
      data:
        main_quests:
          MQ-2020-001:
            name: "Первые шаги"
            unlocks:
              immediate:
                - MQ-2020-002
                - SQ-2020-001
                - SQ-2020-004
                - SQ-2020-005
              conditional:
                - quest: SQ-2020-003
                  condition: class_netrunner
                - quest: SQ-2020-002
                  condition: reputation_trauma_team >= 10
            timing: immediate
            note: "Вводный квест - открывает начальные квесты эпохи"
          MQ-2020-005:
            name: "Чистый канал"
            unlocks:
              next_era:
                - MQ-2030-001
                - MQ-2030-002
              conditional:
                - quest: SQ-2030-002
                  condition: choice_netwatch
                - quest: SQ-2045-001
                  condition: choice_netwatch
            timing: next_era
            note: "Финал эпохи - открывает следующую эпоху с учетом выбора"
          MQ-2045-005:
            name: "Часовые Blackwall"
            unlocks:
              immediate:
                - SQ-2045-003
              next_era:
                - MQ-2060-001
              delayed:
                - SQ-2078-004
            timing: mixed
            note: "Критический выбор по отношению к ИИ"
          MQ-2078-002:
            name: "Архивы за заслоном"
            unlocks:
              immediate:
                - SQ-2078-004
              finale:
                - ending_transcendence
            timing: immediate + finale
            note: "Открывает путь к Трансцендентности"
        side_quests:
          SQ-2020-001:
            name: "Контракт Войтека"
            unlocks:
              immediate:
                - SQ-2020-002
              next_era:
                - SQ-2030-001
            conditions:
              for_SQ-2020-002:
                reputation_trauma_team: 10
            timing: mixed
          SQ-2020-003:
            name: "Защита чистого канала"
            unlocks:
              immediate:
                - SQ-2020-004
              next_era:
                - SQ-2030-002
                - SQ-2045-001
            conditions:
              for_all:
                flag_netwatch_ally: true
            timing: cross_era
            note: "Длинная цепочка NetWatch квестов"
          SQ-2045-003:
            name: "Обращение в хоре"
            unlocks:
              immediate:
                - SQ-2060-003
              delayed:
                - SQ-2078-004
              finale:
                - ending_transcendence
            conditions:
              for_SQ-2078-004:
                flag_choir_member: true
            timing: cross_era + finale
            note: "Критично для пути Трансцендентности"
          SQ-2078-004:
            name: "Экспедиция за Blackwall"
            unlocks:
              finale:
                - ending_transcendence
            conditions:
              prerequisite:
                - quest_completed: MQ-2078-002
                - flag: ai_sympathizer
                - class: Netrunner
            timing: finale_determinant
            note: "Открывает финал Трансцендентности"
          SQ-2078-005:
            name: "Проект конституции"
            unlocks:
              finale:
                - ending_revolution
            conditions:
              prerequisite:
                - quest_in_progress: MQ-2078-003
                - reputation_people_unions: 30
                - flag: revolutionary
            timing: finale_determinant
            note: "Открывает финал Революции"
    - id: trigger_chains
      title: "Цепочки триггеров"
      data:
        netwatch_chain:
          description: "Цепочка NetWatch квестов через эпохи"
          chain:
            - SQ-2020-003
            - MQ-2020-005
            - SQ-2030-002
            - SQ-2045-001
            - SQ-2078-004
          conditions:
            all_steps:
              flag_netwatch_ally: true
        ai_sympathy_chain:
          description: "Цепочка про-ИИ квестов"
          chain:
            - SQ-2045-003
            - MQ-2045-005
            - MQ-2045-006
            - SQ-2078-004
            - ending_transcendence
          conditions:
            all_steps:
              flag_ai_sympathizer: true
        revolutionary_chain:
          description: "Цепочка народного сопротивления"
          chain:
            - SQ-2030-001
            - MQ-2030-006
            - MQ-2060-005
            - SQ-2078-005
            - ending_revolution
          conditions:
            all_steps:
              flag_revolutionary: true
    - id: finale_triggers
      title: "Требования финалов"
      data:
        ending_transcendence:
          required_triggers:
            - SQ-2078-004
            - MQ-2078-002
          optional_boosters:
            - SQ-2045-003
            - MQ-2045-005
          blocks:
            - ending_corporatocracy
        ending_revolution:
          required_triggers:
            - SQ-2078-005
            - MQ-2078-003
          optional_boosters:
            - MQ-2030-006
            - MQ-2060-005
          blocks:
            - ending_corporatocracy
        ending_corporatocracy:
          required_triggers:
            - MQ-2078-001
          optional_boosters:
            - MQ-2020-005
            - MQ-2030-006
            - SQ-2078-001
          blocks:
            - ending_transcendence
            - ending_revolution
        ending_apocalypse:
          required_triggers:
            - chaos_threshold: 80
          optional_triggers:
            - reputation_all_factions: '< 0'
            - cyberpsychosis_level: '> 70'
          note: "Открывается через накопление хаоса, не через конкретный квест"
    - id: timing_rules
      title: "Правила тайминга"
      data:
        immediate:
          description: "Квест открывается сразу после завершения триггера"
          delay: 0
        next_era:
          description: "Квест открывается в следующей эпохе"
          delay: era_transition
        delayed:
          description: "Квест открывается через несколько эпох"
          delay: 1-3_eras
        conditional:
          description: "Квест открывается только при выполнении условий"
          delay: conditional
        finale_determinant:
          description: "Квест определяет доступность финала"
          delay: finale
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference: []
  blockers: []
history:
  - version: '1.1.0'
    date: 2025-11-10
    author: automation
    changes: "Перенесено в единый формат знаний, добавлены разделы по цепочкам и таймингу."
  - version: '1.0.0'
    date: 2025-11-06
    author: narrative_team
    changes: "Создана исходная версия документа триггеров."
validation:
  checksum: ''
  schema_version: '1.0'

