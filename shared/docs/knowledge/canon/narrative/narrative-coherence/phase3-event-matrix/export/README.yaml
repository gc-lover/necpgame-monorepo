metadata:
  id: narrative-coherence-event-export-guide
  title: 'YAML → JSON Export Scripts'
  document_type: canon
  category: narrative-coherence
  status: draft
  version: '1.0.0'
  last_updated: 2025-11-07T00:31:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - export
    - quest-graph
    - automation
  topics:
    - data-pipeline
    - backend-integration
  related_systems:
    - narrative-service
    - quest-service
  related_documents:
    - id: narrative-coherence-side-quests-matrix
      relation: references
    - id: narrative-coherence-quest-triggers
      relation: references
    - id: narrative-coherence-quest-blockers
      relation: references
    - id: narrative-coherence-quest-dependencies
      relation: references
  source: shared/docs/knowledge/canon/narrative/narrative-coherence/phase3-event-matrix/export/README.md
  visibility: internal
  audience:
    - concept
    - backend
    - data
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: Требуется автоматизированная конвертация YAML-графа событий в JSON для использования сервисами и клиентами.
  goal: Описать доступные скрипты экспорта, результирующие файлы и способы валидации данных.
  essence: Гайд покрывает Python и Node конвертеры, структуру выходных JSON и проверку корректности перед интеграцией.
  key_points:
    - Поддерживаются Python и Node.js скрипты для генерации JSON.
    - Конвертация охватывает матрицы побочных квестов, триггеров и блокеров.
    - Приведены примеры структуры JSON и рекомендации по проверке результата.
content:
  sections:
    - id: overview
      title: 'Назначение'
      body: |
        Документ описывает процесс преобразования YAML-файлов графа событий в JSON, который используется narrative backend и аналитическими пайплайнами. Скрипты поддерживают воспроизводимый экспорт перед сборкой сервисов.
      mechanics_links: []
      assets: []
    - id: scripts
      title: 'Доступные скрипты'
      body: |
        ### Python
        ```
        pip install pyyaml
        python convert-quest-graph.py
        ```

        ### Node.js
        ```
        npm install js-yaml
        node convert-quest-graph.js
        ```
      mechanics_links: []
      assets: []
    - id: datasets
      title: 'Входные и выходные файлы'
      body: |
        **Input YAML:**
        1. phase2-narrative/connections/side-quests-matrix.yaml
        2. phase2-narrative/connections/quest-triggers.yaml
        3. phase2-narrative/connections/quest-blockers.yaml
        4. phase3-event-matrix/graph/quest-dependencies.yaml

        **Output JSON:**
        1. export/side-quests-matrix.json
        2. export/quest-triggers.json
        3. export/quest-blockers.json
        4. export/quest-dependencies-full.json
      mechanics_links: []
      assets: []
    - id: output-structure
      title: 'Формат выходных данных'
      body: |
        Пример `quest-dependencies-full.json`:
        ```
        {
          "metadata": {
            "version": "1.0.0",
            "total_quests": 550
          },
          "nodes": [
            { "id": "MQ-2020-001", "name": "Первые шаги", "era": "2020-2030", "type": "main" }
          ],
          "edges": [
            { "from": "MQ-2020-001", "to": "MQ-2020-002", "type": "unlocks", "timing": "immediate" }
          ],
          "statistics": {
            "total_nodes": 550,
            "total_edges": 1200
          }
        }
        ```
      mechanics_links: []
      assets: []
    - id: backend
      title: 'Интеграция с backend'
      body: |
        Пример загрузки графа в Spring Boot:
        ```
        @Service
        public class QuestGraphService {
            private QuestGraph graph;

            @PostConstruct
            public void init() throws IOException {
                ObjectMapper mapper = new ObjectMapper();
                graph = mapper.readValue(
                    new File("quest-dependencies-full.json"),
                    QuestGraph.class
                );
            }
        }
        ```
      mechanics_links:
        - implementation/backend/narrative/service-logic.yaml
      assets: []
    - id: validation
      title: 'Проверка результатов'
      body: |
        Используйте `ls -lh export/` для проверки размеров файлов и `jq` для валидации JSON:
        ```
        cat export/quest-dependencies-full.json | jq '.statistics'
        cat export/quest-dependencies-full.json | jq '.nodes | length'
        cat export/quest-dependencies-full.json | jq '.edges | length'
        ```
        Ожидаемые значения: 4 JSON файла, 550+ узлов, 1200+ связей и общий размер 500KB–1MB.
      mechanics_links:
        - implementation/tooling/json-validation.yaml
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference: []
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-07
    author: concept_director
    changes: Описаны скрипты экспорта YAML → JSON и проверка результатов.
validation:
  checksum: ''
  schema_version: '1.0'

