metadata:
  id: narrative-coherence-dev-guide-step-by-step-part1-setup
  title: "Step-by-Step Backend Setup: Part 1 — Setup & Database"
  document_type: implementation
  category: backend
  status: draft
  version: '1.0.0'
  last_updated: 2025-11-13T00:00:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - backend
    - setup
    - narrative-coherence
  topics:
    - infrastructure
    - database
  related_systems:
    - narrative-service
    - backend-platform
  related_documents:
    - id: narrative-coherence-dev-guide-step-by-step-part2-code
      relation: continues
    - id: narrative-coherence-dev-guide-step-by-step-part3-testing
      relation: continues
  source: "shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/step-by-step-part1-setup.md"
  visibility: internal
  audience:
    - backend
    - devops
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: "Команда нуждается в пошаговом руководстве по развёртыванию окружения для narrative-сервиса."
  goal: "Зафиксировать полный процесс подготовки БД, Redis и файлов миграций для backend-модуля."
  essence: "Документ описывает требования, настройку инфраструктуры, загрузку миграций и подготовку структуры проекта."
  key_points:
    - "Проверка всех инфраструктурных зависимостей перед стартом."
    - "Пошаговое применение SQL-миграций и экспорт повествовательных данных."
    - "Подготовка зависимостей Maven и структуры пакетов для narrative-модуля."
content:
  sections:
    - id: introduction
      title: "Введение"
      body: |
        Руководство открывает серию из трёх частей и описывает подготовку окружения для narrative-сервиса. Документ сопровождается чекпоинтами, обеспечивающими предсказуемое выполнение и контроль результата на каждом шаге.
      mechanics_links: []
      assets: []
    - id: prerequisites
      title: "Требования и проверка"
      body: |
        Требуются Java 17+, Spring Boot 3.x, PostgreSQL 14+, Redis и Maven 3.8+. Проверка выполняется командами:

        java -version
        psql --version
        redis-cli ping
        mvn -version
      mechanics_links: []
      assets: []
    - id: step-1-environment
      title: "Шаг 1 — Подготовка окружения"
      body: |
        Создайте базу данных necpgame через createdb или psql. Запустите Redis локально или через контейнер:

        redis-server
        docker run -d -p 6379:6379 redis:latest

        Подтвердите соединения командами psql -d necpgame -c "SELECT version();" и redis-cli ping.
      mechanics_links: []
      assets: []
    - id: step-2-migrations
      title: "Шаг 2 — SQL миграции"
      body: |
        Скопируйте миграции из каталога narrative-coherence в папку db/migration/narrative. Настройте переменные окружения DB_NAME, DB_USER, DB_PASSWORD, DB_HOST, DB_PORT. Примените миграции скриптом apply-all-migrations или вручную через psql, убедившись, что создано 13 таблиц.
      mechanics_links: []
      assets: []
    - id: step-3-export
      title: "Шаг 3 — Экспорт данных"
      body: |
        Установите pyyaml или js-yaml. Запустите Python или Node скрипты convert-quest-graph в каталоге export. Проверьте наличие файлов side-quests-matrix.json, quest-triggers.json, quest-blockers.json и quest-dependencies-full.json, затем скопируйте их в resources narrative.
      mechanics_links: []
      assets: []
    - id: step-4-dependencies
      title: "Шаг 4 — Зависимости"
      body: |
        Добавьте в pom.xml зависимости hibernate-types-55, spring-boot-starter-data-redis и spring-boot-starter-websocket. Выполните mvn clean install, чтобы убедиться в корректности конфигурации.
      mechanics_links: []
      assets: []
    - id: step-5-structure
      title: "Шаг 5 — Структура пакетов"
      body: |
        Создайте пакеты narrative/entity, narrative/repository, narrative/service, narrative/controller, narrative/dto и narrative/config в com.necpgame. Подтвердите дерево директорий перед переходом к следующей части.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-13
    author: concept_director
    changes: "Конвертация Part 1 пошагового руководства из MD в YAML."
validation:
  checksum: ''
  schema_version: '1.0'

