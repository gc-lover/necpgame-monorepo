metadata:
  id: narrative-coherence-step-by-step-part2-code
  title: Step-by-Step Backend Setup — Part 2 (Backend Code)
  document_type: canon
  category: narrative-coherence
  status: draft
  version: '1.0.0'
  last_updated: 2025-11-07T00:48:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - onboarding
    - backend
    - narrative-coherence
  topics:
    - domain-modeling
    - service-layer
  related_systems:
    - narrative-service
    - quest-service
  related_documents:
    - id: narrative-coherence-step-by-step-part1-setup
      relation: references
    - id: narrative-coherence-step-by-step-part3-testing
      relation: continues
  source: shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/step-by-step-part2-code.md
  visibility: internal
  audience:
    - backend
    - concept
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: После подготовки окружения команде нужен чеклист по реализации доменных сущностей и слоёв сервиса для нарратива.
  goal: Предоставить инструкции по созданию сущностей, репозиториев, сервисов и контроллеров для квестового бэкенда.
  essence: Документ организует работу над кодовой базой, указывая ключевые классы, методы и контрольные точки готовности.
  key_points:
    - Определение сущностей квестового домена с поддержкой JSONB.
    - Создание репозиториев и сервисных методов для графа квестов.
    - Настройка REST-контроллеров и эндпоинтов нарратива.
content:
  sections:
    - id: navigation
      title: Навигация
      body: |
        Part 2 фокусируется на реализации кода, продолжая Part 1 и подготавливая основу для тестирования в Part 3.
      mechanics_links: []
      assets: []
    - id: entities
      title: Сущности
      body: |
        Описаны основные поля `Quest` с аннотациями `@TypeDef` и `@Type(type = "jsonb")` и перечень дополнительных сущностей: `QuestBranch`, `DialogueNode`, `DialogueChoice`, `PlayerFlag`, `PlayerWorldState`, `ServerWorldState`, `TerritoryControl`.
      mechanics_links:
        - services/backend/narrative/entity-design.yaml
      assets: []
    - id: repositories
      title: Репозитории
      body: |
        Пример `QuestRepository` демонстрирует использование `JpaRepository`, запросов с `@Query` и поиск по типу. Контрольная точка включает создание шести репозиториев.
      mechanics_links:
        - services/backend/common/repository-patterns.yaml
      assets: []
    - id: services
      title: Сервисный слой
      body: |
        `QuestGraphService` реализует загрузку графа из JSON, проверку доступности квестов, получение списков и обработку выбора. Раздел фиксирует необходимость полного набора сервисов.
      mechanics_links:
        - services/backend/narrative/service-logic.yaml
      assets: []
    - id: controllers
      title: Контроллеры
      body: |
        REST API предоставляет эндпоинты `/api/v1/narrative/quests/available`, `/api/v1/narrative/quests/{questId}` и `POST /{questId}/choice`. Цель — обеспечить интерфейс для клиента.
      mechanics_links:
        - services/backend/narrative/api-spec.yaml
      assets: []
    - id: handoff
      title: Продолжение
      body: |
        После реализации кода команды переходят к Part 3 для настройки конфигураций, тестирования и деплоя.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference: []
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-07
    author: concept_director
    changes: Конвертировано руководство Step-by-Step Part 2 в YAML с выделением слоёв квестового сервиса.
validation:
  checksum: ''
  schema_version: '1.0'

