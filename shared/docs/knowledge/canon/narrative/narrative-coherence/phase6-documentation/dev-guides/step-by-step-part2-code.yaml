metadata:
  id: narrative-coherence-dev-guide-step-by-step-part2-code
  title: "Step-by-Step Backend Setup: Part 2 — Backend Code"
  document_type: implementation
  category: backend
  status: draft
  version: '1.0.0'
  last_updated: 2025-11-13T00:00:00Z
  concept_approved: false
  concept_reviewed_at: ''
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - backend
    - narrative-coherence
    - implementation
  topics:
    - domain-model
    - service-layer
  related_systems:
    - narrative-service
  related_documents:
    - id: narrative-coherence-dev-guide-step-by-step-part1-setup
      relation: precedes
    - id: narrative-coherence-dev-guide-step-by-step-part3-testing
      relation: continues
  source: "shared/docs/knowledge/canon/narrative/narrative-coherence/phase6-documentation/dev-guides/step-by-step-part2-code.md"
  visibility: internal
  audience:
    - backend
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: "Необходимо быстро собрать слой кода narrative-сервиса после подготовки инфраструктуры."
  goal: "Предоставить пошаговые инструкции по созданию сущностей, репозиториев, сервисов и контроллеров."
  essence: "Документ описывает реализации слоя данных и API, опираясь на единый стандарт narrative-coherence."
  key_points:
    - "Создание восьми сущностей с поддержкой JSONB и связей."
    - "Определение репозиториев с кастомными запросами по типам и эпохам."
    - "Реализация сервисов графа квестов и REST-контроллеров."
content:
  sections:
    - id: introduction
      title: "Введение"
      body: |
        Вторая часть руководства фокусируется на реализации кода после настройки окружения. Отдельные шаги сопровождаются чекпоинтами, подтверждающими готовность каждой подсистемы.
      mechanics_links: []
      assets: []
    - id: step-6-entities
      title: "Шаг 6 — Сущности"
      body: |
        Создайте Quest.java в директории entity, применив аннотацию @TypeDef с JsonBinaryType для JSONB полей. По аналогии сформируйте QuestBranch, DialogueNode, DialogueChoice, PlayerFlag, PlayerWorldState, ServerWorldState и TerritoryControl. После генерации всех классов убедитесь, что восемь сущностей готовы.
      mechanics_links: []
      assets: []
    - id: step-7-repositories
      title: "Шаг 7 — Репозитории"
      body: |
        Определите QuestRepository, расширяющий JpaRepository, с методами findByEra и findByType. По образцу сверстайте ещё пять интерфейсов для остальных сущностей, обеспечив завершение слоя доступа к данным.
      mechanics_links: []
      assets: []
    - id: step-8-services
      title: "Шаг 8 — Сервисы"
      body: |
        В QuestGraphService реализуйте методы loadQuestGraph, isQuestAvailable, getAvailableQuests и processChoice для управления графом историй. Сервисы должны опираться на JSON ресурсы и репозитории, обеспечивая бизнес-логику narrative-сценариев.
      mechanics_links: []
      assets: []
    - id: step-9-controllers
      title: "Шаг 9 — Контроллеры"
      body: |
        Добавьте QuestController с REST-эндпоинтами GET /api/v1/narrative/quests/available, GET /api/v1/narrative/quests/{questId} и POST /api/v1/narrative/quests/{questId}/choice. Проверьте соответствие маршрутов требованиям Pan-EuroGrid.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-13
    author: concept_director
    changes: "Конвертация Part 2 пошагового руководства из MD в YAML."
validation:
  checksum: ''
  schema_version: '1.0'

