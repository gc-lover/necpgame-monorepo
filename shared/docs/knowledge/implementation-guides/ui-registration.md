# Экран регистрации

**Статус:** review - детализация завершена  
**Версия:** 1.0.0  
**Дата создания:** 2025-11-04  
**Последнее обновление:** 2025-11-04  
**Приоритет:** высокий

**api-readiness:** ready  
**api-readiness-check-date:** 2025-11-04 17:05
**api-readiness-notes:** Документ готов к созданию API задач. Содержит детальное описание экрана регистрации с валидацией, обработкой ошибок, UI/UX требованиями. Все необходимые детали для создания API спецификации присутствуют (v1.0.0).

---

- **Status:** created
- **Last Updated:** 2025-11-07 06:00
---

---

## Общее описание

Описание экрана регистрации для текстовой веб-версии NECPGAME. Базовая регистрация через email с созданием аккаунта перед созданием персонажа.

**Важно:** Это текстовый интерфейс без графики и 3D-моделей, так как пока не подключен движок и используется веб-интерфейс.

---

## 1. Экран регистрации

### 1.1. Основной экран регистрации

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│          NECPGAME                       │
│     [Киберпанк стилистика]              │
│                                         │
│          РЕГИСТРАЦИЯ                    │
│                                         │
│  Создайте аккаунт для начала игры       │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ Email: [_________________]      │   │
│  │        [Подсказка: example@mail.com]│
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ Логин: [_________________]     │   │
│  │        [Подсказка: 3-20 символов]│
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ Пароль: [_________________]    │   │
│  │         [Подсказка: мин. 8 символов]│
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ Повтор пароля: [_____________] │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ☐ Я согласен с условиями использования │
│    и политикой конфиденциальности      │
│                                         │
│  [Зарегистрироваться]  [Назад]         │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Поле для ввода email (обязательно)
- Поле для ввода логина (обязательно, уникальность)
- Поле для ввода пароля (обязательно, минимум символов)
- Поле для подтверждения пароля (обязательно, должно совпадать)
- Чекбокс согласия с условиями использования (обязательно)
- Кнопка "Зарегистрироваться" - создание аккаунта
- Кнопка "Назад" - возврат на экран входа

---

### 1.2. Валидация в реальном времени

**Email:**
- Проверка формата email при вводе
- Проверка уникальности email при потере фокуса
- Отображение ошибок под полем

**Логин:**
- Проверка длины (3-20 символов) при вводе
- Проверка допустимых символов (буквы, цифры, подчеркивания) при вводе
- Проверка уникальности логина при потере фокуса
- Отображение ошибок под полем

**Пароль:**
- Проверка минимальной длины (8 символов) при вводе
- Проверка наличия букв и цифр при вводе
- Индикатор силы пароля (слабый/средний/сильный)
- Отображение ошибок под полем

**Повтор пароля:**
- Проверка совпадения с паролем при вводе
- Отображение ошибок под полем

**Чекбокс:**
- Проверка принятия условий перед отправкой
- Отображение ошибок под чекбоксом

---

### 1.3. Сообщения об ошибках

**Email:**
- "Email обязателен" - если поле пустое
- "Неверный формат email" - если формат невалиден
- "Email уже используется" - если email уже существует

**Логин:**
- "Логин обязателен" - если поле пустое
- "Логин должен быть от 3 до 20 символов" - если длина невалидна
- "Логин может содержать только буквы, цифры и подчеркивания" - если символы невалидны
- "Логин уже используется" - если логин уже существует

**Пароль:**
- "Пароль обязателен" - если поле пустое
- "Пароль должен быть минимум 8 символов" - если длина невалидна
- "Пароль должен содержать буквы и цифры" - если требования не выполнены

**Повтор пароля:**
- "Подтверждение пароля обязателено" - если поле пустое
- "Пароли не совпадают" - если пароли не совпадают

**Чекбокс:**
- "Необходимо принять условия использования" - если чекбокс не отмечен

**Общие ошибки:**
- "Ошибка регистрации. Попробуйте позже." - если произошла ошибка на сервере
- "Соединение с сервером потеряно" - если нет соединения с сервером

---

### 1.4. Успешная регистрация

**Элементы интерфейса:**

```
┌─────────────────────────────────────────┐
│          РЕГИСТРАЦИЯ УСПЕШНА             │
│                                         │
│  Добро пожаловать в NECPGAME!           │
│                                         │
│  Ваш аккаунт успешно создан.            │
│  Теперь вы можете создать персонажа.    │
│                                         │
│  [Создать персонажа]  [Войти]          │
│                                         │
└─────────────────────────────────────────┘
```

**Функциональность:**
- Сообщение об успешной регистрации
- Кнопка "Создать персонажа" - переход к созданию персонажа
- Кнопка "Войти" - переход к экрану входа (если нужно войти сначала)

**После успешной регистрации:**
- Аккаунт создан
- Пользователь автоматически авторизован (получает токен)
- Переход на экран выбора персонажа или создания персонажа

---

## 2. Технические требования

### 2.1. API Endpoint

**POST /api/v1/auth/register**

**Request Body:**
```json
{
  "email": "string",
  "username": "string",
  "password": "string"
}
```

**Валидация:**
- `email` (required, string, email format): валидный email адрес, уникальный, max 255 символов
- `username` (required, string, 3-20 символов): логин пользователя, допустимые символы: буквы (a-z, A-Z), цифры (0-9), подчеркивания (_), уникальный
- `password` (required, string, минимум 8 символов): пароль, должен содержать буквы и цифры

**Response:**
- **200 OK:**
```json
{
  "success": true,
  "accountId": "uuid",
  "token": "string",
  "refreshToken": "string",
  "expiresIn": "integer",
  "message": "Account created successfully"
}
```

- **400 Bad Request:** Невалидные данные
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "details": {
      "field": "email",
      "reason": "Invalid email format"
    }
  }
}
```

- **409 Conflict:** Email или username уже существует
```json
{
  "error": {
    "code": "CONFLICT",
    "message": "Email or username already exists",
    "details": {
      "field": "email",
      "reason": "Email already registered"
    }
  }
}
```

- **500 Internal Server Error:** Внутренняя ошибка сервера

---

### 2.2. Валидация на клиенте

**Правила валидации:**

**Email:**
- Обязательное поле
- Формат: стандартный email (regex: `^[^\s@]+@[^\s@]+\.[^\s@]+$`)
- Максимальная длина: 255 символов
- Проверка уникальности через API при потере фокуса

**Username:**
- Обязательное поле
- Минимальная длина: 3 символа
- Максимальная длина: 20 символов
- Допустимые символы: буквы (a-z, A-Z), цифры (0-9), подчеркивания (_)
- Регулярное выражение: `^[a-zA-Z0-9_]+$`
- Проверка уникальности через API при потере фокуса

**Password:**
- Обязательное поле
- Минимальная длина: 8 символов
- Должен содержать минимум 1 букву
- Должен содержать минимум 1 цифру
- Регулярное выражение: `^(?=.*[A-Za-z])(?=.*\d).{8,}$`

**Повтор пароля:**
- Обязательное поле
- Должен совпадать с паролем

**Чекбокс:**
- Обязательное поле
- Должен быть отмечен

---

### 2.3. UI/UX требования

**Принципы:**
- Простота и понятность
- Ясная навигация
- Валидация в реальном времени
- Понятные сообщения об ошибках
- Киберпанк эстетика (текстовая версия)

**Визуальные элементы:**
- Поля ввода с подсказками
- Индикатор силы пароля (опционально)
- Кнопки с четкими действиями
- Сообщения об ошибках под полями
- Успешные сообщения выделены

**Навигация:**
- Кнопка "Назад" возвращает на экран входа
- После успешной регистрации - переход к созданию персонажа
- Возможность отменить регистрацию в любой момент

---

### 2.4. Безопасность

**Требования:**
- Пароль не должен отображаться в открытом виде (поле типа password)
- Пароль должен быть захеширован на сервере (bcrypt)
- Email не должен быть виден другим пользователям
- Токен выдается только после успешной регистрации
- Защита от автоматической регистрации (CAPTCHA опционально для будущего)

---

## 3. Поток регистрации

### 3.1. Шаги регистрации

1. **Пользователь нажимает "Регистрация" на экране входа**
2. **Открывается экран регистрации**
3. **Пользователь заполняет поля:**
   - Email (с валидацией в реальном времени)
   - Логин (с валидацией в реальном времени)
   - Пароль (с валидацией в реальном времени)
   - Повтор пароля (с проверкой совпадения)
   - Чекбокс согласия с условиями
4. **Пользователь нажимает "Зарегистрироваться"**
5. **Проверка валидации на клиенте**
6. **Отправка запроса на сервер**
7. **Проверка валидации на сервере**
8. **Создание аккаунта в БД**
9. **Выдача токена авторизации**
10. **Отображение сообщения об успехе**
11. **Переход к созданию персонажа**

---

### 3.2. Обработка ошибок

**Ошибки валидации:**
- Отображение ошибок под соответствующими полями
- Поля с ошибками выделяются визуально
- Кнопка "Зарегистрироваться" неактивна при наличии ошибок

**Ошибки сервера:**
- Отображение общего сообщения об ошибке
- Возможность повторить попытку
- Логирование ошибок на сервере

**Конфликты (email/username уже существует):**
- Отображение ошибки под соответствующим полем
- Предложение использовать другой email/username
- Возможность сразу перейти к экрану входа

---

## 4. Примеры использования

### 4.1. Успешная регистрация

**Ввод данных:**
- Email: `player@example.com`
- Логин: `player123`
- Пароль: `password123`
- Повтор пароля: `password123`
- Чекбокс: отмечен

**Результат:**
- Аккаунт создан
- Токен получен
- Переход к созданию персонажа

---

### 4.2. Ошибка валидации

**Ввод данных:**
- Email: `invalid-email`
- Логин: `ab` (слишком короткий)
- Пароль: `123` (слишком короткий)
- Повтор пароля: `456` (не совпадает)

**Результат:**
- Ошибки отображаются под полями
- Кнопка "Зарегистрироваться" неактивна
- Пользователь должен исправить ошибки

---

### 4.3. Конфликт (email уже существует)

**Ввод данных:**
- Email: `existing@example.com` (уже существует)
- Логин: `newplayer`
- Пароль: `password123`
- Повтор пароля: `password123`

**Результат:**
- Ошибка под полем email: "Email уже используется"
- Предложение использовать другой email или войти в существующий аккаунт

---

## 5. Связанные документы

- [Создание персонажа](./ui-character-creation.md) - следующий шаг после регистрации
- [API Endpoints](./api-requirements/mvp-endpoints.md) - детальные API endpoints
- [Модели данных](./api-requirements/mvp-data-models.md) - модель Account

---

## 6. TODO

**TODO:** Добавить проверку уникальности email/username в реальном времени через API - требуется для лучшего UX.

**TODO:** Добавить индикатор силы пароля (слабый/средний/сильный) - требуется для безопасности.

**TODO:** Добавить CAPTCHA для защиты от автоматической регистрации - требуется для безопасности (для будущего).

**TODO:** Добавить подтверждение email через письмо - требуется для безопасности (для будущего).

---

## История изменений

- v1.0.0 (2025-11-04) - Создание документа с детальным описанием экрана регистрации
