metadata:
  id: implementation-romance-engine-execution
  title: 'Romance Event Engine — Исполнение и память'
  document_type: implementation
  category: algorithms
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-07T01:46:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-07T01:46:00Z
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - romance
    - execution
    - memory
  topics:
    - event-engine
    - ai-behavior
  related_systems:
    - romance-service
    - notification-service
    - analytics-pipeline
  related_documents:
    - id: implementation-romance-engine-scoring
      relation: references
    - id: implementation-romance-event-dialogue
      relation: complements
  source: shared/docs/knowledge/implementation/algorithms/romance/romance-engine-execution.md
  visibility: internal
  audience:
    - concept
    - backend
    - ai
  risk_level: high
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: ''
      status: pending
  next_actions: []
summary:
  problem: 'Исполнение романтических событий и система памяти были описаны в Markdown и недоступны для автоматического контроля.'
  goal: 'Перенести этапы выполнения, рекомендации AI и RelationshipMemory в YAML для согласования с Vision пайплайном.'
  essence: 'Документ детализирует умные рекомендации, хранение воспоминаний, полный цикл события и логику follow-up.'
  key_points:
    - 'AI анализирует состояние отношений и формирует рекомендации: прогресс, примирения, драму, культурные события и вехи.'
    - 'RelationshipMemory сохраняет значимые события, флаги и позволяет использовать прошлый опыт в диалогах.'
    - 'execute_romance_event описывает end-to-end сценарий: выбор, адаптация, проверка, исход, запись истории и планирование следующих шагов.'
content:
  sections:
    - id: smart_recommendations
      title: 'Умные рекомендации AI'
      body: |
        get_smart_recommendations анализирует контекст, готовность к следующей стадии, конфликты, драму и культурный фон,
        формируя список приоритетных событий. Алгоритм обеспечивает разнообразие категорий и учитывает предпочтения игрока.
      mechanics_links:
        - implementation/algorithms/romance/romance-engine-scoring.yaml
      assets: []
    - id: relationship_memory
      title: 'Система памяти отношений'
      body: |
        RelationshipMemory хранит события с деталями: идентификаторы, локации, выборы, исходы и влияние на отношения.
        Память используется для отсылок в диалогах, отслеживания конфликтов, достижений и построения эмоциональных арок.
      mechanics_links: []
      assets: []
    - id: event_flow
      title: 'Полный цикл события'
      body: |
        execute_romance_event описывает загрузку данных, выбор событий, проверку триггеров, культурную адаптацию,
        взаимодействие с игроком, обработку бросков кубика, применение исходов, запись истории и планирование следующих событий.
      mechanics_links:
        - implementation/algorithms/romance/romance-event-triggers.yaml
      assets: []
    - id: follow_up
      title: 'Планирование последующих действий'
      body: |
        После успешного события система обновляет отношения, проверяет достижения, предлагает следующие события и может
        планировать инициативу NPC. Эти действия поддерживают живость отношений и связывают событие с LiveOps.
      mechanics_links:
        - implementation/algorithms/romance/romance-dialogue.yaml
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: true
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-07
    author: ai_brain_manager
    changes: 'Задокументирован полный цикл исполнения романтических событий и система RelationshipMemory.'
validation:
  checksum: ''
  schema_version: '1.0'

