metadata:
  id: backend-companion-system
  title: 'Companion System — Система компаньонов'
  document_type: implementation
  category: backend
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-07T02:34:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-07T02:34:00Z
  owners:
    - role: gameplay_lead
      contact: gameplay@necp.game
  tags:
    - companions
    - pets
    - drones
  topics:
    - gameplay-companions
    - player-progression
  related_systems:
    - companion-service
    - combat-service
    - inventory-service
  related_documents:
    - id: combat-shooter-core
      relation: references
  source: shared/docs/knowledge/implementation/backend/companion/companion-system.md
  visibility: internal
  audience:
    - gameplay
    - backend
    - live-ops
  risk_level: medium
review:
  chain:
    - role: gameplay_lead
      reviewer: ''
      reviewed_at: 2025-11-07T02:34:00Z
      status: approved
  next_actions: []
summary:
  problem: Требовалось описать серверную систему компаньонов (боевые дроны, утилитарные помощники, питомцы) и их прогрессию.
  goal: Сформировать спецификацию типов компаньонов, схем данных, логики призыва и прокачки.
  essence: Документ фиксирует категории компаньонов, таблицы `companion_types` и `player_companions`, процедуры призыва, прогрессии и API.
  key_points:
    - Компаньоны делятся на боевых дронов, утилитарных помощников и социальных питомцев с уникальными эффектами.
    - Данные хранятся в `companion_types` и `player_companions` с кастомизацией, уровнем и статистикой.
    - Сервис поддерживает призыв/отзыв, применение бонусов, прокачку и способности (активные и пассивные).
content:
  sections:
    - id: companion_types
      title: Категории компаньонов
      body: |
        Combat drones (attack/support/recon), Utility (loot collector, hacking assistant, crafting bot) и Social pets (cat, dog,
        drone-bird) задают различные функции и ограничения.
      mechanics_links: []
      assets: []
    - id: data_model
      title: Схемы данных
      body: |
        `companion_types` описывает код, категорию, статы, способности и стоимость. `player_companions` хранит связь с игроком,
        уровень, опыт, экипировку и статус призыва.
      mechanics_links: []
      assets: []
    - id: summon
      title: Призыв и управление
      body: |
        CompanionService проверяет владение, отзывает активного компаньона, сохраняет статус призыва и спавнит сущность в мире.
        Отзыв удаляет эффекты и деспаунит компаньона.
      mechanics_links: []
      assets: []
    - id: progression
      title: Прогрессия компаньона
      body: |
        XP повышает уровень до 50, улучшает здоровье и урон. Функции рассчитывают XP для следующего уровня, применяют бонусы и
        уведомляют игрока.
      mechanics_links: []
      assets: []
    - id: abilities
      title: Способности компаньонов
      body: |
        Активные способности (например, ATTACK_COMMAND, DEFENSIVE_MODE) имеют cooldown и эффекты. Пассивные способности обеспечивают
        постоянные бонусы вроде auto-collect или combat assistance.
      mechanics_links: []
      assets: []
    - id: api
      title: API операций
      body: |
        REST API покрывает получение списка доступных компаньонов, покупку, управление призывом, переименование и использование
        способностей.
      mechanics_links: []
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: true
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml#backend-companion-system
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-07
    author: ai_brain_manager
    changes: Определены типы компаньонов, схемы данных, логика призыва, прогрессии и API.
validation:
  checksum: ''
  schema_version: '1.0'

