metadata:
  id: backend-loot-system-part1
  title: "Loot System — Part 1: Loot Generation"
  document_type: implementation
  category: backend
  status: approved
  version: '1.0.1'
  last_updated: 2025-11-07T02:18:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-07T02:18:00Z
  owners:
    - role: economy_lead
      contact: economy@necp.game
  tags:
    - loot
    - generation
  topics:
    - gameplay-infra
    - economy
  related_systems:
    - economy-service
    - gameplay-service
  related_documents:
    - id: backend-loot-system-overview
      relation: references
    - id: backend-party-system
      relation: references
  source: shared/docs/knowledge/implementation/backend/loot-system/part1-loot-generation.md
  visibility: internal
  audience:
    - backend
    - economy
  risk_level: high
review:
  chain:
    - role: economy_lead
      reviewer: ''
      reviewed_at: 2025-11-07T02:18:00Z
      status: approved
  next_actions: []
summary:
  problem: "Нужна формализованная документация по генерации и распределению добычи для экономики игры."
  goal: "Описать архитектуру лута, схемы хранения таблиц, алгоритмы генерации и режимы распределения."
  essence: "Документ покрывает loot flow, таблицы `loot_tables`/`world_drops`, генерацию предметов и лут для соло/групп."
  key_points:
    - Loot flow описывает генерацию, режимы personal/shared и boss loot.
    - SQL схемы для таблиц лута и world drops с индексами.
    - Java код генерации лута и применения luck modifiers.
    - Сценарии личного и группового дропа с уведомлениями.
content:
  sections:
    - id: overview
      title: Краткое описание
      body: |
        Loot Generation отвечает за добычу из таблиц, распределение между игроками, roll систему и мировые дропы.
      mechanics_links: []
    - id: architecture
      title: Архитектура системы
      body: |
        Диаграмма процесса: смерть NPC/контейнера, генерация, определение режима, создание world drop или прямой выдачи.
      mechanics_links: []
    - id: database_schema
      title: Схемы базы данных
      body: |
        Описаны `loot_tables` и `world_drops`, включая поля для веса, диапазонов, валюты, статусов и индексов.
      mechanics_links: []
    - id: generation
      title: Генерация лута
      body: |
        Java сервис `LootService` генерирует предметы, применяет luck модификатор, распределяет валюту и создаёт world drops.
      mechanics_links: []
    - id: distribution
      title: Распределение
      body: |
        Примеры создания solo и party loot, обработка различных режимов (personal, party roll) и уведомлений.
      mechanics_links: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.1'
    date: 2025-11-07
    author: economy_lead
    changes: Описаны процессы генерации и распределения добычи.
validation:
  checksum: ''
  schema_version: '1.0'

