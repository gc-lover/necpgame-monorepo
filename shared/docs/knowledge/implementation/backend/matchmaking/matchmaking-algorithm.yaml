metadata:
  id: backend-matchmaking-algorithm
  title: Matchmaking Algorithm
  document_type: implementation
  category: backend
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-07T05:30:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-08T21:45:00Z
  owners:
    - role: matchmaking_lead
      contact: matchmaking@necp.game
  tags:
    - matchmaking
    - algorithm
    - backend
  topics:
    - gameplay-infra
    - session-management
  related_systems:
    - matchmaking-service
  related_documents:
    - id: backend-matchmaking-queue
      relation: complements
    - id: backend-matchmaking-rating
      relation: complements
  source: shared/docs/knowledge/implementation/backend/matchmaking/matchmaking-algorithm.md
  visibility: internal
  audience:
    - backend
    - gameplay
  risk_level: high
review:
  chain:
    - role: matchmaking_lead
      reviewer: ''
      reviewed_at: 2025-11-08T21:45:00Z
      status: approved
  next_actions: []
summary:
  problem: Алгоритмы подбора должны учитывать рейтинг, роли и баланс команд, при этом документ отсутствовал в формате YAML.
  goal: Задокументировать PvP и PvE алгоритмы матчмейкинга, балансировку команд и метрики качества матча.
  essence: Рассмотрены выбор кандидатов, snake draft балансировка, подбор PvE-команд и метрика качества матча.
  key_points:
    - Описан процесс подбора PvP матчей и проверка разброса рейтинга.
    - Приведён алгоритм snake draft для балансировки команд.
    - Детализирован PvE подбор с обязательными ролями.
    - Определён Match Quality Score и соответствующие API.
content:
  sections:
    - id: overview
      title: Краткое описание
      body: |
        Matchmaking Algorithm описывает подбор игроков в команды, поддерживает PvP и PvE режимы, балансировку команд и
        расчёт качества матча на основе рейтинга, ролей, времени ожидания и латентности.
      mechanics_links: []
    - id: pvp_algorithm
      title: PvP алгоритм
      body: |
        Алгоритм просматривает очередь, проверяет разброс рейтингов, применяет snake draft и создаёт матч при выполнении
        критериев. Код реализован на Java.
      mechanics_links: []
    - id: team_balancing
      title: Балансировка команд
      body: |
        Snake draft сортирует игроков по рейтингу и распределяет по командам, обеспечивая сравнимый средний рейтинг и
        учет ролей.
      mechanics_links: []
    - id: pve_algorithm
      title: PvE алгоритм
      body: |
        Подбор PvE матча требует состав из танка, хила и трёх DPS. Проверяются доступные роли и формируется команда.
      mechanics_links: []
    - id: quality_score
      title: Метрики качества
      body: |
        Описан Match Quality Score с компонентами rating balance, role distribution, wait time fairness и latency.
      mechanics_links: []
    - id: api
      title: API
      body: |
        Документ указывает ключевые endpoints для приёма/отклонения матчей и связи с другими подсистемами.
      mechanics_links: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-07
    author: matchmaking_lead
    changes: Первичное описание алгоритмов подбора матчей.
validation:
  checksum: ''
  schema_version: '1.0'

