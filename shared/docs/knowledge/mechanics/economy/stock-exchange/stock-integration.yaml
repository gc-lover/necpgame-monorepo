metadata:
  id: stock-integration
  title: Биржа акций — Интеграция с игровыми системами
  document_type: mechanics
  category: economy
  status: approved
  version: '1.1.0'
  last_updated: 2025-11-07T16:19:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-09
  owners:
    - role: concept_director
      contact: concept@necp.game
  tags:
    - stock-exchange
    - integration
    - economy-events
  topics:
    - market_integration
    - cross_system_design
  related_systems:
    - quest-service
    - faction-service
    - economy-events
    - news-feed
  related_documents:
    - id: stock-events
      relation: complements
    - id: quest-system
      relation: references
  source: shared/docs/knowledge/mechanics/economy/stock-exchange/stock-integration.md
  visibility: internal
  audience:
    - concept
    - economy
    - gameplay
  risk_level: medium
review:
  chain:
    - role: concept_director
      reviewer: ''
      reviewed_at: 2025-11-09
      status: approved
  next_actions: []
summary:
  problem: Требуется консистентное описание связей биржи с квестами, фракциями и мировыми событиями.
  goal: Определить потоки данных, API и таблицы, которые переводят игровые события в изменение стоимости акций.
  essence: События из квестов, войн и глобальных кризисов транслируются в экономику через настроенные фоновые сервисы и аналитические структуры.
  key_points:
    - Квестовые решения напрямую влияют на котировки корпоративных акций.
    - Фракционные войны и репутация открывают доступ к особым инструментам и акциям.
    - Мировые события и шина `economy.integration.events` синхронизируют массовые изменения.
content:
  sections:
    - id: introduction
      title: Введение
      body: |
        Документ описывает, как биржа акций связана с квестами, фракциями и глобальными событиями. Интеграция обеспечивает реакцию рынка на действия игроков и поддерживает внутриигровой лор.
      mechanics_links:
        - mechanics/economy/stock-exchange/stock-exchange-overview.yaml
      assets: []
    - id: quest_integration
      title: Квестовые сценарии
      body: |
        Исходы корпоративных квестов (например, «Corporate Espionage», «Biotechnica Sabotage») пересчитываются в проценты влияния на акции. Поддерживаются обучающие и серые квесты с риском инсайдерской торговли, что формирует инвестиционные возможности и штрафы.
      mechanics_links:
        - mechanics/economy/stock-exchange/stock-events.yaml
      assets: []
    - id: faction_integration
      title: Фракционные и репутационные эффекты
      body: |
        Фракционные войны изменяют стоимость акций участников, а высокая репутация открывает доступ к привилегированным выпуском, брокерским скидкам и легальным советам. Игроки видят связь между выбором стороны и инвестиционными результатами.
      mechanics_links:
        - mechanics/economy/stock-exchange/stock-protection.yaml
      assets: []
    - id: world_events
      title: Мировые события
      body: |
        Глобальные события вроде энергетических кризисов, технологических прорывов или войн транслируются в массовые изменения коэффициентов. Значения и сценарии фиксируются через таблицы соответствий и обновляются аналитиками.
      mechanics_links:
        - mechanics/economy/stock-exchange/stock-events.yaml
      assets: []
    - id: event_bus
      title: Шина событий и мэппинг
      body: |
        Топик `economy.integration.events` доставляет payload с типом события, серьёзностью и списком корпораций. Таблица `event_stock_mapping` связывает события с процентами влияния, поддерживает overrides и админ-редактирование.
      mechanics_links:
        - mechanics/economy/stock-exchange/stock-events.yaml
      assets: []
    - id: api_interfaces
      title: API интеграций
      body: |
        REST интерфейсы `/stocks/integration/event-hooks`, `/event-preview`, `/event-override` и `/journal` обслуживают регистрацию источников, моделирование what-if сценариев и аудит взаимосвязей. Админы управляют корректировками и проверяют соответствие реальным событиям.
      mechanics_links:
        - mechanics/economy/stock-exchange/stock-analytics.yaml
      assets: []
    - id: system_dependencies
      title: Связанные системы
      body: |
        Quest-service отправляет webhooks, faction-service публикует статусы войн, economy-events поддерживает макроэкономические сигналы, news-feed транслирует внутриигровые новости для игроков и UI.
      mechanics_links:
        - mechanics/economy/stock-exchange/stock-protection.yaml
      assets: []
appendix:
  glossary: []
  references: []
  decisions: []
implementation:
  needs_task: false
  queue_reference:
    - shared/trackers/queues/vision/review.yaml#CON-2025-228
  blockers: []
history:
  - version: '1.1.0'
    date: 2025-11-07
    author: concept_director
    changes: Добавлены шина событий, таблицы мэппинга, REST API и расширенные сценарии.
  - version: '1.0.0'
    date: 2025-11-06
    author: concept_director
    changes: Создан базовый документ интеграции биржи с системами.
validation:
  checksum: ''
  schema_version: '1.0'

