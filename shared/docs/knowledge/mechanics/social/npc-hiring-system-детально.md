# Система найма NPC — детальная версия

**Статус:** approved  
**Версия:** 1.0.0  
**Дата создания:** 2025-11-07  
**Последнее обновление:** 2025-11-09 01:28  
**Приоритет:** высокий

**target-domain:** social  
**target-microservice:** social-service (8084)  
**target-microservice-secondary:** economy-service (8089), world-service (8092), npc-service (8088)  
**target-frontend-module:** modules/social/npc-hiring, modules/world/insights

**api-readiness:** ready  
**api-readiness-check-date:** 2025-11-09 11:21  
**api-readiness-notes:** Перепроверено 2025-11-09 11:21: контракты, управление, экономика и REST/Kafka контуры остаются готовыми к постановке API задач.

---

## 1. Методика детализации

- **Слои:** тип найма, процесс, контракт, экономика, управление, эффективность, влияние.
- **Роли:** заказчик (игрок/клан/фракция), NPC-кандидат, менеджер (игрок/AI), агент (фиксер/биржа).
- **Модули:** `social-service` (контракты, отношения, лимиты), `economy-service` (оплата, расходы, прибыли), `world-service` (доступность NPC, события), `gameplay-service` (боевые/экономические задания), `npc-service` (пул персонажей, развитие).
- **Интерфейсы:** биржа найма, переговоры, панель управления, отчеты, уведомления.

---

## 2. Типы найма и специализации NPC

- **Торговец:** управление магазинами, логистикой, складом, выставками.
- **Квестодатель:** генерация контрактов, выдача заданий другим игрокам, сценарии событий.
- **Фиксер:** посредник в контрактах, найм других NPC, организация миссий.
- **Телохранитель/Наемник:** PvE/PvP охрана, сопровождение, миссии отторжения.
- **Инженер/Механик:** ремонт, моддинг, установка имплантов, техобслуживание.
- **Дипломат:** ведение переговоров с фракциями и NPC.
- **Информатор:** сбор информации, разведка, аналитика.
- **Креатор контента:** создание учебных материалов, VR-фильмов, рекламных кампаний.
- **Менеджер фракции:** администрирование гильдий, кланов, корпораций.
- **Специализированные:** хакеры, медики, пилоты, исследователи, артисты.

Каждый тип имеет требования (репутация, доверие, ресурсы), набор навыков, уникальные способности, зарплатные диапазоны.

---

## 3. Процесс найма

1. **Поиск:** игрок исследует биржу, социал-хабы, личные контакты, фракционные каналы.
2. **Переговоры:** обсуждение условий, стоимости, длительности, ответственности, бонусов.
3. **Контракт:** подписание через интерфейс (включает штрафы, премии, условия расторжения).
4. **Подготовка:** выдача оборудования, обучение, настройка списков задач.
5. **Запуск:** NPC приступает к работе, интегрируется в системы.
6. **Мониторинг:** отчеты, KPI, настроение, эффективность.
7. **Завершение/продление:** игрок решает, продлить, изменить условия или закончить контракт.

### 3.1 Контракты

- **Типы:** фиксированный срок, бессрочный, миссионный (оплата за миссию), стажировка (низкая оплата + обучение).
- **Параметры:** зарплата, премии, штрафы, лимиты времени, условия увольнения.
- **Доп. условия:** жилье, оружие, страховка, участие в рейдах.
- **Арбитраж:** модуль `social-service` фиксирует нарушение правил, применяет штрафы.

---

## 4. Управление нанятыми NPC

- **Панель управления:** список NPC, статус, настроение, задания, зарплата, статистика.
- **Настройка задач:** расписания, ротации, приоритеты, автоматизация.
- **Команды:** вручную/полуавтомат; примеры — «Защищать базу», «Торговать на рынке», «Собирать ресурсы», «Вести переговоры».
- **Распределение ресурсов:** предоставление оборудования, расходников, транспорта.
- **Коммуникация:** диалоги, отчеты, уведомления.
- **Эмоции/лояльность:** влияет на эффективность, возможность предательства.

---

## 5. Экономика найма

- **Зарплата:** фиксированная, почасовая, комиссия от прибыли, бонусы за успех.
- **Расходы:** страховка, жилье, питание, оборудование.
- **Доходы:** прибыль от торговцев, успешных миссий, экономия времени, бонусы.
- **Инвестиции:** улучшение NPC (обучение, импланты) повышает эффективность.
- **Налоги:** фракции взимают налоги с найма, см. `economy-service` и `factions-overview-детально.md`.
- **Отчеты:** дневной/недельный/сезонный баланс, ROI, сравнение с альтернативами.

---

## 6. Эффективность и развитие NPC

- **Навыки:** боевые, экономические, социальные, технические — зависят от ролей.
- **Опыт:** NPC получают опыт, открывают новые способности, требуют повышения зарплаты.
- **Лояльность:** зависит от условий, оплаты, отношений (`relationships-system-детально.md`).
- **Настроение:** влияет на качество работы, риск ухода, отрицательные действия.
- **Карьерные пути:** NPC могут расти до менеджеров, фиксеров, лидеров.

---

## 7. Ограничения и лимиты

- **Количество:** ограничено навыками игрока, инфраструктурой, фракционными лицензиями.
- **Ресурсы:** требуется жилье, рабочие места, склада.
- **Законы:** фракции накладывают ограничения, квоты, лицензии.
- **Репутация:** низкая репутация блокирует доступ к элитным NPC.
- **Моральный риск:** некоторые NPC могут предать, если лояльность низкая.

---

## 8. Продвинутые механики

- **Цепочка найма:** управляющий NPC сам нанимает других (автоматизация).
- **Групповой найм:** найм команды (боевой отряд, торговая бригада).
- **Автоматизация:** скрипты задач, AI-планирование.
- **Персонализация:** кастомизация внешнего вида, истории, диалогов.
- **Смена ролей:** NPC может сменить специализацию при обучении (см. `mentorship-system-детально.md`).

---

## 9. Влияние на мир

- **Города:** NPC работают в магазинах, сервисах, влияют на экономику.
- **Фракции:** NPC поддержки фракций, участие в войнах, дипломатии.
- **События:** NPC инициируют события (распродажи, соревнования, миссии).
- **Экономика:** объем рынка, поставки, контракты.
- **Социальные связи:** NPC создают сеть контактов, влияют на другие системы.

---

## 10. Интерфейсы и UX

- **Биржа:** список NPC, фильтры, рейтинги, отзывы.
- **Контракт:** интерактивное соглашение с условиями и визуализацией.
- **Панель управления:** графики, диаграммы, индикаторы настроения.
- **Уведомления:** предупреждения о рисках, просьбы NPC, отчеты.
- **VR-хабы:** встреча с NPC, переговоры, обучение в виртуальных пространствах.

---

## 11. Использование документа

- Использовать для разработки API найма, управления, экономики.
- Связать с `relationships-system-детально.md`, `npc-relationships-system-детально.md`, `visual-style-assets-детально.md` (визуалы NPC), `factions-overview-детально.md` (лицензии, налоги).
- UX макеты биржи, панелей и контрактов согласованы с фронтендом.
- Баланс и формулы подтянуты из `npc-hiring-economy.md` и `npc-hiring-effectiveness.md`.

---

## 12. REST API и JSON схемы

- `POST /social/npc-hiring/contracts` — создание контракта (`NpcContractCreateRequest`).
- `GET /social/npc-hiring/contracts/{contractId}` — детали и статус (`NpcContract`).
- `POST /social/npc-hiring/workforce` — найм группы NPC (`NpcWorkforceHireRequest`).
- `POST /economy/npc-hiring/payroll/calculate` — расчёт зарплат и налогов (`NpcPayrollRequest`).
- `GET /social/npc-hiring/dashboard` — агрегированные данные управления (`NpcHiringDashboard`).
- `POST /npc/npc-hiring/performance` — обновление KPI NPC (`NpcPerformanceUpdateRequest`).

**JSON схемы:**  
- `schemas/social/npc-contract-create.schema.json`  
- `schemas/social/npc-workforce-hire.schema.json`  
- `schemas/economy/npc-payroll.schema.json`  
- `schemas/social/npc-hiring-dashboard.schema.json`  
- `schemas/npc/npc-performance-update.schema.json`

---

## 13. Kafka события и очереди

| Topic | Producer | Payload | Консьюмеры |
|-------|----------|---------|-----------|
| `social.npc-hiring.contract.created` | social-service | `{ contractId, employerId, npcId, contractType, startAt }` | economy-service, notification-service, world-service |
| `social.npc-hiring.contract.updated` | social-service | `{ contractId, status, salary, loyaltyDelta }` | telemetry, npc-service |
| `economy.npc-hiring.payroll.processed` | economy-service | `{ payrollId, employerId, totalCost, taxes, bonuses }` | analytics, accounting |
| `npc.hiring.performance.changed` | npc-service | `{ npcId, performanceScore, loyalty, mood }` | social-service, world-service, quest-service |
| `social.npc-hiring.alert` | social-service | `{ alertId, severity, message, npcIds[] }` | UI, monitoring, factions-service |

- Очередь `npc-hiring-contract-review` контролирует модерацию условий контрактов и соответствие лицензиям.

---

## 14. Метрики и аналитика

- `ContractSuccessRate` — доля контрактов, завершённых без штрафов.
- `NpcPerformanceIndex` — средний KPI по ролям, применяется к бонусам.
- `PayrollBurnRate` — еженедельные расходы на NPC, отслеживается economy-service.
- `LoyaltyTrend` — изменение лояльности, влияет на риск ухода/предательства.
- `HiringLeadTime` — время от создания заявки до подписания контракта.
- Метрики отправляются в monitoring dashboards (Grafana) и telemetry (`TickDuration p95`, `npc-hiring-response-time`).

---

## 15. UX, QA и согласование

- UI макеты утверждены: PR `FW-NPC-HIRING-010`, включают биржу, мастер контрактов, отчёты.
- Security review `SEC-NPC-HIRE-004` — проверены санкции и правовые ограничения.
- QA чеклист:  
  - [x] JSON схемы проверены `schema-test`.  
  - [x] Kafka payloadы синхронизированы с backend.  
  - [x] UX потоки протестированы на edge-кейсах массового найма.
- Воркшоп 2025-11-08 09:55: social/economy/world команды согласовали индексы и события.

---

## 16. История изменений

- 2025-11-08 — добавлены API задачи, REST/Kafka контуры, метрики и UX согласование; статус `approved`, готовность `ready`.
- 2025-11-07 — первичный драфт системы найма NPC.