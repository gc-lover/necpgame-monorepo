metadata:
  id: player-orders-creation-detailed
  title: Система заказов — создание заказа (детально)
  document_type: mechanics
  category: social
  status: approved
  version: '1.0.0'
  last_updated: 2025-11-08T09:53:00Z
  concept_approved: true
  concept_reviewed_at: 2025-11-08T09:53:00Z
  owners:
    - role: social_lead
      contact: social@necp.game
  tags:
    - player-orders
    - order-creation
  topics:
    - social-systems
    - economy
  related_systems:
    - social-service
    - economy-service
    - world-service
    - npc-service
    - factions-service
  related_documents:
    - id: player-orders-system-detailed
      relation: references
    - id: player-orders-reputation-detailed
      relation: references
    - id: relationships-system-detailed
      relation: references
    - id: npc-hiring-system-detailed
      relation: references
  source: shared/docs/knowledge/mechanics/social/player-orders-creation-детально.md
  visibility: internal
  audience:
    - concept
    - social
    - economy
    - world
  risk_level: medium
review:
  chain:
    - role: social_lead
      reviewer: ''
      reviewed_at: 2025-11-08T09:53:00Z
      status: approved
  next_actions: []
summary:
  problem: Процесс подготовки заказов существовал в виде неструктурированных заметок и требовал формализации для сервисов и UX.
  goal: Зафиксировать конвейер создания заказа, параметры брифа, формулы бюджета и проверки для готовности API и интерфейсов.
  essence: Документ описывает многошаговый мастер, шаблоны, расчёт бюджета, режимы публикации и интеграции с сервисами social, economy и world.
  key_points:
    - Конвейер охватывает от подготовки брифа до публикации, гарантий и логов в telemetry.
    - Формулы бюджета используют ComplexityScore, RiskModifier, MarketIndex и TimeModifier, оформлены JSON схемами и валидациями.
    - Режимы публикации и страховые уровни интегрируются с relationships-, factions-, economy- и npc-системами.
content:
  sections:
    - id: pipeline
      title: Конвейер создания
      body: |
        Процесс включает подготовку брифа, валидацию, оценку сложности, настройку публикации, выбор
        гарантий и публикацию. Социальный сервис оркестрирует взаимодействие с экономикой и NPC.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: prerequisites
      title: Предусловия
      body: |
        Требуются минимальный рейтинг (Bronze), отсутствие санкций, покрытие депозита, подтверждение
        фракций для корпоративных заказов. Проверки выполняют economy и factions сервисы.
      mechanics_links:
        - mechanics/social/player-orders-reputation-детально.yaml
    - id: templates
      title: Шаблоны заказов
      body: |
        Боевые, хакерские, экономические, социальные и исследовательские шаблоны задают предзаполненные
        поля и подсказки. Параметр `orderTemplate` управляет конфигурацией мастера.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: brief-parameters
      title: Параметры брифа
      body: |
        Цели, сроки, бюджет, риски, требования к команде, приватность и вложения. Информация хранится
        в social-service и content-service.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: complexity
      title: Оценка сложности
      body: |
        Сложность вычисляется на основе зон, целей, навыков и риска, используя данные world и factions
        сервисов. Результат влияет на бюджет и требования к рейтингу исполнителей.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: budget
      title: Расчёт бюджета
      body: |
        BaseReward = ComplexityScore × RiskModifier × MarketIndex × TimeModifier.
        Escrow и комиссия рассчитываются от базовой суммы, сравниваются с медианой. Приведена JSON схема
        `player-order-budget.schema.json`.
      mechanics_links:
        - mechanics/social/player-orders-economy.yaml
    - id: publication
      title: Режимы публикации
      body: |
        Публичный, пригласительный и закрытый режимы. Адресные публикации требуют доверия из
        relationships-system.
      mechanics_links:
        - mechanics/social/relationships-system-детально.md
    - id: validation
      title: Валидации и проверки
      body: |
        Проверка полноты полей, юридических ограничений, бюджета, токсичности формулировок и санкций.
        Ошибки логируются в telemetry-service.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: guarantees
      title: Гарантии и страхование
      body: |
        Настраиваются уровни страховки, escrow и комиссии. Дополнительные гарантии повышают рейтинг
        заказчика и доступны арбитражу.
      mechanics_links:
        - mechanics/social/player-orders-reputation-детально.yaml
    - id: ux-flow
      title: UX-поток
      body: |
        Многошаговый мастер (Overview → Details → Budget → Publication → Review) с подсказками, симуляцией
        бюджета и черновиками. Макеты утверждены (PR `FW-PO-CREATION-021`).
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: integrations
      title: Интеграции
      body: |
        Связи с документами по репутации, отношениям и найму NPC обеспечивают адресные приглашения,
        влияние на рейтинги и подключение NPC-исполнителей.
      mechanics_links:
        - mechanics/social/player-orders-reputation-детально.yaml
        - mechanics/social/npc-hiring-system-детально.yaml
    - id: rest
      title: REST API
      body: |
        POST `/social/player-orders` (создание), `/estimate`, `/validate`, `/publish`, `/draft`. JSON
        схемы описаны для каждого запроса.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
    - id: kafka
      title: Kafka события
      body: |
        `social.player-orders.draft.saved`, `social.player-orders.validation.failed`, `social.player-orders.published`,
        `economy.player-orders.escrow.locked` и подписчики telemetry, monitoring, factions и quest сервисов.
      mechanics_links:
        - mechanics/social/player-orders-system.yaml
appendix:
  glossary: []
  references:
    - title: JSON схема бюджета заказа
      link: schemas/social/player-order-budget.schema.json
    - title: Мастер создания заказов (Figma)
      link: figma://ui/player-orders/create-wizard
  decisions: []
implementation:
  needs_task: true
  queue_reference:
    - shared/trackers/queues/concept/queued.yaml
  blockers: []
history:
  - version: '1.0.0'
    date: 2025-11-08
    author: social_team
    changes: Финализированы формулы бюджета, проверки, режимы публикации и интеграции с сервисами.
validation:
  checksum: ''
  schema_version: '1.0'

