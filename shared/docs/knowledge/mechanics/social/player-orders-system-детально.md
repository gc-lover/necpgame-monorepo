# Система заказов от игроков — детальная версия

**Статус:** approved  \
**Версия:** 1.0.0  \
**Дата создания:** 2025-11-07  \
**Последнее обновление:** 2025-11-08 09:51  \
**Приоритет:** высокий

**target-domain:** social  \
**target-microservice:** social-service (8084)  \
**target-microservice-secondary:** economy-service (8085), world-service (8086), gameplay-service (8083)  \
**target-frontend-module:** modules/social/player-orders

**api-readiness:** ready  \
**api-readiness-check-date:** 2025-11-09 02:50  \
**api-readiness-notes:** Перепроверено 2025-11-09 02:50: ядро системы заказов, REST/JSON контуры и интеграции social/economy/world подтверждены, блокеров для постановки задач нет.

---

## 1. Методика детализации

- **Слои:** тип заказа, процесс, экономика, исполнители, рейтинги, арбитраж.
- **Роли:** заказчик (игрок/клан/фракция), исполнитель (игрок/NPC/команда), брокер (NPC/система), наблюдатель (арбитраж, аудит).
- **Модули:** `social-service` (контракты, репутация, арбитраж), `economy-service` (оплата, налоги, комиссионные), `world-service` (доступность заказов, влияние на мир), `gameplay-service` (миссии, рейды), `npc-service` (NPC-исполнители), `factions-service` (фракционные заказы).
- **Интерфейсы:** доска заказов, панель создания, панель исполнителя, трекер статуса, журналы сделок.
- **Данные:** JSON схемы для заказов, заявок, отзывов, escrow операций, мировых эффектов.

- **Status:** ready-to-create
- **Target tasks:**
- **Last Updated:** 2025-11-08 09:51

---

## 2. Типы заказов — расширенный каталог

- **Боевые:** зачистка зон, сопровождение, охота за головами, защита караванов.
- **Хакерские:** взлом сетей, кража данных, защита серверов, информационные диверсии.
- **Торговые/логистические:** доставка товаров, обеспечение цепочек, сбор ресурсов, контрабанда.
- **Политические:** переговоры, пропаганда, фракционные задания, саботаж.
- **Исследовательские:** разведка территорий, сбор данных, изучение артефактов.
- **Социальные:** организация мероприятий, PR-кампании, медиаакции, обучение.
- **Творческие:** создание контента, VR-шоу, искусство.
- **Комбинированные:** многоэтапные задания (боевые + хакерские + логистика).

Каждый тип имеет параметры сложности, риска, времени, необходимого уровня репутации/доверия, рекомендуемые уровни исполнителей.

---

## 3. Процесс заказа

1. **Создание:** заказчик формирует задачу (описание, цель, тип, требования).
2. **Параметры:** награды (фиксированная оплата, процент, бонусы), сроки, условия провала, штрафы.
3. **Публикация:** заказ приходит на доску (публично/фракционно/закрыто), в NPC-агентства, к брокерам.
4. **Отбор исполнителей:** заявка исполнителя, проверка репутации, интервью, подтверждение.
5. **Исполнение:** исполнитель выполняет задания, обновляет статус (этапы, проверки).
6. **Доставка результата:** подтверждение выполнения, проверка доказательств (скриншоты, логи, ресурсы).
7. **Расчёт:** оплата, бонусы, изменение рейтингов.
8. **Отзыв:** заказчик и исполнитель оставляют отзывы, вызывая изменения рейтинга.
9. **Арбитраж:** в случае конфликта — модуль `social-service` решает спор.

---

## 4. Контракты и каналы

- **Доска заказов:** публичные задания, фильтры (тип, награда, репутация).
- **NPC-брокеры:** фиксеры, агентства, биржи (`npc-relationships-system-детально.md`).
- **Фракционные каналы:** закрытые задания для членов фракций, «чёрные» доски.
- **Прямые сделки:** заказчик вручную выбирает исполнителя.
- **VR-конференции:** переговоры, заключение контрактов, презентации.

### 4.1 Форматы контрактов

- **Публичные:** любой может принять.
- **С отсбором:** заказчик выбирает из заявок.
- **Закрытые:** только определенные лица.
- **Автоматизированные:** система подбирает исполнителя.
- **Аукционные:** ставки исполнителей (цена/время).

---

## 5. Экономика заказов

- **Оплата:** фиксированная сумма, процент от прибыли, предметы, репутационные бонусы.
- **Депозит:** заказчик может внести предоплату (в escrow), чтобы обезопасить исполнителя.
- **Комиссии:** `economy-service` удерживает комиссионные, налоги фракций.
- **Бонусы:** за скорость, качество, отсутствие повреждений, секретные цели.
- **Штрафы:** за провал, нарушение условий, задержки.
- **Маркетплейсы:** исторические данные о ценах, рекомендации, индексы (в стиле EVE Online).

---

## 6. Рейтинги и репутация

- **Исполнитель:** рейтинг по типам заказов, история, жалобы, успехи.
- **Заказчик:** честность, своевременность оплаты, качество постановки задач.
- **Фракции:** поддерживающие заказы, влияние на дипломатические отношения.
- **UI:** профили, бейджи, отзывы, статистика.
- **Санкции:** чёрные списки, снижение доступа к заказам, штрафы.

---

## 7. Роль NPC

- **Заказчики:** NPC-фракции создают задания (обеспечивают живой мир).
- **Исполнители:** наёмные NPC, наёмники, фиксерские команды.
- **Брокеры:** NPC управляют досками, проверяют условия, выдают предварительные контракты.
- **Арбитраж:** нейтральные NPC-организации решают споры.

---

## 8. Влияние на мир и другие системы

- **Фракции:** заказы меняют влияние, территории, экономику.
- **Города:** заказчики запускают события, фестивали, кризисы.
- **Экономика:** динамика цен, спрос/предложение, логистические маршруты.
- **Социальные связи:** исполнитель → заказчик → фракция, создавая цепочки доверия.
- **Комбат:** PvP контракты, награды за убийство ключевых целей.
- **Контент:** заказы могут генерировать пользовательские сценарии.

### 8.1 Связь с City Life и визуальными гайдами

- `city-life-population-algorithm.md`: выполнение заказов влияет на живость районов, триггеры пересчётов `world-service`.
- `city-life-api-task-package.md`: world/social/economy эндпоинты используют данные player orders для событий.
- `visual-style-locations-детально.md`: доски заказов локализованы в Skyline Agora (`ASSET-HUB-NC-031`), Undermarket Bazaar (`ASSET-HUB-NC-032`), League Hub Conflux (`ASSET-HUB-NC-033`).
- `visual-style-assets-детально.md`: карточки заказов используют профили персонажей/оружия для UI.

---

## 9. UX и инструменты

- **Создание заказа:** пошаговый интерфейс, шаблоны, рекомендации.
- **Отслеживание:** трекер прогресса, ETA, этапы, отчеты.
- **Уведомления:** изменения статуса, новые заявки, предупреждения.
- **Журнал:** история контрактов, фильтры, экспорт.
- **VR-панели:** встреча с исполнителями, презентация проектов.

---

## 10. Арбитраж и безопасность

- **Система жалоб:** заказчик/исполнитель могут подать жалобу.
- **Доказательства:** скриншоты, логи, записи.
- **Решения:** возврат средств, штрафы, понижение рейтинга, бан.
- **Анти-читерство:** интеграция с `security-service`.

---

## 11. Использование документа

- Применять при разработке API/contracts для системы заказов.
- Связывать с `npc-hiring-system-детально.md`, `relationships-system-детально.md`, `visual-style-locations-детально.md` (места размещения досок), `economy-service` и `social-service`.
- Подготовить UX макеты (доска заказов, панель создания, трекер).
- Балансировать цены, санкции, рейтинги по типам заказов.
- Экспортировать JSON спецификации через `scripts/export-player-orders.ps1`.

---

## 12. REST API и JSON схемы

- `POST /social/player-orders` — создание заказа (`PlayerOrderCreateRequest`).
- `GET /social/player-orders` — поиск и фильтрация (пагинация, сортировка).
- `POST /social/player-orders/{orderId}/applications` — заявка исполнителя (`PlayerOrderApplication`).
- `POST /social/player-orders/{orderId}/status` — обновление этапов (синхронизация с `gameplay-service`).
- `POST /social/player-orders/{orderId}/complete` — завершение и передача данных в `economy-service`.
- `POST /social/player-orders/{orderId}/review` — отзывы, рейтинг.
- `POST /economy/player-orders/{orderId}/escrow` — управление депозитом (`EscrowOperationRequest`).
- `GET /world/player-orders/effects` — влияние на мир (`PlayerOrderImpact`).

**JSON схемы:**
- `schemas/social/player-order-create.schema.json`
- `schemas/social/player-order.schema.json`
- `schemas/social/player-order-application.schema.json`
- `schemas/social/player-order-review.schema.json`
- `schemas/economy/player-order-escrow.schema.json`
- `schemas/world/player-order-impact.schema.json`

---

## 13. Kafka события

| Topic | Producer | Payload |
|-------|----------|---------|
| `social.player-orders.created` | social-service | `{ orderId, orderType, factionId, publishedAt }` |
| `social.player-orders.status` | social-service | `{ orderId, status, progress, updatedAt }` |
| `social.player-orders.application` | social-service | `{ orderId, applicationId, applicantId, reputationScore }` |
| `economy.player-orders.escrow` | economy-service | `{ orderId, escrowStatus, amount, penalty }` |
| `world.player-orders.impact` | world-service | `{ orderId, cityId, effectType, magnitude }` |
| `social.player-orders.review` | social-service | `{ orderId, reviewerId, targetId, rating, tags }` |

Подписчики: telemetry-service, monitoring-service, rating-service, factions-service, quest-service.

---

## 14. DTO и фронтенд

- FRONT-WEB модуль `social/player-orders` использует `PlayerOrderDTO`, `OrderApplicationDTO`, `OrderReviewDTO`, `OrderImpactDTO`.
- Генерация клиентов из `api/v1/social/player-orders.yaml`, `api/v1/economy/escrow/player-orders.yaml`, `api/v1/world/player-orders/effects.yaml`.
- UI компоненты: `PlayerOrderCard`, `ApplicationList`, `OrderProgressTracker`, `ReviewModal`, `EscrowPanel`.
- Макеты в Figma: `figma://ui/player-orders/board`, `figma://ui/player-orders/escrow`.

---

## 15. Проверка и согласование

- Продукт: workshop 2025-11-08 08:40 — подтверждена бизнес-логика.
- Арт/UI: `UI-SOC-PO-20251108` — макеты доски, форм, трекера утверждены.
- Economy: комиссии и escrow-политики синхронизированы с `economy-service` (meeting 2025-11-08 09:00).
- Security: интеграция с `security-service` подтверждена (ticket `SEC-PO-014`).
- QA чеклист:  
  - [x] JSON схемы валидированы `schema-test` скриптом.  
  - [x] Kafka payloadы описаны и сопоставлены с сервисами.  
  - [x] Документ < 400 строк, readiness-трекер обновлён.

---

## 16. История изменений

- 2025-11-08 — добавлены API контуры, JSON схемы, Kafka события, UX требования; статус `approved`, готовность `ready`.
- 2025-11-07 — первичный драфт.

